/*!
 * LMV v7.96.0
 *
 * Copyright 2024 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Viewer SDK Usage Limitations:
 *
 * The Autodesk Viewer SDK JavaScript must be delivered from an
 * Autodesk-hosted URL.
 */
var LMV;(()=>{var e,t,i={32263:e=>{e.exports="#if NUM_CUTPLANES > 0\nuniform vec4 cutplanes[NUM_CUTPLANES];\nuniform bool cutplanesHideInterior;\nvoid checkHideInterior(vec3 worldPosition) {\n    int insideCount = 0;\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) < 0.0) {\n            insideCount++;\n        }\n    }\n    if (insideCount == NUM_CUTPLANES) {\n        discard;\n    }\n}\nvoid checkCutPlanes(vec3 worldPosition) {\n    if (cutplanesHideInterior) {\n        checkHideInterior(worldPosition);\n        return;\n    }\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            discard;\n        }\n    }\n}\n#endif\n"},16006:e=>{e.exports="uniform float point_size;"},25334:e=>{e.exports="\nuniform sampler2D tDepth;\nuniform vec4 projInfo;\nuniform float isOrtho;\nuniform mat4 worldMatrix_mainPass;\nvec3 reconstructCSPosition(vec2 fragCoords, float z) {\n    return vec3((fragCoords * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructWorldPosition(vec2 fragCoords, vec2 screenUv) {\n    float zCam = texture2D(tDepth, screenUv).z;\n    vec3 csPos = reconstructCSPosition(fragCoords, zCam);\n    return (worldMatrix_mainPass * vec4(csPos, 1.0)).xyz;\n}\n"},7246:e=>{e.exports="\nuniform float envRotationSin;\nuniform float envRotationCos;\nvec3 adjustLookupVector(in vec3 lookup) {\n    return vec3(\n            envRotationCos * lookup.x - envRotationSin * lookup.z,\n            lookup.y,\n            envRotationSin * lookup.x + envRotationCos * lookup.z);\n}\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret;\n    ret *= exposure;\n    return ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\n    return vRGBA.xyz * vRGBA.xyz * exposure;\n}\nvec3 sampleIrradianceMap(vec3 dirWorld, samplerCube irrMap, float exposure) {\n    vec4 cubeColor4 = textureCube(irrMap, adjustLookupVector(dirWorld));\n#ifdef IRR_GAMMA\n    vec3 indirectDiffuse = GammaDecode(cubeColor4, exposure);\n#elif defined(IRR_RGBM)\n    vec3 indirectDiffuse = RGBMDecode(cubeColor4, exposure);\n#else\n    vec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\n    indirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\n    return indirectDiffuse;\n}\n"},53833:e=>{e.exports="#ifdef HATCH_PATTERN\ngl_FragColor = calculateHatchPattern(hatchParams, gl_FragCoord.xy, gl_FragColor, hatchTintColor, hatchTintIntensity);\n#endif\n#ifdef MRT_NORMALS\noutNormal = vec4(geomNormal.x, geomNormal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#include <id_frag>\n"},72448:e=>{e.exports="float averageOfFloat3(in vec3 value) { \n    const float oneThird = 1.0 / 3.0; \n    return dot(value, vec3(oneThird, oneThird, oneThird)); \n} \n"},52698:e=>{e.exports="#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nuniform vec3 hatchTintColor;\nuniform float hatchTintIntensity;\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 3.5;\n    return exp(-exponent*exponent);\n}\nvec4 calculateHatchPattern(vec2 hatchParams, vec2 coord, vec4 fragColor, vec3 hatchTintColor, float hatchTintIntensity ) {\n    float hatchSlope = hatchParams.x;\n    float hatchPeriod = hatchParams.y;\n    if (abs(hatchSlope) <= 1.0) {\n        float hatchPhase = coord.y - hatchSlope * coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    } else {\n        float hatchPhase = - coord.y / hatchSlope + coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    }\n    return fragColor;\n}\n#endif\n"},68643:e=>{e.exports="vec3 rgb2hsv(vec3 color)\n{\n    float delta;\n    float colorMax, colorMin;\n    float h,s,v;\n    vec3 hsv;\n    colorMax = max(color.r,color.g);\n    colorMax = max(colorMax,color.b);\n    colorMin = min(color.r,color.g);\n    colorMin = min(colorMin,color.b);\n    v = colorMax;\n    if(colorMax != 0.0)\n    {\n        s = (colorMax - colorMin)/colorMax;\n    }\n    else\n    {\n        s = 0.0;\n    }\n    if(s != 0.0)\n    {\n        delta = colorMax-colorMin;\n        if (color.r == colorMax)\n        {\n            h = (color.g-color.b)/delta;\n        }\n        else if (color.g == colorMax)\n        {\n            h = 2.0 + (color.b-color.r) / delta;\n        }\n        else\n        {\n            h = 4.0 + (color.r-color.g)/delta;\n        }\n        h /= 6.0;\n        if( h < 0.0)\n        {\n            h +=1.0;\n        }\n    }\n    else\n    {\n        h = 0.0;\n    }\n    hsv = vec3(h,s,v);\n    return hsv;\n}\nvec3 hsv2rgb(vec3 hsv)\n{\n    vec3 color;\n    float f,p,q,t;\n    float h,s,v;\n    float i,hi;\n    {\n        h = hsv.x*6.0;\n        s = hsv.y;\n        v = hsv.z;\n        i = floor(h);\n        f = h-i;\n        p = v * (1.0 - s);\n        q = v * (1.0 - (s * f));\n        t = v * (1.0 - (s * (1.0 - f)));\n        float r,g,b;\n        if (i == 0.0)\n        {\n            r = v;\n            g = t;\n            b = p;\n        }\n        else if (i == 1.0)\n        {\n            r = q;\n            g = v;\n            b = p;\n        }\n        else if (i == 2.0)\n        {\n            r = p;\n            g = v;\n            b = t;\n        }\n        else if (i == 3.0)\n        {\n            r = p;\n            g = q;\n            b = v;\n        }\n        else if (i == 4.0)\n        {\n            r = t;\n            g = p;\n            b = v;\n        }\n        else\n        {\n            r = v;\n            g = p;\n            b = q;\n        }\n        color = vec3(r,g,b);\n    }\n    return color;\n}"},74610:e=>{e.exports="#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)\n    varying highp float depth;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)\n    #ifdef USE_VERTEX_ID\n        varying vec3 vId;\n    #elif defined(LINE_2D_SHADER)\n        varying vec4 dbId;\n    #else\n        uniform vec3 dbId;\n    #endif\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\n    uniform vec3 modelId;\n#endif\n#if defined(MRT_NORMALS)\n    layout(location = 1) out vec4 outNormal;\n    #if defined(MRT_ID_BUFFER)\n        layout(location = 2) out vec4 outId;\n        #if defined(MODEL_COLOR)\n            layout(location = 3) out vec4 outModelId;\n        #endif\n    #endif\n#elif defined(MRT_ID_BUFFER)\n    layout(location = 1) out vec4 outId;\n    #if defined(MODEL_COLOR)\n        layout(location = 2) out vec4 outModelId;\n    #endif\n#endif"},7959:e=>{e.exports="#ifdef USE_VERTEX_ID\nattribute vec3 id;\nvarying   vec3 vId;\n#endif\n"},46223:e=>{e.exports="\n#if defined(USE_VERTEX_ID) && (defined(MRT_ID_BUFFER) || defined(ID_COLOR))\n    vec3 dbId = vId;\n#endif\n#ifdef MRT_ID_BUFFER\n    #ifndef ENABLE_ID_DISCARD\n        const float writeId = 1.0;\n    #endif\n    outId = vec4(dbId.rgb, writeId);\n    #ifdef MODEL_COLOR\n        outModelId = vec4(modelId.rgb, writeId);\n    #endif\n#elif defined(ID_COLOR)\n    #ifdef ENABLE_ID_DISCARD\n        if (writeId==0.0) {\n            discard;\n        }\n    #endif\n    gl_FragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n    #ifdef ENABLE_ID_DISCARD\n        if (writeId==0.0) {\n            discard;\n        }\n    #endif\n    gl_FragColor = vec4(modelId.rgb, 1.0);\n#endif\n"},61539:e=>{e.exports="\n#ifdef USE_VERTEX_ID\nvId = id;\n#endif\n"},21600:e=>{e.exports="#if defined( IMPORTANTSAMPLING )\n#define SAMPLECOUNT 32\nvec2 Hammersley(int index)\n{\n    float u = (float(index) + 0.5) / 32.0;\n    float v = 0.5;\n    float noise = texture2D(importantSamplingRandomMap, vec2(u, v), 0.0).r;\n   return vec2(2.0 * PI * float(index/SAMPLECOUNT), noise);\n}\nvec3 ImportanceSampleAnisotropicGGX(int index, vec2 alpha, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec2 uniformSample2D = Hammersley(index);\n    float coef = sqrt(uniformSample2D.y / (1.0 - uniformSample2D.y));\n    float sinSigma, cosSigma;\n    sinSigma = sin(uniformSample2D.x);\n    cosSigma = cos(uniformSample2D.x);\n    vec3 H = coef * ((alpha.x * cosSigma) * Tu + (alpha.y * sinSigma) * Tv) + N;\n    H = normalize(H);\n    return H;\n}\nfloat ComputePDF(vec2 alpha, float NdotH, float HdotTu, float HdotTv, float VdotH)\n{\n    float factor1 = HdotTu / alpha.x;\n    float factor2 = HdotTv / alpha.y;\n    float factor3 = factor1 * factor1 + factor2 * factor2 + NdotH * NdotH;\n    float factor = factor3 * factor3 * alpha.x * alpha.y * VdotH * 4.0 * PI;\n    if (factor > 0.0)\n    {\n        return (NdotH / factor);\n    }\n    else\n    {\n        return 0.0;\n    }\n}\n#define INVFACESIZE 0.0078125\nfloat DirectionToSolidAngle(vec3 dir)\n{\n    dir = abs(dir);\n    float first = min(dir.x, dir.y);\n    float temp = max(dir.x, dir.y);\n    float second = min(temp, dir.z);\n    float third = max(temp, dir.z);\n    first /= third;\n    second /= third;\n    float u = (first+1.0)/2.0;\n    float v = (second + 1.0) / 2.0;\n    float solidAngle = texture2D(importantSamplingSolidAngleMap, vec2(u, v), 0.0).r * 0.000255;\n    return solidAngle;\n}\nfloat Smith_GGX(float value)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + value));\n}\nvec2 RoughnessAnisotropyToAlpha(float roughness, float anisotropy)\n{\n    float aspect = sqrt(1.0 - 0.9 * anisotropy);\n    vec2 alpha = vec2(roughness * roughness / aspect, roughness * roughness * aspect);\n    return alpha;\n}\nvec3 ImportanceSamplingSpecular(float angle, vec3 reflectance, float roughness, float anisotropy, vec3 V, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec3 specular = vec3(0.0);\n    float radAngle;\n    if (anisotropy < 1e-10)\n    {\n        radAngle = 0.0;\n    }\n    else\n    {\n        radAngle = -PI * angle;\n    }\n    vec2 alpha = RoughnessAnisotropyToAlpha(roughness, anisotropy);\n    float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);\n    float NdotV = dot(N, V);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    vec2 sincosTheta;\n    sincosTheta.x = sin(radAngle);\n    sincosTheta.y = cos(radAngle);\n    vec3 Tu1, Tv1;\n    Tu1 = sincosTheta.y * Tu - sincosTheta.x * Tv;\n    Tv1 = sincosTheta.x * Tu + sincosTheta.y * Tv;\n    vec3 H;\n    vec3 sampleLightIntensity;\n    vec3 L;\n    float effectiveSample = 0.0;\n    for (int i = 0; i < SAMPLECOUNT; i++)\n    {\n        H = ImportanceSampleAnisotropicGGX(i, alpha, N, Tu1, Tv1);\n        float VdotH = dot(V, H);\n        L = 2.0 * VdotH * H - V;\n        float NdotH = dot(N, H);\n        float NdotL = dot(N, L);\n        if (NdotL >= 0.0 && NdotV > 0.0 && NdotH > 0.0)\n        {\n            float alpha2NL = aSqrd(alpha2, NdotL);\n            float HdotTu = dot(H, Tu1);\n            float HdotTv = dot(H, Tv1);\n            float pdf = ComputePDF(alpha, NdotH, HdotTu, HdotTv, VdotH);\n            float mipmapLevel = 0.0;\n            if (pdf > 0.0)\n            {\n                mipmapLevel = 0.3 * log2(1.0 / (float(SAMPLECOUNT) * pdf * DirectionToSolidAngle(L)));\n            }\n            mipmapLevel = clamp(mipmapLevel, 0.0, 4.0);\n            L = normalize(L);\n            sampleLightIntensity = sampleReflection(L, L, mipmapLevel).rgb;\n            float G = Smith_GGX(alpha2NL) * Smith_GGX(alpha2NV);\n            vec3 F = Fresnel_Schlick(reflectance, VdotH);\n            float factor = G * VdotH / (NdotH * NdotV);\n            if (factor >= 0.0)\n            {\n                specular += abs(sampleLightIntensity * F * factor);\n                effectiveSample += 1.0;\n            }\n        }\n    }\n    if (effectiveSample > 0.0)\n    {\n        specular /= effectiveSample;\n    }\n    return specular;\n}\n#endif"},58121:e=>{e.exports="\n#ifdef USE_INSTANCING\nattribute vec3 instOffset;\nattribute vec4 instRotation;\nattribute vec3 instScaling;\nvec3 applyQuaternion(vec3 p, vec4 q) {\n    return p + 2.0 * cross(q.xyz, cross(q.xyz, p) + q.w * p);\n}\nvec3 getInstancePos(vec3 pos) {\n    return instOffset + applyQuaternion(instScaling * pos, instRotation);\n}\nvec3 getInstanceNormal(vec3 normal) {\n    return applyQuaternion(normal/instScaling, instRotation);\n}\n#else\nvec3 getInstancePos(vec3 pos)       { return pos;    }\nvec3 getInstanceNormal(vec3 normal) { return normal; }\n#endif\n"},81456:e=>{e.exports="\n#define LINE_2D_SHADER 1\n#define TAU     6.28318530718\n#define PI      3.14159265358979\n#define HALF_PI 1.57079632679\n#define PI_0_5  HALF_PI\n#define PI_1_5  4.71238898038\n#define ENABLE_ID_DISCARD\n#define VBB_GT_TRIANGLE_INDEXED  0.0\n#define VBB_GT_LINE_SEGMENT      1.0\n#define VBB_GT_ARC_CIRCULAR      2.0\n#define VBB_GT_ARC_ELLIPTICAL    3.0\n#define VBB_GT_TEX_QUAD          4.0\n#define VBB_GT_ONE_TRIANGLE      5.0\n#define VBB_GT_MSDF_TRIANGLE_INDEXED 6.0\n#define VBB_GT_LINE_SEGMENT_CAPPED 8.0\n#define VBB_GT_LINE_SEGMENT_CAPPED_START 9.0\n#define VBB_GT_LINE_SEGMENT_CAPPED_END 10.0\n#define VBB_GT_LINE_SEGMENT_MITER 11.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  0.0\n#define VBB_SEG_START_LEFT   1.0\n#define VBB_SEG_END_RIGHT    2.0\n#define VBB_SEG_END_LEFT     3.0\n#define LTSCALE 0.25\nvarying vec4 fsColor;\nvarying vec2 fsOffsetDirection;\nvarying vec4 fsMultipurpose;\nvarying float fsHalfWidth;\nvarying vec2 fsVpTC;\nvarying float fsGhosting;\n#ifdef LOADING_ANIMATION\nvarying float loadingProgress;\n#endif\n"},96654:e=>{e.exports="\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n#ifdef POLYGON_OFFSET\n    uniform vec2 polygonOffset;\n    const float epsilon7 = 0.0000001;\n#endif\n    uniform float logDepthBufFC;\n    varying float vFragDepth;\n    varying float vIsPerspective;\n#endif"},19719:e=>{e.exports="\n#ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n        varying float vFragDepth;\n        varying float vIsPerspective;\n    #else\n        uniform float logDepthBufFC;\n    #endif\n    bool isPerspectiveMatrix( mat4 m ) {\n        return m[ 2 ][ 3 ] == - 1.0;\n    }\n#endif"},86386:e=>{e.exports="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    float logz_depth = vFragDepth;\n#ifdef POLYGON_OFFSET\n    float factor = polygonOffset[0];\n    float units = polygonOffset[1];\n#if __VERSION__ == 300 \n    if (factor != 0.0) {\n        float x = dFdx(logz_depth);\n        float y = dFdy(logz_depth);\n        float dz = sqrt(x * x + y * y);\n        logz_depth += dz * factor;\n    }\n#endif\n#endif\n    gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( logz_depth ) * logDepthBufFC * 0.5;\n#endif"},75603:e=>{e.exports="#ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n        vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n    #else\n        if ( isPerspectiveMatrix( projectionMatrix ) ) {\n            gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n            gl_Position.z *= gl_Position.w;\n        }\n    #endif\n#endif"},14227:e=>{e.exports="#if defined(USE_SURFACE_NORMAL_MAP) || defined( USE_LAYERED_NORMAL_MAP ) || defined( USE_TILING_NORMAL )\nvoid heightMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    mat3 mtxTangent = mat3(T, B, N);\n    T = normalize(mtxTangent * (transform * vec3(1.0, 0.0, 0.0)));\n    B = normalize(mtxTangent * (transform * vec3(0.0, 1.0, 0.0)));\n    const float oneThird = 1.0 / 3.0;\n    vec3 avg = vec3(oneThird, oneThird, oneThird);\n    vec2 offset = fwidth(st);\n    float h0 = dot(texture2D(bumpTexture, st).xyz, avg);\n    float hx = dot(texture2D(bumpTexture, st + vec2(offset.x, 0.0)).xyz, avg);\n    float hy = dot(texture2D(bumpTexture, st + vec2(0.0, offset.y)).xyz, avg);\n    vec2 diff = vec2(h0 - hx, h0 - hy) / offset;\n    N = normalize(\n        N + (\n            diff.x * T * bumpScale.x +\n            diff.y * B * bumpScale.y\n        )\n    );\n}\nvoid normalMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    vec3 mapN =  2.0 * texture2D(bumpTexture, st).xyz - 1.0;\n    mapN.xy *= bumpScale.x;\n    mapN.z *= bumpScale.y;\n    vec3 v = vec3(mapN.y, -mapN.x, 0.0);\n    float c = -mapN.z;\n    mat3 skewV = mat3(\n        0.0, v.z, -v.y,\n        -v.z, 0.0, v.x,\n        v.y, -v.x, 0.0\n    );\n    mat3 rot = mat3(1.0) + skewV + skewV*skewV * 1.0/(1.0-c);\n    N *= rot;\n    T *= rot;\n    B *= rot;\n}\n#endif\n"},52035:e=>{e.exports="vec3 orderedDithering(vec3 col) {\n    const vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\n    const vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\n    const vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\n    const vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\n    int i = int(gl_FragCoord.x) & 3;\n    int j = int(gl_FragCoord.y) & 3;\n    vec4 biasRow;\n    if      (i==0) biasRow = m0;\n    else if (i==1) biasRow = m1;\n    else if (i==2) biasRow = m2;\n    else           biasRow = m3;\n    float bias;\n    if      (j==0) bias = biasRow.x;\n    else if (j==1) bias = biasRow.y;\n    else if (j==2) bias = biasRow.z;\n    else           bias = biasRow.w;\n    return col + bias * (1.0 / (17.0 * 256.0));\n}\n"},23300:e=>{e.exports="\nvec4 packDepth( const in float depth ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n"},15931:e=>{e.exports="\n#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n) {\n    return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc) {\n    vec2 ang = enc * 2.0 - 1.0;\n    vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\n    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n"},26649:e=>{e.exports="gl_PointSize = point_size;"},58998:e=>{e.exports="\nvec3 TransmitAdjust(vec3 transmission, vec3 f0) \n{ \n   vec3 limit = max(1.0 - f0, 0.00001); \n   return clamp(transmission, vec3(0.0, 0.0, 0.0), limit) / limit; \n} \nfloat ColorToIlluminance(in vec3 color) \n{ \n   const vec3 rgb2grey = vec3(0.299, 0.587, 0.114); \n   float illuminance = dot(rgb2grey, color); \n   return illuminance; \n} \nvoid applyPrismGlazingOpacity(\n    inout vec4 color,\n    vec3 transmissionF,\n    float transmissionAlpha,\n    float NdotV,\n    float glazingIlluminace) \n{\n    const float third = 1.0/3.0; \n    float transSurface = exp(-(transmissionAlpha + (transmissionAlpha < 0.0025 ? 0.0 : 0.25)) * NdotV * PI); \n    float opacity = 1.0- dot((1.0 - transmissionF), vec3(third,third,third)) * transSurface * glazingIlluminace; \n    opacity = clamp(opacity, 0.01, 0.99);\n    color.a *= opacity;\n} \n"},72438:e=>{e.exports="void applyPrismTransparency(\n    inout vec4 color,\n    vec3 transparentColor,\n    float transparentIor\n) {\n    float fsLevel = max(max(color.r, color.g), color.b);\n    color = vec4(color.rgb/fsLevel, fsLevel);\n    float transLevel = min(min(transparentColor.r, transparentColor.g), transparentColor.b);\n    transLevel = min( (1.0 - surface_roughness), transLevel );\n    float transAlpha = (1.0 - transLevel) * 0.4 + surface_roughness * 0.55;\n    vec3 tr_g_color = sqrt(transparentColor);\n    vec4 transColor = vec4(0.5 * vec3(tr_g_color), transAlpha);\n    float strength = 1.0 - (1.0 - fsLevel) * (1.0 - fsLevel);\n    color = mix(transColor, color, strength);\n    color.a = max(color.a, 0.05);\n    if (transparentIor == 1.0 && tr_g_color == vec3(1.0)) {\n        color.a = 0.0;\n    }\n}"},65355:e=>{e.exports="#if defined( PRISMWOOD )\n#define ONE 0.00390625\nfloat GetIndexedValue(vec4 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else if (index == 2)\n        return array[2];\n    else if (index == 3)\n        return array[3];\n    else\n        return 0.0;\n}\nint GetIndexedValue(ivec2 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else\n        return 0;\n}\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nfloat SampleCurlyPattern(vec2 uv)\n{\n    vec2 uv_wood_curly_distortion_map = (wood_curly_distortion_map_texMatrix * vec3(uv, 1.0)).xy;\n    WOOD_CURLY_DISTORTION_CLAMP_TEST;\n    vec3 curlyDistortion = texture2D(wood_curly_distortion_map, uv_wood_curly_distortion_map).xyz;\n    if(wood_curly_distortion_map_invert) curlyDistortion = vec3(1.0) - curlyDistortion;\n    return curlyDistortion.r;\n}\nvec3 DistortCurly(vec3 p)\n{\n    if (!wood_curly_distortion_enable) return p;\n    float r = length(p.xy);\n    if (r < 0.00001) return p;\n    const float INV_ANGLE_INTERVAL = 1.27323954;\n    const float NUM_INTERVAL = 8.0;\n    float theta = atan(p.y, p.x);\n    if (theta < 0.0)\n        theta += PI2;\n    float intIdx = theta * INV_ANGLE_INTERVAL;\n    int idx0 = int(mod(floor(intIdx), NUM_INTERVAL));\n    int idx1 = int(mod(ceil(intIdx), NUM_INTERVAL));\n    const vec4 HASH_TABLE1 = vec4(0.450572,0.114598, 0.886043, 0.315119);\n    const vec4 HASH_TABLE2 = vec4(0.216133,0.306264, 0.685616, 0.317907);\n    float offset0 = idx0 < 4 ? GetIndexedValue(HASH_TABLE1, idx0) : GetIndexedValue(HASH_TABLE2, idx0-4);\n    float offset1 = idx1 < 4 ? GetIndexedValue(HASH_TABLE1, idx1) : GetIndexedValue(HASH_TABLE2, idx1-4);\n    const float maxOffset = 100.0;\n    offset0 = (offset0 - 0.5) * maxOffset;\n    offset1 = (offset1 - 0.5) * maxOffset;\n    vec2 uv0 = vec2(p.z + offset0, r);\n    float shiftWeight0 =  SampleCurlyPattern(uv0);\n    vec2 uv1 = vec2(p.z + offset1, r);\n    float shiftWeight1 =  SampleCurlyPattern(uv1);\n    float interpWeight = fract(intIdx);\n    float shiftWeight = mix(shiftWeight0, shiftWeight1, interpWeight);\n    const float INV_MIN_RADIUS = 2.0;\n    float shiftWeightAdjust = smoothstep(0.0, 1.0, r * INV_MIN_RADIUS);\n    r -= wood_curly_distortion_scale * (shiftWeight * shiftWeightAdjust);\n    float thetaNew = atan(p.y, p.x);\n    vec3 pNew = p;\n    pNew.x = r * cos(thetaNew);\n    pNew.y = r * sin(thetaNew);\n    return pNew;\n}\n#endif\nvec3 un2sn(vec3 range)\n{\n    return range * 2.0 - 1.0;\n}\nfloat inoise(vec3 p)\n{\n    vec3 modp = mod(floor(p), 256.0);\n    modp.xy = modp.xy * ONE;\n    vec4 AA = texture2D(perm2DMap, vec2(modp.x, modp.y), 0.0) * 255.0;\n    AA = AA + modp.z;\n    AA = mod(floor(AA), 256.0);\n    AA *= ONE;\n    vec3 gradx1 = un2sn(texture2D(permGradMap,vec2(AA.x,0.0),0.0).xyz);\n    vec3 grady1 = un2sn(texture2D(permGradMap,vec2(AA.y,0.0),0.0).xyz);\n    vec3 gradz1 = un2sn(texture2D(permGradMap,vec2(AA.z,0.0),0.0).xyz);\n    vec3 gradw1 = un2sn(texture2D(permGradMap,vec2(AA.w,0.0),0.0).xyz);\n    vec3 gradx2 = un2sn(texture2D(permGradMap,vec2(AA.x + ONE,0.0),0.0).xyz);\n    vec3 grady2 = un2sn(texture2D(permGradMap,vec2(AA.y + ONE,0.0),0.0).xyz);\n    vec3 gradz2 = un2sn(texture2D(permGradMap,vec2(AA.z + ONE,0.0),0.0).xyz);\n    vec3 gradw2 = un2sn(texture2D(permGradMap,vec2(AA.w + ONE,0.0),0.0).xyz);\n    p -= floor(p);\n    vec3 fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix( mix( mix( dot(gradx1, p ),\n                          dot(gradz1, p + vec3(-1.0, 0.0, 0.0)), fadep.x),\n                     mix( dot(grady1, p + vec3(0.0, -1.0, 0.0)),\n                          dot(gradw1, p + vec3(-1.0, -1.0, 0.0)), fadep.x), fadep.y),\n                mix( mix( dot(gradx2, p + vec3(0.0, 0.0, -1.0)),\n                          dot(gradz2, p + vec3(-1.0, 0.0, -1.0)), fadep.x),\n                     mix( dot(grady2, p + vec3(0.0, -1.0, -1.0)),\n                          dot(gradw2, p + vec3(-1.0, -1.0, -1.0)), fadep.x), fadep.y), fadep.z);\n}\nfloat inoise(float p)\n{\n    float modp = mod(floor(p), 256.0);\n    modp = (modp + 256.0) * ONE;\n    float permx = texture2D(permutationMap, vec2(modp, 0.0), 0.0).r;\n    float gradx = texture2D(gradientMap, vec2(permx, 0.0), 0.0).r*2.0-1.0;\n    float permy = texture2D(permutationMap, vec2(modp + ONE, 0.0), 0.0).r;\n    float grady = texture2D(gradientMap, vec2(permy, 0.0), 0.0).r*2.0-1.0;\n    p -= floor(p);\n    float fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix(gradx * p, grady * (p - 1.0), fadep);\n}\nfloat multiband_inoise(vec3 p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nfloat multiband_inoise(float p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nvec3 Distort3DCosineRadialDir(vec3 p)\n{\n    float radius = length(p.xy);\n    if (radius < 0.00001) return p;\n    vec2 theta = p.xy / radius;\n    float radiusShift = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= wood_fiber_cosine_bands) break;\n        radiusShift += GetIndexedValue(wood_fiber_cosine_weights, i) * cos(p.z * RECIPROCAL_PI2 * GetIndexedValue(wood_fiber_cosine_frequencies, i));\n    }\n    const float MIN_RADIUS = 1.5;\n    float weight = clamp(radius / MIN_RADIUS, 0.0, 1.0);\n    if(weight >= 0.5)\n        weight = weight * weight * (3.0 - (weight + weight));\n    p.xy += theta * radiusShift * weight;\n    return p;\n}\nvec3 Distort3DPerlin(vec3 p)\n{\n    vec3 pAniso = vec3(p.xy, p.z * wood_fiber_perlin_scale_z);\n    p.xy += multiband_inoise(pAniso, wood_fiber_perlin_bands, wood_fiber_perlin_weights, wood_fiber_perlin_frequencies);\n    return p;\n}\nvec3 Distort(vec3 p)\n{\n    if(wood_fiber_cosine_enable)\n        p = Distort3DCosineRadialDir(p);\n    if(wood_fiber_perlin_enable)\n        p = Distort3DPerlin(p);\n    return p;\n}\nfloat DistortRadiusLength(float radiusLength)\n{\n    radiusLength += multiband_inoise(radiusLength, wood_growth_perlin_bands, wood_growth_perlin_weights, wood_growth_perlin_frequencies);\n    if (radiusLength < 0.0) radiusLength = 0.0;\n    return radiusLength;\n}\nfloat ComputeEarlyWoodRatio(float radiusLength)\n{\n    float fraction = mod(radiusLength, wood_ring_thickness) / wood_ring_thickness;\n    if (fraction <= wood_ring_fraction.y)\n       return 1.0;\n    else if(fraction <= wood_ring_fraction.x)\n       return (1.0 - (fraction - wood_ring_fraction.y) / wood_fall_rise.x);\n    else if(fraction <= wood_ring_fraction.w)\n       return 0.0;\n    else\n       return ((fraction - wood_ring_fraction.w) / wood_fall_rise.y);\n}\nvec3 DistortEarlyColor(vec3 earlyColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_earlycolor_perlin_bands,wood_earlycolor_perlin_weights,wood_earlycolor_perlin_frequencies);\n    earlyColor = pow(abs(earlyColor), vec3(expValue));\n    return earlyColor;\n}\nvec3 DistortLateColor(vec3 lateColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_latecolor_perlin_bands,wood_latecolor_perlin_weights,wood_latecolor_perlin_frequencies);\n    lateColor = pow(abs(lateColor), vec3(expValue));\n    return lateColor;\n}\nvec3 DistortDiffuseColor(vec3 diffAlbedo, vec3 p)\n{\n    p.z *= wood_diffuse_perlin_scale_z;\n    float expValue = 1.0 + multiband_inoise(p, wood_diffuse_perlin_bands, wood_diffuse_perlin_weights, wood_diffuse_perlin_frequencies);\n    diffAlbedo = pow(abs(diffAlbedo), vec3(expValue));\n    return diffAlbedo;\n}\nfloat LayerRoughnessVar(float roughness, float earlyWoodRatio)\n{\n    return earlyWoodRatio * wood_groove_roughness + (1.0 - earlyWoodRatio) * roughness;\n}\nfloat hashword(vec2 k)\n{\n    k = mod(k, vec2(256.0)) * ONE;\n    float a = texture2D(permutationMap, vec2(k.x, 0.0)).x + k.y ;\n    a = texture2D(permutationMap, vec2(a, 0.0)).x ;\n    return a*255.0;\n}\nfloat wyvillsq(float rsq)\n{\n    if (rsq >= 1.0) return 0.0;\n    float tmp = 1.0 - rsq;\n    return tmp*tmp*tmp;\n}\nfloat Weight2DNeighborImpulses(vec3 p, float woodWeight)\n{\n    if(woodWeight <= 0.0) return 0.0;\n    float poreRadius = wood_pore_radius * woodWeight;\n    vec2 left = floor((p.xy - poreRadius) / wood_pore_cell_dim);\n    vec2 right = floor((p.xy + poreRadius) / wood_pore_cell_dim);\n    float weight = 0.0;\n    float invRsq = 1.0 / (poreRadius * poreRadius);\n    const float norm =  1.0 / 15.0;\n    for (int j = 0; j <= 4; j++)\n    {\n        if (j > int(right.y - left.y)) continue;\n        for (int i = 0; i <= 4; i++)\n        {\n            if (i > int(right.x - left.x)) continue;\n            vec2 pij = vec2(float(i) + left.x,float(j) + left.y);\n            float hRNum = hashword(pij);\n            float impPosX = mod(hRNum, 16.0) * norm;\n            float impPosY = floor(hRNum / 16.0) * norm;\n            impPosX = (pij.x + impPosX)* wood_pore_cell_dim;\n            impPosY = (pij.y + impPosY)* wood_pore_cell_dim;\n            float dsq = (p.x - impPosX) * (p.x - impPosX) + (p.y - impPosY) * (p.y - impPosY);\n            weight += wyvillsq(dsq * invRsq);\n        }\n    }\n    return weight;\n}\nfloat Weight3DRayImpulses(vec3 p)\n{\n    int segIdx = int(floor(p.z / wood_ray_seg_length_z));\n    float factor = p.z / wood_ray_seg_length_z - float(segIdx);\n    int segIdx1 = segIdx - 1;\n    if ( factor > 0.5 )\n        segIdx1 = segIdx + 1;\n    float theta = atan(p.y, p.x);\n    float sliceIdx = floor(((theta + PI) * RECIPROCAL_PI2) * wood_ray_num_slices);\n    if ( sliceIdx == wood_ray_num_slices)\n        sliceIdx-=1.0;\n    ivec2 arrSegs = ivec2(segIdx, segIdx1);\n    float weight = 0.0;\n    const float norm =  1.0 / 15.0;\n    float radialOffset = 5.0;\n    float radialLength = length(p.xy);\n    for (int seg = 0; seg < 2; seg++)\n    {\n        float hRNum = hashword(vec2(sliceIdx, GetIndexedValue(arrSegs, seg)));\n        float rn1 = mod(hRNum,16.0) * norm;\n        if (radialLength < radialOffset * rn1)\n            continue;\n        float rayTheta = rn1;\n        rayTheta = ( ( sliceIdx + rayTheta ) / wood_ray_num_slices ) * ( 2.0 * PI ) - PI;\n        float rayPosZ = (hRNum/16.0)* norm;\n        rayPosZ = ( float(GetIndexedValue(arrSegs, seg)) + rayPosZ ) * wood_ray_seg_length_z;\n        vec3 pt1 = vec3(0.0);\n        vec3 pt2 = vec3(cos(rayTheta), sin(rayTheta), 0.0);\n        vec3 p1 = p;\n        p1.z -= rayPosZ;\n        p1.z /=  wood_ray_ellipse_z2x;\n        vec3 v1 = pt2 - pt1;\n        vec3 v2 = pt1 - p1;\n        v2 = cross(v1, v2);\n        float dist = length(v2) / length(v1);\n        float invRsq = 1.0 / ( wood_ray_ellipse_radius_x * wood_ray_ellipse_radius_x);\n        weight += wyvillsq( (dist * dist) * invRsq );\n    }\n    return weight;\n}\nvec3 DarkenColorWithPores(vec3 p, vec3 diffColor, float woodWeight)\n{\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float a = wood_pore_color_power - 1.0;\n    float b = 1.0;\n    float y = a * poresWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nvec3 DarkenColorWithRays(vec3 p, vec3 diffColor)\n{\n    float raysWeight = Weight3DRayImpulses(p);\n    float a = wood_ray_color_power - 1.0;\n    float b = 1.0;\n    float y = a * raysWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nfloat ComputeWoodWeight(float earlyWoodRatio)\n{\n    float woodWeight = 0.0;\n    if (wood_pore_type == 0)\n        woodWeight = 1.0;\n    else if (wood_pore_type == 1)\n        woodWeight = earlyWoodRatio;\n    else if (wood_pore_type == 2)\n        woodWeight = 1.0 - earlyWoodRatio;\n    else\n        woodWeight = -1.0;\n    return woodWeight;\n}\n#if defined( PRISMWOODBUMP )\nfloat ComputeEarlyWoodRatioAA(float radiusLength, float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    float samplesf = clamp(4.0 / transPixels, 1.0, 4.0);\n    int samples = int(samplesf);\n    float inverseSamples = 1.0 / float(samples);\n    vec2 rdelta = vec2(dFdx(radiusLength), dFdy(radiusLength)) * inverseSamples;\n    float earlywoodRatio = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= samples) break;\n        for (int j = 0; j < 4; ++j)\n        {\n            if (j >= samples) break;\n            float r = radiusLength + dot(vec2(i, j), rdelta);\n            earlywoodRatio += ComputeEarlyWoodRatio(r);\n        }\n    }\n    return earlywoodRatio * (inverseSamples * inverseSamples);\n}\nfloat LatewoodDepthVariation(float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    return clamp(transPixels * 0.5, 0.0, 1.0);\n}\nfloat LatewoodHeightVariation(float earlyWoodRatio, float latewoodBumpDepth,\n                              float depthVar)\n{\n    return ( 1.0 - earlyWoodRatio ) * latewoodBumpDepth * depthVar;\n}\nfloat PoreDepthVariation(float woodWeight, float invUnitExt)\n{\n    float porePixels = woodWeight * wood_pore_radius * invUnitExt;\n    return clamp(porePixels, 0.0, 1.0);\n}\nfloat PoreHeightVariation(float earlyWoodRatio, float poresWeight, float poreDepth,\n                          float depthVar)\n{\n    return poresWeight * (-1.0 * poreDepth) * depthVar;\n}\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\nvec3 WoodBumpHeight(float heightLeft, float heightRight, float heightBack, float heightFront)\n{\n    const float epsilon = 0.001;\n    float heightDeltaX = heightRight - heightLeft;\n    vec3 Tu = vec3(2.0 * epsilon, 0.0, heightDeltaX);\n    float heightDeltaY = heightFront - heightBack;\n    vec3 Tv = vec3(0.0, 2.0 * epsilon, heightDeltaY);\n    return cross(Tu, Tv);\n}\nvec3 SelectNormal(vec3 N, vec3 bumpN, vec3 V)\n{\n    float bumpNdotV = dot(bumpN, V);\n    if(bumpNdotV > 0.0)\n        return bumpN;\n    else return N;\n}\nfloat MinInverseUnitExtent(vec3 p)\n{\n    return 1.0 / max(max(length(dFdx(p.xy)), length(dFdy(p.xy))), 0.000001);\n}\nfloat HeightVariation(vec3 pos)\n{\n    vec3 p = Distort(pos);\n    float radiusLength = length(p.xy);\n    if (wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n    float invUnitExt = MinInverseUnitExtent(p);\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n    float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float depthVar = PoreDepthVariation(woodWeight, invUnitExt);\n    float poreHeightVariation = -1.0 * poresWeight * wood_pore_depth * depthVar;\n    float latewoodHeightVariation = 0.0;\n    if (wood_use_latewood_bump)\n    {\n        float latewoodDepthVar = LatewoodDepthVariation(invUnitExt);\n        latewoodHeightVariation = (1.0 - earlyWoodRatio) * wood_latewood_bump_depth * latewoodDepthVar;\n    }\n    float sumHeightVariation = poreHeightVariation + latewoodHeightVariation;\n    return sumHeightVariation;\n}\n#endif\nvec3 NoiseWood(vec3 p, inout float roughness)\n{\n    p = Distort(p);\n    float radiusLength = length(p.xy);\n    if(wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n#if defined( PRISMWOODBUMP )\n    float invUnitExt = MinInverseUnitExtent( p );\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n#else\n    float earlyWoodRatio = ComputeEarlyWoodRatio(radiusLength);\n#endif\n    vec3 earlyColor = wood_early_color;\n    if (wood_earlycolor_perlin_enable)\n        earlyColor = DistortEarlyColor(earlyColor, radiusLength);\n    vec3 lateColor;\n    if (wood_use_manual_late_color)\n        lateColor = wood_manual_late_color;\n    else\n        lateColor = pow(abs(earlyColor), vec3(wood_late_color_power));\n    if(wood_latecolor_perlin_enable)\n        lateColor = DistortLateColor(lateColor, radiusLength);\n    vec3 diffAlbedo = earlyWoodRatio * earlyColor + (1.0 - earlyWoodRatio) * lateColor;\n    if(wood_diffuse_perlin_enable)\n        diffAlbedo = DistortDiffuseColor(diffAlbedo, p);\n    if (wood_use_pores)\n    {\n        float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n        diffAlbedo = DarkenColorWithPores(p, diffAlbedo, woodWeight);\n    }\n    if (wood_use_rays)\n        diffAlbedo = DarkenColorWithRays(p, diffAlbedo);\n    if(wood_use_groove_roughness)\n        roughness = LayerRoughnessVar(roughness, earlyWoodRatio);\n    return clamp(diffAlbedo, vec3(0.0), vec3(1.0));\n}\n#if defined(PRISMWOODBUMP)\nvoid getFinalWoodContext(\n    inout vec3 N, vec3 V, inout vec3 Tu, inout vec3 Tv, vec3 p,\n    vec3 geoNormal, vec3 tNormal, mat3 normalMatrix\n) {\n    vec3 offsetTuLeft = p - 0.001 * Tu;\n    vec3 offsetTuRight = p + 0.001 * Tu;\n    vec3 offsetTvLeft = p - 0.001 * Tv;\n    vec3 offsetTvRight = p + 0.001 * Tv;\n    float heightVariationTuLeft = HeightVariation(offsetTuLeft);\n    float heightVariationTuRight = HeightVariation(offsetTuRight);\n    float heightVariationTvLeft = HeightVariation(offsetTvLeft);\n    float heightVariationTvRight = HeightVariation(offsetTvRight);\n    vec3 bumpHeight = WoodBumpHeight(heightVariationTuLeft, heightVariationTuRight, heightVariationTvLeft, heightVariationTvRight);\n    vec3 newNormal = normalize(bumpHeight.x * Tu + bumpHeight.y * Tv + bumpHeight.z * vtNormal);\n    vec3 newNormalView = normalize(vNormalMatrix * newNormal);\n    vec3 selectedNormal = SelectNormal(geoNormal, newNormalView, V);\n    ComputeTangents(selectedNormal, Tu, Tv);\n    Tu = normalize(Tu);\n    Tv = normalize(Tv);\n    N = faceforward(selectedNormal, -V, selectedNormal);\n}\n#endif\n#endif\n"},4949:e=>{e.exports="\nuniform float shadowESMConstant;\nuniform float shadowMapRangeMin;\nuniform float shadowMapRangeSize;\n"},65080:e=>{e.exports="\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap;\nuniform vec2      shadowMapSize;\nuniform float     shadowDarkness;\nuniform float     shadowBias;\nuniform vec3      shadowLightDir;\nvarying vec4 vShadowCoord;\n#include <shadowmap_decl_common>\nfloat getShadowValue() {\n    float fDepth;\n    vec3 shadowColor = vec3( 1.0 );\n    vec3 shadowCoord = vShadowCoord.xyz / vShadowCoord.w;\n    shadowCoord.xyz = 0.5 * (shadowCoord.xyz + vec3(1.0, 1.0, 1.0));\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n    bool inFrustum = all( inFrustumVec );\n    float shadowValue = 1.0;\n    if (inFrustum) {\n        shadowCoord.z = min(0.999, shadowCoord.z);\n        shadowCoord.z -= shadowBias;\n#ifdef USE_HARD_SHADOWS\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float fDepth = rgbaDepth.r;\n        if ( fDepth < shadowCoord.z ) {\n            shadowValue = 1.0 - shadowDarkness;\n        }\n#else\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float shadowMapValue = rgbaDepth.r;\n        shadowValue = exp(-shadowESMConstant * shadowCoord.z) * shadowMapValue;\n        shadowValue = min(shadowValue, 1.0);\n        shadowValue = mix(1.0 - shadowDarkness, 1.0, shadowValue);\n#endif\n    }\n    return shadowValue;\n}\n#else\nfloat getShadowValue() { return 1.0; }\n#endif\nvec3 applyEnvShadow(vec3 colorWithoutShadow, vec3 worldNormal) {\n#if defined(USE_SHADOWMAP)\n    float dp  = dot(shadowLightDir, worldNormal);\n    float dpValue = (dp + 1.0) / 2.0;\n    dpValue = min(1.0, dpValue * 1.5);\n    float sv = getShadowValue();\n    vec3 result = colorWithoutShadow * min(sv, dpValue);\n    return result;\n#else\n    return colorWithoutShadow;\n#endif\n}\n"},11458:e=>{e.exports="\n#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord;\nuniform mat4 shadowMatrix;\n#endif\n"},36238:e=>{e.exports="\n#ifdef USE_SHADOWMAP\n{\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vShadowCoord = shadowMatrix * worldPosition;\n}\n#endif\n"},94005:e=>{e.exports="uniform vec4 themingColor;\n"},25759:e=>{e.exports="gl_FragColor.rgb = mix(gl_FragColor.rgb, themingColor.rgb, themingColor.a);\n"},73985:e=>{e.exports="\nfloat luminance_post(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\n    return dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\n    vec3 R = vec3( 3.240479, -1.537150, -0.498535);\n    vec3 G = vec3(-0.969256,  1.875992,  0.041556);\n    vec3 B = vec3( 0.055648, -0.204043,  1.057311);\n    vec3 rgb;\n    rgb.b = dot(xyz, B);\n    rgb.g = dot(xyz, G);\n    rgb.r = dot(xyz, R);\n    return rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\n    vec3 X = vec3(0.412453, 0.35758, 0.180423);\n    vec3 Y = vec3(0.212671, 0.71516, 0.0721688);\n    vec3 Z = vec3(0.0193338, 0.119194, 0.950227);\n    vec3 xyz;\n    xyz.x = dot(rgb, X);\n    xyz.y = dot(rgb, Y);\n    xyz.z = dot(rgb, Z);\n    return xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\n    float sum = xyz.x + xyz.y + xyz.z;\n    sum = 1.0 / sum;\n    vec3 xyY;\n    xyY.z = xyz.y;\n    xyY.x = xyz.x * sum;\n    xyY.y = xyz.y * sum;\n    return xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\n    float x = xyY.x;\n    float y = xyY.y;\n    float Y = xyY.z;\n    vec3 xyz;\n    xyz.y = Y;\n    xyz.x = x * (Y / y);\n    xyz.z = (1.0 - x - y) * (Y / y);\n    return xyz;\n}\nfloat toneMapCanon_T(float x)\n{\n    float xpow = pow(x, 1.60525727);\n    float tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);\n    return clamp(tmp, 0.0, 1.0);\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\n    x *= Shift;\n    const float A = 0.2;\n    const float B = 0.34;\n    const float C = 0.002;\n    const float D = 1.68;\n    const float E = 0.0005;\n    const float F = 0.252;\n    const float scale = 1.0/0.833837;\n    return (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\n    x *= Shift;\n    const float A = 0.27;\n    const float B = 0.29;\n    const float C = 0.052;\n    const float D = 0.2;\n    const float F = 0.18;\n    const float scale = 1.0/0.897105;\n    return (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}\nvec3 toneMapCanonOGS_WithGamma_WithColorPerserving(vec3 x) {\n    vec3 outColor = x.rgb;\n    outColor = min(outColor, vec3(3.0));\n    float inLum = luminance_pre(outColor);\n    if (inLum > 0.0) {\n        float outLum = toneMapCanon_T(inLum);\n        outColor = outColor * (outLum / inLum);\n        outColor = clamp(outColor, vec3(0.0), vec3(1.0));\n    }\n    float gamma = 1.0/2.2;\n    outColor = pow(outColor, vec3(gamma));\n    return outColor;\n}\n"},13458:e=>{e.exports="\n#ifdef WIDE_LINES\nattribute vec3 prev;\nattribute vec3 next;\nattribute float side;\nuniform vec2 view_size;\nvec2 to2d(vec4 i) {\n  return i.xy / i.w;\n}\n#endif\n"},16017:e=>{e.exports="\n#ifdef WIDE_LINES\nvec4 mvpPosition = projectionMatrix * mvPosition; \nmat3 vectorMatrix = mat3(modelViewMatrix);\nvec2 _pos = to2d(mvpPosition) * view_size;\nvec2 _prev = to2d(projectionMatrix * vec4(mvPosition.xyz + vectorMatrix * (prev * 0.01), 1.0)) * view_size;\nvec2 _next = to2d(projectionMatrix * vec4(mvPosition.xyz - vectorMatrix * (next * 0.01), 1.0)) * view_size;\nvec2 dir1 = _pos - _next;\nvec2 dir2 = _prev - _pos;\ndir2 = (length(dir2) > 0.0000001) ? normalize(dir2) : vec2(0.0, 0.0);\ndir1 = (length(dir1) > 0.0000001) ? normalize(dir1) : dir2;\nvec2 dir_sharp = normalize(dir1 + dir2);\nvec2 dir = normalize(dir1 + dir_sharp);\nvec2 offset = vec2(-dir.y, dir.x);\nfloat len = 1.0 / cross(vec3(offset, 0), vec3(dir1, 0)).z;\noffset *= len;\noffset /= view_size;\noffset *= side;\noffset *= mvpPosition.w;\nmvpPosition.xy += offset;\ngl_Position = mvpPosition;\n#endif\n"},2867:e=>{e.exports="varying vec3 vColor;\nvarying vec2 vUv;\nuniform samplerCube envMap;\nuniform vec3 uCamDir;\nuniform vec3 uCamUp;\nuniform vec2 uResolution;\nuniform float uHalfFovTan;\nuniform float opacity;\nuniform bool envMapBackground;\n#ifdef USE_BACKGROUND_TEXTURE\nuniform sampler2D backgroundTexture;\n#endif\n#include <env_sample>\nconst int bloomRange = 4;\n#include <ordered_dither>\nuniform float envMapExposure;\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include <tonemap>\n#endif\nvec3 rayDir(in vec2 vUv) {\n    vec3 A = (uResolution.x/uResolution.y)*normalize(cross(uCamDir,uCamUp)) * (uHalfFovTan * 2.0);\n    vec3 B = normalize(uCamUp) * (uHalfFovTan * 2.0);\n    vec3 C = normalize(uCamDir);\n    vec3 ray = normalize( C + (2.0*vUv.x-1.0)*A + (2.0*vUv.y-1.0)*B );\n    return ray;\n}\nvec3 getColor(in vec3 rd) {\n    return RGBMDecode(textureCube(envMap, adjustLookupVector(rd)), envMapExposure);\n}\nvoid main() {\n    vec3 rd = rayDir(vUv);\n    vec3 outColor;\n    float alpha = opacity;\n#ifdef USE_BACKGROUND_TEXTURE\n    vec4 texel = texture2D(backgroundTexture, vUv);\n    outColor = texel.rgb;\n    alpha *= texel.a;\n#else\n    if (envMapBackground) {\n        outColor = getColor(rd);\n#if TONEMAP_OUTPUT == 1\n        outColor = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * outColor);\n#elif TONEMAP_OUTPUT == 2\n        outColor = toneMapCanonFilmic_WithGamma(exposureBias * outColor);\n#endif\n    }\n    else {\n        outColor = vColor;\n    }\n#endif\n    gl_FragColor = vec4(orderedDithering(outColor), alpha);\n}\n"},59047:e=>{e.exports="uniform vec3 color1;\nuniform vec3 color2;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvoid main() {\n    if (uv.y == 0.0)\n        vColor = color2;\n    else\n        vColor = color1;\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},48544:e=>{e.exports="uniform vec3 diffuse;\nuniform float opacity;\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\nuniform sampler2D tDepthTest;\nuniform vec2 tDepthResolution;\nvarying float vDepthPositionZ;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#if defined( PARTICLE_UV )\nvarying highp vec4 vUVp;\n#endif\n#include <cutplanes>\n#include <id_decl_frag>\n#include <theming_decl_frag>\n#include <logdepthbuf_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vec4( diffuse, opacity );\n#if defined( USE_MAP ) && defined ( PARTICLE_FRAGMENT )\n    #if defined( PARTICLE_UV )\n        vec2 uv3 = mix( vUVp.xy, vUVp.zw, gl_PointCoord );\n        diffuseColor = texture2D( map, uv3);\n    #else\n    \tdiffuseColor = texture2D( map, gl_PointCoord );\n    #endif\n#else\n    #include <map_fragment>\n#endif\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <specularmap_fragment>\n    outgoingLight = diffuseColor.rgb;\n#if !defined ( PARTICLE_FRAGMENT )\n    #include <lightmap_fragment>\n    #include <envmap_fragment>\n#endif\n#include <linear_to_gamma_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n    vec3 geomNormal = vec3(0.0,0.0,0.0);\n    float depth = 0.0;\n#include <theming_frag>\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\n    vec2 depthUV = gl_FragCoord.xy * tDepthResolution;\n    float depthVal = texture2D(tDepthTest, depthUV).z;\n    if(depthVal > vDepthPositionZ && depthVal != 0.) {\n        discard;\n    }\n#endif\n#include <final_frag>\n#include <logdepthbuf_frag>\n}\n"},75101:e=>{e.exports="#include <id_decl_vert>\n#include <decl_point_size>\n#include <common>\n#include <map_pars_vertex>\n#include <lightmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <wide_lines_decl>\n#include <pack_normals>\n#include <logdepthbuf_decl_vert>\n#ifdef USE_INSTANCING\n    #include <instancing_decl_vert>\n#endif\n#if defined( PARTICLE_UV )\nattribute vec4 uvp;\nvarying highp vec4 vUVp;\n#endif\n#if defined (PARTICLE_FLAGS)\nattribute float pointScale;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\nvarying float vDepthPositionZ;\n#endif\nvoid main() {\n#ifdef USE_INSTANCING\n    vec3 instancePosition = getInstancePos(position);\n    #define position instancePosition\n#endif\n#if defined(USE_ENVMAP) && (defined(UNPACK_NORMALS) || defined(USE_INSTANCE))\n    vec3 correctNormal;\n    #ifdef UNPACK_NORMALS\n        correctNormal = decodeNormal(normal);\n    #else\n        correctNormal = normal;\n    #endif\n    #ifdef USE_INSTANCING\n        correctNormal = getInstanceNormal(correctNormal);\n    #endif\n    #define normal correctNormal\n#endif\n#include <map_vertex>\n#include <lightmap_vertex>\n#include <color_vertex>\n#ifdef USE_ENVMAP\n#include <defaultnormal_vertex>\n#endif\n#include <default_vertex>\n#include <wide_lines_vert>\n#include <worldpos_vertex>\n#if NUM_CUTPLANES > 0\n    vec4 _worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = _worldPosition.xyz;\n#endif\n#if defined(DEPTH_OCCLUSION) && DEPTH_OCCLUSION == 1\n    vec4 _vDepthPosition = modelViewMatrix * vec4( position, 1.0 );\n    vDepthPositionZ = _vDepthPosition.z;\n#endif\n#if defined( PARTICLE_UV )\n    vUVp = uvp;\n#endif\n#include <envmap_vertex>\n#include <id_vert>\n#include <point_size>\n#if defined (PARTICLE_FLAGS) \n    gl_PointSize *= clamp(pointScale, 0.0, 2.0);\n#endif\n#include <logdepthbuf_vert>\n}\n"},20505:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform float aoOpacity;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform int useOverlayAlpha;\nuniform vec2 resolution;\nuniform vec4 objIDv4;\nuniform sampler2D tID;\nuniform vec4 edgeObjIDv4;\n#if defined(USE_MODEL_ID)\n#if defined(HIGHLIGHT_MODEL_ID_COUNT)\nuniform vec2 modelIDsv2v[HIGHLIGHT_MODEL_ID_COUNT];\n#else\nuniform vec2 modelIDv2;\n#endif\nuniform sampler2D tID2;\nuniform vec2 edgeModelIDv2;\n#endif\nuniform float highlightIntensity;\nuniform vec3 selectionColor;\nuniform float highlightFullModel;\nuniform vec3 highlightColor;\n#ifdef IS_2D\nuniform float expand2dSelection;\n#endif\nuniform sampler2D tCrossFadeTex0;\nuniform sampler2D tCrossFadeTex1;\nuniform float     crossFadeOpacity0;\nuniform float     crossFadeOpacity1;\nvarying vec2 vUv;\n#ifdef SPATIAL_FILTER\n#include <depth_texture>\n#endif\n#include <tonemap>\n#ifdef USE_IDBUFFER_SELECTION\nbool isSelection(vec2 vUv, float I, float J) {\n    vec4 idAtPixel = texture2D(tID, vUv+resolution*vec2(I,J));\n    if (idAtPixel.rgb == vec3(0.0))\n        return false;\n#if defined(USE_MODEL_ID)\n    vec4 modelAtPixel = texture2D(tID2, vUv+resolution*vec2(I,J));\n    idAtPixel.a = modelAtPixel.b;\n    vec4 idDelta = abs(idAtPixel.rgba - edgeObjIDv4.rgba);\n    vec2 modelDelta = abs(modelAtPixel.rg - edgeModelIDv2.rg);\n#else\n    vec4 idDelta = vec4(abs(idAtPixel.rgb - edgeObjIDv4.rgb), 0.0);\n    vec2 modelDelta = vec2(0.0, 0.0);\n#endif\n    if (max(max(modelDelta.r, modelDelta.g), max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n        return true;\n    } else {\n        return false;\n    }\n}\n#else\nbool isSelected(vec3 C) {\n    float minS = min(selectionColor.r, min(selectionColor.g, selectionColor.b));\n    float maxS = max(selectionColor.r, max(selectionColor.g, selectionColor.b));\n    float satS = maxS - minS;\n    float minC = min(C.r, min(C.g, C.b));\n    float maxC = max(C.r, max(C.g, C.b));\n    float satC = maxC - minC;\n    if (satC < .01 || satS < .01)\n        return false;\n    vec3 S = (selectionColor - minS) / satS;\n    vec3 H = (C - minC) / satC;\n    vec3 D = H - S;\n    float eps = .15;\n    return (abs(D.r) + abs(D.g) + abs(D.b) < eps)\n        || (maxC >= (1.0 - eps) && D.r >= -eps && D.g >= -eps && D.b >= -eps);\n}\n#define IS_SELECTION(C) isSelected((C).rgb)\n#endif\nvec4 overlayEdgeDetect(vec2 vUv) {\n#ifdef IS_2D\n#define MAX_ALPHA(c)\n#define SUM_ALPHA(c, w) sumAlpha += c.a * w; sumWeight += w;\n#else\n#define MAX_ALPHA(c) maxAlpha = max(maxAlpha, c.a);\n#define SUM_ALPHA(c, w) \n#endif\n#ifdef USE_IDBUFFER_SELECTION\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && isSelection(vUv, I, J)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#else\n#define CHECK_EDGE_ALPHA(I, J, W)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; SUM_ALPHA(c, W) selectionPixel = c; } }\n#endif\n#ifndef IS_2D\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); MAX_ALPHA(c) if (c.a <= 0.0) hasEdge++; }\n#endif\n    int hasEdge = 0;\n    vec4 center = texture2D(tOverlay, vUv);\n    vec4 selectionPixel = vec4(0.0);\n#ifdef IS_2D\n    float sumAlpha = 0.0, sumWeight = 0.0;\n#else\n    float maxAlpha = 0.0;\n    bool paintOutline = false;\n#endif\n    if (center.a <= 0.0) {\n        CHECK_EDGE_ALPHA(-1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0,-1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0,-1.0, 1.0);\n        CHECK_EDGE_ALPHA(-1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 0.0, 2.0);\n        CHECK_EDGE_ALPHA(-1.0, 1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0, 1.0, 2.0);\n        CHECK_EDGE_ALPHA( 1.0, 1.0, 1.0);\n        if (hasEdge != 0) {\n#ifdef IS_2D\n            center.a = -clamp(expand2dSelection - 1.0 + sumAlpha / sumWeight, 0.0, 1.0);\n            center.rgb = center.a < 0.0 ? selectionPixel.rgb : center.rgb;\n#else\n            center = selectionPixel;\n            paintOutline = true;\n#endif\n        }\n    }\n#ifdef USE_IDBUFFER_SELECTION\n    else if (center.a > 0.0 && isSelection(vUv, 0.0, 0.0)) {\n#else\n    else if (center.a > 0.0 && IS_SELECTION(center)) {\n#endif\n#ifdef IS_2D\n        center.a = -clamp(center.a + expand2dSelection, 0.0, 1.0);\n#else\n        CHECK_EDGE_SELECTION(-1.0,-1.0);\n        CHECK_EDGE_SELECTION( 0.0,-1.0);\n        CHECK_EDGE_SELECTION( 1.0,-1.0);\n        CHECK_EDGE_SELECTION(-1.0, 0.0);\n        CHECK_EDGE_SELECTION( 1.0, 0.0);\n        CHECK_EDGE_SELECTION(-1.0, 1.0);\n        CHECK_EDGE_SELECTION( 0.0, 1.0);\n        CHECK_EDGE_SELECTION( 1.0, 1.0);\n        if (hasEdge != 0)\n            paintOutline = true;\n        else\n            center.a = -center.a;\n#endif\n    }\n#ifndef IS_2D\n    if (paintOutline) {\n        float maxComponent = max(center.r, max(center.g, center.b));\n        center.rgb /= maxComponent;\n        center.rgb = sqrt(center.rgb);\n        center.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n    }\n#endif\n    return center;\n}\n#ifdef SPATIAL_FILTER\nSPATIAL_FILTER\n#endif\nvec4 sampleColor() {\n    return texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\n    return (useAO != 0) ? sqrt(texture2D(tAO, vUv).r) : 1.0;\n}\nvec3 applyCrossFade(vec3 srcColor, sampler2D fadeTex, float opacity, vec2 vUv) {\n    vec4 blendCol = texture2D(fadeTex, vUv);\n    return mix(srcColor.rgb, blendCol.rgb, blendCol.a * opacity);\n}\nvoid applyHighlighting(inout vec3 rgb, float filterValue) {\n#ifdef IS_2D\n    rgb = mix(rgb, vec3(1.0,1.0,0.0), filterValue * highlightIntensity * 0.25);\n#else\n    rgb += highlightColor * filterValue * highlightIntensity * 0.20;\n#endif\n}\n#ifdef USE_MODEL_ID\nfloat getModelIdDelta(vec2 a, vec2 b) {\n    vec2 delta = abs(a-b);\n    return max(delta.r, delta.g);\n}\nfloat getModelIdDelta(vec2 modelAtPixel) {\n    \n#ifdef HIGHLIGHT_MODEL_ID_COUNT\n    float delta = 1.0;\n    for (int i=0; i<HIGHLIGHT_MODEL_ID_COUNT; i++) {\n        delta = min(delta, getModelIdDelta(modelAtPixel, modelIDsv2v[i]));\n    }\n    return delta;\n#else\n    return getModelIdDelta(modelAtPixel, modelIDv2.rg);\n#endif\n}\n#endif\nvoid main() {\n    vec4 texel = sampleColor();\n    float ao = sampleAO();\n    #ifdef NUM_CROSSFADE_TARGETS\n        #if (NUM_CROSSFADE_TARGETS > 1)\n            #if (TARGET_FADE_MODE == 0)\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex0, crossFadeOpacity0, vUv);\n                texel.rgb = applyCrossFade(texel.rgb, tCrossFadeTex1, crossFadeOpacity1, vUv);\n            #else\n                vec4 t0 = texture2D(tCrossFadeTex0, vUv);\n                vec4 t1 = texture2D(tCrossFadeTex1, vUv);\n                vec4 mixed = mix(t0, t1, crossFadeOpacity1);\n                texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n                float aoGamma = 1.0 + 3.0 * (1.0 - 2.0 * abs(crossFadeOpacity1 - 0.5));\n                if (aoGamma == 0.0)\n                    aoGamma = 1.0;\n                ao = pow(ao, 1.0 / aoGamma);\n            #endif\n        #else\n            vec4 mixed = texture2D(tCrossFadeTex0, vUv);\n            texel.rgb = mix(texel.rgb, mixed.rgb, mixed.a);\n        #endif\n    #else\n    #endif\n    ao = 1.0 - (1.0 - ao) * aoOpacity;\n    texel.rgb *= ao;\n    if (useOverlay != 0) {\n        vec4 overlay = overlayEdgeDetect(vUv);\n        if (overlay.a < 0.0) {\n            overlay.a = -overlay.a;\n#ifdef IS_2D\n            overlay.a *= 0.6;\n#else\n            if (overlay.a >= 0.99) {\n                overlay.a = 0.75;\n                texel.rgb = vec3(luminance_post(texel.rgb));\n            }\n#endif\n        }\n#ifdef IS_2D\n        texel.rgb = texel.rgb * (1.0 - overlay.a) + overlay.rgb;\n#else\n        texel.rgb = texel.rgb * (1.0 - overlay.a) + sqrt(overlay.rgb * overlay.a);\n#endif\n        if (useOverlayAlpha != 0) {\n            texel.a += overlay.a * (1.0 - texel.a);\n        }\n    }\n    if (objIDv4 != vec4(0.0)) {\n    vec4 idAtPixel = texture2D(tID, vUv);\n    #ifdef SPATIAL_FILTER\n        vec3 worldPos = reconstructWorldPosition(gl_FragCoord.xy, vUv);\n        float filterValue = (spatialFilter(worldPos) ? 1.0 : 0.0);\n        if (idAtPixel != vec4(1,1,1,1)) {\n            applyHighlighting(texel.rgb, filterValue);\n        }\n    #else\n        #if defined(USE_MODEL_ID)\n            vec4 modelAtPixel = texture2D(tID2, vUv);\n            idAtPixel.a = modelAtPixel.b;\n            vec4 idDelta = abs(idAtPixel.rgba - objIDv4.rgba) * (1.0 - highlightFullModel);\n            float modelDelta = getModelIdDelta(modelAtPixel.rg);\n        #else\n            vec4 idDelta = vec4(abs(idAtPixel.rgb - objIDv4.rgb), 0.0);\n            float modelDelta = 0.0;\n        #endif\n            if (max(modelDelta, max(max(idDelta.r, idDelta.g), max(idDelta.b, idDelta.a))) < 1e-3) {\n                applyHighlighting(texel.rgb, 1.0);\n            }\n    #endif\n    }\n    gl_FragColor = texel;\n}\n"},40518:e=>{e.exports="\n#include <depth_texture>\nuniform sampler2D tDiffuse;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform sampler2D tFill;\nuniform sampler2D tPaper;\nuniform int style;\nuniform int idEdges;\nuniform int normalEdges;\nuniform int depthEdges;\nuniform float brightness;\nuniform float contrast;\nuniform int grayscale;\nuniform int preserveColor;\nuniform int outlineNoise;\nuniform float levels;\nuniform float repeats;\nuniform float rotation;\nuniform float outlineRadius;\nuniform sampler2D tGraphite1;\nuniform sampler2D tGraphite2;\nuniform sampler2D tGraphite3;\nuniform sampler2D tGraphite4;\nuniform sampler2D tGraphite5;\nuniform sampler2D tGraphite6;\nuniform sampler2D tGraphite7;\nuniform sampler2D tGraphite8;\nvarying vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\n    float z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\n    nrmz.w = -(nrmz.z + cameraNear) / (cameraFar - cameraNear);\n    nrmz.z = z;\n    return nrmz;\n}\n#include <tonemap>\n#include <hsv>\nvec3 quantize(vec3 c) {\n    float L = max(c.r, max(c.g, c.b));\n    c *= floor(L * (levels-1.0) + 0.5) / (L * (levels-1.0));\n    return c;\n}\nvec3 quantizeRGB(vec3 c) {\n    c *= c;\n    c *= floor(c * levels * 0.9999) / (levels-1.0);\n    return sqrt(c);\n}\nvec3 clampHue(vec3 c, float hues, float sats, float vals) {\n    vec3 hsv = rgb2hsv(c);\n    hsv.x = floor(hsv.x * hues + 0.5) / hues;\n    hsv.y = floor(hsv.y * sats + 0.5) / sats;\n    hsv.z = floor(hsv.z * vals + 0.5) / vals;\n    vec3 col = hsv2rgb(hsv);\n    return col;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nint isObjectEdge() {\n    vec2 uv = vUv;\n    if (outlineNoise == 1) {\n        vec4 noise = texture2D(tGraphite7, vUv);\n        uv = vUv + 0.02 * (noise.xy - vec2(0.25));\n    }\n    vec4 MM = texture2D(tID, uv);\n    vec4 LL = texture2D(tID, uv + vec2(-outlineRadius, -outlineRadius) * resolution);\n    if (MM != LL) return 1;\n    vec4 LM = texture2D(tID, uv + vec2( 0.0, -outlineRadius) * resolution);\n    if (MM != LM) return 1;\n    vec4 LR = texture2D(tID, uv + vec2( outlineRadius, -outlineRadius) * resolution);\n    if (MM != LR) return 1;\n    vec4 ML = texture2D(tID, uv + vec2(-outlineRadius,  0.0) * resolution);\n    if (MM != ML) return 1;\n    vec4 MR = texture2D(tID, uv + vec2( outlineRadius,  0.0) * resolution);\n    if (MM != MR) return 1;\n    vec4 UL = texture2D(tID, uv + vec2(-outlineRadius,  outlineRadius) * resolution);\n    if (MM != UL) return 1;\n    vec4 UM = texture2D(tID, uv + vec2( 0.0,  outlineRadius) * resolution);\n    if (MM != UM) return 1;\n    vec4 UR = texture2D(tID, uv + vec2( outlineRadius,  outlineRadius) * resolution);\n    if (MM != UR) return 1;\n    return (MM.x + MM.y + MM.z + MM.w) >= 4.0 ? 0 : -1;\n}\nfloat normalDiff(vec3 n1, vec3 n2) {\n    float d = dot(n1.xyz, n2.xyz);\n    return acos(clamp(d, -1.0, 1.0));\n}\nint isNormalDepthEdge() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec2 uv = vUv;\n    if (outlineNoise == 1) {\n        vec4 noise = texture2D(tGraphite7, vUv);\n        uv = vUv + 0.02 * (noise.xy - vec2(0.25));\n    }\n    vec4 MM = texture2D(tDepth, uv);\n    vec4 LL = texture2D(tDepth, uv + vec2(-outlineRadius, -outlineRadius) * resolution);\n    vec4 LM = texture2D(tDepth, uv + vec2( 0.0, -outlineRadius) * resolution);\n    vec4 LR = texture2D(tDepth, uv + vec2( outlineRadius, -outlineRadius) * resolution);\n \n    vec4 ML = texture2D(tDepth, uv + vec2(-outlineRadius,  0.0) * resolution);\n    vec4 MR = texture2D(tDepth, uv + vec2( outlineRadius,  0.0) * resolution);\n    vec4 UL = texture2D(tDepth, uv + vec2(-outlineRadius, outlineRadius) * resolution);\n    vec4 UM = texture2D(tDepth, uv + vec2( 0.0,  outlineRadius) * resolution);\n    vec4 UR = texture2D(tDepth, uv + vec2( outlineRadius,  outlineRadius) * resolution);\n    LL = recoverNZ(LL);\n    LM = recoverNZ(LM);\n    LR = recoverNZ(LR);\n    ML = recoverNZ(ML);\n    MM = recoverNZ(MM);\n    MR = recoverNZ(MR);\n    UL = recoverNZ(UL);\n    UM = recoverNZ(UM);\n    UR = recoverNZ(UR);\n    float dd = 0.0;\n    if ( depthEdges == 1 ) {\n        float G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\n        dd = abs(dFdx(G)) + abs(dFdy(G));\n    }\n    float Gn = 0.0;\n    if ( normalEdges == 1 ) {\n        float pLL = normalDiff(LL.xyz, MM.xyz);\n        float pLM = normalDiff(LM.xyz, MM.xyz);\n        float pLR = normalDiff(LR.xyz, MM.xyz);\n        float pML = normalDiff(ML.xyz, MM.xyz);\n        float pMM = normalDiff(MM.xyz, MM.xyz);\n        float pMR = normalDiff(MR.xyz, MM.xyz);\n        float pUL = normalDiff(UL.xyz, MM.xyz);\n        float pUM = normalDiff(UM.xyz, MM.xyz);\n        float pUR = normalDiff(UR.xyz, MM.xyz);\n        Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\n    }\n    \n    return (dd > 0.004 || Gn > 2.0) ? 1 : 0;\n}\nvec3 computeGraphite( vec3 color, vec2 loc ) {\n    float lum = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\n    float offset;\n    vec3 col1, col2;\n    if ( lum > 6.0/7.0 ) {\n        col1 = texture2D(tGraphite1, loc ).xyz;\n        col2 = texture2D(tGraphite2, loc ).xyz;\n        offset = 6.0/7.0;\n    } else if ( lum > 5.0/7.0 ) {\n        col1 = texture2D(tGraphite2, loc ).xyz;\n        col2 = texture2D(tGraphite3, loc ).xyz;\n        offset = 5.0/7.0;\n    } else if ( lum > 4.0/7.0 ) {\n        col1 = texture2D(tGraphite3, loc ).xyz;\n        col2 = texture2D(tGraphite4, loc ).xyz;\n        offset = 4.0/7.0;\n    } else if ( lum > 3.0/7.0 ) {\n        col1 = texture2D(tGraphite4, loc ).xyz;\n        col2 = texture2D(tGraphite5, loc ).xyz;\n        offset = 3.0/7.0;\n    } else if ( lum > 2.0/7.0 ) {\n        col1 = texture2D(tGraphite5, loc ).xyz;\n        col2 = texture2D(tGraphite6, loc ).xyz;\n        offset = 2.0/7.0;\n    } else if ( lum > 1.0/7.0 ) {\n        col1 = texture2D(tGraphite6, loc ).xyz;\n        col2 = texture2D(tGraphite7, loc ).xyz;\n        offset = 1.0/7.0;\n    } else {\n        col1 = texture2D(tGraphite7, loc ).xyz;\n        col2 = texture2D(tGraphite8, loc ).xyz;\n        offset = 0.0;\n    }\n    if ( col1.r == 0.0 && col2.r == 0.0 ) {\n        return vec3(lum,lum,lum);\n    }\n    float t = (lum-offset)*7.0;\n    return (col1 * t + col2 * (1.0 - t));\n}\nvec3 colorWithAdjustments() {\n    vec3 sceneRGB = texture2D(tDiffuse, vUv).xyz;\n    if ( brightness != 0.0 || contrast != 0.0) {\n        if ( brightness < 0.0 )\n        {\n            sceneRGB = sceneRGB * (1.0 + brightness);\n        }\n        else\n        {\n            sceneRGB = sceneRGB + ((1.0 - sceneRGB) * brightness);\n        }\n        float slant = tan(( clamp(contrast,-1.0,1.0) + 1.0) * 3.141592/4.001);\n        sceneRGB = (sceneRGB - 0.5) * slant + 0.5;\n        if ( preserveColor == 1 )\n        {\n            float maxval = max( sceneRGB.r, sceneRGB.g );\n            maxval = max( maxval, sceneRGB.b );\n            if ( maxval > 1.0 )\n            {\n                sceneRGB /= maxval;\n            }\n        }\n        sceneRGB = clamp(sceneRGB,0.0,1.0);\n    }\n    if ( grayscale == 1 ) {\n        sceneRGB.rgb = vec3(luminance_post(sceneRGB.rgb));\n    }\n    return sceneRGB;\n}\nvoid main() {\n    int foundEdge = 0;\n    foundEdge = ( idEdges == 1 && isObjectEdge() == 1 ) ? 1 : 0;\n    if ( foundEdge == 0 && (normalEdges == 1 || depthEdges == 1) ) {\n        foundEdge = isNormalDepthEdge();\n    }\n    vec2 loc = vec2((vUv.x-0.5)*(resolution.y/resolution.x),vUv.y-0.5)*repeats;\n    if ( style > 2 && rotation != 0.0 ) {\n        float rot = 3.14159*rotation;\n        float sinr = sin(rot);\n        float cosr = cos(rot);\n        loc = vec2(loc.x*cosr + -loc.y*sinr, loc.x*sinr + loc.y*cosr);\n    }\n    loc += vec2(0.5,0.5);\n    vec3 color;\n    if ( style == 2 ) {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(quantize(colorWithAdjustments()),1.0);\n        }\n    } else if ( style == 3 ) {\n        color = colorWithAdjustments();\n        vec3 graphColor = computeGraphite( color, loc );\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.16,0.16,0.16,1.0) + vec4(0.18 * graphColor,0.0);\n        } else {\n            gl_FragColor = vec4(graphColor,1.0);\n        }\n        return;\n    } else if ( style == 4 ) {\n        float fill = texture2D(tFill, loc ).r;\n        float paperStrength = 0.3;\n        vec3 paper = texture2D(tPaper, loc ).rgb;\n        paper = paperStrength * paper + (1.0-paperStrength)*vec3(1.0,1.0,1.0);\n        if ( foundEdge == 1 ) {\n            gl_FragColor = 0.75 * vec4(paper * fill, 1.0);\n        } else {\n            fill = pow(fill,1.6);\n            gl_FragColor = vec4(colorWithAdjustments() * (1.0 - fill) + paper * fill, 1.0);\n        }\n    } else {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(colorWithAdjustments(),1.0);\n        }\n        return;        \n    }\n}\n"},67086:e=>{e.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n}\n"},6750:e=>{e.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include <cutplanes>\n#include <logdepthbuf_decl_frag>\nuniform vec4 color;\n#include <id_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    gl_FragColor = color;\n#ifdef MRT_NORMALS\noutNormal = vec4(0.0);\n#endif\n#ifdef MRT_ID_BUFFER\n    outId = vec4(0.0);\n    #ifdef MODEL_COLOR\n        outModelId = vec4(0.0);\n    #endif\n#elif defined(ID_COLOR)\n    gl_FragColor = vec4(0.0);\n#elif defined(MODEL_COLOR)\n    gl_FragColor = vec4(0.0);\n#endif\n#include <logdepthbuf_frag>\n}"},79282:e=>{e.exports="\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include <logdepthbuf_decl_vert>\n#include <instancing_decl_vert>\nvoid main() {\n    vec3 instPos = getInstancePos(position);\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n#include <logdepthbuf_vert>\n}"},49510:e=>{e.exports="#define FXAA_EDGE_SHARPNESS (8.0)\n#define FXAA_EDGE_THRESHOLD (0.125)\n#define FXAA_EDGE_THRESHOLD_MIN (0.05)\n#define FXAA_RCP_FRAME_OPT (0.50)\n#define FXAA_RCP_FRAME_OPT2 (2.0)\nuniform sampler2D tDiffuse;\nuniform highp vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nfloat FxaaLuma(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n    float lumaNw = FxaaLuma(texture2D(tDiffuse, vPosPos.xy).rgb);\n    float lumaSw = FxaaLuma(texture2D(tDiffuse, vPosPos.xw).rgb);\n    float lumaNe = FxaaLuma(texture2D(tDiffuse, vPosPos.zy).rgb) + 1.0/384.0;\n    float lumaSe = FxaaLuma(texture2D(tDiffuse, vPosPos.zw).rgb);\n    vec4 rgbaM = texture2D(tDiffuse, vPos.xy);    \n    float lumaM = FxaaLuma(rgbaM.rgb);\n    float lumaMax = max(max(lumaNe, lumaSe), max(lumaNw, lumaSw));\n    float lumaMin = min(min(lumaNe, lumaSe), min(lumaNw, lumaSw));\n    float lumaMaxSubMinM = max(lumaMax, lumaM) - min(lumaMin, lumaM);\n    float lumaMaxScaledClamped = max(FXAA_EDGE_THRESHOLD_MIN, lumaMax * FXAA_EDGE_THRESHOLD);\n    if (lumaMaxSubMinM < lumaMaxScaledClamped) {\n        gl_FragColor = rgbaM;\n        return;\n    }\n    float dirSwMinusNe = lumaSw - lumaNe;\n    float dirSeMinusNw = lumaSe - lumaNw;\n    vec2 dir1 = normalize(vec2(dirSwMinusNe + dirSeMinusNw, dirSwMinusNe - dirSeMinusNw));\n    vec3 rgbN1 = texture2D(tDiffuse, vPos.xy - dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    vec3 rgbP1 = texture2D(tDiffuse, vPos.xy + dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    float dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * FXAA_EDGE_SHARPNESS;\n    vec2 dir2 = clamp(dir1.xy / dirAbsMinTimesC, -2.0, 2.0);\n    vec3 rgbN2 = texture2D(tDiffuse, vPos.xy - dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbP2 = texture2D(tDiffuse, vPos.xy + dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbA = rgbN1 + rgbP1;\n    vec3 rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);\n    float lumaB = FxaaLuma(rgbB);\n    float alpha = rgbaM.a;\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        gl_FragColor = vec4(rgbA * 0.5, rgbaM.a);\n    else\n        gl_FragColor = vec4(rgbB, rgbaM.a);\n}\n"},63332:e=>{e.exports="uniform vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nvoid main() {\n    vPos = uv;\n    vPosPos.xy = uv + vec2(-0.5, -0.5) * uResolution;\n    vPosPos.zw = uv + vec2( 0.5,  0.5) * uResolution;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},93285:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture2D(tDiffuse, GET_UV(x));\n#ifdef HAS_ALPHA\n        texCol.rgb *= texCol.a;\n#endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n#ifdef HAS_ALPHA\n    texColSum.rgb /= (texColSum.a == 0.0 ? 0.0001 : texColSum.a);\n#endif\n#ifdef HORIZONTAL\n    gl_FragColor = texColSum/gaussSum;\n#else\n    gl_FragColor = texColSum/gaussSum * uColor;\n#endif\n}\n"},3911:e=>{e.exports="varying vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"},24687:e=>{e.exports="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    vec4 texel = texture2D( tDiffuse, vUv );\n    gl_FragColor = texel;\n}\n"},24009:e=>{e.exports="#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nvarying vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif\n#include <pack_depth>\n#define PI 3.14159265358979\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\n    return rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\n    float angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\n    vec2 sampleOffset = unitDirection * radius;\n    float idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));\n    float depth = 1.0 - idepth;\n    if (depth < 1e-6) {\n        if (radius == 0.0)\n            return vec2(1.0, 1.0);\n        else\n            return vec2(0.0, 1.0);\n    }\n    vec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\n    float distance2 = dot(dir,dir);\n    float idistance = 1.0 / sqrt(distance2);\n    vec3 ndir = dir * idistance;\n#ifdef PRESET_2\n    float importance = ndir.y * idistance;\n#else\n    float importance = ndir.y / distance2;\n#endif\n    vec2 ret;\n    ret.x = (idepth == 0.0) ? 0.0 : importance;\n    ret.y = importance;\n    return ret;\n}\nvoid main() {\n    vec2 sum = vec2(0.0);\n    float angle = getRandomAngle(vUv);\n    for (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\n        float ssR;\n        vec2 uv = tapLocation(i, angle, ssR);\n        sum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n    }\n    float ao = sum.x / sum.y;\n    gl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}\n"},8242:e=>{e.exports="uniform sampler2D tDepth;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif\n#include <pack_depth>\n#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\n    float depthVal = 0.0;\n    float sum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        depthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);\n        sum += KERNEL_VAL(x);\n    }\n    gl_FragColor = packDepth(depthVal/sum);\n}\n"},14810:e=>{e.exports="uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nvarying vec2 vUv;\n#include <pack_depth>\nvoid main() {\n    float depthVal = unpackDepth(texture2D(tDepth, vUv));\n    gl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}\n"},57165:e=>{e.exports="#include <pack_depth>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include <cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    depth = 1.0 - depth;\n    gl_FragColor = packDepth(depth);\n}\n"},40520:e=>{e.exports="#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n}\n"},13518:e=>{e.exports="#include <common>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <id_decl_frag>\n#include <theming_decl_frag>\n#define ENABLE_ID_DISCARD\nuniform float opacity;\nuniform vec4 selectionColor;\n#if NUM_CUTPLANES>0\nvarying highp vec3 vWorldPosition;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform highp vec4 viewportBounds;\nvarying vec4 vPosition;\n#endif\n#include <cutplanes>\nvoid main(){\n    #if NUM_CUTPLANES>0\n        checkCutPlanes(vWorldPosition);\n    #endif\n    \n    #ifdef VIEWPORT_CLIPPING\n    \n    if (vPosition.x < viewportBounds.x || vPosition.x > viewportBounds.z || vPosition.y < viewportBounds.y || vPosition.y > viewportBounds.w) {\n        discard;\n    }\n    #endif\n    \n    float depth = 0.;\n    vec3 geomNormal = vec3(0.);\n    vec3 outgoingLight = vec3(0.);\n    vec4 diffuseColor = vec4(opacity);\n    \n    #include <map_fragment>\n    #include <alphamap_fragment>\n    #include <alphatest_fragment>\n    \n    outgoingLight = diffuseColor.rgb;\n    \n    #include <linear_to_gamma_fragment>\n    \n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\n    float writeId = 1.0;\n    #ifdef GHOSTED \n        writeId = 0.;\n        gl_FragColor.a *= 0.1;\n    #endif\n    \n    #include <theming_frag>\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, selectionColor.rgb, selectionColor.a);\n    #include <final_frag>\n}\n"},34722:e=>{e.exports="#include <common>\n#include <map_pars_vertex>\n#if NUM_CUTPLANES>0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform mat4 modelLocalMatrix;\nvarying vec4 vPosition;\n#endif\nvoid main(){\n    vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n    \n    #if NUM_CUTPLANES>0\n        vWorldPosition = (modelMatrix * vec4(position,1.)).xyz;\n    #endif\n    \n    #ifdef VIEWPORT_CLIPPING\n        vPosition = modelLocalMatrix * vec4(position.xy,0.,1.);\n    #endif\n    \n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy,0.,1.);\n}\n"},18350:e=>{e.exports="\r\n\r\n#define LINE\r\n#include <line_decl_common>\r\n#include <id_decl_frag>\r\n#include <logdepthbuf_decl_frag>\r\n\r\nuniform highp float pixelsPerUnit;\r\nuniform highp float aaRange;\r\n\r\nuniform float opacity;\r\nuniform highp float viewportId;\r\nuniform highp float swap;\r\nuniform highp float grayscale;\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nuniform sampler2D tRaster;\r\n#endif\r\n\r\n#ifdef HAS_LINESTYLES\r\nuniform sampler2D tLineStyle;\r\nuniform vec2 vLineStyleTexSize;\r\n#endif\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\nuniform highp vec4 viewportBounds;\r\nvarying highp vec2 vPosition;\r\n#endif\r\n\r\n#ifdef IMAGE_UV_TEXTURE\r\nvarying highp vec2 vuv;\r\nuniform sampler2D tRaster;\r\n#endif\r\n\r\n\r\nfloat curveGaussian(float r, float invWidth) {\r\n    float amt = clamp(r * invWidth, 0.0, 1.0);\r\n\r\n    float exponent = amt * 2.0;\r\n\r\n    return exp(-exponent*exponent);\r\n\r\n\r\n\r\n}\r\n\r\n#ifdef HAS_LINESTYLES\r\nfloat getLinePatternPixel(int i, int j) {\r\n\r\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\r\n}\r\n\r\nfloat getPatternLength(int whichPattern) {\r\n    float p1 = getLinePatternPixel(0, whichPattern);\r\n    float p2 = getLinePatternPixel(1, whichPattern);\r\n    return (p2 * 256.0 + p1);\r\n}\r\n#endif\r\n\r\n\r\nvoid fillLineSegment() {\r\n\r\n    float radius = abs(fsHalfWidth);\r\n    float parametricDistance = fsMultipurpose.x;\r\n    float segmentLength      = fsMultipurpose.y;\r\n    float totalDistance      = fsMultipurpose.z;\r\n\r\n#ifdef LOADING_ANIMATION\r\n    float distFromStart = parametricDistance / segmentLength;\r\n    if (loadingProgress < 1.0 && distFromStart > loadingProgress) {\r\n        discard;\r\n    }\r\n#endif\r\n\r\n\r\n#ifdef HAS_LINESTYLES\r\n    int whichPattern         = int(fsMultipurpose.w);\r\n\r\n    if (whichPattern > 0) {\r\n        const float TEX_TO_UNIT = 1.0 / 96.0;\r\n\r\n        float patternScale;\r\n\r\n\r\n\r\n        if (fsHalfWidth < 0.0) {\r\n            patternScale = LTSCALE;\r\n        } else {\r\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\r\n        }\r\n\r\n        float patLen = patternScale * getPatternLength(whichPattern);\r\n        float phase = mod((totalDistance + parametricDistance) * pixelsPerUnit, patLen);\r\n\r\n        bool onPixel = true;\r\n        float radiusPixels = radius * pixelsPerUnit;\r\n\r\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\r\n\r\n            float on = getLinePatternPixel(i, whichPattern);\r\n            if (on == 1.0) on = 0.0;\r\n            on *= patternScale;\r\n\r\n            onPixel = true;\r\n            phase -= on;\r\n            if (phase < 0.0) {\r\n                break;\r\n            }\r\n            else if (phase <= radiusPixels) {\r\n                onPixel = false;\r\n                break;\r\n            }\r\n\r\n            float off = getLinePatternPixel(i+1, whichPattern);\r\n            if (off <= 1.0) off = 0.0;\r\n            off *= patternScale;\r\n\r\n            onPixel = false;\r\n            phase -= off;\r\n            if (phase < -radiusPixels)\r\n                discard;\r\n            if (phase <= 0.0)\r\n                break;\r\n        }\r\n\r\n\r\n\r\n\r\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\r\n            segmentLength = 0.0;\r\n            parametricDistance = phase / pixelsPerUnit;\r\n        }\r\n    }\r\n#endif\r\n\r\n\r\n\r\n\r\n    float dist;\r\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\r\n\r\n\r\n\r\n\r\n    float ltz = max(0.0, sign(-parametricDistance));\r\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\r\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\r\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\r\n\r\n\r\n\r\n\r\n    float range =  dist - radius;\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor = fsColor;\r\n    gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n}\r\n\r\n#ifdef HAS_CIRCLES\r\nvoid fillCircularArc() {\r\n\r\n    float dist   = length(fsOffsetDirection);\r\n    vec2 angles  = fsMultipurpose.xz;\r\n    float radius = abs(fsMultipurpose.y);\r\n    float range  =  abs(dist - radius);\r\n    range -= fsHalfWidth;\r\n\r\n\r\n\r\n    if (range > aaRange) {\r\n        discard;\r\n    }\r\n\r\n    vec2 direction = fsOffsetDirection;\r\n    float angle = atan(direction.y, direction.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n                angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n#ifdef LOADING_ANIMATION\r\n    if ((angle - angles.x) / (angles.y - angles.x) > loadingProgress) {\r\n        discard;\r\n    }\r\n#endif\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_ELLIPTICALS\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat EllipticalApprox(\r\n        const int iters,\r\n        inout float t0, inout float t1,\r\n        const vec2 y,   out   vec2 x,\r\n        const vec2 e,   const vec2 ey, const vec2 esqr\r\n        ) {\r\n    vec2 r;\r\n    for (int i = 0; i < 10; ++i) {\r\n        if(i >= iters) break;\r\n\r\n        float t = mix(t0, t1, 0.5);\r\n        r = ey / (vec2(t) + esqr);\r\n\r\n        vec2 rsq = r * r;\r\n        float f = rsq.x + rsq.y - 1.0;\r\n\r\n        if(f > 0.0) { t0 = t; } else { t1 = t; }\r\n    }\r\n\r\n    x = e * r;\r\n    return distance(x, y);\r\n}\r\n\r\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\r\n    float dist;\r\n\r\n\r\n    vec2 esqr = e * e;\r\n    vec2 ey   = e * y;\r\n    float t0 = -esqr[1] + ey[1];\r\n    float t1 = -esqr[1] + length(ey);\r\n\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n    if (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\r\n        return dist;\r\n\r\n\r\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\r\n\r\n\r\n\r\n\r\n    float ecc = 1.0 +  0.1 * e[0] / e[1];\r\n\r\n    if (dist > max(ecc * (width + aaRange), e[0] * 0.001))\r\n        return dist;\r\n    if (dist < (width - aaRange) / ecc)\r\n        return dist;\r\n\r\n\r\n\r\n\r\n    dist = EllipticalApprox(10, t0, t1, y, x, e, ey, esqr);\r\n    return dist;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\r\n    vec2 locE, locY;\r\n\r\n\r\n\r\n\r\n    float diff = sign(e[0] - e[1]);\r\n    vec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\r\n    locE.x = dot(e, swizzle.xy);\r\n    locE.y = dot(e, swizzle.yx);\r\n    locY.x = dot(y, swizzle.xy);\r\n    locY.y = dot(y, swizzle.yx);\r\n\r\n\r\n    vec2 refl = sign(locY);\r\n    locY *= refl;\r\n\r\n    vec2 x;\r\n    float distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\r\n\r\n    x *= refl;\r\n\r\n    locX.x = dot(x, swizzle.xy);\r\n    locX.y = dot(x, swizzle.yx);\r\n\r\n    return distance;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nvoid fillEllipticalArc() {\r\n    vec2 angles = fsMultipurpose.xz;\r\n    vec2 radii  = abs(fsMultipurpose.yw);\r\n    vec2 dir    = fsOffsetDirection;\r\n\r\n\r\n\r\n\r\n    vec2 pos;\r\n    float range = DistancePointEllipse(radii, dir, pos, fsHalfWidth, aaRange);\r\n    range -= fsHalfWidth;\r\n\r\n    if (range > aaRange)\r\n        discard;\r\n\r\n    float ar = radii[0] / radii[1];\r\n\r\n\r\n\r\n\r\n    float angle = atan(ar * pos.y, pos.x);\r\n\r\n\r\n\r\n\r\n    if (angles.x > angles.y) {\r\n\r\n        if (angle > angles.x && angle < PI) {\r\n            angle -= TAU;\r\n        }\r\n        angles.x -= TAU;\r\n\r\n\r\n\r\n        if (angle < angles.x ) {\r\n            angle += TAU;\r\n        }\r\n    }\r\n    else if (angle < 0.0)\r\n        angle += TAU;\r\n\r\n#ifdef LOADING_ANIMATION\r\n    if ((angle - angles.x) / (angles.y - angles.x) > loadingProgress) {\r\n        discard;\r\n    }\r\n#endif\r\n\r\n\r\n    if (angle > angles.x && angle < angles.y) {\r\n        gl_FragColor = fsColor;\r\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\r\n    }\r\n    else {\r\n        discard;\r\n    }\r\n}\r\n#endif\r\n\r\n#ifdef HAS_RASTER_QUADS\r\n    void fillTexQuad() {\r\n        gl_FragColor = texture2D(tRaster, fsMultipurpose.xy);\r\n        #ifdef LOADING_ANIMATION\r\n            gl_FragColor.a *= loadingProgress;\r\n        #endif\r\n    }\r\n#endif\r\n\r\nvoid fillTriangle() {\r\n#ifdef IMAGE_UV_TEXTURE\r\n    gl_FragColor = texture2D(tRaster, fract(vuv));\r\n#else\r\n    gl_FragColor = fsColor;\r\n#endif\r\n\r\n#ifdef LOADING_ANIMATION\r\n    gl_FragColor.a *= loadingProgress;\r\n#endif\r\n}\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\n#ifdef MSDF_TEXTURE_FONT\r\nvarying highp vec2 vuv;\r\nvarying float isMSDFQuards;\r\nuniform sampler2D tRaster;\r\nfloat median(float r, float g, float b) {\r\n  return max(min(r, g), min(max(r, g), b));\r\n}\r\n\r\n#endif\r\n\r\n#include <cutplanes>\r\n\r\nvoid main() {\r\n\r\n\r\n\r\n\r\n\r\n    if (fsColor == vec4(0.0)) {\r\n        discard;\r\n    }\r\n\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\n    if(vPosition.x < viewportBounds.x || vPosition.x > viewportBounds.z || vPosition.y < viewportBounds.y || vPosition.y > viewportBounds.w) {\r\n        discard;\r\n    }\r\n#endif\r\n\r\n#ifdef MSDF_TEXTURE_FONT\r\n    vec4 msdfColor = texture2D(tRaster, vuv);\r\n    float dist = median(msdfColor.r, msdfColor.g, msdfColor.b);\r\n\r\n\r\n    float delta = mix(0.25, 0.5, 1.0 - fwidth(dist));\r\n\r\n    float sigDist = dist - delta;\r\n    float msdfAlpha = clamp(sigDist/fwidth(sigDist) + delta, 0.0, 1.0);\r\n\r\n    msdfAlpha = smoothstep(0., 1., msdfAlpha);\r\n    gl_FragColor.a =  mix(msdfAlpha, 1., 1.-isMSDFQuards);\r\n    if (gl_FragColor.a < 0.0001) discard;\r\n\r\n#endif\r\n\r\n\r\n    if (fsHalfWidth == 0.0) {\r\n#ifdef HAS_RASTER_QUADS\r\n        if (fsMultipurpose.z != 0.0)\r\n            fillTexQuad();\r\n        else\r\n#endif\r\n            fillTriangle();\r\n    }\r\n    else if (fsMultipurpose.y < 0.0) {\r\n#ifdef HAS_CIRCLES\r\n#ifdef HAS_ELLIPTICALS\r\n        if (abs(fsMultipurpose.y) == fsMultipurpose.w)\r\n#endif\r\n            fillCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n#ifdef HAS_CIRCLES\r\n        else\r\n#endif\r\n            fillEllipticalArc();\r\n#endif\r\n    }\r\n    else\r\n        fillLineSegment();\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float writeId = 1.0;\r\n    \r\n    gl_FragColor.a *= opacity;\r\n\r\n    if (gl_FragColor.a == 0.0) {\r\n        discard;\r\n    }\r\n\r\n\r\n\r\n\r\n    if (fsGhosting != 0.0 || \r\n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\r\n\r\n        writeId = 0.0;\r\n\r\n\r\n\r\n        gl_FragColor.a *= ((swap == 1.0) ? 0.21 : 0.1);\r\n    }\r\n\r\n#ifndef SELECTION_RENDERER\r\n\r\n    if (grayscale != 0.0) {\r\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\r\n        float gray = dot(gl_FragColor.rgb, rgb2grey);\r\n        gl_FragColor.rgb = vec3(gray);\r\n    }\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n#ifdef MRT_NORMALS\r\n\r\n    outNormal = vec4(0.0, 0.0, 0.0, 1.0);\r\n#endif\r\n\r\n#ifdef NO_ID_OUTPUT\r\n\r\n    writeId = 0.0;\r\n#endif\r\n\r\n#include <id_frag>\r\n#include <logdepthbuf_frag>\r\n}\r\n"},71519:e=>{e.exports="\r\n\r\n#include <line_decl_common>\r\n#include <logdepthbuf_decl_vert>\r\n\r\nattribute vec2 fields1;\r\nattribute vec4 fields2;\r\nattribute vec4 flags4b;\r\nattribute vec4 layerVp4b;\r\n\r\n#ifdef HAS_ELLIPTICALS\r\nattribute vec3 extraParams;\r\n#endif\r\n\r\n#ifdef USE_INSTANCING\r\nattribute vec4 instFlags4b;\r\n#endif\r\n\r\n#ifdef MSDF_TEXTURE_FONT\r\nvarying highp vec2 vuv;\r\nvarying float isMSDFQuards;\r\n#endif\r\n\r\n#ifdef IMAGE_UV_TEXTURE\r\nvarying highp vec2 vuv;\r\n#endif\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\nvarying vec2 vPosition;\r\n#endif\r\n\r\nuniform mat4 mvpMatrix;\r\n\r\nuniform float pixelsPerUnit;\r\nuniform float aaRange;\r\nuniform float viewportId;\r\nuniform float swap;\r\n\r\n\r\n\r\n\r\n\r\n#ifdef HAS_LAYERS\r\nuniform sampler2D tLayerMask;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform sampler2D tSelectionTexture;\r\nuniform vec2 vSelTexSize;\r\n#endif\r\n\r\n#ifdef SELECTION_RENDERER\r\nuniform vec4 selectionColor;\r\n#endif\r\n\r\n#ifdef LOADING_ANIMATION\r\nuniform float meshAnimTime;\r\n#endif\r\n\r\n#if NUM_CUTPLANES > 0\r\nvarying vec3 vWorldPosition;\r\n#endif\r\n\r\nvarying vec4 dbId;\r\n\r\n#ifdef UNPACK_POSITIONS\r\nuniform sampler2D tIdColor;\r\nuniform vec2 vIdColorTexSize;\r\nuniform vec4 unpackXform;\r\nattribute vec2 uvIdColor;\r\nfloat unpackLineWeight(float w) {\r\n    if (w > 0.5) {\r\n        return - (w - 0.5) * 1024.0;\r\n    } else {\r\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\r\n    }\r\n}\r\nvec4 getVertexColor() {\r\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\r\n    return texture2D(tIdColor, vec2(u, 0.5));\r\n}\r\nvec4 getDbId() {\r\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\r\n    vec4 normDbId = texture2D(tIdColor, vec2(u, 0.5));\r\n    return normDbId * 255.0;\r\n}\r\n#else\r\nattribute vec4 color4b;\r\nattribute vec4 dbId4b;\r\nvec4 unpackXform;\r\nfloat unpackLineWeight(float w) {\r\n    return w;\r\n}\r\nvec4 getVertexColor() {\r\n    return color4b;\r\n}\r\nvec4 getDbId() {\r\n    return dbId4b;\r\n}\r\n#endif\r\n\r\n\r\nvec2 centralVertex;\r\nvec2 offsetPosition;\r\n\r\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\r\n\r\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\r\n    minPt = min(minPt, p);\r\n    maxPt = max(maxPt, p);\r\n}\r\n\r\n#if defined(USE_INSTANCING)\r\nfloat getVertexId() { return instFlags4b.x; }\r\n#else\r\nfloat getVertexId() { return flags4b.x; }\r\n#endif\r\n\r\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\r\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\r\n\r\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\r\nvoid decodeSegmentData(out SegmentData seg) {\r\n    seg.angle         = fields2.x * TAU - PI;\r\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\r\n    seg.distTotal     = fields2.w;\r\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\r\n    seg.lineType      = flags4b.z;\r\n}\r\n\r\nvoid strokeLineSegment() {\r\n    SegmentData seg; decodeSegmentData(seg);\r\n\r\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\r\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\r\n\r\n\r\n    float angleTransverse = seg.angle + isLeftSide * HALF_PI;\r\n    float lwAdjustment = fsHalfWidth + aaRange;\r\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\r\n    offsetPosition.xy += transverseOffset;\r\n\r\n\r\n\r\n\r\n    float distanceFromStart = max(isStartCapVertex, 0.0) * seg.distAlong;\r\n    vec2 along = distanceFromStart * cos_sin(seg.angle);\r\n    offsetPosition.xy += along;\r\n    centralVertex.xy  += along;\r\n\r\n\r\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\r\n    offsetPosition.xy -= moveOffset;\r\n    centralVertex.xy  -= moveOffset;\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\r\n    fsMultipurpose.y = seg.distAlong;\r\n    fsMultipurpose.z = seg.distTotal;\r\n    fsMultipurpose.w = seg.lineType;\r\n\r\n    if (seg.lineWidthHalf < 0.0)\r\n        fsHalfWidth = -fsHalfWidth;\r\n}\r\n\r\n\r\n#ifdef HAS_TRIANGLE_GEOMS\r\nstruct TriangleData { vec2 p0, p1, p2; };\r\nvoid decodeTriangleData(out TriangleData tri) {\r\n\r\n    tri.p1 = vec2(fields2.x, fields2.y) * unpackXform.xy + unpackXform.zw;\r\n    tri.p2 = fields2.zw * unpackXform.xy + unpackXform.zw;\r\n}\r\n\r\nvoid strokeOneTriangle() {\r\n    TriangleData tri; decodeTriangleData(tri);\r\n\r\n\r\n\r\n\r\n\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n\r\n\r\n\r\n\r\n\r\n    float vertexId = getVertexId();\r\n    if (vertexId == VBB_SEG_END_RIGHT)\r\n        offsetPosition.xy = tri.p1;\r\n    else if (vertexId == VBB_SEG_END_LEFT)\r\n        offsetPosition.xy = tri.p2;\r\n}\r\n#endif\r\n\r\n\r\n\r\n\r\n#ifdef HAS_RASTER_QUADS\r\nstruct TexQuadData { float angle; vec2 size; };\r\nvoid decodeTexQuadData(out TexQuadData quad) {\r\n    quad.angle     = fields2.x * TAU;\r\n    quad.size   = fields2.yz * max(unpackXform.x, unpackXform.y);\r\n}\r\n\r\nvoid strokeTexQuad() {\r\n    TexQuadData quad; decodeTexQuadData(quad);\r\n\r\n    vec2 corner = vec2(isLeftVertex() ? -1.0 : 1.0, isStartVertex() ? -1.0 : 1.0);\r\n\r\n    vec2 p      = 0.5 * corner * quad.size;\r\n    vec2 rot    = cos_sin(quad.angle);\r\n    vec2 offset = vec2(p.x * rot.x - p.y * rot.y, p.x * rot.y + p.y * rot.x);\r\n\r\n    offsetPosition.xy += offset;\r\n\r\n    fsMultipurpose.xy = max(vec2(0.0), corner);\r\n\r\n\r\n    fsMultipurpose.z = 1.0;\r\n    fsHalfWidth = 0.0;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)\r\nstruct ArcData { vec2 c; float start, end, major, minor, tilt; };\r\nvoid decodeArcData(out ArcData arc) {\r\n    arc.c     = fields1.xy * unpackXform.xy + unpackXform.zw;\r\n    arc.start = fields2.x * TAU;\r\n    arc.end   = fields2.y * TAU;\r\n    arc.major = fields2.w * max(unpackXform.x, unpackXform.y);\r\n#if defined(HAS_ELLIPTICALS)\r\n    arc.minor = extraParams.x;\r\n    arc.tilt  = extraParams.y * TAU;\r\n#endif\r\n}\r\n\r\nvoid strokeArc(const ArcData arc) {\r\n\r\n\r\n    float isStart = isStartVertex() ? -1.0 : 1.0;\r\n    float isLeft  = isLeftVertex()  ? -1.0 : 1.0;\r\n\r\n\r\n\r\n\r\n    vec2 minPt;\r\n    vec2 maxPt;\r\n\r\n    vec2 angles = vec2(arc.start, arc.end);\r\n    vec2 endsX = vec2(arc.c.x) + arc.major * cos(angles);\r\n    vec2 endsY = vec2(arc.c.y) + arc.minor * sin(angles);\r\n    minPt = maxPt = vec2(endsX.x, endsY.x);\r\n    min_max(minPt, maxPt, vec2(endsX.y, endsY.y));\r\n\r\n    if (arc.end > arc.start) {\r\n        if (arc.start < PI_0_5 && arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI && arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 && arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    } else {\r\n\r\n        min_max(minPt, maxPt, vec2(arc.c.x + arc.major, arc.c.y));\r\n\r\n\r\n\r\n        if (arc.start < PI_0_5 || arc.end > PI_0_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\r\n        }\r\n        if (arc.start < PI || arc.end > PI) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\r\n        }\r\n        if (arc.start < PI_1_5 || arc.end > PI_1_5) {\r\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\r\n        }\r\n    }\r\n\r\n    minPt -= fsHalfWidth + aaRange;\r\n    maxPt += fsHalfWidth + aaRange;\r\n\r\n    offsetPosition.x = (isStart < 0.0) ? minPt.x : maxPt.x;\r\n    offsetPosition.y = (isLeft < 0.0)  ? minPt.y : maxPt.y;\r\n\r\n\r\n\r\n\r\n\r\n    fsMultipurpose.x = arc.start;\r\n    fsMultipurpose.y = -arc.major;\r\n    fsMultipurpose.z = arc.end;\r\n    fsMultipurpose.w = arc.minor;\r\n}\r\n#endif\r\n\r\n#if defined(HAS_CIRCLES)\r\n\r\nvoid strokeCircularArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n\r\n    float r = arc.major;\r\n    if (r * pixelsPerUnit < 0.125)\r\n        r = 0.25 * aaRange;\r\n    arc.major = arc.minor = r;\r\n\r\n    strokeArc(arc);\r\n}\r\n\r\n#endif\r\n\r\n#if defined(HAS_ELLIPTICALS)\r\nvoid strokeEllipticalArc() {\r\n    ArcData arc; decodeArcData(arc);\r\n    strokeArc(arc);\r\n}\r\n#endif\r\n\r\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\r\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\r\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\r\n    attribs.color         = getVertexColor();\r\n    attribs.geomType      = flags4b.y;\r\n    attribs.layerTC       = layerVp4b.xy / 255.0;\r\n    attribs.vpTC          = layerVp4b.zw / 255.0;\r\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\r\n    attribs.ghosting      = flags4b.w;\r\n}\r\n\r\nvoid strokeIndexedTriangle() {\r\n\r\n    fsHalfWidth = 0.0;\r\n    fsMultipurpose.z = 0.0;\r\n}\r\n\r\n#ifdef SELECTION_RENDERER\r\nbool isSelected(const CommonAttribs attribs) {\r\n\r\n\r\n    vec3 oid = getDbId().rgb;\r\n\r\n\r\n    float id01 = oid.r + oid.g * 256.0;\r\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\r\n    float flrt = floor(t);\r\n    float texU = t - flrt;\r\n\r\n\r\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\r\n    t = (id23 + 0.5) / vSelTexSize.y;\r\n    float texV = fract(t);\r\n\r\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\r\n    return selBit.r == 1.0;\r\n}\r\n#endif\r\n\r\nbool isLayerOff(const CommonAttribs attribs) {\r\n#ifdef HAS_LAYERS\r\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\r\n    return (layerBit.r == 0.0);\r\n#else\r\n    return false;\r\n#endif\r\n}\r\n\r\nvec4 getColor(const CommonAttribs attribs) {\r\n\r\n    if (isLayerOff(attribs)) { return vec4(0.0); }\r\n\r\n#ifdef SELECTION_RENDERER\r\n    if (isSelected(attribs)) { return selectionColor; }\r\n    return vec4(0.0);\r\n#else\r\n    return attribs.color;\r\n#endif\r\n}\r\n\r\n#ifdef GAMMA_INPUT\r\nvec4 inputToLinear(vec4 c) {\r\n    return vec4(vec3(c*c), c.a);\r\n}\r\n#endif\r\n\r\nvoid main() {\r\n#ifndef UNPACK_POSITIONS\r\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\r\n#endif\r\n\r\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\r\n#ifdef MSDF_TEXTURE_FONT\r\n    vuv = fields2.xy;\r\n    isMSDFQuards = 1.0 - abs(sign(attribs.geomType - VBB_GT_MSDF_TRIANGLE_INDEXED));\r\n#endif\r\n\r\n#ifdef IMAGE_UV_TEXTURE\r\n    vuv = fields2.xy;\r\n#endif\r\n\r\n    fsColor = getColor(attribs);\r\n\r\n    #ifdef GAMMA_INPUT\r\n    fsColor = inputToLinear(fsColor);\r\n    #endif\r\n\r\n\r\n    if (swap != 0.0 ) {\r\n\r\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\r\n            fsColor.rgb = vec3(1.0,1.0,1.0);\r\n\r\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\r\n            fsColor.rgb = vec3(0.0,0.0,0.0);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    centralVertex = offsetPosition = attribs.pos;\r\n\r\n    float lineWeight = attribs.lineWidthHalf;\r\n    if (lineWeight > 0.0) {\r\n\r\n\r\n        if(lineWeight < 0.5 / pixelsPerUnit) {\r\n            lineWeight = 0.5 / pixelsPerUnit;\r\n        }\r\n    }\r\n    else {\r\n\r\n\r\n        lineWeight = abs(lineWeight) / pixelsPerUnit;\r\n    }\r\n\r\n    fsHalfWidth = lineWeight;\r\n\r\n    dbId = getDbId() / 255.0;\r\n\r\n    fsVpTC     = attribs.vpTC;\r\n    fsGhosting = attribs.ghosting;\r\n\r\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_START || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_END || attribs.geomType == VBB_GT_LINE_SEGMENT_MITER)     strokeLineSegment();\r\n#ifdef HAS_CIRCLES\r\n    else if (attribs.geomType == VBB_GT_ARC_CIRCULAR)     strokeCircularArc();\r\n#endif\r\n#ifdef HAS_ELLIPTICALS\r\n    else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL)   strokeEllipticalArc();\r\n#endif\r\n#ifdef HAS_RASTER_QUADS\r\n    else if (attribs.geomType == VBB_GT_TEX_QUAD)         strokeTexQuad();\r\n#endif\r\n#ifdef HAS_TRIANGLE_GEOMS\r\n    else if (attribs.geomType == VBB_GT_ONE_TRIANGLE)     strokeOneTriangle();\r\n#endif\r\n    else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED) strokeIndexedTriangle();\r\n\r\n\r\n\r\n    fsOffsetDirection = offsetPosition - centralVertex;\r\n\r\n\r\n    gl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n#include <logdepthbuf_vert>\r\n\r\n#ifdef LOADING_ANIMATION\r\n\r\n    if (dbId.rgb == vec3(1.0)) {\r\n        loadingProgress = 1.0;\r\n    } else {\r\n        loadingProgress = smoothstep(0.0, 1.0, meshAnimTime);\r\n    }\r\n#endif\r\n\r\n#ifdef IMAGE_UV_TEXTURE\r\n    fsHalfWidth = 0.0;\r\n#endif\r\n\r\n\r\n#if NUM_CUTPLANES > 0\r\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\r\n    vWorldPosition = worldPosition.xyz;\r\n#endif\r\n\r\n#ifdef VIEWPORT_CLIPPING\r\n    vPosition = offsetPosition.xy;\r\n#endif\r\n}\r\n"},59191:e=>{e.exports="\n#define LINE_SS\n#include <line_decl_common>\n#include <id_decl_frag>\n#include <logdepthbuf_decl_frag>\nuniform highp float aaRange;\nuniform float opacity;\nuniform highp float viewportId;\nuniform highp float swap;\nuniform highp float grayscale;\n#ifdef HAS_LINESTYLES\nuniform sampler2D tLineStyle;\nuniform vec2 vLineStyleTexSize;\nvarying highp float vPixelsPerUnit;\n#endif\n#ifdef VIEWPORT_CLIPPING\nuniform highp vec4 viewportBounds;\nvarying highp vec2 vPosition;\nuniform mat4 mvpMatrix;\nuniform mat4 modelMatrix;\n#endif\nfloat curveGaussian(float r, float width) {\n    float amt = clamp(abs(r / (width * 1.0)), 0.0, 1.0);\n    amt = max(amt - 0.0, 0.0);\n    float exponent = amt * 2.0;\n    return clamp(exp(-exponent*exponent), 0.0, 1.0);\n}\n#ifdef HAS_LINESTYLES\nfloat getLinePatternPixel(int i, int j) {\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\n}\nfloat getPatternLength(int whichPattern) {\n    float p1 = getLinePatternPixel(0, whichPattern);\n    float p2 = getLinePatternPixel(1, whichPattern);\n    return (p2 * 256.0 + p1);\n}\n#endif\nvoid fillLineSegment() {\n    float radius = abs(fsHalfWidth);\n    float parametricDistance = fsMultipurpose.x;\n    float segmentLength      = fsMultipurpose.y;\n    float totalDistance      = fsMultipurpose.z;\n#ifdef LOADING_ANIMATION\n    float distFromStart = parametricDistance / segmentLength;\n    if (loadingProgress < 1.0 && distFromStart > loadingProgress) {\n        discard;\n    }\n#endif\n#ifdef HAS_LINESTYLES\n    int whichPattern = int(fsMultipurpose.w);\n    float roundedEnd = fsMultipurpose.w;\n    if (whichPattern > 0) {\n        const float TEX_TO_UNIT = 1.0 / 96.0;\n        float patternScale;\n        if (fsHalfWidth < 0.0) {\n            patternScale = LTSCALE;\n        } else {\n            patternScale = LTSCALE * TEX_TO_UNIT * vPixelsPerUnit;\n        }\n        float patLen = patternScale * getPatternLength(whichPattern);\n        float phase = mod((totalDistance + parametricDistance), patLen);\n        bool onPixel = true;\n        float radiusPixels = radius + aaRange;\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\n            float on = getLinePatternPixel(i, whichPattern);\n            if (on == 1.0) on = 0.0;\n            on *= patternScale;\n            onPixel = true;\n            phase -= on;\n            if (phase < 0.0) {\n                break;\n            }\n            else if (phase <= radiusPixels) {\n                onPixel = false;\n                break;\n            }\n            float off = getLinePatternPixel(i+1, whichPattern);\n            if (off <= 1.0) off = 0.0;\n            off *= patternScale;\n            onPixel = false;\n            phase -= off;\n            if (phase < -radiusPixels)\n                discard;\n            if (phase <= 0.0)\n                break;\n        }\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\n            segmentLength = 0.0;\n            parametricDistance = phase;\n        }\n    }\n#else\n    float roundedEnd = fsMultipurpose.w;\n#endif\n    float dist;\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\n    float ltz = max(0.0, sign(-parametricDistance));\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\n    float range =  dist - radius;\n    if (roundedEnd<0.25) {\n        float buttRange = max(-parametricDistance, parametricDistance - segmentLength);\n        range = max(range, buttRange);\n    }\n    if (range > aaRange) {\n        discard;\n    }\n    gl_FragColor = fsColor;\n    if (range > -aaRange)\n        gl_FragColor.a *= curveGaussian(range+aaRange, aaRange * 2.0);\n}\n#ifdef LOADING_ANIMATION\n    void fillTriangle() { gl_FragColor = vec4(fsColor.rgb, fsColor.a * loadingProgress); }\n#else\n    void fillTriangle() { gl_FragColor = fsColor; }\n#endif\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include <cutplanes>\nfloat getSide(vec2 a, vec2 b, vec2 c) {\n    return sign((b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x));\n}\nvoid main() {\n    if (fsColor == vec4(0.0)) {\n        discard;\n    }\n#ifdef VIEWPORT_CLIPPING\n    vec2 bottomLeft = (mvpMatrix * modelMatrix * vec4(viewportBounds.xy, 0., 1.)).xy;\n    vec2 bottomRight = (mvpMatrix * modelMatrix * vec4(viewportBounds.zy, 0., 1.)).xy;\n    vec2 topRight = (mvpMatrix * modelMatrix * vec4(viewportBounds.zw, 0., 1.)).xy;\n    vec2 topLeft = (mvpMatrix * modelMatrix * vec4(viewportBounds.xw, 0., 1.)).xy;\n    float side = getSide(topLeft, topRight, bottomLeft);\n    if (side * getSide(topRight, bottomRight, vPosition) < 0.0 ||\n        side * getSide(bottomRight, bottomLeft, vPosition) < 0.0 ||\n        side * getSide(bottomLeft, topLeft, vPosition) < 0.0 ||\n        side * getSide(topLeft, topRight, vPosition) < 0.0) {\n        discard;\n    }\n#endif\n    if (fsHalfWidth == 0.0) {\n        fillTriangle();\n    }\n    else\n        fillLineSegment();\n    float writeId = 1.0;\n    gl_FragColor.a *= opacity;\n    if (gl_FragColor.a == 0.0) {\n        discard;\n    }\n    if (fsGhosting != 0.0 || \n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\n        writeId = 0.0;\n        gl_FragColor.a *= ((swap == 1.0) ? 0.21 : 0.1);\n    }\n#ifndef SELECTION_RENDERER\n    if (grayscale != 0.0) {\n        const vec3 rgb2grey = vec3(0.299, 0.587, 0.114);\n        float gray = dot(gl_FragColor.rgb, rgb2grey);\n        gl_FragColor.rgb = vec3(gray);\n    }\n#endif\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#ifdef MRT_NORMALS\n    outNormal = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\n#ifdef NO_ID_OUTPUT\n    writeId = 0.0;\n#endif\n#include <id_frag>\n#include <logdepthbuf_frag>\n}\n"},84325:e=>{e.exports="\n#include <line_decl_common>\n#include <logdepthbuf_decl_vert>\nattribute vec2 fields1;\nattribute vec4 fields2;\nattribute vec4 flags4b;\nattribute vec4 layerVp4b;\n#ifdef HAS_MITER_LINES\nattribute vec3 extraParams;\nuniform float miterLimit;\nuniform float miterScaleFactor;\nuniform float miterCP;\n#endif\n#ifdef USE_INSTANCING\nattribute vec4 instFlags4b;\n#endif\n#ifdef VIEWPORT_CLIPPING\nvarying vec2 vPosition;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\nuniform vec2 size;\nuniform float viewportId;\nuniform float swap;\nuniform vec3 cameraPos;\nuniform float tanHalfFov;\n#ifdef HAS_LINESTYLES\nvarying float vPixelsPerUnit;\n#endif\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\n#ifdef SELECTION_RENDERER\nuniform vec4 selectionColor;\n#endif\n#ifdef LOADING_ANIMATION\nuniform float meshAnimTime;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvarying vec4 dbId;\n#ifdef UNPACK_POSITIONS\nuniform sampler2D tIdColor;\nuniform vec2 vIdColorTexSize;\nuniform vec4 unpackXform;\nattribute vec2 uvIdColor;\nfloat unpackLineWeight(float w) {\n    if (w > 0.5) {\n        return - (w - 0.5) * 1024.0;\n    } else {\n        return w * max(unpackXform.x, unpackXform.y) * 2.0;\n    }\n}\nvec4 getVertexColor() {\n    float u = (uvIdColor.x + 0.5) / vIdColorTexSize.x;\n    return texture2D(tIdColor, vec2(u, 0.5));\n}\nvec4 getDbId() {\n    float u = (uvIdColor.y + 0.5) / vIdColorTexSize.x;\n    vec4 normDbId = texture2D(tIdColor, vec2(u, 0.5));\n    return normDbId * 255.0;\n}\n#else\nattribute vec4 color4b;\nattribute vec4 dbId4b;\nvec4 unpackXform;\nfloat unpackLineWeight(float w) {\n    return w;\n}\nvec4 getVertexColor() {\n    return color4b;\n}\nvec4 getDbId() {\n    return dbId4b;\n}\n#endif\nvec2 centralVertex;\nvec2 offsetPosition;\nvec2 offsetPosDepth;\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\n    minPt = min(minPt, p);\n    maxPt = max(maxPt, p);\n}\n#if defined(USE_INSTANCING)\nfloat getVertexId() { return instFlags4b.x; }\n#else\nfloat getVertexId() { return flags4b.x; }\n#endif\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\nvoid decodeSegmentData(out SegmentData seg) {\n    seg.angle         = fields2.x * TAU - PI;\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\n    seg.distTotal     = fields2.w;\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\n    seg.lineType      = flags4b.z;\n}\nvoid strokeLineSegment(float geomType) {\n    SegmentData seg; decodeSegmentData(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    vec4 startPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n    float distanceAlong = seg.distAlong;\n    vec2 along = distanceAlong * cos_sin(seg.angle);\n    vec4 endPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along, 0.0, 1.0));\n    vec2 screenStart = startPosition.xy * 0.5 * size / startPosition.w;\n    vec2 screenEnd = endPosition.xy * 0.5 * size / endPosition.w;\n    float roundedEnd = 0.0;\n    if (isStartCapVertex < 0.0) {\n        offsetPosition = centralVertex = screenStart;\n        offsetPosDepth = startPosition.zw;\n        roundedEnd = (geomType == VBB_GT_LINE_SEGMENT || geomType == VBB_GT_LINE_SEGMENT_CAPPED_END) ? 0.5 : 0.0;\n    } else {\n        offsetPosition = centralVertex = screenEnd;\n        offsetPosDepth = endPosition.zw;\n        roundedEnd = (geomType == VBB_GT_LINE_SEGMENT || geomType == VBB_GT_LINE_SEGMENT_CAPPED_START) ? 0.5 : 0.0;\n    }\n#ifdef HAS_LINESTYLES\n    roundedEnd += seg.lineType;\n#endif\n    vec2 screenDelta = screenEnd - screenStart;\n    float screenAngle = (distanceAlong == 0.0) ? 0.0 : atan(screenDelta.y, screenDelta.x);\n    float angleTransverse = screenAngle - isLeftSide * HALF_PI;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    vec2 transverseDir = cos_sin(angleTransverse);\n    offsetPosition += transverseDir * lwAdjustment;\n    fsOffsetDirection = offsetPosition - centralVertex;\n    float distanceFromStart = max(0.0, isStartCapVertex) * length(screenDelta);\n    float segmentExtension = (roundedEnd > 0.0) ? lwAdjustment : aaRange;\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseDir.y, transverseDir.x) * segmentExtension;\n    offsetPosition += moveOffset;\n    fsMultipurpose.x = (isStartCapVertex * segmentExtension) + distanceFromStart;\n    fsMultipurpose.y = length(screenDelta);\n    fsMultipurpose.z = seg.distTotal;\n    fsMultipurpose.w = roundedEnd;\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n    gl_Position = vec4(2.0 * offsetPosition / size * offsetPosDepth.y, offsetPosDepth.xy);\n#include <logdepthbuf_vert>\n}\n#ifdef HAS_MITER_LINES\nstruct MiterSegmentData { float angle, distAlong, distAlongPN, anglePrev, angleNext, lineWidthHalf, lineType; };\nvoid decodeMiterSegment(out MiterSegmentData seg) {\n    seg.angle         = fields2.x * TAU - PI;\n    seg.distAlong     = fields2.y * max(unpackXform.x, unpackXform.y);\n    seg.anglePrev     = fields2.w * TAU - PI;\n    seg.lineWidthHalf = unpackLineWeight(fields2.z);\n    seg.lineType      = flags4b.z;\n    seg.angleNext     = extraParams.x * TAU - PI;\n    seg.distAlongPN   = extraParams.y * max(unpackXform.x, unpackXform.y);\n}\nvoid strokeMiterLineSegment() {\n    MiterSegmentData seg; decodeMiterSegment(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    float next = floor(seg.distAlongPN / miterCP);\n    float prev = seg.distAlongPN - (next * miterCP);\n    float distanceAlongNext = floor(next) / miterScaleFactor;\n    float distanceAlongPrev = floor(prev) / miterScaleFactor;\n    float distanceAlong = seg.distAlong;\n    vec2 along  = cos_sin(seg.anglePrev) * distanceAlongPrev;\n    vec2 along2 = cos_sin(seg.angle) * distanceAlong;\n    vec2 along3 = along2 + cos_sin(seg.angleNext) * distanceAlongNext;\n    vec4 prevPosition  = (mvpMatrix * modelMatrix * vec4(centralVertex.xy - along , 0.0, 1.0));\n    vec4 startPosition = (mvpMatrix * modelMatrix * vec4(centralVertex.xy         , 0.0, 1.0));\n    vec4 endPosition   = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along2, 0.0, 1.0));\n    vec4 nextPosition  = (mvpMatrix * modelMatrix * vec4(centralVertex.xy + along3, 0.0, 1.0));\n    vec2 screenPrev  = prevPosition.xy  * 0.5 * size / prevPosition.w;\n    vec2 screenStart = startPosition.xy * 0.5 * size / startPosition.w;\n    vec2 screenEnd   = endPosition.xy   * 0.5 * size / endPosition.w;\n    vec2 screenNext  = nextPosition.xy  * 0.5 * size / nextPosition.w;\n    if (isStartCapVertex < 0.0) {\n        offsetPosition = centralVertex = screenStart;\n        offsetPosDepth = startPosition.zw;\n    } else {\n        offsetPosition = centralVertex = screenEnd;\n        offsetPosDepth = endPosition.zw;\n    }\n    vec2 screenDelta = screenEnd - screenStart;\n    vec2 AB = normalize(screenStart.xy - screenPrev.xy);\n    vec2 BC = normalize(screenDelta);\n    vec2 CD = normalize(screenNext.xy - screenEnd.xy);\n    vec2 a = screenPrev;\n    vec2 b = screenStart;\n    vec2 c = screenEnd;\n    vec2 d = screenNext;\n    vec2 p = (isStartCapVertex < 0.0) ? a : d;\n    vec2 a2 = (isStartCapVertex < 0.0) ? a : c;\n    vec2 b2 = (isStartCapVertex < 0.0) ? b : d;\n    vec2 p2 = (isStartCapVertex < 0.0) ? c : b;\n    vec2 PP = (isStartCapVertex < 0.0) ? AB : CD;\n    vec2 normalBC = vec2(-BC.y, BC.x);\n    vec2 normalPP = vec2(-PP.y, PP.x);\n    float pIsLeftOfBC = ((c.x - b.x)*(p.y - b.y) - (c.y - b.y)*(p.x - b.x)) > 0.0 ? 1.0 : -1.0;\n    vec2 bN = b + normalBC * fsHalfWidth * pIsLeftOfBC;\n    vec2 cN = c + normalBC * fsHalfWidth * pIsLeftOfBC;\n    vec2 pN = p + normalPP * fsHalfWidth * pIsLeftOfBC;\n    float isPIntersecting = ((cN.x - bN.x)*(pN.y - bN.y) - (cN.y - bN.y)*(pN.x - bN.x)) * pIsLeftOfBC;\n    float p2IsLeftOfPP = ((b2.x - a2.x)*(p2.y - a2.y) - (b2.y - a2.y)*(p2.x - a2.x)) > 0.0 ? 1.0 : -1.0;\n    vec2 a2N = a2 + normalPP * fsHalfWidth * p2IsLeftOfPP;\n    vec2 b2N = b2 + normalPP * fsHalfWidth * p2IsLeftOfPP;\n    vec2 p2N = p2 + normalBC * fsHalfWidth * p2IsLeftOfPP;\n    float isP2Intersecting = ((b2N.x - a2N.x)*(p2N.y - a2N.y) - (b2N.y - a2N.y)*(p2N.x - a2N.x)) * p2IsLeftOfPP;\n    float tangentLength = (isStartCapVertex < 0.0) ? length(AB + BC) : length(BC + CD);\n    vec2 tangent = (isStartCapVertex < 0.0) ? normalize(AB + BC) : normalize(BC + CD);\n    vec2 miter = vec2(-tangent.y, tangent.x);\n    vec2 normal = (isStartCapVertex < 0.0) ? vec2(-AB.y, AB.x) : vec2(-BC.y, BC.x);\n    float miterLength = abs(1.0 / dot(miter, normal));\n    vec2 moveOffset;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    if (miterLength > miterLimit || min(isPIntersecting, isP2Intersecting) < 0.0) {\n        moveOffset = isLeftSide * lwAdjustment * normalBC;\n    } else {\n        moveOffset = isLeftSide * miter * lwAdjustment * miterLength;\n    }\n    offsetPosition += moveOffset;\n    float distanceFromStart = max(0.0, isStartCapVertex) * (length(screenDelta) + dot(moveOffset, BC));\n    fsMultipurpose.x = distanceFromStart;\n    fsMultipurpose.y = length(screenDelta) + dot(moveOffset, BC);\n    fsMultipurpose.z = 0.0;\n#ifdef HAS_LINESTYLES\n    fsMultipurpose.w = seg.lineType + 0.5;\n#else\n    fsMultipurpose.w = 0.5;\n#endif\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n    fsOffsetDirection = offsetPosition - BC * dot(moveOffset, BC) - centralVertex;\n    gl_Position = vec4(2.0 * offsetPosition / size * offsetPosDepth.y, offsetPosDepth.xy);\n#include <logdepthbuf_vert>    \n}\n#endif\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\n    attribs.pos           = fields1.xy * unpackXform.xy + unpackXform.zw;\n    attribs.color         = getVertexColor();\n    attribs.geomType      = flags4b.y;\n    attribs.layerTC       = layerVp4b.xy / 255.0;\n    attribs.vpTC          = layerVp4b.zw / 255.0;\n    attribs.lineWidthHalf = unpackLineWeight(fields2.z);\n    attribs.ghosting      = flags4b.w;\n}\nvoid strokeIndexedTriangle() {\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n    gl_Position = (mvpMatrix * modelMatrix * vec4(centralVertex.xy, 0.0, 1.0));\n#include <logdepthbuf_vert>    \n}\n#ifdef SELECTION_RENDERER\nbool isSelected(const CommonAttribs attribs) {\n    vec3 oid = getDbId().rgb;\n    float id01 = oid.r + oid.g * 256.0;\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\n    float flrt = floor(t);\n    float texU = t - flrt;\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\n    t = (id23 + 0.5) / vSelTexSize.y;\n    float texV = fract(t);\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\n    return selBit.r == 1.0;\n}\n#endif\nbool isLayerOff(const CommonAttribs attribs) {\n#ifdef HAS_LAYERS\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\n    return (layerBit.r == 0.0);\n#else\n    return false;\n#endif\n}\nvec4 getColor(const CommonAttribs attribs) {\n    if (isLayerOff(attribs)) { return vec4(0.0); }\n#ifdef SELECTION_RENDERER\n    if (isSelected(attribs)) { return selectionColor; }\n    return vec4(0.0);\n#else\n    return attribs.color;\n#endif\n}\n#ifdef GAMMA_INPUT\nvec4 inputToLinear(vec4 c) {\n    return vec4(vec3(c*c), c.a);\n}\n#endif\nvoid main() {\n#ifndef UNPACK_POSITIONS\n    unpackXform = vec4(1.0, 1.0, 0.0, 0.0);\n#endif\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\n    fsColor = getColor(attribs);\n    #ifdef GAMMA_INPUT\n    fsColor = inputToLinear(fsColor);\n    #endif\n    if (swap != 0.0 ) {\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\n            fsColor.rgb = vec3(1.0,1.0,1.0);\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\n            fsColor.rgb = vec3(0.0,0.0,0.0);\n    }\n    centralVertex = offsetPosition = attribs.pos;\n    float lineWeight = attribs.lineWidthHalf;\n    float ppu = pixelsPerUnit;\n    if (tanHalfFov > 0.0) {\n        vec4 worldPos = modelMatrix * vec4(offsetPosition.xy, 0.0, 1.0);\n        float distanceToCamera = length(cameraPos - worldPos.xyz);\n        ppu = size.y / (2.0 * distanceToCamera * tanHalfFov);\n    }\n#ifdef HAS_LINESTYLES\n    vPixelsPerUnit = ppu;\n#endif\n    if (lineWeight > 0.0) {\n        lineWeight = max(0.5, lineWeight * ppu);\n    }\n    else {\n        lineWeight = max(0.5, abs(lineWeight));\n    }\n    fsHalfWidth = lineWeight;\n    dbId = dbId4b / 255.0;\n    fsVpTC     = attribs.vpTC;\n    fsGhosting = attribs.ghosting;\n#ifdef LOADING_ANIMATION\n    if (dbId.rgb == vec3(1.0)) {\n        loadingProgress = 1.0;\n    } else {\n        loadingProgress = smoothstep(0.0, 1.0, meshAnimTime);\n    }\n#endif\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_START || attribs.geomType == VBB_GT_LINE_SEGMENT_CAPPED_END)     strokeLineSegment(attribs.geomType);\n#ifdef HAS_MITER_LINES\n    else if (attribs.geomType == VBB_GT_LINE_SEGMENT_MITER) strokeMiterLineSegment();\n#endif\n    else strokeIndexedTriangle();\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef VIEWPORT_CLIPPING\n    vPosition = gl_Position.xy;\n#endif\n}\n"},74957:e=>{e.exports="varying highp vec3 vNormal;\nvarying highp float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include <cutplanes>\n#include <logdepthbuf_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 n = vNormal;\n    n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n    n = normalize( n );\n    gl_FragColor = vec4(n.x, n.y, depth, 1.0);\n#include <logdepthbuf_frag>\n}\n"},5030:e=>{e.exports="varying vec3 vNormal;\nvarying float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include <pack_normals>\n#include <instancing_decl_vert>\n#include <logdepthbuf_decl_vert>\nvoid main() {\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    depth = mvPosition.z;\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n#include <logdepthbuf_vert>\n}\n"},83039:e=>{e.exports="uniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\n\r\n#include <logdepthbuf_decl_frag>\r\n\r\n#include <env_sample>\r\n\r\n#ifdef USE_COLOR\r\nvarying vec3 vColor;\r\n#endif\r\n\r\n#ifdef GAMMA_INPUT\r\nvec3 InputToLinear(vec3 c) {\r\n    return c * c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c * c;\r\n}\r\n#else\r\nvec3 InputToLinear(vec3 c) {\r\n    return c;\r\n}\r\nfloat InputToLinear(float c) {\r\n    return c;\r\n}\r\n#endif\r\n\r\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\r\nvarying vec2 vUv;\r\n#endif\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\nvarying vec2 vUvBump;\r\n#endif\r\n\r\n#if defined( USE_ALPHAMAP )\r\nvarying vec2 vUvAlpha;\r\n#endif\r\n\r\n#ifdef USE_MAP\r\nuniform sampler2D map;\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT > 0\r\nuniform float exposureBias;\r\n#include <tonemap>\r\n#endif\r\n\r\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\r\nuniform float envMapExposure;\r\n#endif\r\n\r\n#ifdef USE_FOG\r\nuniform vec3 fogColor;\r\nuniform float fogNear;\r\nuniform float fogFar;\r\n#endif\r\n#include <id_decl_frag>\r\n#include <theming_decl_frag>\r\n#include <shadowmap_decl_frag>\r\n\r\n#ifdef USE_ENVMAP\r\n\r\nuniform float reflMipIndex;\r\n\r\nuniform float reflectivity;\r\nuniform samplerCube envMap;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\nuniform float refractionRatio;\r\n\r\n#endif\r\n\r\nvec3 sampleReflection(vec3 dir, float mipIndex) {\r\n\r\n    vec3 adjDir = adjustLookupVector(dir);\r\n\r\n#ifdef ENV_GAMMA\r\n\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n    return GammaDecode(envTexColor, envMapExposure);\r\n\r\n#elif defined(ENV_RGBM)\r\n\r\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\r\n    return RGBMDecode(envTexColor, envMapExposure);\r\n\r\n#else\r\n\r\n\r\n\r\n    vec4 envTexColor = textureCube( envMap, adjDir );\r\n    vec3 cubeColor = envTexColor.xyz;\r\n\r\n#ifdef GAMMA_INPUT\r\n    cubeColor *= cubeColor;\r\n#endif\r\n\r\n    return cubeColor;\r\n\r\n#endif\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\nuniform vec3 ambientLightColor;\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\r\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\r\n\r\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\r\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\r\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\r\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\r\n\r\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\r\n\r\n#endif\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\nuniform samplerCube irradianceMap;\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\r\nvarying highp vec3 vWorldPosition;\r\n#endif\r\n\r\nvarying highp vec3 vViewPosition;\r\n#ifndef FLAT_SHADED\r\nvarying highp vec3 vNormal;\r\n#endif\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\nuniform sampler2D bumpMap;\r\nuniform float bumpScale;\r\n\r\n\r\n\r\n\r\n\r\n\r\nvec2 dHdxy_fwd() {\r\n\r\n    vec2 dSTdx = dFdx( vUvBump );\r\n    vec2 dSTdy = dFdy( vUvBump );\r\n\r\n    float Hll = bumpScale * GET_BUMPMAP(vUvBump).x;\r\n    float dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\r\n    float dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\r\n\r\n    return vec2( dBx, dBy );\r\n\r\n}\r\n\r\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\r\n\r\n    vec3 vSigmaX = dFdx( surf_pos );\r\n    vec3 vSigmaY = dFdy( surf_pos );\r\n    vec3 vN = surf_norm;\r\n\r\n    vec3 R1 = cross( vSigmaY, vN );\r\n    vec3 R2 = cross( vN, vSigmaX );\r\n\r\n    float fDet = dot( vSigmaX, R1 );\r\n\r\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\r\n    return normalize( abs( fDet ) * surf_norm - vGrad );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_NORMALMAP\r\n\r\nuniform sampler2D normalMap;\r\nuniform vec2 normalScale;\r\n\r\n\r\n\r\n\r\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\r\n\r\n    vec3 q0 = dFdx( eye_pos.xyz );\r\n    vec3 q1 = dFdy( eye_pos.xyz );\r\n    vec2 st0 = dFdx( vUvBump.st );\r\n    vec2 st1 = dFdy( vUvBump.st );\r\n\r\n    vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\r\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\r\n    vec3 N = normalize( surf_norm );\r\n\r\n    vec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;\r\n    mapN.xy = normalScale * mapN.xy;\r\n    mat3 tsn = mat3( S, T, N );\r\n    return normalize( tsn * mapN );\r\n\r\n}\r\n\r\n#endif\r\n\r\n\r\n#ifdef USE_SPECULARMAP\r\nuniform sampler2D specularMap;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\nuniform sampler2D alphaMap;\r\n#endif\r\n\r\n#include <hatch_pattern>\r\n\r\nvec3 Schlick_v3(vec3 v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + (1.0 - v) * pow(facing, 5.0);\r\n}\r\n\r\nfloat Schlick_f(float v, float cosHV) {\r\n    float facing = max(1.0 - cosHV, 0.0);\r\n    return v + ( 1.0 - v ) * pow(facing, 5.0);\r\n}\r\n\r\n#include <cutplanes>\r\n\r\nvoid main() {\r\n\r\n#if NUM_CUTPLANES > 0\r\n    checkCutPlanes(vWorldPosition);\r\n#endif\r\n\r\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\r\n\r\n#ifdef USE_MAP\r\n    vec4 texelColor = GET_MAP(vUv);\r\n#ifdef MAP_INVERT\r\n    texelColor.xyz = 1.0-texelColor.xyz;\r\n#endif\r\n#ifdef GAMMA_INPUT\r\n    texelColor.xyz *= texelColor.xyz;\r\n#endif\r\n    gl_FragColor = gl_FragColor * texelColor;\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\n    vec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);\r\n    gl_FragColor.a *= texelAlpha.r;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n    if ( gl_FragColor.a < ALPHATEST ) discard;\r\n#endif\r\n\r\n    float specularStrength;\r\n\r\n#ifdef USE_SPECULARMAP\r\n    vec4 texelSpecular = GET_SPECULARMAP(vUv);\r\n    specularStrength = texelSpecular.r;\r\n#else\r\n    specularStrength = 1.0;\r\n#endif\r\n\r\n#ifndef FLAT_SHADED\r\n    vec3 normal = normalize( vNormal );\r\n#ifdef DOUBLE_SIDED\r\n\r\n#endif\r\n#else\r\n    vec3 fdx = dFdx( vViewPosition );\r\n    vec3 fdy = dFdy( vViewPosition );\r\n    vec3 normal = normalize( cross( fdx, fdy ) );\r\n#endif\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 viewDirection;\r\n    if (projectionMatrix[3][3] == 0.0) {\r\n        viewDirection = normalize( vViewPosition );\r\n    } else {\r\n        viewDirection = vec3(0.0, 0.0, 1.0);\r\n    }\r\n    normal = faceforward(normal, -viewDirection, normal);\r\n\r\n    vec3 geomNormal = normal;\r\n\r\n#ifdef USE_NORMALMAP\r\n    normal = perturbNormal2Arb( -vViewPosition, normal );\r\n#elif defined( USE_BUMPMAP )\r\n    normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\r\n#endif\r\n\r\n    vec3 totalDiffuse = vec3( 0.0 );\r\n    vec3 totalSpecular = vec3( 0.0 );\r\n\r\n\r\n\r\n    float shininessB = shininess * 4.0;\r\n\r\n#if MAX_POINT_LIGHTS > 0\r\n\r\n    vec3 pointDiffuse  = vec3( 0.0 );\r\n    vec3 pointSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( pointLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, lVector );\r\n\r\n        float pointDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n\r\n        pointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\r\n\r\n\r\n\r\n        vec3 pointHalfVector = normalize( lVector + viewDirection );\r\n        float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\r\n\r\n        float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\r\n        pointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\r\n\r\n    }\r\n\r\n    totalDiffuse += pointDiffuse;\r\n    totalSpecular += pointSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_SPOT_LIGHTS > 0\r\n\r\n    vec3 spotDiffuse  = vec3( 0.0 );\r\n    vec3 spotSpecular = vec3( 0.0 );\r\n\r\n    for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\r\n\r\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\r\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\r\n\r\n        float lDistance = 1.0;\r\n        if ( spotLightDistance[ i ] > 0.0 )\r\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\r\n\r\n        lVector = normalize( lVector );\r\n\r\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\r\n\r\n        if ( spotEffect > spotLightAngleCos[ i ] ) {\r\n\r\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\r\n\r\n\r\n\r\n            float dotProduct = dot( normal, lVector );\r\n\r\n            float spotDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n            spotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\r\n\r\n\r\n\r\n            vec3 spotHalfVector = normalize( lVector + viewDirection );\r\n            float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\r\n            float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\r\n\r\n            float specularNormalization = shininessB * 0.125 + 0.25;\r\n            vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\r\n            spotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\r\n        }\r\n\r\n    }\r\n\r\n    totalDiffuse += spotDiffuse;\r\n    totalSpecular += spotSpecular;\r\n\r\n#endif\r\n\r\n#if MAX_DIR_LIGHTS > 0\r\n\r\n    vec3 dirDiffuse  = vec3( 0.0 );\r\n    vec3 dirSpecular = vec3( 0.0 );\r\n\r\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\r\n\r\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\r\n        vec3 dirVector = normalize( lDirection.xyz );\r\n\r\n\r\n\r\n        float dotProduct = dot( normal, dirVector );\r\n\r\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\r\n\r\n        dirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\r\n\r\n\r\n\r\n        vec3 dirHalfVector = normalize( dirVector + viewDirection );\r\n        float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\r\n        float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\r\n\r\n        float specularNormalization = shininessB * 0.125 + 0.25;\r\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\r\n\r\n        dirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\r\n\r\n    }\r\n\r\n    totalDiffuse += dirDiffuse;\r\n    totalSpecular += dirSpecular;\r\n\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_IRRADIANCEMAP\r\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\r\n    vec3 indirectDiffuse = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\r\n\r\n    indirectDiffuse = applyEnvShadow(indirectDiffuse, worldNormal);\r\n\r\n    totalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\r\n#endif\r\n\r\n\r\n#ifdef METAL\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\r\n#else\r\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_COLOR\r\n    gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\r\n#endif\r\n\r\n\r\n#if defined(USE_ENVMAP)\r\n\r\n    vec3 reflectVec;\r\n\r\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\n#ifdef ENVMAP_MODE_REFLECTION\r\n    reflectVec = reflect( -viewDirection, normal );\r\n#else \r\n    reflectVec = refract( -viewDirection, normal, refractionRatio );\r\n#endif\r\n\r\n#else\r\n\r\n    reflectVec = reflect( -viewDirection, normal );\r\n\r\n#endif\r\n\r\n    reflectVec = mat3(viewMatrixInverse) * reflectVec;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float reflectScale = 1.0;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    vec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\r\n\r\n    cubeColor *= reflectScale;\r\n\r\n    float facing = dot( viewDirection, normal );\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    if (facing < -1e-2  || reflectivity == 0.0)\r\n        facing = 1.0;\r\n    else\r\n        facing = max(1e-6, facing);\r\n\r\n#ifdef USE_BUMPMAP\r\n\r\n\r\n\r\n    facing = min(1.0, facing + bumpScale * 7.0);\r\n\r\n#endif\r\n\r\n    vec3 schlickRefl;\r\n\r\n#ifdef METAL\r\n\r\n\r\n    schlickRefl = InputToLinear(specular);\r\n\r\n#else\r\n\r\n\r\n    schlickRefl = Schlick_v3(InputToLinear(specular), facing);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    gl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    float invSchlick = pow(1.0 - facing * 0.5, 5.0);\r\n\r\n\r\n    float norm_factor = (28.0 / 23.0) * (1.0 - invSchlick) * (1.0 - invSchlick);\r\n\r\n    gl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\r\n\r\n#endif\r\n\r\n\r\n    gl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\r\n\r\n#ifdef CLEARCOAT\r\n\r\n    vec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\r\n    reflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;\r\n\r\n    vec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\r\n\r\n\r\n    float schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\r\n\r\n\r\n\r\n    gl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\r\n\r\n#endif\r\n\r\n\r\n\r\n\r\n#endif\r\n\r\n#if TONEMAP_OUTPUT == 1\r\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\r\n#elif TONEMAP_OUTPUT == 2\r\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );\r\n#endif\r\n\r\n\r\n\r\n#ifdef USE_FOG\r\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\r\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\r\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\r\n#endif\r\n#include <theming_frag>\r\n#include <final_frag>\r\n\r\n#include <logdepthbuf_frag>\r\n}\r\n"},4352:e=>{e.exports="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include <logdepthbuf_decl_vert>\n#include <pack_normals>\n#include <instancing_decl_vert>\n#include <id_decl_vert>\n#include <wide_lines_decl>\n#include <shadowmap_decl_vert>\nvoid main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n    vUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\n    vColor = color * color;\n#else\n    vColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n#include <logdepthbuf_vert>\n    \n#include <wide_lines_vert>\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include <shadowmap_vert>\n#include <id_vert>\n}\n"},50410:e=>{e.exports="\n#define EDGE_SHARPNESS     (3.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nuniform float radius;\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\n    return p.x + p.y * (1.0 / 255.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\n    float gaussian[R + 1];\n#       if R == 3\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;\n#       elif R == 4\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;\n#       elif R == 6\n    gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\n    ivec2 axisi = ivec2(axis);\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 temp = texture2D(tDiffuse, vUv);\n    gl_FragColor.gb = temp.KEY_COMPONENTS;\n    gl_FragColor.a = temp.a;\n    VALUE_TYPE sum = temp.VALUE_COMPONENTS;\n    if (temp.a == 0.0) {\n        result = sum;\n        return;\n    }\n    float key = unpackKey(keyPassThrough);\n    float BASE = gaussian[0];\n    float totalWeight = BASE;\n    sum *= totalWeight;\n    float scale = 1.5 / radius;\n    int r = -4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r=-1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    const float epsilon = 0.0001;\n    result = sum / (totalWeight + epsilon);\n}\n"},6890:e=>{e.exports="\n#include <depth_texture>\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define NUM_SPIRAL_TURNS (5)\n#define MIN_RADIUS (3.0)\n#define TAU 6.28318530718\nuniform float           projScale;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\n    float angle = alpha * (float(NUM_SPIRAL_TURNS) * TAU) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\n    return clamp( (z+cameraNear) / (cameraNear-cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\n    float temp = floor(key * 255.0);\n    p.x = temp * (1.0 / 255.0);\n    p.y = key * 255.0 - temp;\n}\n#include <pack_depth>\nfloat unpackDepthNearFar( const in vec4 rgba_depth ) {\n    float depth = unpackDepth( rgba_depth );\n    if (depth == 0.0)\n        return -cameraFar * 1.0e10;\n    return depth * (cameraNear - cameraFar) - cameraNear;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n    return cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\n    ivec2 ssP = ivec2(ssR * unitOffset) + ssC;\n    vec3 P;\n#ifdef USE_MIPMAP\n    int mipLevel = clamp(int(floor(log2(ssR))) - LOG_MAX_OFFSET, 0, MAX_MIP_LEVEL);\n    if (mipLevel == 0) {\n        P.z = texelFetch(tDepth, ssP, 0).z;\n        if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n    }\n    else if (mipLevel == 1) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip1, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip1, mipP, 0));\n    } else if (mipLevel == 2) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip2, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip2, mipP, 0));\n    } else if (mipLevel == 3) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip3, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip3, mipP, 0));\n    } else if (mipLevel == 4) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip4, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip4, mipP, 0));\n    } else if (mipLevel == 5) {\n        ivec2 mipP = clamp(ssP >> mipLevel, ivec2(0), textureSize(tDepth_mip5, 0) - ivec2(1));\n        P.z = unpackDepthNearFar(texelFetch(tDepth_mip5, mipP, 0));\n    }\n#else\n    P.z = texelFetch(tDepth, ssP, 0).z;\n    if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\n    return P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\n    float ssR;\n    vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\n    ssR = max(0.75, ssR * ssDiskRadius);\n    vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(v, n_C);\n    const float epsilon = 0.001;\n    float angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n#define HIGH_QUALITY\n#ifdef HIGH_QUALITY\n    float f = max(1.0 - vv / (radius * radius), 0.0); return angAdjust * f * max((vn - bias) / sqrt(epsilon + vv), 0.0);\n#else\n    float f = max(radius * radius - vv, 0.0); return angAdjust * f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n#endif\n}\nconst bool useNoise = true;\nfloat getRandomAngle(vec2 pos) {\n    float dt= dot(pos ,vec2(12.9898,78.233));\n    return TAU * fract(sin(mod(dt,3.14)) * 43758.5453);\n}\nvoid main() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 nrmz = texture2D(tDepth, vUv);\n    if (nrmz.z == 0.0) {\n        gl_FragColor.r = 1.0;\n        gl_FragColor.a = 0.0;\n        packKey(1.0, gl_FragColor.gb);\n        return;\n    }\n    vec3 C = getPosition(ssC, nrmz.z);\n    packKey(CSZToKey(C.z), gl_FragColor.gb);\n    float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\n    float A;\n    if (ssDiskRadius <= MIN_RADIUS) {\n        A = 1.0;\n    } else {\n        float sum = 0.0;\n        float randomPatternRotationAngle = getRandomAngle(vUv);\n        vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\n        float intensityDivR6 = intensity / pow(radius, 6.0);\n#ifdef HIGH_QUALITY\n        A = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / float(NUM_SAMPLES)))), intensity);\n#else\n        A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n#endif\n        if (abs(dFdx(C.z)) < 0.02) {\n            A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n        }\n        if (abs(dFdy(C.z)) < 0.02) {\n            A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n        }\n        A = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n    }\n    gl_FragColor.r = A;\n    gl_FragColor.a = 1.0;\n}\n"},3819:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    gl_FragColor = texture2D(tDiffuse, ssP);\n}\n"},92003:e=>{e.exports="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;\n#include <pack_depth>\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    float depth = texture2D(tDiffuse, ssP).z;\n    if (depth != 0.0)\n        depth = (depth + cameraNear) * cameraInvNearFar;\n    gl_FragColor = packDepth(depth);\n}\n"},66209:e=>{e.exports="varying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},11342:e=>{e.exports="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n"},18214:e=>{e.exports="#include <shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#include <float3_average>\n#if defined( USE_SURFACE_CUTOUT_MAP )\n    uniform sampler2D surface_cutout_map;\n    uniform mat3 surface_cutout_map_texMatrix;\n    uniform bool surface_cutout_map_invert;\n#endif\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform sampler2D alphaMap;\n#endif\n#endif\nuniform float shadowMinOpacity;\nvoid applyCutoutMaps() {\n    float opacity = 1.0;\n#ifdef USE_SURFACE_CUTOUT_MAP\n    #if defined( USE_SURFACE_CUTOUT_MAP )\n        vec2 uv_surface_cutout_map = (surface_cutout_map_texMatrix * vec3(uv, 1.0)).xy;\n        SURFACE_CUTOUT_CLAMP_TEST;\n        vec3 opacity_v3 = texture2D(surface_cutout_map, uv_surface_cutout_map).xyz;\n        if(surface_cutout_map_invert) opacity_v3 = vec3(1.0) - opacity_v3;\n        opacity = average(opacity_v3);\n    #else\n        opacity = surface_cutout;\n    #endif\n#else\n#ifdef USE_MAP\n    opacity *= GET_MAP(vUv).a;\n#endif\n#ifdef USE_ALPHAMAP\n    opacity *= GET_ALPHAMAP(vUvAlpha).r;\n#endif\n#endif\n#if defined(USE_SURFACE_CUTOUT_MAP) || defined(USE_MAP) || defined(USE_ALPHAMAP)\n    if (opacity < shadowMinOpacity) discard;\n#endif\n}\nvoid main() {\n    float normalizedLinearDepth = (depth - shadowMapRangeMin) / shadowMapRangeSize;\n    float val = exp(shadowESMConstant * normalizedLinearDepth);\n#ifdef USE_HARD_SHADOWS\n    val = normalizedLinearDepth;\n#endif\n    applyCutoutMaps();\n    gl_FragColor = vec4(val, 0, 0, 1);\n}\n"},83159:e=>{e.exports="#include <shadowmap_decl_frag>\nvoid main() {\n    float shadowIntensity = 0.5 * (1.0 - getShadowValue());\n    gl_FragColor = vec4(0.0, 0.0, 0.0, shadowIntensity);\n}\n"},2680:e=>{e.exports="#include <shadowmap_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#include <shadowmap_vert>\n}\n"},47065:e=>{e.exports="#include <shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#endif\nvoid passCutoutUVCoords() {\n#ifdef USE_SURFACE_CUTOUT_MAP\n    vUv = uv;\n#else\n#ifdef USE_MAP\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_ALPHAMAP\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#endif\n}\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n    depth = -mvPosition.z;\n    passCutoutUVCoords();\n}\n"},70125:e=>{e.exports="#include <id_decl_frag>\n#include <logdepthbuf_decl_frag>\nuniform sampler2D sheetMap;\nuniform sampler2D idMap;\nuniform vec2 resolution;\nuniform vec3 modelIDv2;\nuniform float alphaTest;\nvoid main() {\n    vec2 uv = vec2(gl_FragCoord.x * resolution.x, gl_FragCoord.y * resolution.y);\n    vec4 c = texture2D(sheetMap, uv);\n    if (c.a <= alphaTest)\n        discard;\n    \n    gl_FragColor = c;\n    vec4 dbId = texture2D(idMap, uv);\n#ifdef MRT_NORMALS\n    outNormal = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\n#ifdef MRT_ID_BUFFER\n    outId = vec4(dbId.rgb, 1.0);\n    #ifdef MODEL_COLOR\n    outModelId = vec4(modelIDv2.rgb, 1.0);\n    #endif\n#elif defined(ID_COLOR)\n    gl_FragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n    gl_FragColor = vec4(modelIDv2.rgb, 1.0);\n#endif\n#include <logdepthbuf_frag>\n}\n"},70057:e=>{e.exports="#include <logdepthbuf_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    #include <logdepthbuf_vert>\n}"},701:(e,t,i)=>{"use strict";i.r(t);var r=i(44631),n=i(24073),o=i(36749),s=i(66417),a=i(32800),l=i(18878),h=i(64141);function c(e,t){n.Extension.call(this,e,t),this.name="propertiesmanager",this._panel=null,this._onIsolateEvent=this._onIsolateEvent.bind(this),this._onSelectionChangeEvent=this._onSelectionChangeEvent.bind(this),this._onPrefChange=this._onPrefChange.bind(this),this._onContextMenu=this._onContextMenu.bind(this)}c.prototype=Object.create(n.Extension.prototype),c.prototype.constructor=c;var u=c.prototype;const d=Autodesk.Viewing.Private;u.load=function(){return this.viewer.addEventListener(l.ISOLATE_EVENT,this._onIsolateEvent),this.viewer.addEventListener(l.AGGREGATE_SELECTION_CHANGED_EVENT,this._onSelectionChangeEvent),this.viewer.prefs.addListeners(h.Prefs.OPEN_PROPERTIES_ON_SELECT,this._onPrefChange),this.viewer.registerContextMenuCallback(this.name,this._onContextMenu),!0},u.unload=function(){this.viewer.removeEventListener(l.ISOLATE_EVENT,this._onIsolateEvent),this.viewer.removeEventListener(l.AGGREGATE_SELECTION_CHANGED_EVENT,this._onSelectionChangeEvent),this.viewer.prefs.removeListeners(h.Prefs.OPEN_PROPERTIES_ON_SELECT,this._onPrefChange),this.viewer.unregisterContextMenuCallback(this.name),this.deactivate(),this.setPanel(null),this._toolbarButton&&(this.viewer.settingsTools.removeControl(this._toolbarButton),this.viewer.settingsTools.propertiesbutton=null,this._toolbarButton=null)},u.onToolbarCreated=function(){this.setDefaultPanel(),this._addToolbarButton()},u.activate=function(){return!!this._panel&&(this._panel.setVisible(!0),!0)},u.deactivate=function(){return this._panel&&this._panel.setVisible(!1),!0},u.isActive=function(){return!!this._panel&&this._panel.isVisible()},u.setPanel=function(e){return(e instanceof o.PropertyPanel||!e)&&(this._panel&&(this._panel.setVisible(!1),this.viewer.removePanel(this._panel),this._panel.uninitialize()),this._panel=e,e&&(this.viewer.addPanel(e),e.addVisibilityListener((e=>{e&&this.viewer.onPanelVisible(this._panel),this._toolbarButton.setState(e?a.Button.State.ACTIVE:a.Button.State.INACTIVE)}))),!0)},u.setDefaultPanel=function(){this.setPanel(new s.ViewerPropertyPanel(this.viewer))},u.getPanel=function(){return this._panel},u.getToolbarButton=function(){return this._toolbarButton},u._addToolbarButton=function(){if(!this._toolbarButton){var e=this._toolbarButton=new a.Button("toolbar-propertiesTool");e.setToolTip("Properties"),e.setIcon("adsk-icon-properties"),e.onClick=()=>{this._panel.setVisible(!this._panel.isVisible()),this._panel.isVisible()&&d.analytics.track("viewer.properties",{action:"View List",from:"Toolbar"})},e.setVisible(!this.viewer.prefs.get("openPropertiesOnSelect")),this.viewer.settingsTools.addControl(e,{index:1}),this.viewer.settingsTools.propertiesbutton=e}},u._onIsolateEvent=function(e){this._panel&&(this.viewer.prefs.get("openPropertiesOnSelect")||e.nodeIdArray[0]===e.model.getRootId())&&this._panel.setVisible(e.nodeIdArray.length>0||this.viewer.impl.selector.hasSelection())},u._onSelectionChangeEvent=function(e){if(!this.viewer.prefs.get("openPropertiesOnSelect"))return;let t=!1;for(let i=0;i<e.selections.length;++i)if(e.selections[i].dbIdArray.length>0){t=!0;break}t?this.activate():this.deactivate()},u._onPrefChange=function(e){this._toolbarButton&&this._toolbarButton.setVisible(!e)},u._onContextMenu=function(e,t){if(this.isActive())return;if(!t.hasSelected)return;const i={title:"Show Properties",target:()=>{this.activate(),d.analytics.track("viewer.properties",{action:"View List",from:"Contextual"})}};e.unshift(i)};var p=i(95277);function f(e,t){n.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="viewersettings"}f.prototype=Object.create(n.Extension.prototype),f.prototype.constructor=f;var m=f.prototype;m.activate=function(){this.activeStatus||(this.viewer.showViewer3dOptions(!0),this.viewer.getSettingsPanel(!0).selectTab(p.ViewerSettingTab.Performance),this.activeStatus=!0);return!0},m.deactivate=function(){return this.activeStatus&&(this.viewer.showViewer3dOptions(!1),this.activeStatus=!1),!0};var g=i(77288),v=i(7247);const y=Autodesk.Viewing.Private;function b(e,t){n.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="modelstructure",this._modelstructure=null,this._onLoadModel=this._onLoadModel.bind(this),this._onUnloadModel=this._onUnloadModel.bind(this)}b.prototype=Object.create(n.Extension.prototype),b.prototype.constructor=b;var x=b.prototype;x.load=function(){return this.viewer.addEventListener(l.MODEL_ADDED_EVENT,this._onLoadModel),this.viewer.addEventListener(l.MODEL_ROOT_LOADED_EVENT,this._onLoadModel),this.viewer.addEventListener(l.MODEL_UNLOADED_EVENT,this._onUnloadModel),this.viewer.addEventListener(l.MODEL_REMOVED_EVENT,this._onUnloadModel),!0},x.unload=function(){return this.deactivate(),this.setModelStructurePanel(null),this._structureButton&&(this.viewer.settingsTools.removeControl(this._structureButton),this.viewer.settingsTools.structurebutton=null,this._structureButton=null),this.viewer.removeEventListener(l.MODEL_ADDED_EVENT,this._onLoadModel),this.viewer.removeEventListener(l.MODEL_ROOT_LOADED_EVENT,this._onLoadModel),this.viewer.removeEventListener(l.MODEL_UNLOADED_EVENT,this._onUnloadModel),this.viewer.removeEventListener(l.MODEL_REMOVED_EVENT,this._onUnloadModel),!0},x.onToolbarCreated=function(){const e=new a.Button("toolbar-modelStructureTool");e.setToolTip("Model browser"),e.setIcon("adsk-icon-structure"),e.onClick=()=>{!this._modelstructure.isVisible()?this.activate():this.deactivate()};const t=this.viewer.settingsTools;t.addControl(e,{index:0}),t.structurebutton=e,this._structureButton=e,this.restoreDefaultPanel()},x.activate=function(){return!!this._modelstructure&&(this._modelstructure.setVisible(!0),y.analytics.track("viewer.model_browser",{action:"View List"}),!0)},x.deactivate=function(){return this._modelstructure&&this._modelstructure.setVisible(!1),!0},x.isActive=function(){return!!this._modelstructure&&this._modelstructure.isVisible()},x.setModelStructurePanel=function(e){if(e===this._modelstructure)return!1;if(this._modelstructure&&(this._modelstructure.setVisible(!1),this.viewer.removePanel(this._modelstructure),this._modelstructure.uninitialize()),this._modelstructure=e,this.viewer.modelstructure=e,!e)return!0;this.viewer.addPanel(this._modelstructure);for(var t=this.viewer.impl.modelQueue().getModels(),i=0;i<t.length;++i)this._modelstructure.addModel(t[i]);return this._modelstructure.addVisibilityListener((e=>{e&&this.viewer.onPanelVisible(this._modelstructure),this._structureButton.setState(e?a.Button.State.ACTIVE:a.Button.State.INACTIVE)})),!0},x.restoreDefaultPanel=function(){const e=this.viewer.config;var t={docStructureConfig:e.docStructureConfig,hideSearch:(0,v.isMobileDevice)(),excludeRoot:e.modelBrowserExcludeRoot,startCollapsed:e.modelBrowserStartCollapsed},i=e.defaultModelStructureTitle||"Browser",r=new g.ViewerModelStructurePanel({...t,...(0,g.generateDefaultViewerHandlerOptions)(this.viewer)},i);this.setModelStructurePanel(r)},x._onLoadModel=function(e){this._modelstructure&&this._modelstructure.addModel(e.model)},x._onUnloadModel=function(e){this._modelstructure&&this._modelstructure.unloadModel(e.model)};var _=i(61574),E=i(82493),A=i(11496),S=i(55379),w=i(91493),M=i(53805),T=i(49547),C="dolly",P="freeorbit",D="orbit",L="worldup",I="fittoview";function R(e,t){n.Extension.call(this,e,t),this.name="navtools",this.modes=["pan",C,P,D,"fov",L,I],this.onToolChanged=this.onToolChanged.bind(this),this.onNavigationModeChanged=this.onNavigationModeChanged.bind(this),this.navToolsConfig=t.navToolsConfig||{}}R.prototype=Object.create(n.Extension.prototype),R.prototype.constructor=R;var O=R.prototype;function N(e,t,i){return function(){e.isActive(i)?e.deactivate():e.activate(i)}}O.load=function(){var e=this.viewer,t=new A.FovTool(e);if(e.toolController.registerTool(t),!this.navToolsConfig.isAECCameraControls){var i=new S.WorldUpTool(e.impl,e);e.toolController.registerTool(i)}return this.initFocalLengthOverlay(),e.addEventListener(l.TOOL_CHANGE_EVENT,this.onToolChanged),e.addEventListener(l.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationModeChanged),!0},O.updateUI=function(e){e!==this.is3d&&(this._destroyUI(),this._createUI(e))},O.onToolbarCreated=function(){var e=!this.viewer.impl.is2d;this._createUI(e)},O.navActionDisplayMode=function(e){return this.viewer.navigation.isActionEnabled(e)?"block":"none"},O._createUI=function(e){var t=this.viewer.getToolbar().getControl(_.TOOLBAR.NAVTOOLSID);if(e){var i=new E.ComboButton("toolbar-orbitTools");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.setDisplay(this.navActionDisplayMode("orbit")),this.createOrbitSubmenu(i),t.addControl(i),t.orbittoolsbutton=i,i.setState(a.Button.State.ACTIVE),t.returnToDefault=function(){i.setState(a.Button.State.ACTIVE)}}var r=new a.Button("toolbar-panTool");r.setToolTip("Pan"),r.setIcon("adsk-icon-pan"),r.onClick=N(this,0,"pan"),r.setDisplay(this.navActionDisplayMode("pan")),t.addControl(r),t.panbutton=r,e||(t.returnToDefault=function(){r.setState(a.Button.State.ACTIVE)},t.returnToDefault());var n=new a.Button("toolbar-zoomTool");if(n.setToolTip("Zoom"),n.setIcon("adsk-icon-zoom"),n.onClick=N(this,0,C),n.setDisplay(this.navActionDisplayMode("zoom")),t.addControl(n),t.dollybutton=n,this.navToolsConfig.isAECCameraControls)t.addControl(this.createFitViewButton(t));else{var o=new E.ComboButton("toolbar-cameraSubmenuTool");o.setToolTip("Camera interactions"),o.setIcon("adsk-icon-camera"),o.saveAsDefault(),this.createCameraSubmenu(o,e),t.addControl(o),t.camerabutton=o}this.is3d=e},O.createOrbitSubmenu=function(e){var t=this.viewer.getToolbar().getControl(_.TOOLBAR.NAVTOOLSID),i=new a.Button("toolbar-freeOrbitTool");i.setToolTip("Free orbit"),i.setIcon("adsk-icon-orbit-free"),i.onClick=N(this,0,P),e.addControl(i),t.freeorbitbutton=i;var r=new a.Button("toolbar-orbitTool");r.setToolTip("Orbit"),r.setIcon("adsk-icon-orbit-constrained"),r.onClick=N(this,0,D),e.addControl(r),t.orbitbutton=r,e.onClick=r.onClick},O.createFitViewButton=function(e,t){var i=this.viewer,r=new a.Button("toolbar-fitToViewTool");return r.setToolTip("Fit to view"),r.setIcon("adsk-icon-fit-to-view"),r.onClick=function(){i.impl.fitToView(i.impl.selector.getAggregateSelection());Autodesk.Viewing.Private.analytics.track("viewer.fit_to_view",{from:"UI"});var e=i.getDefaultNavigationToolName();i.setActiveNavigationTool(e),t&&t.restoreDefault()},r.setDisplay(this.navActionDisplayMode("gotoview")),e.fittoviewbutton=r,r},O.createCameraSubmenu=function(e,t){var i=this,r=this.viewer,n=r.getToolbar().getControl(_.TOOLBAR.NAVTOOLSID);if((0,v.isTouchDevice)()){var o=new a.Button("toolbar-homeTool");o.setToolTip("Home"),o.setIcon("adsk-icon-home"),o.onClick=function(){r.navigation.setRequestHomeView(!0);var t=r.getDefaultNavigationToolName();i.activate(t),e.restoreDefault()},o.setDisplay(this.navActionDisplayMode("gotoview")),e.addControl(o),n.homebutton=o}if(e.addControl(this.createFitViewButton(n,e)),t){var s=new a.Button("toolbar-focalLengthTool");s.setToolTip("Focal length"),s.setIcon("adsk-icon-fov"),s.onClick=N(this,0,"fov"),s.setDisplay(this.navActionDisplayMode("fov")),e.addControl(s),n.fovbutton=s}var l=new a.Button("toolbar-rollTool");l.setToolTip("Roll"),l.setIcon("adsk-icon-roll"),l.onClick=N(this,0,L),l.setDisplay(this.navActionDisplayMode("roll")),e.addControl(l),n.rollbutton=l},O.onToolChanged=function(e){if("fov"===e.toolName&&this.showFocalLengthOverlay(e.active),e.active)switch(e.toolName){case"dolly":this.handleAltRelease("dollybutton");break;case"pan":this.handleAltRelease("panbutton");break;case"worldup":this.handleAltRelease("rollbutton");break;case"fov":this.handleAltRelease("fovbutton")}},O.onNavigationModeChanged=function(e){if(this.viewer.getDefaultNavigationToolName()===e.id){var t=this.viewer.getToolbar();if(!t)return;var i=t.getControl(_.TOOLBAR.NAVTOOLSID);if(!i)return;i.returnToDefault&&i.returnToDefault()}},O.handleAltRelease=function(e){var t=this.viewer.getToolbar();if(t){var i=t.getControl(_.TOOLBAR.NAVTOOLSID),r=i&&i[e];r&&r.setState(a.Button.State.ACTIVE)}},O.initFocalLengthOverlay=function(){const e=this.getDocument();var t=this.focallength=e.createElement("div");t.classList.add("message-panel"),t.classList.add("docking-panel"),t.classList.add("focal-length"),t.classList.add("docking-panel-container-solid-color-b");var i=e.createElement("table"),r=e.createElement("tbody");i.appendChild(r),t.appendChild(i),this.viewer.container.appendChild(t);var n=r.insertRow(-1),o=n.insertCell(0);o.classList.add("name"),o.setAttribute("data-i18n","Focal Length"),o.textContent=w.Z.t("Focal Length"),(o=n.insertCell(1)).classList.add("value"),o.textContent="",this.fovCell=o,t.style.visibility="hidden"},O.showFocalLengthOverlay=function(e){var t=this,i=this.viewer,r=0;function n(e){if(e){T.HudMessage.displayMessage(i.container,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."})}else T.HudMessage.dismiss()}function o(e){e&&s(),t.focallength&&(t.focallength.style.visibility=e?"visible":"hidden")}function s(){var e=i.getFocalLength();r!==e&&(r=e,t.fovCell.textContent=e.toString()+" mm")}function a(){if(s(),"fov"===i.toolController.getActiveToolName()){var e=i.navigation.getCamera(),t=e&&!e.isPerspective;o(!t),n(t)}}var h=i.navigation.getCamera(),c=h&&!h.isPerspective;o(e&&!c),n(e&&c),e?i.addEventListener(l.CAMERA_CHANGE_EVENT,a):i.removeEventListener(l.CAMERA_CHANGE_EVENT,a)},O.unload=function(){return this._destroyUI(),!0},O._destroyUI=function(){var e=this.viewer,t=e.getToolbar();if(!t)return!0;var i=t.getControl(_.TOOLBAR.NAVTOOLSID);if(!i)return!0;function r(e){e&&(e.subMenu.removeEventListener(M.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.subMenuActiveButtonChangedHandler(i)),i.removeControl(e.getId()),e.onClick=null)}function n(e){e&&(i.removeControl(e.getId()),e.onClick=null)}return this.is3d&&(r(i.orbittoolsbutton),i.orbittoolsbutton=null,n(i.orbitbutton),i.orbitbutton=null,n(i.freeorbitbutton),i.freeorbitbutton=null,n(i.fovbutton),i.fovbutton=null),n(i.panbutton),i.panbutton=null,n(i.dollybutton),i.dollybutton=null,r(i.camerabutton),i.camerabutton=null,n(i.rollbutton),i.rollbutton=null,n(i.fittoviewbutton),i.fittoviewbutton=null,this.focallength&&(e.container.removeChild(this.focallength),this.focallength=null),e.removeEventListener(l.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=null,e.removeEventListener(l.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationModeChanged),this.onNavigationModeChanged=null,!0},O.activate=function(e){if(this.isActive(e))return!1;if(e===I)return this.viewer.impl.fitToView(this.viewer.impl.selector.getAggregateSelection()),!0;if(-1!=this.modes.indexOf(e)){const t=this.viewer.getDefaultNavigationToolName();return-1===this.modes.indexOf(t)&&this.viewer.activateDefaultNavigationTools(this.viewer.model.is2d()),this.viewer.setActiveNavigationTool(e),!0}return!1},O.deactivate=function(){return this.viewer.setActiveNavigationTool(),!0},O.isActive=function(e){return this.viewer.getActiveNavigationTool()===e};var F=i(31313);const k=Autodesk.Viewing.GlobalManagerMixin;class V extends F.ToolInterface{constructor(e){var t;super(),t=this,this.names=["explode"],this.viewer=e,this.setGlobalManager(this.viewer.globalManager),this.active=!1,this.activate=()=>{this.active=!0},this.deactivate=function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&t.setScale(0),t.active=!1},this.isActive=()=>this.active}setScale(e){let t=e,i=this.viewer.getExplodeOptions();return this.viewer.explode(t,i)}getScale(){return this.viewer.getExplodeScale()}setMagnitude(e){let t=this.viewer.getExplodeScale(),i=this.viewer.getExplodeOptions();return i.magnitude=e,this.viewer.explode(t,i)}getMagnitude(){return this.viewer.getExplodeOptions().magnitude}setDepthDampening(e){let t=this.viewer.getExplodeScale(),i=this.viewer.getExplodeOptions();return i.depthDampening=e,this.viewer.explode(t,i)}getDepthDampening(){return this.viewer.getExplodeOptions().depthDampening}}k.call(V.prototype);var U=i(27156),B=i(60489);class G{constructor(e){this.ext=e;const t=e.viewer,i=new a.Button("toolbar-explodeTool");i.setIcon("adsk-icon-explode"),i.setToolTip("Explode model"),t.modelTools.addControl(i);let r=(0,U.stringToDOM)('<div class="docking-panel docking-panel-container-solid-color-b explode-submenu"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>');const n=t.getToolbar().container.querySelector("#toolbar-explodeTool").parentNode;(0,v.isIOSDevice)()?r.classList.add("ios"):(0,v.isAndroidDevice)()&&r.classList.add("android"),n.appendChild(r),i.addEventListener(Autodesk.Viewing.UI.Control.Event.VISIBILITY_CHANGED,(function(e){e.isVisible?r.classList.add("visible"):r.classList.remove("visible")}));const o=r.querySelector(".explode-slider");o.addEventListener("input",(function(){e.setScale(o.value)})),r.onclick=function(e){e.stopPropagation()};var s=i.container.querySelector(".adsk-control-tooltip");i.onClick=function(){e.isActive()?e.deactivate():(e.activate(),B.logger.track({category:"tool_changed",name:"explode"}))},this._slider=o,this._explodeButton=i,this._explodeSubmenu=r,this._tooltip=s,t.explodeSlider=o,t.explodeSubmenu=r,this._onExplode=this._onExplode.bind(this)}activate(){this._explodeSubmenu.classList.add("visible"),this._explodeButton.setState(a.Button.State.ACTIVE),this._tooltip.style.display="none";let e=this.ext.getScale();this._slider.value=e,this.ext.viewer.addEventListener(l.EXPLODE_CHANGE_EVENT,this._onExplode)}deactivate(){this._explodeButton.setState(a.Button.State.INACTIVE),this._hideSlider(this),this.ext.viewer.removeEventListener(l.EXPLODE_CHANGE_EVENT,this._onExplode)}destroy(){const e=this.ext.viewer;this._slider&&(this._explodeButton&&this._explodeButton.removeFromParent(),this._slider=null,this._explodeButton=null,this._explodeSubmenu=null,this._tooltip=null,e.explodeSlider=null,e.explodeSubmenu=null)}setUIEnabled(e){this._explodeButton&&(e?(this._explodeButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),this._wasActive&&this.ext.activate()):(this._wasActive=this.ext.isActive(),this._hideSlider(this),this._explodeButton.setState(Autodesk.Viewing.UI.Button.State.DISABLED)))}_hideSlider(){this._explodeSubmenu.classList.remove("visible"),this._tooltip.style.display=""}_onExplode(e){this._slider.value=e.scale}}var z=Autodesk.Viewing.Private;class H extends n.Extension{constructor(e,t){super(e,t),this.viewer=e,this.options=t,this.name="explode",this.tool=null,this.explodeUI=null}load(){return this.tool=new V(this.viewer),this.viewer.toolController.registerTool(this.tool,this.setActive.bind(this)),!0}unload(){return this.deactivate(),this.explodeUI&&(this.explodeUI.destroy(),this.explodeUI=null),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0}onToolbarCreated(e){this.explodeUI=new G(this,e)}activate(){return!!this.isActive()||!!this.explodeUI&&(this.explodeUI.activate(),this.viewer.toolController.activateTool("explode"),!0)}deactivate(){return!this.isActive()||(!this.explodeUI||(this.explodeUI.deactivate(),this.viewer.toolController.deactivateTool("explode"),!0))}isActive(){return this.tool.isActive()}getScale(){return this.tool.getScale()}setScale(e){return this.tool.setScale(e)}getMagnitude(){return this.tool.getMagnitude()}setMagnitude(e){return this.tool.setMagnitude(e)}getDepthDampening(){return this.tool.getDepthDampening()}setDepthDampening(e){return this.tool.setDepthDampening(e)}setStrategy(e){e!==this.getStrategy()&&this.viewer.prefs.set(z.Prefs3D.EXPLODE_STRATEGY,e)}getStrategy(){return this.viewer.prefs.get(z.Prefs3D.EXPLODE_STRATEGY)}setUIEnabled(e){this.explodeUI.setUIEnabled(e),e||this.tool.deactivate(!1)}}function W(e,t){n.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="fullscreen"}W.prototype=Object.create(n.Extension.prototype),W.prototype.constructor=W;var j=W.prototype;function q(e,t){n.Extension.call(this,e,t),this.viewer=e,this.options=t,this.name="gohome"}j.activate=function(){return this.activeStatus||(this.viewer.nextScreenMode(),this.activeStatus=!0),!0},j.deactivate=function(){return this.activeStatus&&(this.viewer.escapeScreenMode(),this.activeStatus=!1),!0},q.prototype=Object.create(n.Extension.prototype),q.prototype.constructor=q;var X=q.prototype;X.activate=function(){return this.viewer.navigation.setRequestHomeView(!0),!0},X.deactivate=function(){return!1};var Y=i(87432);const K=Autodesk.Viewing,Q=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n");function Z(){var e,t,i,r,n,o=["fusion orbit","fusion orbit constrained"],s=0,a=1,l=2,h=.005,c=.005,u=1,d={},p=(0,v.isTouchDevice)(),f=!1,m={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},g=this;this.setViewer=function(e){this.viewer=e,this.navapi=e?e.navigation:null,e&&this.setGlobalManager(e.globalManager)};var y=function(e){m.buttons[e.touches?0:e.button]=!0,m.src=e.target.className,m.x=0,m.y=0,m.dx=0,m.dy=0,m.firstMove=!0,m.mode=void 0,"ring"===m.src?m.mode=l:"edgemark-area"===m.src&&("layout-ver"===e.target.parentNode.className?m.mode=s:"layout-hor"===e.target.parentNode.className&&(m.mode=a)),S(),e.stopPropagation()},b=function(e){m.buttons[e.touches?0:e.button]=!1,m.src=void 0},x=function(e){m.buttons[0]&&(_(e),E(),m.firstMove=!1)},_=function(e){var t=e.touches?e.touches[0].pageX:e.pageX,i=e.touches?e.touches[0].pageY:e.pageY;m.firstMove||(m.dx=t-m.x,m.dy=i-m.y),m.x=t,m.y=i},E=function(){switch(m.mode){case l:if(!g.navapi.isActionEnabled("roll"))return;break;case s:case a:if(!g.navapi.isActionEnabled("orbit"))return}var e=n.target.clone().sub(n.position).normalize(),t=e.clone().cross(n.up).normalize(),i=t.clone().cross(e).normalize();if(n.up.copy(i),m.mode===l){var o=new THREE.Vector3(m.x-d.center.x,m.y-d.center.y,0),p=new THREE.Vector3(m.dx,m.dy,0).add(o);o.normalize(),p.normalize();var f=o.clone().cross(p),v=Math.asin(f.z);n.up.applyAxisAngle(e,-v*u)}else{var y,b;m.mode===s?(b=-m.dx*h,r&&(n.up=Y.Navigation.snapToAxis(n.up.clone())),y=n.up):m.mode===a&&(b=-m.dy*c,r?(m.firstMove&&(n.up=Y.Navigation.snapToAxis(n.up.clone())),y=e.clone().cross(n.up).normalize()):y=t,n.up.applyAxisAngle(y,b));var x=g.navapi.getPivotPoint(),_=n.position.clone().sub(x);_.applyAxisAngle(y,b),n.position.addVectors(x,_);var E=n.target.clone().sub(x);E.applyAxisAngle(y,b),n.target.addVectors(x,E)}n.dirty=!0},A=function(e,t){var i=t||e.clone().sub(n.position).normalize();return new THREE.Plane(i,-i.x*e.x-i.y*e.y-i.z*e.z)},S=function(){var e=n.target.clone().sub(n.position).normalize(),t=A(n.position,e).distanceToPoint(n.pivot);n.pivot.copy(e).multiplyScalar(t).add(n.position)},w=function(e){e.touches||0!==e.button||S()},M=function(){f&&g.viewer.setActiveNavigationTool()},T=function(e,t){var i,r=g.viewer.impl.hitTest(e,t);if(r&&r.intersectPoint)i=r.intersectPoint;else{var o=g.viewer.impl.viewportToRay(g.viewer.impl.clientToViewport(e,t));i=new THREE.Vector3,o.intersectPlane(A(n.target),i)}var s=n.position.clone().sub(function(){var e=n.target.clone().sub(n.position).normalize(),t=g.viewer.impl.rayIntersect(new THREE.Ray(n.position,e));return t&&t.intersectPoint?t.intersectPoint:n.target}()).add(i);g.navapi.setRequestTransition(!0,s,i,n.fov)};this.register=function(){(e=(0,U.stringToDOM)(Q)).style.display="none",this.viewer.canvasWrap.insertBefore(e,this.viewer.canvasWrap.firstChild),(t=e.querySelector(".ring")).addEventListener("mousedown",y),Array.prototype.forEach.call(e.querySelectorAll(".edgemark-area"),(function(e){e.addEventListener("mousedown",y),p&&e.addEventListener("touchstart",y)})),this.addWindowEventListener("mouseup",b),this.addWindowEventListener("mousemove",x),(i=e.querySelector(".outside")).addEventListener("mousedown",M);var r=e.querySelector(".circle");r.addEventListener("mousedown",w),p&&(t.addEventListener("touchstart",y),this.addWindowEventListener("touchend",b),this.addWindowEventListener("touchmove",x),i.addEventListener("touchstart",M),r.addEventListener("touchstart",w)),n=this.viewer.impl.camera},this.deregister=function(){this.removeWindowEventListener("mouseup",b),this.removeWindowEventListener("mousemove",x),i.removeEventListener("mousedown",M),p&&(this.removeWindowEventListener("touchend",b),this.removeWindowEventListener("touchmove",x),i.removeEventListener("touchstart",M)),this.viewer.canvasWrap.removeChild(e),e=void 0,t=void 0,i=void 0},this.activate=function(t){e.style.display="",this.handleResize(),r="fusion orbit constrained"===t;var i=this.viewer.toolController.isToolActivated("hyperlink");i&&this.viewer.toolController.deactivateTool("hyperlink"),r?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),i&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(){e.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.get("zoomTowardsPivot"))},this.getNames=function(){return o},this.getName=function(){return o[0]},this.update=function(){return!1},this.handleSingleClick=function(e){return T(e.canvasX,e.canvasY),!0},this.handleDoubleClick=function(){return!0},this.handleSingleTap=function(e){return T(e.canvasX,e.canvasY),!0},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(){return!1},this.handleButtonUp=function(){return!1},this.handleMouseMove=function(e){var t=this.viewer.impl.getCanvasBoundingClientRect(),r=(t.width>t.height?new THREE.Vector2(((e.canvasX+.5)/t.width*2-1)*t.width/t.height,-(e.canvasY+.5)/t.height*2+1):new THREE.Vector2((e.canvasX+.5)/t.width*2-1,(-(e.canvasY+.5)/t.height*2+1)*t.height/t.width)).length()>1.2;return f!==r&&(i.style.cursor=r?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",f=r),!1},this.handleGesture=function(){return S(),!1},this.handleBlur=function(){return!1},this.handleResize=function(){var i=e.getBoundingClientRect();const r=this.getWindow();d.left=i.left+r.pageXOffset,d.top=i.top+r.pageYOffset,d.width=i.width,d.height=i.height,d.center={},d.center.x=d.left+d.width/2,d.center.y=d.top+d.height/2;var n=.8*(r.innerWidth>r.innerHeight?r.innerHeight:r.innerWidth);e.style.width=e.style.height=n+"px",e.style.top=e.style.left="calc(50% - "+n/2+"px)",t.style.borderWidth=.1*n+"px"}}K.GlobalManagerMixin.call(Z.prototype);const J="fusionfreeorbit",$="fusionorbit";function ee(e,t){n.Extension.call(this,e,t),this.name=$,this.modes=[$,J]}ee.prototype=Object.create(n.Extension.prototype),ee.prototype.constructor=ee;var te=ee.prototype;te.load=function(){var e=this.viewer;return this.tool=new Z,this.tool.setViewer(e),e.toolController.registerTool(this.tool),this._onToolChanged=this._onToolChanged.bind(this),!0},te._updateActiveState=function(e,t){this.activeStatus=e,this.mode=t},te._onToolChanged=function(e){if("fusion orbit constrained"===e.toolName||"fusion orbit"===e.toolName){const t=this._toolbar.getControl(_.TOOLBAR.NAVTOOLSID),i="fusion orbit"===e.toolName?t.freeorbitbutton:t.orbitbutton,r=e.active?a.Button.State.ACTIVE:a.Button.State.INACTIVE;i.setState(r),this._updateActiveState(!r)}},te.onToolbarCreated=async function(e){var t=this,i=this.viewer,r=e.getControl(_.TOOLBAR.NAVTOOLSID);r&&r.orbitbutton||await i.loadExtension("Autodesk.DefaultTools.NavTools",i.config),this._toolbar=e,this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this._onToolChanged),this.classicBehavior={},this.classicBehavior.orbitOnClick=r.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=r.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=r.returnToDefault,r.freeorbitbutton.onClick=function(){var e=r.freeorbitbutton.getState();e===a.Button.State.INACTIVE?t.activate(J):e===a.Button.State.ACTIVE&&t.deactivate()},r.orbitbutton.onClick=function(){var e=r.orbitbutton.getState();e===a.Button.State.INACTIVE?t.activate($):e===a.Button.State.ACTIVE&&t.deactivate()},r.returnToDefault=function(){r.orbittoolsbutton&&r.orbittoolsbutton.setState(a.Button.State.ACTIVE)},r.orbittoolsbutton.setState(a.Button.State.INACTIVE),i.prefs.get("fusionOrbitConstrained")?(r.orbittoolsbutton.onClick=r.orbitbutton.onClick,r.orbittoolsbutton.setIcon(r.orbitbutton.iconClass),i.setDefaultNavigationTool("orbit")):(r.orbittoolsbutton.onClick=r.freeorbitbutton.onClick,r.orbittoolsbutton.setIcon(r.freeorbitbutton.iconClass),i.setDefaultNavigationTool("freeorbit")),i.setActiveNavigationTool(),r.returnToDefault&&r.returnToDefault()},te.unload=function(){var e=this.viewer;if(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this._onToolChanged),this.classicBehavior){var t=e.getToolbar().getControl(_.TOOLBAR.NAVTOOLSID);t&&(t.orbitbutton&&(t.orbitbutton.onClick=this.classicBehavior.orbitOnClick),t.freeorbitbutton&&(t.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),t.returnToDefault=this.classicBehavior.returnToDefault,t.orbittoolsbutton&&(t.orbitbutton?t.orbittoolsbutton.onClick=t.orbitbutton.onClick:t.orbittoolsbutton.onClick=null,t.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),t.orbittoolsbutton.setState(a.Button.State.ACTIVE))),this.classicBehavior=null}return e.setActiveNavigationTool("orbit"),e.setDefaultNavigationTool("orbit"),e.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,this._toolbar=null,!0},te.activate=function(e){if(!this.isActive(e)){switch(e){default:case $:this.viewer.setActiveNavigationTool("fusion orbit constrained"),this.mode=$;break;case J:this.viewer.setActiveNavigationTool("fusion orbit"),this.mode=J}return this.activeStatus=!0,!0}},te.deactivate=function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0},r.theExtensionManager.registerExtension("Autodesk.PropertiesManager",c),r.theExtensionManager.registerExtension("Autodesk.ViewerSettings",f),r.theExtensionManager.registerExtension("Autodesk.ModelStructure",b),r.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",R),r.theExtensionManager.registerExtension("Autodesk.Explode",H),r.theExtensionManager.registerExtension("Autodesk.FullScreen",W),r.theExtensionManager.registerExtension("Autodesk.GoHome",q),r.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",ee)},1683:e=>{e.exports={externalExtensions:[{src:"./extensions/DeveloperTools/index.js",ids:["Autodesk.DeveloperTools.AABBoxAccuracyLogger","Autodesk.DeveloperTools.Shortcuts","Autodesk.DeveloperTools.StatisticsOverlay","Autodesk.DeveloperTools.WebGLDrawStatistics","Autodesk.DeveloperTools.WebGLFunctionIntrusion","Autodesk.DeveloperTools.WebGLObjectCounters","Autodesk.DeveloperTools.WebGLResourceSnapshot"]},{src:"./extensions/Wireframes/Wireframes.js",ids:["Autodesk.Viewing.Wireframes"]},{src:"./extensions/ZoomWindow/ZoomWindow.js",ids:["Autodesk.Viewing.ZoomWindow"]},{src:"./extensions/AEC/LibraryExports.js",ids:["Autodesk.AEC.LevelsExtension","Autodesk.AEC.HyperlinkExtension","Autodesk.AEC.DropMeExtension","Autodesk.AEC.CanvasBookmarkExtension","Autodesk.AEC.Minimap3DExtension","Autodesk.AEC.LocationsExtension","Autodesk.AEC.Hypermodeling","Autodesk.AEC.ViewportsExtension","Autodesk.AEC.DisciplinesExtension"]},{src:"./extensions/Pushpins/PushPinExtension.js",ids:["Autodesk.BIM360.Extension.PushPin"]},{src:"./extensions/Hyperlink/Hyperlink.js",ids:["Autodesk.Hyperlink"]},{src:"./extensions/Debug/Debug.js",ids:["Autodesk.Debug"]},{src:"./extensions/BimWalk/BimWalk.js",ids:["Autodesk.BimWalk"]},{src:"./extensions/Section/Section.js",ids:["Autodesk.Section"]},{src:"./extensions/SmartSection/index.js",ids:["Autodesk.SmartSection"]},{src:"./extensions/CompGeom/index.js",ids:["Autodesk.CompGeom"]},{src:"./extensions/Snapping/index.js",ids:["Autodesk.Snapping"]},{src:"./extensions/Beeline/Beeline.js",ids:["Autodesk.Beeline"]},{src:"./extensions/FirstPerson/FirstPerson.js",ids:["Autodesk.FirstPerson"]},{src:"./extensions/webVR/webVR.js",ids:["Autodesk.Viewing.WebVR"]},{src:"./extensions/CAM360/CAM360.js",ids:["Autodesk.CAM360"]},{src:"./extensions/FusionSim/FusionSim.js",ids:["Autodesk.Fusion360.Simulation"]},{src:"./extensions/OMV/OMV.js",ids:["Autodesk.OMV"]},{src:"./extensions/SplitScreen/SplitScreen.js",ids:["Autodesk.SplitScreen"]},{src:"./extensions/CrossFadeEffects/CrossFadeEffects.js",ids:["Autodesk.CrossFadeEffects"]},{src:"./extensions/Edit2D/Edit2D.js",ids:["Autodesk.Edit2D"]},{src:"./extensions/Edit3D/Edit3D.js",ids:["Autodesk.Edit3D"]},{src:"./extensions/VisualClusters/VisualClusters.js",ids:["Autodesk.VisualClusters"]},{src:"./extensions/Moldflow/Moldflow.js",ids:["Autodesk.Moldflow"]},{src:"./extensions/PixelCompare/PixelCompare.js",ids:["Autodesk.Viewing.PixelCompare"]},{src:"./extensions/ScalarisSimulation/ScalarisSimulation.js",ids:["Autodesk.Viewing.ScalarisSimulation"]},{src:"./extensions/Measure/Measure.js",ids:["Autodesk.Measure"]},{src:"./extensions/Markup/Markup.js",ids:["Autodesk.Viewing.MarkupsCore","Autodesk.Viewing.MarkupsGui"]},{src:"./extensions/PDF/index.js",ids:["Autodesk.PDF"]},{src:"./extensions/ReCap/index.js",ids:["Autodesk.ReCap"]},{src:"./extensions/Scalaris/index.js",ids:["Autodesk.Scalaris"]},{src:"./extensions/DocumentBrowser/index.js",ids:["Autodesk.DocumentBrowser"]},{src:"./extensions/Geolocation/index.js",ids:["Autodesk.Geolocation"]},{src:"./extensions/Fusion360/AnimationExtension.js",ids:["Autodesk.Fusion360.Animation"]},{src:"./extensions/NPR/index.js",ids:["Autodesk.NPR"]},{src:"./extensions/DOF/DOFExtension.js",ids:["Autodesk.DOF"]},{src:"./extensions/MSDF/index.js",ids:["Autodesk.MSDF"]},{src:"./extensions/MemoryLimited/MemoryLimited.js",ids:["Autodesk.MemoryLimited"]},{src:"./extensions/ViewCubeUi/ViewCubeUi.js",ids:["Autodesk.ViewCubeUi"]},{src:"./extensions/MemoryLimitedDebug/MemoryManager.js",ids:["Autodesk.Viewing.MemoryLimitedDebug"]},{src:"./extensions/BimMarkups/BimMarkups.js",ids:["Autodesk.BIM360.Markups"]},{src:"./extensions/Minimap2D/Minimap2D.js",ids:["Autodesk.BIM360.Minimap"]},{src:"./extensions/GestureDocumentNavigation/GestureDocumentNavigation.js",ids:["Autodesk.BIM360.GestureDocumentNavigation"]},{src:"./extensions/RollCamera/RollCamera.js",ids:["Autodesk.BIM360.RollCamera"]},{src:"./extensions/LayerManager/LayerManager.js",ids:["Autodesk.LayerManager"]},{src:"./extensions/SceneBuilder/sceneBuilder.js",ids:["Autodesk.Viewing.SceneBuilder"]},{src:"./extensions/Popout/index.js",ids:["Autodesk.Viewing.Popout"]},{src:"./extensions/ProfileUi/index.js",ids:["Autodesk.ProfileUi"]},{src:"./extensions/PropertySearch/PropertySearch.js",ids:["Autodesk.PropertySearch"]},{src:"./extensions/StandardSurface/index.js",ids:["Autodesk.StandardSurface"]},{src:"./extensions/MaterialConverterPrism/index.js",ids:["Autodesk.Viewing.MaterialConverterPrism"]},{src:"./extensions/DWF/index.js",ids:["Autodesk.DWF"]},{src:"./extensions/ModelsPanel/index.js",ids:["Autodesk.ModelsPanel"]},{src:"./extensions/ModelAlignment/index.js",ids:["Autodesk.ModelAlignment","Autodesk.SheetAlignment"],dependencies:["Autodesk.Edit3D"]},{src:"./extensions/ModelAlignmentService/ModelAlignmentService.js",ids:["Autodesk.ModelAlignmentService"]},{src:"./extensions/MixpanelProvider/index.js",ids:["Autodesk.Viewing.MixpanelExtension"]},{src:"./extensions/Crop/Crop.js",ids:["Autodesk.Crop"]},{src:"./extensions/DataVisualization/index.js",ids:["Autodesk.DataVisualization"]},{src:"./extensions/ExtensionsPanel/index.js",ids:["Autodesk.ExtensionsPanel"]},{src:"./extensions/StringExtractor/StringExtractor.js",ids:["Autodesk.StringExtractor"]},{src:"./extensions/ModelSheetTransition/ModelSheetTransition.js",ids:["Autodesk.ModelSheetTransition"]},{src:"./extensions/BoxSelection/BoxSelectionExtension.js",ids:["Autodesk.BoxSelection"]},{src:"./extensions/glTF/index.js",ids:["Autodesk.glTF"]},{src:"./extensions/PropertyQuery/index.js",ids:["Autodesk.PropertyQuery"]},{src:"./extensions/VaultPrintUI/index.js",ids:["Autodesk.Vault.Print"]},{src:"./extensions/VaultMarkupsUI/index.js",ids:["Autodesk.Vault.Markups"],dependencies:["Autodesk.BIM360.Markups"]},{src:"./extensions/DataExchange/DataExchange.js",ids:["Autodesk.DataExchange"]},{src:"./extensions/Multipage/Multipage.js",ids:["Autodesk.Multipage"]},{src:"./extensions/DynamicDimensions/DynamicDimensions.js",ids:["Autodesk.DynamicDimensions"]},{src:"./extensions/Filter/index.js",ids:["Autodesk.Filter"],buildConfig:"./extensions/Filter/webpack.config.js"},{src:"./extensions/CustomProperties/index.js",ids:["Autodesk.CustomProperties"]},{src:"./extensions/Grid/Grid.js",ids:["Autodesk.Grid"]},{src:"./extensions/SubsetLoading/index.js",ids:["Autodesk.SubsetLoading"]},{src:"./extensions/DataPersistence/persistence.js",ids:["Autodesk.DataPersistence"]},{src:"./extensions/CADLabeling/index.js",ids:["Autodesk.CADLabeling"]}],getExtensionEntryKey:function(e){return e.src.split("/")[2]}}},46287:(e,t,i)=>{"use strict";i.r(t);var r=i(44631),n=i(1683);const o="min.js";n.externalExtensions.forEach((e=>{let t=(0,n.getExtensionEntryKey)(e),i=`extensions/${t}/${t}.${o}`,s=e.dependencies;e.ids.forEach((e=>{r.theExtensionManager.registerExternalExtension(e,i,s)}))})),r.theExtensionManager.registerExternalExtension("Autodesk.DiffTool",`extensions/DiffTool/DiffTool.${o}`)},32131:(e,t,i)=>{"use strict";i.r(t),i.d(t,{analytics:()=>o});var r=i(60489),n=i(86056);const o=new class{constructor(){this.providerMap={},this.instances=[],this.superProps={},this.shouldTrack=!0,this.trackCache=[],this.oneTimers={}}registerProvider(e){if(!e)return void r.logger.error("Undefined provider");if(!e.name)return void r.logger.error("missing provider name");const t=e.name.toLowerCase();this.isProviderRegistered(t)?r.logger.warn(`Provider with name ${e.name} already registered`):this.providerMap[t]=e;const i=this.createInstance(e.name,e.defaultOptions);this.instances.push(i),this.shouldTrack&&this.init(i),this.trackCache.length>0&&(this.trackCache.forEach((e=>{let{event:t,properties:i}=e;this.track(t,i)})),this.trackCache=[])}isProviderRegistered(e){var t;return("string"==typeof e?e:null===(t=e.name)||void 0===t?void 0:t.toLowerCase())in this.providerMap}init(e){e.initialized||(e.init(),e.register(this.superProps))}createInstance(e,t){const i=e&&e.toLowerCase();if(!(i in this.providerMap))return void r.logger.error(`Unknown ${e}`);const o=this.providerMap[i],s=new o(t);if(!(s instanceof n.AnalyticsProviderInterface))throw new Error("not an analytics provider");return o.instanceCount=o.instanceCount||0,s.name=`${i}-${o.instanceCount}`,o.instanceCount++,s}optIn(e){this.instances.forEach((e=>this.init(e))),this._callMethod("optIn",e),this.shouldTrack=!0}optOut(e){this._callMethod("optOut",e),this.shouldTrack=!1}hasOptedOut(){return this._callMethod("hasOptedOut")}getDistinctId(){return this._callMethod("getDistinctId")}track(e,t,i){if(this.shouldTrack){if(i){const i={event:e,properties:t};try{const e=JSON.stringify(i);if(this.oneTimers[e])return;this.oneTimers[e]=!0}catch(e){}}0===this.instances.length?this.trackCache.push({event:e,properties:t}):this._callMethod("track",e,t)}}identify(e){this._callMethod("identify",e)}_callMethod(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=t[0],n=t.slice(1,t.length);return this.instances.map((e=>({name:e.name,value:e[r](...n)})))}}},86056:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnalyticsProviderInterface:()=>r});class r{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e}init(){}register(){}static get name(){return null}static get defaultOptions(){return{}}optIn(e){}optOut(e){}hasOptedOut(){}getDistinctId(){}track(e,t){}identify(e){}}},26754:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Animation:()=>n,interpolateCatmullRom:()=>o});var r=i(24811);function n(e,t,i){this.root=e,this.handler=i.animationHandler,this.data=this.handler.init(t),this.hierarchy=this.handler.parse(e),this.viewer=i.viewer,this.animator=i,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=r.u.LINEAR,this.setStartAndEndKeyTime()}function o(e,t){function i(e,t,i,r,n,o,s){var a=.5*(i-e),l=.5*(r-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*n+t}var r,n,o,s,a,l,h,c,u,d=[],p=[];return o=(r=(e.length-1)*t)-(n=Math.floor(r)),d[0]=0===n?n:n-1,d[1]=n,d[2]=n>e.length-2?n:n+1,d[3]=n>e.length-3?n:n+2,l=e[d[0]],h=e[d[1]],c=e[d[2]],u=e[d[3]],a=o*(s=o*o),p[0]=i(l[0],h[0],c[0],u[0],o,s,a),p[1]=i(l[1],h[1],c[1],u[1],o,s,a),p[2]=i(l[2],h[2],c[2],u[2],o,s,a),p}i(76542).GlobalManagerMixin.call(n.prototype),n.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var e=this.data.hierarchy[0].keys;this.startKeyTime=e[0].time,this.endKeyTime=e[e.length-1].time}else this.startKeyTime=this.endKeyTime=0},n.prototype.keyTypes=[],n.prototype.defaultKey={},n.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},n.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},n.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},n.prototype.goto=function(e){this.isPlaying||this.play(),this.isPaused||this.pause();var t=e-this.currentTime;this.update(t)},n.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];void 0===i.animationCache&&(i.animationCache={}),void 0===i.animationCache[this.data.name]&&(i.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:i.matrix});for(var r=i.animationCache[this.data.name],n=0;n<this.keyTypes.length;n++){for(var o=this.keyTypes[n],s=this.data.hierarchy[e].keys[0],a=this.getNextKeyWith(o,e,1);a.time<this.currentTime&&a.index>s.index;)s=a,a=this.getNextKeyWith(o,e,a.index+1);r.prevKey[o]=s,r.nextKey[o]=a}}this.setStartAndEndKeyTime()},n.prototype.getNextKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(this.interpolationType===r.u.CATMULLROM||this.interpolationType===r.u.CATMULLROM_FORWARD?i=i<n.length-1?i:n.length-1:i%=n.length;i<n.length;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[0]},n.prototype.getPrevKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=this.interpolationType===r.u.CATMULLROM||this.interpolationType===r.u.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[n.length-1]},n.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},n.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())}},24811:(e,t,i)=>{"use strict";i.d(t,{u:()=>r});const r={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2}},34740:(e,t,i)=>{"use strict";function r(){this.animations=[]}i.r(t),i.d(t,{KeyFrameAnimator:()=>m}),r.prototype.init=function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var r=e.hierarchy[t].keys[i].rot;Array.isArray(r)||(r=[r._x,r._y,r._z,r._w]),e.hierarchy[t].keys[i].rot=(new THREE.Quaternion).fromArray(r)}for(let i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(let i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}return e.initialized=!0,e},r.prototype.parse=function(e){var t=[];return function e(t,i){if(i.push(t),t.children&&!(t instanceof THREE.Camera))for(var r=0;r<t.children.length;r++)e(t.children[r],i)}(e,t),t},r.prototype.play=function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},r.prototype.stop=function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},r.prototype.update=function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)};var n,o,s,a=i(95765),l=i(75050),h=i(24811),c=i(26754);function u(e,t,i){c.Animation.call(this,e,t,i),this.followCam=!0}function d(e,t,i){let r;c.Animation.call(this,{},e,i),this.fragPointers=[],this.nodeChildren=[],this.nodeFragments=[];const n=this.viewer.model.getData().instanceTree;n.enumNodeChildren(t,(e=>{this.nodeChildren.push(e)}),!0),n.enumNodeFragments(e.id,(e=>{this.nodeFragments.push(e),r=this.viewer.getFragmentProxy(this.viewer.model,e),r&&(this.fragPointers.push(r),r.setMaterial(this.viewer.matman().cloneMaterial(r.getMaterial(),this.viewer.model)))}),!0),this.nodeId=t,this.epsilon=.1}function p(e,t,i){var r=this;null===e&&(e=function(e,t,i){var n=this.getDocument(),o=r.container=n.createElement("div"),s=e.name;o.id=s,o.style.cursor="pointer",o.style.visibility=i;var a=n.createElement("div");a.id=s+"-txt",a.style.cssText="display: none;position: absolute;z-index: 1;",o.appendChild(a);var h=n.createElement("img"),c=e.custom&&e.custom.att&&1===e.custom.att;h.src=c?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",h.id=s+"-img",h.style.cssText="display: block;position: absolute;z-index: 1;",o.appendChild(h),t.api.container.appendChild(o),o.addEventListener("click",(function(){a.style.display="none"===a.style.display?"block":"none"}));var u=new l.SphereGeometry(.01),d=new l.MeshPhongMaterial({color:32512,opacity:.6,transparent:!0}),p=new l.Mesh(u,d);return p.visible=!1,void 0===t.overlayScenes.annotation&&t.createOverlayScene("annotation"),t.addOverlay("annotation",p),p}.call(this,t,i.viewer,"hidden")),c.Animation.call(this,e,t,i),this.id=t.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,(function(t){r.updateText(e.position,r.text)}))}function f(e,t,i){this.viewer=i.viewer,null===e&&(e=this.createPolyline([])),c.Animation.call(this,e,t,i),this.epsilon=.1}function m(e,t){this.animations=[],this.viewer=e,this.setGlobalManager(e.globalManager),this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=t,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new r,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2,this.followCam=!0,this._speedMod=1,this._loops=!1}u.prototype=Object.create(c.Animation.prototype),u.prototype.constructor=u,u.prototype.keyTypes=["pos","up","target","fov","perspective"],u.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},u.prototype.setFollowCamera=function(e){this.followCam=e},u.prototype.update=(n=[],o=new l.Vector3,s=new l.Vector3,function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),this.followCam&&!this.isPlayingOutOfRange())){for(var t=0,i=this.hierarchy.length;t<i;t++){for(var r=this.hierarchy[t],a=r.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var u=this.keyTypes[l],d=a.prevKey[u],p=a.nextKey[u];if(p.time<=this.currentTime||d.time>=this.currentTime){for(d=this.data.hierarchy[t].keys[0],p=this.getNextKeyWith(u,t,1);p.time<this.currentTime&&p.index>d.index;)d=p,p=this.getNextKeyWith(u,t,p.index+1);a.prevKey[u]=d,a.nextKey[u]=p}var f=d[u],m=p[u];if(p.time!==d.time&&void 0!==f&&void 0!==m){var g,v=(this.currentTime-d.time)/(p.time-d.time);if(v<0&&(v=0),v>1&&(v=1),"pos"===u)g=r.position;else if("up"===u)g=r.up;else if("target"===u)g=r.target;else{if("fov"===u){r.setFov(f+(m-f)*v);continue}if("perspective"===u){(v>.5?m:f)?r.toPerspective():r.toOrthographic();continue}}if(this.interpolationType===h.u.LINEAR)s.x=f[0]+(m[0]-f[0])*v,s.y=f[1]+(m[1]-f[1])*v,s.z=f[2]+(m[2]-f[2])*v,g.copy(s);else{n[0]=this.getPrevKeyWith(u,t,d.index-1)[u],n[1]=f,n[2]=m,n[3]=this.getNextKeyWith(u,t,p.index+1)[u],v=.33*v+.33;var y=(0,c.interpolateCatmullRom)(n,v);if(s.x=y[0],s.y=y[1],s.z=y[2],g.copy(s),this.interpolationType===h.u.CATMULLROM_FORWARD){var b=(0,c.interpolateCatmullRom)(n,1.01*v);o.set(b[0],b[1],b[2]),o.sub(g),o.y=0,o.normalize();var x=Math.atan2(o.x,o.z);r.rotation.set(0,x,0)}}}}r.matrixAutoUpdate=!0,r.matrixWorldNeedsUpdate=!0}r.lookAt(r.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}),d.prototype=Object.create(c.Animation.prototype),d.prototype.constructor=d,d.prototype.keyTypes=["vis","opa"],d.prototype.defaultKey={viz:1,opa:1},d.prototype.getPrevAndNextKeys=function(e,t){let i=this.data.hierarchy[e].keys[0],r=this.getNextKeyWith(t,e,1);for(;r.time<this.currentTime&&r.index>i.index;)i=r,r=this.getNextKeyWith(t,e,r.index+1);return{prevKey:i,nextKey:r}},d.prototype.update=function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,i=this.hierarchy.length;t<i;t++){var r=this.hierarchy[t].animationCache[this.data.name],n=r.prevKey.vis,o=r.prevKey.vis,s=r.prevKey.opa,a=r.prevKey.opa;if(o.time<=this.currentTime||n.time>=this.currentTime){const{prevKey:e,nextKey:i}=this.getPrevAndNextKeys(t,"vis");n=e,o=i,r.prevKey.vis=n,r.nextKey.vis=o}if(a.time<=this.currentTime||s.time>=this.currentTime){const{prevKey:e,nextKey:i}=this.getPrevAndNextKeys(t,"opa");s=e,a=i,r.prevKey.opa=s,r.nextKey.opa=a}let e=n.vis,i=o.vis;if(void 0!==e&&void 0!==i&&n.time!==o.time){const t=Math.abs(this.currentTime-o.time)<this.epsilon?i:e;this.viewer.visibilityManager.setNodeOff(this.nodeId,!t,this.viewer.model,this.nodeChildren,this.nodeFragments)}if(e=s.opa,i=a.opa,void 0===e&&1===n.vis&&(e=1),void 0!==e&&void 0!==i&&s.time!==a.time){let t=(this.currentTime-s.time)/(a.time-s.time);t<0&&(t=0),t>1&&(t=1);const r=e+(i-e)*t;for(let e=0;e<this.fragPointers.length;++e){const t=this.fragPointers[e].getMaterial();t.transparent=1!==r,t.opacity=r}r>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1,this.viewer.model,this.nodeChildren,this.nodeFragments)}}},p.prototype=Object.create(c.Animation.prototype),p.prototype.constructor=p,p.prototype.keyTypes=["pos","text","vis"],p.prototype.defaultKey={pos:0,text:"",vis:1},p.prototype.stop=function(){c.Animation.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},p.prototype.updateText=function(e,t){var i=function(e,t,i){var r=e.clone(),n=new l.Matrix4;return t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),r.applyProjection(n),{x:(r.x+1)*i.width/2+i.offsetLeft-12,y:(1-r.y)*i.height/2+i.offsetTop+12}}(e,this.viewer.camera,this.viewer.canvas),r=this.getDocument(),n=r.getElementById(this.id+"-txt");n&&(n.innerHTML=t,n.style.left=i.x+"px",n.style.top=i.y+"px",this.text=t),(n=r.getElementById(this.id+"-img"))&&(n.style.left=i.x+"px",n.style.top=i.y-24+"px")},p.prototype.update=function(){var e=[],t=new l.Vector3,i=new l.Vector3;return function(r){if(!1!==this.isPlaying&&(this.currentTime+=r*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){var n=this.getDocument();if(this.isPaused&&this.currentTime<this.startKeyTime)(E=n.getElementById(this.id))&&(E.style.visibility=this.state);else for(var o=0,s=this.hierarchy.length;o<s;o++){for(var a=this.hierarchy[o],l=a.animationCache[this.data.name],u=0;u<this.keyTypes.length;u++){var d=this.keyTypes[u],p=l.prevKey[d],f=l.nextKey[d];if(f.time<=this.currentTime||p.time>=this.currentTime){for(p=this.data.hierarchy[o].keys[0],f=this.getNextKeyWith(d,o,1);f.time<this.currentTime&&f.index>p.index;)p=f,f=this.getNextKeyWith(d,o,f.index+1);l.prevKey[d]=p,l.nextKey[d]=f}var m=p[d],g=f[d];if(f.time!==p.time&&void 0!==m&&void 0!==g){var v=(this.currentTime-p.time)/(f.time-p.time);if(v<0&&(v=0),v>1&&(v=1),"pos"===d){if(this.interpolationType===h.u.LINEAR)i.x=m[0]+(g[0]-m[0])*v,i.y=m[1]+(g[1]-m[1])*v,i.z=m[2]+(g[2]-m[2])*v,a.position.copy(i);else if(this.interpolationType===h.u.CATMULLROM||this.interpolationType===h.u.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",o,p.index-1).pos,e[1]=m,e[2]=g,e[3]=this.getNextKeyWith("pos",o,f.index+1).pos,v=.33*v+.33;var y=(0,c.interpolateCatmullRom)(e,v);if(i.x=y[0],i.y=y[1],i.z=y[2],a.position.copy(i),this.interpolationType===h.u.CATMULLROM_FORWARD){var b=(0,c.interpolateCatmullRom)(e,1.01*v);t.set(b[0],b[1],b[2]),t.sub(vector),t.y=0,t.normalize();var x=Math.atan2(t.x,t.z);a.rotation.set(0,x,0)}}}else if("text"===d){var _=Math.abs(this.currentTime-f.time)<this.epsilon?g:m;this.updateText(a.position,_)}else if("vis"===d){var E;if(E=n.getElementById(this.id)){var A=Math.abs(this.currentTime-f.time)<this.epsilon?g:m;E.style.visibility=A?"visible":"hidden"}}}}a.matrixAutoUpdate=!0,a.matrixWorldNeedsUpdate=!0}}}}(),f.prototype=Object.create(c.Animation.prototype),f.prototype.constructor=f,f.prototype.keyTypes=["points","vis"],f.prototype.defaultKey={points:[],vis:1},f.prototype.stop=function(){c.Animation.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},f.prototype.update=function(){function e(e){e.root&&(e.viewer.removeOverlay("polyline",e.root),e.root=null)}return function(t){if(!1!==this.isPlaying&&(this.currentTime+=t*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)e(this);else for(var i=0,r=this.hierarchy.length;i<r;i++)for(var n=this.hierarchy[i].animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){var s=this.keyTypes[o],a=n.prevKey[s],h=n.nextKey[s];if(h.time<=this.currentTime||a.time>=this.currentTime){for(a=this.data.hierarchy[i].keys[0],h=this.getNextKeyWith(s,i,1);h.time<this.currentTime&&h.index>a.index;)a=h,h=this.getNextKeyWith(s,i,h.index+1);n.prevKey[s]=a,n.nextKey[s]=h}var c=a[s],u=h[s];if(h.time!==a.time&&void 0!==c&&void 0!==u){var d=(this.currentTime-a.time)/(h.time-a.time);if(d<0&&(d=0),d>1&&(d=1),"points"===s){var p=d<.5?c:u;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var f=[],m=0;m<p.length;m++){var g=p[m].slice();if(0===m)g[0]=c[m][0]+(u[m][0]-c[m][0])*d,g[1]=c[m][1]+(u[m][1]-c[m][1])*d,g[2]=c[m][2]+(u[m][2]-c[m][2])*d;else if(m===p.length-1){var v=c.length-1,y=u.length-1;g[0]=c[v][0]+(u[y][0]-c[v][0])*d,g[1]=c[v][1]+(u[y][1]-c[v][1])*d,g[2]=c[v][2]+(u[y][2]-c[v][2])*d}var b=new l.Vector3(g[0],g[1],g[2]);f.push(b)}this.root=this.createPolyline(f)}else if("vis"===s){var x=Math.abs(this.currentTime-h.time)<this.epsilon?u:c;this.root.visible=x,x||e(this)}}}}}(),f.prototype.createPolyline=function(e){for(var t=new l.Geometry,i=0;i<e.length;i++)t.vertices.push(e[i]);t.computeLineDistances();var r=new l.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),n=new l.Line(t,r,l.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",n),n},i(76542).GlobalManagerMixin.call(m.prototype),m.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},m.prototype.add=function(e){if(!(!e.hierarchy||e.hierarchy.length<1||!e.hierarchy[0].keys||e.hierarchy[0].keys.length<2)){var t=null,i=this;if("camera"===e.type?(t=new u(i.viewer.camera,e,i),i.animations.push(t)):"annotation"===e.type?(t=new p(null,e,i),i.animations.push(t)):"polyline"===e.type?(t=new f(null,e,i),i.animations.push(t)):"mesh"===e.type?i.viewer.model.getData().instanceTree.enumNodeFragments(e.id,(function(r){var n=i.viewer.getFragmentProxy(i.viewer.model,r);n&&(t=new a.MeshAnimation(n,e,i),i.animations.push(t))}),!0):"visibility"===e.type&&(t=new d(e,e.id,i),i.animations.push(t)),i.animations.forEach((e=>e.setGlobalManager(this.globalManager))),t){for(var r=0,n=e.hierarchy.length;r<n;r++)for(var o=e.hierarchy[r].keys,s=0;s<o.length;s++)void 0===o[s].xk&&i.keys.push(o[s].time);!function(e){e.sort((function(e,t){return e-t})),function(e,t,i){for(t=e.length;i=--t;)for(;i--;)e[t]!==e[i]||e.splice(i,1)}(e)}(i.keys)}this.updateFlag|=this.UPDATE_SCENE}},m.prototype.update=function(e){e*=this._speedMod,this.animationHandler.update(e);var t=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=e,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&(this._loops?this.play(0,this.onPlayCallback):this.pause()),t|=this.UPDATE_SCENE),this.updateFlag=0,t},m.prototype.play=function(e,t){if(this.onPlayCallback=t,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)this.pause();else{for(var i=0;i<this.animations.length;i++){this.animations[i].play(e)}this.isPlaying=!0,this.isPaused=!1}},m.prototype.setFollowCamera=function(e){this.followCam=e;for(var t=0;t<this.animations.length;t++){var i=this.animations[t];i.setFollowCamera&&i.setFollowCamera(e)}},m.prototype.isFollowingCamera=function(){return this.followCam},m.prototype.setSpeedModifier=function(e){this._speedMod=e},m.prototype.getSpeedModifier=function(){return this._speedMod},m.prototype.setLooping=function(e){this._loops=e},m.prototype.isLooping=function(){return this._loops},m.prototype.pause=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t.isPaused===this.isPaused&&t.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},m.prototype.pauseCameraAnimations=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t instanceof u&&t.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},m.prototype.stop=function(){for(var e=0;e<this.animations.length;e++){this.animations[e].stop()}this.isPlaying=!1,this.isPaused=!1},m.prototype.goto=function(e){if(void 0!==e){for(var t=0;t<this.animations.length;t++){this.animations[t].goto(e)}this.isPlaying=!1,this.isPaused=!0,this.currentTime=e,this.updateFlag|=this.UPDATE_SCENE}},m.prototype.next=function(){var e=function(e,t){for(var i=-1,r=0;r<t.length;r++)if(t[r]>e){i=t[r];break}return i<0?t[t.length-1]:i}(this.currentTime,this.keys);this.goto(e)},m.prototype.prev=function(){var e=function(e,t){for(var i=-1,r=t.length-1;r>-1;r--)if(t[r]<e){i=t[r];break}return i<0?t[0]:i}(this.currentTime,this.keys);this.goto(e)}},95765:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeshAnimation:()=>d});var r,n,o,s,a,l,h=i(75050),c=i(24811),u=i(26754);function d(e,t,i){u.Animation.call(this,e,t,i),this.localMatrix=new h.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!t.custom||!t.custom.transform||"abs"!==t.custom.transform}d.prototype=Object.create(u.Animation.prototype),d.prototype.constructor=d,d.prototype.keyTypes=["pos","rot","scl"],d.prototype.defaultKey={pos:0,rot:0,scl:0},d.prototype.update=(r=[],n=new h.Vector3,o=new h.Vector3,s=new h.Quaternion,a=new h.Matrix4,l=new h.Matrix4,function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,i=this.hierarchy.length;t<i;t++){for(var h=this.hierarchy[t],d=h.animationCache[this.data.name],p=0;p<this.keyTypes.length;p++){var f=this.keyTypes[p],m=d.prevKey[f],g=d.nextKey[f];if(g.time<=this.currentTime||m.time>=this.currentTime){for(m=this.data.hierarchy[t].keys[0],g=this.getNextKeyWith(f,t,1);g.time<this.currentTime&&g.index>m.index;)m=g,g=this.getNextKeyWith(f,t,g.index+1);d.prevKey[f]=m,d.nextKey[f]=g}var v=m[f],y=g[f];if(g.time!==m.time&&void 0!==v&&void 0!==y){var b=(this.currentTime-m.time)/(g.time-m.time);if(b<0&&(b=0),b>1&&(b=1),"pos"===f)if(this.interpolationType===c.u.LINEAR)o.x=v[0]+(y[0]-v[0])*b,o.y=v[1]+(y[1]-v[1])*b,o.z=v[2]+(y[2]-v[2])*b,h.position.copy(o);else{r[0]=this.getPrevKeyWith("pos",t,m.index-1).pos,r[1]=v,r[2]=y,r[3]=this.getNextKeyWith("pos",t,g.index+1).pos,b=.33*b+.33;var x=(0,u.interpolateCatmullRom)(r,b);if(o.x=x[0],o.y=x[1],o.z=x[2],h.position.copy(o),this.interpolationType===c.u.CATMULLROM_FORWARD){var _=(0,u.interpolateCatmullRom)(r,1.01*b);n.set(_[0],_[1],_[2]),n.sub(vector),n.y=0,n.normalize();var E=Math.atan2(n.x,n.z);h.rotation.set(0,E,0)}}else"rot"===f?(s.slerpQuaternions(v,y,b),h.quaternion.copy(s)):"scl"===f&&(o.x=v[0]+(y[0]-v[0])*b,o.y=v[1]+(y[1]-v[1])*b,o.z=v[2]+(y[2]-v[2])*b,h.scale.copy(o))}}if(!this.relativeTransform){var A=a.compose(h.position,h.quaternion,h.scale),S=l;h.getOriginalWorldMatrix(S),S.invert(),a.multiplyMatrices(A,S).decompose(h.position,h.quaternion,h.scale)}h.updateAnimTransform()}})},87338:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AggregatedView:()=>_});var r=i(27156),n=i(7247),o=i(51063),s=i(91493);const a=Autodesk.Viewing,l=a.Private,h={BimWalk:"Autodesk.BimWalk",Bookmarks:"Autodesk.AEC.CanvasBookmarkExtension",Levels:"Autodesk.AEC.LevelsExtension",CrossFade:"Autodesk.CrossFadeEffects",Hyperlinks:"Autodesk.AEC.HyperlinkExtension",Minimap:"Autodesk.AEC.Minimap3DExtension",DropMe:"Autodesk.AEC.DropMeExtension",ZoomWindow:"Autodesk.Viewing.ZoomWindow",FusionOrbit:"Autodesk.Viewing.FusionOrbit",Disciplines:"Autodesk.AEC.DisciplinesExtension",DiffTool:"Autodesk.DiffTool",ModelStructure:"Autodesk.ModelStructure",ModelAlignment:"Autodesk.ModelAlignment",SheetAlignment:"Autodesk.SheetAlignment",ModelSheetTransition:"Autodesk.ModelSheetTransition"},c={ALIGNMENT_SERVICE_FAILED:"alignmentServiceFailure",ENVIRONMENT_CHANGED:"environmentChanged"},u={LocalStorage:()=>new Autodesk.ModelAlignmentService.AlignmentServiceLS},d=[h.ModelAlignment,h.SheetAlignment],p=e=>{return e instanceof a.BubbleNode?e.getModelKey():e instanceof a.Model?null===(t=e.getDocumentNode())||void 0===t?void 0:t.getModelKey():"string"==typeof e?e:void console.error("makeKey: Input must be key, model, or BubbleNode");var t},f=e=>isFinite(e.x)&&isFinite(e.y)&&isFinite(e.z),m=e=>{let t=e.getUpVector();return t&&(new THREE.Vector3).fromArray(t)},g=e=>f(e.position)&&f(e.target)&&f(e.up)&&isFinite(e.orthoScale),v=(e,t,i)=>{let r=0;const n=new THREE.Vector3;for(let o=0;o<e.length;o++){const s=e[o].getBoundingBox();if(i.intersectsBox(s)===Autodesk.Viewing.Private.FrustumIntersector.OUTSIDE)continue;const a=s.getSize(n).length;s.distanceToPoint(t)>50*a||r++}return r},y={enabled:!1,diffBubbles:void 0,primaryBubbles:void 0,diffBubbleLabel:void 0,primaryBubbleLabel:void 0,progressCallback:void 0,supportBubbles:void 0,refNames:void 0,customCompute:void 0},b=(e,t)=>{let i=e.getVisibleModels();i=i.filter((e=>{return t=e.getBoundingBox(),f(t.min)&&f(t.max);var t}));let r,n,o,s,a=e.impl.camera.clone(),l=new Autodesk.Viewing.Private.FrustumIntersector;const h=new THREE.Vector3;for(let e=0;e<i.length;e++){const t=i[e];r||(r=m(t));const c=t.getDefaultCamera();if(!c||!g(c))continue;const u=t.getBoundingBox();a.position.copy(c.position),a.target.copy(c.target),a.up.copy(c.up),a.isPerspective=c.isPerspective,a.near=u.distanceToPoint(a.position),a.far=a.near+u.getSize(h).length,a.updateMatrixWorld(),a.updateProjectionMatrix(),l.reset(a);const d=v(i,c.position,l);(!n||d>=o)&&(n=c,o=d,s=t)}n&&(n.pivot=n.target,n.worldup=r,n.fov=45,t&&t(n,s),e.autocam.sync(n),e.autocam.setHomeViewFrom(n))};class x{constructor(e){this.color=e,this.enabled=!0,this.active=!1}setEnabled(e,t){t!==this.enabled&&(this.enabled=t,this.active&&!t?(e.clearThemingColors(),this.active=!1):this.update(e))}update(e){if(this.active||!this.enabled)return;const t=e.myData.fragments.fragId2dbId;for(let i=0;i<t.length;i++){const r=t[i];e.setThemingColor(r,this.color)}this.active=!0}}class _{constructor(){this.globalOffset=void 0,this.refPoint=void 0,this.modelItems={},this.resetOnNextModelAdd=!0,this.resetTriggeringBubble=null,this.memTracker=null,this.cameraInitialized=!1,this.is3D=void 0,this.pendingCamera=null,this.extensionLoaded={},this.loadersInProgress={},this.diff={...y},this.modelIsGhosted={},this.diffCache=[],this.onDiffDone=void 0,this.waitForFirstModel=!1,this.loadPendingPromises={},this.onLoad=[],this.onUnload=[],this.modelThemingStates={},a.getGlobal().LMV_MAIN_VIEW=this,this.pendingAlignmentFetches=[],Autodesk.Viewing.EventDispatcher.prototype.apply(this)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.useConsolidation=void 0===t.useConsolidation||t.useConsolidation,this.initViewerInstance(e,t),this.memTracker=new a.ModelMemoryTracker(this.viewer,t.memoryLimit),this.viewer.impl.showTransparencyWhenMoving(),t.useDynamicGlobalOffset&&(this.dynamicGlobalOffset=new o.DynamicGlobalOffset(this.viewer)),this.options=t,this._registerLmvEventListeners(),this._loadExtensions()}initViewerInstance(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=t.viewerClass||(t.headlessViewer?a.Viewer3D:a.GuiViewer3D);let r=t.viewerConfig||{};r.disabledExtensions=r.disabledExtensions||{},r.disabledExtensions.hyperlink=!0,t.multiViewerFactory?this.viewer=t.multiViewerFactory.createViewer(e,t.viewerConfig,i):this.viewer=new i(e,t.viewerConfig),this.viewer.start(void 0,void 0,void 0,void 0,t.viewerStartOptions),t.propagateInputEventTypes&&(this.viewer.toolController.propagateInputEventTypes=t.propagateInputEventTypes,this.viewer.canvas.style.outline="none")}destroy(){var e;this.dynamicGlobalOffset=null,this.memTracker=null,this.modelItems=null,null===(e=this.viewer)||void 0===e||e.finish(),this.viewer=null,a.getGlobal().LMV_MAIN_VIEW=null}_onError(){console.error(...arguments)}reset(){this.hideAll(),this.pendingCamera=null,this.cameraInitialized=!1,this.resetOnNextModelAdd=!0,this._stopActiveTools(),this._unloadDiffTool(!0),this.refPoint=void 0,this.loadersInProgress={}}getModel(e){const t=this._getItem(e);return t&&t.model}getModelAndWait(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((i=>{const r=()=>{const t=this.getModel(e);if(t)return this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,r),this.onLoad.splice(this.onLoad.indexOf(r),1),i(t)};if(!(t&&!this.isVisible(e))){const t=this.getModel(e);if(t)return i(t)}this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,r),this.onLoad.push(r)}))}isEmpty(){return!this.getVisibleNodes().length}_initForEnvironmentChange(e,t){if(this.areAllNodes2D()&&e.is3D()){let i;if(this.is3D=t,!t){const t=e=>e.visible&&e.node&&e.node.is2D();i=Object.values(this.modelItems).filter(t)[0],e=i.node}this._updateExtensions(e),this._updateRefPoint(e),t?(this.resetOnNextModelAdd=!0,this.resetTriggeringBubble=e):i.model&&(this._resetOnModeSwitch(i.model),this.viewer.impl.setUp2DMode(i.model,!1),this.viewer.getExtension("Autodesk.ViewCubeUi",(e=>e.displayViewCube(!1,!1)))),this.fireEvent({type:c.ENVIRONMENT_CHANGED,is3D:this.is3D})}}_needsReset(e){return!!this.resetOnNextModelAdd&&(!this.resetTriggeringBubble||this.resetTriggeringBubble===e)}show(e,t){this.isEmpty()?this._initForFirstViewable(e):this._initForEnvironmentChange(e,!0);const i=e.getModelKey();let r,n=this.getModel(i);var o;n?(this.modelItems[i].visible=!0,this._showModel(n),r=Promise.resolve(n)):(r=null===(o=this.modelItems[i])||void 0===o?void 0:o.loadingPromise,r||(r=this.load(e,t)),this.modelItems[i].visible=!0);return this._updateModelTimestamps(),this._consolidateVisibleModels(),r}hide(e){let t=this._getItem(e);t&&(!this.options.unloadUnfinishedModels||t.model&&t.model.isLoadDone()?t.model&&this.viewer.hideModel(t.model.id):this.unload(t.node),t.visible=!1,b(this.viewer,this.options.cameraValidator),this._updateUpVector(),this._cleanupModels(),this._initForEnvironmentChange(t.node,!1))}isVisible(e){const t=this._getItem(e);return t&&t.visible}hideAll(){for(let e in this.modelItems)this.hide(e)}getVisibleNodes(){let e=[];for(let t in this.modelItems){let i=this.modelItems[t];i.visible&&e.push(i.node)}return e}areAllNodes2D(){const e=this.getVisibleNodes();return!!e.length&&e.every((e=>!(e instanceof Autodesk.Viewing.BubbleNode)||e.is2D()))}isOtgManifestMissing(e){if(e.is2D())return!1;let t=e.getOtgGraphicsNode();if(t&&!t.error)return!1;if(t?this._onError(`Otg translation failed for viewable '${e.name()}'. Error:`,t.error):this._onError(`Otg node missing for viewable '${e.name()}'.`),this.onViewerNotification){const t=a.i18n.t("Model translation failed for view '%(viewableName)'",{viewableName:e.name()});this.onViewerNotification("error",t)}return!0}load(e){var t,i;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=p(e);let o=this.modelItems[n];if(o||(o={model:null,node:e,visible:!1,url:null,loadingPromise:null,error:!1},this.modelItems[n]=o),o.loadingPromise)return o.loadingPromise;if(o.model)return Promise.resolve(o.model);if(this.options.disableSvf&&this.isOtgManifestMissing(e))return o.error=!0,Promise.reject("OTG manifest missing");if(o.error)return Promise.reject("Model load failed already");if(e.is3D()){if(this.waitForFirstModel)return new Promise(((e,t)=>{this.loadPendingPromises[n]={resolve:e,reject:t}}));this.options.ignoreGlobalOffset||this.globalOffset||(this.waitForFirstModel=!0)}let s=e.getRootNode().getDocument();const a={globalOffset:this.globalOffset,applyRefPoint:!0,applyScaling:this.options.viewerUnits,isAEC:!0,bvhOptions:l.Consolidation.getDefaultBVHOptions(),useConsolidation:!1,loadAsHidden:!0,bubbleNode:e,disablePrecomputedNodeBoxes:!0,preserveView:!0,onFragmentListLoadProgress:()=>this._updateDiffLoadProgress(),disable3DModelLayers:!0,keepCurrentModels:!0,headlessViewer:this.options.headlessViewer,leafletOptions:{fitPaperSize:!0}},h=this._onModelLoaded.bind(this),c=t=>this._onModelLoadFailed(e,t),u=null===(t=(i=this.options).getCustomLoadOptions)||void 0===t?void 0:t.call(i,e);return u&&Object.assign(a,u),r&&Object.assign(a,r),o.loadingPromise=new Promise(((t,i)=>{this._applyAlignmentService(e,a).then((()=>(this.viewer||i(),this.viewer.loadDocumentNode(s,e,a)))).then((e=>{this.viewer||i(),h(e),t(e)})).catch((e=>{c(e),i(e)}))})),o.loadingPromise}unloadUnderlayRaster(e){const t=this.viewer.getUnderlayRaster(e);t&&this.viewer.unloadModel(t)}unload(e){this.unloadUnderlayRaster(e),this.viewer.unloadDocumentNode(e);const t=this._getItem(e);t&&(t.loadingPromise&&this._onModelLoadEnded(t),t.model&&delete this.loadersInProgress[t.model.id]);let i=p(e);delete this.modelItems[i];const r=this.modelThemingStates[i];r&&(r.active=!1),this.onUnload.forEach((t=>t(e)))}unloadAll(e){let t=Object.keys(this.modelItems).slice();for(var i=0;i<t.length;i++){let r=t[i],n=this.modelItems[r];e&&!e(n)||this.unload(n.node)}}setCameraGlobal(e){this.pendingCamera={position:e.position&&(new THREE.Vector3).copy(e.position),target:e.target&&(new THREE.Vector3).copy(e.target),up:e.up&&(new THREE.Vector3).copy(e.up),fov:e.fov,isPerspective:e.isPerspective,ignoreGlobalOffset:e.ignoreGlobalOffset},this._applyPendingCameraWhenReady()}setCamera(e){this.viewer.impl.setViewFromCamera(e,!0),this.cameraInitialized=!0}startBimWalk(){this.bimWalkStartPending=!0,this._startBimWalkWhenReady()}stopBimWalk(){let e=this.viewer.getExtension(h.BimWalk);e&&e.isActive()&&e.deactivate(),this.bimWalkStartPending=!1}isBimWalkActive(){let e=this.viewer.getExtension("Autodesk.BimWalk");return e&&e.activeStatus||this.bimWalkStartPending}switchView(e,t){return this.reset(),this.setNodes(e,t)}setNodes(e,t){e=(e=e||[])instanceof a.BubbleNode?[e]:e,this.fetchAlignmentsForNodes(e);const i=e.filter((e=>!this.isVisible(e)));let r={};e.forEach((e=>{r[e.getModelKey()]=!0}));this.getVisibleNodes().filter((e=>void 0===r[e.getModelKey()])).forEach((e=>{this.hide(e)}));const n=i.map((e=>this.show(e)));return this._setDiff(t),Promise.all(n)}getFloorSelector(){return this.levelsExtension&&this.levelsExtension.floorSelector}setBookmarks(e){this.bookmarks=e,this._updateBookmarks()}isLoadDone(){for(let e in this.modelItems){const t=this.modelItems[e],i=t&&t.model,r=!i&&!t.error,n=i&&!i.isLoadDone(),o=i&&i.getPropertyDb()&&!i.getPropertyDb().isLoadDone(),s=l.TextureLoader.requestsInProgress()>0;if(r||n||o||s)return!1}return!0}waitForLoadDone(){return new Promise((e=>{this.isLoadDone()&&e();const t=()=>{this.isLoadDone()&&(this.viewer.removeEventListener(a.GEOMETRY_LOADED_EVENT,t),this.viewer.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,t),this.viewer.removeEventListener(a.TEXTURES_LOADED_EVENT,t),this.onUnload.splice(this.onUnload.indexOf(t),1),e())};this.viewer.addEventListener(a.GEOMETRY_LOADED_EVENT,t),this.viewer.addEventListener(a.OBJECT_TREE_CREATED_EVENT,t),this.viewer.addEventListener(a.TEXTURES_LOADED_EVENT,t),this.onUnload.push(t)}))}setAlignmentService(e){this.alignmentService=e,d.forEach((e=>this._connectModelAlignment(e)))}async fetchAlignments(e){if(!this.isUsingAlignmentService())return;const t=(async()=>{const t=await this.getAlignmentService();await t.fetchItems(e)})();return this.pendingAlignmentFetches.push(t),await t}fetchAlignmentsForNodes(e){const t=null==e?void 0:e.filter((e=>e.is3D())),i=null==t?void 0:t.map((e=>e.getRootNode().urn()));this.fetchAlignments(i)}static findDiffSupportModel(e){if(!e.is2D())return null;const t=e.data.phaseNames,i=Array.isArray(t)?t[0]:t;return i?e.getMasterView(i):(console.warn(`A sheet node must have a phase name. Missing for sheet: ${e.name}`),null)}static findDiffSupportModels(e){e.supportBubbles.diff=_.findDiffSupportModel(e.diffBubbles[0]),e.supportBubbles.primary=_.findDiffSupportModel(e.primaryBubbles[0])}updateHomeCamera(){b(this.viewer,this.options.cameraValidator)}_setDiff(e){if(e){Object.assign(this.diff,e,{enabled:!0});const t=e.supportBubbles;if(t)if(t.autoDetect&&_.findDiffSupportModels(e),t.diff&&t.primary)this.load(t.primary),this.load(t.diff);else{const t=e.diffBubbles&&e.diffBubbles[0];t&&t.is2D()&&console.warn("Could not find support models for 2D diff."),this.diff.supportBubbles=null}!e.empty&&e.progressCallback&&this._signalDiffLoadProgress(0,!0),this.diffStartTime=performance.now()}else Object.assign(this.diff,y);this.diffNeedsUpdate=!0,this._updateDiff()}_updateUpVector(){let e;if(this.areAllNodes2D())e=new THREE.Vector3(0,1,0);else{const t=e=>e.visible&&e.node&&e.node.is3D(),i=Object.values(this.modelItems).filter(t)[0];e=i&&i.model?m(i.model):new THREE.Vector3(0,0,1)}this.viewer.navigation.setWorldUpVector(e,!1,!0)}_showModel(e){if(e.is3d()&&!e.hasGeometry()){const t=e.getDocumentNode().getRootNode().children[0].name();return void console.warn("Ignored model with empty geometry: ",t)}this.viewer.showModel(e.id,!0),b(this.viewer,this.options.cameraValidator),this._updateUpVector()}_resetOnModeSwitch(e){this.viewer.getExtension(h.ZoomWindow)&&this.viewer.unloadExtension(h.ZoomWindow),this.options.headlessViewer||this.viewer.createUI(e,!0);const t=this.viewer.setNavigationLock(!1);this.viewer.activateDefaultNavigationTools(!this.is3D),this.viewer.setNavigationLock(t),this.viewer.navigation.setIs2D(!this.is3D),this._loadExtension(h.ZoomWindow).catch((e=>this._onError(e))),this._startBimWalkWhenReady()}_onModelAdded(e){const t=e.model;if(this.cameraInitialized||this._initCamera(t),t.getData().underlayRaster)return;t.is3d()&&this.options.useDynamicGlobalOffset&&(t.setGlobalOffset(this.viewer.impl.camera.globalOffset),this.viewer.impl.onModelTransformChanged(t));const i=e.model.getDocumentNode();if(this._needsReset(i)&&(this.resetTriggeringBubble=null,this.resetOnNextModelAdd=!1,this._resetOnModeSwitch(t)),(e=>{const t=e.getData(),i=t.loadOptions.bubbleNode;if(e.is3d()&&t.metadata.stats&&!t.metadata.stats.num_fragments){const e=i.name(),t=i.getRootNode().children[0].name();console.warn(`Empty View "${e}" in model "${t}".`)}})(t),i){const e=i.getModelKey();delete this.modelIsGhosted[e],this._updateGhosting()}}_onGeometryLoaded(e){this._consolidateVisibleModels(),this._updateDiff(),this.loadersInProgress[e.model.id]=100}_onExtensionLoaded(e){const t=e.extensionId;this._startBimWalkWhenReady(),t===h.Levels&&(this.levelsExtension=this.viewer.getExtension(h.Levels)),t===h.Bookmarks&&this._updateBookmarks(),d.includes(t)&&this.alignmentService&&this._connectModelAlignment(t)}_registerLmvEventListeners(){this.viewer.addEventListener(a.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded.bind(this)),this.viewer.addEventListener(a.MODEL_ADDED_EVENT,this._onModelAdded.bind(this)),this.viewer.addEventListener(a.EXTENSION_LOADED_EVENT,this._onExtensionLoaded.bind(this)),this.viewer.addEventListener(a.PROGRESS_UPDATE_EVENT,this._onProgressUpdate.bind(this)),this.viewer.addEventListener(a.MODEL_ROOT_LOADED_EVENT,this._updateDiff.bind(this))}_consolidateVisibleModels(){if(this._cleanupModels(),(0,n.isMobileDevice)()&&!this.viewer.impl.useDeferredConsolidation)return;let e=(0,r.getParameterByName)("useConsolidation");if("false"===e||!1===this.options.useConsolidation&&"true"!==e)return;const t=this.viewer.getVisibleModels();for(let e=0;e<t.length;e++){const i=t[e];if(this.memTracker.memoryExceeded())return;if(!(i&&i.isLoadDone()))return;if(i.is2d()||i.isSceneBuilder())return;i.isConsolidated()||(this.viewer.impl.consolidateModel(i),this._cleanupModels())}}_cleanupModels(){this._updateModelTimestamps();this.memTracker.cleanup((e=>{const t=e.getDocumentNode(),i=this._getItem(t);i&&i.visible||this.unload(t)}))}_updateModelTimestamps(){let e=this.viewer.getVisibleModels().slice();const t=this._getDiffSupportModels();this.diff.enabled&&t&&(t.diff&&e.push(t.diff),t.primary&&e.push(t.primary)),this.memTracker.updateModelTimestamps(e)}_stopActiveTools(){const e=this.viewer.getExtension("Autodesk.Section");e&&e.isActive()&&e.enableSectionTool(!1),this.stopBimWalk();const t=!this.options.headlessViewer&&this.viewer.getPropertyPanel(!1);t&&t.isVisible()&&t.setVisible(!1)}_onModelLoaded(e){let t=this._getItem(e);t&&(e.is3d()&&(this.options.useDynamicGlobalOffset?e.setGlobalOffset(this.viewer.impl.camera.globalOffset):this.waitForFirstModel&&!this.options.ignoreGlobalOffset&&(this.globalOffset=(new THREE.Vector3).copy(e.myData.globalOffset),this._onGlobalOffsetChanged())),t.model=e,t.visible&&this._showModel(t.model),this._updateModelTimestamps(),this._updateDiffLoadProgress(),this._updateModelTheming(e),this._onModelLoadEnded(t))}_onModelLoadFailed(e,t){this._onError(`Failed to load model: ${e.name()}. Error code: ${t}`);const i=this._getItem(e);i&&(i.error=!0,this._onModelLoadEnded(i))}_onModelLoadEnded(e){e.loadingPromise=null;const t=e.node;t.is3D()&&this.waitForFirstModel&&(this.waitForFirstModel=!1,Object.keys(this.loadPendingPromises).forEach((e=>{var t;const i=null===(t=this.modelItems[e])||void 0===t?void 0:t.node;if(!i)return;const{resolve:r,reject:n}=this.loadPendingPromises[e];this.load(i).then((e=>{r(e)})).catch((e=>{n(e)}))})),this.loadPendingPromises={}),this.onLoad.forEach((e=>e(t)))}_initCamera(e,t){this.viewer.impl.setViewFromFile(e,!t),this.options.cameraValidator&&this.options.cameraValidator(this.viewer.impl.camera,e),this.viewer.impl.controls.recordHomeView(),this.cameraInitialized=!0,this.pendingCamera&&this._applyPendingCameraWhenReady()}_getItem(e){var t;let i=p(e);return null===(t=this.modelItems)||void 0===t?void 0:t[i]}_updateRefPoint(e){if(this.options.useDynamicGlobalOffset)return;if(!(this.isEmpty()||this.areAllNodes2D())||!e.is3D()||this.options.ignoreGlobalOffset)return;const t=e.getAecModelData();if(!t)return;let i=t.refPointTransformation;if(!i)return;const r={x:i[9],y:i[10],z:0};if(this.isUsingAlignmentService()){var n;const t=e.getRootNode().urn(),i=null===(n=this.alignmentService)||void 0===n?void 0:n.getTransform(t);if(void 0===i)return;i&&(r.x=i.elements[12],r.y=i.elements[13])}if(this.refPoint=r,this.options.viewerUnits){const e=Autodesk.Viewing.Private.convertUnits("ft",this.options.viewerUnits,1,1);this.refPoint.x*=e,this.refPoint.y*=e,this.refPoint.z*=e}const o=this.globalOffset&&THREE.Vector3.prototype.distanceToSquared.call(this.refPoint,this.globalOffset);(!this.globalOffset||o>4e6)&&(this.globalOffset=(new THREE.Vector3).copy(this.refPoint),this.unloadAll((e=>e.model&&e.model.is3d())),this._onGlobalOffsetChanged())}_onGlobalOffsetChanged(){const e=this.viewer.getExtension(h.Bookmarks);e&&e.resetGlobalOffset(this.globalOffset)}_getDefaultExtensions(){return[{name:h.CrossFade,getLoadingCondition:()=>!a.isMobileDevice()},{name:h.Levels,getOptions:()=>this.viewer.config},{name:h.ModelStructure,getOptions:()=>this.viewer.config},{name:h.Hyperlinks,getOptions:()=>({loadViewableCb:(e,t)=>{this.onHyperlink?this.onHyperlink(e,t):this.switchView([e])}})},{name:h.Minimap,getLoadingCondition:()=>!this.options.disableMinimap,getOptions:()=>({trackUsage:this._trackMinimapUsage?this._trackMinimapUsage.bind(this):void 0})},{name:h.Bookmarks,getLoadingCondition:()=>this.is3D,getOptions:()=>({globalOffset:this.globalOffset,onBookmark:(e,t)=>{this.onBookmark?this.onBookmark(e,t):this.switchView([e]),t.isPerspective&&this.startBimWalk()},clusterfck:this.options.clusterfck,clusteringThreshold:110})},{name:h.DropMe,getLoadingCondition:()=>!1===this.is3D,getOptions:()=>({enableGuidance:!0,onDrop:this._handleDropMe.bind(this),getTransformForNode:this._getTransformForNode.bind(this),getMain3DView:this._findMain3DView.bind(this),onHandleViewIn3D:this._handleViewIn3D.bind(this)})}]}async _loadExtensions(){this.extensions=this.options.extensions||this._getDefaultExtensions();const e=[];return this.extensions.forEach((t=>{t.getLoadingCondition&&!t.getLoadingCondition(this)||(e.push(this._loadExtension(t.name,t.getOptions&&t.getOptions(this),t.onLoadedCB)),this.extensionLoaded[t.name]=!0)})),Promise.all(e)}async _loadExtension(e,t,i){const r=this.options.extensionOptions,n=r&&r[e],o=Object.assign({},t,n),s=this.viewer.loadExtension(e,o);return i&&s.then((e=>{i(this,e)})).catch((e=>{i(this,null,e)})),s}_updateExtensions(e){const t=(e,t,i,r,n)=>{const o=this.extensionLoaded[e];!o&&i?this._loadExtension(e,t,r).catch((e=>this._onError(e))):o&&!i&&(n&&n(this),this.viewer.unloadExtension(e)),this.extensionLoaded[e]=i};this.extensions.forEach((i=>{i.getLoadingCondition&&t(i.name,i.getOptions&&i.getOptions(this),i.getLoadingCondition(this,e),i.onLoadedCB,i.onBeforeUnloadCB)}))}_initForFirstViewable(e){this.is3D!==e.is3D()&&(this.resetOnNextModelAdd||(this.reset(),this.resetTriggeringBubble=e),this.is3D=e.is3D()),this._updateExtensions(e),this._updateRefPoint(e)}_updateBookmarks(){let e=this.viewer.getExtension(h.Bookmarks);e&&e.resetBookmarks(this.bookmarks)}_applyPendingCameraWhenReady(){if(!this.cameraInitialized)return;let e=this.pendingCamera;this.pendingCamera=null;let t=this.viewer.impl.camera;e.position&&t.position.copy(e.position),e.target&&t.target.copy(e.target),e.up&&t.up.copy(e.up),e.fov&&(t.fov=e.fov),void 0!==e.isPerspective&&(t.isPerspective=e.isPerspective);const i=this.globalOffset||this.viewer.model.getData().globalOffset;!this.is3D||this.options.ignoreGlobalOffset||e.ignoreGlobalOffset||(t.position.sub(i),t.target.sub(i)),this.viewer.impl.syncCamera()}_findMain3DView(e){const t=e.getMasterViews();if(t[0])return t[0];const i=null==e?void 0:e.getRootNode();if(!i)return;const r=null==i?void 0:i.search(a.BubbleNode.MODEL_NODE),n=r.filter((e=>e.name().toLowerCase().startsWith("{3d")))[0];return n||r[0]}_handleDropMe(e,t,i,r,n){if(this.onDrop)this.onDrop(e,t,i,r);else if(r){if(this.switchView(r),e&&t){let i={position:e,target:e.clone().add(t),isPerspective:!0,ignoreGlobalOffset:n};this.setCameraGlobal(i)}}else console.warn("DropMe handler: Document does not contain a 3D view to switch to")}async _handleViewIn3D(e,t,i,r){if(i&&!this.options.ignoreGlobalOffset){const i=this.globalOffset||this.viewer.model.getData().globalOffset;e=e.clone().add(i),t=t.clone().add(i)}let n={position:e,target:t,isPerspective:!0};this.setCameraGlobal(n);const o=await this.viewer.getExtensionAsync(h.BimWalk);o.activate(),o.disableGravityUntilNextMove(),r&&r()}_startBimWalkWhenReady(){if(!this.bimWalkStartPending)return;let e=!this.resetOnNextModelAdd,t=this.viewer.getExtension(h.BimWalk),i=this.viewer.getExtension(h.FusionOrbit);e&&t&&i&&(t.activate(),this.bimWalkStartPending=!1)}_unloadDiffTool(e){this.viewer.getExtension(h.DiffTool)&&(e&&(this.diffCache.length=0),this.viewer.unloadExtension(h.DiffTool))}_onProgressUpdate(e){e.model&&e.state===a.ProgressState.LOADING&&(this.loadersInProgress[e.model.id]=e.percent,this._updateDiffLoadProgress())}_getDiffSupportModels(){if(this.diff.supportBubbles)return{diff:this.getModel(this.diff.supportBubbles.diff),primary:this.getModel(this.diff.supportBubbles.primary)}}_diffSupportModelsReady(){const e=this._getDiffSupportModels(),t=e.diff&&e.diff.isLoadDone(),i=e.primary&&e.primary.isLoadDone();return t&&i}_updateGhosting(){let e={};this.diff.enabled&&this.diffBubbles&&(e=this.diffBubbles.forEach((t=>e[t.getModelKey()])));for(let t in this.modelItems){let i=this.getModel(t);if(!i)continue;let r=this.diff.enabled&&!e[t];r!=!!this.modelIsGhosted[t]&&(i.setAllVisibility(!r),r?this.modelIsGhosted[t]=!0:delete this.modelIsGhosted[t])}this.viewer.refresh(!0)}getModels(e){return e.map((e=>this.getModel(e)))}setModelTheming(e){e=e||{};const t=this.modelThemingStates;this.modelThemingStates={};for(let i in e){let r=t[i];const n=e[i],o=this.getModel(i);if(r){!r.color.equals(n)&&(r.color.copy(n),r.active=!1)}else r=new x(n);this.modelThemingStates[i]=r,o&&this._updateModelTheming(o)}for(let i in t){const r=t[i],n=!e[i],o=this.getModel(i);n&&r.active&&o&&this.viewer.clearThemingColors(o)}}_signalDiffLoadProgress(e,t){if(t||e!==this._lastDiffLoadPercent){const t=a.i18n.t("Loading Model for Change Visualization");this.diff.progressCallback(e,t),this._lastDiffLoadPercent=e}}_updateDiffLoadProgress(){if(!this.diffNeedsUpdate||!this.diff.enabled||this.diff.empty||!this.diff.progressCallback)return;const e=this.getModels(this.diff.diffBubbles),t=this.getModels(this.diff.primaryBubbles),i=e.concat(t),r=this._getDiffSupportModels();r&&i.push(r.diff,r.primary);const n=i.filter(Boolean).length;if(n<i.length){const e=Math.floor(10*n/i.length);return void this._signalDiffLoadProgress(e)}if(!this.is3D){const e=(e,t)=>e+(0|this.loadersInProgress[t.id]),t=i.reduce(e,0),r=100*i.length,n=10+Math.floor(90*t/r);return void this._signalDiffLoadProgress(n)}const o=i.reduce(((e,t)=>e+t.getData().fragsLoadedNoGeom),0),s=i.reduce(((e,t)=>e+t.getData().metadata.stats.num_fragments),0),a=10+Math.floor(90*o/s);this._signalDiffLoadProgress(a)}_updateDiff(){if(!this.diffNeedsUpdate)return;if(this._updateGhosting(),this._updateDiffLoadProgress(),!this.diff.enabled)return this._unloadDiffTool(),void this._updateAllModelTheming();const e=this.getModels(this.diff.diffBubbles),t=this.getModels(this.diff.primaryBubbles);if(this.diff.customCompute){let i=t,r=e;const n=[this.diff.customCompute].flat();for(const e of n)[i,r]=e.init(i,r)}for(let i=0;i<e.length;i++){const r=e[i],n=t[i],o=r instanceof a.Model&&(r.isOTG()||r.isLoadDone()),s=n instanceof a.Model&&(n.isOTG()||n.isLoadDone());if(!o||!s)return;if(!r.getPropertyDb()||!n.getPropertyDb())return}let i;if(!!this.diff.supportBubbles){if(!this._diffSupportModelsReady())return;i=this._getDiffSupportModels()}const r=performance.now()-this.diffStartTime;console.log("Time for loading diff models: ",r),this._updateAllModelTheming(),this._setDiffModels(e,t,i)}_setDiffModels(e,t,i){if(this.diffNeedsUpdate=!1,!t.length)return void this._unloadDiffTool();const r=this.viewer.getExtension(h.DiffTool);if(r)r.replaceModels(e,t,i);else{const r={diffModels:e,primaryModels:t,supportModels:i,diffadp:!1,availableDiffModes:["overlay","sidebyside"],diffMode:"overlay",customCompute:this.diff.customCompute,versionA:this.diff.primaryBubbleLabel,versionB:this.diff.diffBubbleLabel,refNames:this.diff.refNames,mimeType:"application/vnd.autodesk.revit",hotReload:!0,diffCache:this.diffCache,useSplitScreenExtension:!0,showDetailsSection:!0,progress:(e,t)=>{this.diff.progressCallback&&(t!==Autodesk.DiffTool.DIFFTOOL_PROGRESS_STATES.LoadingPropDb?(100===e&&this.onDiffDone&&this.onDiffDone(),this.diff.progressCallback(e,a.i18n.t("Computing change visualization"))):this.diff.progressCallback(e,a.i18n.t("Loading element properties")))},excludeFromDiff:(e,t)=>this.levelsExtension&&!this.levelsExtension.floorSelector.isVisible(e,t),setNodesOff:e=>{const t=this.levelsExtension;t&&t.floorSelector._floorSelectorFilter.reApplyFilter(e)},hideModeSwitchButton:!0,externalUi:this.diff.externalUi,attachDetachViewerEventHandlers:this.diff.attachDetachViewerEventHandlers,onDiffModeChanged:this.diff.onDiffModeChanged,onInitialized:this.diff.onInitialized};this._loadExtension(h.DiffTool,r).catch((e=>this._onError(e)))}}_updateModelTheming(e){const t=p(e),i=this.modelThemingStates[t];if(!i)return;const r=!this.viewer.getExtension(h.DiffTool);i.setEnabled(e,r),i.update(e),this.viewer.impl.invalidate(!0)}_updateAllModelTheming(){for(let e in this.modelItems){let t=this.getModel(e);t&&this._updateModelTheming(t)}}async getAlignmentService(){return this.alignmentService||(this._alignmentServicePromise?await this._alignmentServicePromise:(this._alignmentServicePromise=this._initAlignmentService(),await this._alignmentServicePromise,this._alignmentServicePromise=null)),this.alignmentService}isUsingAlignmentService(){return this.options.createModelAlignmentService||this.alignmentService}async _initAlignmentService(){const e=this.options.createModelAlignmentService;if(!e)return;await this.viewer.loadExtension("Autodesk.ModelAlignmentService").then((async()=>{const t=await e();this.viewer&&this.setAlignmentService(t)}))}async _getTransformForNode(e){const t=await this.getAlignmentService();if(!t)return;await Promise.all(this.pendingAlignmentFetches);const i=e.getRootNode().urn(),r=e.is2D()?e.name():void 0;return await t.loadTransform(i,r)}async _applyAlignmentService(e,t){if(e.is2D())return;if(this.alignmentServiceFailed)return;const i=await this._getTransformForNode(e);this._checkAlignmentService()&&(!function(){l.analytics.track(...arguments)}("viewer.modelalignment.alignment_loaded",{hasAlignmentTransform:Boolean(i)}),i&&(t.applyRefPoint=!1,t.placementTransform=i,t.applyPlacementInModelUnits=!0))}_checkAlignmentService(){if(this.alignmentServiceFailed||!this.alignmentService)return!1;if(this.alignmentService.isWorking())return!0;const e=s.Z.t("Failed to connect to alignment service: Model alignment support is temporarily unavaible. Models with alignment transforms may not appear correctly and alignment editing is disabled.");this.fireEvent({type:c.ALIGNMENT_SERVICE_FAILED,message:e}),l.logger.error("AggregatedView: Disabled alignment due to alignment service connection error."),this.alignmentServiceFailed=!0}_connectModelAlignment(e){const t=this.viewer.getExtension(e);t&&t.setAlignmentService(this.alignmentService)}}_.ExtNames=h,_.AlignmentServices=u,_.Events=c},49830:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CameraLS:()=>a});var r=i(76542);const n=e=>isFinite(e.x)&&isFinite(e.y)&&isFinite(e.z),o=e=>{const t=e.isPerspective||isFinite(e.orthoScale);return n(e.position)&&n(e.target)&&n(e.up)&&t};class s{constructor(){this.cacheObj={}}setItem(e,t){this.cacheObj[e]=t}getItem(e){return this.cacheObj[e]}}class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{useLocalStorage:!0};this.aggregatedView=e,this.options=t,this.key=void 0,this.options.useLocalStorage?this.cache=Autodesk.Viewing.Private.LocalStorage:this.cache=new s,this.unloadCb=this.saveCamera.bind(this),this.addWindowEventListener("beforeunload",this.unloadCb)}destroy(){this.unsetKey(),this.removeWindowEventListener("beforeunload",this.unloadCb)}setKey(e){this.key=e}unsetKey(){this.key=void 0}saveCamera(){if(!this.aggregatedView.cameraInitialized||!this.key)return;const e=this.aggregatedView.viewer.impl.camera;if(!o(e))return;const t=this.aggregatedView.isBimWalkActive(),i=this.aggregatedView.is3D?this.aggregatedView.globalOffset:void 0;this.saveStartCamera(this.key,this.aggregatedView.viewer.impl.camera,t,i)}saveStartCamera(e,t,i,r,n){const o=JSON.stringify({offset:r,position:t.position,target:t.target,up:t.up,orthoScale:t.orthoScale,isPerspective:t.isPerspective,fov:t.fov,startBimWalk:i,ignoreGlobalOffset:n});this.cache.setItem(e,o)}clearItem(e){this.cache.setItem(e)}loadCamera(){if(!this.key)return!1;let e;try{const t=this.cache.getItem(this.key);e=JSON.parse(t)}catch(e){}if(!(e&&e.position&&e.target&&e.up))return!1;const t=e=>new THREE.Vector3(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z)),i={position:t(e.position),target:t(e.target),up:t(e.up),isPerspective:Boolean(e.isPerspective),fov:parseFloat(e.fov),ignoreGlobalOffset:Boolean(e.ignoreGlobalOffset)};if(e.orthoScale&&(i.orthoScale=parseFloat(e.orthoScale)),!o(i))return!1;const r=e.offset?t(e.offset):void 0;if(r){if(!n(r))return;i.position.add(r),i.target.add(r)}this.aggregatedView.setCameraGlobal(i),e.startBimWalk&&this.aggregatedView.startBimWalk()}}r.GlobalManagerMixin.call(a.prototype)},28612:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Document:()=>p});var r=i(39080),n=i(22599),o=i(97790),s=i(68110),a=i(7247),l=i(60489),h=i(6875),c=i(27156),u=(0,a.getGlobal)(),d=u;function p(e,t,i){this.myPath=t,this.myData=e,e&&(this.docRoot=new r.BubbleNode(e),this.docRoot.setDocument(this)),this.myNumViews={},this.acmSessionId=i;var n=this;this.docRoot.traverse((function(e){if(e.isViewPreset()){const t=e.findParentGeom2Dor3D();if(t){let e=n.myNumViews[t.guid()]||0;n.myNumViews[t.guid()]=e+1}}}))}p.load=function(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const l=p.getDocumentPath(e);let d,f;function m(t){let i=e.split(":");i=i[1];const r=(0,c.fromUrlSafeBase64)(i);for(let e=0;e<t.length;e++)if(r.indexOf(t[e])>-1)return!0;return!1}if(e.startsWith("urn")&&m(["urn:adsk.wipprodanz"])||o.endpoint.getApiFlavor().match(/APAC/i)){const e=o.endpoint.getApiFlavor(),t=(0,o.getEnv)();null!==t.match(/prod/i)?o.endpoint.setEndpointAndApi("https://cdn-apac.derivative.autodesk.com",e):null!==t.match(/stag/i)&&o.endpoint.setEndpointAndApi("https://cdn-apac-stg.derivative.autodesk.com",e)}if(e.startsWith("urn")&&m(["urn:adsk.wipemea","urn:adsk.wipbimemea"])){var g=o.endpoint.getApiFlavor(),v=(0,o.getEnv)(),y=g===o.endpoint.ENDPOINT_API_DERIVATIVE_SERVICE_V2&&!v.endsWith("EU"),b=v.endsWith("US")&&g===o.endpoint.ENDPOINT_API_D3S,x=g===o.endpoint.ENDPOINT_API_DERIVATIVE_STREAMING&&!g.endsWith("_EU");if(g+="_EU",y)o.endpoint.setEndpointAndApi(null,g);else if(b){v=v.replace("US","EU"),(0,o.setEnv)(v);var _=h.EnvironmentConfigurations[v];o.endpoint.setEndpointAndApi(_.ROOT,g)}else x&&o.endpoint.setEndpointAndApi(null,g)}function E(e){(o.endpoint.isSVF2Backend()||o.endpoint.isOtgBackend())&&(d=d?e.urn+","+d:e.urn);const r=new p(e,l,d);f=r.getGlobalMessages();if(r.docRoot.findAllViewables().length>0)t&&t(r,f);else{const e=n.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT;i&&i(e,"No viewable content",f)}}function A(e,t,r){if(401===e&&void 0===u.LMV_THIRD_PARTY_COOKIE)u.LMV_THIRD_PARTY_COOKIE=!1,(0,h.refreshRequestHeader)(h.token.accessToken),S();else if(i){var o="Error: "+e+" ("+t+")",s=(0,n.getErrorCode)(e);i(s,o,e,t,r)}}function S(){const e=!r||(o.endpoint.isSVF2Backend()||o.endpoint.isOtgBackend())&&!r["x-ads-acm-scopes"];if(!d&&!e)return r.oauth2AccessToken||(r.oauth2AccessToken=h.token.accessToken),void s.ViewingService.getACMSession(o.endpoint.getApiEndpoint(),r,(function(e){d=e,a.queryParams=d?"acmsession="+d:"",o.endpoint.setAcmSession(d),s.ViewingService.getManifest(o.endpoint.initLoadContext(a),l,E,A)}),i);const t=o.endpoint.initLoadContext(a);s.ViewingService.getManifest(t,l,E,A)}S()},p.getDocumentPath=function(e){if(-1===e.indexOf("urn:")){if(-1!==e.indexOf("://"))return e;var t=e;return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),d.location.protocol+"//"+d.location.host+t):t}return e},p.requestThumbnailWithSecurity=function(e,t){var i={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid,acmsession:e.acmsession},r="urn:"+e.urn,n=void 0;if(!(0,a.getGlobal)().USE_OTG_DS_PROXY){var l=(0,o.getEnv)();n=h.EnvironmentConfigurations[l].UPSTREAM;const e=(0,h.getUpstreamApiData)(l,o.endpoint.getApiFlavor());i.apiData=e}s.ViewingService.getThumbnail(o.endpoint.initLoadContext({endpoint:n}),r,(function(e){t(null,e)}),(function(){t("error",null)}),i)},p.prototype.getAcmSessionId=function(e){return this.acmSessionId?p.getAcmSessionId(e,this.acmSessionId):""},p.getAcmSessionId=function(e,t){if(!e)return"";let i=e.indexOf("urn:adsk.fluent")>=0;return(0,a.getGlobal)().USE_OTG_DS_PROXY||i||!o.endpoint.isSVF2Backend()&&!o.endpoint.isOtgBackend()?t:t.split(",")[1]||""},p.prototype.getFullPath=function(e){if(!e)return e;var t=e;if((0,o.isOffline)())-1==t.indexOf((0,o.getOfflineResourcePrefix)())&&(t=decodeURIComponent((0,o.getOfflineResourcePrefix)())+t.substr(t.indexOf("/")));else if(0===e.indexOf("urn")){if(0===e.indexOf("urn:adsk.fluent")||!o.endpoint.isSVF2Backend()&&!o.endpoint.isOtgBackend())t=o.endpoint.getItemApi(null,e),o.endpoint.ENDPOINT_API_MODEL_DERIVATIVE_V2===o.endpoint.getApiFlavor()&&(t=decodeURIComponent(t));else{const i=(0,o.getEnv)(),r=h.EnvironmentConfigurations[i],n=(0,a.getGlobal)().USE_OTG_DS_PROXY?null:r.UPSTREAM,s=(0,h.getUpstreamApiData)(i,o.endpoint.getApiFlavor());t=o.endpoint.getItemApi(n,e,s)}}else 0===e.indexOf("$file$")&&(t=this.myPath.replace("/bubble.json",e.replace("$file$","")));return t},p.prototype.getThumbnailOptions=function(e,t,i){var r=t||200,n=i||200,o=e.urn||this.myData.urn;return{urn:o,width:r,height:n,guid:e.guid,acmsession:this.getAcmSessionId(o)}},p.prototype.getThumbnailPath=function(e,t,i){var r=this.getThumbnailOptions(e,t,i),n=o.endpoint.getThumbnailApi(null,r.urn)+"?width="+r.width+"&height="+r.height;r.guid&&(n+="&guid="+r.guid),r.acmsession&&(n+="&acmsession="+r.acmsession);var s=o.endpoint.getQueryParams();return s&&(n+="&"+s),n},p.prototype.getLeafletZipParams=function(e,t){for(var i,r,n=t.search({role:"leaflet-zip"},!1),o=0;o<n.length;o++){r={};var s=(i=n[o]._raw()).urn;r.urnZip=this.getFullPath(s),r.centralDirOffset=i.central_dir_offset,r.centralDirLength=i.central_dir_length,r.centralDirEntries=i.central_dir_entries,r.zipMaxLevel=i.max_level-e.levelOffset,r.loadFromZip=!!(r.urnZip&&r.centralDirOffset&&r.centralDirLength&&r.centralDirEntries),r.fileTable={},e.zips||(e.zips=[]),e.zips.push(r)}e.zips.sort((function(e,t){return e.zipMaxLevel-t.zipMaxLevel}))},p.prototype.getLeafletParams=function(e,t,i){e.tileSize=i.tileSize?i.tileSize:512,e.texWidth=i.resolution[0],e.texHeight=i.resolution[1],e.paperWidth=i.paperWidth,e.paperHeight=i.paperHeight,e.paperUnits=i.paperUnits,e.urlPattern=i.urn,e.mime=i.mime,e.isLeaflet=!0,e.levelOffset=function(e){for(var t=1,i=0,r=0;r<20;r++){if((t*=2)>e)return i;i++}return l.logger.log("unexpected leaflet tileSize"),0}(e.tileSize),this.getLeafletZipParams(e,t),e.loadFromZip=e.zips&&e.zips[0].loadFromZip,e.zips&&(0,o.isOffline)()&&(0,a.isMobileDevice)()&&(e.zips=e.zips.slice(0,1),e.maxLevel=e.zips[0].zipMaxLevel)},p.prototype.derivePdfUrnHack=function(e,t){var i=e.parent.children.slice();i.sort(((e,t)=>e._raw().order-t._raw().order));let n;n=i.length<=75?i[i.length-1]:i[74];let o=n.search(r.BubbleNode.GEOMETRY_F2D_NODE)[0];if(o){var s=o.urn().indexOf("/"),a=o.urn().slice(0,s),l=e._raw().order,h=0|l%75,c=1+(0|l/75),u=a+`/output/${h}/${h}.pdf`;return t.page=c,t.isPdf=!0,console.log("pdf path",u),u}return null},p.prototype.getViewableUrn=function(e,t){let i;if(e instanceof r.BubbleNode)i=e;else{let t=this.docRoot.search(e);i=t.length>0?t[0]:new r.BubbleNode(e)}const n=()=>{const e=i.search(r.BubbleNode.GEOMETRY_F2D_NODE);if(e.length)return e[0].urn()},o=()=>{if(i.isRevitPdf()){const e=n();if(e)return e}var e=i.data.totalRasterPixels;"number"!=typeof e&&(e=1/0);var o=e<1<<21,s="true"===(0,c.getParameterByName)("vectorPdf")||(0,a.getGlobal)().LMV_VECTOR_PDF||this.myData&&this.myData.isVectorPDF||!!i.data.isVectorPDF,l="false"===(0,c.getParameterByName)("vectorPdf")||(0,a.getGlobal)().LMV_RASTER_PDF;s?o=!0:l&&(o=!1);var h=i.search(r.BubbleNode.PDF_PAGE_NODE),u=i.search(r.BubbleNode.LEAFLET_NODE);if(o&&u.length>0&&t&&(this.getLeafletParams(t,i,u[0]._raw()),t.tempRasterPath=u[0].urn()),o&&h.length)return t&&(t.isPdf=!0,t.page=h[0].data.page||1),h[0].urn();if(u.length>0&&t){if(s){var d=this.derivePdfUrnHack(i,t);if(d)return d}return this.getLeafletParams(t,i,u[0]._raw()),u[0].urn()}};if(i.isGeometry()){if(i.is3D())return i.getViewableRootPath();if(i.is2D()){const e=o()||(()=>{const e=i.search(r.BubbleNode.IMAGE_NODE);if(e.length)return e[0].urn()})()||n();if(e)return e}}else if(i.isViewPreset()){var s=this.getViewGeometry(i,!0);if(s)return this.getViewableUrn(s,t)}return i.is3DTilesFormat()?this.myPath:""},p.prototype.getViewablePath=function(e,t){var i=this.getViewableUrn(e,t);return i?this.getFullPath(i):""},p.prototype.downloadAecModelData=function(e){const t=e?t=>{try{e(t)}catch(e){console.error("Document.downloadAecModelData() onFinished handler crashed",e)}return t}:e=>e;if(this.downloadAecModelDataPromise)return this.downloadAecModelDataPromise.then(t),this.downloadAecModelDataPromise;var i=this.docRoot.findViewableParent(),r=i&&i.data.aec_model_data;if(r)return t(r),Promise.resolve(r);var n=this.docRoot.search({role:"Autodesk.AEC.ModelData"})[0];if(!n)return t(),Promise.resolve(null);let a=n.getViewableRootPath();const l=this.getFullPath(a),c={headers:{}},u=this.getAcmSessionId(l);return-1!==l.indexOf(".api.autodesk.com")&&h.token.accessToken&&(c.headers.Authorization="Bearer "+h.token.accessToken),u&&(c.queryParams="acmsession="+u),this.downloadAecModelDataPromise=new Promise((e=>{var t=t=>{n.findViewableParent().data.aec_model_data=t,e(t)};s.ViewingService.getItem(o.endpoint.initLoadContext(c),l,(e=>t(e)),(()=>t()),{responseType:"json"})})).then((e=>(delete this.downloadAecModelDataPromise,e))).then(t),this.downloadAecModelDataPromise},p.getAecModelData=function(e){if(Array.isArray(e)){let t=new Map,i=e.map((e=>{let i=e.getDocument(),r=t.get(i);if(r)return r;{let e=i.downloadAecModelData();return t[i]=e,e}}));return Promise.all(i)}return e.getDocument().downloadAecModelData()},p.prototype.getRoot=function(){return this.docRoot},p.prototype.getPath=function(){return this.myPath},p.prototype.getViewGeometry=function(e){return e.findParentGeom2Dor3D()},p.prototype.getNumViews=function(e){var t=e.guid;return e instanceof r.BubbleNode&&(t=e.guid()),this.myNumViews[t]||0},p.prototype.getMessages=function(e,t){var i=[];if(!e)return i;for(var r=e;r&&(!t||r.parent);)r._raw().messages&&(i=i.concat(r._raw().messages)),r=r.parent;return i},p.prototype.getGlobalMessages=function(){var e=[],t=0,i=0;this.getRoot().traverse((function(r){var n=r._raw().messages||[];n.filter((function(e){return"error"===e.type})).length>0&&(t+=1),"inprogress"===r._raw().status&&(i+=1),e=e.concat(n)}));var r="translated";r=t>0?"failed":r,r=i>0?"processing":r;for(var n=e.length;n--;e[n].$translation=r);return e}},51063:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DynamicGlobalOffset:()=>a});const r=Autodesk.Viewing.Private;let n=null,o=null,s=null;class a{constructor(e){this.viewer=e,this.enabled=!1,this.onCameraChanged=this.onCameraChanged.bind(this);this.maxDistSq=1e8,this.setActive(!0)}setActive(e){e!=this.enabled&&(this.enabled=e,e?this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged):this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged))}static updateModelMatrix(e,t,i){n=n||new r.LmvMatrix4(!0),o=o||new r.LmvMatrix4(!0),s=s||new r.LmvMatrix4(!0);const a=e.myData.placementWithOffset?n.copy(e.myData.placementWithOffset).invert():n.identity(),l=t?o.copy(t):o.identity();i&&(l.elements[12]-=i.x,l.elements[13]-=i.y,l.elements[14]-=i.z);const h=s.multiplyMatrices(l,a);e.setModelTransform(h)}onCameraChanged(){if(this.viewer.impl.is2d)return;if(this.blockEvents)return;const e=this.viewer.toolController.getTool("orbit");if(null!=e&&e.isDragging)return;if(this.viewer.impl.camera.position.lengthSq()<this.maxDistSq)return;this.blockEvents=!0;const t=this.viewer.impl.camera.getGlobalPosition();this.resetGlobalOffset(t),this.blockEvents=!1}resetGlobalOffset(e){this.viewer.getVisibleModels().forEach((t=>{t.setGlobalOffset(e),this.viewer.impl.onModelTransformChanged(t)})),this.viewer.impl.camera.setGlobalOffset(e),this.viewer.impl.syncCamera(),this.viewer.autocam&&this.viewer.autocam.onGlobalOffsetChanged(e),this.viewer.autocam.sync(this.viewer.impl.camera)}}},68482:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EventDispatcher:()=>r});let r=function(){};r.prototype={constructor:r,apply:function(e){e.addEventListener=r.prototype.addEventListener,e.hasEventListener=r.prototype.hasEventListener,e.removeEventListener=r.prototype.removeEventListener,e.clearListeners=r.prototype.clearListeners,e.fireEvent=r.prototype.fireEvent,e.dispatchEvent=r.prototype.fireEvent,e.debugEvents=r.prototype.debugEvents},addEventListener:function(e,t,i){if(e){void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[e]&&(this.listeners[e]=[]);for(var r=i&&i.priority||0,n=this.listeners[e].length,o=this.listeners[e].length-1;o>=0&&r>this.listeners[e][o].priority;o--)n--;this.listeners[e].splice(n,0,{callbackFn:t,once:!!i&&!!i.once,priority:r})}},hasEventListener:function(e,t){if(!e)return!1;if(void 0===this.listeners)return!1;var i=this.listeners[e];if(!i||0===i.length)return!1;for(var r=0,n=i.length;r<n;++r)if(i[r].callbackFn===t)return!0;return!1},removeEventListener:function(e,t){if(e)if(void 0!==this.listeners){var i=this.listeners[e];if(i)for(var r=0,n=i.length;r<n;++r)if(i[r].callbackFn===t){i.splice(r,1);break}}else this.listeners={}},clearListeners:function(){this.listeners=void 0},dispatchEvent:function(e){if(void 0!==this.listeners){if("string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(e){}if(!e.type)throw new Error("event type unknown.");if(this._doDebug&&console.log("Event: "+e.type),Array.isArray(this.listeners[e.type])){for(var t=this.listeners[e.type].slice(),i=[],r=0,n=t.length;r<n;++r)t[r].callbackFn.call(this,e),t[r].once&&i.push(t[r].callbackFn);for(var o=0;o<i.length;++o)this.removeEventListener(e.type,i[o])}}else this.listeners={}},debugEvents:function(e){this._doDebug=e}},r.prototype.fireEvent=r.prototype.dispatchEvent,"undefined"!=typeof Autodesk&&(Autodesk.Viewing.EventDispatcher=r)},18878:e=>{"use strict";var t=e.exports;t.ESCAPE_EVENT="escape",t.PROGRESS_UPDATE_EVENT="progress",t.FULLSCREEN_MODE_EVENT="fullScreenMode",t.NAVIGATION_MODE_CHANGED_EVENT="navmode",t.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",t.VIEWER_RESIZE_EVENT="viewerResize",t.VIEWER_INITIALIZED="viewerInitialized",t.VIEWER_UNINITIALIZED="viewerUninitialized",t.LOADER_LOAD_FILE_EVENT="loaderLoadFile",t.LOADER_LOAD_ERROR_EVENT="loaderLoadError",t.LOADER_REPAINT_REQUEST_EVENT="loaderRepaint",t.MODEL_ROOT_LOADED_EVENT="svfLoaded",t.GEOMETRY_LOADED_EVENT="geometryLoaded",t.TEXTURES_LOADED_EVENT="texturesLoaded",t.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",t.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",t.OBJECT_TREE_LOAD_PROGRESS_EVENT="propertyDbLoadProgress",t.MODEL_UNLOADED_EVENT="modelUnloaded",t.BEFORE_MODEL_UNLOAD_EVENT="beforeModelUnload",t.MODEL_ADDED_EVENT="modelAdded",t.MODEL_REMOVED_EVENT="modelRemoved",t.MODEL_LAYERS_LOADED_EVENT="modelLayersLoaded",t.MODEL_TRANSFORM_CHANGED_EVENT="modelTransformChanged",t.MODEL_PLACEMENT_CHANGED_EVENT="placementTransformChanged",t.MODEL_VIEWPORT_BOUNDS_CHANGED_EVENT="viewportBoundsChanged",t.MODEL_FRAGMENT_BOUNDING_BOXES_SET_EVENT="fragmentBoundingBoxesSet",t.EXTENSION_PRE_LOADED_EVENT="extensionPreLoaded",t.EXTENSION_LOADED_EVENT="extensionLoaded",t.EXTENSION_PRE_UNLOADED_EVENT="extensionPreUnloaded",t.EXTENSION_UNLOADED_EVENT="extensionUnloaded",t.EXTENSION_PRE_ACTIVATED_EVENT="extensionPreActivated",t.EXTENSION_ACTIVATED_EVENT="extensionActivated",t.EXTENSION_PRE_DEACTIVATED_EVENT="extensionPreDeactivated",t.EXTENSION_DEACTIVATED_EVENT="extensionDeactivated",t.SELECTION_CHANGED_EVENT="selection",t.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",t.ISOLATE_EVENT="isolate",t.AGGREGATE_ISOLATION_CHANGED_EVENT="aggregateIsolation",t.HIDE_EVENT="hide",t.AGGREGATE_HIDDEN_CHANGED_EVENT="aggregateHidden",t.SHOW_EVENT="show",t.SHOW_PROPERTIES_EVENT="showProperties",t.SHOW_ALL_EVENT="showAll",t.HIDE_ALL_EVENT="hideAll",t.CAMERA_CHANGE_EVENT="cameraChanged",t.EXPLODE_CHANGE_EVENT="explodeChanged",t.FIT_TO_VIEW_EVENT="fitToView",t.AGGREGATE_FIT_TO_VIEW_EVENT="aggregateFitToView",t.CUTPLANES_CHANGE_EVENT="cutplanesChanged",t.TOOL_CHANGE_EVENT="toolChanged",t.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",t.FINAL_FRAME_RENDERED_CHANGED_EVENT="finalFrameRenderedChanged",t.RENDER_PRESENTED_EVENT="renderPresented",t.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",t.PREF_CHANGED_EVENT="PrefChanged",t.PREF_RESET_EVENT="PrefReset",t.RESTORE_DEFAULT_SETTINGS_EVENT="restoreDefaultSettings",t.ANIMATION_READY_EVENT="animationReady",t.CAMERA_TRANSITION_COMPLETED="cameraTransitionCompleted",t.HYPERLINK_EVENT="hyperlink",t.HYPERLINK_NAVIGATE="hyperlink_navigate",t.LOAD_GEOMETRY_EVENT="load_geometry",t.LOAD_MISSING_GEOMETRY="loadMissingGeometry",t.WEBGL_CONTEXT_LOST_EVENT="webglcontextlost",t.WEBGL_CONTEXT_RESTORED_EVENT="webglcontextrestored",t.CANCEL_LEAFLET_SCREENSHOT="cancelLeafletScreenshot",t.SET_VIEW_EVENT="setView",t.RENDER_FIRST_PIXEL="renderFirstPixel",t.PROFILE_CHANGE_EVENT="profileChanged",t.RENDER_SCENE_PART="renderScenePart",t.OBJECT_UNDER_MOUSE_CHANGED="hoverObjectChanged",t.ANIM_ENDED="animEnded",t.TRANSITION_STARTED="transitionStarted",t.TRANSITION_ENDED="transitionEnded",t.FRAGMENTS_LOADED_EVENT="fragmentsLoaded",t.FRAGMENTS_UNLOADED_EVENT="fragmentsUnloaded",t.SCENE_UPDATED_EVENT="sceneUpdated",t.REFRESH_CUSTOM_PROPERTIES="refreshCustomProperties",t.REFRESH_CUSTOM_PROPERTIES_VALUES="refreshCustomPropertiesValues"},22753:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EventUtils:()=>s});var r=i(7247);let n=!1,o=!1;class s{static isRightClick(e){if(!(e instanceof a(e).MouseEvent))return!1;let t=e.button;"buttons"in e&&(!o||1&e.buttons?2===t&&1&e.buttons&&(t=0,o=!0):(o=!1,t=0));return t===(n?0:2)}static isMiddleClick(e){return e instanceof a(e).MouseEvent&&1===e.button}static setUseLeftHandedInput(e){n=e}static async waitUntilTransitionEnded(e){if(e.navigation.getRequestTransition()||e.navigation.getTransitionActive())return new Promise((t=>{setTimeout((()=>{e.navigation.getRequestTransition()||e.navigation.getTransitionActive()?e.addEventListener(Autodesk.Viewing.CAMERA_TRANSITION_COMPLETED,t,{once:!0}):t()}))}))}static async waitUntilGeometryLoaded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.model;if(!t||!t.isLoadDone())return new Promise((i=>{const r=n=>{t&&t!==n.model||(i(),e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,r))};e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,r)}))}static async waitUntilModelAdded(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.model;if(!t)return new Promise((i=>{const r=n=>{t&&t!==n.model||(i(),e.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,r))};e.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,r)}))}}function a(e){const t=e.target&&e.target.ownerDocument;return t?t.defaultView||t.parentWindow:(0,r.getGlobal)()}Autodesk.Viewing.isRightClick=s.isRightClick,Autodesk.Viewing.isMiddleClick=s.isMiddleClick},24073:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Extension:()=>o});var r=i(26725),n=i(76542),o=function(e,t){this.viewer=e,n.GlobalManagerMixin.call(this),this.setGlobalManager(e.globalManager),this.options=t||{},this.id="",this.modes=[],this.mode="",this.name="",this.activeStatus=!1};o.prototype.load=function(){return!0},o.prototype.unload=function(){return!0},o.prototype.activate=function(e){return!0},o.prototype.deactivate=function(){return!0},o.prototype.setActive=function(e,t){e?this.activate(t):this.deactivate()},o.prototype.getName=function(){return this.name},o.prototype.getModes=function(){return this.modes},o.prototype.isActive=function(e){return e?this.activeStatus&&this.mode===e:this.activeStatus},o.prototype.getState=function(e){},o.prototype.restoreState=function(e,t){return!0},o.prototype.extendLocalization=function(e){return(0,r.extendLocalization)(e)},o.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={});var e=this.viewer.extensionCache[this.id];return e||(e=this.viewer.extensionCache[this.id]={}),e},o.prototype.onToolbarCreated=function(e){},"undefined"!=typeof Autodesk&&(Autodesk.Viewing.Extension=o)},44631:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ExtensionMixin:()=>h,theExtensionManager:()=>l});var r=i(60489),n=i(44741),o=i(18878),s=i(32131);const a=Autodesk.Viewing;const l=new class{constructor(){this.registeredExtensions=new Map}registerExtension(e,t){if(this.registeredExtensions.has(e)){const i=this.registeredExtensions.get(e);if(i.EXTENSION_CLASS)return!1;i.EXTENSION_CLASS=t}else this.registeredExtensions.set(e,{EXTENSION_CLASS:t});return!0}getExtensionClass(e){return this.registeredExtensions.has(e)?this.registeredExtensions.get(e).EXTENSION_CLASS:null}unregisterExtension(e){return!!this.registeredExtensions.has(e)&&(this.registeredExtensions.delete(e),!0)}registerExternalExtension(e,t,i){return!this.registeredExtensions.has(e)&&(this.registeredExtensions.set(e,{EXTENSION_CLASS:null,externalPathOrCallback:t,dependencies:i}),!0)}getExternalPath(e){return this.registeredExtensions.has(e)?this.registeredExtensions.get(e).externalPathOrCallback:null}getRegisteredExtensions(){return Array.from(this.registeredExtensions).map((e=>{let[t,i]=e;return{id:t,inMemory:!!i.EXTENSION_CLASS,isAsync:!!i.externalPathOrCallback}}))}downloadExtension(e){if(!this.registeredExtensions.has(e))return Promise.reject("Extension not found: "+e+". Has it been registered(1)?");const t=this.registeredExtensions.get(e);if(!t.externalPathOrCallback)return Promise.reject("Extension not found: "+e+". Has it been registered(2)?");if(t.downloadPromise)return t.downloadPromise;const i=(t.dependencies||[]).map((e=>this.downloadExtension(e))),r=Promise.all(i);return t.downloadPromise=r.then((()=>"string"==typeof t.externalPathOrCallback?n.theResourceLoader.loadScript(t.externalPathOrCallback,e):t.externalPathOrCallback())).then((()=>{if(delete t.downloadPromise,!t.EXTENSION_CLASS)throw new Error("Extension not found: "+e+". Has it been registered(3)?");return t.EXTENSION_CLASS})),t.downloadPromise}popuplateOptions(e){this.registeredExtensions.forEach((t=>{t.EXTENSION_CLASS.populateDefaultOptions(e)}))}isDownloading(e){return!!this.registeredExtensions.has(e)&&!!this.registeredExtensions.get(e).downloadPromise}isAvailable(e){return!!this.getExtensionClass(e)}},h=function(){};h.prototype={loadExtension:function(e,t){return this.loadedExtensions=this.loadedExtensions||{},l.isAvailable(e)?this.loadExtensionLocal(e,t):(this.loadExtensionPromises=this.loadExtensionPromises||{},e in this.loadExtensionPromises||(this.loadExtensionPromises[e]=l.downloadExtension(e).then((()=>{if(delete this.loadExtensionPromises[e],this.loadedExtensions){if(this.cancelledExtensions&&e in this.cancelledExtensions)throw delete this.cancelledExtensions[e],new Error(`Abort loadExtension('${e}') - extension has been unloaded`);return this.loadExtensionLocal(e,t)}r.logger.info(`Abort loadExtension('${e}') - teardown in progress`)}))),this.loadExtensionPromises[e])},getExtension:function(e,t){var i=this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null;return i&&t&&t(i),i},getExtensionAsync:function(e){let t=this.getExtension(e);return t?Promise.resolve(t):new Promise((i=>{this.addEventListener(o.EXTENSION_LOADED_EVENT,(function r(n){n.extensionId===e&&(this.removeEventListener(o.EXTENSION_LOADED_EVENT,r),t=this.getExtension(e),i(t))}))}))},unloadExtension:function(e){if(this.cancelledExtensions=this.cancelledExtensions||{},l.isDownloading(e))return this.cancelledExtensions[e]=!0,!1;let t=!1;const i=this.getExtension(e);return i?(t=i.unload(),r.logger.info("Extension unloaded: "+e),delete this.loadedExtensions[e],s.analytics.track("viewer.extensionManager.extensionUnloaded",{extensionId:e}),this.dispatchEvent({type:o.EXTENSION_UNLOADED_EVENT,extensionId:e})):r.logger.warn("Extension not found: "+e),t},loadExtensionLocal:function(e,t){const i=l.getExtensionClass(e);if(!i)return Promise.reject("Extension not found : "+e);let n=this.getExtension(e);if(n)return Promise.resolve(n);if(this.loadingExtensions&&e in this.loadingExtensions)return this.loadingExtensions[e];n=function(e){function t(t,i,r){const n=e[t];n?e[t]=function(){i&&i.call(e,...arguments);const t=n.call(e,...arguments);return r&&r.call(e,...arguments),t}:console.warn(t," not implemented in ",e)}return t("load",(function(){this.viewer.dispatchEvent({type:a.EXTENSION_PRE_LOADED_EVENT,extensionId:this.id})})),t("unload",(function(){this.viewer.dispatchEvent({type:a.EXTENSION_PRE_UNLOADED_EVENT,extensionId:this.id})})),t("activate",(function(e){this.viewer.dispatchEvent({type:a.EXTENSION_PRE_ACTIVATED_EVENT,extensionId:this.id,mode:e})}),(function(e){this.viewer.dispatchEvent({type:a.EXTENSION_ACTIVATED_EVENT,extensionId:this.id,mode:e}),s.analytics.track("viewer.extension.activate",{extensionId:this.id,mode:e})})),t("deactivate",(function(){this.viewer.dispatchEvent({type:a.EXTENSION_PRE_DEACTIVATED_EVENT,extensionId:this.id})}),(function(){this.viewer.dispatchEvent({type:a.EXTENSION_DEACTIVATED_EVENT,extensionId:this.id}),s.analytics.track("viewer.extension.deactivate",{extensionId:this.id})})),e}(new i(this,t)),n.id=e;const h=()=>Promise.reject("Extension failed to .load() : "+e),c=n.load();if(!c)return h();const u=()=>(this.loadedExtensions[e]=n,this.onPostExtensionLoad(n),r.logger.info("Extension loaded: "+e),s.analytics.track("viewer.extensionManager.extensionLoaded",{extensionId:e}),setImmediate((()=>{this.getExtension(e)&&this.dispatchEvent({type:o.EXTENSION_LOADED_EVENT,extensionId:e})})),Promise.resolve(n));return"function"==typeof c.then?(this.loadingExtensions=this.loadingExtensions||{},this.loadingExtensions[e]=c.then((e=>e?u():h())).finally((()=>{delete this.loadingExtensions[e]})),this.loadingExtensions[e]):u()},onPostExtensionLoad:function(e){},forEachExtension:function(e){const t=this.loadedExtensions||{};for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(t[i])},apply:function(e){var t=h.prototype;e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.getExtensionAsync=t.getExtensionAsync,e.unloadExtension=t.unloadExtension,e.loadExtensionLocal=t.loadExtensionLocal,e.forEachExtension=t.forEachExtension,e.onPostExtensionLoad=t.onPostExtensionLoad}}},31212:(e,t,i)=>{"use strict";function r(e){this.viewer=e}i.r(t),i.d(t,{FileLoader:()=>r}),r.prototype.constructor=r,r.prototype.loadFile=function(e,t,i,r){return!1},r.prototype.is3d=function(){return!1}},6972:(e,t,i)=>{"use strict";i.r(t),i.d(t,{FileLoaderManager:()=>n});const r={};let n={registerFileLoader:function(e,t,i,n){return r[e]?r[e].loader===i&&(r[e].count++,!0):(r[e]={loader:i,extensions:t,mimeType:n,count:1},!0)},getFileLoader:function(e){return r[e]?r[e].loader:null},getFileLoaderForExtension:function(e,t){e=e?e.toLowerCase():"";const i=new Array;for(const t in r){const n=r[t];if(n)for(let t=0;t<n.extensions.length;t++)n.extensions[t].toLowerCase()===e&&i.push(n.loader)}if(0===i.length)return null;if(t&&i.length>1)for(let e of i)if(e.acceptsMimeType&&e.acceptsMimeType(t))return e;return i[0]},unregisterFileLoader:function(e){return!!r[e]&&(r[e].count--,0===r[e].count&&delete r[e],!0)}}},87312:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalManager:()=>n});const r=Autodesk.Viewing;class n{constructor(){this._window={inner:null,registeredEventListeners:new Map},this._document={inner:null,registeredEventListeners:new Map},this._window.inner=r.getGlobal(),this._document.inner=this._window.inner.document,this.addWindowEventListener=s.bind(this._window),this.removeWindowEventListener=a.bind(this._window),this.addDocumentEventListener=s.bind(this._document),this.removeDocumentEventListener=a.bind(this._document)}getWindow(){return this._window.inner}getDocument(){return this._document.inner}setWindow(e){if(e&&e!==this._window.inner){for(let[t,i]of this._window.registeredEventListeners.entries())for(let[r,n]of i.entries())e.addEventListener(t,r,...n),this._window.inner.removeEventListener(t,r,...n);for(let[t,i]of this._document.registeredEventListeners.entries())for(let[r,n]of i.entries())e.document.addEventListener(t,r,...n),this._document.inner.removeEventListener(t,r,...n);this._window.inner=e,this._document.inner=e.document}}}function o(e){return!!e.opener}function s(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];o(this.inner)||(this.registeredEventListeners.has(e)?this.registeredEventListeners.get(e).set(t,r):this.registeredEventListeners.set(e,new Map([[t,r]]))),this.inner.addEventListener(e,t,...r)}function a(e,t){o(this.inner)||this.registeredEventListeners.has(e)&&this.registeredEventListeners.get(e).has(t)&&this.registeredEventListeners.get(e).delete(t);for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];this.inner.removeEventListener(e,t,...r)}},76542:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalManagerMixin:()=>o});var r=i(87312);const n=new r.GlobalManager;function o(){this.globalManager=n,this.setGlobalManager=function(e){this.globalManager=e,this.onSetGlobalManager(this.globalManager)},this.onSetGlobalManager=function(e){},this.getWindow=function(){return this.globalManager.getWindow()},this.getDocument=function(){return this.globalManager.getDocument()},this.setWindow=function(e){return this.globalManager.setWindow(e)},this.addWindowEventListener=function(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];this.globalManager.addWindowEventListener(e,t,...r)},this.removeWindowEventListener=function(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];this.globalManager.removeWindowEventListener(e,t,...r)},this.addDocumentEventListener=function(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];this.globalManager.addDocumentEventListener(e,t,...r)},this.removeDocumentEventListener=function(e,t){for(var i=arguments.length,r=new Array(i>2?i-2:0),n=2;n<i;n++)r[n-2]=arguments[n];this.globalManager.removeDocumentEventListener(e,t,...r)}}Autodesk.Viewing.GlobalManager=r.GlobalManager,Autodesk.Viewing.GlobalManagerMixin=o},52156:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BackgroundPresets:()=>a,DefaultLightPreset:()=>n,DefaultLightPreset2d:()=>o,DefaultToneMapMethod:()=>s,LightPresets:()=>h,copyLightPreset:()=>u});var r=i(7247);let n=1,o=0,s=1,a={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Field:[202,226,252,202,201,190],Boardwalk:[216,230,248,230,228,220],Custom:[230,230,230,150,150,150]};var l=a;let h=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:l["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:s,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:l["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:s,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:l["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:s,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:l["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:s,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:l["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:s,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:l.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:s,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:l["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:l.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:s,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:s,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:s,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:l["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:s,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:l["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:s,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:l["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:s,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:l["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:s,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:l["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:s,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:l.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:s,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:l.Snow,darkerFade:!1,rotation:0},{name:"Field",path:"field",type:"logluv",tonemap:s,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l.Field,useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:s,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l.Boardwalk,useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Flat Shading",path:null,tonemap:0,E_bias:0,directLightColor:[0,0,0],ambientColor:[0,0,0],lightMultiplier:0,bgColorGradient:l["Fusion Grey"],darkerFade:!1,rotation:0}],c=[{name:"Harbor",path:"Harbor",type:"logluv",tonemap:s,E_bias:1.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l["Sky Blue"],useIrradianceAsBackground:!0,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"Night",path:"Night",type:"logluv",tonemap:1,E_bias:4,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0},{name:"Parking",path:"Parking",type:"logluv",tonemap:s,E_bias:2.8,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l["Sky Blue"],useIrradianceAsBackground:!1,saoIntensity:.5,darkerFade:!1,rotation:0},{name:"River Road",path:"RiverRoad",type:"logluv",tonemap:s,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l["Fusion Grey"],useIrradianceAsBackground:!1,saoIntensity:.7,darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:s,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:s,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:s,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l.Midnight,darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:l["RaaS SBS"],darkerFade:!1,rotation:0},{name:"City Night",path:"CityNight",type:"logluv",tonemap:s,E_bias:1.6,directLightColor:[1,1,1],lightMultiplier:.2,bgColorGradient:l.Midnight,useIrradianceAsBackground:!1,darkerFade:!1,rotation:0}];function u(e,t){Object.assign(t,e),t.name=e.name+" (copy)"}(0,r.getGlobal)().ENABLE_DEBUG&&Array.prototype.push.apply(h,c)},40213:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LocalStorage:()=>a});var r,n=i(60489),o=(0,i(7247).getGlobal)();function s(){this.isSupported()||(this._data={})}s.prototype.getItem=function(e){return this.isSupported()?o.localStorage.getItem(e):Object.prototype.hasOwnProperty.call(this._data,e)?this._data[e]:null},s.prototype.setItem=function(e,t){if(this.isSupported())try{o.localStorage.setItem(e,t)}catch(e){n.logger.debug("avp.LocalStorage: Failed to setItem()")}else this._data[e]=String(t)},s.prototype.removeItem=function(e){this.isSupported()?o.localStorage.removeItem(e):delete this._data[e]},s.prototype.clear=function(){this.isSupported()?o.localStorage.clear():this._data={}},s.prototype.isSupported=function(){return void 0===r&&(r=(()=>{if("undefined"==typeof window)return!1;try{const e="lmv_viewer_test_localStorage",t=o.localStorage;return!!t&&(t.setItem(e,"1"),t.removeItem(e),!0)}catch(e){return!1}})()),r},s.prototype.getAllKeys=function(){return r?Object.keys(o.localStorage):Object.keys(this._data)};const a=new s},45894:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Model:()=>v});var r=i(68482),n=i(68110),o=i(7247),s=i(194),a=i(33303),l=i(32576),h=i(28109),c=i(52713),u=i(81467),d=i(82977),p=i(53032);const f=p.lW.from&&p.lW.alloc&&p.lW.allocUnsafe&&p.lW.allocUnsafeSlow?p.lW.from:e=>new p.lW(e);let m=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(m=new Int32Array(m));const g=function(e,t){const i=(e,i)=>t(e,i)>>>0;return i.signed=t,i.unsigned=i,i.model=e,i}("crc-32",(function(e,t){p.lW.isBuffer(e)||(e=f(e));let i=0===t?0:-1^~~t;for(let t=0;t<e.length;t++){const r=e[t];i=m[255&(i^r)]^i>>>8}return-1^i}));class v extends l.RenderModel{myData;topology=null;topologyPromise=null;svfUUID=null;defaultCameraHash=null;loader=void 0;constructor(e){super(e),this.myData=e,r.EventDispatcher.prototype.apply(this);const t={};t.isSVF2=this.isSVF2(),t.isOTG=this.isOTG(),t.is2d=this.is2d(),super.setModelFormat(t)}initialize(){super.initialize();const e=new h.ModelIteratorLinear(this);this.addTraversalController("Linear",e)}getInstanceTree(){return this.myData?this.myData.instanceTree:null}getFuzzyBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=Boolean(e.ignoreTransforms),i=this.getFragmentList();if(!i||this.is2d())return this.getBoundingBox(t);var r=null;if(t){var n=new Array(6);const e=this.getData().placementWithOffset,t=e?e.clone().invert():void 0;r=function(e,r){i.getOriginalWorldBounds(e,n),r.min.fromArray(n),r.max.fromArray(n,3),t&&r.applyMatrix4(t)}}else r=function(e,t){i.getWorldBounds(e,t)};var o=e.center||function(){var t=new THREE.Box3,n=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,a=0;function l(i){if(!e.allowlist||e.allowlist.includes(i)){r(i,t),t.getCenter(n);var l=t.getSize(o).length();s.add(n.multiplyScalar(l)),a+=l}}for(var h=0;h<i.getCount();h++)l(h);return s.multiplyScalar(1/a),s}(),s=e.quantil||.75,a=new THREE.Box3,l=[];const h=new THREE.Vector3;for(let t=0;t<i.getCount();t++)if((!e.allowlist||e.allowlist.includes(t))&&(r(t,a),!a.isEmpty())){var c=a.distanceToPoint(o);0===c&&(c=o.distanceTo(a.getCenter(h))),l.push({fragId:t,distance:c})}l.sort((function(e,t){return e.distance-t.distance}));var u=new THREE.Box3;for(let e=0;e<l.length*s;e++){var d=l[e];r(d.fragId,a),u.union(a)}return u}getBoundingBox(e,t){return super.updateModelBBoxOriginal(this.getData().modelSpaceBBox),super.getModelBounds(e,t)}is2d(){return!(!this.myData||!this.myData.is2d)}is3d(){return!this.is2d()}isOTG(){return this.myData&&!!this.myData.isOTG}isSVF2(){const e=this.getDocumentNode();return!!e&&e.isSVF2()}isPdf(e){return!(!this.myData||!this.myData.isPdf||e&&this.isSmartPdf())}isRevitPdf(){var e;return!(null===(e=this.getDocumentNode())||void 0===e||!e.isRevitPdf())}isSmartPdf(){var e;return!(null===(e=this.getDocumentNode())||void 0===e||!e.isSmartPdf())}isLeaflet(){return!(!this.myData||!this.myData.isLeaflet)}isPageCoordinates(){var e;return this.is2d()&&(!this.isLeaflet()||(null===(e=this.loader)||void 0===e?void 0:e.isPageCoordinates()))}isSceneBuilder(){return!(!this.myData||!this.myData.isSceneBuilder)}getData(){return this.myData}setUUID(e){this.svfUUID=btoa(encodeURI((0,n.pathToURL)(e)))}getDocumentNode(){var e;return(null===(e=this.getData())||void 0===e||null===(e=e.loadOptions)||void 0===e?void 0:e.bubbleNode)??null}getRoot(){var e=this.getData();return e&&e.instanceTree?e.instanceTree.root:null}getRootId(){var e=this.getData();return e&&e.instanceTree&&e.instanceTree.getRootId()||0}getUnitData(e){return console.warn("Model.getUnitData is deprecated and will be removed in a future release, use Autodesk.Viewing.Private.getUnitData() instead."),(0,u.getUnitData)(e)}getUnitScale(){return(0,u.convertUnits)(this.getUnitString(),u.ModelUnits.METER,1,1)}getUnitString(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.overriddenUnits?t.overriddenUnits:t&&t.scalingUnit?t.scalingUnit:this.getMetadata("distance unit","value",null)}return(0,u.fixUnitString)(e)}getDisplayUnit(){var e;if(this.is2d())e=this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null);else{var t=this.getData();e=t&&t.scalingUnit?t.scalingUnit:this.getMetadata("default display unit","value",null)||this.getMetadata("distance unit","value",null)}return(0,u.fixUnitString)(e)}getSourceFileUnits(){const e=this.getDocumentNode();return null==e?void 0:e.getSourceFileUnits()}getMetadata(e,t,i){var r=this.getData();if(r){var n=r.metadata;if(n){var o=n[e];if(void 0!==o){if(!t)return o;var s=o[t];if(void 0!==s)return s}}}return i}getDefaultCamera(){var e=this.getData();if(!e)return null;var t=null,i=e.cameras?e.cameras.length:0;if(0<i){var r=this.getMetadata("default camera","index",null);if(null!==r&&e.cameras[r])t=e.cameras[r];else{for(var n=0;n<i;n++){var o=e.cameras[n];if(o.isPerspective){t=o;break}}t||(t=e.cameras[0])}}var s=this.getModelTransform();if(t&&s){const e=c.UnifiedCamera.copyViewParams(t);return c.UnifiedCamera.transformViewParams(e,s),c.UnifiedCamera.adjustOrthoCamera(e,this.getBoundingBox()),e}return t}isAEC(){return!!this.getData().loadOptions.isAEC}hasPageShadow(){return this.getData().hasPageShadow}getUpVector(){return this.getMetadata("world up vector","XYZ",null)}getNorthVector(){return this.getMetadata("world north vector","XYZ",null)}getFrontVector(){return this.getMetadata("world front vector","XYZ",null)}geomPolyCount(){var e=this.getGeometryList();return e?e.geomPolyCount:null}instancePolyCount(){var e=this.getGeometryList();return e?e.instancePolyCount:null}isLoadDone(e){const t=this.getData(),i=!e||!1!==t.texLoadDone;return!!(t&&t.loadDone&&i)}isObjectTreeCreated(){return!!this.getData().instanceTree}getPropertyDb(){const e=this.getData();return e&&e.propDbLoader}async getPropertyHashes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;function i(e,t,i,r){const n=(e+t+i+(r??"")).toUpperCase();return`p${g(n).toString(16).padStart(8,"0")}`}const r=this.getPropertyDb();if(void 0===r||!0!==r.isLoadDone())return;let n=await r.executeUserFunction("function userFunction(pdb) {\n                const properties = new Set();\n                pdb.enumAttributes((i, attribute, raw) => {\n                properties.add([ attribute.name, attribute.category, attribute.dataType, attribute.dataTypeContext ]);\n            });\n            return Array.from(properties); }");void 0!==e&&e instanceof RegExp&&(n=n.filter((t=>e.test(t[0])))),void 0!==t&&t instanceof RegExp&&(n=n.filter((e=>t.test(e[1]))));for(const e of n){const t=i(e[0],e[1],e[2],e[3]);e.unshift(t),e.pop(),e.pop()}return n}getProperties(e,t,i){var r=this.getPropertyDb();!r||e<=0?i&&i():r.getProperties(e,t,i)}getProperties2(e,t,i,r){var n=this.getPropertyDb();!n||e<=0?i&&i():n.getProperties2(e,t,i,r)}getBulkProperties(e,t,i,r){Array.isArray(t)&&(t={propFilter:t});var n=(t=t||{}).propFilter||null,o=t.ignoreHidden||!1,s=this.getPropertyDb();s?s.getBulkProperties(e,n,i,r,o):r&&r()}getBulkProperties2(e,t,i,r){var n=this.getPropertyDb();n?n.getBulkProperties2(e,t,i,r):r&&r()}getPropertySetAsync(e,t){return new Promise(((i,r)=>{this.getPropertySet(e,i,r,t)}))}getPropertySet(e,t,i,r){var n=this.getPropertyDb();n||i&&i("Properties failed to load."),n.getPropertySet(e,r,(e=>{t(new d.PropertySet(e))}),i)}getExternalIdMapping(e,t){var i=this.getPropertyDb();i?i.getExternalIdMapping(e,t):t&&t()}getLayerToNodeIdMapping(e,t){var i=this.getPropertyDb();i?i.getLayerToNodeIdMapping(e,t):t&&t()}getObjectTree(e,t){const i=this.getData().instanceTree;if(i)e(i);else{var r=this.getPropertyDb();r?r.getObjectTree(e,t):t&&t()}}isObjectTreeLoaded(){var e=this.getPropertyDb();return!!e&&e.isObjectTreeLoaded()}search(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{searchHidden:!1};var o=this.getPropertyDb();o?o.searchProperties(e,r,t,i,n):i&&i()}findProperty(e){var t=this.getPropertyDb();return t?t.findProperty(e):Promise.reject("Model doesn't have any properties.")}static#e(e){var t=.001,i=e;if(Math.abs(i[0])<t)if(Math.abs(i[4])>t)for(var r=0;r<4;r++){var n=i[r];i[r]=i[r+4],i[r+4]=n}else for(let e=0;e<4;e++){const t=i[e];i[e]=i[e+8],i[e+8]=t}if(Math.abs(i[5])<t)for(let e=4;e<8;e++){const t=i[e];i[e]=i[e+4],i[e+4]=t}}static#t(e,t,i,r){var n,o,s,a,l,h,c=!1;s=r[i[i.length-1]].x,n=(a=r[i[i.length-1]].y)>=t;for(var u=0,d=i.length;u<d;++u)l=r[i[u]].x,n!=(o=(h=r[i[u]].y)>=t)&&(h-t)*(s-l)>=(l-e)*(a-h)==o&&(c=!c),n=o,s=l,a=h;return c}static#i(e,t,i,r){for(var n=!1,o=0;o<i.length;o++)v.#t(e,t,i[o],r)&&(n=!n);return n}getPageToModelTransform(e){var t,i=this.getData();if(i.pageToModelTransform)return i.pageToModelTransform;var r=i,n=r.metadata.page_dimensions,o=r.viewports&&r.viewports[e];if(!o)return new THREE.Matrix4;r.viewportTransforms||(r.viewportTransforms=new Array(r.viewports.length));var a=r.viewportTransforms[e];if(a)return a;var l=new s.LmvMatrix4(!0).set(n.logical_width/n.page_width,0,0,n.logical_offset_x,0,n.logical_height/n.page_height,0,n.logical_offset_y,0,0,1,0,0,0,0,1),h=(null===(t=o.transform)||void 0===t?void 0:t.slice())||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];v.#e(h);var c=new s.LmvMatrix4(!0);c.elements.set(h);var u=new s.LmvMatrix4(!0);return u.copy(c).invert(),u.multiply(l),r.viewportTransforms[e]=u,u}pageToModel(e,t,i,r){let n=this.getPageToModelTransform(i);function o(e){if(e){var t=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(n);e.x=t.x,e.y=t.y,e.z=t.z}}r&&(n=n.clone().invert()),o(e),o(t)}pointInClip(e,t){for(var i=this.getData().clips,r=[],n=1;n<i.length;n++)if(n!==t){for(var o=[],s=[],a=i[n].contourCounts,l=i[n].points,h=0,c=[],u=0;u<a.length;u++){for(var d=0;d<a[u];d++)o.push(h),h++;s.push(o),o=[]}for(let e=0;e<l.length;e+=2){var p={x:l[e],y:l[e+1]};c.push(p)}v.#i(e.x,e.y,s,c)&&r.push(n)}return r}getClip(e){for(var t=this.getData().clips,i=[],r=[],n=t[e].contourCounts,o=t[e].points,s=0,a=[],l=0;l<n.length;l++){for(var h=0;h<n[l];h++)i.push(s),s++;r.push(i),i=[]}for(let e=0;e<o.length;e+=2){var c={x:o[e],y:o[e+1]};a.push(c)}return{contours:r,points:a}}getTopoIndex(e){var t=this.getData();if(t&&t.fragments){var i=t.fragments.topoIndexes;if(i)return i[e]}}getTopology(e){return this.topology?this.topology[e]:null}hasTopology(){return!!this.topology}fetchTopology(e){if(this.topology)return Promise.resolve(this.topology);var t=this.getData();if(!t.topologyPath)return Promise.reject({error:"no-topology"});var i=e||((0,o.isMobileDevice)()?20:100);if(t.topologySizeMB>i)return Promise.reject({error:"topology-too-big",limitMB:i,topologyMB:t.topologySizeMB});if(!this.topologyPromise){var r=this;this.topologyPromise=new Promise((function(e,t){r.loader.fetchTopologyFile(r.getData().topologyPath,(function(i){i&&i.topology?(r.topology=i.topology,e(i.topology)):t(i)}))}))}return this.topologyPromise}hasGeometry(){var e=this.getData();return!!e&&(!!e.isLeaflet||(!!e.isSceneBuilder||e.fragments.length>0))}getFragmentPointer(e){return e?new a.FragmentPointer(this.getFragmentList(),e):null}clone(){const e=new v(this.myData);return e.topology=this.topology,e.topologyPromise=this.topologyPromise,e.svfUUID=this.svfUUID,e.defaultCameraHash=this.defaultCameraHash,e.loader=this.loader,e.setInnerAttributes(this.getInnerAttributes()),e}getSeedUrn(){var e;return(null===(e=this.loader)||void 0===e?void 0:e.svfUrn)||""}isNodeExists(e){let t;const i=this.getInstanceTree();if(i)i.enumNodeChildren(e,(function(e){i.enumNodeFragments(e,(function(){t=!0}))}),!0);else{var r;null!==(r=this.getFragmentList().fragments.dbId2fragId)&&void 0!==r&&r[e]&&(t=!0)}return!!t}getModelKey(){const e=this.getDocumentNode();return e?e.getModelKey():this.getData().urn}dtor(){super.dtor(),this.#r()}#r(){const e=this.getInstanceTree();null==e||e.dtor(),this.myData=null,this.topology=null,this.topologyPromise=null}setFragmentBoundingBoxes(e,t){const i=this.getFragmentList().fragments,r=i.boxes,n=e.length/t;for(let i=0,o=0,s=0;i<n;i++,o+=t,s+=6)r[s+0]=e[o+0],r[s+1]=e[o+1],r[s+2]=e[o+2],r[s+3]=e[o+3],r[s+4]=e[o+4],r[s+5]=e[o+5];i.boxesLoaded=!0,this.visibleBoundsDirty=!0,this.fireEvent({type:Autodesk.Viewing.MODEL_FRAGMENT_BOUNDING_BOXES_SET_EVENT,model:this})}}},70178:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelLayers:()=>s});var r=i(60489),n=i(18878),o={name:"root",id:"root",isLayer:!1,children:[],childCount:0};function s(e){this.viewer=e,this.matman=e.matman(),this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[]}var a=s.prototype;function l(e,t){var i=e.model,r=e.indexToLayer;if(i.is2d()){if(!i.getData().layerCount)return;var n=[];for(var o in e.layerToIndex)n.push(e.layerToIndex[o]);e.matman.setLayerVisible(n,t,i.id),e.viewer.invalidate(!0)}else{var s=[],a=t?e.viewer.visibilityManager.show:e.viewer.visibilityManager.hide;h(e,(function(e,n){r[n].visible!==t&&(s.push(e),1024===s.length&&(a(s,i),s.length=0))})),s.length>0&&a(s,i)}for(var l=r.length,c=1;c<l;++c){var u=r[c];u&&(u.visible=t)}}function h(e,t){var i=e.nodeToLayer;if(i&&i.length){var r=e.model.getData().instanceTree.nodeAccess;for(var n in r.dbIdToIndex){var o=i[r.dbIdToIndex[n]]||0;0!==o&&t(0|n,o)}}}function c(e,t){return"number"==typeof t?t:e.layerToIndex[t.name||t]||0}function u(e){return!e.layer.isLayer}function d(e,t){for(var i=0;i<e.length;++i){var r=e[i];t(r),r.children&&d(r.children,t)}}a.addModel=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.initialized&&(e.is2d()||!t)){var i=function(t){if(t){var i=this.model.getData().instanceTree;t.children=t.children||[];var n=function(e){if(!e)return[];var t=[],i=0;d(e,(e=>{t.push(e),e.isLayer&&(i=Math.max(i,0|e.index))}));for(var r=0;r<t.length;++r)t[r].isLayer||(t[r].index=++i);return t}(t.children);t.childCount=n.length,this.indexToLayer=new Array(t.childCount+1),this.indexToLayer[0]=null;for(var o=0;o<t.childCount;++o){var s=n[o],a=null==s.visible||s.visible;this.layerToIndex[s.name]=s.index,this.indexToLayer[s.index]={layer:s,visible:a}}if(!this.model.is2d()&&0!==t.childCount){this.nodeToLayer=t.childCount<=256?new Uint8Array(i.nodeAccess.getNumNodes()):new Uint16Array(i.nodeAccess.getNumNodes());var l=function(e){if(this.model){var t=this.model.getData().instanceTree;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i))for(var r=this.layerToIndex[i],n=e[i],o=0,s=n.length;o<s;++o){var a=t.nodeAccess.getIndex(n[o]);this.nodeToLayer[a]=r}}}.bind(this),h=function(){r.logger.warn("ModelLayers error: coudn't get layers from property database.")}.bind(this);e.getLayerToNodeIdMapping(l,h)}}}.bind(this),s=function(t){var i;this.root=t,this.initialized=!0;!this.activateLayerState("Initial")&&null!==(i=this.model)&&void 0!==i&&i.is2d()&&this.indexToLayer.forEach((e=>{e&&!e.visible&&this.setLayerVisible(e.layer,!1)})),this.viewer.api.dispatchEvent({type:n.MODEL_LAYERS_LOADED_EVENT,model:e,root:t})}.bind(this);this.model=e,(e.is2d()?function(e){var t=e.getData(),i=o;t&&t.layersRoot&&(i=t.layersRoot);return Promise.resolve(i)}(e):function(e){if(e.getData().loadOptions.skipPropertyDb)return Promise.resolve(null);var t=e.getPropertyDb();if(!t||e.getData().loadOptions.disable3DModelLayers)return Promise.resolve(o);return t.findLayers()}(e)).then((function(e){i(e),s(e)})).catch((function(e){r.logger.warn(e),s(o)}))}},a.removeModel=function(e){this.model===e&&(this.model=null,this.root=null,this.initialized=!1,this.layerToIndex={},this.indexToLayer=[null],this.nodeToLayer=[])},a.getRoot=function(){return this.initialized||r.logger.warn("Autodesk.Viewing.ModelLayers.getRoot couldn't peform action, layers are still being loaded"),this.root},a.showAllLayers=function(){this.initialized?l(this,!0):r.logger.warn("Autodesk.Viewing.ModelLayers.showAllLayers couldn't peform action, layers are still being loaded")},a.hideAllLayers=function(){this.initialized?l(this,!1):r.logger.warn("Autodesk.Viewing.ModelLayers.hideAllLayers couldn't peform action, layers are still being loaded")},a.isLayerVisible=function(e){if(!this.initialized)return r.logger.warn("Autodesk.Viewing.ModelLayers.isLayerVisible couldn't peform action, layers are still being loaded"),!1;let t=c(this,e);const i=this.indexToLayer[t];if(u(i)){const e=i.layer.children;for(var n=0;n<e.length;++n){let t=e[n].index;if(this.indexToLayer[t].visible)return!0}return!1}return i.visible},a.setLayerVisible=function(e,t){if(!this.initialized)return void r.logger.warn("Autodesk.Viewing.ModelLayers.setLayersVisible couldn't peform action, layers are still being loaded");var i=(e=Array.isArray(e)?e:[e]).map(function(e){return c(this,e)}.bind(this));const n=i.length;for(var o=0;o<n;++o){let e=i[o],t=this.indexToLayer[e];if(u(t)){t.layer.children.forEach((e=>{i.push(e.index)}))}}var s=this.model,a=this.indexToLayer;if(s.is2d())this.matman.setLayerVisible(i,t,s.id),this.viewer.invalidate(!0);else{var l=a.map((function(e){return!(null!==e&&-1!==i.indexOf(e.layer.index)&&e.visible!==t)})),d=[],p=t?this.viewer.visibilityManager.show:this.viewer.visibilityManager.hide;h(this,(function(e,t){l[t]||(d.push(e),1024===d.length&&(p(d,s),d.length=0))})),d.length>0&&p(d,s)}var f=i.length;for(let e=0;e<f;++e){const r=this.indexToLayer[i[e]];r&&(r.visible=t)}},a.getVisibleLayerIndices=function(){if(!this.initialized)return r.logger.warn("Autodesk.Viewing.ModelLayers.getVisibleLayerIndices couldn't peform action, layers are still being loaded"),[];for(var e=[],t=this.indexToLayer,i=t.length,n=1;n<i;++n){var o=t[n];o&&o.visible&&!u(o)&&e.push(o.layer.index)}return e},a.allLayersVisible=function(){if(!this.initialized)return!0;for(var e=this.indexToLayer,t=e.length,i=1;i<t;++i){var r=e[i];if(r&&!r.visible)return!1}return!0},a.activateLayerState=function(e){if(!this.initialized)return r.logger.warn("Autodesk.Viewing.ModelLayers.activateLayerState couldn't peform action, layers are still being loaded"),!1;if(!this.model||this.model.is3d()||!e)return!1;var t=this.model.getData().metadata,i=null==t?void 0:t.layer_states;if(!i)return!1;let n;for(n=0;n<i.length&&i[n].name!==e;n++);if(n>=i.length)return!1;var o=i[n].visible_layers,s={};if(o&&0<o.length)for(var a=0;a<o.length;a++)s[o[a]]=1;var l=[],h=[];for(var c in t.layers){var u=t.layers[c].name;c|=0,1===s[u]?l.push(c):h.push(c)}return this.setLayerVisible(l,!0),this.setLayerVisible(h,!1),!0},a.getLayerStates=function(){function e(e,t){var i=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(i.length!==r.length)return!1;for(var n=0;n<i.length;++n){var o=i[n];if(e[o]!==t[o])return!1}return!0}if(!this.initialized)return r.logger.warn("Autodesk.Viewing.ModelLayers.getLayerStates couldn't peform action, layers are still being loaded"),null;var t,i=this.model,n=i?i.getData().metadata:null,o=n?n.layers:null,s=n?n.layer_states:null;if(this.model.is3d()||!o||!s)return null;var a={},l={};for(var h in o)if(Object.prototype.hasOwnProperty.call(o,h)){var c=parseInt(h),u=o[h];a[t="string"==typeof u?u:u.name]=!0,this.isLayerVisible(c)&&(l[t]=!0)}for(var d=[],p=0;p<s.length;++p){var f=s[p],m=f.visible_layers,g={};if(!f.hidden){if(m&&0<m.length)for(var v=0;v<m.length;++v)t=m[v],Object.prototype.hasOwnProperty.call(a,t)&&(g[t]=!0);d.push({name:f.name,description:f.description,active:e(l,g)})}}return 0<d.length?d:null}},5202:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelMemoryTracker:()=>u,estimateMemUsage:()=>c});var r=1048576e3;function n(e){return e&&e.byteLength||0}function o(e){return n(e.boxes)+n(e.transforms)+n(e.fragId2dbId)+n(e.geomDataIndexes)+n(e.materials)}function s(e){return n(e.geomids)+n(e.materialids)+n(e.vizflags)+(e.boxes!==e.fragments.boxes?n(e.boxes):0)+(e.transforms!==e.fragments.transforms?n(e.transforms):0)}function a(e){return n(e.nodes.nodesRaw?e.nodes.nodesRaw:e.nodes)+n(e.primitives)}var l=!1;function h(e){for(var t,i=Autodesk.Viewing.Private,r=0,h=0;h<e.length;h++){var c=e[h],u=c.getData();if(u){var d=c.getConsolidation();if(d&&(r+=d.byteSize),c.isLeaflet())l||(console.warn("Memory tracking not implemented for leaflets."),l=!0);else{if(!u.isOTG)r+=c.getGeometryList().geomMemory;var p=u.fragments;p&&(r+=o(p));var f=c.getFragmentList();f&&(r+=s(f));var m=u.bvh;m&&(r+=a(m));var g=u.instanceTree;g&&(r+=(t=void 0,n((t=g.nodeAccess).children)+n(t.nameSuffixes)+n(t.names)+n(t.nodeBoxes)+n(t.nodes)))}}}return isFinite(r)||i.logger.warn("Memory estimate result was not a number"),r}function c(e){var t=e.impl.geomCache(),i=t?t.byteSize:0,r=e.impl.modelQueue(),n=r.getModels(),o=r.getHiddenModels();return i+h(n)+h(o)}function u(e,t){var i=e,n=0,o=t||r;function s(e){var t;return e.lruTimestamp===n||(null===(t=e.getData())||void 0===t?void 0:t.loadOptions.keepHiddenModel)}this.updateModelTimestamps=function(e){n++;for(var t=0;t<e.length;t++){e[t].lruTimestamp=n}},this.memoryExceeded=function(){return c(i)>=o},this.getMemLimit=function(){return o},this.setMemLimit=function(e){o=e},this.cleanup=function(e){var t=e||i.impl.unloadModel.bind(i.impl);if(this.memoryExceeded()){for(var r=function(){for(var e=i.impl.modelQueue().getHiddenModels(),t=[],r=0;r<e.length;r++){var n=e[r];s(n)||t.push(n)}return t.sort((function(e,t){return e.lurTimestamp-t.lruTimestamp})),t}(),n=0;n<r.length;n++){var o=r[n];if(o.isConsolidated&&(o.unconsolidate(),!this.memoryExceeded()))return}var a=i.impl.geomCache();for(n=0;n<r.length;n++)if(t(o=r[n]),a&&a.cleanup(),!this.memoryExceeded())return}}}},36660:(e,t,i)=>{"use strict";i.r(t),i.d(t,{OverlayManager:()=>r});class r{constructor(e){this.impl=e}dtor(){this.impl=null}addScene(e){return!!e&&(Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,e)||this.impl.createOverlayScene(e),!0)}removeScene(e){return!!e&&(this.impl.removeOverlayScene(e),!0)}clearScene(e){this.impl.clearOverlay(e)}hasScene(e){return!!e&&Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,e)}setSceneHiddenFromMainRender(e,t){this.impl.overlayScenes[e].hiddenFromMainRender=t}addMesh(e,t){return!!(e&&t&&Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,t))&&(e=Array.isArray(e)?e:[e],this.impl.addMultipleOverlays(t,e),!0)}removeMesh(e,t){return!!(e&&t&&Object.prototype.hasOwnProperty.call(this.impl.overlayScenes,t))&&(e=Array.isArray(e)?e:[e],this.impl.removeMultipleOverlays(t,e),!0)}hasMesh(e,t){var i=this.impl.overlayScenes[t];if(!i)return!1;var r=i.scene.children;for(let t=0,i=r.length;t<i;++t)if(r[t]===e)return!0;return!1}}},64141:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Prefs:()=>o,Prefs2D:()=>n,Prefs3D:()=>r,VIEW_TYPES:()=>s});const r={VIEW_CUBE:"viewCube",VIEW_CUBE_COMPASS:"viewCubeCompass",VIEW_TYPE:"viewType",ALWAYS_USE_PIVOT:"alwaysUsePivot",ZOOM_TOWARDS_PIVOT:"zoomTowardsPivot",SELECTION_SETS_PIVOT:"selectionSetsPivot",REVERSE_HORIZONTAL_LOOK_DIRECTION:"reverseHorizontalLookDirection",REVERSE_VERTICAL_LOOK_DIRECTION:"reverseVerticalLookDirection",ORBIT_PAST_WORLD_POLES:"orbitPastWorldPoles",CLICK_TO_SET_COI:"clickToSetCOI",GHOSTING:"ghosting",OPTIMIZE_NAVIGATION:"optimizeNavigation",AMBIENT_SHADOWS:"ambientShadows",ANTIALIASING:"antialiasing",GROUND_SHADOW:"groundShadow",GROUND_REFLECTION:"groundReflection",LINE_RENDERING:"lineRendering",EDGE_RENDERING:"edgeRendering",LIGHT_PRESET:"lightPreset",ENV_MAP_BACKGROUND:"envMapBackground",FIRST_PERSON_TOOL_POPUP:"firstPersonToolPopup",BIM_WALK_TOOL_POPUP:"bimWalkToolPopup",BIM_WALK_NAVIGATOR_TYPE:"bimWalkNavigatorType",BIM_WALK_GRAVITY:"bimWalkGravity",DEFAULT_NAVIGATION_TOOL_3D:"defaultNavigationTool3D",SELECTION_MODE:"selectionMode",ENABLE_CUSTOM_ORBIT_TOOL_CURSOR:"enableCustomOrbitToolCursor",EXPLODE_STRATEGY:"explodeStrategy",FORCE_DOUBLE_SIDED:"forceDoubleSided",DISPLAY_SECTION_HATCHES:"displaySectionHatches"},n={GRAYSCALE:"grayscale",SWAP_BLACK_AND_WHITE:"swapBlackAndWhite",LOADING_ANIMATION:"loadingAnimation",FORCE_PDF_CALIBRATION:"forcePDFCalibration",FORCE_LEAFLET_CALIBRATION:"forceLeafletCalibration",DISABLE_PDF_HIGHLIGHT:"disablePdfHighlight",USE_PDF_VIEWPORT_INFO:"usePdfViewportInfo"},o={PROGRESSIVE_RENDERING:"progressiveRendering",OPEN_PROPERTIES_ON_SELECT:"openPropertiesOnSelect",POINT_RENDERING:"pointRendering",BACKGROUND_COLOR_PRESET:"backgroundColorPreset",REVERSE_MOUSE_ZOOM_DIR:"reverseMouseZoomDir",LEFT_HANDED_MOUSE_SETUP:"leftHandedMouseSetup",FUSION_ORBIT:"fusionOrbit",FUSION_ORBIT_CONSTRAINED:"fusionOrbitConstrained",WHEEL_SETS_PIVOT:"wheelSetsPivot",RESTORE_SESSION_MEASUREMENTS:"restoreMeasurements",DISPLAY_UNITS:"displayUnits",DISPLAY_UNITS_PRECISION:"displayUnitsPrecision",KEY_MAP_CMD:"keyMapCmd",ZOOM_DRAG_SPEED:"zoomDragSpeed",ZOOM_SCROLL_SPEED:"zoomScrollSpeed"},s={DEFAULT:0,ORTHOGRAPHIC:1,PERSPECTIVE:2,PERSPECTIVE_ORTHO_FACES:3}},70718:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Preferences:()=>l});var r=i(18878),n=i(60489),o=i(76542),s=i(44135),a=i(40213);class l{constructor(e,t){this.viewer=e;this.options={},this.storageCache={},this.setGlobalManager(e.globalManager),this.setWebStorageKey("Default"),"string"==typeof t&&(this.options={prefix:t}),this.options={...t},this.options.prefix||(this.options.prefix="Autodesk.Viewing.Preferences."),Object.prototype.hasOwnProperty.call(this.options,"localStorage")||(this.options.localStorage=!0),this.defaults={},this.callbacks={},this.tags={},this.useLocalStorage=this.options.localStorage&&a.LocalStorage.isSupported(),e.addEventListener(r.PREF_CHANGED_EVENT,(e=>{var t=this.callbacks[e.name];t&&t.forEach((t=>{var i=t.changed;i&&"function"==typeof i&&i(e.value)}))})),e.addEventListener(r.PREF_RESET_EVENT,(e=>{var t=this.callbacks[e.name];t&&t.forEach((t=>{var i=t.reset;i&&"function"==typeof i&&i(e.value)}))}));return new Proxy(this,{get:function(e,t){return t in e?e[t]:e.storageCache[t]}})}setWebStorageKey(e){this.storageKey=e}webStorage(e,t){if(this.useLocalStorage){if(this.hasTag(e,"no-storage"))return;const i=this.getLocalStoragePrefix()+this.storageKey;let r=a.LocalStorage.getItem(i);if(r=JSON.parse(r||"{}"),void 0!==t)t instanceof s.EnumType&&(t=t.toString()),r[e]=t,a.LocalStorage.setItem(i,JSON.stringify(r));else if(void 0!==(t=r[e]))try{"__enum"===(t=JSON.parse(t)).type&&(t=s.EnumType.deSerialize(t))}catch(e){n.logger.log("Preferences: Cannot deserialize value ="+t),t=void 0}return t}}getPrefFromLocalStorage(e){return this.webStorage(e)}setPrefInLocalStorage(e,t){return this.webStorage(e,t)}addPref(e,t){if("string"!=typeof e||"function"==typeof this.storageCache[e])return void n.logger.log("Preferences: invalid name="+e);t instanceof s.EnumType&&(t=t.clone());const i=this.webStorage(e);this.storageCache[e]=i||t,this.tags[e]={}}load(e){for(var t in this.defaults=e,this.defaults)Object.prototype.hasOwnProperty.call(this.defaults,t)&&this.addPref(t,this.defaults[t])}addTags(e,t){if(!t||!e)return!1;t=Array.isArray(t)?t:[t];for(var i=0;i<t.length;++i)this.tag(t[i],e);return!0}tag(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(this.defaults);for(var i=0;i<t.length;++i)this.tags[t[i]]&&(this.tags[t[i]][e]=!0)}}untag(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(this.defaults);for(var i=0;i<t.length;++i)this.tags[t[i]]&&(this.tags[t[i]][e]=!1)}}hasTag(e,t){var i=this.tags[e];return!!i&&!0===i[t]}add(e,t,i,o){return!Object.prototype.hasOwnProperty.call(this.defaults,e)||o?(this.setDefault(e,t),this.addPref(e,t),this.addTags(e,i),o&&this.viewer.dispatchEvent({type:r.PREF_CHANGED_EVENT,name:e,value:this.get(e)}),!0):(n.logger.log("Preferences: "+e+" already exists"),!1)}setDefault(e,t){e&&null!=t&&(t instanceof s.EnumType?this.defaults[e]=t.clone():this.defaults[e]=t)}remove(e,t){return!!Object.prototype.hasOwnProperty.call(this.defaults,e)&&(delete this.defaults[e],delete this.tags[e],this.storageCache&&delete this.storageCache[e],t&&this.deleteFromWebStorage(e),!0)}deleteFromWebStorage(e){if(this.useLocalStorage){const t=this.getLocalStoragePrefix()+this.storageKey;let i=a.LocalStorage.getItem(t);i=JSON.parse(i||"{}"),delete i[e],a.LocalStorage.setItem(t,JSON.stringify(i))}}clearWebStorage(){const e=this.getLocalStoragePrefix();if(this.useLocalStorage)for(let t of a.LocalStorage.getAllKeys())-1!==t.indexOf(e)&&a.LocalStorage.removeItem(t)}reset(e,t){for(var i in e&&void 0===t&&(t=!0),this.defaults)if(Object.prototype.hasOwnProperty.call(this.defaults,i)){if(e){var n=!!this.tags[i][e];if(t&&!n||!t&&n)continue}this.set(i,this.defaults[i],!1)&&this.viewer.dispatchEvent({type:r.PREF_RESET_EVENT,name:i,value:this.get(i)}),this.deleteFromWebStorage(i)}}getLocalStoragePrefix(){return this.options.prefix}get(e){return this.storageCache[e]instanceof s.EnumType?this.storageCache[e].value:this.storageCache[e]}set(e,t,i){const n=t instanceof s.EnumType?t.value:t;return!function(e,t){const i=e=>"object"==typeof e?JSON.stringify(e):e;return i(e)===i(t)}(this.get(e),n)&&(this.storageCache[e]instanceof s.EnumType?this.storageCache[e].value=n:t instanceof s.EnumType?this.storageCache[e]=t.clone():this.storageCache[e]=n,this.webStorage(e,this.storageCache[e]),(void 0===i||i)&&this.viewer.dispatchEvent({type:r.PREF_CHANGED_EVENT,name:e,value:this.get(e)}),!0)}dispatchEvent(e){const t=this.get(e),i=r.PREF_CHANGED_EVENT;this.viewer.dispatchEvent({type:i,name:e,value:t})}addListeners(e,t,i){this.callbacks[e]||(this.callbacks[e]=[]),i||(i=t),this.callbacks[e].push({changed:t,reset:i})}removeListeners(e,t,i){if(void 0!==this.callbacks[e])if(t||i){i||(i=t);for(let r=0;r<this.callbacks[e].length;++r)if(this.callbacks[e][r].changed===t&&this.callbacks[e][r].reset===i){this.callbacks[e].splice(r,1);break}}else delete this.callbacks[e]}clearListeners(){this.callbacks={}}setUseLocalStorage(e){this.useLocalStorage=!!e}}o.GlobalManagerMixin.call(l.prototype)},56873:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Profile:()=>o});var r=i(64141),n=i(40213);function o(e){if(!e)return;const t=Autodesk.Viewing,i=t.ProfileSettings.Default;let o=[];if(this.name=Object.prototype.hasOwnProperty.call(e,"name")?e.name:"Custom",this.label=e.label,this.description=e.description,this.storageVersion="2.0",this.persistent=Array.isArray(e.persistent)?e.persistent:i.persistent,this.settings=Object.assign({},i.settings),Object.prototype.hasOwnProperty.call(e,"settings")){const t=e.settings;o=Object.keys(t),this.settings=Object.assign(this.settings,t)}let s=[],a=[];if(Object.prototype.hasOwnProperty.call(e,"extensions")){const t=e.extensions.load,i=e.extensions.unload;s=t?t.slice():s,a=i?i.slice():a}this.extensions={load:s,unload:a},this.apply=function(e){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;const s=e.getLocalStoragePrefix()+"StorageVersion",a="Autodesk.Viewing.ProfileName";!e.useLocalStorage||n.LocalStorage.getItem(s)||!n.LocalStorage.getItem(a)||(()=>{const t={},i=n.LocalStorage.getItem(a),r=e.getLocalStoragePrefix();for(let e of n.LocalStorage.getAllKeys())if(-1!==e.indexOf(r))try{t[e.split(".").pop()]=JSON.parse(n.LocalStorage.getItem(e)),n.LocalStorage.removeItem(e)}catch{console.log(`Cound't convert preference to new format: ${e}`)}n.LocalStorage.setItem(r+i,JSON.stringify(t)),n.LocalStorage.removeItem(a)})();const l=e.getLocalStoragePrefix()+"StorageVersion";n.LocalStorage.setItem(l,this.storageVersion);const h=e.getLocalStoragePrefix()+"CurrentProfile";n.LocalStorage.setItem(h,this.name),e.setWebStorageKey(this.name);const c=this.settings,u=[t.ProfileSettings.Default.name,t.ProfileSettings.AEC.name],d=Object.values(r.Prefs3D),p=Object.values(r.Prefs2D);for(let t in c)if(Object.prototype.hasOwnProperty.call(c,t)){const r=c[t],n=-1!==o.indexOf(t)&&-1===u.indexOf(this.name)?["ignore-producer"]:[];-1!==d.indexOf(t)?n.push("3d"):-1!==p.indexOf(t)?n.push("2d"):(n.push("2d"),n.push("3d")),-1===this.persistent.indexOf(t)&&n.push("no-storage");const s=e.webStorage(t),a=e.get(t);if(void 0!==s){s!=a&&(e.add(t,s,n,!0),e.setDefault(t,r));continue}if(void 0!==a){e.addTags(t,n),a!==r&&i&&e.set(t,r);continue}e.add(t,r,n,!0)}return!0}}},94357:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ProfileManager:()=>o});var r=i(60489),n=i(56873);class o{constructor(){this.registered={};const e=Autodesk.Viewing.ProfileSettings;this.PROFILE_DEFAULT=new n.Profile(e.Default),this.registerProfile("default",this.PROFILE_DEFAULT),this.PROFILE_AEC=new n.Profile(e.AEC),this.registerProfile("rvt",this.PROFILE_AEC),this.registerProfile("ifc",this.PROFILE_AEC),this.PROFILE_NAVIS=new n.Profile(e.Navis),this.registerProfile("nwc",this.PROFILE_NAVIS),this.registerProfile("nwd",this.PROFILE_NAVIS),this.PROFILE_FLUENT=new n.Profile(e.Fluent),this.registerProfile("fluent",this.PROFILE_FLUENT)}registerProfile(e,t){t?(e=e||"default",this.registered[e]=t instanceof n.Profile?t:new n.Profile(t)):r.logger.log("ProfileManager: missing profileSettings when registering a profile.")}unregisterProfile(e){e?delete this.registered[e]:r.logger.log("ProfileManager: missing fileExt when unregistering a profile.")}getProfiles(){return Object.assign({},this.registered)}getProfileOrDefault(e){if(!e)return r.logger.log("ProfileManager: missing fileExt for getProfile. Returning the default Profile."),this.registered.default;const t=this.registered[e];return t||(r.logger.log(`ProfileManager: No profile registered for ${e}. Returning the default Profile.`),this.registered.default)}}},44135:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DefaultSettings:()=>u,EnumType:()=>h,ProfileSettings:()=>v});var r=i(64141),n=i(60489),o=i(36263),s=i(7247),a=i(52156),l=i(47654);class h{constructor(e,t){if(!Array.isArray(e)||0===e.length)throw new Error(`Invalid ${e}`);this.values=new Set(e),this.current=e.includes(t)?t:e[0]}get value(){return this.current}set value(e){this.values.has(e)&&(this.current=e)}clone(){return h.deSerialize(JSON.parse(this.toString()))}toString(){return JSON.stringify({type:"__enum",values:Array.from(this.values),current:this.current})}static deSerialize(e){if("__enum"===e.type)return new h(e.values,e.current)}}const c={};c[r.Prefs3D.AMBIENT_SHADOWS]=!0,c[r.Prefs3D.ANTIALIASING]=!(0,s.isMobileDevice)(),c[r.Prefs3D.GROUND_SHADOW]=!0,c[r.Prefs3D.GROUND_REFLECTION]=!1,c[r.Prefs3D.GHOSTING]=!0,c[r.Prefs3D.VIEW_CUBE]=!(0,s.isMobileDevice)(),c[r.Prefs3D.VIEW_CUBE_COMPASS]=!1,c[r.Prefs3D.VIEW_TYPE]=r.VIEW_TYPES.DEFAULT,c[r.Prefs3D.LINE_RENDERING]=!0,c[r.Prefs3D.LIGHT_PRESET]=a.DefaultLightPreset,c[r.Prefs3D.EDGE_RENDERING]=!1,c[r.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION]=!1,c[r.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION]=!1,c[r.Prefs3D.ALWAYS_USE_PIVOT]=!1,c[r.Prefs3D.ZOOM_TOWARDS_PIVOT]=!1,c[r.Prefs3D.ORBIT_PAST_WORLD_POLES]=!0,c[r.Prefs3D.CLICK_TO_SET_COI]=!1,c[r.Prefs3D.OPTIMIZE_NAVIGATION]=(0,s.isMobileDevice)(),c[r.Prefs3D.ENV_MAP_BACKGROUND]=!1,c[r.Prefs3D.FIRST_PERSON_TOOL_POPUP]=!0,c[r.Prefs3D.BIM_WALK_TOOL_POPUP]=!0,c[r.Prefs3D.BIM_WALK_NAVIGATOR_TYPE]="default",c[r.Prefs3D.BIM_WALK_GRAVITY]=!0,c[r.Prefs3D.DEFAULT_NAVIGATION_TOOL_3D]="default",c[r.Prefs3D.SELECTION_MODE]=o.SelectionMode.LEAF_OBJECT,c[r.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR]=!0,c[r.Prefs3D.EXPLODE_STRATEGY]="hierarchy",c[r.Prefs3D.SELECTION_SETS_PIVOT]=!1,c[r.Prefs3D.FORCE_DOUBLE_SIDED]=!1,c[r.Prefs3D.DISPLAY_SECTION_HATCHES]=!0,c[r.Prefs2D.GRAYSCALE]=!1,c[r.Prefs2D.SWAP_BLACK_AND_WHITE]=!1,c[r.Prefs2D.LOADING_ANIMATION]=!1,c[r.Prefs2D.FORCE_PDF_CALIBRATION]=!1,c[r.Prefs2D.FORCE_LEAFLET_CALIBRATION]=!0,c[r.Prefs2D.DISABLE_PDF_HIGHLIGHT]=!1,c[r.Prefs2D.USE_PDF_VIEWPORT_INFO]=!1,c[r.Prefs.PROGRESSIVE_RENDERING]=!0,c[r.Prefs.OPEN_PROPERTIES_ON_SELECT]=!1,c[r.Prefs.POINT_RENDERING]=!0,c[r.Prefs.BACKGROUND_COLOR_PRESET]=null,c[r.Prefs.REVERSE_MOUSE_ZOOM_DIR]=!1,c[r.Prefs.LEFT_HANDED_MOUSE_SETUP]=!1,c[r.Prefs.FUSION_ORBIT]=!0,c[r.Prefs.FUSION_ORBIT_CONSTRAINED]=!0,c[r.Prefs.WHEEL_SETS_PIVOT]=!1,c[r.Prefs.RESTORE_SESSION_MEASUREMENTS]=!0,c[r.Prefs.DISPLAY_UNITS]=new h(l.displayUnitsEnum),c[r.Prefs.DISPLAY_UNITS_PRECISION]=new h(l.displayUnitsPrecisionEnum),c[r.Prefs.KEY_MAP_CMD]=!0;const u=c,d={name:"Default",label:"Manufacturing (Default)",description:"Default Viewer settings"};d.settings=c,d.persistent=[r.Prefs3D.ALWAYS_USE_PIVOT,r.Prefs3D.ZOOM_TOWARDS_PIVOT,r.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION,r.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION,r.Prefs3D.ORBIT_PAST_WORLD_POLES,r.Prefs3D.CLICK_TO_SET_COI,r.Prefs3D.GHOSTING,r.Prefs3D.OPTIMIZE_NAVIGATION,r.Prefs3D.AMBIENT_SHADOWS,r.Prefs3D.ANTIALIASING,r.Prefs3D.GROUND_SHADOW,r.Prefs3D.GROUND_REFLECTION,r.Prefs3D.FIRST_PERSON_TOOL_POPUP,r.Prefs3D.BIM_WALK_TOOL_POPUP,r.Prefs3D.BIM_WALK_GRAVITY,r.Prefs3D.VIEW_TYPE,r.Prefs3D.SELECTION_MODE,r.Prefs2D.SWAP_BLACK_AND_WHITE,r.Prefs2D.LOADING_ANIMATION,r.Prefs.OPEN_PROPERTIES_ON_SELECT,r.Prefs.REVERSE_MOUSE_ZOOM_DIR,r.Prefs.LEFT_HANDED_MOUSE_SETUP,r.Prefs.WHEEL_SETS_PIVOT,r.Prefs.KEY_MAP_CMD,r.Prefs.DISPLAY_UNITS,r.Prefs.DISPLAY_UNITS_PRECISION],d.extensions={load:[],unload:[]};const p=g(d);p.name="AEC",p.label="Construction (AEC)",p.description="A common set of preferences designed for the Construction industry",p.settings[r.Prefs.REVERSE_MOUSE_ZOOM_DIR]=!0,p.settings[r.Prefs3D.EDGE_RENDERING]=!(0,s.isMobileDevice)(),p.settings[r.Prefs3D.LIGHT_PRESET]=(0,s.getGlobal)().DefaultLightPresetAec||"Boardwalk",p.settings[r.Prefs3D.ENV_MAP_BACKGROUND]=!0,p.settings[r.Prefs3D.VIEW_CUBE_COMPASS]=!0,p.settings[r.Prefs3D.SELECTION_SETS_PIVOT]=!0,p.extensions={load:[],unload:[]};const f=g(p);f.name="Fluent",f.label="Design Collaboration",f.description="User experience that matches Design Collaboration",f.settings[r.Prefs.WHEEL_SETS_PIVOT]=!0,f.settings[r.Prefs.RESTORE_SESSION_MEASUREMENTS]=!1,f.settings[r.Prefs2D.FORCE_PDF_CALIBRATION]=!0,f.settings[r.Prefs3D.ALWAYS_USE_PIVOT]=!0,f.settings[r.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR]=!1,f.extensions={load:[],unload:[]},f.persistent.splice(f.persistent.indexOf(r.Prefs3D.VIEW_TYPE),1);const m=g(p);function g(e){e||(n.logger.log("ProfileSettings.clone: missing profileSettings, using DefaultProfileSettings..."),e=d);const t={};return t.settings=Object.assign({},e.settings),t.extensions={},Object.prototype.hasOwnProperty.call(e,"extensions")?(t.extensions.load=Object.prototype.hasOwnProperty.call(e.extensions,"load")?e.extensions.load.slice():[],t.extensions.unload=Object.prototype.hasOwnProperty.call(e.extensions,"unload")?e.extensions.unload.slice():[]):t.extensions={load:[],unload:[]},t.persistent=e.persistent.slice(),t}m.name="Navis",m.label="Navisworks",m.description="Provides a user experience similar to Autodesk Navisworks desktop application",m.settings[r.Prefs3D.BIM_WALK_TOOL_POPUP]=!1,m.settings[r.Prefs3D.BIM_WALK_NAVIGATOR_TYPE]="aec",m.settings[r.Prefs3D.DEFAULT_NAVIGATION_TOOL_3D]="extractor_defined";const v={Default:d,AEC:p,Fluent:f,Navis:m,clone:g}},77876:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ProgressState:()=>r});let r={ROOT_LOADED:0,LOADING:1,RENDERING:2}},82977:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PropertySet:()=>n});var r=i(56857);class n{constructor(e){this.map=e}forEach(e){if(e)for(let t in this.map){if("__selected_dbIds__"===t)continue;e(t,this.map[t])}}getAggregation(e){if(!e)return null;if("string"==typeof e&&(e=this.map[e]),0===e.length)return null;const t=e[0].type;if(!(0,r.OY)(t))return null;const i={average:0,count:0,max:0,median:0,min:0,mode:[],range:0,sum:0},n=e.map((e=>Number(e.displayValue)));n.sort(((e,t)=>e-t));const o={};let s=0,a=0;n.forEach((e=>{a+=e,Object.prototype.hasOwnProperty.call(o,e)?o[e]++:o[e]=1,s=Math.max(s,o[e]),i.sum+=e})),i.count=n.length,i.average=a/i.count,i.max=n[i.count-1],i.min=n[0];const l=Math.ceil(i.count/2);i.median=i.count%2&&i.count>1?(n[l]+n[l-1])/2:n[l-1];for(let e in o)o[e]===s&&i.mode.push(Number(e));return i.range=i.max-i.min,i.sum=function(e,t){var i=t.displayValue.toString().split(".");if(1===i.length)return e;const r=e.toString().split(".");if(1===r.length)return e;const n=r[1];let o=i[1];if(n===o)return e;o=o.match(/\d+/);const s=o&&o[0]&&o[0].length||t.precision||0;return Number(e.toFixed(s))}(i.sum,e[0]),i}getValue2PropertiesMap(e){if(!e)return null;if("string"==typeof e&&(e=this.map[e]),!e||0===e.length)return null;const t={};return e.forEach((e=>{Object.prototype.hasOwnProperty.call(t,e.displayValue)||(t[e.displayValue]=[]),t[e.displayValue].push(e.parentName)})),t}getValidIds(e,t){const i=Object.keys(this.map),r=[];for(let n=0;n<i.length;n++){const o=i[n];if(e){if(-1!==o.indexOf(e)){r.push(o);continue}}if(t){const e=o.split("/");if(e.length>=2&&e[0]===t){r.push(o);continue}}}return r}getDbIds(){return this.map.__selected_dbIds__}getVisibleKeys(){const e=[];return this.forEach(((t,i)=>{i[0].hidden||e.push(t)})),e}getKeysWithCategories(){const e=[];return this.forEach(((t,i)=>{const r=!!i[0].hidden;i[0].displayCategory&&!r&&e.push(t)})),e}merge(e){if(!(e instanceof n))return this;const t=e.map;for(let e in t){const i=t[e];if(!Object.prototype.hasOwnProperty.call(this.map,e)){this.map[e]=i;continue}const r=this.map[e];if("__selected_dbIds__"!==e)for(let e=0;e<i.length;e++){const t=i[e];let n=!0;for(let e=0;e<r.length;e++){const i=r[e];t.displayValue!==i.displayValue||t.dbId!==i.dbId||(n=!1)}n&&r.push(t)}else this.map[e]=[...r,...i]}return this}}},3109:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AppScreenModeDelegate:()=>u,ApplicationScreenModeDelegate:()=>d,NullScreenModeDelegate:()=>p,ScreenMode:()=>h,ScreenModeDelegate:()=>c,ScreenModeMixin:()=>f});var r=i(7247),n=i(18878),o=i(60489),s=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];function a(e,t){for(var i=0;i<s.length;++i)t.addDocumentEventListener(s[i],e,!1)}function l(e,t){for(var i=0;i<s.length;++i)t.removeDocumentEventListener(s[i],e,!1)}const h={kNormal:0,kFullBrowser:1,kFullScreen:2};function c(e){this.viewer=e,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===h.kFullScreen&&a(this.bindFullscreenEventListener,this.viewer.globalManager)}function u(e){c.call(this,e)}c.prototype.uninitialize=function(){l(this.bindFullscreenEventListener,this.viewer.globalManager),this.viewer=null},c.prototype.isModeSupported=function(e){return!0},c.prototype.setMode=function(e){var t=this.getMode();return!(e===t||!this.isModeSupported(e))&&(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0)},c.prototype.getMode=function(){throw"Implement getMode() in derived class"},c.prototype.getNextMode=function(){var e,t=this.getMode(),i=h;return t===i.kNormal&&this.isModeSupported(i.kFullBrowser)?e=i.kFullBrowser:t===i.kNormal&&this.isModeSupported(i.kFullScreen)||t===i.kFullBrowser&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kNormal)||t===i.kFullScreen&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kFullBrowser)&&(e=i.kFullBrowser),e},c.prototype.getEscapeMode=function(){return this.getMode()!==h.kNormal?h.kNormal:void 0},c.prototype.fullscreenEventListener=function(){var e=this.viewer.globalManager.getDocument();(0,r.inFullscreen)(e)?this.viewer.resize():(this.doScreenModeChange(h.kFullScreen,h.kNormal),this.onScreenModeChanged(h.kFullScreen,h.kNormal))},c.prototype.doScreenModeChange=function(e,t){throw"Implement doScreenModeChange() in derived class"},c.prototype.onScreenModeChanged=function(e,t){e===h.kFullScreen?l(this.bindFullscreenEventListener,this.viewer.globalManager):t===h.kFullScreen&&a(this.bindFullscreenEventListener,this.viewer.globalManager),this.viewer.resize(),this.viewer.dispatchEvent({type:n.FULLSCREEN_MODE_EVENT,mode:t})},u.prototype=Object.create(c.prototype),u.prototype.constructor=u,u.prototype.isModeSupported=function(e){return e!==h.kFullBrowser},u.prototype.getMode=function(){var e=this.viewer.globalManager.getDocument();return(0,r.inFullscreen)(e)?h.kFullScreen:h.kNormal},u.prototype.doScreenModeChange=function(e,t){var i=this.viewer.container;if(t===h.kNormal){i.classList.remove("viewer-fill-browser");var n=this.viewer.globalManager.getDocument();(0,r.exitFullscreen)(n)}else t===h.kFullScreen&&(i.classList.add("viewer-fill-browser"),(0,r.launchFullscreen)(i))};let d=u;function p(e){c.call(this,e)}function f(){}p.prototype=Object.create(c.prototype),p.prototype.constructor=c,p.prototype.isModeSupported=function(){return!1},p.prototype.getMode=function(){return h.kNormal},f.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=e||(null===e?p:u)},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e};return o.logger.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode();return void 0!==e&&this.setScreenMode(e)},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode();return void 0!==e&&this.setScreenMode(e)},apply:function(e){var t=f.prototype;e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}}},27343:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ScreenShot:()=>x});var r=i(93549),n=i(86437),o=i(38454),s=i(7247),a=i(56144),l=i(33736),h=i(37765),c=i(70179),u=i(75050),d=i(18878),p=i(86008);const f=(e,t,i,d,f)=>{let m=f.getMaterials(),g=f.glrenderer(),v=f.renderer(),y=f.modelQueue(),b=[],x=(d=d||{}).models||y.getModels();for(let e=0;e<x.length;e++){let t=x[e].getIterator();if(!t||!t.getGeomScenes)continue;let i=t.getGeomScenes();for(let e=0;e<i.length;e++){let t=i[e];t&&b.push(t)}}let _=d.camera||f.camera;_===f.camera&&(_=_.clone()),_.isUnifiedCamera&&_.updateCameraMatrices(),_.clientWidth=e,_.clientHeight=t;const E=new n.FrustumIntersector,A=d.excludeCutPlanes?[]:m.getCutPlanes(),S=!d.excludeCutplanes&&m.cutplanesHideInterior>0;let w,M;E.reset(_,A,S),E.areaCullThreshold=r.PIXEL_CULLING_THRESHOLD,g.pushViewport(),g.setPixelRatio(1),d.renderContext?w=d.renderContext:(w=new o.RenderContext,w.init(g,e,t,{offscreen:!0})),f.isSheetRendererNeeded()&&(M=d.sheetRenderer?d.sheetRenderer:new p.Z(f,w,g,m)),m.addOverrideMaterial("normalsMaterial_screenshot",w.getDepthMaterial()),m.addOverrideMaterial("edgeMaterial_screenshot",w.getEdgeMaterial());let T=d.renderConfig||v.getConfig();w.applyConfig(T),w.beginScene(f.scene,_,f.noLights,!0),g.popViewport(),g.setPixelRatio();let C,P=0,D={stop:()=>{C&&((0,s.getGlobal)().clearTimeout(C),R())},finished:()=>!!C},L=-1,I=[];for(let e=0;e<x.length;e++){let t=x[e];if(t.isLeaflet()){let e=t.getIterator();I.push({iter:e,viewId:e.registerView(),ready:!1})}}const R=()=>{I.forEach((e=>e.iter.unregisterView(e.viewId))),I.length=0};let O=d.fragOptions,N=O?[]:void 0;const F=e=>{if(!(!!O&&e instanceof a.RenderBatch))return;let t=e.frags;e.forEachNoMesh((function(e,i){N[i]=t.vizflags[e];let r=O.isFragOff&&O.isFragOff(e);void 0!==r&&t.setFlagFragment(e,l.MeshFlags.MESH_HIDE,r);let n=O.isFragVisible&&O.isFragVisible(e);void 0!==n&&t.setFlagFragment(e,l.MeshFlags.MESH_VISIBLE,n)}))},k=e=>{if(!(!!O&&e instanceof a.RenderBatch))return;let t=e.frags;e.forEachNoMesh((function(e,i){let r=N[i],n=!!(r&l.MeshFlags.MESH_HIDE),o=!!(r&l.MeshFlags.MESH_VISIBLE);t.setFlagFragment(e,l.MeshFlags.MESH_HIDE,n),t.setFlagFragment(e,l.MeshFlags.MESH_VISIBLE,o)}))},V=(()=>{let e;if(d.models){e=new u.Box3;for(let t=0;t<x.length;t++){let i=x[t];e.union(i.getBoundingBox())}}else e=f.getVisibleBounds();let t=Object.prototype.hasOwnProperty.call(d,"is2d")?d.is2d:f.is2d,i=w.settings.deviceHeight,r=d.excludeCutPlanes?void 0:m.getCutPlanesRaw(),n=r&&r[0],o=x[0]&&x[0].getBoundingBox();return h.SceneMath.getPixelsPerUnit(_,t,e,i,n,o)})();let U=[],B=null;const G=e=>{d.excludeThemingColors&&e instanceof a.RenderBatch&&(e.frags.is2d||(B=e.frags.db2ThemingColor,e.frags.db2ThemingColor=U))},z=e=>{B&&(e.frags.db2ThemingColor=B,B=null)};let H=new u.Vector4(0,0,-1,-1e20),W=[],j=null;const q=()=>{if(!(()=>{let e=!0;for(let t=0;t<I.length;t++){let i=I[t];i.ready||(i.ready=i.iter.reset(E,_,i.viewId)),e=e&&i.ready}if(e=e||d.dontWaitForLeafletTiles,e)for(let e=0;e<I.length;e++){let t=I[e],i=t.iter.getScene(t.viewId);b.push(i)}return e})())return void(C=(0,s.getGlobal)().setTimeout(q,0));let r=performance.now();g.pushViewport(),g.setPixelRatio(1),g.setViewport(0,0,e,t);let n=f.getPixelsPerUnit(f.camera,f.getVisibleBounds());var o,l;(m.updatePixelScale(V,e,t,_),d.excludeCutPlanes)?(()=>{j=m.getCutPlanes();let e=j.length;if(W.length!==e){W.length=e;for(let t=0;t<e;t++)W[t]=H}v.toggleTwoSided(m.setCutPlanes(W))})():null===(o=(l=f.api).syncCutPlanes)||void 0===o||o.call(l);for(d.beforeRender&&d.beforeRender();P<b.length;){let e=b[P];const t=x.find((t=>{var i;return t.id===(null===(i=e.frags)||void 0===i?void 0:i.modelId)}));if(null!=t&&t.is2d()){const e=t.getModelToViewerTransform(),i=e?e.getMaxScaleOnAxis():1;if(!f.is2d||1!==i){const e=t.getVisibleBounds(),r=w.settings.deviceWidth,n=w.settings.deviceHeight,o=h.SceneMath.getPixelsPerUnit(_,!0,e,n,null,e);m.updatePixelScaleForModel(t,o,r,n,i,_)}}if(F(e),G(e),e instanceof a.RenderBatch&&e.applyVisibility(c.RenderFlags.RENDER_NORMAL,E),M&&e.frags.is2d?M.renderScenePart(e,!0,!0,!1,w):(w.renderScenePart(e,!0,!0,!1,!1),(e.frags&&!e.frags.areAllVisible()&&f.showGhosting||O)&&(e instanceof a.RenderBatch&&e.applyVisibility(c.RenderFlags.RENDER_HIDDEN,E),v.setEdgeColor(f.edgeColorGhosted),e.overrideMaterial=f.fadeMaterial,w.renderScenePart(e,!0,!0,!1,!1),v.setEdgeColor(f.edgeColorMain),e.overrideMaterial=null)),z(e),k(e),P++,performance.now()-r>20)break}if(g.popViewport(),g.setPixelRatio(),m.updatePixelScale(n,v.settings.deviceWidth,v.settings.deviceHeight,_),d.excludeCutPlanes&&v.toggleTwoSided(m.setCutPlanes(j)),d.afterRender&&d.afterRender(),P===b.length?(()=>{R();let e=w.getColorTarget();if(T.aoEnabled||T.antialias)T.aoEnabled&&w.computeSSAO(),e=w.getNamedTarget("overlay"),w.getBlendPass().uniforms.tOverlay.value=null,w.setOffscreenTarget(e),w.presentBuffer();else{let e=f.lightsOn?f.lights:f.no_lights;if(d.overlayScenes){const t=d.overlayScenes??f.overlayScenes;w.renderOverlays(t,e)}}if(d.returnAsTarget){const t=d.extraTargets?d.extraTargets.map((e=>w.getNamedTarget(e))):void 0;return void i(w,e,_,M,t)}var t;d.sheetRenderer||(null===(t=M)||void 0===t||t.destroy(),M=null),w.targetToCanvas(e).canvas.toBlob((function(e){let t=(0,s.getGlobal)().URL.createObjectURL(e);i&&(i(t),d.renderContext||w.cleanup())}))})():C=(0,s.getGlobal)().setTimeout(q,0),d.onProgress){let e=Math.floor(100*P/b.length);e!==L&&(L=e,d.onProgress(e))}};return q(),D},m=(e,t,i,r,n)=>{var{fullPage:o,bounds:a,getCropBounds:l,margin:h,overlayRenderer:c,overlayRendererExtraOptions:d}=n;o&&(a=e.impl.getVisibleBounds());const p=e.impl.getCanvasBoundingClientRect().width;let m=e.navigation.getCamera();a&&(m=b(e,a,h));const y=g(e,m);try{if(o){const e=y.getSize(new u.Vector3),r=p/Math.max(e.x,e.y);t=Math.floor(t*r),i=Math.floor(i*r)}const n=n=>{if(o){const e=t/p;y.min.x*=e,y.min.y*=e,y.max.x*=e,y.max.y*=e,v(n,y,r)}else if(l){const t=l(e,m,a);v(n,t,r)}else n.toBlob((e=>{const n=(0,s.getGlobal)().URL.createObjectURL(e);r(n,t,i)}))},h=e.impl.selector.getSelection();return e.clearSelection(),f(t,i,((r,o,s)=>{if(e.impl.selector.setSelection(h),c){c(e,{width:t,height:i,ctx:r,target:o,screenshotCamera:s,onRenderDone:n},d)}else{const{canvas:e}=r.targetToCanvas(o);n(e)}}),{returnAsTarget:!0,camera:m},e.impl)}catch(e){console.error("getScreenShot error: "+e),r(null)}},g=(e,t)=>{const i=e.impl.getVisibleBounds(void 0,void 0,void 0,!0),r=e.worldToClient(i.min,t),n=e.worldToClient(i.max,t);return(new u.Box3).setFromPoints([r,n])},v=(e,t,i)=>{const r=(0,s.getGlobal)().document.createElement("canvas"),n=r.getContext("2d"),o=t.getSize(new u.Vector3),a=Math.min(Math.floor(o.x),e.width),l=Math.min(Math.floor(o.y),e.height);r.width=a,r.height=l;const h=Math.max(Math.floor(t.min.x),0),c=Math.max(Math.floor(t.min.y),0),d=a,p=l;n.drawImage(e,h,c,d,p,0,0,a,l),r.toBlob((e=>{var t=(0,s.getGlobal)().URL.createObjectURL(e);i(t,a,l)}),"image/png")},y=(e,t,i,r)=>{const n=(0,s.getGlobal)().document.createElement("canvas"),o=n.getContext("2d"),a=new Image;n.width=t,n.height=i,a.src=e,a.onload=function(){o.drawImage(a,0,0,t,i);const e=n.toDataURL("image/png");r(e)}},b=(e,t,i)=>{i=i||e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN;const r={horizontal:e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,vertical:e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN};e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=i,e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=i;const n=e.getState({viewport:!0});e.navigation.fitBounds(!0,t,!1,!0);const o=e.navigation.getCamera().clone();return e.restoreState(n,void 0,!0),e.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=r.horizontal,e.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=r.vertical,e.impl.updateNearFarValues(o,t),o};let x={getScreenShotLegacy:function(e,t,i,r,n){var o=e.impl,a=o.renderer(),l=a.settings.logicalWidth,h=a.settings.logicalHeight,c=o.progressiveRender,p=o.glrenderer().getPixelRatio();t&&i||(t=l,i=h),o.progressiveRender=!1,o.resize(t/p,i/p,!0),o.tick(performance.now());var f=new u.WebGLRenderTarget(t,i,{minFilter:u.LinearFilter,magFilter:u.LinearFilter,format:u.RGBFormat,type:u.UnsignedByteType});const m=a.getOffscreenTarget();function g(){var e=a.targetToCanvas(f||a.getColorTarget());function t(){o.progressiveRender=c,o.resize(l,h,!0),e.canvas.toBlob((function(e){var t=(0,s.getGlobal)().URL.createObjectURL(e);r?r(t):(0,s.getGlobal)().open(t)}),"image/png")}f&&(f.dispose(),f=void 0,o.glrenderer().setRenderTarget(null)),n?n(e.ctx,t):t()}if(a.setOffscreenTarget(f),a.presentBuffer(),a.setOffscreenTarget(m),e.model.isLeaflet()){var v=!1;const t=function(){v=!0,o.progressiveRender=c,o.resize(l,h,!0),f&&f.dispose()};e.addEventListener(d.CANCEL_LEAFLET_SCREENSHOT,t,{once:!0}),o.invalidate(!0),e.model.getIterator().callWhenRefined((function(){v||(e.removeEventListener(d.CANCEL_LEAFLET_SCREENSHOT,t),g())}))}else g()},getScreenShot:f,getScreenShotWithBounds:m,getScreenShotAtScreenSize:(e,t,i)=>{const r=e.impl.getCanvasBoundingClientRect(),n=Math.floor(r.width),o=Math.floor(r.height);m(e,n,o,((e,i,r)=>{e?y(e,i,r,(e=>{t(e,i,r)})):t(null)}),i)},getSceneClientBounds:g,cropImage:v,blobToImage:y,makeBoundsSquare:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=e.getSize(new u.Vector3),r=Math.max(i.x,i.y,t);e.expandByVector(new u.Vector3((r-i.x)/2,(r-i.y)/2,0))},getCameraWithFitBounds:b}},23976:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Thumbnails:()=>l});var r=i(40213),n=i(97790),o=i(68110),s=i(7247),a=i(6875);let l={getUrlForBubbleNode:function(e,t){if(!e)return Promise.reject(new Error("Missing instance of BubbleNode"));var i=e.findParentGeom2Dor3D();if(!i)return Promise.reject(new Error("No thumbnail available."));const l=(t=t||{}).size||200,h=e.getRootNode();return(h.data.isVectorPDF||i.data.isVectorPDF)&&h.data.getPDF?new Promise((t=>{let i=e.data,n=h.data.getPDF(),o=l,a=l,c=`${i.guid}/thumbnail/${o}x${a}`;!function(e,t,i,n,o,a){var l=r.LocalStorage.getItem(o);l?a(l):e.getPage(t).then((e=>{var t=(0,s.getGlobal)().document.createElement("canvas");t.width=i,t.height=n;var l=t.getContext("2d"),h={scale:1},c=e.getViewport(h),u=Math.min(t.width/c.width,t.height/c.height);e.render({canvasContext:l,viewport:e.getViewport({scale:u})}).promise.then((()=>{e.cleanup(),t.toBlob((e=>{var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){r.LocalStorage.setItem(o,t.result),a(t.result)}}),"image/png")}))}))}(n,i.page,o,a,c,t)})):new Promise(((t,i)=>{var r={urn:h.urn(),width:l,height:l,guid:encodeURIComponent(e.guid()),acmsession:n.endpoint.getAcmSession()},c={responseType:"blob",skipAssetCallback:!0,size:l,guid:r.guid,acmsession:r.acmSession};let u="urn:"+r.urn;e.data.thumbnailUrn&&(u=h.getDocument().getFullPath(e.data.thumbnailUrn));var d=void 0;if(!(0,s.getGlobal)().USE_OTG_DS_PROXY){var p=(0,n.getEnv)();d=a.EnvironmentConfigurations[p].UPSTREAM;const e=(0,a.getUpstreamApiData)(p,n.endpoint.getApiFlavor());c.apiData=e}o.ViewingService.getThumbnail((0,n.initLoadContext)({endpoint:d}),u,(e=>{var i=new FileReader;i.onload=e=>{var i=e.target.result;t(i)},i.readAsDataURL(e)}),(()=>{i(new Error("Thumbnail is unavailable."))}),c)}))}}},90625:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Viewer3D:()=>$,waitForCompleteLoad:()=>ee});var r=i(75050),n=i(7247),o=i(60489),s=i(56873),a=i(64141),l=i(44135),h=i(47654),c=i(94357),u=i(27156),d=i(22599),p=i(68482),f=i(22753),m=i(3109),g=i(44631),v=i(70169),y=i(87432),b=i(78464),x=i(81941),_=i(82553),E=i(44160),A=i(91493),S=i(18878),w=i(6972),M=i(10028),T=i(62832),C=i(6223),P=i(79416),D=i(27848),L=i(39080),I=i(11056),R=i(70095),O=i(76542);const N=416,F=1e3;class k{constructor(e){this.viewer=e,this.setGlobalManager(this.viewer.globalManager),this.domElement=null,this._step=this._step.bind(this),this._maskId="mask"+Date.now()}createDom(e){const t=this.getDocument();this.domElement=t.createElement("div"),this.domElement.className="forge-spinner",this._initTransform="translate(-50%, -50%) scale(0.5)",this.domElement.style.transform=this._initTransform.slice();var i=this._createSvgElement("svg");i.setAttribute("width","242"),i.setAttribute("height","242"),i.setAttribute("viewBox","0 0 72 72"),i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.domElement.appendChild(i);var r=this._createWheelPointData(10,72,6.75);this._createMask(r);var n=this._createSvgElement("polygon");n.setAttribute("mask",`url(#${this._maskId})`),i.appendChild(n),this._addPoints(r.outerPoints,n),this._createSegments(r);var o=t.createElement("img");return o.src=Autodesk.Viewing.Private.getResourceUrl("res/ui/powered-by-autodesk-blk-rgb.png"),this._onResize=this._onResize.bind(this),o.onload=()=>{this._onResize(),this._initResize=!0,this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this._onResize)},this.domElement.appendChild(o),e&&e.appendChild(this.domElement),this.domElement.style.display="none",this.domElement}_createSvgElement(e){return this.getDocument().createElementNS("http://www.w3.org/2000/svg",e)}_getSvg(){return null==this?void 0:this.domElement.getElementsByTagNameNS("http://www.w3.org/2000/svg","svg")[0]}_createMask(e){const t=this._getSvg(),i=this._createSvgElement("defs"),r=this._createSvgElement("mask");r.id=this._maskId,i.appendChild(r),t.appendChild(i);const n=this._createSvgElement("polygon");n.style.opacity=.15,n.style.fill="#FFF",r.appendChild(n),this._addPoints(e.outerPoints,n);const o=this._createSvgElement("polygon");r.appendChild(o),this._addPoints(e.innerPoints,o)}_step(e){this.startTime||(this.startTime=e);const t=(e-this.startTime)%F;this._setSegmentOpacities(t);const i=this.getWindow();this._animId=i.requestAnimationFrame(this._step)}_stop(){if(this._animId){this.getWindow().cancelAnimationFrame(this._animId),this._animId=null}}_setSegmentOpacities(e){this.segments.forEach(((t,i)=>{const r=Math.abs(i-this.segments.length)-1;t.style.opacity=this._getSegmentOpacity(r,e)}))}_getSegmentOpacity(e,t){const i=e*(F/this.segments.length);return i+N>F&&t<N?-1*((t+F-i)/N-1):t<i||t>i+N?0:Math.abs((t-i)/N-1)}_getSegments(){return Array.from(this.domElement.querySelectorAll(".segment"))}_addPoints(e,t){for(let i of e){const e=this._getSvg().createSVGPoint();e.x=i[0],e.y=i[1],t.points.appendItem(e)}}_createWheelPointData(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;const r=t/2,n=t/2,o=t/2,s={outerPoints:[],innerPoints:[]};for(let t=1;t<=e;t++)s.outerPoints.push([n+r*Math.cos(2*t*Math.PI/e),o+r*Math.sin(2*t*Math.PI/e)]),s.innerPoints.push([n+(r-i)*Math.cos(2*t*Math.PI/e),o+(r-i)*Math.sin(2*t*Math.PI/e)]);return s}_createSegments(e){const{outerPoints:t,innerPoints:i}=e,r=this._getSvg(),n=(e,t)=>{var i=this._createSvgElement("polygon");i.classList.add("segment"),i.classList.add(t),this._addPoints(e,i),r.appendChild(i)};for(let e=t.length-1;e>=0;--e){let r=t[e],o=t[e-1],s=i[e],a=i[e-1];0===e&&(o=t[t.length-1],a=i[t.length-1]),n([r,o,s],"light-blue"),n([s,a,o],"dark-blue")}}_fadeOut(){let e=1;const t=setInterval((()=>{var i;null!==(i=this.domElement)&&void 0!==i&&i.style?(e<=.1&&(clearInterval(t),this.domElement.style.display="none"),this.domElement.style.opacity=e,e-=.1*e):clearInterval(t)}),1)}show(){this.domElement&&(this.domElement.style.display="block",this.domElement.style.opacity=1,this.segments=this._getSegments(),this._step(1))}hide(){if(this.domElement){this._hide=e=>{this._stop(),e.model.is3d()?this._fadeOut():(this.domElement.style.opacity=0,this.domElement.style.display="none")};var e=this.viewer.impl.modelQueue().getModels();0===e.length?this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this._hide,{once:!0}):this._hide({model:e[0]})}}destroy(){var e;this._stop(),null!==(e=this.domElement)&&void 0!==e&&e.parentElement&&this.domElement.parentElement.removeChild(this.domElement),this.domElement=null,this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this._onResize)}_onResize(){var e;if(this._initResize)return void(this._initResize=!1);const t=this.domElement;if(!t)return;if("none"==t.style.display)return;const i=t.parentElement;if(!i)return;const r=i.getBoundingClientRect(),n=t.getBoundingClientRect(),o=Math.max(n.width/r.width,(n.height+350)/r.height),s=null===(e=this.domElement)||void 0===e||null===(e=e.style)||void 0===e?void 0:e.transform;if(s)if(o>.8){const e=/[-+]?scale\(\d*\.\d+|\d+\)/,t=e.exec(s);if(t.length>0){const i=t[0].split("scale(")[1],r=Number((i/o).toFixed(4)),n=s.replace(e,`scale(${r}`);n!=this.domElement.style.transform&&r<=.5&&r>.2&&(this.domElement.style.transform=n)}}else this.domElement.style.transform!=this._initTransform&&(this.domElement.style.transform=this._initTransform)}}O.GlobalManagerMixin.call(k.prototype);class V{constructor(){this.domElement=null}createDom(e){var t=this.getDocument(),i=t.createElement("div");i.className="spinner",e&&e.appendChild(i);for(var r=1;r<=3;r++){var n=t.createElement("div");n.className="bounce"+r,i.appendChild(n)}return this.domElement=i,this.hide(),i}show(){this.domElement&&(this.domElement.style.display="block")}hide(){this.domElement&&(this.domElement.style.display="None")}destroy(){this.domElement=null}}O.GlobalManagerMixin.call(V.prototype);var U=i(37765),B=i(27343);const G=Object.freeze({pdf:"Autodesk.PDF",scalaris:"Autodesk.Scalaris",dwf:"Autodesk.DWF",dwfx:"Autodesk.DWF",rcp:"Autodesk.ReCap",gltf:"Autodesk.glTF",glb:"Autodesk.glTF"});var z=i(36660),H=i(87312),W=i(52156),j=i(13908),q=i(32131),X=i(97790);var Y=i(70718);class K extends Y.Preferences{constructor(e,t){super(e,t);const i={[a.Prefs3D.VIEW_CUBE]:function(t){e.getExtension("Autodesk.ViewCubeUi",(function(e){e.displayViewCube(t)}))},[a.Prefs3D.ALWAYS_USE_PIVOT]:e.setUsePivotAlways.bind(e),[a.Prefs3D.ORBIT_PAST_WORLD_POLES]:e.setOrbitPastWorldPoles.bind(e),[a.Prefs3D.ZOOM_TOWARDS_PIVOT]:e.setZoomTowardsPivot.bind(e),[a.Prefs.REVERSE_MOUSE_ZOOM_DIR]:e.setReverseZoomDirection.bind(e),[a.Prefs.LEFT_HANDED_MOUSE_SETUP]:e.setUseLeftHandedInput.bind(e),[a.Prefs3D.CLICK_TO_SET_COI]:e.setClickToSetCOI.bind(e),[a.Prefs.ZOOM_DRAG_SPEED]:function(t){var i;const r=e.toolController.getTool("dolly");null==r||null===(i=r.setDollyDragScale)||void 0===i||i.call(r,t)},[a.Prefs.ZOOM_SCROLL_SPEED]:t=>{var i;const r=e.toolController.getTool("dolly");null==r||null===(i=r.setDollyScrollScale)||void 0===i||i.call(r,t)},[a.Prefs3D.ANTIALIASING]:t=>e.setQualityLevel(this.get("ambientShadows"),t),[a.Prefs3D.AMBIENT_SHADOWS]:t=>e.setQualityLevel(t,e.prefs.get("antialiasing")),[a.Prefs3D.GROUND_SHADOW]:e.setGroundShadow.bind(e),[a.Prefs3D.GROUND_REFLECTION]:e.setGroundReflection.bind(e),[a.Prefs2D.SWAP_BLACK_AND_WHITE]:e.setSwapBlackAndWhite.bind(e),[a.Prefs3D.OPTIMIZE_NAVIGATION]:e.setOptimizeNavigation.bind(e),[a.Prefs.PROGRESSIVE_RENDERING]:e.setProgressiveRendering.bind(e),[a.Prefs.GHOSTING]:e.setGhosting.bind(e),[a.Prefs3D.LINE_RENDERING]:t=>e.hideLines(!t),[a.Prefs.POINT_RENDERING]:t=>e.hidePoints(!t),[a.Prefs3D.EDGE_RENDERING]:e.setDisplayEdges.bind(e),[a.Prefs3D.ENV_MAP_BACKGROUND]:e.setEnvMapBackground.bind(e),[a.Prefs3D.LIGHT_PRESET]:e.setLightPreset.bind(e)};Object.keys(i).forEach((e=>{this.addListeners(e,i[e])}))}}const Q=Autodesk.Viewing;var Z=0;const J=["markups-svg","pushpin-container"];function $(e,t){if(this.setGlobalManager(new H.GlobalManager),e){if(this.clientContainer=e,this.container=this.getDocument().createElement("div"),this.container.classList.add("adsk-viewing-viewer"),this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add((0,n.isTouchDevice)()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=t||{},this.contextMenu=null,this.contextMenuCallbacks={},this.started=!1,this.theme=this.config.theme||"dark-theme",this.container.classList.add(this.theme),this.containerLayerOrder=this.config.containerLayerOrder||J,(0,n.isChrome)()&&this.container.classList.add("quality-text"),"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";if(this.canvasWrap=this.getDocument().createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=this.getDocument().createElement("canvas"),this.canvas.tabIndex=0,this.canvas.setAttribute("data-viewer-canvas","true"),this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),!(0,n.isPhoneFormFactor)()&&!Q.Private.DISABLE_FORGE_LOGO&&!Q.Private.DISABLE_FORGE_CANVAS_LOGO){const e=this.getDocument();this._forgeLogo=e.createElement("div"),this._forgeLogo.classList.add("forge-logo-canvas");const t=e.createElement("img");t.src=Autodesk.Viewing.Private.getResourceUrl("res/ui/powered-by-autodesk-oneline-blk-rgb.png"),this._forgeLogo.appendChild(t),this._forgeLogo.style.display="none",this.container.appendChild(this._forgeLogo)}this.canvas.viewer=this}var i=t&&t.localStoragePrefix||"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.";i.endsWith(".")||(i+=".");var r={prefix:i,localStorage:!(0,n.isNodeJS)()};this._displayEdges=null,this._setDoubleSided=null,this.prefs=new K(this,r),this.profile=null,this.profileManager=new c.ProfileManager,this._hotkeyManager=new v.HotkeyManager,this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=Z++,this.impl=new D.Viewer3DImpl(this.canvas,this),this.overlays=new z.OverlayManager(this.impl),this._loadingSpinner=Q.Private.DISABLE_FORGE_LOGO?new V:new k(this),this._loadingSpinner.setGlobalManager(this.globalManager),this.trackADPTimer=[]}function ee(e,t){return new Promise(((i,r)=>{var n=0;function o(t){2===n&&i({viewer:e,model:t})}e.addEventListener(S.GEOMETRY_LOADED_EVENT,(function i(s){s.model.getData().loadOptions.bubbleNode===t.bubbleNode&&(e.removeEventListener(S.GEOMETRY_LOADED_EVENT,i),n++,t.skipPropertyDb?o(s.model):s.model.getProperties(1,(()=>o(s.model)),(e=>r(e))))})),e.addEventListener(S.TEXTURES_LOADED_EVENT,(function i(r){r.model.getData().loadOptions.bubbleNode===t.bubbleNode&&(e.removeEventListener(S.TEXTURES_LOADED_EVENT,i),n++,o(r.model))}))}))}p.EventDispatcher.prototype.apply($.prototype),m.ScreenModeMixin.prototype.apply($.prototype),g.ExtensionMixin.prototype.apply($.prototype),O.GlobalManagerMixin.call($.prototype),$.prototype.constructor=$,Object.defineProperty($.prototype,"model",{get:function(){var e;return null===(e=this.impl)||void 0===e?void 0:e.model},set:function(){throw"Do not set viewer.model"}}),$.ViewerCount=0,$.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},Object.defineProperty($.prototype,"scene",{get:function(){return this.impl.scene},set:function(){throw"Do not set viewer.scene"}}),Object.defineProperty($.prototype,"sceneAfter",{get:function(){return this.impl.sceneAfter},set:function(){throw"Do not set viewer.sceneAfter"}}),$.createHeadlessViewer=function(){var e=new $;return e.impl.initialize(),e.impl.setLightPreset(0),e},$.prototype.start=function(e,t,i,r,n){if(this.started)return 0;this.started=!0;var o=this,s=o.initialize(n);return 0!==s?(r&&setTimeout((function(){r(s)}),0),s):(setTimeout((function(){o.setUp(o.config)}),0),e&&this.loadModel(e,t,i,r),0)},$.prototype.startWithDocumentNode=function(e,t,i){var r=this;return new Promise((function(n,o){if(r.started)return 0;r.started=!0;var s=r.initialize();0===s?(setTimeout((function(){r.setUp(r.config)}),0),r.loadDocumentNode(e,t,i).then(n).catch(o)):setTimeout((function(){o(s)}),0)}))},$.prototype.registerUniversalHotkeys=function(){var e,t,i,r=this;e=function(){return r.navigation.setRequestFitToView(!0),q.analytics.track("viewer.fit_to_view",{from:"Keyboard"}),!0},r._hotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[R.KeyCode.f],onPress:e}]),e=function(){return r.navigation.setRequestHomeView(!0),!0},r._hotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[R.KeyCode.h],onPress:e},{keycodes:[R.KeyCode.HOME],onPress:e}]),t=function(){return r.objectContextMenu&&r.objectContextMenu.hide()||r.dispatchEvent({type:S.ESCAPE_EVENT}),!0},r._hotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[R.KeyCode.ESCAPE],onRelease:t}]),e=function(){return i=r.getActiveNavigationTool(),r.setActiveNavigationTool("pan")},t=function(){return r.setActiveNavigationTool(i)};var n=[{keycodes:[R.KeyCode.SHIFT],onPress:e,onRelease:t},{keycodes:[R.KeyCode.SPACE],onPress:e,onRelease:t}];r._hotkeyManager.pushHotkeys("Autodesk.Pan",n,{tryUntilSuccess:!0})},$.prototype.createControls=function(){var e=this,t=e.impl;return e.navigation=new y.Navigation(t.camera),e.__initAutoCam(t),e.utilities=new x.ViewingUtilities(t,e.autocam,e.navigation),e.clickHandler=new _.DefaultHandler(t,e.navigation,e.utilities),e.toolController=new b.ToolController(t,e,e.autocam,e.utilities,e.clickHandler),e.toolController.registerTool(new E.GestureHandler(e)),e.toolController.registerTool(e._hotkeyManager),e.toolController.activateTool(e._hotkeyManager.getName()),e.registerUniversalHotkeys(),e.toolController.registerTool(new C.OrbitDollyPanTool(t,e,this.config.navToolsConfig),(e=>{e||this.setActiveNavigationTool()})),e.toolController.setModalityMap({section:{explode:!1,pan:!1,dolly:!1},explode:{section:!1,pan:!1,dolly:!1},measure:{"box-selection":!1},calibration:{"box-selection":!1},orbit:{},dolly:{},pan:{},fov:{},bimwalk:{},"box-selection":{measure:!1,calibration:!1}}),e.toolController},$.prototype.initialize=function(e){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var t=this.getDimensions();if(this.canvas.width=t.width,this.canvas.height=t.height,(0,n.isIOSDevice)()&&this.getWindow().devicePixelRatio&&(this.canvas.width/=this.getWindow().devicePixelRatio,this.canvas.height/=this.getWindow().devicePixelRatio),this.impl.initialize(e),!this.impl.glrenderer()){var i=function(){if(Q.getGlobal().WebGLRenderingContext){for(var e=Q.getGlobal().document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,r=0;r<4;r++)try{if((i=e.getContext(t[r]))&&"function"==typeof i.getParameter)return 1}catch(e){}return 0}return-1}();if(i<=0)return-1===i?d.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:d.ErrorCodes.BROWSER_WEBGL_DISABLED}var r,o=this;(0,n.isIOSDevice)()?this.onResizeCallback=function(){clearTimeout(r),r=setTimeout(o.resize.bind(o),500)}:this.onResizeCallback=function(){var e=o.impl.camera.clientWidth,t=o.impl.camera.clientHeight,i=o.container.clientWidth,r=o.container.clientHeight;e===i&&t===r||o.resize()};this.addWindowEventListener("resize",this.onResizeCallback),this.onPixelRatioChanged=()=>{var e;if(null===(e=o.impl)||void 0===e||!e.glrenderer())return;const t=o.getWindow().devicePixelRatio;matchMedia(`(resolution: ${t}dppx)`).addEventListener("change",o.onPixelRatioChanged,{once:!0}),o.impl.glrenderer().setPixelRatio(t),o.resize()},this.onPixelRatioChanged(),this.onScrollCallback=function(){o.impl.canvasBoundingclientRectDirty=!0},this.addWindowEventListener("scroll",this.onScrollCallback),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.initializePrefListeners(),this.setDefaultNavigationTool("orbit"),this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var s=this.config&&this.config.canvasConfig?this.config.canvasConfig:$.kDefaultCanvasConfig;this.setCanvasClickBehavior(s),s.disableSpinner||(this.loadSpinner=this._loadingSpinner.createDom(this.container)),this.viewerState=new T.ViewerState(this),this.config&&Object.prototype.hasOwnProperty.call(this.config,"startOnInitialize")&&!this.config.startOnInitialize||this.run();const a=Q.getGlobal();return a.NOP_VIEWER||(a.NOP_VIEWER=this),a.NOP_VIEWERS=a.NOP_VIEWERS||[],a.NOP_VIEWERS.push(this),this.addEventListener(S.MODEL_ADDED_EVENT,(function(e){o.onModelAdded(e.model,e.preserveTools)})),this.addEventListener(S.GEOMETRY_LOADED_EVENT,(function(e){var t;e.model.is2d()&&!e.model.isLeaflet()&&o.navigation.setMinimumLineWidth(null===(t=e.model.loader)||void 0===t||null===(t=t.svf)||void 0===t?void 0:t.minLineWidth);const i=e.model.getGeometryList();e.model.hasEdges=!1;for(let t=0;t<(null==i?void 0:i.getCount());t++){const r=i.getGeometry(t);if(r&&(r.isLine||r.iblines)){e.model.hasEdges=!0;break}}})),this.addEventListener(S.FRAGMENTS_LOADED_EVENT,(function(e){e.model.isConsolidated()&&(e.model.unconsolidate(!0,!0),this.impl.consolidateModel(e.model)),this.impl.invalidate(!0,!0)})),this.addEventListener(S.FRAGMENTS_UNLOADED_EVENT,(function(e){e.model.isConsolidated()?(e.model.unconsolidate(!0,!0),this.impl.consolidateModel(e.model)):e.model.chooseMemoryTypes(),this.impl.invalidate(!0,!0)})),this.dispatchEvent(S.VIEWER_INITIALIZED),this.trackADPSettingsOptions(),this.trackADPExtensionsLoaded(),$.ViewerCount++,0},$.prototype.setUp=function(e){var t;if(this.config=e||{},this.config.extensions=this.config.extensions||[],Array.isArray(this.config.extensions))for(var i=this.config.extensions,r=0;r<i.length;++r)this.loadExtension(i[r],this.config);"fedramp"===(null===(t=this.config.region)||void 0===t?void 0:t.toLowerCase())||this.loadExtension("Autodesk.Viewing.MixpanelExtension"),"true"===(0,u.getParameterByName)("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config);var n=this.config.canvasConfig||$.kDefaultCanvasConfig;this.setCanvasClickBehavior(n),this._onAggregatedSelectionChanged=this._onAggregatedSelectionChanged.bind(this),this.addEventListener(S.AGGREGATE_SELECTION_CHANGED_EVENT,this._onAggregatedSelectionChanged)},$.prototype.tearDown=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.clearSelection(),this.removeEventListener(S.AGGREGATE_SELECTION_CHANGED_EVENT,this._onAggregatedSelectionChanged),this.loadedExtensions){for(var t in this.loadedExtensions)try{this.unloadExtension(t)}catch(e){o.logger.error("Failed to unload extension: "+t,e,(0,d.errorCodeString)(d.ErrorCodes.VIEWER_INTERNAL_ERROR)),o.logger.track({category:"error_unload_extension",extensionId:t,error_message:e.message,call_stack:e.stack})}this.loadedExtensions=null}for(this.toolController&&(this.toolController.enableMouseButtons(!1),this.toolController.deactivateTool("gestures")),o.logger.reportRuntimeStats(!0),this._loadingSpinner.show(),this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null);this.trackADPTimer.length>0;)clearTimeout(this.trackADPTimer.pop());e&&this.impl.unloadCurrentModel(),this.impl.setCutPlaneSet("__set_view",void 0)},$.prototype._onAggregatedSelectionChanged=function(){if(this.navigation.getSelectionSetsPivot()){const e=this.impl.selector.getAggregateSelection();if(e.length){const t=this.impl.get3DBounds(e);this.utilities.setPivotPoint(t.getCenter(new r.Vector3),!0,!0),this.utilities.pivotActive(this.navigation.getPivotSetFlag(),!0)}}},$.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},$.prototype.localize=function(){A.Z.localize()},$.prototype.__initAutoCam=function(e){var t=this,i=e.camera;i.pivot||(i.pivot=new r.Vector3(0,0,0)),i.target||(i.target=new r.Vector3(0,0,0)),i.worldup||(i.worldup=i.up.clone()),t.autocamCamera=i.clone(),t.autocamCamera.target=i.target.clone(),t.autocamCamera.pivot=i.pivot.clone(),t.autocamCamera.worldup=i.worldup.clone(),t.autocam=new P.Autocam(t.autocamCamera,t.navigation,t.canvas),t.autocam.setGlobalManager(this.globalManager),t.autocam.registerCallbackCameraChanged((function(e){t.autocamCamera.isPerspective!==i.isPerspective&&(t.autocamCamera.isPerspective?t.navigation.toPerspective():t.navigation.toOrthographic()),t.navigation.setVerticalFov(t.autocamCamera.fov,!1),t.navigation.setView(t.autocamCamera.position,t.autocamCamera.target),t.navigation.setPivotPoint(t.autocamCamera.pivot),t.navigation.setCameraUpVector(t.autocamCamera.up),e&&t.navigation.setWorldUpVector(t.autocamCamera.worldup),t.impl.syncCamera(e)})),t.autocam.registerCallbackPivotDisplay((function(e){t.utilities?t.utilities.pivotActive(e,!1):t.impl.controls.pivotActive(e,!1)})),t.autocam.registerCallbackTransitionCompleted((function(){t.fireEvent({type:S.CAMERA_TRANSITION_COMPLETED})})),t.addEventListener("cameraChanged",(function(e){var i=e.camera;t.autocam.sync(i)})),t.autocam.sync(i)},$.prototype.uninitialize=function(){var e;this.removeWindowEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.removeWindowEventListener("scroll",this.onScrollCallback),this.onScrollCallback=null,this.canvas?this.canvas.removeEventListener("mousedown",this.onMouseDown):this.container&&this.container.removeEventListener("mousedown",this.onMouseDown),this.onMouseDown=null,this.canvas?this.canvas.removeEventListener("mouseup",this.onMouseUp):this.container&&this.container.removeEventListener("mouseup",this.onMouseUp),this.onMouseUp=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,D.InitParametersSetting.canvas===this.canvas&&(D.InitParametersSetting.canvas=null),this.canvas=null,this.canvasWrap=null,this.viewerState=null,o.logger.reportRuntimeStats(),o.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.overlays&&(this.overlays.dtor(),this.overlays=null),this.loadSpinner=null,this._loadingSpinner.destroy(),this._loadingSpinner=null,this.prefs&&this.prefs.clearListeners(),this.prefs=null,this.profile=null,this.profileManager=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,this._hotkeyManager.popHotkeys("Autodesk.FitToView"),this._hotkeyManager.popHotkeys("Autodesk.Home"),this._hotkeyManager.popHotkeys("Autodesk.Escape"),this._hotkeyManager.popHotkeys("Autodesk.Pan"),this._hotkeyManager.popHotkeys("Autodesk.Orbit"),this._hotkeyManager=null,$.ViewerCount--,0===$.ViewerCount&&(0,M.clearPropertyWorkerCache)(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this._displayEdges&&(this.removeEventListener(S.GEOMETRY_LOADED_EVENT,this._displayEdges),this._displayEdges=null),this._setDoubleSided&&(this.removeEventListener(S.MODEL_ADDED_EVENT,this._setDoubleSided),this._setDoubleSided=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.contextMenu=null,this.contextMenuCallbacks=null,this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this._forgeLogo=null,this.dispatchEvent(S.VIEWER_UNINITIALIZED),this.listeners={};const t=Q.getGlobal();t.NOP_VIEWER===this&&(t.NOP_VIEWER=null);const i=null===(e=t.NOP_VIEWERS)||void 0===e?void 0:e.indexOf(this);-1!==i&&(t.NOP_VIEWERS.splice(i,1),0===t.NOP_VIEWERS.length&&(t.NOP_VIEWERS=null)),o.logger.log("viewer destroy")},$.prototype.finish=function(){this.tearDown(),this.uninitialize()},$.prototype.setLoadHeuristics=function(e){var t=e.bubbleNode;if(t){var i=t.findViewableParent();if(i){var r=i.name();e.fileExt=r.slice(r.length-3).toLowerCase();void 0===e.isAEC&&-1!==["rvt","nwd","nwc","ifc"].indexOf(e.fileExt)&&(e.isAEC=!0)}}if(e.isAEC){if(void 0===e.useConsolidation){let t=(0,u.getParameterByName)("useConsolidation")||"";e.useConsolidation="true"===t||"false"!==t&&void 0}void 0===e.useConsolidation&&(e.useConsolidation=!(0,n.isMobileDevice)()&&!(0,n.isNodeJS)()),void 0===e.createWireframe&&(e.createWireframe=!(0,n.isMobileDevice)()),void 0===e.disablePrecomputedNodeBoxes&&(e.disablePrecomputedNodeBoxes=!0)}else void 0===e.createWireframe&&(e.createWireframe=!(0,n.isMobileDevice)()&&this.prefs.get("edgeRendering"));e.useConsolidation&&!e.bvhOptions&&(e.bvhOptions={},I.Consolidation.applyBVHDefaults(e.bvhOptions))},$.prototype.trackADPSettingsOptions=function(){var e=this;this.trackADPTimer.push(setTimeout((function(){if(e.prefs){var t={category:"settingOptionsStatus",switchSheetColorWhiteToBlack:e.prefs.get("swapBlackAndWhite"),leftHandedMouseSetup:e.prefs.get("leftHandedMouseSetup"),openPropertiesOnSelect:e.prefs.get("openPropertiesOnSelect"),orbitPastWorldPoles:e.prefs.get("orbitPastWorldPoles"),reverseMouseZoomDirection:e.prefs.get("reverseMouseZoomDir"),fusionStyleOrbit:e.prefs.get("fusionOrbit"),setPivotWithLeftMouseButton:e.prefs.get("clickToSetCOI"),zoomTowardPivot:e.prefs.get("zoomTowardsPivot"),viewCubeActsOnPivot:e.prefs.get("alwaysUsePivot"),showViewCube:e.prefs.get("viewCube"),environmentImageVisible:e.prefs.get("envMapBackground"),displayEdges:e.prefs.get("edgeRendering"),displayPoints:e.prefs.get("pointRendering"),displayLines:e.prefs.get("lineRendering"),ghostHiddenObjects:e.prefs.get("ghosting"),groundReflection:e.prefs.get("groundReflection"),groundShadow:e.prefs.get("groundShadow"),ambientShadows:e.prefs.get("ambientShadows"),antiAliasing:e.prefs.get("antialiasing"),progressiveModelDisplay:e.prefs.get("progressiveRendering"),smoothNavigation:e.prefs.get("optimizeNavigation")};o.logger.track(t)}}),3e4))},$.prototype.trackADPExtensionsLoaded=function(){var e=this,t={category:"loaded_extensions"};this.trackADPTimer.push(setTimeout((function(){if(e.loadedExtensions)for(var i in e.loadedExtensions)t[i]=i;o.logger.track(t)}),3e4))},$.prototype.activateDefaultNavigationTools=function(e){if(!(0,n.isNodeJS)()){var t=e?"pan":"orbit";this.setDefaultNavigationTool(t),this.setActiveNavigationTool(t),this.toolController&&(this.toolController.enableMouseButtons(!0),this.toolController.activateTool("gestures"))}},$.prototype.registerDimensionSpecificHotkeys=function(e){if(this._hotkeyManager)if(e)this._hotkeyManager.popHotkeys("Autodesk.Orbit");else{var t,i=this,r=[{keycodes:[R.KeyCode.ALT],onPress:function(){return t=i.getActiveNavigationTool(),i.setActiveNavigationTool("orbit")},onRelease:function(){return i.setActiveNavigationTool(t)}}];this._hotkeyManager.pushHotkeys("Autodesk.Orbit",r,{tryUntilSuccess:!0})}},$.prototype.onModelAdded=function(e,t){var i;e.is2d()&&!e.isLeaflet()&&this.navigation.setMinimumLineWidth(null===(i=e.loader)||void 0===i||null===(i=i.svf)||void 0===i?void 0:i.minLineWidth);1===this.impl.modelQueue().getModels().length&&this.initializeFirstModelPresets(e,t)},$.prototype.initializeFirstModelPresets=function(e,t,i){if(e.is2d()&&this.activateLayerState("Initial"),i||e.getData().loadOptions.preserveView||(this.setActiveNavigationTool(),this.impl.setViewFromFile(e,!0),this.toolController.recordHomeView()),this.registerDimensionSpecificHotkeys(e.is2d()),t||this.activateDefaultNavigationTools(e.is2d()),this.navigation.setIs2D(this.impl.modelQueue().areAll2D()),e.isLeaflet()){var r=e.getData();this.navigation.setConstraints2D(r.bbox,r.maxPixelPerUnit)}else this.navigation.setConstraints2D()},$.prototype.loadModel=async function(e,t,i,r,s){var c,p=this,f=p.impl._reserveLoadingFile();if(void 0===(t=t||{}).skipPropertyDb){var m=(0,u.getParameterByName)("skipPropertyDb")||"";t.skipPropertyDb="true"===m||"false"!==m&&void 0}function g(e,t,i){p._loadingSpinner.hide(),r&&r(e,t,i)}var v=e.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),y=v?v[1]:null,b=this.config&&this.config.loaderExtensions&&this.config.loaderExtensions[y]||y in G&&G[y];if(b&&!this.isExtensionLoaded(b))try{await this.loadExtension(b,this.config)}catch(e){return p.impl._removeLoadingFile(f),r&&r(d.ErrorCodes.VIEWER_INTERNAL_ERROR,e.toString()),!1}let x;if(x=t&&t.fileLoader?t.fileLoader:w.FileLoaderManager.getFileLoaderForExtension(y,t.mimeType),!x)return p.impl._removeLoadingFile(f),o.logger.error("File extension not supported:"+y,(0,d.errorCodeString)(d.ErrorCodes.UNSUPORTED_FILE_EXTENSION)),g(d.ErrorCodes.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0),!1;this.setLoadHeuristics(t),this.impl.hasModels()||this._loadingSpinner.show(),"function"==typeof x.getExistingInstance&&(c=x.getExistingInstance(e,t,this.config)),c||(c=new x(this.impl,this.config)),p.impl._addLoadingFile(f,c);var _=c.loadFile(e,t,(function(e,r){if(p.impl){if(p.impl._removeLoadingFile(c),e)return p.dispatchEvent({type:S.LOADER_LOAD_ERROR_EVENT,error:e,loader:c}),void g(e.code,e.msg,e.args);r.getData().underlayRaster=t.underlayRaster&&r.getLeaflet(),t.loadAsHidden?p.impl.modelQueue().addHiddenModel(r):p.impl.addModel(r),r.loader&&r.loader.notifiesFirstPixel&&p._loadingSpinner instanceof V?p.addEventListener(S.RENDER_FIRST_PIXEL,(function(){p._loadingSpinner.hide()}),{once:!0}):p._loadingSpinner.hide(),!(0,n.isNodeJS)()&&p._forgeLogo&&(p._forgeLogo.style.display="block"),i&&i(r)}}),s);if(_||p.impl._removeLoadingFile(c),this.fireEvent({type:S.LOADER_LOAD_FILE_EVENT,loader:c}),t.skipPrefs)void 0===this.prefs.get(a.Prefs.DISPLAY_UNITS)&&this.prefs.set(a.Prefs.DISPLAY_UNITS,new l.EnumType(h.displayUnitsEnum)),void 0===this.prefs.get(a.Prefs.DISPLAY_UNITS_PRECISION)&&this.prefs.set(a.Prefs.DISPLAY_UNITS_PRECISION,new l.EnumType(h.displayUnitsPrecisionEnum));else if(!(0,n.isNodeJS)()&&!this.profile){let e=this.chooseProfile(t);this.setProfile(e,!1)}const E=function(e,t,i,r){const n={url:e,lmvFileExtension:t,returnValue:i};if(r){n.isOtg=r.isOtg()&&X.endpoint.isOtgBackend(),n.isSVF2=r.isSVF2()&&X.endpoint.isSVF2Backend(),n.geometrySize=r.data.size||0,n.viewable_type=r.is2D()?"2d":"3d";const e=r.findViewableParent();try{const t=e&&e.name(),i=t&&t.lastIndexOf("."),r=i>=0&&t.substring(i+1);r&&(n.seedFileExt=r.toLowerCase())}catch(e){}}return n}(e,y,_,t.bubbleNode);return q.analytics.track("viewer.model.load",E),_},$.prototype.isLoadDone=function(){let{geometry:e=!0,propDb:t=!0,textures:i=!0,hidden:r=!1,onlyModels:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!n){if(!this.started)return!0;if(this.impl._hasLoadingFile())return!1}if(i&&Autodesk.Viewing.Private.TextureLoader.requestsInProgress()>0)return!1;e=e||i;const o=i=>!i||(e?i.isLoadDone():i.modelRootLoaded)&&(!t||!i.getPropertyDb()||i.getPropertyDb().isLoadDone());if(n)return Array.isArray(n)?n.every(o):o(n);const s=this.impl.modelQueue();return s.getModels().every(o)&&(!r||s.getHiddenModels().every(o))},$.prototype.waitForLoadDone=function(e){return new Promise(((t,i)=>{var{geometry:r=!0,propDb:n=!0,textures:o=!0,hidden:s=!1,onlyModels:a}=e||{};const l={geometry:r=r||o,propDb:n,textures:o,hidden:s,onlyModels:a},h=()=>this.started&&(this.impl._hasLoadingFile()||this.impl.modelQueue().getModels().length>0||this.impl.modelQueue().getHiddenModels().length>0);var c,u=!a&&h();if(u&&this.isLoadDone(l))return void t();const d=()=>{(u=u||h())&&this.isLoadDone(l)&&(c(),t())},p=e=>{c();const t=new Error("Error loading model");t.loader=e.loader,t.error=e.error,i(t)};c=()=>{r&&this.removeEventListener(S.GEOMETRY_LOADED_EVENT,d),n&&(this.removeEventListener(S.OBJECT_TREE_CREATED_EVENT,d),this.removeEventListener(S.OBJECT_TREE_UNAVAILABLE_EVENT,d)),o&&this.removeEventListener(S.TEXTURES_LOADED_EVENT,d),this.removeEventListener(S.LOADER_LOAD_FILE_EVENT,d),this.removeEventListener(S.MODEL_ADDED_EVENT,d),this.removeEventListener(S.MODEL_REMOVED_EVENT,d),this.removeEventListener(S.LOADER_LOAD_ERROR_EVENT,p),this.removeEventListener(S.MODEL_ROOT_LOADED_EVENT,d),this.removeEventListener(S.VIEWER_UNINITIALIZED,t)},r&&this.addEventListener(S.GEOMETRY_LOADED_EVENT,d),n&&(this.addEventListener(S.OBJECT_TREE_CREATED_EVENT,d),this.addEventListener(S.OBJECT_TREE_UNAVAILABLE_EVENT,d)),o&&this.addEventListener(S.TEXTURES_LOADED_EVENT,d),this.addEventListener(S.LOADER_LOAD_FILE_EVENT,d),this.addEventListener(S.MODEL_ADDED_EVENT,d),this.addEventListener(S.MODEL_REMOVED_EVENT,d),this.addEventListener(S.LOADER_LOAD_ERROR_EVENT,p),this.addEventListener(S.MODEL_ROOT_LOADED_EVENT,d,{priority:-1e6}),this.addEventListener(S.VIEWER_UNINITIALIZED,(()=>i(new Error("Promise reject because viewer finished"))))}))},$.prototype.unloadModel=function(e){e||(e=this.model),this.impl.unloadModel(e)},$.prototype.loadDocumentNode=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=i.leafletOptions||{};let n=e.getViewableUrn(t,r),o=t.findPropertyDbPath();n=e.getFullPath(n),o=e.getFullPath(o);const s={sharedPropertyDbPath:o,acmSessionId:e.getAcmSessionId(n),bubbleNode:t,applyRefPoint:!1,loadOptions:r,page:r.page||1};for(var a in s)Object.prototype.hasOwnProperty.call(i,a)||(i[a]=s[a]);if(!i.keepCurrentModels&&this.impl.hasModels()){let e=this.config;this.tearDown(),this.setUp(e)}const l=t.findParentGeom2Dor3D(),h=null==l?void 0:l.extensions();Array.isArray(h)&&h.forEach((e=>{this.loadExtension(e,this.config)}));const c=r.isPdf?this.loadExtension("Autodesk.PDF",this.config):Promise.resolve(),u=!i.disableUnderlayRaster&&r.tempRasterPath,d=u?this._loadTempRasterModel(e,i,t):Promise.resolve();return c.then((()=>d)).then((e=>new Promise(((r,o)=>{u&&e&&e!==this.getUnderlayRaster(t)?o("load canceled"):this.loadModel(n,i,(e=>{i.loadAsHidden||i.preserveView||"view"!==t.type()||this.setView(t,{skipTransition:!0}),r(e)}),(e=>{o(e)}))}))))},$.prototype.unloadDocumentNode=function(e){let t=this.impl.findModel(e,!0);if(t)return this.impl.unloadModel(t),!0;if(!this.impl.loaders)return!1;for(let t=0;t<this.impl.loaders.length;t++){let i=this.impl.loaders[t];if((i.options&&i.options.bubbleNode)===e)return i.dtor(),this.impl.loaders.splice(t,1),!0}return!1},$.prototype._loadTempRasterModel=function(e,t,i){return new Promise(((r,n)=>{if(t.loadAsHidden)return r();t.underlayRaster=!0,t.loadOptions.fitPaperSize=!0;const o=e=>{var t,r;const n=e.getDocumentNode();return n&&(null===(t=n.getDocument())||void 0===t?void 0:t.getPath())===(null===(r=i.getDocument())||void 0===r?void 0:r.getPath())&&n.guid()===i.guid()&&!e.isLeaflet()},s=e=>{let{model:t}=e;o(t)&&(2===this.getVisibleModels().length&&this.initializeFirstModelPresets(t,!1,!0),this.removeEventListener(S.MODEL_ADDED_EVENT,s))};this.addEventListener(S.MODEL_ADDED_EVENT,s);const a=e=>{let{model:t}=e;o(t)&&(t.changePaperVisibility(!0),this.removeEventListener(S.MODEL_REMOVED_EVENT,a),this.removeEventListener(S.MODEL_ADDED_EVENT,s),this.removeEventListener(S.GEOMETRY_LOADED_EVENT,h))};let l;this.addEventListener(S.MODEL_REMOVED_EVENT,a);const h=e=>{let{model:t}=e;o(t)&&(t.changePaperVisibility(!0),this.removeEventListener(S.MODEL_REMOVED_EVENT,a),l&&(this.unloadModel(l),l=null),this.removeEventListener(S.GEOMETRY_LOADED_EVENT,h))};this.addEventListener(S.GEOMETRY_LOADED_EVENT,h);const c=e.getFullPath(t.loadOptions.tempRasterPath);this.loadModel(c,t,(e=>{t.loadOptions.fitPaperSize=void 0,t.underlayRaster=void 0,t.hideBackground=!0,l=e,r(e)}),(e=>{if(t.loadOptions.fitPaperSize=void 0,t.underlayRaster=void 0,e===d.ErrorCodes.LOAD_CANCELED)return n("load canceled");r()}))}))},$.prototype.getDimensions=function(){if(this.container){var e={};return this.getScreenMode()===m.ScreenMode.kFullScreen?(e.width=screen.width,e.height=screen.height):e=this.container.getBoundingClientRect(),{width:e.width,height:e.height}}return null},$.prototype.resize=function(){this.container.clientWidth>0&&this.container.clientHeight>0&&this.impl.resize(this.container.clientWidth,this.container.clientHeight)},$.prototype.getHotkeyManager=function(){return this._hotkeyManager},$.prototype.getCamera=function(){return this.impl.camera},$.prototype.getState=function(e){return this.viewerState.getState(e)},$.prototype.restoreState=function(e,t,i){var r=this.viewerState.restoreState(e,t,i);return r&&this.dispatchEvent({type:S.VIEWER_STATE_RESTORED_EVENT,value:r}),r},$.prototype.getViewpointCamData=function(e){const t=e.position,i=e.target,r=e.up,n=e.isPerspective?0:1;return[t.x,t.y,t.z,i.x,i.y,i.z,r.x,r.y,r.z,e.aspect,e.fov*(Math.PI/180),e.orthoScale,n]},$.prototype.setView=function(e,t){var i,n;if(!(e&&e instanceof L.BubbleNode))return!1;const o=e.findParentGeom2Dor3D();let s=o&&this.impl.findModel(o,!0)||this.model;if(!s)return!1;let a,l=!!t&&t.skipTransition,h=!t||t.useExactCamera,c=!!t&&t.skipViewpointExtra;if(e.getViewBox())return this.setViewFromViewBox(e.getViewBox(),e.name(),l),this.dispatchEvent({type:S.SET_VIEW_EVENT,view:e}),!0;let u,d,p,f=null===(i=s.loader)||void 0===i?void 0:i.svf,m=e.data.isViewpoint&&f?null===(n=f.viewpoints)||void 0===n?void 0:n[e.data.entry]:null,g=e.data.camera,v=s.isOTG(),y=s.isConsolidated();if(!c&&m){const e=m.camera;g=this.getViewpointCamData(e);const t=f.overrideSets[m.overrideSet];if(t){const{defaultMaterialIndex:e,materialOverrides:i,flagOverrides:r,defaultFlags:n}=t,o=s.getFragmentList(),a=o.fragments.length;if(o.materialIdMapOriginal||o.storeOriginalMaterials(),(e||i)&&y&&s.unconsolidate(!1,!0),e){const t=v?f.getMaterialHash(e):this.impl.matman()._getMaterialHash(s,e),i=this.impl.matman()._materials[t];if(i)for(let e=0;e<a;e++)this.model.getFragmentList().setMaterial(e,i)}if(i){e||s.getFragmentList().restoreOriginalMaterials();for(let e=0;e<i.length;e++){const t=i[e].dbId,r=i[e].materialIndex;if(!Number.isFinite(t)||!Number.isFinite(r))continue;const n=v?f.getMaterialHash(r):this.impl.matman()._getMaterialHash(s,r),o=this.impl.matman()._materials[n];o&&s.getInstanceTree().enumNodeFragments(t,(e=>{s.getFragmentList().setMaterial(e,o)}),!0)}}if(n&&(1===n?this.hideAll():2===n&&this.showAll()),r)if(0===r.length)this.showAll();else for(let e=0;e<r.length;e++){const{flags:t,dbId:i}=r[e];Number.isFinite(t)&&Number.isFinite(i)&&(1===t?this.hide(i,s):2===t&&this.show(i,s))}y&&!s.isConsolidated()&&(this.impl.consolidateModel(s),this.impl.invalidate(!0,!0))}}if(a=this.getCameraFromViewArray(g,s),!a)return!1;this.impl.setViewFromCamera(a,l,h);const b=m??e.data;u=b.sectionPlane,d=b.sectionBox,p=b.sectionBoxTransform;const x=s.getModelToViewerTransform();if(u){let e=[];for(let t=0;t<u.length;t+=4){const i=new r.Plane(new r.Vector3(u[t+0],u[t+1],u[t+2]),u[t+3]);x&&i.applyMatrix4(x),e.push(new r.Vector4(i.normal.x,i.normal.y,i.normal.z,i.constant))}this.impl.setCutPlaneSet("__set_view",e)}else if(d&&p){let t;if(e.data.isViewpoint){const e=new r.Box3;e.set(d.min,d.max);const i=e.max.clone().sub(e.min),n=(new r.Matrix4).compose(e.getCenter(),new r.Quaternion(p.x,p.y,p.z,p.w),new r.Vector3(i.x,i.y,i.z)),o=(new r.Matrix4).copy(x).multiply(n);t=U.SceneMath.box2CutPlanes(new r.Box3(new r.Vector3(-.5,-.5,-.5),new r.Vector3(.5,.5,.5)),o)}else{const e=(new r.Matrix4).fromArray([p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15]]);let i=new r.Vector3(d[0],d[1],d[2]),n=new r.Vector3(d[3],d[4],d[5]),o=new r.Box3(i,n);const s=new r.Matrix4;x&&s.copy(x),s.multiply(e),t=U.SceneMath.box2CutPlanes(o,s)}this.impl.setCutPlaneSet("__set_view",t)}else this.impl.setCutPlaneSet("__set_view",void 0);return this.dispatchEvent({type:S.SET_VIEW_EVENT,view:e}),!0},$.prototype.setViewType=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setViewType is not applicable to 2D"):this.prefs.set(a.Prefs3D.VIEW_TYPE,e)},$.prototype.setViewFromArray=function(e){var t=this.getCameraFromViewArray(e);this.impl.setViewFromCamera(t,!1,!0)},$.prototype.getCameraFromViewArray=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.model;const i=null==t?void 0:t.getModelToViewerTransform();return L.BubbleNode.readCameraFromArray(e,i)},$.prototype.getViewArrayFromCamera=function(){var e=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0};return this.impl.getViewArrayFromCamera(e)},$.prototype.setViewFromViewBox=function(e,t,i){var r=this.model;if(!r||r.is2d()){if(t&&t.length){var n,s=r.getData().metadata.views||[];for(n=0;n<s.length&&s[n].name!=t;n++);if(n<s.length){var a=s[n].layer_state;a&&this.activateLayerState(a)}}this.impl.setViewFromViewBox(this.model,e,t,i)}else o.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D")},$.prototype.activateLayerState=function(e){this.impl.layers.activateLayerState(e),this.dispatchEvent({type:S.LAYER_VISIBILITY_CHANGED_EVENT})},$.prototype.getLayerStates=function(){return this.impl.layers.getLayerStates()},$.prototype.setViewFromFile=function(e){this.setActiveNavigationTool(),this.impl.setViewFromFile(e||this.model)},$.prototype.getProperties=function(e,t,i){this.model?this.model.getProperties(e,t,i):i&&i(d.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},$.prototype.getObjectTree=function(e,t){this.model?this.model.getObjectTree(e,t):t&&t(d.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},$.prototype.setCanvasClickBehavior=function(e){if(Object.prototype.hasOwnProperty.call(this.impl.controls,"setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures");t&&t.disableTwoFingerSwipe()}},$.prototype.search=function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{searchHidden:!1};this.searchText=e,this.model?this.model.search(e,t,i,r,n):i&&i(d.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},$.prototype.getHiddenNodes=function(e){return e=e||this.model,this.impl.visibilityManager.getHiddenNodes(e)},$.prototype.getIsolatedNodes=function(e){return(e=e||this.model)&&e.is2d()?(o.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes(e)},$.prototype.isolate=function(e,t){(t=t||this.model)&&this.impl.visibilityManager.isolate(e,t)},$.prototype.setBackgroundColor=function(e,t,i,r,n,o){this.impl.setClearColors(e,t,i,r,n,o)},$.prototype.setBackgroundOpacity=function(e){this.impl.setClearAlpha(e)},$.prototype.toggleSelect=function(e,t,i){(t=t||this.model)&&t.is2d()?o.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D"):this.impl.selector.toggleSelection(e,t,i)},$.prototype.select=function(e,t,i){"number"==typeof e&&(e=[e]),t=t||this.model,this.impl.selector.setSelection(e,t,i)},$.prototype.clearSelection=function(){this.impl.selector.clearSelection()},$.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},$.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},$.prototype.setSelectionMode=function(e){this.prefs.set(a.Prefs3D.SELECTION_MODE,e)},$.prototype.getSelection=function(){return this.impl.selector.getSelection()},$.prototype.lockSelection=function(e,t,i){i=i||this.model,this.impl.selector.lockSelection(e,t,i)},$.prototype.unlockSelection=function(e,t){this.impl.selector.unlockSelection(e,t)},$.prototype.isSelectionLocked=function(e,t){return this.impl.selector.isNodeSelectionLocked(e,t)},$.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection();if(e)for(var i=0;i<t.length;i++)for(var r=0;r<t[i].selection.length;r++)e(t[i].model,t[i].selection[r]);return t},$.prototype.setAggregateSelection=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.impl.selector.setAggregateSelection(e,t)},$.prototype.getAggregateIsolation=function(){return this.impl.visibilityManager.getAggregateIsolatedNodes()},$.prototype.getAggregateHiddenNodes=function(){return this.impl.visibilityManager.getAggregateHiddenNodes()},$.prototype.hide=function(e,t){t=t||this.model,this.impl.visibilityManager.hide(e,t)},$.prototype.show=function(e,t){t=t||this.model,this.impl.visibilityManager.show(e,t)},$.prototype.showAll=function(){this.impl.visibilityManager.aggregateIsolate([]),this.impl.layers.showAllLayers(),this.fireEvent({type:S.SHOW_ALL_EVENT})},$.prototype.hideAll=function(){this.getVisibleModels().forEach((e=>{this.hide(e.getRootId(),e)})),this.fireEvent({type:S.HIDE_ALL_EVENT})},$.prototype.toggleVisibility=function(e,t){this.impl.visibilityManager.toggleVisibility(e,t)},$.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},$.prototype.isNodeVisible=function(e,t){return t=t||this.model,this.impl.isNodeVisible(e,t)},$.prototype.lockVisible=function(e,t,i){i=i||this.model,this.impl.visibilityManager.lockNodeVisible(e,t,i)},$.prototype.toggleLockVisible=function(e,t){this.impl.visibilityManager.toggleVisibleLocked(e,t)},$.prototype.isVisibleLocked=function(e,t){return this.impl.visibilityManager.isNodeVisibleLocked(e,t)},$.prototype.explode=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.model&&(this.model.is2d()?o.logger.warn("Viewer3D.explode is not applicable to 2D"):this.impl.explode(e,t)&&o.logger.track({name:"explode_count",aggregate:"count"}))},$.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(o.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},$.prototype.getExplodeOptions=function(){return this.model&&this.model.is2d()?(o.logger.warn("Viewer3D.getExplodeOptions is not applicable to 2D"),0):this.impl.getExplodeOptions()},$.prototype.lockExplode=function(e,t,i){return(i=i||this.model)&&i.is2d()?(o.logger.warn("Viewer3D.lockExplode is not applicable to 2D"),0):this.impl.lockExplode(e,t,i)},$.prototype.isExplodeLocked=function(e,t){return(t=t||this.model)&&t.is2d()?(o.logger.warn("Viewer3D.isExplodeLocked is not applicable to 2D"),0):this.impl.isExplodeLocked(e,t)},$.prototype.toggleLockExplode=function(e,t){return(t=t||this.model)&&t.is2d()?(o.logger.warn("Viewer3D.toggleLockExplode is not applicable to 2D"),0):this.impl.lockExplode(e,!this.isExplodeLocked(e,t),t)},$.prototype.setQualityLevel=function(e,t){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set(a.Prefs3D.AMBIENT_SHADOWS,e),this.prefs.set(a.Prefs3D.ANTIALIASING,t))},$.prototype.setGhosting=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGhosting is not applicable to 2D"):this.prefs.set(a.Prefs3D.GHOSTING,e)},$.prototype.setGroundShadow=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"):this.prefs.set(a.Prefs3D.GROUND_SHADOW,e)},$.prototype.setGroundReflection=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"):this.prefs.set(a.Prefs3D.GROUND_REFLECTION,e)},$.prototype.setEnvMapBackground=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"):this.prefs.set(a.Prefs3D.ENV_MAP_BACKGROUND,e)},$.prototype.setFirstPersonToolPopup=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D"):this.prefs.set(a.Prefs3D.FIRST_PERSON_TOOL_POPUP,e)},$.prototype.getFirstPersonToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.get("firstPersonToolPopup");o.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D")},$.prototype.setBimWalkToolPopup=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setBimWalkToolPopup is not applicable to 2D"):this.prefs.set(a.Prefs3D.BIM_WALK_TOOL_POPUP,e)},$.prototype.getBimWalkToolPopup=function(){if(!this.model||!this.model.is2d())return this.prefs.get("bimWalkToolPopup");o.logger.warn("Viewer3D.getBimWalkToolPopup is not applicable to 2D")},$.prototype.setProgressiveRendering=function(e){this.prefs.set(a.Prefs.PROGRESSIVE_RENDERING,e)},$.prototype.setGrayscale=function(e){this.model&&this.model.is3d()?o.logger.warn("Viewer3D.setGrayscale is not applicable to 3D"):this.prefs.set(a.Prefs2D.GRAYSCALE,e)},$.prototype.setSwapBlackAndWhite=function(e){this.model&&this.model.is3d()?o.logger.warn("Viewer3D.setSwapBlackAndWhite is not applicable to 3D"):this.prefs.set(a.Prefs2D.SWAP_BLACK_AND_WHITE,e)},$.prototype.setOptimizeNavigation=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"):this.prefs.set(a.Prefs3D.OPTIMIZE_NAVIGATION,e)},$.prototype.initializePrefListeners=function(){var e=this;this.prefs.addListeners(a.Prefs.KEY_MAP_CMD,(e=>{this.impl.toggleCmdMapping(e,this.toolController)})),this.prefs.addListeners(a.Prefs3D.ANTIALIASING,(e=>{const t=this.prefs.get(a.Prefs3D.AMBIENT_SHADOWS);this.impl.togglePostProcess(t,e)})),this.prefs.addListeners(a.Prefs3D.AMBIENT_SHADOWS,(e=>{const t=this.prefs.get(a.Prefs3D.ANTIALIASING);this.impl.togglePostProcess(e,t)})),this.prefs.addListeners(a.Prefs3D.GROUND_SHADOW,(e=>{this.impl.toggleGroundShadow(e)})),this.prefs.addListeners(a.Prefs3D.GROUND_REFLECTION,(e=>{this.impl.toggleGroundReflection(e)})),this.prefs.addListeners(a.Prefs3D.ENV_MAP_BACKGROUND,(e=>{this.impl.toggleEnvMapBackground(e)})),this.prefs.addListeners(a.Prefs.PROGRESSIVE_RENDERING,(e=>{this.impl.toggleProgressive(e)})),this.prefs.addListeners(a.Prefs3D.VIEW_TYPE,(e=>{const t=this.prefs.get(a.Prefs3D.VIEW_TYPE),i=this.impl.getModelCamera(this.model);if(i){const e=i.isPerspective;if(!isNaN(e)){const i=e?a.VIEW_TYPES.PERSPECTIVE:a.VIEW_TYPES.ORTHOGRAPHIC;this.prefs.setDefault(a.Prefs3D.VIEW_TYPE,i),t===a.VIEW_TYPES.DEFAULT&&(this.prefs[a.Prefs3D.VIEW_TYPE]=i)}}this.autocam.setViewType(e)})),this.prefs.addListeners(a.Prefs2D.GRAYSCALE,(e=>{this.impl.toggleGrayscale(e)})),this.prefs.addListeners(a.Prefs2D.SWAP_BLACK_AND_WHITE,(e=>{this.impl.toggleSwapBlackAndWhite(e)})),this.prefs.addListeners(a.Prefs3D.OPTIMIZE_NAVIGATION,(e=>{this.impl.setOptimizeNavigation(e)})),this.prefs.addListeners(a.Prefs3D.GHOSTING,(e=>{this.impl.toggleGhosting(e)})),this.prefs.addListeners(a.Prefs3D.LINE_RENDERING,(e=>{this.impl.hideLines(!e)})),this.prefs.addListeners(a.Prefs.POINT_RENDERING,(e=>{this.impl.hidePoints(!e)})),this.prefs.addListeners(a.Prefs3D.EDGE_RENDERING,(e=>{this._displayEdges=()=>{this.impl.setDisplayEdges(e)},e||this.model&&this.model.isLoadDone()?this._displayEdges():this.addEventListener(S.GEOMETRY_LOADED_EVENT,this._displayEdges)})),this.prefs.addListeners(a.Prefs3D.LIGHT_PRESET,(e=>{let t=!1;if("string"==typeof e){for(var i=e,r=-1,n=0;n<W.LightPresets.length;n++)if(W.LightPresets[n].name===i){r=n;break}-1===r&&(o.logger.warn("Invalid Prefs3D.LIGHT_PRESET: "+e),o.logger.warn("Setting to default light preset."),t=!0),e=r}this.impl.setLightPreset(e,t)})),this.prefs.addListeners(a.Prefs3D.ALWAYS_USE_PIVOT,(e=>{this.navigation.setUsePivotAlways(e)})),this.prefs.addListeners(a.Prefs.REVERSE_MOUSE_ZOOM_DIR,(e=>{this.navigation.setReverseZoomDirection(e)})),this.prefs.addListeners(a.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION,(e=>{this.navigation.setReverseHorizontalLookDirection(e)})),this.prefs.addListeners(a.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION,(e=>{this.navigation.setReverseVerticalLookDirection(e)})),this.prefs.addListeners(a.Prefs3D.ZOOM_TOWARDS_PIVOT,(e=>{this.navigation.setZoomTowardsPivot(e)})),this.prefs.addListeners(a.Prefs3D.SELECTION_SETS_PIVOT,(e=>{this.navigation.setSelectionSetsPivot(e)})),this.prefs.addListeners(a.Prefs3D.ORBIT_PAST_WORLD_POLES,(e=>{this.navigation.setOrbitPastWorldPoles(e)})),this.prefs.addListeners(a.Prefs.LEFT_HANDED_MOUSE_SETUP,(e=>{this.navigation.setUseLeftHandedInput(e),f.EventUtils.setUseLeftHandedInput(e)})),this.prefs.addListeners(a.Prefs.WHEEL_SETS_PIVOT,(e=>{this.navigation.setWheelSetsPivot(e)})),this.prefs.addListeners(a.Prefs3D.SELECTION_MODE,(e=>{this.impl.selector.setSelectionMode(e)})),this.prefs.addListeners(a.Prefs.BACKGROUND_COLOR_PRESET,(e=>{if(e)try{var t=JSON.parse(e);this.impl.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5])}catch(e){o.logger.warn("Invalid Prefs.BACKGROUND_COLOR_PRESET: "+t)}})),this.prefs.addListeners(a.Prefs3D.EXPLODE_STRATEGY,(e=>{j.i.setStrategy(e)&&this.impl.refreshExplode()})),this.prefs.addListeners(a.Prefs2D.LOADING_ANIMATION,(e=>{this.impl.onLoadingAnimationChanged(e)}));const t={};this.prefs.addListeners(a.Prefs3D.FORCE_DOUBLE_SIDED,(i=>{this._setDoubleSided=function(r){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=r.model,s=function(e){return"boolean"==typeof i?i:!!i[e.id]}(o);const a=o.getData();Object.prototype.hasOwnProperty.call(t,o.id)||(t[o.id]=!!a.doubleSided);const l=s||!!a.doubleSided;l!==t[o.id]&&(e.impl.setDoubleSided(l,o,n),t[o.id]=l)};var r=this.impl.modelQueue().getModels();0===r.length?this.addEventListener(S.MODEL_ADDED_EVENT,this._setDoubleSided):(r.forEach((e=>{this._setDoubleSided({model:e},!1)})),this.impl.sceneUpdated())}))},$.prototype.setNavigationLock=function(e){const t=this.navigation.getIsLocked();return t!==e&&(this.navigation.setIsLocked(e),this.dispatchEvent({type:S.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})),t},$.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},$.prototype.setNavigationLockSettings=function(e){this.navigation.setLockSettings(e),this.dispatchEvent({type:S.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},$.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},$.prototype.setActiveNavigationTool=function(e){if(e===this._pushedTool||!e&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return(!e||e===this.getDefaultNavigationToolName())&&null===this._pushedTool?(this.dispatchEvent({type:S.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0):!!this.impl.controls.activateTool(e)&&(this._pushedTool=e,this.dispatchEvent({type:S.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0)},$.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},$.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool);var t=this._pushedTool;this._pushedTool=null,t&&this.impl.controls.deactivateTool(t),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,t&&(this.impl.controls.activateTool(t),this._pushedTool=t)},$.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},$.prototype.getFOV=function(){return this.navigation.getVerticalFov()},$.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},$.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},$.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},$.prototype.hideLines=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.hideLines is not applicable to 2D"):this.prefs.set(a.Prefs3D.LINE_RENDERING,!e)},$.prototype.hidePoints=function(e){this.prefs.set(a.Prefs.POINT_RENDERING,!e)},$.prototype.setDisplayEdges=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setDisplayEdges is not applicable to 2D"):this.prefs.set(a.Prefs3D.EDGE_RENDERING,e)},$.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},$.prototype.fitToView=function(e,t,i){var r=[];e&&(e.length>0&&e[0].model?r=e:e.length>0&&r.push({model:t||this.model,selection:e})),this.impl.fitToView(r,i)},$.prototype.setClickConfig=function(e,t,i){var r=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in r){var n=r[e];if(t in n)return n[t]=i,!0}return!1},$.prototype.getClickConfig=function(e,t){var i=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in i){var r=i[e];if(t in r)return r[t]}return null},$.prototype.setClickToSetCOI=function(e,t){!1!==t&&this.prefs.set(a.Prefs3D.CLICK_TO_SET_COI,e);var i=this.getClickConfig("click","onObject");e?-1===i.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):i.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},$.prototype.setProfile=function(e,t){if(!e)return!1;this.profile=e,this.profile.apply(this.prefs,t);const i=this.profile.extensions&&this.profile.extensions.unload||[],r=this.profile.extensions&&this.profile.extensions.load||[];i.forEach((e=>{this.isExtensionLoaded(e)&&this.unloadExtension(e)})),r.forEach((e=>{this.isExtensionLoaded(e)||this.loadExtension(e,this.config)})),this.dispatchEvent({type:Autodesk.Viewing.PROFILE_CHANGE_EVENT,profile:e})},$.prototype.initSettings=function(e){if(!this.profile){const t=new s.Profile(e);this.setProfile(t)}},$.prototype.setLightPreset=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setLightPreset is not applicable to 2D"):this.prefs.set(a.Prefs3D.LIGHT_PRESET,e)},$.prototype.setUsePivotAlways=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setUsePivotAlways is not applicable to 2D"):this.prefs.set(a.Prefs3D.ALWAYS_USE_PIVOT,e)},$.prototype.setReverseZoomDirection=function(e){this.prefs.set(a.Prefs.REVERSE_MOUSE_ZOOM_DIR,e)},$.prototype.setReverseHorizontalLookDirection=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):this.prefs.set(a.Prefs3D.REVERSE_HORIZONTAL_LOOK_DIRECTION,e)},$.prototype.setReverseVerticalLookDirection=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):this.prefs.set(a.Prefs3D.REVERSE_VERTICAL_LOOK_DIRECTION,e)},$.prototype.setZoomTowardsPivot=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setZoomTowardsPivot is not applicable to 2D"):this.prefs.set(a.Prefs3D.ZOOM_TOWARDS_PIVOT,e)},$.prototype.setOrbitPastWorldPoles=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):this.prefs.set(a.Prefs3D.ORBIT_PAST_WORLD_POLES,e)},$.prototype.setUseLeftHandedInput=function(e){this.prefs.set(a.Prefs.LEFT_HANDED_MOUSE_SETUP,e)},$.prototype.setDisplayUnits=function(e){this.prefs.set(a.Prefs.DISPLAY_UNITS,e)},$.prototype.setDisplayUnitsPrecision=function(e){null==e&&(e=""),this.prefs.set(a.Prefs.DISPLAY_UNITS_PRECISION,e)},$.prototype.setLayerVisible=function(e,t,i){var r=this.impl.layers;null===e?t?r.showAllLayers():r.hideAllLayers():(Array.isArray(e)||(e=[e]),i&&r.hideAllLayers(),this.impl.setLayerVisible(e,t)),this.dispatchEvent({type:S.LAYER_VISIBILITY_CHANGED_EVENT})},$.prototype.isLayerVisible=function(e){return!!(e&&e.isLayer&&this.impl.isLayerVisible(e))},$.prototype.anyLayerHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,i=t?t.length:0,r=0;r<i;++r)if(!this.impl.layers.isLayerVisible(t[r]))return!0;return!1},$.prototype.allLayersHidden=function(){for(var e=this.impl.getLayersRoot(),t=e&&e.children,i=t?t.length:0,r=0;r<i;++r)if(this.impl.layers.isLayerVisible(t[r]))return!1;return!0},$.prototype.hideHiddenObjects=function(){let e=this.impl.model;this.impl.handleInitialVisibility(e),q.analytics.track("viewer.hideHiddenObjects",{})},$.prototype.setGroundShadowColor=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"):this.impl.setGroundShadowColor(e)},$.prototype.setGroundShadowAlpha=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"):this.impl.setGroundShadowAlpha(e)},$.prototype.setGroundReflectionColor=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"):this.impl.setGroundReflectionColor(e)},$.prototype.setGroundReflectionAlpha=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):this.impl.setGroundReflectionAlpha(e)},$.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(o.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},$.prototype.setCutPlanes=function(e){this.model&&this.model.is2d()?o.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"):this.impl.setCutPlaneSet("__set_view",e)},$.prototype.getScreenShot=function(e,t,i,r){return B.ScreenShot.getScreenShotLegacy(this,e,t,i,r)},$.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},$.prototype.setDefaultContextMenu=function(){var e=Autodesk.Viewing.Extensions;return!(!e||!e.ViewerObjectContextMenu)&&(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0)},$.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),!!this.contextMenu&&(this.contextMenu.show(e),!0)},$.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},$.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},$.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},$.prototype.triggerSwipeCallback=function(e){this.config&&this.config.onTriggerSwipeCallback&&this.config.onTriggerSwipeCallback(e)},$.prototype.initContextMenu=function(){(!this.config||!Object.prototype.hasOwnProperty.call(this.config,"disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var e=this,t=this.canvas||this.container;this.onMouseDown=function(t){f.EventUtils.isRightClick(t)&&(e.startX=t.clientX,e.startY=t.clientY)},t.addEventListener("mousedown",this.onMouseDown),this.onMouseUp=function(t){if(f.EventUtils.isRightClick(t)&&t.clientX===e.startX&&t.clientY===e.startY){if(this.viewer.impl.isRightBtnSelectionEnabled()){const e=this.viewer.impl.clientToViewport(t.clientX,t.clientY),i=this.viewer.impl.hitTestViewport(e,!1),r=null==i?void 0:i.dbId,n=this.viewer.getSelection();if(void 0!==r&&!n.includes(r))return;if(void 0===r&&n.length)return}e.triggerContextMenu(t)}return!0},t.addEventListener("mouseup",this.onMouseUp,!1)},$.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},$.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[e],!0)},$.prototype.runContextMenuCallbacks=function(e,t){for(var i in this.contextMenuCallbacks)Object.prototype.hasOwnProperty.call(this.contextMenuCallbacks,i)&&this.contextMenuCallbacks[i](e,t)},$.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},$.prototype.worldToClient=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.impl.camera;return this.impl.worldToClient(e,t)},$.prototype.clientToWorld=function(e,t,i,r,n){return this.impl.clientToWorld(e,t,i,r,n)},$.prototype.modelHasTopology=function(){return!(!this.model||!this.model.hasTopology())},$.prototype.setSelectionColor=function(e,t){this.impl.setSelectionColor(e,t)},$.prototype.set2dSelectionColor=function(e,t){this.impl.set2dSelectionColor(e,t)},$.prototype.setTheme=function(e){for(var t=this.container.classList,i=0;i<t.length;++i){-1!==t[i].indexOf("-theme")&&t.remove(t[i--])}t.add(e)},$.prototype.setThemingColor=function(e,t,i,r){(i=i||this.model).setThemingColor(e,t,r),this.impl.invalidate(!0)},$.prototype.clearThemingColors=function(e){(e=e||this.model).clearThemingColors(),this.impl.invalidate(!0)},$.prototype.setMaterialsToDefaults=function(e){const t=(e||this.model).getFragmentList();if(!t)return;const i=e.isConsolidated();i&&e.unconsolidate(!1,!0),t.restoreOriginalMaterials(),i&&!e.isConsolidated()&&this.impl.consolidateModel(e),this.impl.invalidate(!0,!0)},$.prototype.transferModel=function(e,t){var i,r=this.impl.findModel(e);if(r){var n=[];this.getAggregateSelection((function(t,i){t.id==e&&n.push(i)}));var o=this.impl.visibilityManager.getIsolatedNodes(r),s=this.impl.visibilityManager.getHiddenNodes(r),a=this.impl.matman().exportModelMaterials(r);this.impl.unloadModel(r,!0),null===(i=r.getFragmentList())||void 0===i||i.dispose(this.impl.glrenderer()),r.isAEC()&&r.is3d()&&t.impl.setLightPresetForAec(),t.impl.setRenderingPrefsFor2D(r.is2d()),t.impl.addModel(r),t.impl.matman().importModelMaterials(a,e),t._loadingSpinner.hide(),r.loader&&r.loader.viewer3DImpl===this.impl&&(r.loader.viewer3DImpl=t.impl),r.getData().loadDone&&t.impl.onLoadComplete(r),t.impl.selector.setSelection(n,r),0!=o.length?t.impl.visibilityManager.isolate(o,r):0!=s.length&&t.impl.visibilityManager.hide(s,r)}},$.prototype.hideModel=function(e){var t=this.impl.modelQueue();return!!(e="number"==typeof e?t.findModel(e):e)&&(this.impl.removeModel(e),t.addHiddenModel(e),!0)},$.prototype.showModel=function(e,t){var i=this.impl.modelQueue();return!!(e="number"==typeof e?i.findHiddenModel(e):e)&&(i.removeHiddenModel(e),this.impl.addModel(e,t),!0)},$.prototype.getVisibleModels=function(){return this.impl.modelQueue().getModels().slice()},$.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels().slice()},$.prototype.getAllModels=function(){return this.impl.modelQueue().getAllModels().slice()},$.prototype.getFirstModel=function(){return this.impl.is2d?this.impl.get2DModels()[0]:this.impl.get3DModels()[0]},$.prototype.getUnderlayRaster=function(e){return this.getAllModels().find((t=>{var i,r;const n=t.getDocumentNode();return n&&(null===(i=n.getDocument())||void 0===i?void 0:i.getPath())===(null===(r=e.getDocument())||void 0===r?void 0:r.getPath())&&n.guid()===e.guid()&&t.getData().underlayRaster}))},$.prototype.restoreDefaultSettings=function(){var e=this.model,t=e.is2d()?"2d":"3d";this.prefs.reset(t),this.impl.setupLighting(e),e.isAEC()&&e.is3d()&&this.impl.setLightPresetForAec(),this.impl.setRenderingPrefsFor2D(!e.is3d()),this.fireEvent({type:S.RESTORE_DEFAULT_SETTINGS_EVENT})},$.prototype.disableHighlight=function(e){this.impl.disableHighlight(e)},$.prototype.disableSelection=function(e){e&&this.clearSelection(),this.impl.disableSelection(e)},$.prototype.isHighlightDisabled=function(){return this.impl.selector.highlightDisabled},$.prototype.isHighlightPaused=function(){return this.impl.selector.highlightPaused},$.prototype.isHighlightActive=function(){return!(this.impl.selector.highlightDisabled||this.impl.selector.highlightPaused)},$.prototype.isSelectionDisabled=function(){return this.impl.selector.selectionDisabled},$.prototype.activateExtension=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].activate(t):(o.logger.warn("Extension is not loaded or doesn't exist"),!1)},$.prototype.deactivateExtension=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].deactivate():(o.logger.warn("Extension is not loaded or doesn't exist"),!1)},$.prototype.isExtensionActive=function(e,t){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].isActive(t):(o.logger.warn("Extension is not loaded or doesn't exist"),!1)},$.prototype.isExtensionLoaded=function(e){return this.loadedExtensions&&e in this.loadedExtensions},$.prototype.getLoadedExtensions=function(){return this.loadedExtensions||[]},$.prototype.getExtensionModes=function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e].getModes():(console.warn("Extension is not loaded or doesn't exist"),[])},$.prototype.reorderElements=function(e){var t=e.getAttribute("layer-order-id"),i=this.containerLayerOrder.indexOf(t),r=null;if(-1!==i)for(var n=i+1;n<this.containerLayerOrder.length&&!r;n++)r=this.container.querySelector('[layer-order-id="'+this.containerLayerOrder[n]+'"]');r?this.container.insertBefore(e,r):this.container.appendChild(e)},$.prototype.appendOrderedElementToViewer=function(e){var t=this.container.querySelector('[layer-order-id="'+e+'"]');if(t)return t;var i=this.getDocument().createElement("div");return i.setAttribute("layer-order-id",e),this.reorderElements(i),i},$.prototype.hitTest=function(e,t,i){return this.impl.hitTest(e,t,i)},$.prototype.refresh=function(e){this.impl.invalidate(e,!1,!e,!e)},$.prototype.chooseProfile=function(e){let t=this.profileManager.PROFILE_DEFAULT;return this.config&&this.config.profileSettings?t=new s.Profile(this.config.profileSettings):e&&e.useFileProfile?t=this.profileManager.getProfileOrDefault(e.fileExt):e.isAEC&&(t=this.profileManager.PROFILE_AEC),t}},27848:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InitParametersSetting:()=>Y,Viewer3DImpl:()=>Q,createRenderer:()=>K});var r=i(7247),n=i(27343),o=i(77876),s=i(75746),a=i(38454),l=i(19462),h=i(25161),c=i(91121),u=i(52156),d=i(93666),p=i(88505),f=i(60489),m=i(33664),g=i(8544),v=i(70179),y=i(22573),b=i(36097),x=i(70333),_=i(75261),E=i(70178),A=i(33303),S=i(3016),w=i(27156),M=i(74718),T=i(60945),C=i(90245),P=i(70173),D=i(75050),L=i(52713),I=i(18878),R=i(87432),O=i(86142),N=i(39080),F=i(37765),k=i(76542),V=i(64141),U=i(86008),B=i(68482),G=i(742);class z{_callbacks;_numberOfTotalDrawCalls;_numberOfInjections;constructor(){this._callbacks=new Array,this._numberOfTotalDrawCalls=0,this._numberOfInjections=0,this.counters={drawArrays:0,drawArraysInstanced:0,drawElements:0,drawElementsInstanced:0,total:0}}initialize(e){e instanceof WebGL2RenderingContext?(this.#n(e),this.#o(e)):console.debug("Draw calls cannot be intruded and counted: Valid context object expected, given",e)}uninitialize(){}resetCounters(){for(const e of this._callbacks)e.continuous?e.callCountOnLastInvocation-=this.counters.total:e.callCountOnLastInvocation=0;this.counters.drawArrays=0,this.counters.drawArraysInstanced=0,this.counters.drawElements=0,this.counters.drawElementsInstanced=0,this.counters.total=0}inject(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Number.isInteger(t)&&t<0?console.warn("After-draw-call callback injection ignored. Number of calls ignored before invocation must be a positive number, given",t):this._callbacks.push({callback:e,numberOfCallsIgnoreBeforeInvocation:t,callCountOnLastInvocation:0,continuous:i})}#s(e,t){if(void 0!==e)return function(){e.apply(this,arguments),t.apply(this)}}#a(){if(++this.counters.total,++this._numberOfTotalDrawCalls,0!==this._callbacks.length)for(const e of this._callbacks)this.counters.total-e.callCountOnLastInvocation<=e.numberOfCallsIgnoreBeforeInvocation||(e.callback(),e.callCountOnLastInvocation=this.counters.total,++this._numberOfInjections)}#n(e){e.drawArrays=this.#s(e.drawArrays,(()=>{++this.counters.drawArrays,this.#a()})),e.drawArraysInstanced=this.#s(e.drawArraysInstanced,(()=>{++this.counters.drawArraysInstanced,this.#a()})),e.drawElements=this.#s(e.drawElements,(()=>{++this.counters.drawElements,this.#a()})),e.drawElementsInstanced=this.#s(e.drawElementsInstanced,(()=>{++this.counters.drawElementsInstanced,this.#a()})),e.drawRangeElements=this.#s(e.drawRangeElements,(()=>{++this.counters.drawElements,this.#a()}))}#o(e){}}const H={WEBGL_CONTEXT_LOST:"webglcontextlost",WEBGL_CONTEXT_RESTORED:"webglcontextrestored"};class W extends G.WebGLRenderer{static DEFAULT_NUM_DRAW_CALLS_TO_INJECT_FLUSH_AFTER_IOS=1e3;_drawCallIntrusion;#l;#h;#c;constructor(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(i),null===(e=i.canvas)||void 0===e||e.addEventListener("webglcontextlost",(()=>{this.fireEvent({type:H.WEBGL_CONTEXT_LOST})})),null===(t=i.canvas)||void 0===t||t.addEventListener("webglcontextrestored",(()=>{this.fireEvent({type:H.WEBGL_CONTEXT_RESTORED})})),this.refCount=0;const n=parseInt((0,r.getIOSVersion)(),10);if((0,r.isIOSDevice)()&&n>=15){this._drawCallIntrusion=new z,this._drawCallIntrusion.initialize(this.getContext());const e=W.DEFAULT_NUM_DRAW_CALLS_TO_INJECT_FLUSH_AFTER_IOS-1;this._drawCallIntrusion.inject((()=>{this.getContext().flush()}),e,!0),console.debug(e<1?"LMVRenderer: Additional context flushes will be invoked after every draw call.":`LMVRenderer: Additional context flushes will be invoked after ${e+1} subsequent draw calls.`)}else this._drawCallIntrusion=void 0;this.#l=[],this.loadingAnimationDuration=-1,this.highResTimeStamp=-1,this.#h=this.render,this.#c=this.setRenderTarget,this.render=W.prototype.render.bind(this),this.setRenderTarget=W.prototype.setRenderTarget.bind(this)}supportsMRT(){return console.warn("LMVRenderer: .supportsMRT() has been deprecated. It always returns true."),!0}updateTimestamp(e){return this.highResTimeStamp=e}getLoadingAnimationDuration(){return this.loadingAnimationDuration}setLoadingAnimationDuration(e){return this.loadingAnimationDuration=e}clearBlend(){this.state.setBlending(D.NoBlending)}isWebGL2(){return console.warn("LMVRenderer: .isWebGL2() has been deprecated. It always returns true."),!0}render(e,t,i){this.#h(e,t,!1,i)}notifyFinalFrameRendered(e){void 0!==this._drawCallIntrusion&&this._drawCallIntrusion.resetCounters()}setRenderTarget(e){this.#c(e)}}B.EventDispatcher.prototype.apply(W.prototype),W.Events=H;var j=null,q=(0,r.getGlobal)().ENABLE_DEBUG,X=(0,r.getGlobal)().ENABLE_DEBUG_RCS;let Y={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,logarithmicDepthBuffer:!1};function K(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,r.isNodeJS)())return;var i=Object.assign({},Y,t);let n;i.canvas=e;try{n=new W(i)}catch(e){return null}return n.name="MainRenderer",!n.getContext||n.getContext&&!n.getContext()?null:(n.autoClear=!1,n.sortObjects=!1,n)}function Q(e,t){var i=this;this.setGlobalManager(t.globalManager);var k,B,G,z,H,Y,Q,Z,J,$,ee,te,ie,re,ne,oe=1e3/15,se=1e3/30,ae=1,le=-1,he=-1,ce=-1,ue=null,de="y",pe=null,fe=null,me=null,ge=!1,ve=!1,ye=!1,be={type:I.PROGRESS_UPDATE_EVENT,state:o.ProgressState.LOADING,percent:0},xe=!1,_e=!1,Ee=!1,Ae=0,Se={magnitude:4,depthDampening:0},we=0,Me=1e3/60,Te=0,Ce=!0,Pe=!1,De=!1,Le=null,Ie=null;this.edgeColorMain=new D.Vector4(0,0,0,.3),this.edgeColorGhosted=new D.Vector4(0,0,0,.1);var Re,Oe,Ne,Fe=(0,r.getGlobal)(),ke=!1,Ve=e=>{var t=e.model;this.canvas&&t&&t.getData()&&t.getData().stdSurfMats&&t.getData().stdSurfMats.materials&&this.api.loadExtension("Autodesk.StandardSurface").then((e=>{e&&e.processModel(t)}))},Ue=e=>e.model.modelRootLoaded=!0,Be=e=>{null!=e&&e.model&&!ne.findModel(e.model.id)||this.invalidate(!1,!0)},Ge={},ze=!1,He="",We=!0;function je(e){var t;const r=null===(t=e.frags)||void 0===t?void 0:t.is2d;var n=Re.phase,o=!0,s=n==v.RenderFlags.RENDER_NORMAL,a=J.settings.idbuffer&&n!=v.RenderFlags.RENDER_HIDDEN,l=n==v.RenderFlags.RENDER_HIDDEN?i.edgeColorGhosted:i.edgeColorMain;J.setEdgeColor(l),n!=v.RenderFlags.RENDER_HIDDEN||e.ignoreFadeMaterial?n==v.RenderFlags.RENDER_HIGHLIGHTED&&(e.overrideMaterial=i.highlightMaterial):e.overrideMaterial=i.fadeMaterial;const h={type:I.RENDER_SCENE_PART,scene:e,wantColor:o,wantSAO:s,wantID:a,context:J};i.api.dispatchEvent(h),!i.is2d&&r?i.getSheetRenderer().renderScenePart(e,o,s,a):J.renderScenePart(e,o,s,a),e.overrideMaterial=null}function qe(e){if(!G)return;i.canvasBoundingclientRectDirty=!0,i.camera.aspect=z/H,i.camera.clientWidth=z,i.camera.clientHeight=H;const t=i.getWindow().devicePixelRatio;i.glrenderer().getPixelRatio()!==t&&i.glrenderer().setPixelRatio(t),J.setSize(z,H),i.controls.handleResize(),re&&re.setSize(z,H),$&&$.setSize(),i.invalidate(!0,!0,!0),G=!1,e||i.api.dispatchEvent({type:I.VIEWER_RESIZE_EVENT,width:z,height:H})}function Xe(){var e;if((ie.enabled||re)&&!i.is2d&&(e=i.model&&!i.model.isLoadDone()?i.model.getData().bbox:i.getVisibleBounds(!0,!1,void 0,void 0))){var t=i.camera,r=e.clone(),n=new D.Vector3(1,0,0),o=fe.clone();t.worldUpTransform&&(r.applyMatrix4(t.worldUpTransform),n.applyMatrix4(t.worldUpTransform),o.applyMatrix4(t.worldUpTransform)),r.min.y-=.005*(r.max.y-r.min.y),ee&&ee.expandByGroundShadow(r,o);var s=r.getSize(new D.Vector3),a=r.getCenter(new D.Vector3);if(ee||(s.x*=1.25,s.z*=1.25,s.x=s.z=Math.max(s.x,s.z)),t.worldUpTransform){var l=t.worldUpTransform.clone().invert();a.applyMatrix4(l)}if(ie.setTransform(a,s,t.worldup,n),re){var h=(new D.Vector3).subVectors(a,t.worldup.clone().multiplyScalar(s.y/2));re.setTransform(h,t.worldup,s)}ee&&ee.setGroundShadowTransform(a,s,t.worldup,n)}}function Ye(){ee&&(ee.state=y.SHADOWMAP_NEEDS_UPDATE)}this.useDeferredConsolidation=!1,e&&(this.interval=setInterval((function(){Ce||Te<60||i.track({name:"fps",value:Number(i.fps().toFixed(2)),aggregate:"last"})}),3e4)),this.api=t,this.canvas=e,this.loader=null,this.canvasBoundingclientRectDirty=!0,this.nearRadius=0,this.defaultLoadingAnimationDuration=300,this.lastTime2dGeometryCreated=0,this.maxModelDistance=0,this.initialize=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(k=new D.Vector3(0,1,0),ne=new s.RenderScene,(Z=t.glrenderer||K(e,t.webglInitParams))||(0,r.isNodeJS)()){Z&&(this.onWebGLcontextLost=this.onWebGLcontextLost.bind(this),this.onWebGLcontextRestored=this.onWebGLcontextRestored.bind(this),Z.addEventListener(W.Events.WEBGL_CONTEXT_LOST,this.onWebGLcontextLost),Z.refCount++,t.enableContextRestore&&(Z.enableContextRestore=!0,Z.addEventListener(W.Events.WEBGL_CONTEXT_RESTORED,this.onWebGLcontextRestored))),(J=t.renderer||new a.RenderContext).init(Z,e?e.clientWidth:0,e?e.clientHeight:0,t),(Y=t.materialManager||new l.MaterialManager(Z)).refCount++,this.useDeferredConsolidation=t&&!!t.useDeferredConsolidation,this.camera=new L.UnifiedCamera(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],Le=(new D.Color).setRGB(1,1,1),Ie=(new D.Color).setRGB(1,1,1),this.cameraChangedEvent={type:I.CAMERA_CHANGE_EVENT,camera:this.camera},pe=new D.Vector3(1,1,1),fe=(new D.Vector3).copy(pe),me=new D.Vector3(-1,0,1),this.scene=new D.Scene,this.sceneAfter=new D.Scene,this.sceneAfter.sortObjects=!1,this.overlayScenes={},bt(),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new D.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,Y.addInstancingSupport(this.fadeMaterial),Y.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.setSelectionColor(6724095),Y.togglePolygonOffset(!0),J.setDepthMaterialOffset(Y.getPolygonOffsetOn(),Y.getPolygonOffsetFactor(),Y.getPolygonOffsetUnits()),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=se,this.frameDisplayRate=5,(0,r.isMobileDevice)()&&(oe*=2,se*=2,this.targetFrameBudget/=2,this.frameDisplayRate/=2),this.interruptBudget=1e10,this.controls={update:function(){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new h.MultiModelSelector(this),this.visibilityManager=new c.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0;var i=u.LightPresets[u.DefaultLightPreset].bgColorGradient;this.setClearColors(i[0],i[1],i[2],i[3],i[4],i[5]),(ie=new d.GroundShadow(Z)).enabled=!0,Re=new $e,Y.addMaterialNonHDR("groundShadowDepthMaterial",ie.getDepthMaterial()),Y.addOverrideMaterial("normalsMaterial",J.getDepthMaterial()),Y.addOverrideMaterial("edgeMaterial",J.getEdgeMaterial()),J.beginScene(this.scene,this.camera,this.noLights,!0),J.composeFinalFrame(!0),this.api.addEventListener(I.MODEL_ROOT_LOADED_EVENT,Ve),this.api.addEventListener(I.MODEL_ROOT_LOADED_EVENT,Ue),this.api.addEventListener(I.LOADER_REPAINT_REQUEST_EVENT,Be)}},this.getSheetRenderer=function(){return $||($=new U.Z(i,J,Z,Y)),$},this.isSheetRendererNeeded=function(){return!i.is2d&&this.get2DModels().length>0},this.get2DModels=function(){return ne.getModels().filter((e=>e.is2d()))},this.get3DModels=function(){return ne.getModels().filter((e=>e.is3d()))},this.renderGroundShadow=function(e){ee?ee.state==y.SHADOWMAP_VALID&&ee.renderGroundShadow(i.camera,e||J.getColorTarget()):(ie.renderShadow(i.camera,e||J.getColorTarget()),ie.rendered=!0)};var Ke,Qe,Ze,Je={NOTHING_DRAWN:0,MODEL_DRAWN:1,BACKGROUND_DRAWN:2,OVERLAY_DRAWN:4,REFLECTION_DRAWN:8,ALL_DRAWN:15};function $e(){this.highResTimeStamp=-1,this.screenDrawn=Je.NOTHING_DRAWN,this.screenHasChanged=!1,this.frameBudget=0,this.frameRemaining=0,this.phase=v.RenderFlags.RENDER_NORMAL,this.signalProgressByRendering=!1,this.tickCount=0,this.beginFrameAvg=0,this.lastBeginFrameTimeStamp=0,this.RENDERMODE_FULL=0,this.RENDERMODE_PROGRESSIVE=1,this.RENDERMODE_SILENT=2,this.renderType=this.RENDERMODE_FULL,this.INITIAL_GROUND_SHADOW=.2,this.cmdListActive=!1,this.cmdIndex=0,this.continueExecution=!0,this.encounteredAlwaysDo=!1,this.finishedFullRender=!0,this.groundShadowInPost=!1,this.drawOverlay=!1,this.cmdIsOpen=!1,this.allocArraySize=0,this.cmdListLength=0,this.cmdList=[],this.paramList=[],this.CMD_NORMAL_SEQUENCE=0,this.CMD_DO_AFTER=1,this.CMD_ALWAYS_DO=2,this.isActive=function(){return this.cmdListActive},this.setFrame=function(e){this.frameBudget=e},this.beginCommandSet=function(){this.cmdListActive=!0,this.cmdIndex=0,this.cmdListLength=0,this.encounteredAlwaysDo=!1,this.tickCount=0,this.screenDrawn=Je.NOTHING_DRAWN,this.screenHasChanged=!1},this.endCommandSet=function(){this.cmdIsOpen&&(this.cmdIsOpen=!1,this.cmdListLength++)},this._internalSetParam=function(e,t){this.paramList[this.cmdIndex][e]=t},this.addCommand=function(e,t){for(this.cmdIsOpen&&this.cmdListLength++,this.cmdIsOpen=!0;this.allocArraySize<=this.cmdListLength;)this.cmdList[this.cmdListLength]={},this.paramList[this.cmdListLength]={},this.allocArraySize++;return this.cmdList[this.cmdListLength]=e,this.paramList[this.cmdListLength].executionLevel=t||this.CMD_NORMAL_SEQUENCE,this.encounteredAlwaysDo=this.encounteredAlwaysDo||t===this.CMD_ALWAYS_DO,this.cmdListLength},this.setParam=function(e,t){this.cmdIsOpen?this.paramList[this.cmdListLength][e]=t:q&&f.logger.error("ERROR: cannot set param when no command is open!")},this.getParam=function(e){return q&&void 0===this.paramList[this.cmdIndex][e]&&f.logger.error("ERROR: parameter "+e+" was never set for this command! Go fix it."),this.paramList[this.cmdIndex][e]},this.executeCommandList=function(){if(!Re.cmdListActive)return Re.lastBeginFrameTimeStamp=0,!0;var e;if(this.tickCount>0&&(Re.lastBeginFrameTimeStamp=0),this.frameRemaining=this.frameBudget,q&&this.cmdIsOpen&&f.logger.error("ERROR: should call endCommandSet before executing"),this.continueExecution=!0,X&&(0===this.tickCount&&console.log("==================="),console.log("Running commands for "+(Re.renderType===Re.RENDERMODE_PROGRESSIVE?"progressive":Re.renderType===Re.RENDERMODE_FULL?"full":"silent")+" render, for tick count "+this.tickCount)),this.encounteredAlwaysDo)for(var t=0;t<this.cmdIndex;)this.paramList[t].executionLevel>=Re.CMD_ALWAYS_DO&&(X&&console.log("  ALWAYS DO command "+t+": "+this.cmdList[t].name),this.cmdList[t]()),t++;for(;this.cmdIndex<this.cmdListLength;)(this.continueExecution||this.paramList[this.cmdIndex].executionLevel>=Re.CMD_DO_AFTER)&&(X&&console.log("  command "+this.cmdIndex+": "+this.cmdList[this.cmdIndex].name+" and "+Re.frameRemaining+" frame budget remaining"),this.cmdList[this.cmdIndex]()&&(X&&console.log("  >>> out of tick time with "+Re.frameRemaining),e=this.cmdIndex,this.continueExecution=!1)),this.cmdIndex++;return this.continueExecution?this.cmdListActive=!1:this.cmdIndex=e,this.tickCount++,!this.continueExecution}}function et(){if(Re.renderType===Re.RENDERMODE_PROGRESSIVE)if(Re.getParam("GenerateGroundShadow.afterBeauty")){if(Re.frameRemaining=ie.prepareGroundShadow(i.modelQueue(),0,Re.frameRemaining),ie.getStatus()==b.GroundFlags.GROUND_RENDERED){if(Re.getParam("GenerateGroundShadow.signalRedraw"))return i.requestSilentRender(),X&&console.log(" $$$$ SIGNAL FULL GROUND SHADOW REDRAW"),!0;Re.groundShadowInPost=!0}}else 0===Re.tickCount&&ie.prepareGroundShadow(i.modelQueue(),10);else Re.frameRemaining=ie.prepareGroundShadow(i.modelQueue(),0,Re.frameRemaining);return Re.frameRemaining<0&&ie.getStatus()===b.GroundFlags.GROUND_UNFINISHED}function tt(){return ie.getStatus()!==b.GroundFlags.GROUND_UNFINISHED&&i.renderGroundShadow(),!1}function it(){return Re.renderType===Re.RENDERMODE_PROGRESSIVE?Re.getParam("GenerateGroundReflection.afterBeauty")?(Re.frameRemaining=re.prepareGroundReflection(ie,i,!1,0,Re.frameRemaining),re.getStatus()==b.GroundFlags.GROUND_RENDERED&&(Re.screenDrawn|=Je.REFLECTION_DRAWN,Re.groundShadowInPost&&Y.hasTransparentMaterial()&&i.requestDeferredSilentRender())):0===Re.tickCount&&re.prepareGroundReflection(ie,i,!0,10):Re.frameRemaining=re.prepareGroundReflection(ie,i,!1,0,Re.frameRemaining),Re.frameRemaining<0&&re.getStatus()===b.GroundFlags.GROUND_UNFINISHED}function rt(){if(ee.state===y.SHADOWMAP_NEEDS_UPDATE)Re.frameRemaining=ee.startUpdate(ne,Re.frameRemaining,i.camera,fe,Y);else if(ee.state==y.SHADOWMAP_INCOMPLETE&&(Re.frameRemaining=ee.continueUpdate(ne,Re.frameRemaining,Y),ee.state==y.SHADOWMAP_VALID))return i.requestSilentRender(),X&&console.log(" $$$$ SIGNAL FULL SHADOW MAP REDRAW"),!0;return Re.frameRemaining<0&&ee.state!==y.SHADOWMAP_VALID}function nt(){ee.state=y.SHADOWMAP_NEEDS_UPDATE}function ot(){if(Re.signalProgressByRendering&&i.signalProgress(0,o.ProgressState.RENDERING),Re.renderType===Re.RENDERMODE_PROGRESSIVE){if(Re.lastBeginFrameTimeStamp>0){var e=Re.highResTimeStamp-Re.lastBeginFrameTimeStamp;Re.beginFrameAvg=.75*Re.beginFrameAvg+.25*e}Re.lastBeginFrameTimeStamp=Re.highResTimeStamp,Re.beginFrameAvg<se&&Re.frameBudget<oe?(i.targetFrameBudget+=1,i.targetFrameBudget>oe&&(i.targetFrameBudget=oe)):Re.beginFrameAvg>se&&Re.frameBudget>ae&&(i.targetFrameBudget*=.75+.25*se/Re.beginFrameAvg,i.targetFrameBudget<ae&&(i.targetFrameBudget=ae))}var t=Re.getParam("BeginScene.clear");return J.beginScene(i.scene,i.camera,i.lightsOn?i.lights:i.no_lights,t),t&&(Re.screenDrawn|=Je.BACKGROUND_DRAWN),Re.getParam("BeginScene.signalCameraChanged")&&i.api.dispatchEvent(i.cameraChangedEvent),!1}function st(){return Re.phase=Re.getParam("BeginPhase.phase"),X&&console.log("     render phase is now "+Re.phase),ne.reset(i.camera,Re.phase,Re.getParam("BeginPhase.moved"),Y.getCutPlanes(),ze),!1}function at(){return ne.isEmpty()||ne.isDone()||(Re.screenDrawn|=Je.MODEL_DRAWN,Re.frameRemaining=ne.renderSome(je,Re.frameRemaining),Re.signalProgressByRendering&&(i.signalProgress(100*ne.getRenderProgress(),o.ProgressState.RENDERING),X&&console.log("  %%% percent done "+100*ne.getRenderProgress()))),!ne.isDone()}function lt(){return Re.phase=v.RenderFlags.RENDER_FINISHED,J.renderScenePart(i.sceneAfter,!0,!0,!0),!1}function ht(){return Re.phase=v.RenderFlags.RENDER_FINISHED,!1}function ct(){i.signalProgress(100,o.ProgressState.RENDERING)}function ut(){return i.isOverlayDirty()&&(i.clearOverlayDirtyFlag(),Re.drawOverlay=!0),Re.drawOverlay&&(!ne.isEmpty()&&ne.isDone()||i.showOverlaysWhileMoving?(i.renderOverlays(),Re.screenDrawn|=Je.OVERLAY_DRAWN):(J.clearAllOverlays(),Re.drawOverlay=!1)),!1}function dt(){Re.screenDrawn|=Je.ALL_DRAWN}function pt(){if(Re.screenDrawn&&(Re.phase===v.RenderFlags.RENDER_FINISHED||Re.tickCount%i.frameDisplayRate==0)){var e=!Re.getParam("PostAndPresent.performAO")||(Re.screenDrawn&(Je.BACKGROUND_DRAWN|Je.MODEL_DRAWN))==Je.BACKGROUND_DRAWN;J.composeFinalFrame(e),Re.screenHasChanged=!0,Re.screenDrawn=Je.NOTHING_DRAWN,t=Re.highResTimeStamp,Te++,we<=t&&we>0&&(Me=.8*Me+.2*(t-we)),i.fpsCallback&&i.fpsCallback(i.fps()),i.api.dispatchEvent({type:I.RENDER_PRESENTED_EVENT})}var t;return!1}function ft(){return q&&!1===J.getAOEnabled()&&f.logger.error("AO should be on at this point!"),J.setAOEnabled(!1),!1}function mt(){return q&&!0===J.getAOEnabled()&&f.logger.error("AO should be off at this point!"),J.setAOEnabled(!0),!1}function gt(){return i.requestSilentRender(),!1}function vt(){return Re.finishedFullRender=!0,!1}this.tick=function(e){e||(e=0),Re.highResTimeStamp=e,Z.updateTimestamp(e);var t=Y.updateMaterials();i.invalidate(t.needsClear,t.needsRender,t.overlayDirty);const r=function(e){if(i.keyFrameAnimator){var t=we>0?(e-we)/1e3:0,r=i.keyFrameAnimator.update(t);if(r&&(i.sceneUpdated(!0),r&i.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}(e),n=i.controls.update(e),o=ne&&ne.update(e),s=n||r||te||o;te=!1;var a=G;qe(),ge||(ge=s),ye||(ye=s);var l=!1,h=J.overlayUpdate();ye?function(){for(var e in i.selectionMeshes){var t=i.selectionMeshes[e];if(t.model){var r,n=t.model.getFragmentList();t.geometry===(null===(r=n)||void 0===r?void 0:r.getGeometry(t.fragId))&&n.getWorldMatrix(t.fragId,t.matrix)}}}():h&&!ye&&(ye=l=!0),this.isLoadingAnimationEnabled()&&we-i.lastTime2dGeometryCreated<=Z.getLoadingAnimationDuration()&&(ve=!0);var c=i.model&&i.model.loader&&i.model.loader.pagingProxy&&i.model.loader.pagingProxy.getMemoryInfo();Re.signalProgressByRendering=i.model&&i.model.isLoadDone()&&!i.model.isLeaflet()&&!c,xe&&(Xe(),ie.setDirty(),xe=!1,1)&&(ge=!0);var u=ge,d=ne.frameResumePossible();if(ge=ge||!d,Ee=Ee||_e&&!Re.cmdListActive,ge||ve||ye||Ee)if(Re.drawOverlay=ye||ge||ve,ge||ve||Ee){var p,f=u?x.ResetFlags.RESET_RELOAD:x.ResetFlags.RESET_NORMAL;ge||ve?(i.progressiveRender?(Re.renderType=Re.RENDERMODE_PROGRESSIVE,p=i.targetFrameBudget):(Re.renderType=Re.RENDERMODE_FULL,p=i.interruptBudget),ge&&(_e=Ee=!1)):(Re.renderType=Re.RENDERMODE_SILENT,p=i.targetFrameBudget,ge=!0,f=x.ResetFlags.RESET_REDRAW,_e=Ee=!1),i.skipCameraUpdate||i.updateCameraMatrices(),Re.setFrame(p),Re.finishedFullRender=!1,Re.beginCommandSet();var m=ie.enabled&&!i.is2d&&!Ce,g=!!re&&!i.is2d&&!Ce,b=s||a,_=s&&i.skipAOWhenMoving&&J.getAOEnabled();Re.addCommand(ot),Re.setParam("BeginScene.signalCameraChanged",b),Re.setParam("BeginScene.clear",ge),_&&Re.addCommand(ft,Re.CMD_ALWAYS_DO),ne&&(ee&&ee.state!==y.SHADOWMAP_VALID&&Re.addCommand(rt),m&&(Re.addCommand(et),Re.setParam("GenerateGroundShadow.afterBeauty",!1),Re.setParam("GenerateGroundShadow.signalRedraw",!1)),g?(re.setDirty(),Re.addCommand(it),Re.setParam("GenerateGroundReflection.afterBeauty",!1)):m&&ge&&Re.addCommand(tt),ne.hasHighlighted()&&(Re.addCommand(st),Re.setParam("BeginPhase.phase",v.RenderFlags.RENDER_HIGHLIGHTED),Re.setParam("BeginPhase.moved",f),f=!1,Re.addCommand(at)),Re.addCommand(st),Re.setParam("BeginPhase.phase",v.RenderFlags.RENDER_NORMAL),Re.setParam("BeginPhase.moved",f),f=!1,Re.addCommand(at),!ne.areAllVisible()&&i.showGhosting&&(g&&Re.renderType===Re.RENDERMODE_PROGRESSIVE||(Re.addCommand(st),Re.setParam("BeginPhase.phase",v.RenderFlags.RENDER_HIDDEN),Re.setParam("BeginPhase.moved",f),Re.addCommand(at))),Re.addCommand(lt),Re.signalProgressByRendering&&Re.addCommand(ct)),Re.addCommand(ut,Re.renderType===Re.RENDERMODE_PROGRESSIVE?Re.CMD_DO_AFTER:Re.CMD_NORMAL_SEQUENCE),Re.addCommand(pt,Re.renderType===Re.RENDERMODE_PROGRESSIVE?Re.CMD_DO_AFTER:Re.CMD_NORMAL_SEQUENCE),Re.setParam("PostAndPresent.performAO",J.getAOEnabled()&&!_),Re.renderType===Re.RENDERMODE_PROGRESSIVE&&ne&&(ee&&ee.state!==y.SHADOWMAP_VALID&&(Re.addCommand(nt),Re.addCommand(rt)),m&&(Re.addCommand(et),Re.setParam("GenerateGroundShadow.afterBeauty",!0),Re.setParam("GenerateGroundShadow.signalRedraw",!g),Re.signalProgressByRendering&&Re.addCommand(ct)),g&&(Re.groundShadowInPost=!1,Re.addCommand(it),Re.setParam("GenerateGroundReflection.afterBeauty",!0),!ne.areAllVisible()&&i.showGhosting&&(Re.addCommand(st),Re.setParam("BeginPhase.phase",v.RenderFlags.RENDER_HIDDEN),Re.setParam("BeginPhase.moved",f),Re.addCommand(at)),Re.addCommand(ht),Re.addCommand(pt),Re.setParam("PostAndPresent.performAO",J.getAOEnabled()&&!_),Re.signalProgressByRendering&&Re.addCommand(ct))),_&&(Re.addCommand(mt,Re.CMD_ALWAYS_DO),Re.addCommand(gt)),Re.addCommand(vt),Re.endCommandSet(),ge=!1,ve=!1,this.clearOverlayDirtyFlag()}else Re.finishedFullRender&&(Re.beginCommandSet(),X&&console.log("=====\nOVERLAY DIRTY"),l?Re.addCommand(dt):Re.addCommand(ut,!0),Re.addCommand(pt,!0),Re.setParam("PostAndPresent.performAO",J.getAOEnabled()),Re.signalProgressByRendering&&Re.addCommand(ct),Re.endCommandSet(),this.clearOverlayDirtyFlag());Ne=Re.cmdListActive,i.onBeforeRender&&i.onBeforeRender(Ne),Re.executeCommandList(),Ne!==We&&(Ne||i.glrenderer().notifyFinalFrameRendered(),i.api.dispatchEvent({type:I.FINAL_FRAME_RENDERED_CHANGED_EVENT,value:{finalFrame:!Ne}}),We=Ne),we=Re.highResTimeStamp},this.setLmvDisplay=function(e){Fe=e},this.run=function(){Q=!0,B=0,setTimeout((function(){Q&&function e(t){B=Fe.requestAnimationFrame(e),i.tick(t)}()}),1)},this.stop=function(){i.getWindow().cancelAnimationFrame(B),Q=!1},this.toggleProgressive=function(e){this.progressiveRender=e,ge=!0},this.updateClearColors=function(){let e=this.clearColorTop,t=this.clearColorBottom;if(this.is2d&&this.swapBlackAndWhite){const i=e=>1===e.x&&1===e.y&&1===e.z,r=e=>0===e.x&&0===e.y&&0===e.z,n=e=>i(e)?new D.Vector3(0,0,0):r(e)?new D.Vector3(1,1,1):e;e=n(e),t=t&&n(t)}J.setClearColors(e,t)},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,this.updateClearColors(),ge=!0},this.toggleGrayscale=function(e){Y.setGrayscale(e),ge=!0},this.toggleGhosting=function(e){this.showGhosting=e,ge=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){J.initPostPipeline(e,t),this.fireRenderOptionChanged(),ge=!0},this.toggleCmdMapping=function(e,t){t.keyMapCmd=e},this.toggleGroundShadow=function(e){ie.enabled!==e&&(ie.enabled=e,ie.clear(),e&&ie.setDirty(),Xe(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.isGroundShadowEnabled=function(){return ie&&ie.enabled},this.setGroundShadowColor=function(e){ie.enabled&&(ie.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){ie.enabled&&(ie.setAlpha(e),this.invalidate(!0,!1,!1))},this.setRightBtnSelection=function(e){ke=e},this.isRightBtnSelectionEnabled=function(){return ke},this.toggleGroundReflection=function(e){e&&re||!e&&!re||(e?((re=new _.GroundReflection(Z,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:J.getClearPass()})).setClearColors(this.clearColorTop,this.clearColorBottom,(0,r.isMobileDevice)()),re.toggleEnvMapBackground(Pe),re.setEnvRotation(J.getEnvRotation()),Xe()):(re.cleanup(),re=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){re&&(re.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){re&&(re.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){Pe=e,J.toggleEnvMapBackground(e),re&&re.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return Pe},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.getOverlayScenesToRender=function(){const e={};for(const[t,i]of Object.entries(this.overlayScenes))i.hiddenFromMainRender||(e[t]=i);return e},this.renderOverlays=function(){!function(){for(var e in i.selectionMeshes){var t=i.selectionMeshes[e];t.model&&t.model.isConsolidated()&&(t.model.updateRenderProxy(t,t.fragId),t.geometry||i.highlightFragment(t.model,t.fragId,!1))}}();var e,t=this.lightsOn;t||this.toggleLights(!0,!0),this.dir_light1&&(e=this.dir_light1.intensity,this.dir_light1.intensity=1);const r=this.getOverlayScenesToRender();J.renderOverlays(r,this.lightsOn?this.lights:this.no_lights),t||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=e)},this.setLayerVisible=function(e,t){this.layers.setLayerVisible(e,t)},this.isLayerVisible=function(e){return this.layers.isLayerVisible(e)},this.getVisibleLayerIndices=function(){return this.layers.getVisibleLayerIndices()},this.setNearRadius=function(e,t){this.nearRadius!==e&&(this.nearRadius=e,t&&this.invalidate(!0))},this.getNearRadius=function(){return this.nearRadius},this.updateNearFarValues=function(e,t){if(t.isEmpty())f.logger.warn("Calculating near-far values based on empty worldBox (infinity) will result in incorrect values - Better to keep previous values instead.");else{if(Ze||(Ke=new D.Matrix4,Qe=new D.Matrix4,Ze=new D.Box3),Ke.compose(e.position,e.quaternion,e.scale),Qe.copy(Ke).invert(),Ze.copy(t),re){var i=new D.Vector3;i.multiplyVectors(Ze.max,e.worldup);var r=new D.Vector3;r.multiplyVectors(Ze.min,e.worldup),i.sub(r),i.x>=0?Ze.min.x-=i.x:Ze.max.x-=i.x,i.y>=0?Ze.min.y-=i.y:Ze.max.y-=i.y,i.z>=0?Ze.min.z-=i.z:Ze.max.z-=i.z}ee&&ee.groundShapeBox&&Ze.union(ee.groundShapeBox),Ze.applyMatrix4(Qe);var n=1e-5*(Ze.max.z-Ze.min.z),o=.5*(Ze.max.y-Ze.min.y),s=-(Ze.max.z+n)-o,a=-(Ze.min.z-n)+o;if(e.isPerspective){this.nearRadius>0?(s=Math.max(s,Math.min(this.nearRadius,1e-4*Math.abs(a-s))),a=Math.min(a,1e4*s)):(s=Math.max(s,Math.min(1,1e-4*Math.abs(a-s))),a<0&&(a=1e-4),s=Math.max(s,1e-5*a));const i=Math.sqrt(F.SceneMath.pointToBoxDistance2(e.position,t)),r=Math.max(1,i);s=Math.min(s,r)}a=Math.max(a,s),e.near=s,e.far=a,e.updateCameraMatrices()}},this.getPixelsPerUnit=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.model;var r=J.settings.deviceHeight,n=Y.getCutPlanesRaw()[0],o=i?i.getBoundingBox():t;return F.SceneMath.getPixelsPerUnit(e,this.is2d,t,r,n,o)},this.updateCameraMatrices=function(){const e=this.camera;e.worldup&&this.setWorldUp(e.worldup);const t=this.getVisibleBounds(!0,ye);this.updateNearFarValues(e,t),this.maxModelDistance&&this._applyMaxModelDistanceToNearFar();const i=this.getPixelsPerUnit(e,t),r=J.settings.deviceWidth,n=J.settings.deviceHeight;this.is2d?(Y.updatePixelScale(i,r,n,e),Y.updateSwapBlackAndWhite(this.swapBlackAndWhite)):Y.updatePixelScale(i,r,n,e);this.get2DModels().forEach((t=>{const i=t.getModelToViewerTransform(),o=i?i.getMaxScaleOnAxis():1;if(!this.is2d||1!==o){const i=t.getVisibleBounds(),s=F.SceneMath.getPixelsPerUnit(e,!0,i,n,null,i);Y.updatePixelScaleForModel(t,s,r,n,o,e)}}))},this.initLights=function(){De||(this.dir_light1=new D.DirectionalLight(Le,1),this.dir_light1.position.copy(me),this.amb_light=new D.AmbientLight(Ie),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),De=!0)};function yt(){if((0,r.isMobileDevice)())return;var e=ne.getModels().length;let t=J.mrtFlags();e>1&&t.mrtIdBuffer<2&&(J.setIdTargetCount(2)&&Y.toggleMRTSetting(J.mrtFlags()))}this.toggleLights=function(e,t){this.amb_light&&(this.lightsOn=e,function(e,t,i,r){var n,o,s=u.LightPresets[le],a=s&&s.ambientColor,l=s&&s.directLightColor;a=(null===(n=a)||void 0===n?void 0:n.slice(0))??Ie.toArray(),l=(null===(o=l)||void 0===o?void 0:o.slice(0))??Le.toArray(),i?(r&&e?e.color.setRGB(.5*l[0],.5*l[1],.5*l[2]):e&&e.color.setRGB(a[0],a[1],a[2]),t&&t.color.setRGB(l[0],l[1],l[2])):e&&r&&e.color.setRGB(a[0],a[1],a[2])}(this.amb_light,this.dir_light1,e,t))},this.syncCamera=function(e){this.camera.updateCameraMatrices(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),te=!0},this.getModelCamera=function(e){if(!e)return;let t;const i=e.getDefaultCamera();return t=i||L.UnifiedCamera.getViewParamsFromBox(e.getBoundingBox(),e.is2d(),this.camera.aspect,this.camera.up,this.camera.fov),t},this.setViewFromFile=function(e,t){if(e){var i=this.getModelCamera(e),r=e.getMetadata("navigation hint","value",null),n=this.controls.isToolActivated("freeorbit")||t&&"Freeorbit"===r;this.setViewFromCamera(i,t,n)}},this.adjustOrthoCamera=function(e){var t=this.getVisibleBounds();L.UnifiedCamera.adjustOrthoCamera(e,t)},this.setViewFromCamera=function(e,t,i){this.adjustOrthoCamera(e);var r,n=this.model?this.model.getUpVector():null;r=n?(new D.Vector3).fromArray(n):i?e.up.clone():R.Navigation.snapToAxis(e.up.clone());const o=e.target.clone().sub(e.position).normalize().distanceTo(r.clone().negate())<1e-6;i?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",r.equals(e.up)):o||(e.up=r);var s=this.api.navigation;if(s){var a=this.camera;if(t)a.up.copy(e.up),a.position.copy(e.position),a.target.copy(e.target),e.isPerspective?a.fov=e.fov:(a.saveFov=e.fov,a.fov=L.UnifiedCamera.ORTHO_FOV),a.isPerspective=e.isPerspective,a.orthoScale=e.orthoScale,a.dirty=!0,s.setWorldUpVector(i||o?r:a.up),s.setView(a.position,a.target),s.setPivotPoint(a.target),this.syncCamera(!0);else if(a.isPerspective=e.isPerspective,e.isPerspective||(a.saveFov=e.fov,e.fov=L.UnifiedCamera.ORTHO_FOV),i)s.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,r);else{var l=this.getVisibleBounds();if(!l.containsPoint(e.target)){var h=l.getCenter(new D.Vector3).distanceTo(e.position),c=e.target.clone().sub(e.position).normalize().multiplyScalar(h);e.target.copy(e.position.clone().add(c))}var u=s.computeOrthogonalUp(e.position,e.target);s.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,u,r)}}te=!0},this.getViewArrayFromCamera=function(e){var t,i=e||{x:0,y:0,z:0},r=this.camera,n=this.model.getUpVector();t=n?(new D.Vector3).fromArray(n):R.Navigation.snapToAxis(r.up.clone());var o=this.api.navigation.getPivotPoint();return[r.position.x+i.x,r.position.y+i.y,r.position.z+i.z,o.x+i.x,o.y+i.y,o.z+i.z,t.x,t.y,t.z,r.aspect,D.Math.degToRad(r.fov),r.orthoScale,r.isPerspective?0:1]},this.setViewFromViewBox=function(e,t,i,r){if(!e.is2d())return;var n={},o=e.getBoundingBox(),s={width:t[2]-t[0],height:t[3]-t[1]};s.aspect=s.width/s.height,s.centerX=t[0]+s.width/2,s.centerY=t[1]+s.height/2;var a=this.camera.aspect;a>s.aspect?n.orthoScale=s.height:n.orthoScale=s.width/a;const l=o.getCenter(new D.Vector3);n.isPerspective=!1,n.position=new D.Vector3(s.centerX,s.centerY,l.z+n.orthoScale),n.target=new D.Vector3(s.centerX,s.centerY,l.z),n.target.y+=1e-6*s.height,n.up=new D.Vector3(0,0,1),this.setViewFromCamera(n,r,!1)},this.setWorldUp=function(e){if(!k.equals(e)){k.copy(e);var t=Math.abs(e.x);de="x",Math.abs(e.y)>t&&(de="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(de="z");var r,n,o,s,a=new D.Vector3(0,1,0);i.camera.worldUpTransform=(r=a,n=e,o=(new D.Vector3).crossVectors(n,r).normalize(),s=Math.acos(r.dot(n)),(new D.Matrix4).makeRotationAxis(o,s)),this.sceneUpdated(!1)}},this.setUp2DMode=function(e,t){const r=e.getData();r.layerCount&&Y.initLayersTexture(r.layerCount,r.layersMap,e.id);const n=Y.create2DMaterial(null,{},!0,!1,(function(){i.invalidate(!1,!0,!1)})),o=Y.findMaterial(null,n);if(!t){this.is2d&&J.exit2DMode(),J.enter2DMode(o,this.matman().get2dSelectionColor()),this.is2d||this.saveLightPreset(),this.is2d=!0,this.setLightPreset(u.DefaultLightPreset2d),this.setRenderingPrefsFor2D(!0);const t=e.getData();if(t.hidePaper){var s=t.bgColor,a=s>>16&255,l=s>>8&255,h=255&s;this.setClearColors(a,l,h,a,l,h)}}},this.addModel=function(e,t){if(e){var i=!!this.model,r=e.is2d();this.model||e.getData().underlayRaster||(this.model=e,J.setUnitScale(e.getUnitScale())),this.layers||(this.layers=new E.ModelLayers(this)),e.getData().underlayRaster||this.layers.addModel(e,!0),ne.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),this._setModelPreferences(e),r?this.setUp2DMode(e,i):this.is2d?(this.is2d=void 0,J.exit2DMode()):ce>=0&&(he=ce),this.updateClearColors(),this.setupLighting(e),yt(),this.fireRenderOptionChanged(),this.invalidate(!0),this.api.fireEvent({type:I.MODEL_ADDED_EVENT,model:e,preserveTools:t,isOverlay:i})}},this._setModelPreferences=function(e){e.hideLines(!this.api.prefs.get("lineRendering")),e.hidePoints(!this.api.prefs.get("pointRendering")),e.selector.setSelectionMode(this.api.prefs.get(V.Prefs3D.SELECTION_MODE))},this.setupLighting=function(e){e=e||this.model,(0,r.isNodeJS)()||!e||e.is2d()||(this.setLightPresetFromFile(e)||(he>=0?(this.setLightPreset(he,!0,ue),he=-1,ue=null):this.setLightPreset(le,!1)),this.setAOHeuristics(e))},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return Y},this.setupMesh=function(e,t,i,r){const n={geometry:t,matrix:r};return i&&(n.material=this.matman().setupMaterial(e,t,i)),n.isLine=t.isLines,n.isWideLine=t.isWideLines,n.isPoint=t.isPoints,n.is2d=t.is2d,e.is2d()&&(n.geometry.creationTime=we,this.lastTime2dGeometryCreated=we),n},this.selection2dOverlayName=function(e){return Y._getMaterialHash(e,"selection2d")},this.init2dSelection=function(e){var t=this.selection2dOverlayName(e);if(this.overlayScenes[t])return;var r=Y.initSelectionTexture(e.getData().maxObjectNumber,e.id);const n=e.getFragmentList(),o=e.getDoNotCut();let s;if(null!=n&&n.viewBounds){const e=n.viewBounds;s=new D.Vector4(e.min.x,e.min.y,e.max.x,e.max.y)}var a=Y.create2DMaterial(e,{doNotCut:o,viewportBounds:s},!1,r,(function(){i.invalidate(!1,!0,!1)})),l=Y.findMaterial(e,a);this.createOverlayScene(t,l)},this.onLoadComplete=function(e){Ce=!1,this.signalProgress(100,o.ProgressState.LOADING,e),this.modelVisible(e.id)&&((ie&&ie.enabled||re)&&this.sceneUpdated(!1,!0),this.invalidate(!!re,!0,!1)),e.is2d()&&this.init2dSelection(e);var t=e.getGeometryList();t&&t.printStats(),e.hasGeometry()?Y.hasTransparentMaterial()&&this.requestSilentRender():f.logger.warn("Loaded model has no geometry."),this.api.dispatchEvent({type:I.GEOMETRY_LOADED_EVENT,model:e})},this.onTextureLoadComplete=function(e){this.api.dispatchEvent({type:I.TEXTURES_LOADED_EVENT,model:e}),this.requestSilentRender()},this.signalProgress=function(e,t,i){be.percent===e&&be.state===t&&i&&be.model&&be.model.id===i.id||(be.percent=e,be.state=t,i&&(be.model=i),this.api.dispatchEvent(be))},this.resize=function(e,t,i){G=!0,z=e,H=t,i&&qe(!0)},this.unloadModel=function(e,t){if(this.api.dispatchEvent({type:I.BEFORE_MODEL_UNLOAD_EVENT,model:e}),this.removeModel(e)||ne.removeHiddenModel(e)){var i,r;if(!t)if(e.dtor(),Y.cleanup(e),e.loader)null===(i=(r=e.loader).dtor)||void 0===i||i.call(r),e.loader=null;e.is2d()&&this.overlayScenes[e.id]&&this.removeOverlayScene(this.selection2dOverlayName(e)),this.api.dispatchEvent({type:I.MODEL_UNLOADED_EVENT,model:e})}},this._reserveLoadingFile=function(){this.loaders||(this.loaders=[]);var e={dtor:function(){}};return this.loaders.push(e),e},this._hasLoadingFile=function(){return this.loaders&&this.loaders.length>0},this._addLoadingFile=function(e,t){if(this.loaders){var i=this.loaders.indexOf(e);i>=0&&(this.loaders[i]=t)}},this._removeLoadingFile=function(e){if(this.loaders){var t=this.loaders.indexOf(e);t>=0&&this.loaders.splice(t,1)}},this.removeModel=function(e){return!!ne.removeModel(e)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),this.selector.removeModel(e),this.visibilityManager.removeModel(e),this.layers.removeModel(e),e===this.model&&(this.model=null,ne.isEmpty()||(this.model=ne.getModels()[0])),yt(),this.invalidate(!0,!0,!0),this.api.fireEvent({type:I.MODEL_REMOVED_EVENT,model:e}),!0)},this.cancelLoad=function(e){if(this.loaders)for(var t=0;t<this.loaders.length;t++){var i=this.loaders[t];if(i.currentLoadPath===e){i.dtor(),this.loaders.splice(t,1);break}}},this.unloadCurrentModel=function(){this.model&&(this.is2d?(this.is2d=void 0,this.removeOverlayScene(this.selection2dOverlayName(this.model)),J.exit2DMode()):he=le,this.model.is3d()&&(ce=le),J.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),J.composeFinalFrame(!0)),this.loaders&&(this.loaders.forEach((function(e){e.dtor()})),this.loaders=[]);for(var e=ne.getAllModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t]);this.model=null};var bt=function(){var e,t,r;i.selectionMaterialBase=new D.MeshPhongMaterial({specular:526344,opacity:1,transparent:!1}),i.selectionMaterialTop=new D.MeshPhongMaterial({specular:526344,opacity:.15,transparent:!0}),i.selectionMaterialTop.packedNormals=!0,i.selectionMaterialBase.packedNormals=!0,e="selection",t=i.selectionMaterialBase,r=i.selectionMaterialTop,t.depthWrite=!1,t.depthTest=!0,t.side=D.DoubleSide,r.depthWrite=!1,r.depthTest=!0,r.side=D.DoubleSide,Y.addInstancingSupport(t),Y.addInstancingSupport(r),i.createOverlayScene(e,t,r),i.highlightMaterial=new D.MeshPhongMaterial({specular:526344,opacity:1,transparent:!1}),i.highlightMaterial.packedNormals=!0,Y.addInstancingSupport(i.highlightMaterial),Y.addMaterial("__highlightMaterial__",i.highlightMaterial,!0)};this.createOverlayScene=function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t&&Y.addOverrideMaterial(e+"_pre",t),i&&Y.addOverrideMaterial(e+"_post",i);var a=new D.Scene;return a.__lights=this.scene.__lights,this.overlayScenes[e]={scene:a,camera:r,materialName:e,materialPre:t,materialPost:i,needIdTarget:n,needSeparateDepth:o,hiddenFromMainRender:s}},this.removeOverlayScene=function(e){if(this.overlayScenes[e]){var t=this.overlayScenes[e];t.materialPre&&Y.removeMaterial(t.materialName+"_pre"),t.materialPost&&Y.removeMaterial(t.materialName+"_post"),delete this.overlayScenes[e],this.invalidate(!1,!1,!0)}},this.addOverlay=function(e,t){this.overlayScenes[e]&&t&&(this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0))},this.addMultipleOverlays=function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&this.addOverlay(e,t[i])},this.removeOverlay=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.overlayScenes[e]&&t&&(this.overlayScenes[e].scene.remove(t),i&&t.geometry&&t.geometry.dispose(),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&this.removeOverlay(e,t[r],i)},this.clearOverlay=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.overlayScenes[e]){var i,r,n=this.overlayScenes[e].scene;for(r=n.children.length-1;r>=0;--r)(i=n.children[r])&&(n.remove(i),t&&i.geometry&&i.geometry.dispose());this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,i,n,o,s){this.clearColorTop=new D.Vector3(e/255,t/255,i/255),this.clearColorBottom=new D.Vector3(n/255,o/255,s/255),this.updateClearColors(),re&&re.setClearColors(this.clearColorTop,this.clearColorBottom,(0,r.isMobileDevice)()),ge=!0,this.fireRenderOptionChanged()},this.setClearAlpha=function(e){J.setClearAlpha(e)};var xt=new D.Box3;function _t(e,t,i){t.updateMatrixWorld(!0),t.traverse((function(t){var r=t.geometry;const n=t.model&&"number"==typeof t.fragId;if(!n||r.boundingBox)void 0!==r&&t.visible&&(r.boundingBox||r.computeBoundingBox(),xt.copy(r.boundingBox),xt.applyMatrix4(t.matrixWorld),i&&!i(xt)||e.union(xt));else{const r=n&&t.model.getFragmentList();r&&(r.getWorldBounds(t.fragId,xt),i&&!i(xt)||e.union(xt))}}))}var Et,At=new D.Box3;this.getVisibleBounds=function(e,t,r,n){var o=new D.Box3;return ne.isEmpty()||(_t(o,this.scene,r),o=ne.getVisibleBounds(e,r,n).union(o),t&&(o=function(e){At.makeEmpty();var t=i.overlayScenes;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&_t(At,t[r].scene,e);return _t(At,i.scene,e),_t(At,i.sceneAfter,e),At}(r).union(o))),o},this.getFitBounds=function(e){var t;return e||null===this.selector||(t=this.selector.getSelectionBounds()),t&&!t.isEmpty()||(t=this.getVisibleBounds()).isEmpty()&&this.model.is2d()&&(t=this.model.getBoundingBox()),t},this.getRenderProxy=function(e,t){var i;return null===(i=e.getFragmentList())||void 0===i?void 0:i.getVizmesh(t)},this.getLayersRoot=function(){return this.layers.getRoot()},this.getFragmentProxy=function(e,t){return new A.FragmentPointer(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(){return!ne||ne.areAllVisible()},this.isNodeVisible=function(e,t){return this.visibilityManager.isNodeVisible(t,e)},this.highlightObjectNode=function(e,t,i,r){t=e.reverseMapDbIdFor2D(t),e.is2d()&&(Y.highlightObject2D(t,i,e.id),this.invalidate(!1,!1,!0)),this.renderer().setDbIdForEdgeDetection(i&&!r?t:0,i?e.id:0);var n=this,o=e.getData().instanceTree;if(o&&!e.is2d())if(e.useIdBufferSelection){var s=e.getData().fragments.dbId2fragId[t];n.highlightFragment(e,s,i,r)}else o.enumNodeFragments(t,(function(t){n.highlightFragment(e,t,i,r)}),!1);else{let o=t;if(e.is2d()&&e.getData().fragments&&(o=e.getData().fragments.dbId2fragId[t]),Array.isArray(o))for(var a=0;a<o.length;a++)n.highlightFragment(e,o[a],i,r);else n.highlightFragment(e,o,i,r)}},this.highlightFragment=function(e,t,i,r){if(e.isLeaflet())return e.getIterator().highlightSelection(i,this.highlightMaterial.color),void this.invalidate(!0);var n=this.getRenderProxy(e,t);if(n){var o=!r||n.is2d||n.isPoint||n.themingColor,s=e.id+":"+t;if(o){var a="selection";if(e.is2d()&&(a=this.selection2dOverlayName(e)),n.isPoint&&(a+="_points"),i)if(n.is2d&&Object.prototype.hasOwnProperty.call(this.selectionMeshes,s))++this.selectionMeshes[s]._lmv_highlightCount;else{var l;if(!n||!n.geometry)return;if(n.isPoint){var h=n.material.clone();h.color=this.selectionMaterialBase.color,h.needsUpdate=!0,h.defines&&n.geometry.attributes.pointScale&&(h.defines.PARTICLE_FLAGS=1),l=new D.Mesh(n.geometry,h)}else l=new D.Mesh(n.geometry,n.material);l.matrix.copy(n.matrixWorld),l.matrixAutoUpdate=!1,l.matrixWorldNeedsUpdate=!0,l.frustumCulled=!1,l.model=e,l.fragId=t,l._lmv_highlightCount=1,this.addOverlay(a,l),this.selectionMeshes[s]=l}else if(Object.prototype.hasOwnProperty.call(this.selectionMeshes,s)){var c=this.selectionMeshes[s];--c._lmv_highlightCount<=0&&(this.removeOverlay(a,c),delete this.selectionMeshes[s])}}o&&i||e.setHighlighted(t,i)&&this.invalidate(!0)}},this.explode=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Object.keys(t);for(let e of i)Object.prototype.hasOwnProperty.call(Se,e)||f.logger.warn(`Property "${e}" is not part of Explode options.`);const r=(()=>{for(let e of i)if(Object.prototype.hasOwnProperty.call(Se,e)&&t[e]!=Se[e])return!1;return!0})();return((e=Number(e))!=Ae||!r)&&(Ae=e,i.filter((e=>Object.prototype.hasOwnProperty.call(Se,e))).forEach((e=>Se[e]=t[e])),this.refreshExplode(),this.api.dispatchEvent({type:I.EXPLODE_CHANGE_EVENT,scale:e,options:t}),!0)},this.refreshExplode=function(){ne.explode(Ae,Se),this.sceneUpdated(!0)},this.getExplodeScale=function(){return Ae},this.getExplodeOptions=function(){return{...Se}},this.lockExplode=function(e,t,i){const r=(i=i||this.model).getData().instanceTree;if(!r)return!1;const n=function(e,i){return r.enumNodeChildren(i,(function(i){e=r.lockNodeExplode(i,t)||e}),!0),e};let o;return o=Array.isArray(e)?e.reduce(n,!1):n(!1,e),o&&Ae>0&&(ne.explode(Ae),this.sceneUpdated(!0)),o},this.isExplodeLocked=function(e,t){const i=(t=t||this.model).getData().instanceTree;return i&&i.isNodeExplodeLocked(e)},this.setGhostingBrightness=function(e){var t=new D.Color(e?1052688:16777215);function i(e){e.color=t}i(this.fadeMaterial),this.fadeMaterial.variants&&this.fadeMaterial.variants.forEach(i)},this.loadCubeMapFromColors=function(e,t){var i=(0,S.CreateCubeMapFromColors)(e,t);return i.isBgColor=!0,Y.setReflectionMap(i),i},this.loadCubeMap=function(e,t){this._reflectionMapPath=e;return m.TextureLoader.loadCubeMap(e,t,(function(t){e===i._reflectionMapPath&&Y&&(Y.setReflectionMap(t),i.invalidate(!0),t?u.LightPresets[le].useIrradianceAsBackground||J.setCubeMap(t):i.loadCubeMapFromColors(i.clearColorTop,i.clearColorBottom))}))},this.loadIrradianceMap=function(e,t){this._irradianceMapPath=e;return m.TextureLoader.loadCubeMap(e,t,(function(t){e===i._irradianceMapPath&&Y&&(Y.setIrradianceMap(t),i.invalidate(!0),u.LightPresets[le].useIrradianceAsBackground&&J.setCubeMap(t))}))},this.setCurrentLightPreset=function(e){le=e},this.setLightPreset=function(e,t,i){var n;if((0,r.isNodeJS)()&&(e=0),this.initLights(),le===e&&!t)return void(i&&i());if((e<0||u.LightPresets.length<=e)&&(e=u.DefaultLightPreset),le=e,ne.isEmpty())return he=le,void(ue=i);var o=u.LightPresets[e],s=o.bgColorGradient;if(s||(s=u.BackgroundPresets.Custom),this.setClearColors(s[0],s[1],s[2],s[3],s[4],s[5]),void 0!==o.useIrradianceAsBackground&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?f.logger.debug("setLightPreset(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(o.useIrradianceAsBackground))),o.path){var a="res/environments/"+o.path,l=(0,w.getResourceUrl)(a+"_mipdrop."+(o.type||"")+".dds"),h=(0,w.getResourceUrl)(a+"_irr."+(o.type||"")+".dds");this.loadIrradianceMap(h,o.E_bias),this.loadCubeMap(l,o.E_bias),Y.setEnvExposure(-o.E_bias),J.setEnvExposure(-o.E_bias),this.setTonemapExposureBias(o.E_bias),this.setTonemapMethod(o.tonemap),this.setGhostingBrightness(o.darkerFade)}else{var c=this.loadCubeMapFromColors(this.clearColorTop,this.clearColorBottom);J.setCubeMap(c),Y.setIrradianceMap(null),Y.setEnvExposure(-o.E_bias||0),J.setEnvExposure(-o.E_bias||0),this.setTonemapExposureBias(o.E_bias||0),this.setTonemapMethod(o.tonemap||0),this.setGhostingBrightness(o.darkerFade),J.toggleEnvMapBackground(Pe),this.invalidate(!0)}const d=null===(n=ne)||void 0===n?void 0:n.getModels().filter((e=>{var t;const i=null==e?void 0:e.getDocumentNode(),r=(null==i?void 0:i.getInputFileType())||(null==i||null===(t=i.getRootNode())||void 0===t||null===(t=t.data)||void 0===t?void 0:t.name)||"";return["dwfx","dwf"].includes(r.toLowerCase())}));d.length>0&&d.forEach((e=>{Y.forEachInModel(e,!1,(e=>{e.emissiveOrig||(e.emissiveOrig=e.emissive),e.emissive=e.emissiveOrig.clone().multiplyScalar(Math.pow(2,-o.E_bias))}))}));var p=M.SAOShader.uniforms.radius.value,m=M.SAOShader.uniforms.intensity.value;Object.prototype.hasOwnProperty.call(o,"saoRadius")&&(p=o.saoRadius),Object.prototype.hasOwnProperty.call(o,"saoIntensity")&&(m=o.saoIntensity),J.setAOOptions(p,m);var g=1;null!==o.lightMultiplier&&void 0!==o.lightMultiplier&&(g=o.lightMultiplier),fe.copy(pe),o.lightDirection&&fe.fromArray(o.lightDirection).negate(),ee&&Ye(),this.dir_light1&&(this.dir_light1.intensity=g,o.lightDirection?this.dir_light1.position.set(-o.lightDirection[0],-o.lightDirection[1],-o.lightDirection[2]):this.dir_light1.position.copy(me)),Y.setEnvRotation(o.rotation||0),J.setEnvRotation(o.rotation||0),re&&re.setEnvRotation(o.rotation||0),this.toggleLights(0!==g),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged(),i&&i()},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1;let t;var i=e.getMetadata("renderEnvironmentGroundReflection","value",null);t=this.api.prefs.hasTag(V.Prefs3D.GROUND_REFLECTION,"ignore-producer"),null===i||t||(this.api.prefs.tag("no-storage",V.Prefs3D.GROUND_REFLECTION),this.api.setGroundReflection(i));var n=e.getMetadata("renderEnvironmentGroundShadow","value",null);t=this.api.prefs.hasTag(V.Prefs3D.GROUND_SHADOW,"ignore-producer"),null===n||t||(this.api.prefs.tag("no-storage",V.Prefs3D.GROUND_SHADOW),this.api.setGroundShadow(n));var o=e.getMetadata("renderEnvironmentAmbientShadows","value",null);t=this.api.prefs.hasTag(V.Prefs3D.AMBIENT_SHADOWS,"ignore-producer"),null===o||t||(this.api.prefs.tag("no-storage",V.Prefs3D.AMBIENT_SHADOWS),this.api.setQualityLevel(o,J.getAntialiasing()));var s=e.getMetadata("renderEnvironmentDisplayLines","value",null);t=this.api.prefs.hasTag(V.Prefs3D.LINE_RENDERING,"ignore-producer"),null===s||t||(this.api.prefs.tag("no-storage",V.Prefs3D.LINE_RENDERING),this.api.hideLines(!s));var a=e.getMetadata("renderEnvironmentDisplayPoints","value",null);t=this.api.prefs.hasTag(V.Prefs.POINT_RENDERING,"ignore-producer"),null===a||t||(this.api.prefs.tag("no-storage",V.Prefs.POINT_RENDERING),this.api.hidePoints(!a));var l=e.getMetadata("renderEnvironmentDisplayEdges","value",null);t=this.api.prefs.hasTag(V.Prefs3D.EDGE_RENDERING,"ignore-producer"),null===l||t||(this.api.prefs.tag("no-storage",V.Prefs3D.EDGE_RENDERING),this.api.setDisplayEdges(!(0,r.isMobileDevice)()&&!!l));var h=e.getMetadata("renderEnvironmentStyle","value",null),c=u.LightPresets.filter((function(e){return e.name===h}))[0];if(t=this.api.prefs.hasTag(V.Prefs3D.LIGHT_PRESET,"ignore-producer"),c&&!t){this.api.prefs.tag("no-storage",V.Prefs3D.LIGHT_PRESET);var d=j;d||(d=j={},u.LightPresets.push(d)),(0,u.copyLightPreset)(c,d),d.name="Custom Model defined";var p=e.getMetadata("renderEnvironmentExposureBias","value",null),f=e.getMetadata("renderEnvironmentExposureBase","value",null);null!==p&&null!==f&&(d.E_bias=p+f);var m=e.getMetadata("renderEnvironmentBackgroundColor","value",null);t=this.api.prefs.hasTag(V.Prefs.BACKGROUND_COLOR_PRESET,"ignore-producer"),m&&!t&&(d.bgColorGradient=[255*m[0],255*m[1],255*m[2],255*m[0],255*m[1],255*m[2]]);var g=e.getMetadata("renderEnvironmentRotation","value",null);null!==g&&(d.rotation=g);var v=u.LightPresets.indexOf(d);this.setLightPreset(v,!0)}var y=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return t=this.api.prefs.hasTag(V.Prefs3D.ENV_MAP_BACKGROUND,"ignore-producer"),null===y||t||(this.api.prefs.tag("no-storage",V.Prefs3D.ENV_MAP_BACKGROUND),this.api.setEnvMapBackground(y)),c},this.setLightPresetForAec=function(){for(var e=(0,r.getGlobal)().DefaultLightPresetAec||"Boardwalk",t=-1,i=0;i<u.LightPresets.length;i++)if(u.LightPresets[i].name===e){t=i;break}return t>=0&&(this.api.prefs.hasTag("lightPreset","ignore-producer")?f.logger.debug("setLightPresetForAec(): lightPreset is locked. No changes."):(this.api.prefs.tag("no-storage","lightPreset"),this.setLightPreset(t,!0,function(){this.api.prefs.tag("ignore-producer","envMapBackground")}.bind(this)),this.saveLightPreset())),this.api.prefs.hasTag("edgeRendering","ignore-producer")?f.logger.debug("setLightPresetForAec(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!(0,r.isMobileDevice)())),!0},this.setAOHeuristics=function(e){var t=e.getUnitScale(),i=e.getMetadata("renderEnvironmentAmbientShadows","radius",void 0),r=e.getMetadata("renderEnvironmentAmbientShadows","intensity",void 0),n=e.getMetadata("renderEnvironmentAmbientShadows","opacity",void 0);if(void 0!==i||void 0!==r||void 0!==n)J.setAOOptions(i/t,r,n);else if(e.isAEC()){t>.3?J.setAOOptions(4/t,1,.625):J.setAOOptions(.25/t,1,.625)}else{var o=e.getData().bbox.getSize(new D.Vector3).length();J.setAOOptions(Math.min(10,.05*o))}},this.setTonemapMethod=function(e){e!=J.getToneMapMethod()&&(J.setTonemapMethod(e),Y.setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=J.getExposureBias()&&(J.setTonemapExposureBias(e),Y.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setRenderingPrefsFor2D=function(e){if(!(0,r.isNodeJS)()){var t=!e&&!!this.api.prefs.get("envMapBackground");this.toggleEnvMapBackground(t)}},this.dtor=function(){var e;this.stop(),this.api.removeEventListener(I.MODEL_ROOT_LOADED_EVENT,Ve),this.api.removeEventListener(I.MODEL_ROOT_LOADED_EVENT,Ue),this.api.removeEventListener(I.LOADER_REPAINT_REQUEST_EVENT,Be),this.unloadCurrentModel(),this.controls=null,this.canvas=null,clearInterval(this.interval),this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.layers=null,this.visibilityManager=null,Oe&&(Oe.removeViewer(this.api),Oe=null),ne=null,null===(e=J)||void 0===e||e.cleanup(),J=null,Y.refCount--,0===Y.refCount&&Y.dtor(),Y=null,Z&&(Z.refCount--,0===Z.refCount&&(Z.domElement=null,Z.context=null),Z.removeEventListener(W.Events.WEBGL_CONTEXT_LOST,this.onWebGLcontextLost),Z.removeEventListener(W.Events.WEBGL_CONTEXT_RESTORED,this.onWebGLcontextRestored),Z=null)},this.hideLines=function(e){ne&&!ne.isEmpty()&&(ne.hideLines(e),this.sceneUpdated(!0))},this.hidePoints=function(e){ne&&!ne.isEmpty()&&(ne.hidePoints(e),this.sceneUpdated(!0))},this.setDisplayEdges=function(e){J.toggleEdges(e);var t=e;e||(t=!(!this.model||!this.model.getData().hasLines)),Y.togglePolygonOffset(t),J.setDepthMaterialOffset(Y.getPolygonOffsetOn(),Y.getPolygonOffsetFactor(),Y.getPolygonOffsetUnits()),this.invalidate(!0)},this.setDoubleSided=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if((t=t||this.model).is2d())return;t.getData()&&(this.matman().setDoubleSided(e,t),i&&this.sceneUpdated())},this.getAllCutPlanes=function(){var e=void 0;for(var t in Ge){var i=Ge[t];i&&i.length&&(e=e?t===He?i.concat(e):e.concat(i):i)}return e},this.setCutplanesHideInterior=function(e){ze=Boolean(e)},this.cutplanesHideInteriorEnabled=function(){return ze},this.updateCutPlanes=function(){var e=this.getAllCutPlanes();this.setCutPlanes(e)},this.setCutPlaneSet=function(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(Ge[e]=t?t.slice():void 0,i)this.updateCutPlanes();else{var r=this.getAllCutPlanes();this.setCutPlanesInScene(r)}},this.setCutPlaneSetFor2DRendering=function(e){He=e,this.updateCutPlanes()},this.getCutPlaneSet=function(e){return Ge[e]||[]},this.getCutPlaneSets=function(){var e=[];for(var t in Ge){var i=Ge[t];i&&i.length&&e.push(t)}return e},this.getCutPlanes=function(){return Y.getCutPlanes()},this.setCutPlanesInScene=function(e){J.toggleTwoSided(Y.setCutPlanes(e,ze?1:0)),this.sceneUpdated()},this.setCutPlanes=function(e){this.setCutPlanesInScene(e),this.api.dispatchEvent({type:I.CUTPLANES_CHANGE_EVENT,planes:e})},this.fireRenderOptionChanged=function(){Y.toggleMRTSetting(J.mrtFlags()),this.api.dispatchEvent({type:I.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.camera).viewportToRay(e,t)},this.rayIntersect=function(e,t,i,r,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(o.ignore2dModelsOn3d){const e=this.get3DModels().map((e=>e.id));r=r?r.filter((t=>e.includes(t))):e}var s=ne.rayIntersect(e.origin,e.direction,t,i,r,n,(e=>{const t=(new D.Vector3).copy(e);t.project(this.camera);const i=[];return J.idAtPixel(t.x,t.y,i),i}),o),a=[this.scene,this.sceneAfter];const l=new D.Vector3;for(let t=0;t<a.length;t++){let i=a[t];if(i.children.length){var h=new D.Raycaster(e.origin,e.direction,this.camera.near,this.camera.far);_t(At,i),h.params.Line.threshold=Math.min(1,.5*At.getSize(l).length()*.001);var c=n||[];if(T.VBIntersector.intersectObject(i,h,c,!0),c.length){const e=c[0];(!s||e.distance<s.distance)&&(void 0!==e.modelId&&(e.model=this.findModel(e.modelId)),s=e)}}}return s?(void 0===s.dbId&&void 0!==s.fragId&&(s.dbId=s.model.getFragmentList().getDbIds(s.fragId),s.model.getData().instanceTree||(s.dbId=s.fragId)),s.intersectPoint=s.point,s):null},this.castRayViewport=function(e,t,i,r,n,o){return Et=Et||new D.Ray,ne?(this.viewportToRay(e,Et),this.rayIntersect(Et,t,i,r,n,o)):{}},this.getCanvasBoundingClientRect=function(){return this.canvasBoundingclientRectDirty&&(this.canvasBoundingclientRectDirty=!1,this.boundingClientRect=this.canvas.getBoundingClientRect()),this.boundingClientRect},this.clientToViewport=function(e,t){var i=this.getCanvasBoundingClientRect();return new D.Vector3((e+.5)/i.width*2-1,-(t+.5)/i.height*2+1,1)},this.viewportToClient=function(e,t){var i=this.getCanvasBoundingClientRect();return new D.Vector3(.5*(e+1)*i.width-.5,-.5*(t-1)*i.height-.5,0)},this.castRay=function(e,t,i,r){return this.castRayViewport(this.clientToViewport(e,t),i,void 0,void 0,void 0,r)},this.intersectGroundViewport=function(e){var t="z";this.is2d||(t=de);var i=this.model&&this.model.getBoundingBox();return F.SceneMath.intersectGroundViewport(e,this.camera,t,i)},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))},this._2dHitTestViewport=function(e,t,i){const r=[0,0],n=J.idAtPixels(e.x,e.y,t,r);if(n<i)return null;const o=ne.findModel(r[1])||this.model;if(!o)return null;const s=this.intersectGroundViewport(e),a=o.getData().fragments,l=a?a.dbId2fragId[n]:-1;return{intersectPoint:s,dbId:o.remapDbIdFor2D(n),fragId:l,model:o}};const St=e=>t=>{if(!(t&&t.object&&t.object.isLine))return!0;const r=1/i.camera.pixelsPerUnitAtDistance(t.distance),n=e*r;return t.distanceToRay<n};function wt(e,t,i,r){var n=e.getFragmentList().getGeometry(t);new C.VertexBufferReader(n).enumGeomsForVisibleLayer(i,r)}function Mt(e,t,i,r){var n=e.getFragmentList().getGeometry(t);new C.VertexBufferReader(n).enumGeomsForObject(i,r)}this.hitTestViewport=function(e,t,i,n,o,s){let a;if(this.is2d){const t=(0,r.isMobileDevice)()?45:5;a=this._2dHitTestViewport(e,t,1)}else a=this.castRayViewport(e,t,i,n,o,s);return a},this.hitTest=function(e,t,r,n,o,s){return i.hitTestViewport(this.clientToViewport(e,t),r,n,o,void 0,s)},this.hitBoxTestViewport=function(e,t,i){const r=[],n=[];J.idsAtPixelsBox(e.x,e.y,t,i,n);for(let e=0;e<n.length;e++){const t=ne.findModel(n[e][1])||this.model;if(t){const i=t.remapDbIdFor2D(n[e][0]);r.push({dbId:i,model:t})}}return r},this.snappingHitTestViewport=function(e,t){let i;const n=(0,r.isMobileDevice)()?45:17;if(this.is2d)if(this.model&&this.model.isLeaflet()){i={intersectPoint:this.intersectGroundViewport(e)}}else i=this._2dHitTestViewport(e,n,0);else{const r=[],o=J.idAtPixels(e.x,e.y,n,r);r[2]&&r[3]&&(e.setX(r[2]),e.setY(r[3]));const s={filter:St(n)};i=this.castRayViewport(e,t,o>0?[o]:null,void 0,void 0,s)}return i},this.snappingHitTest=function(e,t,i){return this.snappingHitTestViewport(this.clientToViewport(e,t),i)},this.clearHighlight=function(){J.rolloverObjectId(-1),this.invalidate(!1,!1,!0)},this.rollOverIdChanged=function(){this.api.fireEvent({type:I.OBJECT_UNDER_MOUSE_CHANGED,dbId:J.getRollOverDbId(),modelId:J.getRollOverModelId()}),this.invalidate(!1,!1,!0)},this.rolloverObjectViewport=function(e){if(!this.model)return;if(this.is2d&&this.model&&(this.model.isLeaflet()||this.model.isPdf(!0)&&this.api.prefs.get(V.Prefs2D.DISABLE_PDF_HIGHLIGHT)))return;const t=[],i=J.idAtPixel(e.x,e.y,t);if(this.selector&&this.selector.isNodeSelectionLocked(i,this.model))return void this.clearHighlight();const r=t[1],n=this.findModel(r);null!=n&&n.isLeaflet()?J.rollOverModelId(r)&&this.rollOverIdChanged():J.rolloverObjectViewport(e.x,e.y)&&this.rollOverIdChanged()},this.rolloverObject=function(e,t){this.selector.highlightPaused||this.selector.highlightDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.pauseHighlight=function(e){this.selector.highlightPaused=e,e&&this.clearHighlight()},this.disableHighlight=function(e){this.selector.highlightDisabled=e,e&&this.clearHighlight()},this.disableSelection=function(e){this.selector.selectionDisabled=e},this.cancelLeafletScreenshot=function(){i.api.dispatchEvent({type:I.CANCEL_LEAFLET_SCREENSHOT})},this.getScreenShotProgressive=function(e,t,i,r){return n.ScreenShot.getScreenShot(e,t,i,r,this)},this.modelQueue=function(){return ne},this.glrenderer=function(){return Z},this.renderer=function(){return J},this.setGeomCache=function(e){(Oe=e).addViewer(i.api)},this.geomCache=function(){return Oe||this.setGeomCache(new p.OtgResourceCache(i.api.config)),Oe},this.shadowMaps=function(){return ee},this.worldUp=function(){return k},this.worldUpName=function(){return de},this.setUserRenderContext=function(e,t){J=e||new a.RenderContext,t||(J.init(Z,this.canvas.clientWidth,this.canvas.clientHeight),J.setClearColors(this.clearColorTop,this.clearColorBottom)),this.invalidate(!0),this.sceneUpdated(!1)},this.setUserGroundShadow=function(e){var t=ie;return ie=e,t},this.invalidate=function(e,t,i){ge||(ge=e),ve||(ve=t),ye||(ye=i)},this.isOverlayDirty=function(){return ye},this.clearOverlayDirtyFlag=function(){ye=!1},this.sceneUpdated=function(e,t,i){this.invalidate(!t,!1,!t),ne&&e&&(ne.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),xe=!0,Ye(),i||this.api.fireEvent({type:I.SCENE_UPDATED_EVENT,objectsMoved:e})},this.requestSilentRender=function(){_e=Ee=!0},this.requestDeferredSilentRender=function(){_e=!0},this.currentLightPreset=function(){return le},this.saveLightPreset=function(){he=le},this.matman=function(){return Y},this.fps=function(){return 1e3/Me},this.setFPSTargets=function(e,t,i){oe=1e3/i,ae=1,se=1e3/t,this.targetFrameBudget=(0,r.isMobileDevice)()?se/4:se},this.track=function(e){f.logger.track(e)},this.worldToClient=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.camera;var i=new D.Vector4(e.x,e.y,e.z,1);return i.applyMatrix4(t.matrixWorldInverse),i.applyMatrix4(t.projectionMatrix),i.w>0&&(i.x/=i.w,i.y/=i.w,i.z/=i.w),this.viewportToClient(i.x,i.y)},this.clientToWorld=function(e,t,i,r,n){var o=null;if(this.is2d){var s=this.model,a=null==s?void 0:s.getData(),l=this.intersectGround(e,t);l?(l.z=0,(r||a.hidePaper||a.bbox.containsPoint(l))&&(o={point:l,model:s})):r&&(o={point:this.camera.position.clone(),model:s})}else(o=this.hitTest(e,t,i,void 0,void 0,{ignore2dModelsOn3d:n}))&&(o.point=o.intersectPoint);return o},this.set2dSelectionColor=function(e,t){this.matman().set2dSelectionColor(e,t),this.invalidate(!1,!1,!0)},this.setSelectionColor=function(e,t){t=t||O.SelectionType.MIXED;var i=new D.Color(e);i.multiplyScalar(.5);var r=function(t){t.color.set(e),t.emissive.set(i),t.variants&&t.variants.forEach(r)};switch(t){default:case O.SelectionType.MIXED:r(this.selectionMaterialBase),r(this.selectionMaterialTop),J.setSelectionColor(e),r(this.highlightMaterial),this.invalidate(!0);break;case O.SelectionType.REGULAR:r(this.highlightMaterial),this.invalidate(!0);break;case O.SelectionType.OVERLAYED:r(this.selectionMaterialBase),r(this.selectionMaterialTop),J.setSelectionColor(e),this.invalidate(!1,!1,!0)}},this.updateViewportId=function(e){Y.updateViewportId(e),this.invalidate(!0)},this.findModel=function(e,t){let i;if("number"==typeof e)i=t=>t.id==e;else if(e instanceof N.BubbleNode)i=t=>t.getDocumentNode()==e;else{if(!e)return null;i=e}let r=ne.getModels().find(i);return t&&!r&&(r=ne.getHiddenModels().find(i)),r},this.getFrameRate=function(){return this.frameDisplayRate},this.setFrameRate=function(e){this.frameDisplayRate=e<1?1:e},this.setShadowLightDirection=function(e){fe.copy(e),Ye(),this.invalidate(!0,!1,!1),Xe()},this.getShadowLightDirection=function(e){var t=e||new D.Vector3;return t.copy(fe),t},this.toggleShadows=function(e){!!ee!=!!e&&(e?ee=new y.ShadowMaps(Z):(ee.cleanup(Y),ee=null),Xe(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(e){ne.enableNonResumableFrames=e},this.fitToView=function(e,t){(t=!!t,0===e.length)&&(e=ne.getModels().map((function(e){return{model:e,selection:[]}})));if(0===e.length)return!1;for(var i=0,r=0;r<e.length;++r){var n=e[r].model;if(!n)return!1;n.is2d()&&i++}return!!(i===e.length?this._fitToView2d(e,t):this._fitToView3d(e,t))&&(1===ne.getModels().length&&this.api.dispatchEvent({type:I.FIT_TO_VIEW_EVENT,nodeIdArray:e[0].selection,immediate:t,model:e[0].model}),this.api.dispatchEvent({type:I.AGGREGATE_FIT_TO_VIEW_EVENT,selection:e,immediate:t}),!0)},this._fitToView2d=function(e,t){e.length>1&&f.logger.warn("fitToView() doesn't support multiple 2D models. Using the first one...");var i=e[0].model,r=e[0].selection,n=new D.Box3,o=new P.BoundsCallback(n);if(r&&0!==r.length)this.computeSelectionBounds(r,i,o);else if(this.api.anyLayerHidden())for(var s=i.getData().fragments,a=this.getVisibleLayerIndices(),l=0;l<s.length;l++)wt(i,l,a,o);else n=this.getFitBounds(!0);return!n.isEmpty()&&(this.api.navigation.fitBounds(t,n),!0)},this.computeSelectionBounds=function(e,t,i){var r;i||(i=new P.BoundsCallback(new D.Box3));var n=null===(r=t.getData().fragments)||void 0===r?void 0:r.dbId2fragId;if(n){for(var o=0;o<e.length;o++){var s=t.reverseMapDbIdFor2D(e[o]),a=n[s];if(Array.isArray(a))for(var l=0;l<a.length;l++)Mt(t,a[l],s,i);else"number"==typeof a&&Mt(t,a,s,i)}i.bounds.applyMatrix4(t.getPlacementTransform())}else i.bounds.copy(t.getBoundingBox());return i.bounds},this.get3DBounds=function(e){for(var t=!1,i=0;i<e.length;++i)if(e[i].selection.length>0){t=!0;break}var r=new D.Box3,n=new D.Box3;if(t)for(var o=0;o<e.length;++o){var s=e[o].selection;if(0!==s.length){var a=e[o].model,l=a.getInstanceTree(),h=a.getFragmentList();if(l)for(var c=0;c<s.length;++c){var u=parseInt(s[c]);l.enumNodeFragments(u,(function(e){h.getWorldBounds(e,n),r.union(n)}),!0)}}}else r.union(this.getVisibleBounds(!1,!1));return r},this.onModelTransformChanged=function(e){if(this.sceneUpdated(),e.isConsolidated())for(var t in i.selectionMeshes){var r=i.selectionMeshes[t];r.model===e&&(r.needsUpdate=!0)}this.invalidate(!0,!0,!0),this.api.fireEvent({type:I.MODEL_TRANSFORM_CHANGED_EVENT,model:e,matrix:e.getModelTransform()})},this.setPlacementTransform=function(e,t){e.setPlacementTransform(t),this.api.fireEvent({type:I.MODEL_PLACEMENT_CHANGED_EVENT,model:e,matrix:e.getPlacementTransform()}),this.onModelTransformChanged(e)},this._fitToView3d=function(e,t){const i=this.get3DBounds(e);return!i.isEmpty()&&(this.api.navigation.fitBounds(t,i),!0)},this.onWebGLcontextLost=function(){Z.enableContextRestore&&(this._reconsolidateOnRestore=(0,g.I5)(this.api)),this.stop(),this.api.fireEvent({type:I.WEBGL_CONTEXT_LOST_EVENT})},this.onWebGLcontextRestored=function(){(0,g.p1)(this.api,this._reconsolidateOnRestore),this._reconsolidateOnRestore=null,J.clearAllOverlays(),ie.setDirty(),re&&re.setDirty(),this.invalidate(!0,!0,!0),this.run(),this.api.fireEvent({type:I.WEBGL_CONTEXT_RESTORED_EVENT})},this.modelVisible=function(e){return!!ne.findModel(e)},this.handleInitialVisibility=function(e){f.logger.info("Hiding objects that are marked as 'hidden'. This can take up to minutes depending on model size ...");var t=this;e.visibilityManager&&e.getObjectTree((i=>setTimeout((()=>function(i){var r=e.getFragmentList();if(!r||r.areAllVisible())return;var n=[];if(!i)return;i.enumNodeChildren(e.getRootId(),(function(e){i.enumNodeFragments(e,(function(e){return r.isFragVisible(e)}),!0)||i.isNodeHidden(e)||i.isNodeOff(e)||n.push(e)}),!0),f.logger.info("Hiding "+n.length+" objects ...");let o=0;if(n.length>0){const i=n.length-1;for(let r=0;r<n.length;++r)t.visibilityManager.setVisibilityOnNode(n[r],!1,e,r!==i,!1),o=Math.round(r/n.length*100),o>0&&o%10==0&&f.logger.info(o+"%")}f.logger.info("Done hiding objects.")}(i)))))},this.changePaperVisibility=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(e.is3d())return void(null==r||r());const o=e.getFragmentList();if(!o)return void(null==r||r());if(e.paperVisibilityAnim&&(e.paperVisibilityAnim.stop(),e.paperVisibilityAnim=null),!i||!n)return e.changePaperVisibility(t),this.invalidate(!0),void(null==r||r());const s=void 0!==o.dbIdOpacity[-1]?o.dbIdOpacity[-1]:t?0:1,a=t?1:0,l=n;e.paperVisibilityAnim=Autodesk.Viewing.Private.fadeValue(s,a,l,(e=>{e=Autodesk.Viewing.Private.smootherStep(e),o.setObject2DOpacity(-1,e),this.invalidate(!0)}),(()=>{e.paperVisibilityAnim=null,null==r||r()}))},this._signalNoMeshes=function(){ne.isEmpty()&&(this._geometryAvailable=0)},this._signalMeshAvailable=function(){0===this._geometryAvailable&&(this._geometryAvailable=1,this.api.fireEvent({type:I.RENDER_FIRST_PIXEL}))},this.hasModels=function(){return!ne.isEmpty()},this.onLoadingAnimationChanged=function(e){Z.setLoadingAnimationDuration(e?this.defaultLoadingAnimationDuration:-1),this.invalidate(!1,!0,!1)},this.isLoadingAnimationEnabled=function(){return this.api.prefs.get(V.Prefs2D.LOADING_ANIMATION)&&(!this.model||this.model.is2d())},this.setMaxModelDistance=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e5;this.maxModelDistance=e},this._applyMaxModelDistanceToNearFar=function(){var e=this.camera;if(e.far<=e.near+this.maxModelDistance)return null;const t=e.near+this.maxModelDistance;const i=this.getVisibleBounds(!0,ye,(function(i){return F.SceneMath.pointToBoxDistance2(e.position,i)<t*t}));this.updateNearFarValues(e,i)},this.consolidateModel=function(e,t){e.consolidate(Y,t,Z,this.useDeferredConsolidation)},this.setDoNotCut=function(e,t){e.setDoNotCut(Y,t)},this.setViewportBounds=function(e,t){e.setViewportBounds(Y,t),this.invalidate(!0),this.api.fireEvent({type:I.MODEL_VIEWPORT_BOUNDS_CHANGED_EVENT,model:e,bounds:t})}}Q.prototype.constructor=Q,k.GlobalManagerMixin.call(Q.prototype)},62832:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ViewerState:()=>s});var r=i(60489),n=i(52156),o=i(37765);function s(e){this.getVisibleModel=function(t){const i=e.getVisibleModels();for(let e=0;e<i.length;++e){const r=i[e];if(this.getSeedUrn(r)===t)return r}},this.createObjectSets=function(t){var i=t.objectSet;Array.isArray(i)||(t.objectSet=i=[]);for(var r=e.getVisibleModels(),n=0;n<r.length;n++){var o=r[n],s=this.getSeedUrn(o),a=this.getSelectedNodes(o);i[n]={id:a,idType:"lmv"},r.length>1&&(i[n].seedUrn=s),o.is2d()?(i[n].isolated=this.getVisibleLayers2d(o),i[n].allLayers=this.areAllLayersVisible(o),i[n].hidden=[]):(i[n].isolated=e.getIsolatedNodes(o),i[n].hidden=e.getHiddenNodes(o),i[n].explodeScale=e.getExplodeScale(),i[n].explodeOptions=e.getExplodeOptions())}},this.getState=function(t){var i=e.navigation,r={};r.seedURN=this.getSeedUrn(),this.createObjectSets(r);var n=r.viewport;n||(n=r.viewport={});var o=i.getCamera().isPerspective;n.name="",n.eye=i.getPosition().toArray(),n.target=i.getTarget().toArray(),n.up=i.getCameraUpVector().toArray(),n.worldUpVector=i.getWorldUpVector().toArray(),n.pivotPoint=i.getPivotPoint().toArray(),n.distanceToOrbit=i.getPivotPlaneDistance(),n.aspectRatio=this.getAspectRatio(),n.projection=o?"perspective":"orthographic",n.isOrthographic=!o,r.autocam={sceneUpDirection:e.autocam.sceneUpDirection.clone(),sceneFrontDirection:e.autocam.sceneFrontDirection.clone(),cubeFront:e.autocam.cubeFront.clone()},o?n.fieldOfView=i.getVerticalFov():n.orthographicHeight=this.getOrthographicHeight();var s=r.renderOptions;if(s||(s=r.renderOptions={}),s.environment=this.getEnvironmentName(),s.ambientOcclusion={enabled:e.impl.renderer().getAOEnabled(),radius:e.impl.renderer().getAORadius(),intensity:e.impl.renderer().getAOIntensity()},s.toneMap={method:e.impl.renderer().getToneMapMethod(),exposure:e.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},s.appearance={ghostHidden:e.impl.showGhosting,ambientShadow:e.prefs.get("ambientShadows"),antiAliasing:e.impl.renderer().settings.antialias,progressiveDisplay:e.prefs.get("progressiveRendering"),swapBlackAndWhite:e.prefs.get("swapBlackAndWhite"),displayLines:e.prefs.get("lineRendering"),displayPoints:e.prefs.get("pointRendering")},!e.impl.is2d)for(var a=r.cutplanes=[],l=e.impl.getCutPlaneSet("__set_view"),h=0;h<l.length;h++)a.push(l[h].toArray());for(var c in e.loadedExtensions){var u=e.loadedExtensions[c];u.getState&&u.getState(r)}return t&&true!==t&&this.applyFilter(r,t),r},this.restoreObjectSet=function(t){var i=t.objectSet;if(Array.isArray(i)&&0!==i.length){for(var r=[],n=[],o=[],s=e.model,a=0;a<i.length;++a){var l=i[a];if("lmv"===l.idType){var h=l.seedUrn;if(!h||(s=this.getVisibleModel(h))){var c=l.id;if(c&&(c=this.toIntArray(c),o.push({model:s,ids:c})),s.is2d()){var u=l.isolated;if(Array.isArray(u)&&u.length>0){e.setLayerVisible(null,!1);for(var d=0;d<u.length;++d)u[d]=parseInt(u[d]);e.impl.setLayerVisible(u,!0)}else l.allLayers||e.setLayerVisible(null,!1)}else{var p=l.isolated||[],f=l.hidden||[];p=this.toIntArray(p),r.push({model:s,ids:p}),0===p.length&&f.length>0&&(f=this.toIntArray(f),n.push({model:s,ids:f}))}if("explodeScale"in l){var m=parseFloat(l.explodeScale),g=l.explodeOptions;e.explode&&e.explode(m,g)}}}}o.length>0&&e.impl.selector.setAggregateSelection(o),r.length>0&&e.impl.visibilityManager.aggregateIsolate(r,{hideLoadedModels:!1}),n.length>0&&e.impl.visibilityManager.aggregateHide(n)}},this.restoreState=function(t,i,n){if(!t)return r.logger.warn("restoreState has no viewer state to restore from."),!1;if(!e||!e.model)return r.logger.warn("restoreState has no viewer or model to restore."),!1;i&&true!==i&&(t=JSON.parse(JSON.stringify(t)),this.applyFilter(t,i));var o=e.navigation,s=!e.impl.is2d;this.restoreObjectSet(t);const a=t.autocam;if(a){const t=e.autocam;t.sceneUpDirection.copy(a.sceneUpDirection),t.sceneFrontDirection.copy(a.sceneFrontDirection),t.cubeFront.copy(a.cubeFront),t.camera.worldup.copy(a.sceneUpDirection),t.cameraChangedCallback(!0)}var l=t.viewport;if(l){var h=this.getVector3FromArray(l.eye,o.getPosition()),c=this.getVector3FromArray(l.up,o.getCameraUpVector()),u=this.getVector3FromArray(l.target,o.getTarget()),d="fieldOfView"in l?parseFloat(l.fieldOfView):o.getVerticalFov(),p=this.getVector3FromArray(l.worldUpVector,null);if(!p){const t=e.getFirstModel(),i=null==t?void 0:t.getUpVector();p=i?(new THREE.Vector3).fromArray(i):new THREE.Vector3(0,1,0)}var f=this.getVector3FromArray(l.pivotPoint,o.getPivotPoint()),m=o.getCamera().isPerspective;"isOrthographic"in l&&(m=!l.isOrthographic);var g=this.getOrthographicHeight();"orthographicHeight"in l&&(g=Number(l.orthographicHeight));var v={position:h,target:u,up:c,worldup:p,aspect:e.impl.camera.aspect,fov:d,orthoScale:g,isPerspective:m,pivot:f};this.restoreCameraState(v,n)}var y=t.renderOptions;if(y){var b=e.impl.renderer(),x=e.prefs,_=x.get("ambientShadows"),E=x.get("antialiasing"),A=y.ambientOcclusion;if(A){"enabled"in A&&(_=A.enabled);var S="radius"in A?A.radius:null,w="intensity"in A?A.intensity:null;null!==S&&null!==w&&(S===b.getAORadius()&&w===b.getAOIntensity()||(b.setAOOptions(S,w),b.composeFinalFrame()))}if("environment"in y){var M=this.getLightPresetIndex(y.environment);-1!==M&&M!==x.get("lightPreset")&&s&&e.setLightPreset(M)}var T=y.toneMap;if(T){var C=!1,P="exposure"in T?T.exposure:null,D="lightMultiplier"in T?T.lightMultiplier:null;null!==P&&P!==b.getExposureBias()&&(b.setTonemapExposureBias(P),C=!0),null!==D&&e.impl.dir_light1&&D!==this.getToneMapIntensity()&&(e.impl.dir_light1.intensity=Math.pow(2,D),C=!0),C&&e.impl.invalidate(!0)}var L=y.appearance;L&&("antiAliasing"in L&&(E=L.antiAliasing),"progressiveDisplay"in L&&L.progressiveDisplay!==x.get("progressiveRendering")&&e.setProgressiveRendering(L.progressiveDisplay),"swapBlackAndWhite"in L&&L.swapBlackAndWhite!==x.get("swapBlackAndWhite")&&e.setSwapBlackAndWhite(L.swapBlackAndWhite),"ghostHidden"in L&&L.ghostHidden!==x.get("ghosting")&&s&&e.setGhosting(L.ghostHidden),"displayLines"in L&&L.displayLines!==x.get("lineRendering")&&e.hideLines(!L.displayLines),"displayPoints"in L&&L.displayPoints!==x.get("pointRendering")&&e.hidePoints(!L.displayPoints)),s&&_!==x.get("ambientShadows")&&E!==x.get("antialiasing")&&e.setQualityLevel(_,E)}if(Array.isArray(t.cutplanes)&&s){for(var I=[],R=0;R<t.cutplanes.length;R++){var O=t.cutplanes[R];Array.isArray(O)&&O.length>=4&&I.push(new THREE.Vector4(O[0],O[1],O[2],O[3]))}!function(t,i){if(e.getExtension("Autodesk.AEC.LevelsExtension")&&void 0===t.floorGuid){const e=i.length;if(3===e||8===e){const t=i[e-2],r=i[e-1];0===t.x&&0===t.y&&-1===t.z&&0===r.x&&0===r.y&&1===r.z&&i.splice(-2,2)}}}(t,I),e.impl.setCutPlaneSet("__set_view",I)}for(var N in e.loadedExtensions){var F=e.loadedExtensions[N];F.restoreState&&F.restoreState(t,n)}return!0},this.getEnvironmentName=function(){var t=n.LightPresets[e.impl.currentLightPreset()];return t?t.name:"none"},this.restoreCameraState=function(t,i){e.impl.adjustOrthoCamera(t);var r=e.navigation;i?(t.isPerspective?r.toPerspective():r.toOrthographic(),r.setCameraUpVector(t.up),r.setWorldUpVector(t.worldup),r.setView(t.position,t.target),r.setPivotPoint(t.pivot),r.setVerticalFov(t.fov,!1),e.impl.syncCamera(!0)):(e.impl.camera.isPerspective=t.isPerspective,r.setRequestTransitionWithUp(!0,t.position,t.target,t.fov,t.up,t.worldup,t.pivot))},this.areEqual=function(e,t,i){var r,n,o,s;function a(e,t){if(t=t||[],(e=e||[]).length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function l(e,t,i){return t=t||[],(e=e||[]).length===t.length&&(0!==e.length&&(h(e[0],t[0],i)||h(e[1],t[1],i)||h(e[2],t[2],i)))}function h(e,t,i){var r=e?parseFloat(e):null,n=e?parseFloat(t):null;return"number"===typeof r&&"number"===typeof n?Math.abs(e-t)<i:(e=e||null)===(t=t||null)}var c=e,u=t,d=1e-9;if(i&&!0!==i&&(c=this.applyFilter(c,i),u=this.applyFilter(u,i)),c.seedURN!==u.seedURN)return!1;var p=c.objectSet||[],f=u.objectSet||[];if(p.length!==f.length)return!1;var m=p[0]||{},g=f[0]||{};if(!(m.idType===g.idType&&h(m.explodeScale,g.explodeScale,d)&&h(null===(r=m.explodeOptions)||void 0===r?void 0:r.magnitude,null===(n=g.explodeOptions)||void 0===n?void 0:n.magnitude,d)&&h(null===(o=m.explodeOptions)||void 0===o?void 0:o.depthDampening,null===(s=g.explodeOptions)||void 0===s?void 0:s.depthDampening,d)&&a(m.id,g.id)&&a(m.isolated,g.isolated)&&a(m.hidden,g.hidden)))return!1;var v=c.viewport||{},y=u.viewport||{};return!!(v.name===y.name&&v.projection===y.projection&&v.isOrthographic===y.isOrthographic&&h(v.distanceToOrbit,y.distanceToOrbit,d)&&h(v.fieldOfView,y.fieldOfView,d)&&h(v.orthographicHeight,y.orthographicHeight,d)&&l(v.eye,y.eye,d)&&l(v.target,y.target,d)&&l(v.up,y.up,d)&&l(v.worldUpVector,y.worldUpVector,d)&&l(v.pivotPoint,y.pivotPoint,d))},this.toIntArray=function(e){var t=[];if(Array.isArray(e))for(var i=0,r=e.length;i<r;++i)t.push(parseInt(e[i]));return t},this.getVector3FromArray=function(e,t){return e instanceof Array&&e.length>2?(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),(new THREE.Vector3).fromArray(e)):t},this.getSelectedNodes=function(t){return(t=t||e.model).selector?t.selector.getSelection():[]},this.getVisibleLayers2d=function(t){return t&&t!==e.model?(r.logger.warn("[getVisibleLayers2d] multiple models not yet supported."),[]):e.impl.getVisibleLayerIndices()},this.areAllLayersVisible=function(t){return t&&t!==e.model?(r.logger.warn("[areAllLayersVisible] multiple models not yet supported."),!0):e.impl.layers.allLayersVisible()},this.getAspectRatio=function(){var t=e.navigation.getScreenViewport();return t.width/t.height},this.getOrthographicHeight=function(){var t=e.navigation.getCamera();return t.isPerspective?0:Math.abs(2*t.orthographicCamera.top)},this.getSeedUrn=function(t){var i;return(null===(i=t=t||e.model)||void 0===i?void 0:i.getSeedUrn())||""},this.getToneMapIntensity=function(){var t=0;return e.impl.dir_light1&&(t=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),t},this.getLightPresetIndex=function(e){for(var t=0;t<n.LightPresets.length;t++)if(n.LightPresets[t].name===e)return t;return-1},this.applyFilter=function(e,t){if(!0!==t)for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=t[i];void 0===n?delete e[i]:"boolean"==typeof n?!1===n&&delete e[i]:n instanceof Object?e[i]instanceof Object?this.applyFilter(e[i],t[i]):r.logger.warn("[applyFilter] A - Invalid filter Object for key ["+i+"]"):r.logger.warn("[applyFilter] B - Invalid filter value for key ["+i+"]")}},this.normalizeCoordinates=function(t){var i=t.viewport;if(i){if(i.normalized)return void r.logger.warn("invalid normalization of state.viewport. Ignoring command.");i.normalized=!0;if(a(i,o.SceneMath.getNormalizingMatrix(e.model)),"orthographicHeight"in i){var n=e.model.myData.bbox,s=n.max.y-n.min.y,l=i.orthographicHeight/s;i.orthographicHeight=l}}},this.denormalizeCoordinates=function(t){var i=t.viewport;if(i){if(!i.normalized)return void r.logger.warn("invalid denormalization of state.viewport. Ignoring command.");delete i.normalized;if(a(i,o.SceneMath.getNormalizingMatrix(e.model).clone().invert()),"orthographicHeight"in i){var n=e.model.myData.bbox,s=n.max.y-n.min.y,l=i.orthographicHeight*s;i.orthographicHeight=l}}}}function a(e,t){var i=new THREE.Vector3(e.eye[0],e.eye[1],e.eye[2]),r=new THREE.Vector3(e.pivotPoint[0],e.pivotPoint[1],e.pivotPoint[2]),n=new THREE.Vector3(e.target[0],e.target[1],e.target[2]);i.applyMatrix4(t),r.applyMatrix4(t),n.applyMatrix4(t),e.eye[0]=i.x,e.eye[1]=i.y,e.eye[2]=i.z,e.pivotPoint[0]=r.x,e.pivotPoint[1]=r.y,e.pivotPoint[2]=r.z,e.target[0]=n.x,e.target[1]=n.y,e.target[2]=n.z}s.prototype.constructor=s},39080:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BubbleNode:()=>n});let r=1;class n{static MODEL_NODE={role:"3d",type:"geometry"};static GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"};static SHEET_NODE={role:"2d",type:"geometry"};static LEAFLET_NODE={role:"leaflet"};static PDF_PAGE_NODE={role:"pdf-page"};static IMAGE_NODE={role:"image"};static GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"};static VIEWABLE_NODE={role:"viewable"};static AEC_MODEL_DATA={role:"Autodesk.AEC.ModelData"};static MASTER_VIEW_NODE={name:"08f99ae5-b8be-4f8d-881b-128675723c10"};parent=void 0;id=void 0;data=void 0;isLeaf=!1;children=[];sharedPropertyDbPath=void 0;lodNode=void 0;lmvDocument=void 0;constructor(e,t){this.parent=t,this.id=r++,this.data=e,this.isLeaf="geometry"===e.type&&("3d"===e.role||"2d"===e.role||"lod"===e.role),this.children=new Array;this.#u().forEach((e=>{const t=new n(e,this);this.children.push(t);const i="application/autodesk-db"==(r=e).mime&&r.urn?0===r.urn.indexOf("urn:adsk.objects:os.object")?r.urn.substr(0,r.urn.lastIndexOf("%2F")+3):r.urn.substr(0,r.urn.lastIndexOf("/")+1):null;var r;i&&(this.sharedPropertyDbPath=i),"lod"===e.role&&(this.lodNode=t)})),this.children.length>1&&this.children.sort(((e,t)=>Object.prototype.hasOwnProperty.call(e.data,"order")&&Object.prototype.hasOwnProperty.call(t.data,"order")?e.data.order-t.data.order:0))}#u(){return this.is3DTilesFormat()?[]:Array.isArray(this.data.children)?this.data.children:Array.isArray(this.data.derivatives)?this.data.derivatives:new Array}setDocument(e){this.lmvDocument=e}getDocument(){let e=this;for(;e.parent;)e=e.parent;return e.lmvDocument}isOtg(){return!!this._getOtgManifest()}_getOtgManifest(){if("undefined"!=typeof DISABLE_OTG&&DISABLE_OTG)return null;const e=this.findViewableParent();if(!e)return null;return e.data.otg_manifest}isSVF2(){var e,t=this._getOtgManifest();return Boolean("cacheable"===(null==t||null===(e=t.paths)||void 0===e?void 0:e.pharos_type))}getOtgGraphicsNode(){if(this.isViewPreset())return this.findParentGeom2Dor3D().getOtgGraphicsNode();const e=this._getOtgManifest();return e&&e.views&&e.views[this.guid()]}getPropertyDbManifest(){var e,t=this._getOtgManifest();if(t&&t.pdb_manifest){var i=t.pdb_manifest;e={propertydb:{},isOtg:!0};for(var r=0;r<i.assets.length;r++){var n,o=i.assets[r];n=o.isShared?t.paths.shared_root+i.pdb_shared_rel_path:t.paths.version_root+i.pdb_version_rel_path,e.propertydb[o.tag]=[{path:n+o.uri,isShared:o.isShared}]}this.getOtgGraphicsNode()||(e.needsDbIdRemap=!0)}else{let t=this.findPropertyDbPath();null===t&&(console.warn("Missing property database entry in manifest."),t=""),0===t.indexOf("$file$")&&(console.warn("Bubble local path given for shared property DB files. Assuming that sharedPropertyDbPath is specified correctly by loadDocumentNode()."),t="");const i=this.getDocument();i&&0===t.indexOf("urn")&&(t=i.getFullPath(t)),e={propertydb:{attrs:[{path:t+"objects_attrs.json.gz"}],values:[{path:t+"objects_vals.json.gz"}],avs:[{path:t+"objects_avs.json.gz"}],offsets:[{path:t+"objects_offs.json.gz"}],ids:[{path:t+"objects_ids.json.gz"}]}}}return e}getRootNode(){return this.parent?this.parent.getRootNode():this}isForgeManifest(){return"manifest"===this.getRootNode().data.type}is3DTilesFormat(){return!!this.data.asset}findPropertyDbPath(){if(this.is3DTilesFormat())return null;const e=this._getOtgManifest(),t=e&&e.pdb_manifest;if(t&&t.assets&&t.assets.length){return e.paths.version_root+e.pdb_manifest.pdb_version_rel_path}return e&&console.warn("Unexpected: OTG manifest exists, but it has no property database manifest."),this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null}_raw(){return this.data}name(){return this.data.name||""}guid(){return this.data.guid}type(){return this.data.type}extensions(){if(this.data.extensions)return Array.isArray(this.data.extensions)?this.data.extensions:[this.data.extensions]}urn(e){let t=this.data.urn;if(!e)return t;let i=this.parent;for(;!t&&i;)t=i.data.urn,i=i.parent;return t}lineageUrn(e){const t=this.getRootNode().urn();let i=n.parseLineageUrnFromEncodedUrn(t);return e&&(i=Autodesk.Viewing.toUrlSafeBase64(i)),i}static parseLineageUrnFromEncodedUrn(e){if(!e)return null;const t=e.split("/");let i=null;for(let e=t.length-1;e>=0;e--){var r;try{i=Autodesk.Viewing.fromUrlSafeBase64(t[e])}catch(e){}if(-1!=(null===(r=i)||void 0===r?void 0:r.indexOf("file:")))break;i=null}return n.parseLineageUrnFromDecodedUrn(i)}static parseLineageUrnFromDecodedUrn(e){if(!e)return null;const t=(e=e.replace("fs.file:vf.","dm.lineage:")).indexOf("?version");return-1===t?e:e.substring(0,t)}isGeomLeaf(){return this.isLeaf}isViewable(){if("viewable"===this.data.role)return!0;return!("svf"!==this.data.outputType)}getLodNode(){return this.lodNode}isGeometry(){return"geometry"===this.data.type}isViewPreset(){return"view"===this.data.type}is2D(){return"2d"===this.data.role}is3D(){return"3d"===this.data.role}is2DGeom(){return this.isGeometry()&&this.is2D()}is3DGeom(){return this.isGeometry()&&this.is3D()}useAsDefault(){return!0===this.data.useAsDefault}getDefaultGeometry(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.is3DTilesFormat())return this;let i=[];if(e){const e=this.search(n.MASTER_VIEW_NODE);e.length&&(i=e[0].search({type:"geometry"}))}0==i.length&&(i=this.search({type:"geometry"})),t&&i.sort((function(e,t){return t.data.size-e.data.size}));for(let e=0;e<i.length;++e)if(i[e].useAsDefault())return i[e];return i[0]}getPlacementTransform(){return console.warn("BubbleNode.getPlacementTransform is deprecated. Sheet placement information is stored in AECModelData.json"),null}getHash(){return console.warn("BubbleNode.getHash is deprecated and will be removed in a future release."),null}getViewBox(){return this.data.viewbox}isMetadata(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1}findViewableParent(){let e=null,t=this;for(;t;)t.isViewable()&&(e=t),t=t.parent;if(!e&&!this.parent&&this.children)for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.isViewable()){e=i;break}}return e}findParentGeom2Dor3D(e){let t=this;for(;t&&!t.is2DGeom()&&!t.is3DGeom();)t=t.parent;if(!t&&this.isViewPreset()){t=this.findGeometryFromSiblings()[0],e&&e.fallbackParent&&(t=e.fallbackParent)}return t}findGeometryFromSiblings(){const e=this.parent;if(!e)return[];const t=[];for(let i=0,r=e.children.length;i<r;++i){const r=e.children[i];if(r===this)continue;let n;r.traverse((e=>{if(e.isGeometry()&&(e.is2D()||e.is3D()))return n=e,!0})),n&&t.push(n)}return t}findAllViewables(){if(this.is3DTilesFormat())return this.data.root.children;let e=[];this.isForgeManifest()&&(e=this.search({outputType:"svf"}));const t=this.search({role:"viewable"});return e.concat(t)}getViewableRootPath(e){var t=this.getOtgGraphicsNode();if(t&&t.urn&&!t.error)return this._getOtgManifest().paths.version_root+t.urn;if(!this.isGeomLeaf())return this.urn();if(this.is2D()){if(!e){var i=this.search({role:"leaflet"});if(i&&i.length)return i[0].urn()}const t=this.search(n.PDF_PAGE_NODE);if(null!=t&&t.length)return t[0].urn()}var r=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",o=this.search({mime:r});return o&&o.length?o[0].urn():null}getNamedViews(){var e=this.search({type:"view"});return e=e.filter((function(e){return!!e.data.name&&!!Array.isArray(e.data.camera)}))}findByGuid(e){var t=null;return this.traverse((function(i){if(i.data.guid===e)return t=i,!0})),t}search(e){const t=[];return this.traverse((function(i){let r=!0;for(let t in e)if(!Object.prototype.hasOwnProperty.call(i.data,t)||i.data[t]!==e[t]){r=!1;break}r&&t.push(i)})),t}traverse(e){if(e(this))return!0;if(this.children)for(let t=0;t<this.children.length;t++)if(this.children[t].traverse(e))return!0;return!1}getShallowCopySource(e){if(!this.isViewable())return console.error("getShallowCopySource must be called with a viewable node."),null;e||(e=this.parent.urn());var t=this.urn();return t!==e&&(t?(console.log(`Redirecting shallow copied URN ${e} to ${t}`),e=t):console.warn(`Unexpected: manifest viewable node does not have a urn property.\n${JSON.stringify(this._raw())}`)),e}getAecModelData(){const e=this.findViewableParent();if(!e)return null;if(!e.data.aec_model_data){var t=this.getRootNode().search({role:"Autodesk.AEC.ModelData"})[0];return Boolean(t)&&console.warn("Use Document.getAecModelData(bubbleNode) instead of BubbleNode.getAecModelData(), or make sure Document.downloadAecModelData is loaded before using this API"),null}return e.data.aec_model_data}extractRefPointTransform(){var e=this.getAecModelData();return e&&e.refPointTransformation&&n.readMatrixFromArray12(e.refPointTransformation)}extractCamera(){if(this.data.camera)return n.readCameraFromArray(this.data.camera);var e=this.isGeometry()&&this.search({type:"view"})[0];return e?e.extractCamera():null}getLevel(){const e=this.data.levelNumber;return Array.isArray(e)?e[0]:e}getLevelName(){return this.data.levelName||this.getLevel()}isSheet(){let e=this.parent;for(;e;){if("Sheets"===e.name())return!0;e=e.parent}return!1}isMasterView(){const e=n.MASTER_VIEW_NODE.name;let t=this;for(;t;){if(t.name()===e)return!0;t=t.parent}return!1}getModelName(){const e=this.getRootNode().children[0];return null==e?void 0:e.name()}getInputFileType(){var e;const t=null===(e=this.getRootNode().children)||void 0===e?void 0:e[0];return null==t?void 0:t.data.inputFileType}isRevitPdf(){return!(!this.data.isVectorPDF||"rvt"!==this.getInputFileType())}isSmartPdf(){return!(!this.data.isVectorPDF||"pdf"===this.getInputFileType())}getModelKey(){const e=`${this.getViewableRootPath()}${this.originModel}${this.guid()}`;return decodeURIComponent(e)}static readCameraFromArray(e,t){if(!Array.isArray(e))return null;if(t&&!t.elements){t instanceof THREE.Vector3||(t=(new THREE.Vector3).copy(t));var i=new THREE.Matrix4;i.setPosition(t),t=i}const r={position:new THREE.Vector3(e[0],e[1],e[2]),target:new THREE.Vector3(e[3],e[4],e[5]),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]};return t&&(r.position.applyMatrix4(t),r.target.applyMatrix4(t),r.up.transformDirection(t)),0===e[10]&&1===e[11]&&1===e[12]&&(r.orthoScale=r.position.distanceTo(r.target)),r}static readMatrixFromArray12(e){return(new THREE.Matrix4).fromArray([e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,e[9],e[10],e[11],1])}getSourceFileUnits(){return this.data.units}getMasterViews(){const e=this.getRootNode().search({name:"08f99ae5-b8be-4f8d-881b-128675723c10"});return e&&e.length>0&&e[0].children||[]}getMasterView(e){return this.getMasterViews().find((t=>t.data.phaseNames===e))}get3DModelNodes(){return this.search(n.MODEL_NODE)}getSheetNodes(){return this.search(n.SHEET_NODE)}}},7247:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ObjectAssign:()=>L,disableDocumentTouchSafari:()=>R,enableDocumentTouchSafari:()=>O,exitFullscreen:()=>d,fullscreenElement:()=>f,getAndroidVersion:()=>y,getGlobal:()=>n.getGlobal,getIOSVersion:()=>v,inFullscreen:()=>p,isAndroidDevice:()=>A,isBrowser:()=>a,isChrome:()=>C,isFirefox:()=>T,isFullscreenAvailable:()=>m,isFullscreenEnabled:()=>g,isIE11:()=>h,isIE11Only:()=>c,isIOSDevice:()=>_,isMac:()=>P,isMobileDevice:()=>S,isNodeJS:()=>l,isPhoneFormFactor:()=>w,isSafari:()=>M,isTouchDevice:()=>b,isWindows:()=>D,launchFullscreen:()=>u,touchStartToClick:()=>N});var r,n=i(10209);const o=(0,n.getGlobal)(),s=o&&o.document,a="undefined"!=typeof navigator,l=function(){return!a};let h=a&&!!navigator.userAgent.match(/Edge|Trident\/7\./),c=a&&!!navigator.userAgent.match(/Trident\/7\./);function u(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)}function d(e){p(e)&&(e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.msExitFullscreen&&e.msExitFullscreen())}function p(e){return"webkitIsFullScreen"in e?!!e.webkitIsFullScreen:"fullscreenElement"in e?!!e.fullscreenElement:"mozFullScreenElement"in e?!!e.mozFullScreenElement:"msFullscreenElement"in e?!!e.msFullscreenElement:!!e.querySelector(".viewer-fill-browser")}function f(e){return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement}function m(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen}function g(e){return e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled}function v(e){var t=(e=e||navigator.userAgent).match(/OS ((\d+)_(\d+)(_(\d+))?) like Mac OS X/);return!t&&_()&&(t=e.match(/\/((\d+)\.(\d+)(\.\d)?) Safari\//)),t?t[1].replace("_","."):""}function y(e){var t=(e=e||navigator.userAgent).match(/Android\s([0-9\.]*)/);return!!t&&t[1]}function b(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)}const x=a&&(/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||/^ip(ad|hone|od)$/.test(null===(r=navigator.platform)||void 0===r?void 0:r.toLowerCase()));function _(){return x}const E=a&&-1!==navigator.userAgent.toLowerCase().indexOf("android");function A(){return E}function S(){return!!a&&(_()||A())}function w(){return S()&&(o.matchMedia("(max-width: 750px)").matches||o.matchMedia("(max-height: 750px)").matches)}function M(){if(!a)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")}function T(){return!!a&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")}function C(){return!!a&&-1!==navigator.userAgent.toLowerCase().indexOf("chrome")}function P(){return!!a&&(-1!==navigator.userAgent.toLowerCase().indexOf("mac os")&&!_())}function D(){if(!a)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")}function L(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function I(e){var t=o.hasOwnProperty("pageXOffset")?o.pageXOffset:s.documentElement.scrollLeft,i=o.hasOwnProperty("pageYOffset")?o.pageYOffset:s.documentElement.scrollTop,r=void 0===e.pageX?e.changedTouches[0].pageX:e.pageX,n=void 0===e.pageY?e.changedTouches[0].pageY:e.pageY,a=s.elementFromPoint(r-t,n-i);return!a||"CANVAS"!==a.nodeName||("true"!==a.getAttribute("data-viewer-canvas")||(e.preventDefault(),!1))}function R(){S()&&M()&&(s.documentElement.addEventListener("touchstart",I,!0),s.documentElement.addEventListener("touchmove",I,!0),s.documentElement.addEventListener("touchcanceled",I,!0),s.documentElement.addEventListener("touchend",I,!0))}function O(){S()&&M()&&(s.documentElement.removeEventListener("touchstart",I,!0),s.documentElement.removeEventListener("touchmove",I,!0),s.documentElement.removeEventListener("touchcanceled",I,!0),s.documentElement.removeEventListener("touchend",I,!0))}function N(e){e.target.className&&(e.target.className.indexOf("fullscreen")>-1||e.target.className.indexOf("webvr")>-1)||(e.preventDefault(),e.stopPropagation(),e.target.click())}},6875:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EnvironmentConfigurations:()=>W,Initializer:()=>te,getUpstreamApiData:()=>j,getWebGLHelpLink:()=>g,initializeAuth:()=>J,initializeEnvironmentVariable:()=>q,initializeLogger:()=>$,initializeResourceRoot:()=>X,initializeServiceEndPoints:()=>Y,refreshCookie:()=>K,refreshRequestHeader:()=>Q,refreshToken:()=>Z,shutdown:()=>ie,token:()=>f});var r=i(27156),n=i(60489),o=i(97790),s=i(7247),a=i(66799),l=i(68110),h=i(26725),c=i(32131),u=(0,s.getGlobal)();const d=u;var p={accessToken:null,getAccessToken:null,tokenRefreshInterval:null};let f=p,m=null;function g(){return m}var v={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},y="",b="";if((0,s.getGlobal)().location){var x=(0,s.getGlobal)().location;b=x.protocol+"//"+x.hostname,y=x.protocol+"//"+x.host}var _={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},E="https://us.otgs-dev.autodesk.com",A="https://us.otgs-stg.autodesk.com",S="https://us.otgs.autodesk.com",w="https://eu.otgs-stg.autodesk.com",M="https://eu.otgs.autodesk.com",T="https://cdn-dev.derivative.autodesk.com",C="https://cdn-dev.derivative.autodesk.com/regions/eu",P="https://cdn-stg.derivative.autodesk.com",D="https://cdn-stg.derivative.autodesk.com/regions/eu",L="https://cdn.derivative.autodesk.com",I="https://cdn.derivative.autodesk.com/regions/eu",R="https://cdn-dev.derivative.autodesk.com",O="https://cdn-stg.derivative.autodesk.com",N="https://cdn.derivative.autodesk.com",F="https://cdn-stg-fips.derivative.autodesk.com",k="https://cdn-fips.derivative.autodesk.com",V="https://api-stg.afg.us.autodesk.com",U="https://api.afg.us.autodesk.com",B="derivativeV2",G="derivativeV2_EU",z="derivativeV2_APAC",H="derivativeV2_Fedramp";let W=Object.freeze({Local:{ROOT:"",LMV:v.local},Development:{ROOT:R,LMV:v.dev,bubbleManifest:!0},Staging:{ROOT:O,LMV:v.stg,bubbleManifest:!0},Production:{ROOT:N,LMV:v.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:R,LMV:v.dev},AutodeskStaging:{ROOT:O,LMV:v.stg},AutodeskProduction:{ROOT:N,LMV:v.prod},AutodeskDevelopment2:{ROOT:R,LMV:v.dev,UPSTREAM:_.dev,UPSTREAM_API_DATA:B},AutodeskStaging2:{ROOT:O,LMV:v.stg,UPSTREAM:_.stg,UPSTREAM_API_DATA:B},AutodeskProduction2:{ROOT:N,LMV:v.prod,UPSTREAM:_.prod,UPSTREAM_API_DATA:B},FluentLocal:{ROOT:y,LMV:y},FluentDev:{ROOT:E,LMV:v.dev,UPSTREAM:_.stg,UPSTREAM_API_DATA:B},FluentStaging:{ROOT:A,LMV:v.stg,UPSTREAM:_.stg,UPSTREAM_API_DATA:B},FluentProduction:{ROOT:S,LMV:v.prod,UPSTREAM:_.prod,UPSTREAM_API_DATA:B},FluentStagingEU:{ROOT:w,LMV:v.stg,UPSTREAM:_.stg,UPSTREAM_API_DATA:G},FluentProductionEU:{ROOT:M,LMV:v.prod,UPSTREAM:_.prod,UPSTREAM_API_DATA:G},MD20DevUS:{ROOT:T,LMV:v.dev,UPSTREAM:_.dev,UPSTREAM_API_DATA:B},MD20DevEU:{ROOT:C,LMV:v.dev,UPSTREAM:_.dev,UPSTREAM_API_DATA:G},MD20StgUS:{ROOT:P,LMV:v.stg,UPSTREAM:_.stg,UPSTREAM_API_DATA:B},MD20StgEU:{ROOT:D,LMV:v.stg,UPSTREAM:_.stg,UPSTREAM_API_DATA:G},MD20ProdUS:{ROOT:L,LMV:v.prod,UPSTREAM:_.prod,UPSTREAM_API_DATA:B},MD20ProdEU:{ROOT:I,LMV:v.prod,UPSTREAM:_.prod,UPSTREAM_API_DATA:G},D3SLocalUS:{ROOT:y,LMV:y,UPSTREAM:y,UPSTREAM_API_DATA:B},D3SLocalEU:{ROOT:y,LMV:y,UPSTREAM:y,UPSTREAM_API_DATA:G},D3SLocalAPAC:{ROOT:y,LMV:y,UPSTREAM:y,UPSTREAM_API_DATA:z},Test:{ROOT:`${b}:3000`,LMV:v.dev},FedrampStaging2:{ROOT:F,LMV:v.stg,UPSTREAM:V,UPSTREAM_API_DATA:H},FedrampProduction2:{ROOT:k,LMV:v.prod,UPSTREAM:U,UPSTREAM_API_DATA:H}});function j(e,t){return e.endsWith("EU")||e.endsWith("APAC")?W[e].UPSTREAM_API_DATA:t.endsWith("_EU")?W[e].UPSTREAM_API_DATA+"_EU":W[e].UPSTREAM_API_DATA}function q(e){var t;if(e&&e.env&&(t=e.env),t||(t=(0,r.getParameterByName)("env")),(0,o.setOfflineResourcePrefix)(e&&e.offlineResourcePrefix||""),(0,o.setOffline)(e&&"true"===e.offline),!t)switch(d.location.hostname){case"developer-dev.api.autodesk.com":t="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":t="AutodeskStaging";break;case"developer.api.autodesk.com":default:t="AutodeskProduction";break;case"localhost.autodesk.com":case"":case"127.0.0.1":t="Local"}(0,o.setEnv)(t),"undefined"!=typeof window&&n.logger.info("Host name : "+window.location.hostname),n.logger.info("Environment initialized as : "+t)}function X(e){if(e.lmvResourceRoot)u.LMV_RESOURCE_ROOT=e.lmvResourceRoot;else{var t,i,n=["viewer3D.js","viewer3D.min.js","viewerCE.js","viewerCE.min.js"];e&&Object.prototype.hasOwnProperty.call(e,"libraryName")&&n.push(e.libraryName);var o=!1;for(let e=0;e<n.length;e++){var s=(0,r.getScript)(n[e]),a=(i=s?s.src:"").indexOf(n[e]);if(a>=0){t=i.substr(0,a),(i.indexOf("&v=",a)>0||i.indexOf("?v=",a)>0)&&(o=!0);break}}if(u.LMV_RESOURCE_ROOT=t||u.LMV_RESOURCE_ROOT,o){var l=!1,h=["dev","stg","prod"];for(let e=0;e<h.length;++e){var c=_[h[e]];if(-1!==u.LMV_RESOURCE_ROOT.indexOf(c)){l=!0;break}}l&&(u.LMV_RESOURCE_ROOT+=u.LMV_VIEWER_VERSION+"/")}}}function Y(e){var t=e.endpoint;t||(t=W[(0,o.getEnv)()].ROOT);var i=e.api||t.ENDPOINT_API_DERIVATIVE_SERVICE_V2;if(o.endpoint.setEndpointAndApi(t,i),void 0!==e.escapeOssObjects&&o.endpoint.setEscapeOssObjects(e.escapeOssObjects),!(0,s.isNodeJS)())return X(e),Promise.resolve()}function K(e,t,i){t=t||function(){},l.ViewingService.rawGet(o.endpoint.getApiEndpoint(),null,"/auth/settoken",t,i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0,postData:"access-token="+e})}function Q(e){e?o.endpoint.HTTP_REQUEST_HEADERS.Authorization="Bearer "+e:delete o.endpoint.HTTP_REQUEST_HEADERS.Authorization}function Z(e,t,i){if(p.accessToken=e,o.endpoint.getUseCookie()){K(e,t,(function(t){n.logger.warn("Failed to set token in cookie. Will use header instead."),o.endpoint.setUseCookie(!1),Q(e),i&&i(t)}))}else Q(e),t&&t()}function J(e,t){var i,s=t?t.shouldInitializeAuth:void 0;void 0===s&&(s="false"!==(0,r.getParameterByName)("auth").toLowerCase());if(s||Q(null),"Local"==(0,o.getEnv)()||!s)return setTimeout(e,0),void o.endpoint.setUseCredentials(void 0!==t.useCredentials&&t.useCredentials);o.endpoint.setUseCredentials(void 0===t.useCredentials||t.useCredentials),o.endpoint.setUseCookie(t.useCookie),p.tokenRefreshInterval&&(clearTimeout(p.tokenRefreshInterval),p.tokenRefreshInterval=null),t&&t.getAccessToken?(p.getAccessToken=t.getAccessToken,i=t.getAccessToken((function r(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3599;if(i=n,p.tokenRefreshInterval?Z(i):Z(i,e,e),"number"!=typeof o){const e=new Date(o);o=Boolean(+e)&&e.toISOString()===o?(e-Date.now())/1e3:3599}var s=o-((null==t?void 0:t.tokenExpirationBuffer)||5);s<=0&&(s=o),p.tokenRefreshInterval=setTimeout((function(){t.getAccessToken(r)}),1e3*s)})),"string"==typeof i&&i&&Z(i,e)):t&&t.accessToken?Z(i=t.accessToken,e):((i=(0,r.getParameterByName)("accessToken"))||n.logger.error("No access token is provided, but authorization requested. This is a problem."),Z(i,e))}function $(e){n.logger.initialize(e);var t=(0,r.getParameterByName)("logLevel");t&&n.logger.setLevel(parseInt(t))}function ee(e){e&&"Local"===e.env||o.endpoint.getCdnRedirectUrl()&&l.ViewingService.rawGet(o.endpoint.getCdnRedirectUrl(),null,null,(function(e){e&&e.length&&(o.endpoint.setCdnUrl(e),n.logger.info("CDN_ROOT is: "+e))}),(function(){}),{withCredentials:!1,responseType:"text"})}function te(e,t){if((0,s.isNodeJS)())return q(e),Y(e),$(e),ee(e),void J(t,e);e.webGLHelpLink&&(m=e.webGLHelpLink),q(e);var i=Y(e);$(e),ee(e),(0,h.initializeLocalization)(e),(0,s.disableDocumentTouchSafari)(),function(e){const t=!(-1!==["Production","fluent"].indexOf("Production"));(e.optOutTrackingByDefault||t)&&(c.analytics.shouldTrack=!1);const i=e.productId?e.productId:"Local"===(0,o.getEnv)()?"Local":"NOT_SET";c.analytics.superProps={productId:i,lmvBuildType:u.LMV_BUILD_TYPE,lmvViewerVersion:u.LMV_VIEWER_VERSION}}(e),(0,a.initWorkerScript)();var r=function(e){return new Promise((t=>{J(t,e)}))}(e);return Promise.all([i,r]).then(t)}function ie(){n.logger.shutdown(),Autodesk.Viewing.Private.shutdownPropWorker()}},67837:(e,t,i)=>{"use strict";i.d(t,{A:()=>u});var r=i(17252),n=new ArrayBuffer(8),o=new Uint8Array(n),s=new Uint16Array(n),a=new Int32Array(n),l=new Uint32Array(n),h=new Float32Array(n),c=new Float64Array(n);function u(e){this.buffer=e,this.offset=0,this.byteLength=e.length}u.prototype.seek=function(e){this.offset=e},u.prototype.getBytes=function(e){var t=new Uint8Array(this.buffer.buffer,this.offset,e);return this.offset+=e,t},u.prototype.getVarints=function(){var e,t=0,i=0;do{t|=(127&(e=this.buffer[this.offset++]))<<i,i+=7}while(128&e);return t},u.prototype.getUint8=function(){return this.buffer[this.offset++]},u.prototype.getUint16=function(){return o[0]=this.buffer[this.offset++],o[1]=this.buffer[this.offset++],s[0]},u.prototype.getInt16=function(){var e=this.getUint16();return e>32767&&(e|=4294901760),e},u.prototype.getInt32=function(){var e=this.buffer,t=o,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,a[0]},u.prototype.getUint32=function(){var e=this.buffer,t=o,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,l[0]},u.prototype.getFloat32=function(){var e=this.buffer,t=o,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,h[0]},u.prototype.getIndicesArray=function(e,t,i){for(var r=this.buffer,n=new Uint8Array(e,t,2*i),o=this.offset,s=0,a=2*i;s<a;s+=2)n[s]=r[o],n[s+1]=r[o+1],o+=4;this.offset=o},u.prototype.getVector3Array=function(e,t,i,r){var n=this.buffer,o=this.offset,s=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(3===r&&0===i){var a=12*t;s.set(n.subarray(o,o+a)),this.offset+=a}else{r*=4;for(var l=4*i,h=0;h<t;h++){for(var c=0;c<12;c++)s[l+c]=n[o++];l+=r}this.offset=o}},u.prototype.getVector2Array=function(e,t,i,r){var n=this.buffer,o=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s=this.offset;r*=4;for(var a=4*i,l=0;l<t;l++){for(var h=0;h<8;h++)o[a+h]=n[s++];a+=r}this.offset=s},u.prototype.getVector4=function(e,t){for(var i=this.buffer,r=o,n=this.offset,s=h,a=0;a<4;a++)r[0]=i[n],r[1]=i[n+1],r[2]=i[n+2],r[3]=i[n+3],e[t+a]=s[0],n+=4;this.offset=n},u.prototype.getFloat64=function(){for(var e=this.buffer,t=o,i=this.offset,r=0;r<8;r++)t[r]=e[i+r];return this.offset+=8,c[0]},u.prototype.getString=function(e){var t=(0,r.Pp)(this.buffer,this.offset,e);return this.offset+=e,t},u.prototype.reset=function(e){this.buffer=e,this.offset=0,this.byteLength=e.length}},29059:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PropertyDatabase:()=>s});var r=i(17252);function n(e,t){let i,r=0,n=e.length-1;for(;r<=n;){if(i=(r+n)/2|0,t===e[i])return i;t<e[i]?n=i-1:r=i+1}return-1}var o=i(56857);function s(e){var t,i,s,a,l,h,c,u,d,p,f,m,g,v,y,b,x,_=this,E=!1,A=!1;let S={};for(var w in e.attrs){"pdb version 2"===(t=(0,r.Up)(e.attrs[w]))[0]&&(E=!0);for(var M=1;M<t.length;M++){if("Layer"===t[M][0])y=M;switch(t[M][1]){case"__parent__":d=M;break;case"__child__":u=M;break;case"__name__":p=M;break;case"__instanceof__":f=M;break;case"__viewable_in__":m=M;break;case"__externalref__":g=M;break;case"__node_flags__":v=M}E&&t[M][2]===o.GC.DbKey&&(t[M][6]=t[M][6]|o.zF.afDirectStorage)}break}for(let t in e.avs){let i=e.avs[t];i[0]==="[".charCodeAt(0)?s=(0,r.fN)(e.avs[t],0):(s=i,A=!0),delete e.avs;break}for(let t in e.offsets){let n=e.offsets[t];n[0]==="[".charCodeAt(0)?(i=(0,r.fN)(n,1))[i.length-1]=s.length/2:i=new Int32Array(n.buffer,n.byteOffset,n.byteLength/4),delete e.offsets;break}for(let t in e.values){a=e.values[t],l=(0,r.Zp)(a);break}this.setIdsBlob=function(e){h=e,c=(0,r.Zp)(e)};for(let t in e.ids){this.setIdsBlob(e.ids[t]);break}function T(e){for(var t={},i=0,r=e.length;i<r;i++){var n=e[i];Array.isArray(n)||(n=[n]);for(var o=0;o<n.length;o++){var s=n[o],a=t[s];void 0===a?t[s]=i:Array.isArray(a)?a.push(i):t[s]=[a,i]}}return t}this.getObjectCount=function(){return i.length-1},this.getValueAt=function(e){return(0,r.U8)(a,l[e])},this.getIntValueAt=function(e){return(0,r.ON)(a,l[e])},this.getIdAt=function(e){return(0,r.U8)(h,c[e])},this.externalIdsLoaded=function(){return Boolean(h)},this.getAttrValue=function(e,i,r){var n=t[e];return n[6]&o.zF.afDirectStorage&&n[2]===o.GC.DbKey?i:r?this.getIntValueAt(i):this.getValueAt(i)},this._getObjectProperty=function(e,i){var r=t[e],n=r[5]?r[5]:r[0],o=this.attributeHidden(e);return{displayName:n,displayValue:_.getAttrValue(e,i),displayCategory:r[1],attributeName:r[0],type:r[2],units:r[3],hidden:o,precision:r[7]||0}},this.getObjectProperties=function(e,i,r,n,o){var s={dbId:e,properties:[]},a=!1,l=i&&-1!==i.indexOf("externalId"),h=this.externalIdsLoaded();l&&!h&&console.error("Requesting externalID requires loading of the externalID table");var c=h&&(!i||l);if(c&&(s.externalId=this.getIdAt(e),i&&1===i.length))return s;var u=null;if(this.enumObjectProperties(e,(function(e,l){if(e!=f){var h=t[e];if(!(i&&-1===i.indexOf(h[0])&&-1===i.indexOf(h[5])||o&&-1===o.indexOf(h[1])||n&&(n.indexOf(h[0])>-1||n.indexOf(h[5])>-1)))if(e==p){var c=_.getAttrValue(e,l);a=!0,s.name=c}else{var d=_.attributeHidden(e);if(r&&d)return;var m=_._getObjectProperty(e,l);s.properties.push(m)}}else{var g=_.getObjectProperties(_.getAttrValue(e,l),i,!0,n,o);g&&g.properties&&(u=g)}})),u){var d={},m=s.properties;for(let e=0;e<m.length;e++)d[m[e].displayName]=1;s.name||(s.name=u.name);var g=u.properties;for(let e=0;e<g.length;e++)Object.prototype.hasOwnProperty.call(d,g[e].displayName)||m.push(g[e])}return o&&!s.properties.length?null:!i||s.properties.length||c||a?s:null},this.getExternalIdMapping=function(e){var t={};if(c&&"length"in c)for(var i=1,r=c.length;i<r;++i){var n=this.getIdAt(i);e&&!0!==e[n]||(t[n]=i)}return t},this.findRootNodes=function(){var e=[],t=[];return this.enumObjects((function(i){var r=!1,n=!1,o=!1;_.enumObjectProperties(i,(function(e,t){e==d?_.getAttrValue(e,t,!0)&&(n=!0):e==u?r=!0:e==p&&(o=!0)})),o&&!n&&(r?e.push(i):t.push(i))})),e.length>0?e:t},this.nodeHasChild=function(e){let t=!1;return this.enumObjectProperties(e,(function(e){if(e===u)return t=!0,!0})),t},this.getNodeNameAndChildren=function(e,t){var i,r,n=e.dbId;if(this.enumObjectProperties(n,(function(n,o){var s;if(n===d);else if(n!=u||t)n===p?e.name=_.getAttrValue(n,o):n===v?e.flags=_.getAttrValue(n,o,!0):n===f&&(r=o);else if((s=_.getAttrValue(n,o,!0))!==e.dbId){var a={dbId:s,parent:e.dbId};i?i.push(a):i=[a]}})),(!e.name||!e.flags)&&r){const t=_.getAttrValue(f,r,!0);let i=S[t];i||(S[t]=i={dbId:t,name:null,flags:null},_.getNodeNameAndChildren(i,!0)),i.name&&!e.name&&(e.name=i.name),"number"!=typeof e.flags&&"number"==typeof i.flags&&(e.flags=i.flags)}return i},this.buildDbIdToFragMap=T;this.buildObjectTree=function(e,t,i,r){var n;t&&(n=T(t)),b={},x=0;var o=this.buildObjectTreeRec(e,0,n,0,i,r);return x>0&&console.warn("Property database integrity not guaranteed ("+x+")."),b=null,S={},o},this.buildObjectTreeRec=function(e,t,i,r,n,o){if(b[e])return x++,0;b[e]=t||e,r>n[0]&&(n[0]=r);var s,a={dbId:e},l=this.getNodeNameAndChildren(a),h=[];if(l)for(var c=0;c<l.length;c++){this.buildObjectTreeRec(l[c].dbId,e,i,r+1,n,o)&&h.push(l[c].dbId)}if(i){var u=i[e];void 0!==u&&(s=Array.isArray(u)?u:[u])}var d=a.flags||0;void 0===d&&(d=s&&s.length?6:(h.length,0));var p=h.length+(s?s.length:0);return p&&o.setNode(e,t,a.name,d,h,s),p},this.getSearchTerms=function(e){for(var t=(e=e.toLowerCase()).match(/"[^"]+"|[^\s]+/g)||[],i=t.length;i--;)t[i]=t[i].replace(/"/g,"");var r=[];for(i=0;i<t.length;i++)t[i].length>1&&r.push(t[i]);return r},this.bruteForceSearch=function(e,i,r){const o=this.getSearchTerms(e);if(0===o.length)return[];var s=[];const a=null==r?void 0:r.searchHidden,h=null==r?void 0:r.includeInherited,c={};for(let e=0;e<o.length;e++){for(var u=[],d=[],p=0,m=l.length;p<m;p++){var g=this.getValueAt(p);null!==g&&(-1!==g.toString().toLowerCase().indexOf(o[e])&&d.push(p))}0!==d.length?(d.sort((function(e,t){return e-t})),this.enumObjects((function(e){_.enumObjectProperties(e,(function(r,o){if(h&&r===f){const t=parseInt(_.getAttrValue(r,o));c[t]=c[t]||[],c[t].push(e)}if(!a&&_.attributeHidden(r))return;if(-1!==n(d,o)){if(i&&i.length&&-1===i.indexOf(t[r][0]))return;return u.push(e),!0}}))})),s.push(u)):s.push(u)}const v=(e,t)=>{const i=new Set(e);for(let r=0;r<e.length;++r){const n=e[r];if(!(n in t))continue;const o=t[n];for(let t=0;t<o.length;++t){const r=o[t];i.has(r)||(e.push(r),i.add(r))}}};if(1===s.length)return h&&v(s[0],c),s[0];var y={},b=s[0];for(let e=0;e<b.length;e++)y[b[e]]=1;for(let e=1;e<s.length;e++){b=s[e];var x={};for(let e=0;e<b.length;e++)1===y[b[e]]&&(x[b[e]]=1);y=x}u=[];for(let e in y)u.push(parseInt(e));return h&&v(u,c),u},this.bruteForceFind=function(e){var i=[];return this.enumObjects((function(r){var n=!1;_.enumObjectProperties(r,(function(i){var r=t[i],o=r[0],s=r[5];if(o===e||s===e)return n=!0,!0})),n&&i.push(r)})),i},this.getLayerToNodeIdMapping=function(){var e={};return this.enumObjects((function(t){_.enumObjectProperties(t,(function(i,r){if(i==y){var n=_.getAttrValue(i,r);return Array.isArray(e[n])||(e[n]=[]),e[n].push(t),!0}}))})),e},this.getAttributeDef=function(e){var i=t[e];return{name:i[0],category:i[1],dataType:i[2],dataTypeContext:i[3],description:i[4],displayName:i[5],flags:i[6],precision:i.length>7?i[7]:0}},this.enumAttributes=function(e){for(var i=1;i<t.length&&!e(i,this.getAttributeDef(i),t[i]);i++);},this.enumObjectProperties=A?function(e,t){let r=i[e],n=i[e+1],o=s,a=0;for(;r<n;){let e=o[r++],i=127&e,n=7;for(;128&e;)e=o[r++],i|=(127&e)<<n,n+=7;for(a+=i,e=o[r++],i=127&e,n=7;128&e;)e=o[r++],i|=(127&e)<<n,n+=7;if(t(a,i))break}}:function(e,t){let r=2*i[e],n=2*i[e+1];for(let e=r;e<n;e+=2){if(t(s[e],s[e+1]))break}};let C={};function P(e,t,r){let n=i[e],o=i[e+1],a=s,l=[],h=[];r=r||{};let c=0;for(;n<o;){let e=a[n++],i=127&e,o=7;for(;128&e;)e=a[n++],i|=(127&e)<<o,o+=7;for(c+=i,e=a[n++],i=127&e,o=7;128&e;)e=a[n++],i|=(127&e)<<o,o+=7;if(c===f){let e=_.getAttrValue(c,i);h.push(e)}else t&&!t[c]||(r[c]=i,l.push(c),l.push(i))}for(let e=0;e<h.length;e++){let i=h[e],n=C[i];n||(C[i]=n=P(i));for(let e=0;e<n.length;e+=2){let i=n[e],o=n[e+1];t&&!t[i]||(r[i]||_.attributeHidden(i)||(r[i]=o,l.push(i),l.push(o)))}}return l}this.getPropertiesSubsetWithInheritance=A?P:function(e,t,r){let n=2*i[e],o=2*i[e+1],a=[],l=[];r=r||{};for(let e=n;e<o;e+=2){let i=s[e],n=s[e+1];if(i===f){let e=_.getAttrValue(i,n);l.push(e)}else t&&!t[i]||(r[i]=n,a.push(i),a.push(n))}for(let e=0;e<l.length;e++){let i=l[e],n=C[i];n||(C[i]=n=P(i));for(let e=0;e<n.length;e+=2){let i=n[e],o=n[e+1];t&&!t[i]||(r[i]||_.attributeHidden(i)||(r[i]=o,a.push(i),a.push(o)))}}return a},this.findLayers=function(){var e={name:"root",id:1,index:1,children:[],isLayer:!1,childCount:0};if(void 0===y)return e;var t=[],i=this;return this.enumObjects((function(e){i.enumObjectProperties(e,(function(e,r){if(e===y){var n=i.getValueAt(r);return n&&-1===t.indexOf(n)&&t.push(n),!0}}))})),t.sort((function(e,t){return e.localeCompare(t,void 0,{sensitivity:"base",numeric:!0})})),e.childCount=t.length,e.children=t.map((function(e,t){return{name:e,index:t+1,id:t+1,isLayer:!0}})),e},this.enumObjects=function(e,t,r){var n=i.length-1;t="number"==typeof t?Math.max(t,1):1,r="number"==typeof r?Math.min(n,r):n;for(var o=t;o<r&&!e(o);o++);},this.getAttrChild=function(){return u},this.getAttrParent=function(){return d},this.getAttrName=function(){return p},this.getAttrLayers=function(){return y},this.getAttrInstanceOf=function(){return f},this.getAttrViewableIn=function(){return m},this.getAttrXref=function(){return g},this.getAttrNodeFlags=function(){return v},this.attributeHidden=function(e){return 1&t[e][6]||e==d||e==u||e==m||e==g},this._attributeIsBlacklisted=function(e){var i=t[e],r=i[0],n=i[1];return!(!Object.prototype.hasOwnProperty.call(o.WU,n)||-1===o.WU[n].indexOf(r))||!(!Object.prototype.hasOwnProperty.call(o.am,n)||-1===o.am[n].indexOf(r))},this._ignoreAttribute=function(e,i){var r=t[i],n=r[0],o=r[1];return e[o]&&e[o].has(n)},this.findParent=function(e){let t=null;return _.enumObjectProperties(e,(function(e,i){e===d&&(t=_.getAttrValue(e,i,!0))})),t},this._getAttributeAndValueIds=function(e,t,i){let r=this.getPropertiesSubsetWithInheritance(e),n=i&&Object.keys(i).length>=1;for(let e=0;e<r.length;e+=2){let o=r[e];this._attributeIsBlacklisted(o)||this.attributeHidden(o)||(n&&this._ignoreAttribute(i,o)||t.push({attrId:o,valId:r[e+1]}))}t.sort((function(e,t){return e.attrId-t.attrId}))},this.findDifferences=function(e,t,i){var r={changedIds:[]},n=t&&t.dbIds,o=t&&t.listPropChanges;o&&(r.propChanges=[]);let s=t&&t.propertyFilter||{};var a=this,l=e,h=[],c=[],u={result:[],dbId:-1},d={result:[],dbId:-1},p=function(e){var t=0,i=0;if(h.length=0,c.length=0,a._getAttributeAndValueIds(e,h,s,!0,u),l._getAttributeAndValueIds(e,c,s,!0,d),h.length&&c.length){for(var n=!1,p=void 0;t<h.length&&i<c.length;){var f=h[t],m=c[i],g=f&&f.attrId,v=f&&f.valId,y=m&&m.attrId,b=m&&m.valId;if(g!==y||v!==b){if(n=!0,!o)break;var x=void 0===y||y>g,E=void 0;void 0===g||g>y?((E=l._getObjectProperty(y,b)).displayValueB=E.displayValue,E.displayValue=void 0,i++):x?((E=a._getObjectProperty(g,v)).displayValueB=void 0,t++):((E=a._getObjectProperty(g,v)).displayValueB=_.getAttrValue(y,b),t++,i++),p||(p=[]),p.push(E)}else t++,i++}n&&(r.changedIds.push(e),o&&r.propChanges.push(p))}},f=-1,m=function(e,t){var r=Math.floor(100*e/t);r!=f&&(i&&i(r),f=r)};if(n)for(var g=0;g<n.length;g++){p(n[g]),m(g,n.length)}else{var v=Math.min(a.getObjectCount(),this.getObjectCount());for(let e=1;e<v;e++)p(e),m(e,v)}return r},this.numberOfAttributes=function(){var e;return(null===(e=t)||void 0===e?void 0:e.length)??0},this.numberOfValues=function(){var e;return(null===(e=l)||void 0===e?void 0:e.length)??0},this.dtor=function(){t=null,i=null,s=null,a=null,l=null,h=null,c=null,u=0,d=0,p=0,f=0,m=0,g=0,v=0}}},56857:(e,t,i)=>{"use strict";i.d(t,{GC:()=>r,OY:()=>a,WU:()=>s,am:()=>o,zF:()=>n});var r={Unknown:0,Boolean:1,Integer:2,Double:3,Float:4,BLOB:10,DbKey:11,String:20,LocalizableString:21,DateTime:22,GeoLocation:23,Position:24},n={afHidden:1,afDontIndex:2,afDirectStorage:4,afReadOnly:8},o={Dimensions:["Perimeter","Volume","Area","Length","Width","Height"]},s={Item:["Source File"]};const a=e=>[r.Integer,r.Double,r.Float].includes(e)},17252:(e,t,i)=>{"use strict";function r(e,t,i){var r,n,o,s,a,l;for(r="",o=i,n=0;n<o;)switch((s=e[t+n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(s);break;case 12:case 13:a=e[t+n++],r+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=e[t+n++],l=e[t+n++],r+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&l)<<0)}return r}function n(e,t,i){var r,n,o,s=i||0;if(n=e.length,t)for(r=0;r<n;r++)(o=e.charCodeAt(r))>=1&&o<=127?t[s++]=o:o>2047?(t[s++]=224|o>>12&15,t[s++]=128|o>>6&63,t[s++]=128|o>>0&63):(t[s++]=192|o>>6&31,t[s++]=128|o>>0&63);else for(r=0;r<n;r++)(o=e.charCodeAt(r))>=1&&o<=127?s++:s+=o>2047?3:2;return s-(i||0)}i.d(t,{MA:()=>r,ON:()=>c,Pp:()=>a,Ss:()=>n,U8:()=>h,Up:()=>l,Zp:()=>d,fN:()=>u});var o=!0,s=1048576;function a(e,t,i){if(void 0===t&&(t=0),void 0===i&&(i=e.length),o)return i>s?function(e,t,i){var r,n,o,s,a,l,h,c;for(r="",a=[],o=i,l=0,n=0;n<o;){switch((s=e[t+n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a.push(String.fromCharCode(s));break;case 12:case 13:h=e[t+n++],a.push(String.fromCharCode((31&s)<<6|63&h));break;case 14:h=e[t+n++],c=e[t+n++],a.push(String.fromCharCode((15&s)<<12|(63&h)<<6|(63&c)<<0))}(++l>=32768||n>=o)&&(r+=a.join(""),a.length=0,l=0)}return r}(e,t,i):r(e,t,i);for(var n="",a=t,l=t+i;a<l;a++)n+=String.fromCharCode(e[a]);return decodeURIComponent(escape(n))}function l(e){var t=a(e,0,e.length);return t=t.replace(/\u000e/gi,""),JSON.parse(t)}function h(e,t){if(void 0===t)return"";for(var i=t;i<e.length-1;){var r=e[i];if(44==r&&(10==e[i+1]||13==e[i+1]))break;if(10==r||13==r)break;i++}var n=a(e,t,i-t);try{return JSON.parse(n)}catch(e){return console.error("Error parsing property blob to JSON : "+n),n}}function c(e,t){var i=0,r=t;for(34==e[r]&&r++;r<e.length-1;){var n=e[r];if(44==n&&(10==e[r+1]||13==e[r+1]))break;if(10==n||13==n||34==n)break;n>=48&&n<=57&&(i=10*i+(n-48)),r++}return i}function u(e,t){for(var i=0,r=0,n=e.length;r<n;r++)44==e[r]&&i++;i++;var o=new Uint32Array(i+(t?1:0));r=0;for(var s=e.length;91!=e[r]&&r<s;)r++;if(r==e.length)return null;r++;var a=!1;i=0;for(var l=0;r<s;){var h=e[r];h>=48&&h<=57?(l=10*l+(h-48),a=!0):44==h||93==h?a&&(o[i++]=l,a=!1,l=0):(a=!1,l=0),r++}return o}function d(e){for(var t=0,i=e.length-1,r=0;r<i;r++)44!=e[r]||10!=e[r+1]&&13!=e[r+1]||t++;if(!t)return null;t++;var n=new Uint32Array(t);for(r=0,t=0;91!=e[r]&&r<i;)r++;r++,n[t++]=r;for(var o=!1;r<i;)10==e[r]||13==e[r]?o=!0:o&&(o=!1,n[t++]=r),r++;return n}},34302:(e,t,i)=>{"use strict";i.r(t),i.d(t,{VertexBufferBuilder:()=>o});var r=2*Math.PI,n=[0,1,3,0,3,2];function o(e,t,i,r){var n=t||65536;this.FULL_COUNT=0|(i||32767),this.useInstancing=e,this.useCompactBuffers=r,this.stride=10,this.allocVcount=4*(this.useInstancing?n/4:n),this.vb=new ArrayBuffer(this.stride*this.allocVcount),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(n),this.minLineWidth=Number.MAX_VALUE,this.reset(0)}o.prototype.reset=function(e){this.vcount=e,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.lastDbId=null,this.colors={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0,this.numMiterLines=0,this.hasLineStyles=!1,this.changeTracking={},this.stride=10},o.prototype.expandStride=function(){var e=this.stride;if(!(e>=12)){for(var t=this.stride+2,i=new ArrayBuffer(t*this.allocVcount),r=new Uint8Array(this.vb),n=new Uint8Array(i),o=0,s=this.vcount;o<s;o++)for(var a=o*e*4,l=o*t*4,h=0;h<4*e;h++)n[l+h]=r[a+h];this.vb=i,this.vbf=new Float32Array(i),this.vbi=new Int32Array(i),this.stride=t}},o.prototype.addToBounds=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)};var s=new Int32Array(1);function a(e){return s[0]=e,s[0]}o.prototype.trackChanges=function(e,t,i,r,n,o){if(i!==this.lastDbId&&(this.dbIds[a(i)]=1,this.lastDbId=i),o&&(this.hasLineStyles=!0),this.useCompactBuffers){var s=this.changeTracking;l("geomType",e),l("color",t),l("dbId",i),l("layerId",r),l("viewportId",n),l("linePattern",o),this.colors[a(t)]=1}function l(t,i){void 0===s[t]?s[t]=e:s[t]===i&&(s[t+"Varies"]=!0)}},o.prototype.setCommonVertexAttribs=function(e,t,i,r,n,o,s,a){this.trackChanges(i,r,n,o,s,a),t&=255,i&=255,a&=255,o&=65535,s&=65535,this.vbi[e+8]=t|i<<8|a<<16,this.vbi[e+6]=r,this.vbi[e+7]=n,this.vbi[e+9]=o|s<<16},o.prototype.addVertexTriangleGeom=function(e,t,i,r,n,o,s,a,l,h){for(var c=this.vcount,u=this.vbf,d=this.useInstancing?1:4,p=0;p<d;p++){var f=(c+p)*this.stride;u[f]=e,u[f+1]=t,u[f+2]=i,u[f+3]=r,u[f+4]=n,u[f+5]=o,this.setCommonVertexAttribs(f,0+p,5,s,a,l,h,0),this.vcount++}return c},o.prototype.addVertexLine=function(e,t,i,n,o,s,a,l,h,c,u,d,p){var f=this.vcount,m=this.vbf;l>=0&&s>0&&n>0&&(this.minLineWidth=Math.min(this.minLineWidth,s));var g=1;d&&p?g=8:d?g=9:p&&(g=10);for(var v=this.useInstancing?1:4,y=0;y<v;y++){var b=(f+y)*this.stride;m[b]=e,m[b+1]=t,m[b+2]=(i+Math.PI)/r,m[b+3]=n,m[b+4]=.5*s,m[b+5]=o,this.setCommonVertexAttribs(b,0+y,g,a,l,h,c,u),this.vcount++}return f},o.prototype.addVertexMiterLine=function(e,t,i,n,o,s,a,l,h,c,u,d,p){var f=this.vcount,m=this.vbf;c>=0&&l>0&&(this.minLineWidth=Math.min(this.minLineWidth,l));for(var g=this.useInstancing?1:4,v=0;v<g;v++){var y=(f+v)*this.stride;m[y]=e,m[y+1]=t,m[y+2]=(i+Math.PI)/r,m[y+3]=s,m[y+4]=.5*l,m[y+5]=(n+Math.PI)/r,m[y+10]=(o+Math.PI)/r,m[y+11]=a,this.setCommonVertexAttribs(y,0+v,11,h,c,u,d,p),this.vcount++}return f},o.prototype.addVertexTexQuad=function(e,t,i,n,o,s,a,l,h){for(var c=this.vcount,u=this.vbf,d=this.useInstancing?1:4,p=0;p<d;p++){var f=(c+p)*this.stride;u[f]=e,u[f+1]=t,u[f+2]=o/r,u[f+3]=i,u[f+4]=n,this.setCommonVertexAttribs(f,0+p,4,s,a,l,h,0),this.vcount++}return c},o.prototype.addVertexArc=function(e,t,i,n,o,s,a,l,h,c,u,d){for(var p=this.vcount,f=this.vbf,m=o==s?2:3,g=this.useInstancing?1:4,v=0;v<g;v++){var y=(p+v)*this.stride;f[y]=e,f[y+1]=t,f[y+2]=i/r,f[y+3]=n/r,f[y+4]=.5*l,f[y+5]=o,3===m&&(f[y+10]=s,f[y+11]=a),this.setCommonVertexAttribs(y,0+v,m,h,c,u,d,0),this.vcount++}return p},o.prototype.addVertex=function(e,t,i,r,n,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;if(!this.useInstancing){var a=this.vcount,l=this.stride*a,h=this.vbf;return h[l]=e,h[l+1]=t,this.setCommonVertexAttribs(l,0,s,i,r,n,o,0),this.vcount++,a}},o.prototype.addVertexPolytriangle=function(e,t,i,r,n,o){this.useInstancing||(this.addVertex(e,t,i,r,n,o),this.addToBounds(e,t))},o.prototype.addVertexMSDFPolytriangle=function(e,t,i,r,n,o,s,a){this.addVertexTexPolytriangle(e,t,i,r,n,o,s,a,6)},o.prototype.addIndices=function(e,t){if(!this.useInstancing){var i=this.ib,r=this.icount;if(r+e.length>=i.length){var n=new Uint16Array(2*Math.max(e.length,i.length));for(let e=0;e<r;++e)n[e]=i[e];this.ib=i=n}for(let n=0;n<e.length;++n)i[r+n]=t+e[n];this.icount+=e.length}},o.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(n,e)},o.prototype.addSegment=function(e,t,i,r,n,o,s,a,l,h,c,u,d){var p=i-e,f=r-t,m=p||f?Math.atan2(f,p):0,g=p||f?Math.sqrt(p*p+f*f):0,v=this.addVertexLine(e,t,m,g,n,o,s,a,l,h,c,u,d);this.finalizeQuad(v),this.addToBounds(e,t),this.addToBounds(i,r)},o.prototype.addMiterSegment=function(e,t,i,r,n,o,s,a,l,h,c,u,d,p,f,m,g){if(this.useCompactBuffers)this.addSegment(i,r,n,o,l,h,c,u,d,p,f,m,g);else{this.numMiterLines++,this.expandStride();var v=n-i,y=o-r,b=v||y?Math.atan2(y,v):0,x=v||y?Math.sqrt(v*v+y*y):0,_=i-e,E=r-t,A=_||E?Math.atan2(E,_):b,S=_||E?Math.sqrt(_*_+E*E):1,w=s-n,M=a-o,T=w||M?Math.atan2(M,w):b,C=w||M?Math.sqrt(w*w+M*M):1,P=Math.floor(1023*Math.min(64,S)),D=65536*Math.floor(1023*Math.min(64,C))+P,L=this.addVertexMiterLine(i,r,b,A,T,x,D,h,c,u,d,p,f);this.finalizeQuad(L),this.addToBounds(i,r),this.addToBounds(n,o)}},o.prototype.addTriangleGeom=function(e,t,i,r,n,o,s,a,l,h){this.numTriangleGeoms++;var c=this.addVertexTriangleGeom(e,t,i,r,n,o,s,a,l,h);this.finalizeQuad(c),this.addToBounds(e,t),this.addToBounds(i,r),this.addToBounds(n,o)},o.prototype.addArc=function(e,t,i,n,o,s,a,h,c,u,d,p){o==s?this.numCirculars++:(this.numEllipticals++,this.expandStride());var f=l(i,n);i=f.start,n=f.end,0==i&&0==n&&(n=r);{var m=Math.abs(i-n);if(m>1e-4&&Math.abs(m-r)>1e-4){var g=e+o*Math.cos(i),v=t+s*Math.sin(i);this.addSegment(g,v,g,v,0,h,c,u,d,p);var y=e+o*Math.cos(n),b=t+s*Math.sin(n);this.addSegment(y,b,y,b,0,h,c,u,d,p)}else this.addToBounds(e-o,t-s),this.addToBounds(e+o,t+s);const a=33554431;var x=this.addVertexLine(e,t,0,1e-4,0,0,a,u,d,p);this.finalizeQuad(x)}var _=this.addVertexArc(e,t,i,n,o,s,a,h,c,u,d,p);this.finalizeQuad(_)},o.prototype.addTexturedQuad=function(e,t,i,r,n,o,s,a,l){var h=this.addVertexTexQuad(e,t,i,r,n,o,s,a,l);this.finalizeQuad(h);var c=.5*Math.cos(n),u=.5*Math.sin(n),d=Math.abs(i*c)+Math.abs(r*u),p=Math.abs(i*u)+Math.abs(r*c);this.addToBounds(e-d,t-p),this.addToBounds(e+d,t+p)},o.prototype.addVertexImagePolytriangle=function(e,t,i,r,n,o,s,a){return this.addVertexTexPolytriangle(e,t,i,r,n,o,s,a,7)},o.prototype.addVertexTexPolytriangle=function(e,t,i,r,n,o,s,a,l){if(this.useInstancing)return;let h=this.vcount,c=this.vbf;this.addVertex(e,t,n,o,s,a,l),c[h*this.stride+2]=i,c[h*this.stride+3]=r,this.addToBounds(e,t)},o.prototype.isFull=function(e){e=e||3;var t=this.useInstancing?4:1;return this.vcount*t+e>this.FULL_COUNT},o.prototype.makeCompactVertexLayout=function(){var e=Object.keys(this.colors),t=Object.keys(this.dbIds);if(10!==this.stride)return null;var i=e.length+t.length;if(e.length+t.length>65536)return null;var r=new Int32Array(i+1);r[0]=0;var n=1;for(let t=0;t<e.length;t++,n++)r[n]=parseInt(e[t]),this.colors[e[t]]=n;for(let e=0;e<t.length;e++,n++)r[n]=parseInt(t[e]),this.dbIds[t[e]]=n;var o=new ArrayBuffer(24*this.vcount),s=new Int32Array(o),a=new Uint16Array(o),l=this.maxx-this.minx||1,h=this.maxy-this.miny||1,c=this.minx,u=this.miny,d=Math.max(l,h);function p(e){return 0|Math.round((e-c)/l*65535)}function f(e){return 0|Math.round((e-u)/h*65535)}function m(e){return 0|Math.round(e/d*65535)}function g(e){return 0|65535*e}function v(e){return e<0?32768+32767*Math.min(1,-e/1024):e?0|Math.round(e/d*32767)||1:e}for(var y=0;y<this.vcount;y++){var b=this.stride*y,x=6*y,_=2*x;switch(this.vbi[b+8]>>8&255){case 0:a[_]=p(this.vbf[b]),a[_+1]=f(this.vbf[b+1]);break;case 1:case 8:case 9:case 10:a[_]=p(this.vbf[b]),a[_+1]=f(this.vbf[b+1]),a[_+2]=g(this.vbf[b+2]),a[_+3]=m(this.vbf[b+3]),a[_+4]=v(this.vbf[b+4]);break;case 2:a[_]=p(this.vbf[b]),a[_+1]=f(this.vbf[b+1]),a[_+2]=g(this.vbf[b+2]),a[_+3]=g(this.vbf[b+3]),a[_+4]=v(this.vbf[b+4]),a[_+5]=m(this.vbf[b+5]);break;case 3:case 11:break;case 4:a[_]=p(this.vbf[b]),a[_+1]=f(this.vbf[b+1]),a[_+2]=g(this.vbf[b+2]),a[_+3]=m(this.vbf[b+3]),a[_+4]=m(this.vbf[b+4]);break;case 5:a[_]=p(this.vbf[b]),a[_+1]=f(this.vbf[b+1]),a[_+2]=p(this.vbf[b+2]),a[_+3]=f(this.vbf[b+3]),a[_+4]=p(this.vbf[b+4]),a[_+5]=f(this.vbf[b+5]);break;default:console.error("Unknown geometry type")}a[_+6]=this.colors[this.vbi[b+6]]||0,a[_+7]=this.dbIds[this.vbi[b+7]]||0,s[x+4]=this.vbi[b+8],s[x+5]=this.vbi[b+9]}var E={};E.vb=new Float32Array(o),E.vbstride=6;var A=this.useInstancing?1:0;return E.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:2,divisor:A,normalized:!0},fields2:{offset:1,itemSize:4,bytesPerItem:2,divisor:A,normalized:!0},uvIdColor:{offset:3,itemSize:2,bytesPerItem:2,divisor:A,normalized:!1},flags4b:{offset:4,itemSize:4,bytesPerItem:1,divisor:A,normalized:!1},layerVp4b:{offset:5,itemSize:4,bytesPerItem:1,divisor:A,normalized:!1}},E.unpackXform={x:l,y:h,z:c,w:u},E.texData=r,E},o.prototype.makeWideVertexLayout=function(){var e={};e.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),e.vbstride=this.stride;var t=this.useInstancing?1:0;return e.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:4,divisor:t,normalized:!1},fields2:{offset:2,itemSize:4,bytesPerItem:4,divisor:t,normalized:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:t,normalized:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:t,normalized:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:t,normalized:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:t,normalized:!1}},e.vblayout.extraParams={offset:this.stride-2,itemSize:2,bytesPerItem:4,divisor:t,normalized:!1},e},o.prototype.toMesh=function(){var e=null;if(this.useCompactBuffers&&(e=this.makeCompactVertexLayout()),e||(e=this.makeWideVertexLayout()),this.useInstancing){e.numInstances=this.vcount;var t=new Int32Array([0,1,2,3]);e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalized:!1},e.vblayout.instFlags4b.array=t.buffer,e.indices=new Uint16Array(n)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));e.dbIds=this.dbIds;var i=this.maxx-this.minx,r=this.maxy-this.miny,o=Math.max(i,r);return e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-o},max:{x:this.maxx,y:this.maxy,z:.001*o}},e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(i*i+r*r)},e};var l=function(e,t){function i(){function i(e,t){return Math.abs(e-t)<.001}i(e,0)&&(e=0),i(t,0)&&(t=0),i(e,r)&&(e=r),i(t,r)&&(t=r)}if(i(),e>t)for(;e>r;)e-=r,t-=r;else for(;t>r;)e-=r,t-=r;return i(),e<0&&t>0&&(e+=r),{start:e,end:t}}},77220:(e,t,i)=>{"use strict";i.r(t),i.d(t,{F2D:()=>m,F2dDataType:()=>u,F2dSemanticType:()=>d,F2dShadowRatio:()=>p,restoreSignBitFromLSB:()=>f});var r=i(34302),n=i(60812),o=i(96164);const s=function(e,t){t.min.x<e.min.x&&(e.min.x=t.min.x),t.min.y<e.min.y&&(e.min.y=t.min.y),t.min.z<e.min.z&&(e.min.z=t.min.z),t.max.x>e.max.x&&(e.max.x=t.max.x),t.max.y>e.max.y&&(e.max.y=t.max.y),t.max.z>e.max.z&&(e.max.z=t.max.z)};var a=i(67837),l=i(60489),h=i(22599),c=16383,u={dt_object:0,dt_void:1,dt_byte:2,dt_int:3,dt_float:4,dt_double:5,dt_varint:6,dt_point_varint:7,dt_byte_array:32,dt_int_array:33,dt_float_array:34,dt_double_array:35,dt_varint_array:36,dt_point_varint_array:37,dt_arc:38,dt_circle:39,dt_circular_arc:40,dt_string:63,dt_last_data_type:127},d={st_object_member:0,st_fill:1,st_fill_off:2,st_clip_off:3,st_layer:4,st_link:5,st_line_weight:6,st_miter_angle:7,st_miter_length:8,st_line_pattern_ref:9,st_back_color:10,st_color:11,st_markup:12,st_object_id:13,st_markup_id:14,st_reset_rel_offset:15,st_font_ref:16,st_begin_object:32,st_clip:33,st_line_caps:34,st_line_join:35,st_line_pattern_def:36,st_font_def:37,st_viewport:38,st_sheet:42,st_arc:43,st_polyline:44,st_raster:45,st_text:46,st_polytriangle:47,st_dot:48,st_end_object:63,st_last_semantic_type:127};const p=.0075;function f(e){return 1&e?-(e>>>1):e>>>1}function m(e,t,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.metadata=e,this.scaleX=1,this.scaleY=1,this.bbox={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},this.is2d=!0,this.layersMap={},this.fontDefs={},this.fontCount=0,this.fontId=0,this.manifestAvailable=!1,this.geomMetricsSum=0,this.objectMemberQueue=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],viewables:[]},e){var s=e.page_dimensions;this.paperWidth=s.page_width,this.paperHeight=s.page_height,this.scaleX=this.paperWidth/s.plot_width,this.scaleY=this.paperHeight/s.plot_height,this.hidePaper=s.hide_paper;var a=this.paperWidth,l=this.paperHeight;this.bbox.max.x=a,this.bbox.max.y=l;var h=e.page_dimensions||{};if(isFinite(h.paper_rotation)&&0!==h.paper_rotation){var u=h.paper_rotation*Math.PI/180,d=Math.cos(u),p=Math.sin(u),f=a*d,m=a*p,g=-l*p,v=l*d;this.bbox.min.x=Math.min(0,f,g,f+g),this.bbox.max.x=Math.max(0,f,g,f+g),this.bbox.min.y=Math.min(0,m,v,m+v),this.bbox.max.y=Math.max(0,m,v,m+v)}isFinite(h.paper_offset_x)&&0!==h.paper_offset_x&&(this.bbox.min.x+=h.paper_offset_x,this.bbox.max.x+=h.paper_offset_x),isFinite(h.paper_offset_y)&&0!==h.paper_offset_y&&(this.bbox.min.y+=h.paper_offset_y,this.bbox.max.y+=h.paper_offset_y);var y=0;for(var b in this.layersMap[0]=y++,e.layers){var x=parseInt(b);this.layersMap[x]=y++}if(this.layerCount=y,this.createLayerGroups(e.layers),e.geom_metrics){var _=Object.keys(e.geom_metrics).map((function(t){return e.geom_metrics[t]}));this.geomMetricsSum=_.reduce(((e,t)=>e+t))}}this.hidePaper=this.hidePaper||o.modelSpace,this.noShadow=!!o.noShadow,this.hasPageShadow=!1,this.opCount=0,this.excludeTextGeometry=o.excludeTextGeometry,this.extendStringsFetching=o.extendStringsFetching,this.fontFaces=[],this.fontFamilies=[],this.viewports=[{}],this.currentVpId=0,this.viewports[0].geom_metrics=this.currentGeomMetrics={arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]},this.clips=[0],this.strings=[],this.stringDbIds=[],this.stringBoxes=[],this.extendStringsFetching&&(this.stringCharWidths=[],this.stringAngles=[],this.stringPositions=[],this.stringHeights=[]),this.currentStringNumber=-1,this.currentStringBox=new n.LmvBox3,this.linkBoxes=[],this.currentLinkBox=new n.LmvBox3,this.objectNumber=0,this.currentFakeId=-2,this.imageNumber=0,this.linkNumber=0,this.maxObjectNumber=0,this.objectStack=[],this.objectNameStack=[],this.parseObjState={polyTriangle:{},viewport:{},clip:{},raster:{},text:{},fontDef:{},uknown:{}},this.layer=0,this.bgColor="number"==typeof o.bgColor?o.bgColor:4294967295,this.contrastColor=this.color=this.fillColor=4278190080,this.hidePaper&&(this.contrastColor=4294967040),this.isMobile=o&&!!o.isMobile;var E=this.isMobile,A=this.isMobile;if(this.max_vcount=this.isMobile?c:void 0,this.currentVbb=new r.VertexBufferBuilder(E,void 0,this.max_vcount,A),this.meshes=[],this.numCircles=this.numEllipses=this.numPolylines=this.numLineSegs=0,this.numPolytriangles=this.numTriangles=0,this.error=!1,this.offsetX=0,this.offsetY=0,t){this.manifestAvailable=!0,this.imageId2URI={};for(var S=t.assets,w=0,M=S.length;w<M;++w){var T=S[w];if(-1!==T.mime.indexOf("image/")){var C=T.id;C=C.substr(0,C.indexOf(".")),this.imageId2URI[C]=i+T.URI}"Autodesk.CloudPlatform.PropertyAttributes"===T.type&&this.propertydb.attrs.push({path:T.URI}),"Autodesk.CloudPlatform.PropertyValues"===T.type&&this.propertydb.values.push({path:T.URI}),"Autodesk.CloudPlatform.PropertyIDs"===T.type&&this.propertydb.ids.push({path:T.URI}),"Autodesk.CloudPlatform.PropertyViewables"===T.type&&this.propertydb.viewables.push({path:T.URI}),"Autodesk.CloudPlatform.PropertyOffsets"===T.type&&-1===T.id.indexOf("rcv")&&this.propertydb.offsets.push({path:T.URI}),"Autodesk.CloudPlatform.PropertyAVs"===T.type&&this.propertydb.avs.push({path:T.URI})}}}m.prototype.load=function(e,t){if(t instanceof Uint8Array||(t=new Uint8Array(t)),this.data=t,this.parse(),this.stringBoxes.length){var i=new Float32Array(this.stringBoxes.length);i.set(this.stringBoxes),this.stringBoxes=i}e.loadDoneCB(!0)},m.prototype.loadFrames=function(e){this.loadContext=e;var t=e.data;if(t)t instanceof Uint8Array||(t=new Uint8Array(t)),this.data=t;else if(e.finalFrame&&(this.data=null,this.stringBoxes.length)){var i=new Float32Array(this.stringBoxes.length);i.set(this.stringBoxes),this.stringBoxes=i}this.parseFrames(e.finalFrame),e.loadDoneCB(!0)},m.prototype.pushMesh=function(e){this.meshes.push(e),e.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,skipMiterLines:!this.currentVbb.numMiterLines,useInstancing:this.currentVbb.useInstancing,unpackPositions:!!e.unpackXform},this.currentImage&&(e.material.image=this.currentImage,e.material.image.name=this.imageNumber++,this.currentImage=null)},m.prototype.flushBuffer=function(e,t){if(this.currentVbb.vcount||t){var i=t;if(i=i||this.currentVbb.isFull(e)){if(this.currentVbb.vcount){var r=this.currentVbb.toMesh();s(this.bbox,r.boundingBox),this.pushMesh(r),this.currentVbb.reset(0)}this.loadContext&&this.loadContext.loadDoneCB(!0,t)}}},m.prototype.tx=function(e){return this.sx(e)},m.prototype.ty=function(e){return this.sy(e)},m.prototype.sx=function(e){return e*this.scaleX},m.prototype.sy=function(e){return e*this.scaleY},m.prototype.invertColor=function(e){var t=e>>16&255,i=e>>8&255,r=255&e;return(e>>24&255)<<24|(t=255-t)<<16|(i=255-i)<<8|(r=255-r)},m.prototype.mapColor=function(e,t){if(!this.hidePaper||0!==this.bgColor)return e;var i=255&e;return i<127||i===(65280&e)>>8&&i===(16711680&e)>>16&&t&&(e&=1442840575),e},m.prototype.parsePointPositions=function(){var e=this.stream.getVarints(),t=this.stream.getVarints();return e=f(e),t=f(t),e+=this.offsetX,t+=this.offsetY,this.offsetX=e,this.offsetY=t,[this.tx(e),this.ty(t)]},m.prototype.parserAssert=function(e,t,i){return e!=t&&(l.logger.warn("Expect "+t+"; actual type is "+e+"; in function "+i),this.error=!0,!0)},m.prototype.unhandledTypeWarning=function(e,t){l.logger.warn("Unhandled semantic type : "+t+" in function "+e)},m.prototype.parseObject=function(){var e=this.stream.getVarints();switch(this.objectStack.push(e),e){case d.st_sheet:this.objectNameStack.push("sheet"),this.objectMemberQueue.unshift("paperColor");break;case d.st_viewport:this.objectNameStack.push("viewport"),this.objectMemberQueue.unshift("units","transform");break;case d.st_clip:this.objectNameStack.push("clip"),this.objectMemberQueue.unshift("contourCounts","points","indices");break;case d.st_polytriangle:this.objectNameStack.push("polyTriangle"),this.objectMemberQueue.unshift("points","indices","colors");break;case d.st_raster:this.objectNameStack.push("raster"),this.objectMemberQueue.unshift("position","width","height","imageId");break;case d.st_text:this.currentStringNumber=this.strings.length,0===this.objectNumber&&(this.objectNumber=this.currentFakeId--),this.currentStringBox.makeEmpty(),this.objectNameStack.push("text"),this.objectMemberQueue.unshift("string","position","height","widthScale","rotation","oblique","charWidths");break;case d.st_font_def:this.objectNameStack.push("fontDef"),this.objectMemberQueue.unshift("name","fullName","flags","spacing","panose");break;case d.st_end_object:if(this.objectStack.pop(),this.objectStack.length){switch(this.objectStack.pop()){case d.st_polytriangle:this.actOnPolyTriangle();break;case d.st_viewport:this.actOnViewport();break;case d.st_clip:this.actOnClip();break;case d.st_raster:this.actOnRaster();break;case d.st_text:this.actOnText();break;case d.st_font_def:this.actOnFontDef()}var t=this.objectNameStack.pop(),i=this.parseObjState[t];for(var r in i)i[r]=null}else this.parserAssert(0,1,"parseEndObject (Stack Empty)");this.objectMemberQueue.length=0;break;default:this.objectNameStack.push("unknown"),this.error=!0,this.unhandledTypeWarning("parseObject",e)}},m.prototype.initSheet=function(e){if(!this.hidePaper&&(this.bgColor=e,this.metadata)){var t=this.paperWidth,i=this.paperHeight,r={x:0,y:0},n={x:t,y:0},o={x:0,y:i},s=this.metadata.page_dimensions||{};if(isFinite(s.paper_rotation)&&0!==s.paper_rotation){var a=s.paper_rotation*Math.PI/180,l=Math.cos(a),h=Math.sin(a);n.y=t*h,n.x=t*l,o.x=-i*h,o.y=i*l}isFinite(s.paper_offset_x)&&0!==s.paper_offset_x&&(r.x=s.paper_offset_x),isFinite(s.paper_offset_y)&&0!==s.paper_offset_y&&(r.y=s.paper_offset_y);var c=this.currentVbb,u=[r.x,r.y,r.x+n.x,r.y+n.y,r.x+n.x+o.x,r.y+n.y+o.y,r.x+o.x,r.y+o.y],d=[e,e,e,e],f=[0,1,2,0,2,3];if(!this.noShadow){var m=t*p,g={x:n.x*m/t,y:n.y*m/t},v={x:o.x*m/i,y:o.y*m/i},y={x:r.x+g.x,y:r.y+g.y},b={x:r.x+n.x,y:r.y+n.y},x=4283782485;u=u.concat([y.x-v.x,y.y-v.y,y.x-v.x+n.x,y.y-v.y+n.y,y.x+n.x,y.y+n.y,y.x,y.y,b.x,b.y,b.x+g.x,b.y+g.y,b.x+g.x-v.x+o.x,b.y+g.y-v.y+o.y,b.x-v.x+o.x,b.y-v.y+o.y]),d=d.concat([x,x,x,x,x,x,x,x]),f=f.concat([4,5,6,4,6,7,8,9,10,8,10,11]),this.hasPageShadow=!0}this.addPolyTriangle(u,d,f,4294967295,-1,0,!1),c.addSegment(r.x,r.y,r.x+n.x,r.y+n.y,0,1e-6,4278190080,-1,0,this.currentVpId),c.addSegment(r.x+n.x,r.y+n.y,r.x+n.x+o.x,r.y+n.y+o.y,0,1e-6,4278190080,-1,0,this.currentVpId),c.addSegment(r.x+n.x+o.x,r.y+n.y+o.y,r.x+o.x,r.y+o.y,0,1e-6,4278190080,-1,0,this.currentVpId),c.addSegment(r.x+o.x,r.y+o.y,r.x,r.y,0,1e-6,4278190080,-1,0,this.currentVpId)}},m.prototype.setObjectMember=function(e){if(!this.objectMemberQueue.length)return l.logger.warn("Unexpected object member. "+e+" on object "+this.objectNameStack[this.objectNameStack.length-1]),!1;var t=this.objectMemberQueue.shift(),i=this.objectNameStack[this.objectNameStack.length-1];return"sheet"==i&&"paperColor"==t?(this.initSheet(e),!0):!!i&&(this.parseObjState[i][t]=e,!0)},m.prototype.parseString=function(){var e=this.stream,t=e.getVarints(),i=e.getVarints(),r=e.getString(i);if(t===d.st_object_member){if(this.setObjectMember(r))return}else l.logger.info("Unexpected opcode semantic type for string.");return r},m.prototype.actOnFontDef=function(){var e=this.parseObjState.fontDef;this.fontDefs[++this.fontCount]=e,this.fontId=this.fontCount},m.prototype.parsePoint=function(){var e=this.stream.getVarints(),t=this.parsePointPositions();if(e===d.st_object_member){if(this.setObjectMember(t))return}else l.logger.info("Unexpected opcode semantic type for point.");return t},m.prototype.parsePointsArray=function(){var e=this.stream,t=e.getVarints(),i=e.getVarints();if(i){i/=2;for(var r,n=[],o=0;o<i;++o)r=this.parsePointPositions(),n.push(r[0]),n.push(r[1]);switch(t){case d.st_polyline:return void this.actOnPolylinePointsArray(n);case d.st_dot:return void this.actOnDot(n);case d.st_object_member:if(this.setObjectMember(n))return;break;default:l.logger.info("Unexpected opcode semantic type for points array.")}return n}},m.prototype.parseIntArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),r=[],n=0;n<i;++n)r.push(e.getUint32());if(t===d.st_object_member){if(this.setObjectMember(r))return}else this.unhandledTypeWarning("parseIntArray",t);return r},m.prototype.parseDoubleArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),r=[],n=0;n<i;++n)r.push(e.getFloat64());if(t===d.st_object_member){if(this.setObjectMember(r))return}else this.unhandledTypeWarning("parseDoubleArray",t);return r},m.prototype.parseByteArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),r=[],n=0;n<i;++n)r.push(e.getUint8());if(t===d.st_object_member){if(this.setObjectMember(r))return}else this.unhandledTypeWarning("parseByteArray",t);return r},m.prototype.parseVarintArray=function(){for(var e=this.stream,t=e.getVarints(),i=[],r=e.getVarints(),n=0;n<r;++n)i.push(e.getVarints());if(t===d.st_object_member){if(this.setObjectMember(i))return}else this.unhandledTypeWarning("parseVarIntArray",t);return i},m.prototype.parseInt=function(){var e=this.stream,t=e.getVarints(),i=e.getUint32();switch(t){case d.st_color:this.color=this.mapColor(i,!1),this.currentGeomMetrics.colors++;break;case d.st_fill:this.fill=!0,this.fillColor=this.mapColor(i,!0),this.currentGeomMetrics.fills++;break;case d.st_object_member:if(this.setObjectMember(i))return;default:this.unhandledTypeWarning("parseInt",t)}return i},m.prototype.parseVoid=function(){var e=this.stream.getVarints();if(e===d.st_fill_off)this.fill=!1,this.currentGeomMetrics.fills++;else this.unhandledTypeWarning("parseVoid",e)},m.prototype.parseVarint=function(){var e=this.stream,t=e.getVarints(),i=e.getVarints();switch(t){case d.st_line_weight:this.lineWeight=this.tx(i),this.currentGeomMetrics.line_weights++;break;case d.st_line_caps:this.currentGeomMetrics.line_caps++;break;case d.st_line_join:this.currentGeomMetrics.line_joins++;break;case d.st_object_id:case d.st_markup_id:this.objectNumber=i,this.maxObjectNumber=Math.max(this.maxObjectNumber,i),this.currentGeomMetrics.db_ids++;break;case d.st_link:this.linkNumber&&(this.linkBoxes[this.linkNumber]=this.currentLinkBox.clone(),this.currentLinkBox.makeEmpty()),this.linkNumber=i;break;case d.st_layer:this.currentGeomMetrics.layers++,this.layer=this.layersMap[i];break;case d.st_font_ref:this.fontId=i;break;case d.st_object_member:if(this.setObjectMember(i))return}return i},m.prototype.parseFloat=function(){var e=this.stream,t=e.getVarints(),i=e.getFloat32();switch(t){case d.st_miter_angle:case d.st_miter_length:break;case d.st_object_member:if(this.setObjectMember(i))return}return i},m.prototype.parseCircularArc=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,d.st_arc,"parseCircularArc")){var i=this.parsePointPositions(),r=e.getVarints(),n=e.getFloat32(),o=e.getFloat32();this.actOnCircularArc(i[0],i[1],n,o,this.sx(r))}},m.prototype.parseCircle=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,d.st_arc,"parseCircle")){var i=this.parsePointPositions(),r=e.getVarints();this.actOnCompleteCircle(i[0],i[1],this.sx(r))}},m.prototype.parseArc=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,d.st_arc,"parseArc")){var i=this.parsePointPositions(),r=e.getVarints(),n=e.getVarints(),o=e.getFloat32(),s=e.getFloat32(),a=e.getFloat32();this.actOnArc(i[0],i[1],s,a,this.sx(r),this.sy(n),o)}},m.prototype.parseDataType=function(){var e=this.stream.getVarints();switch(e){case u.dt_void:this.parseVoid();break;case u.dt_int:this.parseInt();break;case u.dt_object:this.parseObject();break;case u.dt_varint:this.parseVarint();break;case u.dt_point_varint:this.parsePoint();break;case u.dt_float:this.parseFloat();break;case u.dt_point_varint_array:this.parsePointsArray();break;case u.dt_circular_arc:this.parseCircularArc();break;case u.dt_circle:this.parseCircle();break;case u.dt_arc:this.parseArc();break;case u.dt_int_array:this.parseIntArray();break;case u.dt_varint_array:this.parseVarintArray();break;case u.dt_byte_array:this.parseByteArray();break;case u.dt_string:this.parseString();break;case u.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,l.logger.info("Data type not supported yet: "+e)}},m.prototype.readHeader=function(){var e=this.stream=new a.A(this.data),t=e.getString(3);if("F2D"!==t)return l.logger.error("Invalid F2D header : "+t,(0,h.errorCodeString)(h.ErrorCodes.BAD_DATA)),!1;var i=e.getString(2);if("01"!==i)return l.logger.error("Only support f2d major version 1; actual version is : "+i,(0,h.errorCodeString)(h.ErrorCodes.BAD_DATA)),!1;if("."!==e.getString(1))return l.logger.error("Invalid version delimiter.",(0,h.errorCodeString)(h.ErrorCodes.BAD_DATA)),!1;e.getString(2);return!0},m.prototype.parse=function(){if(this.readHeader()){for(var e=this.stream;e.offset<e.byteLength&&(this.parseDataType(),!this.error);)this.opCount++;this.linkNumber&&(this.linkBoxes[this.linkNumber]=this.currentLinkBox.clone(),this.currentLinkBox.makeEmpty()),this.flushBuffer(0,!0),this.currentVbb=null,this.stream=null,this.data=null,l.logger.info("F2d parse: data types count : "+this.opCount)}},m.prototype.parseFrames=function(e){if(this.data)for(var t=this.stream=new a.A(this.data);t.offset<t.byteLength&&(this.parseDataType(),!this.error);)this.opCount++;else e||l.logger.warn("Unexpected F2D parse state: If there is no data, we only expect a flush command, but flush was false.");e&&this.flushBuffer(0,!0),this.stream=null,this.data=null},m.prototype.actOnPolylinePointsArray=function(e){this.flushBuffer();for(var t=e.length/2,i=0,r=e[0],n=e[1],o=1;o<t;++o){var s=e[2*o],a=e[2*o+1];this.currentVbb.addSegment(r,n,s,a,i,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId),i+=Math.sqrt((s-r)*(s-r)+(a-n)*(a-n)),r=s,n=a}this.numPolylines++,this.numLineSegs+=t-1,this.currentGeomMetrics.plines++,this.currentGeomMetrics.pline_points+=t-1},m.prototype.actOnDot=function(e){this.currentGeomMetrics.dots++;var t=e[0],i=e[1];this.actOnCompleteCircle(t,i,this.sx(1),!0)},m.prototype.actOnCompleteCircle=function(e,t,i,r){this.flushBuffer(),this.numCircles++,r||this.currentGeomMetrics.circles++,this.fill?this.currentVbb.addSegment(e,t,e,t,0,2*i,this.color,this.objectNumber,this.layer,this.currentVpId):this.currentVbb.addArc(e,t,0,2*Math.PI,i,i,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},m.prototype.actOnCircularArc=function(e,t,i,r,n){this.numCircles++,this.currentGeomMetrics.circ_arcs++,this.flushBuffer(),this.currentVbb.addArc(e,t,i,r,n,n,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},m.prototype.actOnArc=function(e,t,i,r,n,o,s){this.numEllipses++,this.currentGeomMetrics.arcs++,this.flushBuffer(),this.currentVbb.addArc(e,t,i,r,n,o,s,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},m.prototype.actOnRaster=function(){if(this.manifestAvailable){this.flushBuffer(4,!0);var e=this.parseObjState.raster,t=e.position,i=e.imageId,r=this.imageId2URI[i],n=this.sx(e.width),o=this.sy(e.height),s=t[0]+.5*n,a=t[1]-.5*o;this.currentVbb.addTexturedQuad(s,a,n,o,0,4278255615,this.objectNumber,this.layer,this.currentVpId),this.currentImage={dataURI:r},this.flushBuffer(0,!0),this.currentGeomMetrics.rasters++}},m.prototype.actOnClip=function(){var e=this.parseObjState.clip;this.parseObjState.clip={},this.clips.push(e),this.currentGeomMetrics.clips++},m.prototype.actOnText=function(){this.strings[this.currentStringNumber]=this.parseObjState.text.string,this.currentGeomMetrics.texts++,this.currentGeomMetrics.strings.push(this.parseObjState.text.string),this.stringDbIds[this.currentStringNumber]=this.objectNumber,this.stringBoxes.push(this.currentStringBox.min.x,this.currentStringBox.min.y,this.currentStringBox.max.x,this.currentStringBox.max.y),this.extendStringsFetching&&(this.stringCharWidths.push(this.parseObjState.text.charWidths),this.stringAngles.push(this.parseObjState.text.rotation),this.stringPositions.push(this.parseObjState.text.position),this.stringHeights.push(this.parseObjState.text.height)),this.currentStringBox.makeEmpty(),this.currentStringNumber=-1,this.objectNumber<-1&&(this.objectNumber=0)};var g=new o.LmvVector3;m.prototype.addPolyTriangle=function(e,t,i,r,n,o,s){var a=this,h=null,c=-1;function u(e,t){if(e>t){var i=e;e=t,t=i}if(h[e]){var r=h[e],n=r.lastIndexOf(t);-1==n?r.push(t):r[n]=-1}else h[e]=[t]}function p(i,s){if(i>s){var u=i;i=s,s=u}var d=h[i];d&&(-1!=d.indexOf(s)&&(a.flushBuffer(4),a.currentVbb.addSegment(e[2*i],e[2*i+1],e[2*s],e[2*s+1],0,c,a.mapColor(t?t[i]:r,!0),n,o,a.currentVpId),t&&t[i]!=t[s]&&l.logger.warn("Gouraud triangle encountered. Will have incorrect antialiasing.")))}if(this.objectStack[this.objectStack.length-1]==d.st_text&&(c=-.5),s){h=new Array(e.length/2);for(let e=0,t=i.length;e<t;e+=3){let t=i[e],r=i[e+1],n=i[e+2];u(t,r),u(r,n),u(n,t)}}if(-1!==this.currentStringNumber||this.linkNumber){let t=e.length/2;for(let i=0;i<t;++i)g.set(e[2*i],e[2*i+1],0),-1!==this.currentStringNumber&&this.currentStringBox.expandByPoint(g),this.linkNumber&&this.currentLinkBox.expandByPoint(g)}if(this.currentVbb.useInstancing){let a=i.length;for(let l=0;l<a;l+=3){let a=i[l],h=i[l+1],c=i[l+2];this.flushBuffer(4),this.currentVbb.addTriangleGeom(e[2*a],e[2*a+1],e[2*h],e[2*h+1],e[2*c],e[2*c+1],this.mapColor(t?t[a]:r,!0),n,o,this.currentVpId),s&&(p(a,h),p(h,c),p(c,a))}}else{var f=e.length/2;this.flushBuffer(f);for(var m=this.currentVbb,v=m.vcount,y=0;y<f;++y){var b=e[2*y],x=e[2*y+1];m.addVertexPolytriangle(b,x,this.mapColor(t?t[y]:r,!0),n,o,this.currentVpId)}m.addIndices(i,v),s&&function(){for(var i=0,s=h.length;i<s;i++){var u=h[i];if(u)for(var d=0;d<u.length;d++){var p=u[d];-1!=p&&(a.flushBuffer(4),a.currentVbb.addSegment(e[2*i],e[2*i+1],e[2*p],e[2*p+1],0,c,a.mapColor(t?t[i]:r,!0),n,o,a.currentVpId),t&&t[i]!=t[p]&&l.logger.warn("Gouraud triangle encountered. Will have incorrect antialiasing."))}}}()}},m.prototype.actOnPolyTriangle=function(){var e=this.parseObjState.polyTriangle;this.parseObjState.polyTriangle={};var t=e.points,i=e.indices,r=e.colors;if(t&&i){if(this.objectStack[this.objectStack.length-1]==d.st_text){if(this.excludeTextGeometry)return}else this.currentGeomMetrics.ptris++,this.currentGeomMetrics.ptri_points+=t.length/2,this.currentGeomMetrics.ptri_indices+=i.length;this.numPolytriangles++,this.numTriangles+=i.length/3,this.addPolyTriangle(t,r,i,this.color,this.objectNumber,this.layer,!0)}else l.logger.warn("Malformed polytriangle.")},m.prototype.actOnViewport=function(){var e=this.parseObjState.viewport;this.parseObjState.viewport={},e.geom_metrics=this.currentGeomMetrics={arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]},this.viewports.push(e),this.currentVpId=this.viewports.length-1},m.prototype.createLayerGroups=function(e){var t=this.layersRoot={name:"root",id:"root",childrenByName:{},isLayer:!1},i=0,r=0;for(var n in e){var o=parseInt(n),s=e[n],a="string"==typeof s?s:s.name;a||(a=n);var l=a.split("|"),h=t;if(l.length>1)for(var c=0;c<l.length-1;++c){var u=l[c],d=h.childrenByName[u];d||(d={name:u,id:"group-"+i++,childrenByName:{},isLayer:!1},h.childrenByName[u]=d),h=d}h.childrenByName[a]={name:a,index:o,id:r++,childrenByName:{},isLayer:!0}}!function e(t){var i=Object.keys(t.childrenByName).map((function(e){return t.childrenByName[e]}));if(delete t.childrenByName,i.length){t.children=i,t.childCount=0;for(var r=0;r<i.length;++r)t.childCount+=e(i[r]);i.sort((function(e,t){return e.isLayer&&!t.isLayer?-1:!e.isLayer&&t.isLayer?1:e.name.localeCompare(t.name,void 0,{sensitivity:"base",numeric:!0})}))}return t.isLayer?1:t.childCount}(this.layersRoot)}},13555:e=>{const t=new Array(256);for(let e=0;e<256;e++){let i=e.toString(16);1===i.length&&(i="0"+i),t[e]=i}var i=new Array(20),r=new Array(10);e.exports={binToPackedString:function(e,t,i){for(var n=20===i?r:[],o=0;o<i;o+=2){var s=e[t+o],a=e[t+o+1];n[o/2]=a<<8|s}return String.fromCharCode.apply(null,n)},unpackHexString:function(e){for(var r=10===e.length?i:[],n=0;n<e.length;n++){var o=e.charCodeAt(n);r[2*n]=t[255&o],r[2*n+1]=t[o>>8&255]}return r.join("")},packedToBin:function(e,t,i){for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);t[i+2*r]=255&n,t[i+2*r+1]=n>>8&255}}}},13770:(e,t,i)=>{"use strict";i.r(t),i.d(t,{readLmvBufferGeom:()=>L,serializeLmvBufferGeom:()=>C});var r=i(7247),n=i(67837),o=i(60812);const s={Index:0,IndexEdges:1,Position:2,Normal:3,TextureUV:4,Color:5},a=0,l=1,h=2,c=3,u=4,d=5,p=6,f=7,m=8,g=9,v=10,y={TRIANGLES:0,LINES:1,POINTS:2,WIDE_LINES:3},b={position:s.Position,normal:s.Normal,index:s.Index,indexlines:s.IndexEdges,color:s.Color},x={};x[s.Position]="position",x[s.Normal]="normal",x[s.Index]="index",x[s.IndexEdges]="indexlines",x[s.Color]="color",x[s.TextureUV]="uv";const _={};function E(e){var t=[];for(let i=0;i<e.length;i+=2)t.push([e[i],e[i+1]]);for(const e of t)if(e[0]>e[1]){var i=e[0];e[0]=e[1],e[1]=i}t.sort((function(e,t){return e[0]-t[0]}));var r=t[0],n=0;e[n]=r[0],e[n+1]=r[1]-r[0],n+=2;for(let i=1;i<t.length;i++,n+=2)r=t[i],e[n]=r[0]-t[i-1][0],e[n+1]=r[1]-r[0]}function A(e){if(e.length){e[1]+=e[0],e[2]+=e[0];for(var t=3;t<e.length;t+=3)e[t]+=e[t-3],e[t+1]+=e[t],e[t+2]+=e[t]}}function S(e){if(e.length){e[1]+=e[0];for(var t=2;t<e.length;t+=2)e[t]+=e[t-2],e[t+1]+=e[t]}}function w(e){var t=x[e];return t||(console.error("Unknown vertex attribute"),s.TextureUV)}function M(){}function T(e){this.buffer=e,this.readOffset=0,this.meshFlag=0,this.numBuffers=0,this.numAttributes=0,this.bufferOffsets=[],this.attributes=[],this.buffers=[]}function C(e){var t=new M;if(!e.vb)return console.error("Unexpected non-interleaved vertex buffer"),null;const i=e.vb,r=e.vbstride,n=e.ib,o=e.iblines,a=[i.byteLength,n.byteLength];o&&a.push(o.byteLength);var l,h,c=Object.keys(e.attributes),u=0;e.isLines&&(u|=y.LINES),e.isWideLines&&(u|=y.WIDE_LINES),e.isPoints&&(u|=y.POINTS),t.beginHeader(u,c.length,a);for(var d=0;d<c.length;d++){var p=e.attributes[c[d]],f=(l=c[d],h=void 0,void 0!==(h=b[l])?h:(0===l.indexOf("uv")||console.warn("Unknown attribute name"),s.TextureUV));"index"===c[d]?t.addAttribute(f,p,0,1):"indexlines"===c[d]?t.addAttribute(f,p,0,2):t.addAttribute(f,p,r,0)}t.endHeader();var m=Buffer.from(i.buffer,i.byteOffset,i.byteLength);return t.addBuffer(m),e.isLines?E(n):function(e){var t,i,r=[];for(let t=0;t<e.length;t+=3)r.push([e[t],e[t+1],e[t+2]]);for(n of r)for(;n[0]>n[1]||n[0]>n[2];)i=void 0,i=(t=n)[0],t[0]=t[1],t[1]=t[2],t[2]=i;r.sort((function(e,t){return e[0]-t[0]}));var n=r[0],o=0;e[o]=n[0],e[o+1]=n[1]-n[0],e[o+2]=n[2]-n[0],o+=3;for(let t=1;t<r.length;t++,o+=3)n=r[t],e[o]=n[0]-r[t-1][0],e[o+1]=n[1]-n[0],e[o+2]=n[2]-n[0]}(n),m=Buffer.from(n.buffer,n.byteOffset,n.byteLength),t.addBuffer(m),o&&(E(o),m=Buffer.from(o.buffer,o.byteOffset,o.byteLength),t.addBuffer(m)),t.end()}_[a]=1,_[l]=2,_[h]=1,_[c]=2,_[u]=1,_[d]=2,_[p]=1,_[f]=2,_[m]=4,_[g]=4,_[v]=4,M.prototype.beginHeader=function(e,t,i){var r=8,n=i.length;for(r+=4*(n-1),r+=5*t;r%4!=0;)r++;var o=0;for(let e=0;e<i.length;e++)o+=i[e];this.buffer=Buffer.alloc(r+o),this.writeOffset=0;for(let e=0;e<4;e++)this.writeOffset=this.buffer.writeUInt8("OTG0".charCodeAt(e),this.writeOffset);this.writeOffset=this.buffer.writeUInt16LE(e,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(n,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(t,this.writeOffset);var s=i[0];for(let e=1;e<i.length;e++)this.writeOffset=this.buffer.writeUInt32LE(s,this.writeOffset),s+=i[e]},M.prototype.addAttribute=function(e,t,i,r){this.writeOffset=this.buffer.writeUInt8(e,this.writeOffset),e===s.Index||e===s.IndexEdges?(this.writeOffset=this.buffer.writeUInt8(function(e){var t=c,i=e.bytesPerItem||2;return 1===i?t=h:2===i?t=c:4===i&&(t=v),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(i||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(r,this.writeOffset)):(this.writeOffset=this.buffer.writeUInt8(function(e){var t=m,i=e.bytesPerItem||4;return 1===i?t=e.normalized?p:h:2===i&&(t=e.normalized?f:c),t<<4|15&e.itemSize}(t),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(t.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(i||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(r,this.writeOffset))},M.prototype.endHeader=function(){for(;this.writeOffset%4!=0;)this.writeOffset=this.buffer.writeUInt8(0,this.writeOffset)},M.prototype.addBuffer=function(e){e.copy(this.buffer,this.writeOffset),this.writeOffset+=e.length},M.prototype.end=function(){return this.writeOffset!==this.buffer.length&&console.error("Incorrect encoding buffer size"),this.buffer},T.prototype.readNodeJS=function(){if("OTG0"!==this.buffer.toString("ascii",0,4))return console.error("Invalid OTG header"),!1;if(this.readOffset=4,this.meshFlag=this.buffer.readUInt16LE(this.readOffset),this.readOffset+=2,this.numBuffers=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numAttributes=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numBuffers){this.bufferOffsets.push(0);for(var e=1;e<this.numBuffers;e++){var t=this.buffer.readUInt32LE(this.readOffset);this.readOffset+=4,this.bufferOffsets.push(t)}}for(let e=0;e<this.numAttributes;e++){var i={};i.name=this.buffer.readUInt8(this.readOffset),this.readOffset++;var r=this.buffer.readUInt8(this.readOffset);this.readOffset++,i.itemSize=15&r,i.type=r>>4,i.bytesPerItem=_[i.type],i.normalized=i.type===u||i.type===d||i.type===p||i.type===f,i.itemOffset=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,i.itemStride=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,i.bufferIndex=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.attributes.push(i)}for(;this.readOffset%4!=0;)this.readOffset++;for(let e=0;e<this.bufferOffsets.length;e++){var n,o=this.readOffset+this.bufferOffsets[e];n=e<this.bufferOffsets.length-1?this.readOffset+this.bufferOffsets[e+1]:this.buffer.length,this.buffers.push(this.buffer.slice(o,n))}return!0},T.prototype.readWeb=function(){var e=new n.A(this.buffer);if("OTG0"!==e.getString(4))return console.error("Invalid OTG header"),!1;if(this.meshFlag=e.getUint16(),this.numBuffers=e.getUint8(),this.numAttributes=e.getUint8(),this.numBuffers){this.bufferOffsets.push(0);for(let i=1;i<this.numBuffers;i++){var t=e.getUint32();this.bufferOffsets.push(t)}}for(let t=0;t<this.numAttributes;t++){var i={};i.name=e.getUint8();var r=e.getUint8();i.itemSize=15&r,i.type=r>>4,i.bytesPerItem=_[i.type],i.normalized=i.type===u||i.type===d||i.type===p||i.type===f,i.itemOffset=e.getUint8()/4,i.itemStride=e.getUint8()/4,i.bufferIndex=e.getUint8(),this.attributes.push(i)}for(;e.offset%4!=0;)e.offset++;for(let t=0;t<this.bufferOffsets.length;t++){var o,s=e.offset+this.bufferOffsets[t];o=t<this.bufferOffsets.length-1?e.offset+this.bufferOffsets[t+1]:e.byteLength,this.buffers.push(this.buffer.subarray(s,o))}return!0},T.prototype.read=function(){return(0,r.isNodeJS)()&&this.buffer instanceof Buffer?this.readNodeJS():this.readWeb()};var P=new o.LmvBox3;P.min.x=-.5,P.min.y=-.5,P.min.z=-.5,P.max.x=.5,P.max.y=.5,P.max.z=.5;var D={center:{x:0,y:0,z:0},radius:Math.sqrt(.75)};function L(e,t){var i=new T(e);if(!i.read())return console.error("Failed to parse OTG geometry"),null;var r={vblayout:{},vb:new Float32Array(i.buffers[0].buffer,i.buffers[0].byteOffset,i.buffers[0].byteLength/4),isLines:(3&i.meshFlag)===y.LINES,isWideLines:(3&i.meshFlag)===y.WIDE_LINES,isPoints:(3&i.meshFlag)===y.POINTS,boundingBox:P,boundingSphere:D};let n=0;for(var o=0;o<i.attributes.length;o++){var a=i.attributes[o];if(a.name===s.Index){var l=i.buffers[1];1===a.bytesPerItem?r.indices=l:2===a.bytesPerItem?r.indices=new Uint16Array(l.buffer,l.byteOffset,l.byteLength/a.bytesPerItem):4===a.bytesPerItem&&(r.indices=new Uint32Array(l.buffer,l.byteOffset,l.byteLength/a.bytesPerItem)),r.isLines?S(r.indices):A(r.indices)}else if(a.name===s.IndexEdges){if(!t){var h=i.buffers[2];1===a.bytesPerItem?r.iblines=h:2===a.bytesPerItem?r.iblines=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/a.bytesPerItem):4===a.bytesPerItem&&(r.iblines=new Uint32Array(h.buffer,h.byteOffset,h.byteLength/a.bytesPerItem)),S(r.iblines)}}else{var c=w(a.name);"uv"===c&&(n++,n>1&&(c+=n.toString())),r.vbstride?r.vbstride!==a.itemStride&&console.error("Unexpected vertex buffer stride mismatch."):r.vbstride=a.itemStride,a.itemOffset>=a.itemStride||(r.vblayout[c]={bytesPerItem:a.bytesPerItem,offset:a.itemOffset,normalized:a.normalized,itemSize:a.itemSize})}}return{mesh:r,packId:0,meshIndex:0}}},45459:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Empty2DModelLoader:()=>r});class r{constructor(e){this.viewer3DImpl=e}loadFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const n=t.width||100,o=t.height||100;r&&r(),this.svf={is2d:!0,viewports:[],layersMap:{0:0},layerCount:1,bbox:new THREE.Box3(new THREE.Vector3(0,0,0),new THREE.Vector3(n,o,0)),fragments:{length:1,fragId2dbId:[0],dbId2fragId:{},transforms:new Float32Array(12),boxes:[0,0,0,n,o,0]},loadOptions:{bubbleNode:new Autodesk.Viewing.BubbleNode({urn:"Dummy_urn",guid:"Dummy_guid"})},metadata:{page_dimensions:{page_width:n,page_height:o,logical_width:n,logical_height:o,logical_offset_x:0,logical_offset_y:0,page_units:"inch"}},strings:[],stringDbIds:[],loadDone:!0};const s=new Autodesk.Viewing.Model(this.svf);s.initialize(),s.loader=this,this.model=s,i(null,s),this.viewer3DImpl.api.dispatchEvent({type:Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,svf:this.svf,model:s}),this.viewer3DImpl.onLoadComplete(s)}dtor(){}is2d(){return!0}is3d(){return!1}}},80810:(e,t,i)=>{"use strict";i.r(t),i.d(t,{F2DLoader:()=>x,OUTPUT_TYPE:()=>b});var r=i(60489),n=i(86945),o=i(12529),s=i(22599),a=i(77876),l=i(6972),h=i(68110),c=i(66799),u=i(10028),d=i(7247),p=i(18878),f=i(33664),m=i(97790),g=i(45894),v=i(75050);const y=Autodesk.Viewing.Private,b={GEOMETRY:"geometry",VERTEX_BUFFER:"vertexBuffer"};function x(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new v.Matrix4,this.logger=r.logger,this.loadTime=0}x.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,r.logger.debug("F2D loader dtor: on init worker script.")),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,r.logger.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,r.logger.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.loadTime=0,this.svf=null,this.model=null,this.options=null},x.prototype.isValid=function(){return!!this.viewer3DImpl},x.prototype.loadFile=function(e,t,i,n){if(!this.viewer3DImpl)return r.logger.log("F2D loader was already destructed. So no longer usable."),!1;if(this.loading)return r.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.loading=!0;var o=e.indexOf("urn:");if(-1!=o){var s=(e=decodeURIComponent(e)).substr(o,e.substr(o).indexOf("/"));r.logger.log("Extracted URN: "+s);var a=s.lastIndexOf(":");this.svfUrn=s.substr(a+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0;var l=this;return this.initWorkerScriptToken=(0,c.initWorkerScript)((function(){l.loadFydoCB(e,t,i,n)})),!0},x.prototype.loadFydoCB=function(e,t,i,n){this.t0=Date.now();var o=(0,h.pathToURL)(e);this.streamingWorker=(0,c.createWorker)(!0),this.parsingWorker=(0,c.createWorker)();var l=this,u=!0,f=function(){l.parsingWorker.terminate(),l.parsingWorker=null};this.streamingWorker.addEventListener("message",(function(e){var h;l.isValid()&&(u&&n&&(u=!1,n()),e.data&&"F2DBLOB"==e.data.type?(h={operation:"PARSE_F2D",data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,noShadow:t.noShadow,isMobile:(0,d.isMobileDevice)(),excludeTextGeometry:t.excludeTextGeometry,outputType:t.outputType||b.VERTEX_BUFFER,extendStringsFetching:t.extendStringsFetching},url:o},l.parsingWorker.doOperation(h,[h.data]),l.streamingWorker.terminate(),l.streamingWorker=null):e.data&&"F2DSTREAM"==e.data.type?(h={operation:"PARSE_F2D_FRAME",data:e.data.frames,url:o,f2dLoadOptions:{modelSpace:t.modelSpace,bgColor:t.bgColor,noShadow:t.noShadow,isMobile:(0,d.isMobileDevice)(),excludeTextGeometry:t.excludeTextGeometry,outputType:t.outputType||b.VERTEX_BUFFER,extendStringsFetching:t.extendStringsFetching}},e.data.metadata&&(h.metadata=e.data.metadata,h.manifest=e.data.manifest),e.data.finalFrame&&(h.finalFrame=!0,l.streamingWorker.terminate(),l.streamingWorker=null,l.fileMemorySize/=2),e.data.progress&&l.viewer3DImpl.signalProgress(100*e.data.progress,a.ProgressState.LOADING),l.parsingWorker.doOperation(h,h.data?[h.data]:void 0)):e.data&&"F2DAssetURL"==e.data.type||e.data&&e.data.progress||(e.data&&e.data.debug?r.logger.debug(e.data.message):e.data&&e.data.error?(l.loading=!1,l.streamingWorker.terminate(),l.streamingWorker=null,i&&i(e.data.error)):(r.logger.error("F2D download failed.",(0,s.errorCodeString)(s.ErrorCodes.NETWORK_FAILURE)),l.loading=!1,l.streamingWorker.terminate(),l.streamingWorker=null)))}),!1);var g=t.outputType===b.GEOMETRY?function(e){if(l.isValid()&&(u&&n&&(u=!1,n()),e.data&&e.data.f2d)){l.svf=e.data.f2d;const t=e.data.f2d.geometry;f(),r.logger.info("Num polylines: "+t.numPolylines),r.logger.info("Line segments: "+t.numLineSegs),r.logger.info("Circular arcs: "+t.numCircles),r.logger.info("Ellipitcal arcs:"+t.numEllipses),l.onModelRootLoadDone(l.svf),i&&i(null,l.model),l.viewer3DImpl.api.dispatchEvent({type:p.MODEL_ROOT_LOADED_EVENT,svf:l.svf,model:l.model}),l.onGeomLoadDone()}}:function(e){var t,o;if(l.isValid())if(u&&n&&(u=!1,n()),e.data&&e.data.f2d){for(t=l.svf=e.data.f2d,f(),r.logger.info("Num polylines: "+t.numPolylines),r.logger.info("Line segments: "+t.numLineSegs),r.logger.info("Circular arcs: "+t.numCircles),r.logger.info("Ellipitcal arcs:"+t.numEllipses),r.logger.info("Plain triangles:"+t.numTriangles),r.logger.info("Total # of op codes generated by fydo.parse: "+t.opCount),l.onModelRootLoadDone(l.svf),i&&i(null,l.model),l.viewer3DImpl.api.dispatchEvent({type:p.MODEL_ROOT_LOADED_EVENT,svf:l.svf,model:l.model}),o=0;o<t.meshes.length;o++)l.processReceivedMesh2D(t.meshes[o],o);t.meshes=null,l.onGeomLoadDone(),l.loading=!1}else if(e.data&&e.data.f2dframe){var a=0;if(e.data.meshes){var h=e.data.bbox;l.svf.bbox=(new v.Box3).copy(h),l.svf.modelSpaceBBox=l.svf.bbox.clone(),l.svf.placementTransform&&l.svf.bbox.applyMatrix4(l.svf.placementTransform),a=e.data.baseIndex}else l.svf=e.data.f2dframe,a=e.data.baseIndex;if((t=l.svf).fragments&&t.fragments.initialized||(l.onModelRootLoadDone(t),i&&i(null,l.model),l.viewer3DImpl.api.dispatchEvent({type:p.MODEL_ROOT_LOADED_EVENT,svf:t,model:l.model})),e.data.meshes&&e.data.meshes.length)for(o=0;o<e.data.meshes.length;o++)l.processReceivedMesh2D(e.data.meshes[o],a+o);if(e.data.finalFrame){var c=e.data.cumulativeProps;for(var d in c)t[d]=c[d];f(),l.onGeomLoadDone(),l.loading=!1}}else e.data&&e.data.progress||(e.data&&e.data.debug?r.logger.debug(e.data.message):e.data&&e.data.error?(l.loading=!1,f(),r.logger.error("Error while processing F2d: "+JSON.stringify(e.data.error.args)),i&&i(e.data.error)):(r.logger.error("F2D download failed.",(0,s.errorCodeString)(s.ErrorCodes.NETWORK_FAILURE)),l.loading=!1,f()))};this.parsingWorker.addEventListener("message",g,!1);var y={operation:"STREAM_F2D",url:o,objectIds:t.ids,queryParams:this.queryParams};return this.streamingWorker.doOperation(m.endpoint.initLoadContext(y)),!0},x.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,i=this.svf,s=i.fragments,a=s.mesh2frag[t];if(void 0===a)return void r.logger.warn("Mesh "+t+" was not referenced by any fragments.");Array.isArray(a)||(a=[a]);var l=e.mesh;l.dbIds[-1]&&this.options.hideBackground&&this.model.changePaperVisibility(!1);const h=n.BufferGeometryUtils.meshToGeometry(e);if(h.unpackXform=l.unpackXform,l.texData){var c=new v.DataTexture(new Uint8Array(l.texData.buffer),l.texData.length,1,v.RGBAFormat,v.UnsignedByteType,v.UVMapping,v.ClampToEdgeWrapping,v.ClampToEdgeWrapping,v.NearestFilter,v.NearestFilter,0);c.generateMipmaps=!1,c.flipY=!1,c.needsUpdate=!0,h.tIdColor=c,h.vIdColorTexSize=new v.Vector2(l.texData.length,1)}var u=a.length,d=this.model;d.getGeometryList().addGeometry(h,u,e.meshIndex+1);const f=(0,o.getPolygonCount)(h);for(var m=0;m<a.length;m++){var g=0|a[m];d.getFragmentList().getOriginalWorldMatrix(g,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new v.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var y=s.materials[g].toString();s.polygonCounts&&(s.polygonCounts[g]=f);var b=this.viewer3DImpl.setupMesh(this.model,h,y,this.tmpMatrix);d.activateFragment(g,b)}s.mesh2frag[t]=null,s.numLoaded+=a.length;var x=s.numLoaded;i.geomPolyCount>i.nextRepaintPolys&&(i.numRepaints++,i.nextRepaintPolys+=1e4*Math.pow(1.5,i.numRepaints),this.viewer3DImpl.api.dispatchEvent({type:p.LOADER_REPAINT_REQUEST_EVENT,loader:this,model:this.model})),x%20==0&&this.viewer3DImpl.api.dispatchEvent({type:p.LOADER_REPAINT_REQUEST_EVENT,loader:this,model:this.model})},x.prototype.processReceivedMesh2D=function(e,t){t>=this.bufferCount&&(this.bufferCount=t+1);var i={mesh:e,is2d:!0,packId:"0",meshIndex:t},r="0:"+t,n=this.svf.fragments;if(!n.fragId2dbId[t]){var o=Object.keys(i.mesh.dbIds).map((function(e){return parseInt(e)}));n.fragId2dbId[t]=o;for(var s=0;s<o.length;s++){var a=o[s],l=n.dbId2fragId[a];Array.isArray(l)?l.push(t):n.dbId2fragId[a]=void 0!==l?[l,t]:t}const r=this.model.getFragmentList();if(e.material.modelScale=this.modelScale,e.material.opacity=this.options.opacity,e.material.doNotCut=this.options.doNotCut||(null==r?void 0:r.getDoNotCut()),null!=r&&r.viewBounds){const t=r.viewBounds;e.material.viewportBounds=new v.Vector4(t.min.x,t.min.y,t.max.x,t.max.y)}var h=this.viewer3DImpl,c=this;n.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.model,e.material,!1,!1,(function(e,t){var i=t.getData();null==i||!i.loadDone||i.texLoadDone||f.TextureLoader.requestsInProgress()||(i.texLoadDone=!0,h.onTextureLoadComplete(t)),(0,d.isMobileDevice)()&&f.TextureLoader.requestsInProgress()||h.api.dispatchEvent({type:p.LOADER_REPAINT_REQUEST_EVENT,loader:c,model:t})})),n.length++}n.mesh2frag[r]=t,this.processReceivedMesh(i)},x.prototype.onModelRootLoadDone=function(e){var t,i;e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId={},e.fragments.length=0,e.fragments.initialized=!0,e.fragments.numLoaded=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath="";var n=this.currentLoadPath.lastIndexOf("/");-1!==n&&(e.basePath=this.currentLoadPath.substr(0,n+1)),e.placementTransform=null===(t=this.options.placementTransform)||void 0===t?void 0:t.clone(),e.placementWithOffset=null===(i=this.options.placementTransform)||void 0===i?void 0:i.clone(),e.loadOptions=this.options,e.texLoadDone=!1;var o=Date.now();r.logger.log("F2D load: "+(o-this.t0)),this.t1=o,e.bbox=(new v.Box3).copy(e.bbox),e.modelSpaceBBox=e.bbox.clone(),e.placementTransform&&e.bbox.applyMatrix4(e.placementTransform);var s=this.model=new g.Model(e);s.loader=this,s.initialize(),this.options.skipPropertyDb||(this.svf.propDbLoader=new u.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)),r.logger.log("scene bounds: "+JSON.stringify(e.bbox));var l={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount};r.logger.track(l),this.viewer3DImpl.setDoNotCut(s,!!this.options.doNotCut),this.viewer3DImpl.signalProgress(5,a.ProgressState.ROOT_LOADED,this.model)},x.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var e=Date.now(),t="Fragments load time: "+(e-this.t1);this.loadTime+=e-this.t0,f.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipPropertyDb||this.loadPropertyDb(),r.logger.log(t);var i={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().getCount(),urn:this.svfUrn};r.logger.track(i,!0);var n=this.model.getGeometryList();const o={load_time:this.loadTime,polygons:n.geomPolyCount,fragments:this.model.getFragmentList().getCount(),mem_usage:n.gpuMeshMemory,viewable_type:"2d"};y.analytics.track("viewer.model.loaded",o),this.currentLoadPath=null,this.isf2d=void 0,this.viewer3DImpl.onLoadComplete(this.model)},x.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},x.prototype.is3d=function(){return!1},l.FileLoaderManager.registerFileLoader("f2d",["f2d"],x)},39461:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LeafletLoader:()=>m});var r=i(77876),n=i(22599),o=i(60489),s=i(68110),a=i(44434),l=i(33664),h=i(6972),c=i(45894),u=i(97790),d=i(18878),p=i(75050);const f=Autodesk.Viewing.Private;function m(e){var t=e;this.isLeafletLoader=!0,this.loading=!1;var i=function(e,t){var i=[80,75,1,2],r=t;if(e[r++]!==i[0]||e[r++]!==i[1]||e[r++]!==i[2]||e[r++]!==i[3])return o.logger.error("invalid file header signature"),null;var n={};return n.version=e[r++],n.os=e[r++],n.needVersion=e[r++]|e[r++]<<8,n.flags=e[r++]|e[r++]<<8,n.compression=e[r++]|e[r++]<<8,n.time=e[r++]|e[r++]<<8,n.date=e[r++]|e[r++]<<8,n.crc32=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,n.compressedSize=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,n.plainSize=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,n.fileNameLength=e[r++]|e[r++]<<8,n.extraFieldLength=e[r++]|e[r++]<<8,n.fileCommentLength=e[r++]|e[r++]<<8,n.diskNumberStart=e[r++]|e[r++]<<8,n.internalFileAttributes=e[r++]|e[r++]<<8,n.externalFileAttributes=e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24,n.relativeOffset=(e[r++]|e[r++]<<8|e[r++]<<16|e[r++]<<24)>>>0,n.filename=String.fromCharCode.apply(null,e.slice(r,r+=n.fileNameLength)),n.extraField=e.slice(r,r+=n.extraFieldLength),n.comment=e.slice(r,r+n.fileCommentLength),n.length=r-t,n},h=function(e){var t=function(e){var t=[80,75,3,4],i=0;if(e[i++]!==t[0]||e[i++]!==t[1]||e[i++]!==t[2]||e[i++]!==t[3])return o.logger.error("invalid local file header signature"),null;var r={};return r.needVersion=e[i++]|e[i++]<<8,r.flags=e[i++]|e[i++]<<8,r.compression=e[i++]|e[i++]<<8,r.time=e[i++]|e[i++]<<8,r.date=e[i++]|e[i++]<<8,r.crc32=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,r.compressedSize=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,r.plainSize=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24)>>>0,r.fileNameLength=e[i++]|e[i++]<<8,r.extraFieldLength=e[i++]|e[i++]<<8,r.filename=String.fromCharCode.apply(null,e.slice(i,i+=r.fileNameLength)),r.extraField=e.slice(i,i+=r.extraFieldLength),r.length=i,r}(e);if(!t)return null;var i=t.length,r=t.compressedSize;return e.slice(i,i+r)};this.continueLoadFile=function(e,i,s,l,h,u){var m,g,v=this;if(!v.loading)return void s({code:n.ErrorCodes.LOAD_CANCELED,msg:"Load canceled"},null);null!==(m=i.loadOptions)&&void 0!==m&&m.loadFromZip?g="{z}/{x}_{y}."+i.loadOptions.mime.split("/")[1]:g=e;h.initFromLoadOptions(g,i.loadOptions,u,i);let y=null;l&&l(),!h.valid()&&h.initForSimpleImage(e),h.onRootLoaded=function(){if(!v.loading)return void s({code:n.ErrorCodes.LOAD_CANCELED,msg:"Load canceled"},null);var a=new function(n){var o;this.bbox=new p.Box3,this.basePath=e,this.is2d=!0,this.urn=null===(o=i.bubbleNode)||void 0===o?void 0:o.getRootNode().urn();var s=n&&n.paperWidth>=0?n.paperWidth:h.texWidth,a=n&&n.paperHeight>=0?n.paperHeight:h.texHeight;this.pageToModelTransform=h.getPageToModelTransform(s,a),this.metadata={},this.metadata.page_dimensions={};var l=this.metadata.page_dimensions;l.page_width=s,l.page_height=a,l.page_units=n&&n.paperUnits,this.loadDone=!0,this.isLeaflet=!0,t.signalProgress(100,r.ProgressState.LOADING),h.texWidth>0&&(this.maxPixelPerUnit=h.texWidth/h.getQuadWidth(),h.isSimpleImage&&(this.maxPixelPerUnit*=10))}(i.loadOptions);a.loadOptions=i,a.bbox.copy(h.getBBox()),a.modelSpaceBBox=a.bbox.clone(),i.placementTransform&&(a.placementTransform=i.placementTransform.clone(),a.placementWithOffset=i.placementTransform.clone(),a.bbox.applyMatrix4(i.placementTransform));const l=new c.Model(a);return l.addTraversalController("Custom",y),l.loader=v,t.api.dispatchEvent({type:d.MODEL_ROOT_LOADED_EVENT,svf:a,model:l}),y.callWhenRefined((function(){var e,t=Date.now();a.loadTime=t-v.t0,o.logger.log("SVF load: "+a.loadTime),f.analytics.track("viewer.model.loaded",{load_time:a.loadTime,total_raster_pixels:null===(e=a.loadOptions.bubbleNode)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.totalRasterPixels,viewable_type:"2d"})})),s(null,l),v.loading=!1,l.id},h.onDone=s,h.getPixelRatio=t.glrenderer().getPixelRatio,h.maxAnisotropy=t.glrenderer().getMaxAnisotropy(),h.placementTransform=i.placementTransform,y=new a.ModelIteratorTexQuad(h,t.getMaterials()),y.requestRootTile()},this.loadFile=function(e,t,r,c){if(this.loading)return o.logger.log("Loading of Leaflet already in progress. Ignoring new request."),!1;var d=this;this.loading=!0,this.options=t,this.t0=Date.now();var f=new a.TexQuadConfig,m=null,g=t.acmSessionId;if(t.loadOptions&&t.loadOptions.loadFromZip){m=function(e,t,i){for(var r,n=e.split("/")[0]-f.levelOffset,o=0;o<f.zips.length;o++)if(n<=f.zips[o].zipMaxLevel){r=f.zips[o];break}if(!r)return i("Failed loading texture - tile's level doesn't exists."),!1;var s=r.fileTable[e];if(!s)return i("Failed loading texture - entry does not exist inside fileTable."),!1;var a={extractImage:h},c=s.relativeOffset,u=s.relativeOffset+s.contentSize;r.rawData?a.rawData=r.rawData.slice(c,u):a.range={min:c,max:u},l.TextureLoader.loadTextureWithSecurity(r.urnZip,p.UVMapping,t,i,g,!0,a)};t.loadOptions.zips.forEach((function(a){var l=a.centralDirOffset,h=a.centralDirLength,p=a.centralDirEntries;!function(e,t,i,r,n,o){var a=null,l={};(0,u.isOffline)()||(t&&(a="acmsession="+t),l.range={min:i,max:r+i});var h=(0,u.initLoadContext)({queryParams:a});s.ViewingService.getItem(h,e,n,o,l)}(a.urnZip,g,l,h,(function(n){(0,u.isOffline)()&&(a.rawData=n,n=n.slice(l,l+h));var o=function(e,t,r){for(var n,o=0,s={},a=null,l=0;l<r;++l){if(!(n=i(e,o)))return null;a&&(a.contentSize=n.relativeOffset-a.relativeOffset),o+=n.length,s[n.filename]=n,a=n}return a.contentSize=t-a.relativeOffset,s}(n,l,p);if(!o)return r("Failed parsing central directory of the zip.",null),!1;a.fileTable=o,t.loadOptions.zips.every((function(e){return Object.keys(e.fileTable).length>0}))&&d.continueLoadFile(e,t,r,c,f,m)}),(function(e){o.logger.error("Zip download failed: "+e.statusText,(0,n.errorCodeString)(n.ErrorCodes.NETWORK_FAILURE)),r("Zip download failed: "+e.statusText,null)}))}))}else m=function(e,t,i){l.TextureLoader.loadTextureWithSecurity(e,p.UVMapping,t,i,g,!0)},this.continueLoadFile(e,t,r,c,f,m);return!0},this.dtor=function(){this.loading=!1}}m.prototype.is3d=function(){return!1},m.prototype.isPageCoordinates=function(){var e;return!(null===(e=this.options)||void 0===e||null===(e=e.loadOptions)||void 0===e||!e.fitPaperSize)},h.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],m)},5774:(e,t,i)=>{"use strict";i.r(t),i.d(t,{OtgLoader:()=>ye});var r=i(194),n=i(60812),o=i(60489),s=i(33664),a=i(50982),l=i(33736),h=i(10028),c=i(66799),u=i(97790),d=i(68110),p=i(96164);function f(e){switch(e){case"meter":case"meters":case"m":default:return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001}}function m(e,t){if(e.metadata){var i=e.metadata["world bounding box"],o=new p.LmvVector3(i.minXYZ[0],i.minXYZ[1],i.minXYZ[2]),s=new p.LmvVector3(i.maxXYZ[0],i.maxXYZ[1],i.maxXYZ[2]);e.bbox=new n.LmvBox3(o,s),e.modelSpaceBBox=e.bbox.clone();var a=function(e,t){var i=e.metadata["custom values"];if(e.placementTransform=t.placementTransform,t.applyScaling){var n="m";e.metadata["distance unit"]&&(n=e.metadata["distance unit"].value),e.scalingUnit=n,"object"==typeof t.applyScaling?(t.applyScaling.from&&(n=t.applyScaling.from),t.applyScaling.to&&(e.scalingUnit=t.applyScaling.to)):e.scalingUnit=t.applyScaling;var o=f(n)/f(e.scalingUnit);if(1!=o){var s=new r.LmvMatrix4(!0),a=new r.LmvMatrix4(!0);a.elements[0]=o,a.elements[5]=o,a.elements[10]=o,t.placementTransform&&s.copy(t.placementTransform),t.applyPlacementInModelUnits?t.placementTransform=a.multiply(s):t.placementTransform=s.multiply(a),e.placementTransform=t.placementTransform,e.scalingFactor=o}}if(i&&i.refPointTransform){e.refPointTransform=new r.LmvMatrix4(!0);var l=e.refPointTransform.elements,h=i.refPointTransform;l[0]=h[0],l[1]=h[1],l[2]=h[2],l[4]=h[3],l[5]=h[4],l[6]=h[5],l[8]=h[6],l[9]=h[7],l[10]=h[8],l[12]=h[9],l[13]=h[10],l[14]=h[11]}else{var c=e.metadata.georeference,u=c&&c.refPointLMV,d=0;if(i&&Object.prototype.hasOwnProperty.call(i,"angleToTrueNorth")&&(d=Math.PI/180*i.angleToTrueNorth),u||d){var p=new r.LmvMatrix4(!0),m=p.elements;m[0]=m[5]=Math.cos(d),m[1]=-Math.sin(d),m[4]=Math.sin(d);var g=new r.LmvMatrix4(!0);m=g.elements,u&&(m[12]=-u[0],m[13]=-u[1],m[14]=-u[2]),e.refPointTransform=p.multiply(g)}}if(t.applyRefPoint&&e.refPointTransform){var v=new r.LmvMatrix4(!0);t.placementTransform&&v.copy(t.placementTransform),v.multiply(e.refPointTransform),e.placementTransform=t.placementTransform=v}else!t.applyRefPoint&&t.placementTransform&&(e.placementTransform=new r.LmvMatrix4(!0).copy(t.placementTransform));return e.placementTransform&&function(e){for(var t=e.elements,i=0;i<4;i++)for(var r=0;r<4;r++)if(i===r){if(1!==t[4*i+r])return!1}else if(0!==t[4*i+r])return!1;return!0}(e.placementTransform)&&(e.placementTransform=null),e.placementTransform}(e,t);a&&!e.bbox.isEmpty()&&e.bbox.applyMatrix4(a),t.globalOffset?e.globalOffset=t.globalOffset:e.globalOffset=e.bbox.getCenter(new p.LmvVector3),function(e,t){var i=e.globalOffset;if(i.x||i.y||i.z){if(t){var n=new r.LmvMatrix4(!0);n.copy(t),(t=n).elements[12]-=i.x,t.elements[13]-=i.y,t.elements[14]-=i.z}else(t=new r.LmvMatrix4(!0)).makeTranslation(-i.x,-i.y,-i.z);e.placementWithOffset=t}else e.placementWithOffset=t}(e,a),e.bbox.isEmpty()||(e.bbox.min.sub(e.globalOffset),e.bbox.max.sub(e.globalOffset)),Object.prototype.hasOwnProperty.call(e.metadata,"double sided geometry")&&e.metadata["double sided geometry"].value&&(e.doubleSided=!0)}}function g(e,t){e[0]-=t.x,e[1]-=t.y,e[2]-=t.z}function v(e,t){if(t&&(t.transformPoint(e.position),t.transformPoint(e.target),t.transformDirection(e.up),isFinite(e.orthoScale))){const i=t.getMaxScaleOnAxis();e.orthoScale*=i}}var y=i(13555),b=i(27923);function x(e,t){var i,r,n,s,a,l=0;function h(e){let l=new Uint8Array(4);if("string"==typeof e)for(let t=0;t<4;t++)l[t]=e.charCodeAt(t);else for(let t=0;t<4;t++)l[t]=e[t];(i=l[1]<<8|l[0])||(i=t||0),i||o.logger.error("Unknwon byte stride."),i%4&&o.logger.error("Expected byte size to be multiple of 4, but got "+i),r=l[3]<<8|l[2],i/4,n=new Uint8Array(i),s=new Float32Array(n.buffer),a=new Uint32Array(n.buffer)}this.onData=function(t,r,o){void 0===r&&(r=t.length);for(var s="string"==typeof t;;){if(!l&&r>=4)h(t),l++;else if(r<4)return!1;var a=l*i;if(r<a+i)return o;if(s)for(let e=0;e<i;e++)n[e]=255&t.charCodeAt(e+a);else for(let e=0;e<i;e++)n[e]=t[e+a];if(!e(this,l))return!1;l++}},this.onEnd=function(e,t){this.onData(e,t,!0)||(this.rawData=e,this.rawLength=t)},this.flush=function(){this.rawData&&(this.onData(this.rawData,this.rawLength,!0)&&(this.rawData=null))},this.idata=function(){return a},this.fdata=function(){return s},this.bdata=function(){return n},this.version=function(){return r},this.byteStride=function(){return i}}var _,E,A,S,w,M=i(10209),T=i(67837);function C(e){var t=this.stream=new T.A(e),i=t.getInt32();this.type=t.getString(i),this.version=t.getInt32(),this.types=null,this.entryOffsets=[];var r=t.offset;t.seek(t.byteLength-8);var n=t.getUint32();this.typesOffset=t.getUint32(),t.seek(this.typesOffset);var o=this.readU32V();this.types=[];for(var s=0;s<o;++s)this.types.push({entryClass:this.readString(),entryType:this.readString(),version:this.readU32V()});t.seek(n);var a=this.readU32V(),l=this.entryOffsets;for(let e=0;e<a;++e)l.push(t.getUint32());t.seek(r)}C.prototype.readVarint=function(){var e,t=0,i=0;do{t|=(127&(e=this.stream.getUint8()))<<i,i+=7}while(128&e);return t},C.prototype.readU32V=C.prototype.readVarint,C.prototype.readU16=function(){return this.stream.getUint16()},C.prototype.readU8=function(){return this.stream.getUint8()},C.prototype.readString=function(){return this.stream.getString(this.readU32V())},C.prototype.readVector3f=function(){var e=this.stream;return{x:e.getFloat32(),y:e.getFloat32(),z:e.getFloat32()}},C.prototype.readF32=function(){return this.stream.getFloat32()},C.prototype.readF64=function(){return this.stream.getFloat64()},C.prototype.readVector3d=(_={x:0,y:0,z:0},function(){var e=this.stream;return _.x=e.getFloat64(),_.y=e.getFloat64(),_.z=e.getFloat64(),_}),C.prototype.readQuaternionf=(E={x:0,y:0,z:0,w:0},function(){var e=this.stream;return E.x=e.getFloat32(),E.y=e.getFloat32(),E.z=e.getFloat32(),E.w=e.getFloat32(),E}),C.prototype.readMatrix3f=(A=new r.LmvMatrix4,function(e){e||(e=A);var t=this.stream;e.identity();for(var i=0;i<3;++i)for(var r=0;r<3;++r)e.elements[4*i+r]=t.getFloat32();return e}),C.prototype.readTransform=(S={x:1,y:1,z:1},w=new r.LmvMatrix4(!0),function(e,t,i,n,o,s){var a,l,h=this.stream;switch(h.getUint8()){case 4:w.identity();break;case 0:a=this.readVector3d(),w.makeTranslation(a.x,a.y,a.z);break;case 1:l=this.readQuaternionf(),a=this.readVector3d(),S.x=1,S.y=1,S.z=1,w.compose(a,l,S);break;case 2:var c=h.getFloat32();l=this.readQuaternionf(),a=this.readVector3d(),S.x=c,S.y=c,S.z=c,w.compose(a,l,S);break;case 3:this.readMatrix3f(w),a=this.readVector3d(),w.setPosition(a)}if(s&&(s[0]=w.elements[12],s[1]=w.elements[13],s[2]=w.elements[14]),n&&w.multiplyMatrices(n,w),o&&(w.elements[12]-=o.x,w.elements[13]-=o.y,w.elements[14]-=o.z),void 0===e)return(new r.LmvMatrix4).copy(w);var u=w.elements;t&&(t[i+0]=u[0],t[i+1]=u[1],t[i+2]=u[2],t[i+3]=u[4],t[i+4]=u[5],t[i+5]=u[6],t[i+6]=u[8],t[i+7]=u[9],t[i+8]=u[10],t[i+9]=u[12],t[i+10]=u[13],t[i+11]=u[14])}),C.prototype.getEntryCounts=function(){return this.entryOffsets.length},C.prototype.seekToEntry=function(e){if(e>=this.getEntryCounts())return null;this.stream.seek(this.entryOffsets[e]);var t=this.stream.getUint32();return t>=this.types.length?null:this.types[t]},C.prototype.readPathID=function(){let e,t=this.stream;if(this.version<2){let i=t.getUint16();if(!i)return null;if(t.getUint16(),1==i)return"";e=t.getUint16();for(let r=2;r<i;++r)e+="/"+t.getUint16()}else{let t=this.readU32V();if(!t)return null;if(this.readU32V(),1==t)return"";e=this.readU32V();for(let i=2;i<t;++i)e+="/"+this.readU32V()}return e};const P=1,D=2,L=4,I=8,R=16,O=32;function N(e,t,i){if(!e.seekToEntry(i))return null;const r={},n=e.readVarint();if(n&P){r.cameraEntry=e.readVarint();const i={definition:r.cameraEntry};r.camera=function(e,t){var i=t.definition,r=e.seekToEntry(i);if(!r)return null;if(r.version>2)return null;var n=e.stream,o={isPerspective:!n.getUint8(),position:e.readVector3f(),target:e.readVector3f(),up:e.readVector3f(),aspect:n.getFloat32(),fov:n.getFloat32()*(180/Math.PI)};return r.version<2&&(n.getFloat32(),n.getFloat32()),o.orthoScale=n.getFloat32(),o}(t,i)}if(n&D&&(r.cameraTransform=e.readTransform(),r.camera&&r.cameraTransform&&v(r.camera,r.cameraTransform)),n&L&&(r.renderMode=e.readU8()),n&I&&(r.primitiveDisplayFlags=e.readU8()),n&O&&(r.overrideSet=e.readVarint()),n&R)if(r.clipPlaneMode=e.readU8(),0===r.clipPlaneMode){r.sectionCount=e.readU8(),r.clipData={},r.sectionPlane=[];for(let t=0;t<r.sectionCount;t++){const t=Object.assign({},e.readVector3f()),i=e.readF64();r.sectionPlane.push(-t.x,-t.y,-t.z,i)}}else{r.clipData={};const t=Object.assign({},e.readVector3d()),i=Object.assign({},e.readVector3d()),n=Object.assign({},e.readQuaternionf());r.sectionBox={min:t,max:i},r.sectionBoxTransform=n,r.isFromViewpoint=!0}return r}const F=1,k=2,V=4,U=8;function B(e,t){const i=e.readVarint();let r=0;for(let n=0;n<i;++n){r+=e.readVarint(),t(r)}}function G(e,t){if(!e.seekToEntry(t))return null;const i={},r=e.stream.getUint32();if(r&F&&(i.defaultMaterialIndex=e.readVarint(),i.defaultMaterialFlags=e.readU8()),r&k&&(i.defaultFlags=e.readVarint()),r&V){i.materialOverrides=[];const t=e.readVarint();for(let r=0;r<t;++r){let t=e.readVarint();B(e,(function(e){i.materialOverrides.push({dbId:e,materialIndex:t})}))}}if(r&U){i.flagOverrides=[];const t=e.readVarint();for(let r=0;r<t;++r){let t=e.readVarint();B(e,(function(e){i.flagOverrides.push({dbId:e,flags:t})}))}}return i}const z={NI_Inner:0,NI_Leaf:1};function H(e){const t=e.readString();let i=function(e){let t="";for(let i=0;i<16;i++)t+=e.readU8();return t}(e);const r=e.readU8();if(r===z.NI_Leaf){return{name:t,entry:e.readVarint(),uuid:i}}if(r===z.NI_Inner){const i=e.readVarint(),r=[];for(let t=0;t<i;t++){const t=H(e);r.push(t)}return{name:t,children:r}}return{}}function W(e){return e.seekToEntry&&e.seekToEntry(0),H(e)}const j="urn:adsk.fluent:",q="$otg_cdn$";function X(){this.materials=null,this.fragments=null,this.geompacks=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],dbid:[]},this.bbox=null,this.animations=null,this.globalOffset={x:0,y:0,z:0},this.pendingRequests=0,this.initialLoadProgress=0,this.viewpointProgress=0,this.materialIdToHash=[],this.aborted=!1,this.viewpoints=[],this.overrideSets=[],this.extraMatHashes={}}X.prototype.getMaterialHash=function(e){var t=this.materialIdToHash[e];if(t)return t;var i=this.materialHashes.byteStride,r=(0,y.binToPackedString)(this.materialHashes.hashes,e*i,i);return this.materialIdToHash[e]=r,r},X.prototype.getExtraMaterialHashes=function(){var e;let t=new Set;null===(e=this.overrideSets)||void 0===e||e.forEach((e=>{const{defaultMaterialIndex:i,materialOverrides:r}=e;i&&t.add(i),null==r||r.forEach((e=>{t.add(e.materialIndex)}))}));const i=[...t].filter((e=>!this.materialIdToHash[e]));i.length&&(this.needExtraMaterials=!0);for(const e of i){var r=this.getMaterialHash(e);this.extraMatHashes[e]=r}},X.prototype.getGeometryHash=function(e){var t=this.geomMetadata.byteStride;return(0,y.binToPackedString)(this.geomMetadata.hashes,e*t,t)},X.prototype.initEmptyLists=function(e){var t=this,i=t.fragments={};i.length=t.metadata.stats.num_fragments,i.numLoaded=0,i.boxes=e.fragmentTransformsDouble?new Float64Array(6*i.length):new Float32Array(6*i.length),i.transforms=e.fragmentTransformsDouble?new Float64Array(12*i.length):new Float32Array(12*i.length),i.materials=(0,b.R)(i.length,t.metadata.stats.num_materials),i.geomDataIndexes=(0,b.R)(i.length,t.metadata.stats.num_geoms),i.fragId2dbId=new Int32Array(i.length),i.visibilityFlags=new Uint8Array(i.length),i.mesh2frag={},i.topoIndexes=null,t.geomMetadata={hashes:null,byteStride:0,version:0,numLoaded:0,hashToIndex:{}},t.materialHashes={hashes:null,byteStride:0,version:0,numLoaded:0},t.materials={name:"LMVTK Simple Materials",version:"1.0",scene:{SceneUnit:8215,YIsUp:0},materials:{}}},X.prototype.loadAsyncResource=function(e,t,i,r){var n=this;this.pendingRequests++,t=(0,d.pathToURL)(t,e.basePath),d.ViewingService.getItem(e,t,(function(e){n.pendingRequests--,r(e)}),e.onFailureCallback,{responseType:i||"arraybuffer"})},X.prototype.loadAsyncProgressive=function(e,t,i,r,n){var o=this;t=(0,d.pathToURL)(t,e.basePath);const s=(0,M.getGlobal)().USE_FETCH_API;d.ViewingService.getItem(e,t,(function(t,n){i.onEnd(t,n),o.postLoad(e,r,i,t)}),n||e.onFailureCallback,{responseType:s?"arraybuffer":"text",onprogress:function(e,t){if(o.aborted)return!0;i.onData(e,t,!1)},useFetch:s})},X.prototype.loadMetadata=function(e,t){var i=this;this.loadAsyncResource(e,t,"json",(function(n){i.metadata=n,i.manifest=i.metadata.manifest,i.numGeoms=i.metadata.stats.num_geoms,i.processViewPointData(e),i.processMetadata(e),i.initEmptyLists(e);var o=i.metadata.manifest,s=o.shared_assets.pdb;for(let e in s)i.propertydb[e]&&i.propertydb[e].push({path:s[e],isShared:!0});var a=o.assets.pdb;for(let e in a)i.propertydb[e]&&i.propertydb[e].push({path:a[e],isShared:!1});o.assets.animations&&i.loadAsyncResource(e,o.assets.animations,"json",(function(e){i.animations=e,function(e){if(e.animations){var t=e.animations.animations;if(t)for(var i=e.globalOffset,n=(new r.LmvMatrix4).makeTranslation(i.x,i.y,i.z),o=(new r.LmvMatrix4).makeTranslation(-i.x,-i.y,-i.z),s=new r.LmvMatrix4,a=new r.LmvMatrix4,l=0;l<t.length;l++){var h=t[l];if(h.hierarchy)for(var c=0;c<h.hierarchy.length;c++){var u=h.hierarchy[c].keys;if(u)for(var d=0;d<u.length;d++){var p=u[d].pos;if(p){var f=i,m=u[d].rot;m&&(s.makeRotationFromQuaternion({x:m[0],y:m[1],z:m[2],w:m[3]}),a.multiplyMatrices(n,s).multiply(o),f={x:a.elements[12],y:a.elements[13],z:a.elements[14]}),g(p,f)}var v=u[d].target;v&&g(v,i);var y=u[d].points;if(y)for(var b=0;b<y.length;b++)g(y[b],i)}}}}}(i)})),o.assets.topology&&i.loadAsyncResource(e,t,"json",(function(e){i.topology=e})),e.onLoaderEvent("otg_root"),i.postLoad(e,"metadata")}))},X.prototype.loadFragmentList=function(e,t){var i=this,o=new p.LmvVector3,s=new p.LmvVector3,a={x:0,y:0,z:0,w:1},h=new r.LmvMatrix4(!0),c=new n.LmvBox3,u={x:0,y:0,z:0};let d=new x((function(t,r){if(r-=1,!i.metadata)return!1;var n=t.idata(),d=t.fdata(),p=i.fragments,f=p.geomDataIndexes[r]=n[0],m=p.materials[r]=n[1],g=p.fragId2dbId[r]=n[2],v=n[3];if(f>i.geomMetadata.numLoaded||m>i.materialHashes.numLoaded)return!1;var y,b=p.mesh2frag[f];void 0===b?p.mesh2frag[f]=r:Array.isArray(b)?b.push(r):p.mesh2frag[f]=[b,r],y=!i.dbIdFilter||i.dbIdFilter[g]?1&v?l.MeshFlags.MESH_HIDE:0:l.MeshFlags.MESH_NOTLOADED,p.visibilityFlags[r]=y;var x=i.metadata.fragmentTransformsOffset||u;o.set(d[4]+x.x,d[5]+x.y,d[6]+x.z),a.x=d[7],a.y=d[8],a.z=d[9],a.w=d[10],s.set(d[11],d[12],d[13]),h.compose(o,a,s),i.placementWithOffset&&h.multiplyMatrices(i.placementWithOffset,h);var _=h.elements,E=p.transforms,A=12*r;return E[A+0]=_[0],E[A+1]=_[1],E[A+2]=_[2],E[A+3]=_[4],E[A+4]=_[5],E[A+5]=_[6],E[A+6]=_[8],E[A+7]=_[9],E[A+8]=_[10],E[A+9]=_[12],E[A+10]=_[13],E[A+11]=_[14],c.min.x=-.5,c.min.y=-.5,c.min.z=-.5,c.max.x=.5,c.max.y=.5,c.max.z=.5,c.applyMatrix4(h),p.boxesLoaded||((E=p.boxes)[(A=6*r)+0]=c.min.x,E[A+1]=c.min.y,E[A+2]=c.min.z,E[A+3]=c.max.x,E[A+4]=c.max.y,E[A+5]=c.max.z),p.numLoaded=r+1,e.onLoaderEvent("fragment",r),!0}),52);return this.loadAsyncProgressive(e,t,d,"all_fragments"),d},X.prototype.handleHashListRequestFailures=function(e){this.metadata&&(this.geomHashListFailure&&this.metadata.stats.num_geoms>0&&e.onFailureCallback.apply(e,this.geomHashListFailure),this.matHashListFailure&&this.metadata.stats.num_materials>0&&e.onFailureCallback.apply(e,this.matHashListFailure),this.geomHashListFailure=null,this.matHashListFailure=null)},X.prototype.loadGeometryHashList=function(e,t){var i=this;let r=new x((function(e,t){return!!i.metadata&&(i.geomMetadata.hashes||(i.geomMetadata.hashes=new Uint8Array(e.byteStride()*(i.numGeoms+1)),i.geomMetadata.byteStride=e.byteStride(),i.geomMetadata.version=e.version()),i.geomMetadata.hashes.set(e.bdata(),t*e.byteStride()),i.geomMetadata.numLoaded=t,!0)}),20);return this.loadAsyncProgressive(e,t,r,"geometry_ptrs",(function(){i.geomHashListFailure=arguments,i.handleHashListRequestFailures(e),i.postLoad(e,"geometry_ptrs",r)})),r},X.prototype.loadMaterialHashList=function(e,t){var i=this;let r=new x((function(e,t){return!!i.metadata&&(i.materialHashes.hashes||(i.numMaterials=i.metadata.stats.num_materials,i.materialHashes.hashes=new Uint8Array(e.byteStride()*(i.numMaterials+1)),i.materialHashes.byteStride=e.byteStride(),i.materialHashes.version=e.version()),i.materialHashes.hashes.set(e.bdata(),t*e.byteStride()),i.materialHashes.numLoaded=t,!0)}),20);return this.loadAsyncProgressive(e,t,r,"material_ptrs",(function(){i.matHashListFailure=arguments,i.handleHashListRequestFailures(e),i.postLoad(e,"material_ptrs",r)})),r},X.prototype.processMetadata=function(e){var t=this,i=t.metadata;m(t,e);var r=t.placementWithOffset;if(i.cameras){t.cameras=i.cameras;for(var n=0;n<t.cameras.length;n++){var o=t.cameras[n];o.position=new p.LmvVector3(o.position.x,o.position.y,o.position.z),o.target=new p.LmvVector3(o.target.x,o.target.y,o.target.z),o.up=new p.LmvVector3(o.up.x,o.up.y,o.up.z),r&&v(o,r)}}},X.prototype.beginLoad=function(e,t){this.loadMetadata(e,t);let i=e.objectIds;if(i){this.dbIdFilter={};for(let e=0,t=i.length;e<t;e++)this.dbIdFilter[i[e]]=1}this.materialsCtx=this.loadMaterialHashList(e,"materials_ptrs.hl"),this.geometryCtx=this.loadGeometryHashList(e,"geometry_ptrs.hl"),this.fragmentsCtx=this.loadFragmentList(e,"fragments.fl")},X.prototype.makeSharedResourcePath=function(e,t,i){if(10===i.length&&(i=(0,y.unpackHexString)(i)),e){let o=this.manifest.shared_assets.global_sharding||0,s=i,a="";o&&(a="/"+i.slice(0,o),s=i.slice(o));var r=this.manifest.shared_assets[t];if(0===r.indexOf(j)||0===r.indexOf(q))r=r.slice(r.indexOf("/"));else{var n=r.split("/");r="/"+(n[n.length-1]||n[n.length-2])+"/"}return e+a+r+s}{let e=this.manifest.shared_assets.global_sharding||2,r=i,n="";return e&&(n="/"+i.slice(0,e)+"/",r=i.slice(e)),(0,d.pathToURL)(this.basePath)+this.manifest.shared_assets[t]+n+r}},X.prototype.postLoad=function(e,t,i,r){t&&this.initialLoadProgress++,4===this.initialLoadProgress?(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush(),this.materialsCtx=null,this.geometryCtx=null,this.fragmentsCtx=null,this.fragments.numLoaded<this.metadata.stats.num_fragments&&o.logger.warn("Fragments actually loaded fewer than expected."),e.onLoaderEvent("all_fragments")):"metadata"===t&&(this.materialsCtx.flush(),this.geometryCtx.flush(),this.fragmentsCtx.flush())},X.prototype.processViewPointData=function(e){var t=this;const i=t.manifest.assets.viewpoints;i?("camera_definitions"in i&&t.loadCameraDefinition(e,i.camera_definitions),"override_sets"in i&&t.loadOverrideSets(e,i.override_sets),"viewpoint_tree"in i&&t.loadViewpointTree(e,i.viewpoint_tree),"viewpoints"in i&&t.loadViewpoints(e,i.viewpoints)):e.onOperationComplete()},X.prototype.postLoadViewpointData=function(e){this.viewpointProgress++,4===this.viewpointProgress&&(this.processViewpoints(),this.getExtraMaterialHashes(),e.onLoaderEvent("viewpointData"))},X.prototype.loadCameraDefinition=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){i.cameraDef=new C(t),i.postLoadViewpointData(e)}))},X.prototype.loadOverrideSets=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){if(i.overrideSetsPack=new C(t),i.overrideSetsPack){for(let e=0,t=i.overrideSetsPack.getEntryCounts();e<t;e++){const t=G(i.overrideSetsPack,e);t&&i.overrideSets.push(t)}i.overrideSetsPack=null,i.postLoadViewpointData(e)}}))},X.prototype.loadViewpointTree=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){if(i.viewpointTreePack=new C(t),i.viewpointTreePack){const t=W(i.viewpointTreePack);i.viewpointTreeRoot=t,function(){const e=i.viewpointTreeRoot;if(e&&(e.name=e.name||"Saved Viewpoints"),null==e||!e.children)return;let t=0;function r(e){if(e.children){for(let t=0;t<e.children.length;t++)r(e.children[t]);e.type="folder",e.role="viewable",e.guid=t+++""}else isNaN(e.entry)||(e.order=t,e.type="view",e.role="3d",e.guid=t+++"",e.isViewpoint=!0)}for(let t=0;t<e.children.length;t++)r(e.children[t])}(),i.viewpointTreePack=null,i.postLoadViewpointData(e)}}))},X.prototype.loadViewpoints=function(e,t){let i=this;i.loadAsyncResource(e,t,null,(function(t){i.viewpointsDefPack=new C(t),i.postLoadViewpointData(e)}))},X.prototype.processViewpoints=function(){if(this.viewpointsDefPack&&this.cameraDef){for(let e=0,t=this.viewpointsDefPack.getEntryCounts();e<t;e++){const t=N(this.viewpointsDefPack,this.cameraDef,e);t&&this.viewpoints.push(t)}this.viewpointsDefPack=null,this.cameraDef=null}},X.prototype.abort=function(){this.aborted=!0};var Y=i(6972),K=i(45894),Q=i(39080),Z=i(18878),J=i(77876),$=i(7247),ee=i(88505),te=i(1098),ie=i(17252),re=i(75050);const ne=new re.Box3;class oe{static _buildNotCondition(e){const t=this._parse(e);return(e,i)=>!t(e,i)}static _buildOrCondition(e){const t=new Array;if(e instanceof Array)for(let i=0;i<e.length;++i)t.push(this._parse(e[i]));return(e,i)=>{for(const r of t)if(r(e,i))return!0;return!1}}static _buildAndCondition(e){const t=new Array;if(e instanceof Array)for(let i=0;i<e.length;++i)t.push(this._parse(e[i]));return(e,i)=>{let r=!0;for(const n of t)r&=n(e,i);return r}}static _buildEnclosesClause(e){const t=e[0];let i;for(i in t)break;const r=new re.Box3;[r.min.x,r.min.y,r.min.z,r.max.x,r.max.y,r.max.z]=t[i];const n=e.length>1&&"number"==typeof e[2]?e[2]:1e-8;return 0!==n&&r.expandByScalar(n),(e,t)=>(e.getFragmentList().getWorldBounds(t,ne),r.containsBox(ne))}static _buildIntersectsClause(e){const t=e[0];let i;for(i in t)break;const r=new re.Box3;return[r.min.x,r.min.y,r.min.z,r.max.x,r.max.y,r.max.z]=t[i],(e,t)=>(e.getFragmentList().getWorldBounds(t,ne),r.intersectsBox(ne))}static _buildExtentClause(e){return(t,i)=>{const r=new re.Box3;t.getFragmentList().getWorldBounds(i,r);const n=new re.Vector3;r.getSize(n);return n.x*n.y*n.z>e}}static _parse(e){let t;for(t in e)break;switch(t){case"$not":return this._buildNotCondition(e[t]);case"$or":return this._buildOrCondition(e[t]);case"$and":return this._buildAndCondition(e[t]);case"$encloses":return this._buildEnclosesClause(e[t]);case"$intersects":return this._buildIntersectsClause(e[t]);case"$extent":return this._buildExtentClause(e[t]);default:return void console.warn("Spatial Query Parser: condition type not supported, given",t)}}static parse(e){return this._parse(e)}}class se{_source;_predicate;static validate(e){return!0}fromString(e){if(this._source!==e){if(this._predicate=void 0,void 0!==e&&0!==e.length)return se.validate(e)?void(this._source=e):(console.warn("Validation of spatial query failed, given:",e),void(this._source=void 0));this._source=void 0}}fromObject(e){if(void 0===e||0===Object.keys(e).length)return this._source=void 0,void(this._predicate=void 0);const t=JSON.stringify(e);this.fromString(t)}isEmpty(){return void 0===this._source}isReady(){return!!this._predicate}initialize(){if(this.isEmpty()||this.isReady())return;const e=JSON.parse(this._source,((e,t)=>"number"==typeof t?parseFloat(t):t));this._predicate=oe.parse(e)}get isFragmentPassing(){return this._predicate}}const ae=/(["'])\?([\w\d\s]+)\1/g;class le{_source;_fragmentIDs;_extension;_initializing=!1;static validate(e){return!0}static async preprocessAttributeLookups(e,t,i){const r=await e.getAttributeDefinitions(t)||new Array,n=i.matchAll(ae);for(const e of n){const t=e[2].trim();let n=r.filter((e=>e.name===t)).map((t=>`${e[0][0]}s.props.${t.propertyHash}${e[0][0]}`));if(1===n.length)i=i.replace(e[0],n[0]);else console.error(`Expected unique property from hash lookup, found ${n.length}, given`,e[2]),i=i.replace(e[0],'"s.props.unresolved"')}return i}fromString(e){if(this._source!==e){if(this._fragmentIDs=void 0,void 0!==e&&0!==e.length)return le.validate(e)?void(this._source=e):(console.warn("Validation of property query failed, given:",e),void(this._source=void 0));this._source=void 0}}fromObject(e){if(void 0===e||0===Object.keys(e).length)return this._source=void 0,void(this._fragmentIDs=void 0);const t=JSON.stringify(e);this.fromString(t)}fromDbIDs(e,t){if(void 0===e||void 0===t)return void(this._fragmentIDs=void 0);const i=e.getInstanceTree(),r=new Array;t.forEach((e=>i.enumNodeFragments(e,(e=>{r.push(e)}),!0))),this._fragmentIDs=new Set(r)}isEmpty(){return void 0===this._source}isReady(){return!!this._fragmentIDs}isInitializing(){return this._initializing}async initialize(e){var t;if(this.isEmpty()||this.isReady())return;if(this._initializing=!0,void 0===this._extension){const t=e.loader.viewer3DImpl.api;this._extension=await t.loadExtension("Autodesk.Filter")}if(void 0===this._extension)return void console.warn("Expected loading Autodesk.Filter extension to succeed.");const i=await le.preprocessAttributeLookups(this._extension,e,this._source),r=JSON.parse(i,((e,t)=>"number"==typeof t?parseFloat(t):t)),n=await this._extension.getModelIdsWithFilter(e,r,void 0,void 0,!1),o=null===(t=n.ids)||void 0===t?void 0:t.concat(n.ids2??[]);this.fromDbIDs(e,o),this._initializing=!1}isFragmentPassing(e,t){return this._fragmentIDs.has(t)}}class he{_asyncInit;_match;_initializing=!1;_initialized=!1;fromObjects(e,t){this._asyncInit===e&&this._match===t||(this._asyncInit=e,this._match=t,this._initialized=!1)}isEmpty(){return void 0===this._match}isReady(){return!(void 0!==this._asyncInit)||!this._initializing&&this._initialized}needsInitializing(){return!(void 0!==this._asyncInit&&(this._initializing||this._initialized))}isInitializing(){return this._initializing}async initialize(e){if(!this.needsInitializing())return;this._initializing=!0;const t=e.loader.viewer3DImpl.api;await this._asyncInit(e,t),this._initializing=!1,this._initialized=!0}isFragmentPassing(e,t){return this._match(e,t)}}const ce=Object.freeze({FRAGMENT_LIST_READY:1,BOUNDING_VOLUME_HIERARCHY_READY:2,PROPERTIES_READY:4}),ue=Object.freeze({ON_FRAGMENT_READY:"immediate",ON_FRAGMENT_LIST_READY:"fast",ON_BOUNDING_VOLUME_HIERARCHY_READY:"exact"}),de=ue.ON_BOUNDING_VOLUME_HIERARCHY_READY,pe=Object.freeze({ANY:0,ALL:1}),fe=pe.ALL;class me{_model;_rootCondition=fe;_active=!1;_spatialQuery=new se;_spatialQueryLoadTimeBehavior=de;_propertyQuery=new le;_lambdaQuery=new he;_state=0;constructor(e){this.evaluate=e,this._state=0,this._isFragmentPassingImpl=this._isFragmentPassing_true}onModelRootReady(e){this._model=e}onFragmentReady(e){this._isFragmentPassingImpl===this._isFragmentPassing_spatial&&this.evaluate(e)}onFragmentListReady(){this.update(ce.FRAGMENT_LIST_READY)}onBoundingVolumeHierarchyReady(){this.update(ce.BOUNDING_VOLUME_HIERARCHY_READY)}onPropertiesReady(){this.update(ce.PROPERTIES_READY)}setRootCondition(e){void 0!==e&&this._rootCondition!==e&&(this._rootCondition=e)}setSpatialQueryBehavior(e){void 0!==e&&this._spatialQueryLoadTimeBehavior!==e&&(this._spatialQueryLoadTimeBehavior=e)}setSpatialQuery(e){this._spatialQuery.fromObject(e),this._active||=!this._spatialQuery.isEmpty()}setPropertyQuery(e){this._propertyQuery.fromObject(e),this._active||=!this._propertyQuery.isEmpty()}setLambdaQuery(e,t){this._lambdaQuery.fromObjects(e,t),this._active||=!this._lambdaQuery.isEmpty()}prepare(e){var t,i,r,n,o,s;this.setSpatialQuery(null===(t=e.filter)||void 0===t?void 0:t.spatial_query),this.setPropertyQuery(null===(i=e.filter)||void 0===i?void 0:i.property_query),this.setLambdaQuery(null===(r=e.filter)||void 0===r?void 0:r.asyncInit,null===(n=e.filter)||void 0===n?void 0:n.match);switch(null===(o=e.filter)||void 0===o?void 0:o.root_condition){case"or":this.setRootCondition(pe.ANY);break;case"and":this.setRootCondition(pe.ALL);break;default:this.setRootCondition(fe)}const a=null===(s=e.filter)||void 0===s?void 0:s.spatial_behavior;switch(a){case ue.ON_FRAGMENT_READY:case ue.ON_FRAGMENT_LIST_READY:case ue.ON_BOUNDING_VOLUME_HIERARCHY_READY:this.setSpatialQueryBehavior(a);break;default:this.setSpatialQueryBehavior(de)}const l=!this._spatialQuery.isEmpty(),h=this._propertyQuery.isEmpty(),c=this._rootCondition===pe.ANY||h,u=this._spatialQueryLoadTimeBehavior===ue.ON_FRAGMENT_READY;l&&u&&c&&(this._spatialQuery.initialize(),this._isFragmentPassingImpl=this._isFragmentPassing_spatial)}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&this._state&e)return;this._state|=e;if(this._spatialQuery.isEmpty()&&this._propertyQuery.isEmpty()&&this._lambdaQuery.isEmpty()){if(this._isFragmentPassingImpl=this._isFragmentPassing_true,!this._active)return;return void this.evaluate()}this._state|=void 0!==e?e:0;const i=!this._lambdaQuery.isEmpty(),r=!this._lambdaQuery.needsInitializing()||!!(this._state&ce.FRAGMENT_LIST_READY);let n=!i;switch(this._spatialQueryLoadTimeBehavior){case ue.ON_FRAGMENT_READY:n&&=!0;break;case ue.ON_FRAGMENT_LIST_READY:n&&=!!(this._state&ce.FRAGMENT_LIST_READY);break;case ue.ON_BOUNDING_VOLUME_HIERARCHY_READY:n&&=!!(this._state&ce.BOUNDING_VOLUME_HIERARCHY_READY)}const s=!i&&!!(this._state&ce.FRAGMENT_LIST_READY)&&!!(this._state&ce.PROPERTIES_READY),a=!this._spatialQuery.isEmpty();a&&n&&!this._spatialQuery.isReady()?(this._spatialQuery.initialize(),t=!0):!a||i||n||(t=!1);const l=!this._propertyQuery.isEmpty();if(l&&s&&!this._propertyQuery.isReady()&&!this._propertyQuery.isInitializing()){const e=this;return void this._propertyQuery.initialize(this._model).then((()=>e.update(void 0,!0)))}if(!l||i||s&&!this._propertyQuery.isInitializing()||(t=!1),i&&r&&!this._lambdaQuery.isReady()&&!this._lambdaQuery.isInitializing()){const e=this;return void this._lambdaQuery.initialize(this._model).catch((e=>{o.logger.warn("Filter initialization failed, falling back to load the whole model",e),this.setLambdaQuery(void 0)})).then((()=>e.update(void 0,!0)))}if(i&&r&&this._lambdaQuery.isReady())this._isFragmentPassingImpl=this._isFragmentPassing_lambda,t=!0;else{const e=a&&n&&this._spatialQuery.isReady(),t=l&&s&&this._propertyQuery.isReady();switch(this._rootCondition|a<<1|e<<2|l<<3|t<<4){case 6:case 14:case 7:this._isFragmentPassingImpl=this._isFragmentPassing_spatial;break;case 24:case 26:case 25:this._isFragmentPassingImpl=this._isFragmentPassing_property;break;case 30:this._isFragmentPassingImpl=this._isFragmentPassing_any;break;case 31:this._isFragmentPassingImpl=this._isFragmentPassing_all;break;default:this._isFragmentPassingImpl=this._isFragmentPassing_false}}this._isFragmentPassingImpl!==this._isFragmentPassing_false&&t&&this.evaluate()}evaluate(){throw new TypeError("Method expected to be replaced.")}_isFragmentPassing_true(){return!0}_isFragmentPassing_false(){return!1}_isFragmentPassing_spatial(e){return this._spatialQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_property(e){return this._propertyQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_all(e){return this._spatialQuery.isFragmentPassing(this._model,e)&&this._propertyQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_any(e){return this._spatialQuery.isFragmentPassing(this._model,e)||this._propertyQuery.isFragmentPassing(this._model,e)}_isFragmentPassing_lambda(e){return this._lambdaQuery.isFragmentPassing(this._model,e)}_isFragmentPassingImpl(e){throw new TypeError("This method must be set to a specific evaluation.")}isFragmentPassing(e){if(this._isFragmentPassingImpl===this._isFragmentPassing_true||this._isFragmentPassingImpl===this._isFragmentPassing_false||this._isFragmentPassingImpl===this._isFragmentPassing_lambda)return this._isFragmentPassingImpl(e);return this._isFragmentPassingImpl(e)}get isActive(){return this._active}}const ge=Autodesk.Viewing,ve=Autodesk.Viewing.Private;function ye(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new r.LmvMatrix4,this.tmpBox=new n.LmvBox3,this.logger=o.logger,this.loadTime=0,this.pendingMaterials={},this.pendingMaterialsCount=0,this.pendingMeshes={},this.pendingMeshesCount=0,this.pendingRequests=0,this.operationsDone=0,this.viewpointMatHashes=new Set,this.notifiesFirstPixel=!0,this._selectiveLoadingController=new me(ye.prototype.evaluate.bind(this)),this._lineageUrn=null}function be(e){var t="",i=e.lastIndexOf("/");return-1!=i&&(t=e.substr(0,i+1)),t}function xe(e){return e.acmSessionId?"acmsession="+e.acmSessionId:""}function _e(e,t,i){var r={basePath:t,objectIds:e.ids,globalOffset:e.globalOffset,fragmentTransformsDouble:e.fragmentTransformsDouble,placementTransform:e.placementTransform,applyRefPoint:e.applyRefPoint,queryParams:i,bvhOptions:e.bvhOptions||{isWeakDevice:(0,$.isMobileDevice)()},applyScaling:e.applyScaling,applyPlacementInModelUnits:e.applyPlacementInModelUnits,loadInstanceTree:e.loadInstanceTree};return(0,u.initLoadContext)(r)}function Ee(e){return Math.floor(100*e.fragsLoaded/e.metadata.stats.num_fragments)}ye.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,o.logger.debug("SVF loader dtor: on init worker script.")),this.bvhWorker&&(this.bvhWorker.terminate(),this.bvhWorker=null,o.logger.debug("SVF loader dtor: on svf worker.")),this.svf&&(this.svf.loadDone||console.log("stopping load before it was complete"),this.svf.abort(),this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null)),this.viewer3DImpl.geomCache()&&this.model&&(this.loading&&this.viewer3DImpl.geomCache().cancelRequests(this.svf.geomMetadata.hashToIndex),this.pendingRequests=0,this.removeMeshReceiveListener()),this.memoryLimitReached&&te.MemoryTracker.removeEventListener(te.RESOURCE_EVENTS.LIMIT_REACHED_EVENT,this.memoryLimitReached),this.viewer3DImpl=null,this.model=null,this.svf=null,this.logger=null,this.tmpMatrix=null,this.loading=!1,this.loadTime=0},ye.prototype.isValid=function(){return null!=this.viewer3DImpl},ye.prototype.removeMeshReceiveListener=function(){this.meshReceivedListener&&(this.viewer3DImpl.geomCache().loaderRemoved(),this.viewer3DImpl.geomCache().removeEventListener(ee.MESH_RECEIVE_EVENT,this.meshReceivedListener),this.viewer3DImpl.geomCache().removeEventListener(ee.MESH_FAILED_EVENT,this.meshFailedListener),this.viewer3DImpl.geomCache().removeEventListener(ee.MATERIAL_RECEIVE_EVENT,this.materialReceiveListener),this.viewer3DImpl.geomCache().removeEventListener(ee.MATERIAL_FAILED_EVENT,this.materialReceiveListener),this.meshReceivedListener=null,this.meshFailedListener=null)},ye.prototype.loadFile=function(e,t,i,r){if(!this.viewer3DImpl)return o.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.viewer3DImpl._signalNoMeshes(),this.loading)return o.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;if(this.loading=!0,t.acmSessionId)this.svfUrn=t.acmSessionId.split(",")[0];else{console.warn("DEPRECATED: Automatic derivation of URN will be removed in a future release. Please set the acmSessionId parameter when loading OTG data.");var n=e.indexOf(j);if(-1===n&&(n=e.indexOf(q)),-1!==n){var s=e.split("/"),a=s[1]+"?version="+s[2],l=ge.toUrlSafeBase64(a);this.svfUrn=l}}return this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.basePath=be(e),this.acmSessionId=t.acmSessionId,this.options=t,this.queryParams=xe(t),this.loadContext=_e(t,this.basePath,this.queryParams),this.loadContext.raiseError=function(e,t,r){i&&i({code:e,msg:t,args:r})},this.loadContext.onFailureCallback=d.ViewingService.defaultFailureCallback.bind(this.loadContext),this._selectiveLoadingController.prepare(t),this.loadModelRoot(this.loadContext,i),r&&r(),!0},ye.prototype._createPackage=function(){return new X},ye.prototype._workerScriptReadyCb=function(){for(var e in this._pendingMessages)Object.prototype.hasOwnProperty.call(this._pendingMessages,e)&&this._pendingMessages[e].forEach((t=>{this.loadContext.onLoaderEvent(e,t)}));this._pendingMessages={}},ye.prototype._requestRepaint=function(){var e;null!==(e=this.viewer3DImpl)&&void 0!==e&&e.modelVisible(this.model.id)&&this.viewer3DImpl.api.dispatchEvent({type:ge.LOADER_REPAINT_REQUEST_EVENT,loader:this,model:this.model})},ye.prototype.loadModelRoot=function(e,t){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this._pendingMessages={};var i=this,r=!1;this.initWorkerScriptToken=(0,c.initWorkerScript)((function(){r=!0,i._workerScriptReadyCb()}));var n=this.svf=this._createPackage();return n.basePath=e.basePath,e.onLoaderEvent=function(e,s){if(i.svf){if(!r)return Object.prototype.hasOwnProperty.call(i._pendingMessages,e)||(i._pendingMessages[e]=[]),void i._pendingMessages[e].push(s);if("otg_root"===e){i.onModelRootLoadDone(n),t&&t(null,i.model),i.makeBVHInWorker();var a=i.viewer3DImpl.geomCache();a||o.logger.error("geomCache is required for loading OTG models."),a.loaderAdded(i.options.acmSessionId,i._lineageUrn),i.memoryLimitReached=e=>{e.resourceType===te.RESOURCE_TYPES.MEMORY&&(i.viewer3DImpl.geomCache().cancelRequests(i.svf.geomMetadata.hashToIndex),i.viewer3DImpl.geomCache().addEventListener(ee.PENDING_REQUESTS_FINISHED_EVENT,(()=>{for(const[t,r]of Object.entries(i.pendingMeshes)){for(var e=0;e<r.length;e++)i.model.getFragmentList().setFlagFragment(r[e],l.MeshFlags.MESH_NOTLOADED,!0),i.model.getFragmentList().setFragOff(r[e],!0),i.pendingRequests--,i.trackGeomLoadProgress(i.svf,r[e],!1);delete i.svf.geomMetadata.hashToIndex[t],delete i.pendingMeshes[t],i.pendingMeshesCount--}}),{once:!0}))},te.MemoryTracker.addEventListener(ge.Private.RESOURCE_EVENTS.LIMIT_REACHED_EVENT,i.memoryLimitReached),i.meshReceivedListener=e=>i.onMeshReceived(e.geom),i.meshFailedListener=e=>i.onMeshError(e.hash),a.addEventListener(ee.MESH_RECEIVE_EVENT,i.meshReceivedListener),a.addEventListener(ee.MESH_FAILED_EVENT,i.meshFailedListener),i.materialReceiveListener=function(e){e.material&&e.material.length?i.onMaterialLoaded((0,ie.Up)(e.material),e.hash):i.onMaterialLoaded(null,e.hash)},a.addEventListener(ee.MATERIAL_RECEIVE_EVENT,i.materialReceiveListener),a.addEventListener(ee.MATERIAL_FAILED_EVENT,i.materialReceiveListener),i.svf.loadDone=!1}else if("fragment"===e){if(!i.options.skipMeshLoad){const e=s;i._selectiveLoadingController.isActive?i._selectiveLoadingController.onFragmentReady(e):i.tryToActivateFragment(e,"fragment")}i.options.onFragmentListLoadProgress&&i.trackFragmentListLoadProgress()}else if("all_fragments"===e)i.options.skipPropertyDb||(i.loadPropertyDb(),i._selectiveLoadingController.onPropertiesReady()),i.fragmentDataLoaded=!0,i._selectiveLoadingController.onFragmentListReady(),i.viewer3DImpl.api.fireEvent({type:Z.MODEL_ROOT_LOADED_EVENT,svf:n,model:i.model}),i.options.skipMeshLoad||!i.svf.fragments.length?i.onGeomLoadDone():i.onOperationComplete();else if("bvh"===e){var h=s;i.model&&(i.model.setBVH(h.nodes,h.primitives,i.options.bvhOptions),i._selectiveLoadingController.onBoundingVolumeHierarchyReady(),i._requestRepaint()),i.onOperationComplete()}else if("viewpointData"===e){if(i.svf.needExtraMaterials){Object.values(i.svf.extraMatHashes).forEach((e=>i.viewpointMatHashes.add(e))),i.tryToLoadExtraMaterials()}else i.onOperationComplete();i.svf.viewpointTreeRoot&&i.options.addViews&&i.options.addViews(i.svf.viewpointTreeRoot,i.model)}}else console.error("load callback called after load was aborted")},e.onOperationComplete=function(){i.onOperationComplete()},this.beginLoad(),!0},ye.prototype.beginLoad=function(){this.svf.beginLoad(this.loadContext,(0,d.pathToURL)(this.currentLoadPath))},ye.prototype.makeBVHInWorker=function(){var e=this;e.bvhWorker=(0,c.createWorker)();e.bvhWorker.addEventListener("message",(function(t){console.log("Received BVH from worker");var i=t.data.bvh;e.model&&(e.svf.bvh=i,e.model.setBVH(new a.NodeArray(i.nodes,i.useLeanNodes),i.primitives,e.options.bvhOptions),e.model.setFragmentBoundingBoxes(t.data.boxes,t.data.boxStride),e._selectiveLoadingController.onBoundingVolumeHierarchyReady(),e._requestRepaint()),e.bvhWorker.terminate(),e.bvhWorker=null,e.onOperationComplete()}));var t=Object.assign({},e.loadContext);t.operation="LOAD_OTG_BVH",t.raiseError=null,t.onFailureCallback=null,t.onLoaderEvent=null,t.onOperationComplete=null,t.fragments_extra=(0,d.pathToURL)(e.basePath)+e.svf.manifest.assets.fragments_extra,t.placementTransform=e.svf.placementTransform,t.placementWithOffset=e.svf.placementWithOffset,t.fragmentTransformsOffset=e.svf.metadata.fragmentTransformsOffset,t.globalOffset=e.svf.globalOffset,t.fragments_extra?e.bvhWorker.doOperation(t):e.onOperationComplete()},ye.prototype.tryToActivateFragment=function(e,t){var i=this.svf,r=this.model;if(!r)return;const n=i.fragments.visibilityFlags[e],o=n&l.MeshFlags.MESH_NOTLOADED||this._selectiveLoadingController.isActive&&!this._selectiveLoadingController.isFragmentPassing(e),s=!!(n&l.MeshFlags.MESH_HIDE),a=i.loadOptions.skipHiddenFragments??!1;if(o||s&&a)return r.getFragmentList().setFlagFragment(e,l.MeshFlags.MESH_NOTLOADED,!0),r.getFragmentList().setFragOff(e,!0),void this.trackGeomLoadProgress(i,e,!1);s&&(r.getFragmentList().setFlagFragment(e,l.MeshFlags.MESH_HIDE,!1),r.getFragmentList().setFlagFragment(e,l.MeshFlags.MESH_VISIBLE,!1));var h=!1,c=i.fragments.materials[e],u=i.getMaterialHash(c),d=this.findOrLoadMaterial(r,u);d||("fragment"===t&&(this.pendingMaterials[u].push(e),this.pendingRequests++),"material"!==t&&(h=!0));var p=i.fragments.geomDataIndexes[e];if(0!==p){var f=r.getGeometryList().getGeometry(p);if(f)"fragment"===t&&r.getGeometryList().addInstance(p);else{if("fragment"===t&&!this.loadGeometry(p,e))return r.getFragmentList().setFlagFragment(e,l.MeshFlags.MESH_NOTLOADED,!0),void this.trackGeomLoadProgress(i,e,!1);h=!0}if(!h){r.getFragmentList().getOriginalWorldMatrix(e,this.tmpMatrix);var m=this.viewer3DImpl.setupMesh(r,f,u,this.tmpMatrix);m.geomId=p,r.activateFragment(e,m,!!i.placementTransform),this.viewer3DImpl.geomCache().updateGeomImportance(r,e),this.trackGeomLoadProgress(i,e,!1)}}else(d||"material"===t)&&this.trackGeomLoadProgress(i,e,!1)},ye.prototype.tryToLoadExtraMaterials=function(){var e=this.svf,t=this.model;if(t&&!e.extraMaterialLoaded){e.extraMaterialLoaded=!0;for(const i of Object.values(e.extraMatHashes))this.findOrLoadMaterial(t,i)}},ye.prototype.onModelRootLoadDone=function(e){var t;e.isOTG=!0,e.geomMetadata.hashToIndex={},e.failedFrags={},e.failedMeshes={},e.failedMaterials={},e.fragsLoaded=0,e.fragsLoadedNoGeom=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options||{};var i=Date.now();o.logger.log("SVF load: "+(i-this.t0));var r=this.model=new K.Model(e);r.loader=this,r.initialize(),this._selectiveLoadingController.onModelRootReady(r),this.t1=i,o.logger.log("scene bounds: "+JSON.stringify(e.bbox));var n={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topology,has_animations:!!e.animations,materials:e.metadata.stats.num_materials,is_mobile:(0,$.isMobileDevice)()};o.logger.track(n),this.viewer3DImpl.signalProgress(5,J.ProgressState.ROOT_LOADED,this.model),e.handleHashListRequestFailures(this.loadContext),e.propDbLoader=new h.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this._lineageUrn=null===(t=r.getDocumentNode())||void 0===t?void 0:t.lineageUrn(),this._lineageUrn||(this._lineageUrn=Q.BubbleNode.parseLineageUrnFromDecodedUrn(Autodesk.Viewing.fromUrlSafeBase64(e.urn)))},ye.prototype.trackGeomLoadProgress=function(e,t,i){if(i){if(e.failedFrags[t])return void console.log("Double fail",t);e.failedFrags[t]=1}var r=Ee(e);e.fragsLoaded++;var n=Ee(e);n>r&&this.viewer3DImpl.signalProgress(n,J.ProgressState.LOADING,this.model),this.model.getGeometryList().geomPolyCount>e.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),e.numRepaints++,e.nextRepaintPolys+=1e5*Math.pow(1.5,e.numRepaints),this._requestRepaint()),e.fragsLoaded===e.metadata.stats.num_fragments&&this.onOperationComplete(),this.trackOnDemandLoadProgress()},ye.prototype.trackFragmentListLoadProgress=function(){var e=this.svf;function t(e){return Math.floor(100*e.fragsLoadedNoGeom/e.metadata.stats.num_fragments)}var i=t(e);e.fragsLoadedNoGeom++;var r=t(e);r>i&&this.options.onFragmentListLoadProgress(this.model,r)},ye.prototype.onOperationComplete=function(){this.operationsDone++,4===this.operationsDone&&this.onGeomLoadDone()},ye.prototype.onMaterialLoaded=async function(e,t,i){if(this.loading){var r=this.pendingMaterials[t];if(r){var n=this.viewer3DImpl.matman();if(e){e.hash=t;try{var o=await n.convertSharedMaterial(this.model,e,t);s.TextureLoader.loadMaterialTextures(this.model,o,this.viewer3DImpl),n.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0)}catch(e){this.svf.failedMaterials[t]=1}}else this.svf.failedMaterials[t]=1;for(var a=0;a<r.length;a++)this.pendingRequests--,this.tryToActivateFragment(r[a],"material");this.pendingMaterialsCount--,delete this.pendingMaterials[t],this.viewpointMatHashes.has(t)&&(this.viewpointMatHashes.delete(t),0===this.viewpointMatHashes.size&&this.onOperationComplete())}}},ye.prototype.findOrLoadMaterial=function(e,t){if(this.pendingMaterials[t])return!1;var i=this.svf;if(this.viewer3DImpl.matman().findMaterial(e,t))return!0;this.pendingMaterialsCount++,this.pendingMaterials[t]=[];var r=!!this.loadContext.otg_cdn,n=i.makeSharedResourcePath(this.loadContext.otg_cdn,"materials",t);return this.viewer3DImpl.geomCache().requestMaterial(n,r,t,void 0,this.queryParams,this._lineageUrn),!1},ye.prototype.loadGeometry=function(e,t){var i=this.svf,r=i.getGeometryHash(e);if(++this.pendingRequests,this.pendingMeshes[r])return this.pendingMeshes[r].push(t),!0;const n=this.viewer3DImpl.geomCache();if(te.MemoryTracker.memoryLimitReached()&&!n.getGeometry(r))return--this.pendingRequests,!1;this.pendingMeshesCount++,this.pendingMeshes[r]=[t];var o=!!this.loadContext.otg_cdn;i.geomMetadata.hashToIndex[r]=e;var s=i.makeSharedResourcePath(this.loadContext.otg_cdn,"geometry",r);return n.requestGeometry(s,o,r,e,this.queryParams,this._lineageUrn),!0},ye.prototype.onMeshError=function(e){this.svf.failedMeshes[e]=1;var t=this.pendingMeshes[e];if(t){for(var i=0;i<t.length;i++)this.trackGeomLoadProgress(this.svf,t[i],!0),this.pendingRequests--;delete this.svf.geomMetadata.hashToIndex[e],delete this.pendingMeshes[e],this.pendingMeshesCount--}},ye.prototype.onMeshReceived=function(e){var t=this.model;if(t){var i=t.getGeometryList(),r=this.svf.geomMetadata.hashToIndex[e.hash];if(void 0!==r){var n=i.hasGeometry(r),o=this.pendingMeshes[e.hash];if(!n){i.addGeometry(e,o&&o.length||1,r),!this.svf.loadDone||this.options.onDemandLoading||this._selectiveLoadingController.isActive||console.error("Geometry received after load was done"),this.viewer3DImpl._signalMeshAvailable();for(var s=0;s<o.length;s++)this.pendingRequests--,this.tryToActivateFragment(o[s],"geom");delete this.svf.geomMetadata.hashToIndex[e.hash],delete this.pendingMeshes[e.hash],this.pendingMeshesCount--}}}else console.warn("Received geometry after loader was done. Possibly leaked event listener?",e.hash)},ye.prototype.onGeomLoadDone=function(){if(this.options.onDemandLoading||this._selectiveLoadingController.isActive||this.removeMeshReceiveListener(),this.svf.loadDone=!0,s.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.options.skipMeshLoad)return this.currentLoadPath=null,void this.viewer3DImpl.onLoadComplete(this.model);this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null,this.options.onDemandLoading||this._selectiveLoadingController.isActive||(this.svf.geomMetadata.hashes=null);var e=Date.now(),t="Fragments load time: "+(e-this.t1);this.loadTime=e-this.t0;var i=this.firstPixelTimestamp-this.t0;t+=" (first pixel time: "+i+")",o.logger.log(t),this.options.useConsolidation&&this.viewer3DImpl.consolidateModel(this.model,this.options.consolidationMemoryLimit);var r={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.svf.metadata.stats.num_geoms,fragments_count:this.svf.metadata.stats.num_fragments,urn:this.svfUrn};i>0&&(r.first_pixel_time=i),o.logger.track(r,!0);const n=this.model.getGeometryList(),a={load_time:this.loadTime,polygons:n.geomPolyCount,fragments:this.model.getFragmentList().getCount(),mem_usage:n.gpuMeshMemory,time_to_first_pixel:this.firstPixelTimestamp-this.t0,viewable_type:"3d"};ve.analytics.track("viewer.model.loaded",a),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},ye.prototype.loadPropertyDb=function(){this.svf.propDbLoader.load()},ye.prototype.is3d=function(){return!0},ye.loadOnlyOtgRoot=function(e,t){const i=be(e),r=_e(t,i,xe(t)),n=new X;n.basePath=i;const o=(0,d.pathToURL)(e);return new Promise(((e,t)=>{r.onFailureCallback=()=>e(null),n.loadAsyncResource(r,o,"json",(function(t){n.metadata=t,n.manifest=t.manifest,n.numGeoms=n.metadata.stats.num_geoms,n.processMetadata(r),e(n)}))}))},ye.prototype.waitForFragmentData=async function(){if(this.fragmentDataLoaded)return!0;const e=this.viewer3DImpl.api,t=this;return await new Promise((function(i){const r=()=>{e.removeEventListener(ge.MODEL_ROOT_LOADED_EVENT,n),e.removeEventListener(ge.MODEL_UNLOADED_EVENT,o)},n=e=>{e.model.loader===t&&(r(),i(!0))},o=e=>{e.model.loader===t&&(r(),i(!1))};e.addEventListener(ge.MODEL_ROOT_LOADED_EVENT,n),e.addEventListener(ge.MODEL_UNLOADED_EVENT,o)}))},ye.prototype.trackOnDemandLoadProgress=function(){this.svf.loadDone&&!1===this.fragLoadingInProgress&&0===this.pendingRequests&&this.viewer3DImpl.api.dispatchEvent({type:ge.FRAGMENTS_LOADED_EVENT,loader:this,model:this.model})},ye.prototype.evaluate=function(e){if(!this.model||this.options.skipMeshLoad)return;if(void 0!==e)return void this.tryToActivateFragment(e,"fragment");const t=this.model.getFragmentList().fragments.length;for(let e=0;e<t;++e)this.tryToActivateFragment(e,"fragment")},ye.prototype.loadFragments=function(e){if(!this.svf.loadDone)return o.logger.warn("Trying to call loadFragments while model is not fully loaded yet."),0;if(te.MemoryTracker.memoryLimitReached())return 0;this.svf.nextRepaintPolys=0,this.svf.numRepaints=0;let t=0;const i=this.model.getFragmentList();this.fragLoadingInProgress=!0;for(const r of e)i.isFlagSet(r,ve.MeshFlags.MESH_NOTLOADED)&&(i.setFlagFragment(r,ve.MeshFlags.MESH_NOTLOADED,!1),i.setFragOff(r,!1),i.setVisibility(r,!0),this.tryToActivateFragment(r,"fragment"),++t);return this.fragLoadingInProgress=!1,t&&this.trackOnDemandLoadProgress(),t},Y.FileLoaderManager.registerFileLoader("json",["json"],ye)},88505:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MATERIAL_FAILED_EVENT:()=>L,MATERIAL_RECEIVE_EVENT:()=>D,MESH_FAILED_EVENT:()=>P,MESH_RECEIVE_EVENT:()=>C,OtgResourceCache:()=>H,PENDING_REQUESTS_FINISHED_EVENT:()=>I});var r=i(7247),n=i(86945),o=i(66799),s=i(97790),a=i(68482),l=i(27156),h=i(96164),c=i(60812),u=i(86437),d=i(37765);function p(e,t,i){return Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<i&&Math.abs(e.z-t.z)<i}function f(e,t){return t.importance-e.importance}var m=new c.LmvBox3;function g(e,t,i){var r=function(e,t,i){var r=6*t;return i.min.y=e[r+1],i.min.z=e[r+2],i.min.x=e[r+0],i.max.x=e[r+3],i.max.y=e[r+4],i.max.z=e[r+5],i}(t,e,m),n=i.intersectsBox(r);if(n===u.OUTSIDE)return 0;var o=n===u.CONTAINS,s=i.projectedBoxArea(r,o),a=d.SceneMath.pointToBoxDistance2(i.eye,r);return s/(a=Math.max(a,.01))}class v{constructor(){this.viewers=[],this.waitingTasks=[],this.waitingTasksHead=0,this.urgentHashes={},this.prevNumTasks=0,this.fullSortDone=!1,this.lastCamPos={},this.lastCamTarget={},this.lastVisibleModelIds={}}addViewer(e){this.viewers.push(e),this.lastCamPos[e.id]=new h.LmvVector3,this.lastCamTarget[e.id]=new h.LmvVector3,this.lastVisibleModelIds[e.id]=[]}removeViewer(e){const t=this.viewers.indexOf(e);-1!==t&&(delete this.lastCamPos[e.id],delete this.lastCamTarget[e.id],delete this.lastVisibleModelIds[e.id],this.viewers.splice(t,1))}checkCameraChanged(){for(var e=!1,t=0;t<this.viewers.length;t++){var i=this.viewers[t],r=i.impl.camera,n=r.position,o=r.target;p(this.lastCamPos[i.id],n,.01)&&p(this.lastCamTarget[i.id],o,.01)||(this.lastCamPos[i.id].copy(n),this.lastCamTarget[i.id].copy(o),e=!0)}return e}checkModelsChanged(){for(var e=!1,t=0;t<this.viewers.length;t++){var i=this.viewers[t],r=i.impl.modelQueue().getModels();r.length!==this.lastVisibleModelIds[i.id].length&&(this.lastVisibleModelIds[i.id].length=r.length,e=!0);for(var n=0;n<r.length;n++){var o=this.lastVisibleModelIds[i.id][n],s=r[n].id;o!==s&&(this.lastVisibleModelIds[i.id][n]=s,e=!0)}}return e}validateRequestPriorities(){var e=this.checkCameraChanged(),t=this.checkModelsChanged();if(e||t)for(var i=this.waitingTasksHead;i<this.waitingTasks.length;i++)this.waitingTasks[i].importanceNeedsUpdate=!0}updateRequestPriorities(){var e=performance.now();this.validateRequestPriorities();var t={},i=[];for(let e=0;e<this.viewers.length;e++){let o=this.viewers[e];var r=o.impl.modelQueue(),n=r.frustum();i=i.concat(r.getModels()),n.reset(o.impl.camera),t[o.id]=n}var o=!1,s=0===this.prevNumTasks||this.waitingTasks.length-this.prevNumTasks>3e3||!this.fullSortDone;this.fullSortDone=!s,this.prevNumTasks=this.waitingTasks.length;for(let r=this.waitingTasksHead;r<this.waitingTasks.length;r++){var a=this.waitingTasks[r];if(a.importanceNeedsUpdate)if(this.urgentHashes[a.hash])a.importance=1/0;else{if(r%10==0)if(performance.now()-e>10){o=!0;break}a.importanceNeedsUpdate=!1,a.importance=0;var l=0,h=a.hash;for(const e of i)if(e.isOTG()){var c=e.myData,u=c.fragments,d=u.boxes,p=c.geomMetadata.hashToIndex[h];if(p&&u.mesh2frag){var f=u.mesh2frag[p];for(const i of this.viewers)if(-1!==i.impl.modelQueue().getModels().indexOf(e))if("number"==typeof f)l+=g(f,d,t[i.id]);else if(Array.isArray(f))for(const e of f)l+=g(e,d,t[i.id])}}if(a.importance=l,!s){for(var m=r;m>this.waitingTasksHead&&l>this.waitingTasks[m-1].importance;)this.waitingTasks[m]=this.waitingTasks[m-1],m--;this.waitingTasks[m]=a}}}return s&&!o&&(this._sortTasks(),this.fullSortDone=!0),!o}makeUrgent(e){var t=0;for(var i in e)!0===e[i]&&(this.urgentHashes[i]=!0,t++);if(0===t)return 0;for(var r=this.waitingTasksHead;r<this.waitingTasks.length;r++){var n=this.waitingTasks[r];this.urgentHashes[n.hash]&&(n.importance=1/0)}return this._sortTasks(),t}_removeGarbage(){this.waitingTasks.splice(0,this.waitingTasksHead),this.waitingTasksHead=0}_sortTasks(){this._removeGarbage(),this.waitingTasks.sort(f)}removeUrgent(e){delete this.urgentHashes[e]}filterTasks(e){const t=[];for(let i=this.waitingTasksHead;i<this.waitingTasks.length;i++){const r=this.waitingTasks[i];e(r.hash)&&t.push(r)}this.waitingTasks=t,this.waitingTasksHead=0}addTask(e){this.waitingTasks.push(e)}takeTask(){return this.waitingTasksHead>1e4&&this._removeGarbage(),this.waitingTasks[this.waitingTasksHead++]}isEmpty(){return this.waitCount()<=0}waitCount(){return this.waitingTasks.length-this.waitingTasksHead}}const y="otg",b="otg-content",x="otg-lru";class _{constructor(e){this.db=null,this.readTransaction=null,this.loaded=!1,this.opening=!1,this.dbDisabled=this._isDbDisabled(e),!(0,r.isNodeJS)()&&this.dbDisabled&&console.log("IndexedDb disabled"),this.storeName=b,this.storeNameTimestamp=x,this.bothStoreNames=[this.storeName,this.storeNameTimestamp],this.pendingTimestampUpdates={},this.pendingTimestampCount=0,this.pendingStores=[],this._pendingCallbacks=[]}_isDbDisabled(e){return e||(0,r.isNodeJS)()||(0,r.isSafari)()||(0,r.isMobileDevice)()||"undefined"==typeof indexedDB}notifyPendingCallbacks(e){this._pendingCallbacks.forEach((t=>t(e,this.db))),this._pendingCallbacks=[]}open(e){if(this.dbDisabled)return void(e&&e());if(this.loaded)return void(e&&e(null,this.db));if(e&&this._pendingCallbacks.push(e),this.opening)return;this.opening=!0;let t=indexedDB.open(y,1);t.onerror=e=>{console.error("Failed to open or create cache database."),this.dbDisabled=!0,this.notifyPendingCallbacks(e)},t.onsuccess=e=>{this.opening=!1,this.db=e.target.result,this.db.onerror=function(e){console.error("Database error",e)},this.loaded=!0,this.notifyPendingCallbacks()},t.onupgradeneeded=e=>{console.log("Db upgrade",this.storeName);let t=e.target.result;t.createObjectStore(b),t.createObjectStore(x).createIndex(x+"-index","t",{unique:!1})}}deleteOld(e){if(!this.db)return void e();if(this.deleteInProgress)return;this.deleteInProgress=!0;let t=IDBKeyRange.upperBound(Date.now()-3e5,!0),i=[];this.db.transaction([this.storeNameTimestamp]).objectStore(this.storeNameTimestamp).index(this.storeNameTimestamp+"-index").openCursor(t).onsuccess=t=>{let r=t.target.result;if(r&&i.length<200)return i.push(r.primaryKey),void r.continue();if(i.length){console.log("Deleting old objects.",i.length);let t=this.db.transaction(this.bothStoreNames,"readwrite");t.oncomplete=t=>{this.deleteInProgress=!1,console.log("Delete done"),e&&e()},t.onerror=e=>{this.deleteInProgress=!1,console.error("Transaction error.",e)},t.onabort=e=>{this.deleteInProgress=!1;let t=e.target.error;console.log("Failed to delete cached objects",t)};let r=t.objectStore(this.storeName),n=t.objectStore(this.storeNameTimestamp);for(let e=0;e<i.length;e++)r.delete(i[e]),n.delete(i[e])}}}flush(e){if(this.pendingStores.length){if(!this.writeTransaction){let t=this.db.transaction(this.bothStoreNames,"readwrite");e&&(t.oncomplete=t=>{e()}),t.onerror=t=>{console.error("Transaction error.",t),e&&e(t.target.error)},t.onabort=t=>{"QuotaExceededError"===t.target.error.name&&this.deleteOld((()=>{})),e&&e(t.target.error)},this.writeTransaction=t}for(var t=0;t<this.pendingStores.length;t+=2){var i=this.pendingStores[t],r=this.pendingStores[t+1];this.writeTransaction.objectStore(this.storeName).put(r,i).onerror=e=>{console.error("Object store error.",e)},this.writeTransaction.objectStore(this.storeNameTimestamp).put({t:Date.now()},i)}this.pendingStores=[],this.writeTransaction=null}else e&&e()}store(e,t,i){this.db?(t=t.slice(),this.pendingStores.push(e),this.pendingStores.push(t),this.pendingStores.length<200||this.deleteInProgress?i&&i():this.flush(i)):i&&i()}flushTimestamps(e){let t=this.db.transaction([this.storeNameTimestamp],"readwrite");e&&(t.oncomplete=t=>{e()}),t.onerror=t=>{console.error("Transaction error.",t),e&&e(t.target.error)},t.onabort=t=>{"QuotaExceededError"===t.target.error.name&&(console.log("Quota exceeded"),this.deleteOld((()=>{}))),e&&e(t.target.error)};let i=t.objectStore(this.storeNameTimestamp);for(let e in this.pendingTimestampUpdates)i.put({t:this.pendingTimestampUpdates[e]},e);this.pendingTimestampUpdates={},this.pendingTimestampCount=0}_createReadTransaction(){let e=this.readTransaction=this.db.transaction(this.storeName);e.oncomplete=e=>{this.readTransaction=null},e.onerror=e=>{console.error("Transaction error.",e),this.readTransaction=null},e.onabort=e=>{console.warn("Transaction abort",e),this.readTransaction=null}}get(e,t){if(this.opening)return console.error("Tried to get IndexedDb resource while database was still opening"),void t(-1,null);if(!this.db)return void t(-1,null);let i;this.readTransaction||this._createReadTransaction();try{i=this.readTransaction.objectStore(this.storeName).get(e)}catch(t){this._createReadTransaction(),i=this.readTransaction.objectStore(this.storeName).get(e)}i.onsuccess=i=>{if(!i.target.result)return void t(-1,null);let r=i.target.result;t(null,r),this.pendingTimestampUpdates[e]=Date.now(),this.pendingTimestampCount++},i.onerror=e=>{t(e.target.errorCode)}}flushStoresAndTimestamps(){this.db&&this.flush((e=>{e||this.flushTimestamps()}))}size(e){if(!this.db)return void e();let t=0,i=0,r=this.db.transaction([this.storeName]).objectStore(this.storeName).openCursor();r.onsuccess=r=>{let n=r.target.result;if(n){let e=n.value;t+=e.length,i++,n.continue()}else e(null,{size:t,items:i})},r.onerror=function(t){e(t)}}estimateCachedHashCount(e){if(this.opening)return console.error("Tried to get IndexedDb resource while database was still opening"),void e(void 0);if(!this.db)return void e(void 0);let t,i=this.db.transaction(this.storeNameTimestamp);try{t=i.objectStore(this.storeNameTimestamp).openKeyCursor()}catch(t){return void e(void 0)}let r=2;const n=1e3;t.onsuccess=t=>{const o=t.target.result;if(o)if(--r>0)o.advance(999);else{const t=o.key.charCodeAt(0);e(65536e3/t),i.abort()}else e(2==r?0:1==r?n:void 0)},t.onerror=t=>{e(void 0)}}readAllCachedHashes(e){if(this.opening)return console.error("Tried to get IndexedDb resource while database was still opening"),void e([]);if(!this.db)return void e([]);let t,i=this.db.transaction(this.storeNameTimestamp);try{t=i.objectStore(this.storeNameTimestamp).getAllKeys()}catch(t){return void e([])}t.onsuccess=t=>{e(t.target.result)},t.onerror=t=>{e([])}}}var E=i(1098);const A=0,S=1;class w{static FALLBACK_FLIGHT=3e3;static MIN_FLIGHT=1500;static MAX_FLIGHT=3e4;#d;CWND_DEVIATION=30;BETA=.8;FAST_CONVERGENCE=.7;wMax=0;lastReductionTs=performance.now();SCALING=.25;cwnd=0;initialAssetEstimate;#p=0;#f=1e3;#m=new M(1e3);#g=new M(20);wasReset=!1;#v={count:0,totalBytes:0};constructor(e,t,i,r){this.onFlightSizeUpdated=r,this.#p=e,this.#v.totalBytes=i,this.#v.count=e,this.initialAssetEstimate=t,this.wMax=this.#v.totalBytes,this.cwnd=this.wMax*this.BETA,this.#y(),this.#b()}hasCongestionEvent(){if(this.#m.count<3)return!1;const e=this.#m.tail.data,t=this.#m.head.data;if(this.cwnd<e.receivedBytes)return!1;if(e.receivedBytes/(t.receivedBytes||1)<1)return!0;const i=this.deviation(this.cwnd,t.cwnd),r=this.deviation(e.receivedBytes,t.receivedBytes);return Math.abs(i-r)>this.CWND_DEVIATION}shouldTimeout(){if(this.#g.count<this.#g.MAX_SIZE/2)return!1;let e=this.#g.tail||this.#g.head,t=0;for(;e&&t++<this.#g.MAX_SIZE/2;){if(e.data.receivedCount>0)return!1;e=e.prev}return t>=this.#g.MAX_SIZE/2}getMode(){return this.cwnd>this.wMax?S:A}#b(){if(this.shouldTimeout())return this.onFlightSizeUpdated(w.FALLBACK_FLIGHT),clearInterval(this.#d),void this.#x();const e=this.#y();let t=0,i=0,r=0;for(let{data:e}of this.#g){if(3==t++)break;i+=e.receivedBytes,r+=e.receivedCount}const n=i/r||e.fragmentSize;let o;const s=e=>e/1e6,a=Math.cbrt(s(this.wMax)*(1-this.BETA)/this.SCALING),l=(performance.now()-this.lastReductionTs)/1e3;if(o=this.cwnd=1e6*(this.SCALING*Math.pow(l-a,3)+s(this.wMax)),this.hasCongestionEvent()){const e=this.getMode()===S?this.BETA:this.FAST_CONVERGENCE;this.lastReductionTs=performance.now(),this.wMax=this.#m.tail.prev.data.receivedBytes,this.#m.clear(),o=e*this.wMax}let h=Math.round(o/n);this.#p=h=Math.min(w.MAX_FLIGHT,Math.max(w.MIN_FLIGHT,h)),this.onFlightSizeUpdated(h)}#x(){let e=0,t=0;for(let{data:i}of this.#g)t++<this.#g.MAX_SIZE/2||(e+=i.cwnd);const i=e/this.#g.count;this.wMax=i*(1-this.BETA+1),this.cwnd=i,this.#m.clear(),this.#g.clear(),this.wasReset=!0}#y(){var e;const t={fragmentSize:this.#v.count&&this.#v.totalBytes?this.#v.totalBytes/this.#v.count:(null===(e=this.#m.tail||this.#m.head)||void 0===e?void 0:e.data.fragmentSize)||this.initialAssetEstimate,receivedCount:this.#v.count,receivedBytes:this.#v.totalBytes,cwnd:this.cwnd};return this.#m.onReceived(t),this.#g.onReceived(t),this.#v.count=0,this.#v.totalBytes=0,t}onResourceReceived(e,t){this.#v.totalBytes+=t,this.#v.count+=e,this.wasReset&&(this.wasReset=!1,this.lastReductionTs=performance.now(),this.#d=setInterval((()=>{this.#b()}),this.#f))}deviation(e,t){return Math.abs(e-t)/((e+t)/2)*100}static createAndStart(e,t,i,r){const n=new w(e,t,i,r||(()=>{}));return n.#d=setInterval((()=>{n.#b()}),n.#f),n}}class M{MAX_SIZE=2e3;#_=0;totalBytes=0;head;tail;get count(){return this.#_}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>this.count>this.MAX_SIZE;this.MAX_SIZE=e,this.trimEval=t}clear(){this.#_=0,this.totalBytes=0,this.head=null,this.tail=null}onReceived(e,t){this.addNode(new T(e),t)}addNode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(0===this.#_?this.head=e:1===this.#_?(this.tail=e,this.head.setNext(e)):(this.tail.setNext(e),this.tail=e),this.#_+=t;this.trimEval(this.head,this.tail);){var i;const e=this.head.next;this.head.unlink(),this.totalBytes-=this.head.size,this.#_-=(null===(i=this.head.data)||void 0===i?void 0:i.count)||1,this.head=e}this.totalBytes+=e.size}}M.prototype[Symbol.iterator]=function*(){let e=this.tail;for(;e;)yield e,e=e.prev};class T{data;size=0;prev;next;timestamp;constructor(e){this.data=e,e.size&&(this.size=e.size),this.timestamp=Date.now()}setNext(e){return this.next=e,e&&(this.next.prev=this),this}setPrev(e){return this.prev=e,e&&(this.prev.next=this),this}unlink(){var e,t;null===(e=this.prev)||void 0===e||e.setNext(this.next),null===(t=this.next)||void 0===t||t.setPrev(this.prev),this.prev=null,this.next=null}}var C="meshReceived",P="meshFailed",D="materialReceived",L="materialFailed",I="requestsInProgressFinished";let R=Autodesk.Viewing.Private,O="true"===(0,l.getParameterByName)("useOPFS")||(0,r.getGlobal)().USE_OPFS;const N="true"===(0,l.getParameterByName)("useAdaptiveStreaming")||(0,r.getGlobal)().USE_ADAPTIVE_STREAMING,F="true"===(0,l.getParameterByName)("disableIndexedDb").toLowerCase()||(0,r.getGlobal)().DISABLE_INDEXED_DB,k="true"===(0,l.getParameterByName)("disableWebSocket").toLowerCase()||(0,r.getGlobal)().DISABLE_WEBSOCKET;let V=F||O||!(0,r.isChrome)();const U={dummy_value:"error"},B={dummy_value:"error"};function G(e){var t=(0,s.initLoadContext)(e);return t.disableIndexedDb=F,t.disableWebSocket=k,t}function z(e,t){return e.importance-t.importance}function H(e){var t,i=new Map,s=new Map,a={},l="OPFS"===(null==e||null===(t=e.cache)||void 0===t?void 0:t.type);(O||l)&&(O=!0,V=!0);var h=(0,o.createWorker)();h.addEventListener("message",(function(e){if(e.data.error){T.isEmpty()||M||(M=setTimeout(Y,0));var t=e.data.error,r=t.args.hash;return"m"===t.args.resourceType?(x--,s.set(r,B),k.fireEvent({type:L,hash:r}),console.error("Error loading material.",t.msg,t.args)):(A--,i.set(r,U),k.fireEvent({type:P,hash:r}),console.error("Error loading mesh.",t.msg,t.args)),delete a[t.hash],void k.requestsReceived++}e.data.event&&e.data.properties?R.analytics.track(e.data.event,e.data.properties):console.error("Unknown message from worker",e.data)}));for(var c=(0,r.isMobileDevice)()?2:4,u=[],d=[],p=0;p<c;p++){u.push((0,o.createWorker)()),u[p].addEventListener("message",X);const e=new MessageChannel;u[p].doOperation({operation:"INSTALL_INPUT_PORT",port:e.port2},[e.port2]),d.push(e.port1)}const f=G({operation:"INIT_WORKER_OTG",ports:d,useOpfs:O,clearIndexedDbIfItsLarge:l});let g,y,b=d.slice();h.doOperation(f,b),this.initialized=!0,this.bandwidthOptimizer=()=>{if(g||y||(y=Date.now()),g||this.requestsReceived<2*S)return g;const e=this.byteSize/this.requestsReceived*.9,t=this.byteSize/((Date.now()-y)/1e3);return N&&(g=w.createAndStart(A+x,e,t,(e=>{S=e}))),g},this.byteSize=0,this.refCount=0,this.cachedHashesDb=void 0,this.cachedHashes=null,this.cachedHashesPending=!1,this.cachedHashesEstimate=void 0,this.cachedHashesEstimatePending=!1,this.fromCacheCount=0,this.fromRemoteCount=0,this.requestsSent=0,this.requestsReceived=0;var x=0,A=0;var S=N?w.MIN_FLIGHT:w.FALLBACK_FLIGHT,M=void 0,T=new v,k=this,H=1048576;this._maxMemory=100*H,this._minCleanup=50*H;var W=new Map,j=[];function q(e,t){return!e.cachedHashes||e.cachedHashes.has(t)}function X(e){var t,i,r;if(!e.data)return;T.isEmpty()||M||(M=setTimeout(Y,0));let o=0;if(e.data.materials)for(let t=0;t<e.data.materials.length;t++){const i=e.data.hashes[t],r=e.data.materials[t];x--,k.requestsReceived++,s.set(i,r),k.fireEvent({type:D,material:r,hash:i}),o+=r.byteLength,delete a[i]}else{const t=e.data;for(var l=0;l<t.length;l++){A--,k.requestsReceived++;var h=t[l];if(h.hash&&h.mesh){var c=n.BufferGeometryUtils.meshToGeometry(h);let e=E.MemoryTracker.getGeometrySize(c);E.MemoryTracker.memoryHardLimitReached(e)||(k.addGeometry(h.hash,c),k.cleanup(),k.fireEvent({type:C,geom:c})),delete a[h.hash],h.fromCache?++k.fromCacheCount:++k.fromRemoteCount,o+=c.byteSize}}E.MemoryTracker.memoryLimitReached()&&0===A&&k.fireEvent({type:I})}null===(t=k.bandwidthOptimizer())||void 0===t||t.onResourceReceived((null===(i=e.data)||void 0===i||null===(i=i.materials)||void 0===i?void 0:i.length)||(null===(r=e.data)||void 0===r?void 0:r.length),o),k._handleCache()}function Y(){var e=S-(A+x);if(e<=.01*S)M=setTimeout(Y,30);else{T.updateRequestPriorities();for(var t=0,i=null;!T.isEmpty()&&t<e;){var r=T.takeTask();i?(i.urls.push(r.url),i.hashes.push(r.hash),i.lineageUrns.push(r.lineageUrn),i.couldBeInCache.push(q(k,r.hash))):i={operation:"LOAD_CDN_RESOURCE_OTG",type:"g",urls:[r.url],lineageUrns:[r.lineageUrn],hashes:[r.hash],isCDN:r.isCDN,queryParams:r.queryParams,couldBeInCache:[q(k,r.hash)]},t++}i&&(h.doOperation(G(i)),A+=i.urls.length,k.requestsSent+=i.urls.length),M=void 0}}this._numActiveLoaders=0,this.addViewer=function(e){j.push(e),T.addViewer(e)},this.removeViewer=function(e){const t=j.indexOf(e);-1!==t&&(T.removeViewer(e),j.splice(t,1)),0===j.length&&this.dtor()},this.dtor=function(){j=[],h.terminate(),h=null;for(const e of u)e.terminate();u=[],i=null,s=null,this._clearHashCache(),this.initialized=!1},this._loadHashCache=function(){this.cachedHashesPending||(this.cachedHashesPending=!0,this.cachedHashesDb.open((()=>{this.cachedHashesDb.readAllCachedHashes((e=>{this.cachedHashes=new Set(e),this.cachedHashesPending=!1})),this.cachedHashesDb=void 0})))},this._clearHashCache=function(){this.cachedHashes=null},this._getHashCacheEstimate=function(){this.cachedHashesEstimatePending||(this.cachedHashesDb=new _(F,!1),this.cachedHashesDb.open(null),this.cachedHashesEstimatePending=!0,this.cachedHashesDb.open((()=>{this.cachedHashesDb.estimateCachedHashCount((e=>{this.cachedHashesEstimate=e,this.cachedHashesEstimatePending=void 0===e}))})))},this._handleCache=function(){if(this.cachedHashes||V)return;const e=this.fromCacheCount+this.fromRemoteCount;if(e<200)return;const t=T.waitCount()*this.fromRemoteCount/e;null!=this.cachedHashesEstimate?this.cachedHashesEstimate<50*t&&this._loadHashCache():t>1e3&&this._getHashCacheEstimate()},this.loaderAdded=function(e,t){this._numActiveLoaders++;var i={operation:"ADD_MODEL_OTG",modelUrn:e,lineageUrn:t,useOpfs:O};h.doOperation(G(i)),this.fromCacheCount=0,this.fromRemoteCount=0},this.loaderRemoved=function(){if(this._numActiveLoaders--,0===this._numActiveLoaders){this._clearHashCache();h.doOperation({operation:"FLUSH_CACHE_AND_DISCONNECT_OTG"})}},this.requestGeometry=function(e,t,n,o,s,l){var h=i.get(n);if(h!==U)if(h)(0,r.isNodeJS)()?setImmediate((()=>this.fireEvent({type:C,geom:h}))):this.fireEvent({type:C,geom:h});else{var c=a[n];if(c&&c.refcount)return c.importanceNeedsUpdate=!0,void c.refcount++;var u={operation:"LOAD_CDN_RESOURCE_OTG",type:"g",url:e,lineageUrn:l,isCDN:t,hash:n,queryParams:s,importance:0,geomIdx:o,importanceNeedsUpdate:!0,refcount:1};T.addTask(u),a[n]=u,M||(M=setTimeout(Y,0))}else(0,r.isNodeJS)()?setImmediate((()=>this.fireEvent({type:P,hash:n}))):this.fireEvent({type:P,hash:n})},this.requestMaterial=function(e,t,i,r,n,o){var l=s.get(i);if(l!==B)if(l)setImmediate((()=>this.fireEvent({type:D,material:l,hash:i})));else{var c=a[i];if(c&&c.refcount)c.refcount++;else{var u={operation:"LOAD_CDN_RESOURCE_OTG",type:"m",urls:[e],lineageUrns:[o],hashes:[i],isCDN:t,queryParams:n,refcount:1,couldBeInCache:[q(this,i)]};a[i]=u,h.doOperation(G(u)),x++,this.requestsSent++}}else setImmediate((()=>this.fireEvent({type:L,error:l,hash:i,repeated:!0})))},this.cancelRequests=function(e){for(var t in e){var i=a[t];i&&i.refcount--}T.filterTasks((e=>{const t=a[e],i=t&&t.refcount;return i||delete a[e],i}))},this.updateGeomImportance=function(e,t){return function(e,t){var i=e.getFragmentList(),r=i.getGeometry(t);if(i.getWorldBounds(t,m),r){var n,o,s,a,l=r.importance||0,h=2*((o=(n=m).max.x-n.min.x)*(s=n.max.y-n.min.y)+s*(a=n.max.z-n.min.z)+a*o);r.importance=Math.max(l,h)}}(e,t)},this.cleanup=function(e){if(!(0===W.size||!e&&this.byteSize<this._maxMemory)){var t=[];for(let e of W.values())t.push(e);t.sort(z);for(var r=e?0:this._maxMemory-this._minCleanup,n=0;n<t.length&&this.byteSize>=r;n++){var o=t[n];i.delete(o.hash),W.delete(o.id),this.byteSize-=o.byteSize,o.dispose()}}},this.waitForGeometry=function(e,t){var r=0,n=T.makeUrgent(e);if(0===n&&e)t(e);else{Y(),this.addEventListener(C,a),this.addEventListener(P,l);for(let t in e){var o=i.get(t);o&&s(t,o)}}function s(i,o){T.removeUrgent(i),!0!=!e[i]&&(e[i]=o,++r<n||(k.removeEventListener(C,a),k.removeEventListener(P,l),t(e)))}function a(e){s(e.geom.hash,e.geom)}function l(e){s(e.hash,void 0)}},this.getGeometry=function(e){return i.get(e)},this.addGeometry=function(e,t){if(i.set(e,t),k.byteSize+=t.byteSize,Object.prototype.hasOwnProperty.call(t,"_modelRefCount"))return;t._modelRefCount=0;const r=Object.getPrototypeOf(t);Object.prototype.hasOwnProperty.call(r,"modelRefCount")||Object.defineProperty(r,"modelRefCount",{get(){return this._modelRefCount},set(e){if(0===this._modelRefCount&&e>1){W.get(this.id)&&W.delete(this.id)}else 0===e&&W.set(this.id,this);this._modelRefCount=e}})},this.addMaterialData=function(e,t){s.set(e,t)},this.clearOpfsCache=function(){h.doOperation({operation:"CLEAR_OPFS_CACHE"})},this.reportLoadingState=function(){console.log("OtgResourceCache:",{sent:this.requestsSent,received:this.requestsReceived});h.doOperation({operation:"REPORT_LOADING_STATE"})}}a.EventDispatcher.prototype.apply(H.prototype)},10028:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PropDbLoader:()=>M,clearPropertyWorkerCache:()=>_,getPropWorker:()=>b,shutdownPropWorker:()=>x});var r,n=i(60489),o=i(68110),s=i(22599),a=i(18878),l=i(97790),h=i(59957),c=i(40929),u=i(66799),d=i(68482),p="GET_PROPERTIES",f="UNLOAD_PROPERTYDB",m=1,g={};function v(e){var t=e.data;if(t&&t.debug)n.logger.debug(t.message);else{var i=t&&t.cbId&&g[t.cbId];i&&(t.progress?i[2]&&i[2](t.progress):(t.error?i[1]&&i[1](t.error):i[0]&&i[0](t.result),delete g[t.cbId]))}}function y(e,t,i){var r=m++;return g[r]=[e,t,i],r}function b(){return r}function x(){r&&(r.terminate(),r=void 0)}function _(){r&&r.doOperation({operation:f,clearCaches:!0})}var E=0,A=1,S=2,w=3,M=function(e,t,i){var r,s;this.eventTarget=i||new d.EventDispatcher,this.model=t,this.svf=t&&t.getData(),this.dbPath="",this.sharedDbPath=!1;const a=this.svf&&this.svf.loadOptions.bubbleNode&&this.svf.loadOptions.bubbleNode.findViewableParent()._getOtgManifest(),l=a&&this.svf&&this.svf.is2d;if(this.svf&&!l&&this.svf.propertydb&&this.svf.propertydb.avs.length){for(var h in this.dbFiles=this.svf.propertydb,this.dbFiles)this.dbFiles[h][0]&&(this.dbFiles[h][0].path=this.dbFiles[h][0].path.replace(/\\/g,"/"));var c=(0,o.pathToURL)(this.svf.basePath);if(e){var u=o.ViewingService.simplifyPath(c+this.svf.propertydb.avs[0].path);if((u=u.slice(0,u.lastIndexOf("/")+1))===e){var p={};for(let t in this.dbFiles){var f=this.dbFiles[t][0],m=f.path;0===(m=o.ViewingService.simplifyPath(c+m)).indexOf(e)&&(m=m.slice(e.length)),p[t]=[{path:m,isShared:f.isShared}]}this.dbFiles=p,this.dbPath=e,this.sharedDbPath=!0}else this.dbPath=c,this.sharedDbPath=!1}else this.dbPath=c,this.sharedDbPath=!1}else{if(this.sharedDbPath=!0,this.svf&&this.svf.loadOptions.bubbleNode){this.dbPath=e;let t=this.svf.loadOptions.bubbleNode.getPropertyDbManifest();this.dbFiles=t.propertydb,this.needsDbIdRemap=t.needsDbIdRemap}else n.logger.warn("Deprecated shared property database initialization without bubbleNode in Model load options."),this.dbPath=e,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]};n.logger.log("Using shared db path "+e)}a&&(this.needsDbIdRemap=this.svf.loadOptions.needsDbIdRemap||this.needsDbIdRemap),this.queryParams="";let g=null===(r=this.model)||void 0===r||null===(r=r.getDocumentNode())||void 0===r||null===(r=r.getDocument())||void 0===r?void 0:r.getAcmSessionId(this.dbPath);g=g||(null===(s=this.svf)||void 0===s?void 0:s.acmSessionId),this.svf&&g&&(this.queryParams="acmsession="+g),this.loadProgress=0,this.cbId=void 0,this.idLoadState=E,this.waitingForExternalIds=[]};M.prototype.dtor=function(){this.asyncPropertyOperation({operation:f},(function(){}),(function(){}));var e,t=Boolean(this.cbId),i=this.instanceTree||this.propertyDbError;t&&!i&&(e=this.cbId,delete g[e],this.propertyDbError={propDbWasUnloaded:!0},this.eventTarget.dispatchEvent({type:a.OBJECT_TREE_UNAVAILABLE_EVENT,svf:this.svf,model:this.model,target:this})),this.model=null,this.svf=null},M.prototype.processLoadResult=function(e){if(e.instanceTreeStorage){var t=new c.InstanceTreeAccess(e.instanceTreeStorage,e.rootId,e.instanceBoxes);this.instanceTree=new h.InstanceTree(t,e.objectCount,e.maxTreeDepth),this.svf&&((i=this).svf.instanceTree=i.instanceTree,this.instanceTree.setFragmentList(this.model.getFragmentList()))}var i;e.objectCount&&(this.hasObjectProperties=e.objectCount,this.svf&&(this.svf.hasObjectProperties=e.objectCount)),e.dbidOldToNew&&this.model.setDbIdRemap(e.dbidOldToNew),this.onLoadProgress(100),this.eventTarget.dispatchEvent({type:a.OBJECT_TREE_CREATED_EVENT,svf:this.svf,model:this.model,target:this})},M.prototype.processLoadError=function(e){var t=this;t.propertyDbError=e,t.onLoadProgress(100),t.eventTarget.dispatchEvent({type:a.OBJECT_TREE_UNAVAILABLE_EVENT,svf:t.svf,model:t.model,target:t})},M.prototype.load=function(e){var t=this;e=M.prototype.useCustomProperties?Object.assign({useCustomProperties:!0},e):e||{},r||(r=(0,u.createWorker)(!0)).addEventListener("message",v);this.cbId=y((function(e){t.processLoadResult(e)}),(function(e){t.processLoadError(e)}),(function(e){t.onLoadProgress(e.percent)}));var i=this.svf&&this.svf.loadOptions,n=!(i&&i.disablePrecomputedNodeBoxes),o=!(!i||!i.skipExternalIds);let s;o||(this.idLoadState=A),s=this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes?"CREATE_TREE":"LOAD_PROPERTYDB";var a={operation:s,dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:n&&this.svf&&this.svf.fragments.boxes,needsDbIdRemap:this.needsDbIdRemap,is2d:this.svf&&this.svf.is2d,cbId:this.cbId,queryParams:this.queryParams,skipExternalIds:o,gltfTree:this.svf.instanceTree,dbToFragId:this.svf&&this.svf.fragments.dbToFragId,...e};r.doOperation((0,l.initLoadContext)(a))},M.prototype.asyncPropertyOperation=function(e,t,i,n){const o=this;if(e.dbPath=this.dbPath,o.instanceTree||o.hasObjectProperties)e.cbId=y(t,i,n),r.doOperation(e);else if(o.propertyDbError)i&&i(o.propertyDbError);else{const r=function(l){o.model===l.model&&(o.eventTarget.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,r),o.eventTarget.removeEventListener(a.OBJECT_TREE_UNAVAILABLE_EVENT,r),o.instanceTree||o.hasObjectProperties||o.propertyDbError?o.asyncPropertyOperation(e,t,i,n):i&&i({code:s.ErrorCodes.UNKNOWN_FAILURE,msg:"Failed to load properties"}))};o.eventTarget.addEventListener(a.OBJECT_TREE_CREATED_EVENT,r),o.eventTarget.addEventListener(a.OBJECT_TREE_UNAVAILABLE_EVENT,r)}},M.prototype.getProperties=function(e,t,i){this.idLoadState===E&&n.logger.warn("Calling getProperties() will cause loading of the potentially large externalIDs file. Use getProperties2() to avoid this warning."),this.getProperties2(e,t,i,{needsExternalId:!0})},M.prototype.getProperties2=function(e,t,i,r){const n=()=>{this.asyncPropertyOperation({operation:p,dbId:e,gltfTree:this.svf&&this.svf.instanceTreeBackup},t,i)};r&&r.needsExternalId?this.loadExternalIds().then(n).catch(i):n()},M.prototype.getBulkProperties=function(e,t,i,r,o){const s={ignoreHidden:o,propFilter:t,needsExternalId:!t||t.includes("externalId")};s.needsExternalId&&this.idLoadState===E&&n.logger.warn("Calling getProperties() will cause loading of the potentially large externalIDs file. Use getProperties2() to avoid this warning."),this.getBulkProperties2(e,s,i,r)},M.prototype.getBulkProperties2=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const n=()=>{this.asyncPropertyOperation({operation:p,dbIds:e,propFilter:t.propFilter,categoryFilter:t.categoryFilter,ignoreHidden:t.ignoreHidden},i,r)};t&&t.needsExternalId?this.loadExternalIds().then(n).catch(r):n()},M.prototype.getPropertySet=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const n=()=>{this.asyncPropertyOperation({operation:"GET_PROPERTY_SET",dbIds:e,propFilter:t.propFilter,ignoreHidden:t.ignoreHidden,fileType:t.fileType},i,r)};t&&t.needsExternalId?this.loadExternalIds().then(n).catch(r):n()},M.prototype.searchProperties=function(e,t,i,r,n){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:e,attributeNames:t,searchOptions:n},i,r)},M.prototype.findProperty=function(e){var t=this;return new Promise((function(i,r){t.asyncPropertyOperation({operation:"FIND_PROPERTY",propertyName:e},i,r)}))},M.prototype.diffProperties=function(e,t,i,r,n){this.asyncPropertyOperation({operation:"DIFF_PROPERTIES",dbPath2:e,diffOptions:r},t,i,n)},M.prototype.findLayers=function(){var e=this;return new Promise((function(t,i){e.asyncPropertyOperation({operation:"FIND_LAYERS"},t,i)}))},M.prototype.getExternalIdMapping=function(e,t,i){return this.loadExternalIds().then((()=>{this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING",extIdFilter:i},e,t)}))},M.prototype.getLayerToNodeIdMapping=function(e,t){this.asyncPropertyOperation({operation:"BUILD_LAYER_TO_NODE_ID_MAPPING"},e,t)},M.prototype.executeUserFunction=function(e,t){if("function"==typeof e)e=e.toString();else if("string"!=typeof e)return Promise.reject("Expected Function or string.");let i;try{i=new Blob([e],{type:"application/javascript"})}catch(t){let r=new BlobBuilder;r.append(e),i=r.getBlob()}let r=URL.createObjectURL(i);return new Promise(((e,i)=>{this.asyncPropertyOperation({operation:"USER_FUNCTION",userFunction:r,userData:t},e,i)}))},M.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},M.prototype.getObjectTree=function(e,t){var i=this;if(i.instanceTree)e(i.instanceTree);else if(i.propertyDbError)t&&t(i.propertyDbError);else if("hasObjectProperties"in i)i.svf&&i.svf.is2d&&t?t("F2D files do not have an InstanceTree."):e(null);else{var r=function(){i.eventTarget.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,r),i.eventTarget.removeEventListener(a.OBJECT_TREE_UNAVAILABLE_EVENT,r),i.getObjectTree(e,t)};i.eventTarget.addEventListener(a.OBJECT_TREE_CREATED_EVENT,r),i.eventTarget.addEventListener(a.OBJECT_TREE_UNAVAILABLE_EVENT,r)}},M.prototype.onLoadProgress=function(e){this.eventTarget.dispatchEvent({type:a.OBJECT_TREE_LOAD_PROGRESS_EVENT,percent:e,svf:this.svf,model:this.model,target:this}),this.loadProgress=e},M.prototype.getLoadProgress=function(){return this.loadProgress},M.prototype.isLoadDone=function(){return 100==this.loadProgress},M.prototype.loadExternalIds=function(){switch(this.idLoadState){case A:return Promise.resolve();case w:return Promise.reject();case E:{this.idLoadState=S;const e=()=>{this.idLoadState=A,this.waitingForExternalIds.forEach((e=>e.resolve()))},t=()=>{this.idLoadState=w,this.waitingForExternalIds.forEach((e=>e.reject()))},i={operation:"LOAD_EXTERNAL_IDS",idsFile:this.dbFiles.ids[0],queryParams:this.queryParams};(0,l.initLoadContext)(i),this.asyncPropertyOperation(i,e,t);break}}return new Promise(((e,t)=>{this.waitingForExternalIds.push({resolve:e,reject:t})}))},M.refreshCustomProperties=function(e){return new Promise(((t,i)=>{e.operation="REFRESH_CUSTOM_PROPERTIES",e.cbId=y(t,i),r.doOperation(e)}))},M.prototype.refreshCustomPropertiesValues=function(e){return new Promise(((t,i)=>{e.operation="REFRESH_CUSTOM_PROPERTIES_VALUES",e.dbPath=this.dbPath;e.cbId=y((n=>{if(this.instanceTree||"hasObjectProperties"in this)t(n);else{const n=this.eventTarget,o=()=>{n.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,o),n.removeEventListener(a.OBJECT_TREE_UNAVAILABLE_EVENT,o),e.cbId=y(t,i),r.doOperation(e)};n.addEventListener(a.OBJECT_TREE_CREATED_EVENT,o),n.addEventListener(a.OBJECT_TREE_UNAVAILABLE_EVENT,o)}}),i),r.doOperation(e)}))},M.prototype.useCustomProperties=!1},20933:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SvfLoader:()=>w});var r=i(7247),n=i(60489),o=i(194),s=i(22599),a=i(50982),l=i(33736),h=i(12529),c=i(11466),u=i(68110),d=i(86945),p=i(10028),f=i(33664),m=i(66799),g=i(18878),v=i(45894),y=i(75050),b=i(6972),x=i(97790),_=i(77876);const E=Autodesk.Viewing,A=E.Private;var S=(0,r.isNodeJS)()?10:(0,r.isMobileDevice)()?2:6,w=function(e){this.viewer3DImpl=e,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.tmpMatrix=new y.Matrix4,this.tmpBox=new y.Box3,this.fetchingTopology=!1,this.loadTime=0,this.notifiesFirstPixel=!0};w.prototype.dtor=function(){if(this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,n.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.terminate(),this.svfWorker=null,n.logger.debug("SVF loader dtor: on svf worker.")),this.pack_workers){for(var e=0;e<this.pack_workers.length;e++)this.pack_workers[e].terminate();this.pack_workers=null,n.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.tmpMatrix=null,this.tmpBox=null,this.svf=null,this.model=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadTime=0,this.viewer3DImpl=null},w.prototype.initWorkerScript=m.initWorkerScript,w.prototype.createWorker=m.createWorker,w.prototype.startWorkers=function(){for(var e=this.svf,t=Math.min(e.geompacks.length,E.NUM_WORKER_THREADS||S),i=0;i<t;i++){var n=e.geompacks[this.next_pack++];n.loading=!0,(0,r.isNodeJS)()?this.loadGeometryPack(n.id,n.uri):(e=>{setTimeout((()=>{this.loadGeometryPack(e.id,e.uri)}),200*i)})(n)}},w.prototype.createModel=function(e){var t=this.model=new v.Model(e);return t.loader=this,t.initialize(),t},w.prototype.isValid=function(){return this.viewer3DImpl},w.prototype.loadFile=function(e,t,i,r){if(!this.viewer3DImpl)return n.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return n.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0;var o=e.indexOf("urn:");if(-1!=o){var s=(e=decodeURIComponent(e)).substr(o,e.substr(o).indexOf("/"));n.logger.log("Extracted URN: "+s);var a=s.lastIndexOf(":");this.svfUrn=s.substr(a+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e;var l=this.currentLoadPath.lastIndexOf("/");-1!=l&&(this.basePath=this.currentLoadPath.substr(0,l+1)),this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t;var h=this;return this.initWorkerScriptToken=this.initWorkerScript((function(){h.loadSvfCB(e,t,i,r)})),!0},w.prototype.loadSvfCB=function(e,t,i,o){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var l=!0,h=this,c={url:(0,u.pathToURL)(e),basePath:this.currentLoadPath,objectIds:t.ids,globalOffset:t.globalOffset,fragmentTransformsDouble:t.fragmentTransformsDouble,placementTransform:t.placementTransform,applyRefPoint:t.applyRefPoint,queryParams:this.queryParams,bvhOptions:t.bvhOptions||{isWeakDevice:(0,r.isMobileDevice)()},applyScaling:t.applyScaling,applyPlacementInModelUnits:t.applyPlacementInModelUnits,loadInstanceTree:t.loadInstanceTree};this.viewer3DImpl._signalNoMeshes();var d=this.svfWorker=this.createWorker();return d.addEventListener("message",(async function(e){var t=function(){d.terminate(),h.svfWorker=null,d=null};if(l&&o&&(l=!1,o()),e.data&&e.data.manifest)h.interceptManifest(e.data.manifest),c.operation="LOAD_SVF_CONTD",c.manifest=e.data.manifest,d.doOperation(c);else if(e.data&&e.data.svf){var r=h.svf=e.data.svf;h.failedToLoadSomeGeometryPacks&&(i&&i(h.failedToLoadSomeGeometryPacks),h.failedToLoadSomeGeometryPacks=null),await h.onModelRootLoadDone(r),i&&i(null,h.model),h.svf.viewpointTreeRoot&&h.options.addViews&&h.options.addViews(h.svf.viewpointTreeRoot,h.model),h.viewer3DImpl.api.dispatchEvent({type:g.MODEL_ROOT_LOADED_EVENT,svf:r,model:h.model}),r.loadDone=!1;var u=!1;r.metadata&&r.metadata.gltf&&(u=!0),u||(0==r.geompacks.length?h.onGeomLoadDone():h.startWorkers()),1==e.data.progress&&(h.loading=!1,t()),r.fragments.polygonCounts||(r.fragments.polygonCounts=new Int32Array(r.fragments.length)),e.data.bvh&&(r.bvh=e.data.bvh,h.model.setBVH(new a.NodeArray(r.bvh.nodes,r.bvh.useLeanNodes),r.bvh.primitives,h.options.bvhOptions),h.viewer3DImpl.api.dispatchEvent({type:g.LOADER_REPAINT_REQUEST_EVENT,loader:h,model:h.model}))}else e.data&&e.data.bvh?(h.svf&&!h.svf.bvh&&(h.svf.bvh=e.data.bvh,h.model.setBVH(new a.NodeArray(h.svf.bvh.nodes,h.svf.bvh.useLeanNodes),h.svf.bvh.primitives,h.options.bvhOptions),h.viewer3DImpl.api.dispatchEvent({type:g.LOADER_REPAINT_REQUEST_EVENT,loader:h,model:h.model})),h.loading=!1,t()):e.data&&e.data.mesh?(h.processReceivedMesh(e.data),1===e.data.progress&&(h.onGeomLoadDone(),h.loading=!1,t())):e.data&&e.data.progress?1==e.data.progress&&(h.loading=!1,t()):e.data&&e.data.error?(h.loading=!1,t(),n.logger.error("Error while processing SVF: "+JSON.stringify(e.data.error.args)),i&&i(e.data.error,null)):e.data&&e.data.debug?n.logger.debug(e.data.message):(n.logger.error("SVF download failed.",(0,s.errorCodeString)(s.ErrorCodes.NETWORK_FAILURE)),h.loading=!1,t())})),c.operation="LOAD_SVF",c.interceptManifest=!!this.interceptManifest,d.doOperation((0,x.initLoadContext)(c)),!0},w.prototype.loadGeometryPack=function(e,t){var i,r,o,s,a=this;if(this.svf&&this.isValid()){var l=this.pack_workers;if(l||(l=this.pack_workers=[]),l.length<(E.NUM_WORKER_THREADS||S)){var h=!0;for(o=0;o<l.length;o++)if(0===l[o].queued){h=!1;break}if(h){var c=this.createWorker();c.addEventListener("message",(function(e){if(e.data&&e.data.meshes){for(var t=e.data.meshes,i=0;i<t.length;i++){var r=t[i];if(r){var o={packId:e.data.packId,meshIndex:i,mesh:r};a.processReceivedMesh(o)}}if(e.data.progress>=1){a.pack_workers[e.data.workerId].queued-=1,a.loadedPacksCount++,a.viewer3DImpl.signalProgress(100*a.loadedPacksCount/a.svf.geompacks.length,_.ProgressState.LOADING,a.model);var l=!0;for(s=0;s<a.pack_workers.length;s++)if(0!=a.pack_workers[s].queued){l=!1;break}if(l){for(s=0;s<a.pack_workers.length;s++)a.pack_workers[s].terminate();a.pack_workers=null}a.loadedPacksCount+a.failedToLoadPacksCount==a.svf.geompacks.length&&a.onGeomLoadDone()}}else if(e.data&&e.data.progress){if(a.pack_workers[e.data.workerId].queued-=1,a.next_pack<a.svf.geompacks.length){var h=null;if(!h||h.loading)for(;a.next_pack<a.svf.geompacks.length&&(h=a.svf.geompacks[a.next_pack++]).loading;);h&&!h.loading?(h.loading=!0,a.loadGeometryPack(h.id,h.uri)):(a.viewer3DImpl.modelQueue().enforceBvh=!1,a.svf.fragments.packIds=null)}}else e.data&&e.data.debug?n.logger.debug(e.data.message):e.data&&e.data.error?(++a.failedToLoadPacksCount,a.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}):a.pack_workers[e.data.workerId].queued-=2})),c.queued=0,l.push(c)}}var d=0,p=l[0].queued;for(o=1;o<l.length;o++)l[o].queued<p&&(d=o,p=l[o].queued);(i=l[d]).queued+=2,r=d;var f={operation:"LOAD_GEOMETRY",url:(0,u.pathToURL)(this.svf.basePath+t),packId:parseInt(e),workerId:r,createWireframe:this.options.createWireframe||this.model.getMetadata("renderEnvironmentDisplayEdges","value",!1),packNormals:this.options.packNormals,queryParams:this.queryParams};i.doOperation((0,x.initLoadContext)(f))}},w.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,i=this.svf,r=i.fragments,o=this.model,s=r.mesh2frag[t];if(void 0===s)return void n.logger.warn("Mesh "+t+" was not referenced by any fragments.");Array.isArray(s)||(s=[s]);const a=o.getFragmentList().getGeometryId(s[0]),c=(0,d.meshToGeometry)(e);void 0!==e.packId&&(c.packId=e.packId),void 0!==e.meshIndex&&(c.meshIndex=e.meshIndex);const u=o.getGeometryList().addGeometry(c,s.length,a),p=(0,h.getPolygonCount)(c);for(var m=0;m<s.length;m++){var v=0|s[m];if(i.loadOptions.skipHiddenFragments)if(!(r.visibilityFlags[v]&l.MeshFlags.MESH_VISIBLE))continue;o.getFragmentList().getOriginalWorldMatrix(v,this.tmpMatrix);var y=r.materials[v].toString(),b=this.viewer3DImpl.matman().findMaterial(o,y);b&&!b.texturesLoaded&&f.TextureLoader.loadMaterialTextures(o,b,this.viewer3DImpl),r.polygonCounts&&(r.polygonCounts[v]=p);var x=this.viewer3DImpl.setupMesh(this.model,c,y,this.tmpMatrix);o.activateFragment(v,x,!!i.placementTransform)}return this.options.onMeshReceived&&this.options.onMeshReceived(this.model,u,s),r.mesh2frag[t]=null,r.numLoaded+=s.length,this.viewer3DImpl._signalMeshAvailable(),o.getGeometryList().geomPolyCount>i.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),i.numRepaints++,i.nextRepaintPolys+=1e4*Math.pow(1.5,i.numRepaints),this.viewer3DImpl.api.dispatchEvent({type:g.LOADER_REPAINT_REQUEST_EVENT,loader:this,model:this.model})),u},w.prototype.setupCamera=function(e){return e.position=(new y.Vector3).copy(e.position),e.target=(new y.Vector3).copy(e.target),e.up=(new y.Vector3).copy(e.up),isFinite(e.position.x+e.position.y+e.position.z+e.target.x+e.target.y+e.target.z+e.up.x+e.up.y+e.up.z)||(e.target=this.svf.bbox.getCenter(new y.Vector3),e.position.copy(e.target),e.position.z+=this.svf.bbox.max.z-this.svf.bbox.min.z,e.up.set(0,1,0)),isFinite(e.aspect)||(e.aspect=1),isFinite(e.fov)||(e.fov=90),isFinite(e.orthoScale)||(e.orthoScale=1),e},w.prototype.onModelRootLoadDone=async function(e){e.fragments.numLoaded=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options,e.verylargebbox&&this.viewer3DImpl.setNearRadius(this.options.nearRadius||1);var t=Date.now();n.logger.log("SVF load: "+(t-this.t0));var i=this.createModel(e);this.options.skipPropertyDb||this.loadPropertyDb();var s=await this.convertMaterials(i);if(this.viewer3DImpl.matman().hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0),this.t1=t,e.bbox=(new y.Box3).copy(e.bbox),e.refPointTransform&&(e.refPointTransform=new o.LmvMatrix4(!0).copy(e.refPointTransform)),e.placementTransform&&(e.placementTransform=new o.LmvMatrix4(!0).copy(e.placementTransform)),e.placementWithOffset&&(e.placementWithOffset=new o.LmvMatrix4(!0).copy(e.placementWithOffset)),e.cameras)for(var a=0;a<e.cameras.length;a++)this.setupCamera(e.cameras[a]);n.logger.log("scene bounds: "+JSON.stringify(e.bbox));var l={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topologyPath,has_animations:!!e.animations,cameras:e.cameras?e.cameras.length:0,lights:e.lights?e.lights.length:0,materials:s,is_mobile:(0,r.isMobileDevice)()};n.logger.track(l),this.viewer3DImpl.signalProgress(5,_.ProgressState.ROOT_LOADED,this.model)},w.prototype.convertMaterials=async function(e){var t,i=this.viewer3DImpl.matman(),r=e.getData(),n=0;if(!r.materials)return n;if(r.gltfMaterials){var o=r.materials.materials;for(t in o){var s=o[t],a=c.MaterialConverter.convertMaterialGltf(s,r),l=i._getMaterialHash(e,t);i.addMaterial(l,a,!1),n++}return n}var h=r.materials.materials,u=r.proteinMaterials?r.proteinMaterials.materials:null;for(t in h){var d=u&&u[t]&&c.MaterialConverter.isPrismMaterial(u[t])?u[t]:h[t];await i.convertOneMaterial(e,d,i._getMaterialHash(e,t)),n++}return n},w.prototype.makeBVH=function(e){var t=performance.now(),i=e.materials?e.materials.materials:null;e.bvh=new a.BVHBuilder(e.fragments,i),e.bvh.build(this.options.bvhOptions||{isWeakDevice:(0,r.isMobileDevice)()});var o=performance.now();n.logger.log("BVH build time: "+(o-t))},w.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,f.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null,this.svf.fragments.visibilityFlags=null;var e=Date.now(),t="Fragments load time: "+(e-this.t1);this.loadTime=e-this.t0;var i=this.firstPixelTimestamp-this.t0;t+=" (first pixel time: "+i+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions)),n.logger.log(t),this.options.useConsolidation&&this.viewer3DImpl.consolidateModel(this.model,this.options.consolidationMemoryLimit);var r={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().getCount(),fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};i>0&&(r.first_pixel_time=i),n.logger.track(r,!0);const o=this.model.getGeometryList(),s={load_time:this.loadTime,polygons:o.geomPolyCount,fragments:this.model.getFragmentList().getCount(),mem_usage:o.gpuMeshMemory,viewable_type:"3d"};A.analytics.track("viewer.model.loaded",s),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},w.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new p.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},w.prototype.fetchTopologyFile=function(e,t){if(!this.fetchingTopology){this.fetchingTopology=!0;var i=this.createWorker();i.addEventListener("message",(function(e){if(e.data["status-topology"])return r=(new Date).getTime(),s=Math.round((r-l)/1e3),void n.logger.log("Topology file downloaded. ("+s+" seconds). Processing...");var a=e.data["fetch-topology"];a&&(o=(new Date).getTime(),s=Math.round((o-r)/1e3),a.topology?n.logger.log("Topology file processed successfully! ("+s+" seconds)."):n.logger.log("Topology file processed, but an error ocurred. ("+s+" seconds)."),t(a),h.fetchingTopology=!1,i.terminate(),i=null)}));var r,o,s,a={path:e,queryParams:this.queryParams},l=(new Date).getTime();n.logger.log("Fetching topology file..."),a.operation="FETCH_TOPOLOGY",i.doOperation((0,x.initLoadContext)(a));var h=this}},w.prototype.is3d=function(){return!0},b.FileLoaderManager.registerFileLoader("svf",["svf"],w)},33664:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TextureLoader:()=>T});var r=i(68110),n=i(7247),o=i(22599),s=i(11466),a=i(3016),l=i(60489),h=i(75050),c=i(97790),u=i(62688),d=function(e){this.manager=void 0!==e?e:h.DefaultLoadingManager,this._parser=d.parse};d.prototype=Object.create(h.CompressedTextureLoader.prototype),d.prototype.constructor=d,d.parse=function(e,t){var i=new Uint32Array(e,0,13),r={buffer:e,header:i,loadMipmaps:t};if(55727696===i[0])return d._parseV3(r);if(559044176===i[11])return d._parseV2(r);throw new Error("[THREE.PVRLoader] Unknown PVR format")},d._parseV3=function(e){var t,i,r=e.header,n=r[12],o=r[2],s=r[6],a=r[7],l=(r[9],r[10]),c=r[11];switch(o){case 0:t=2,i=h.RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,i=h.RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,i=h.RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,i=h.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+o)}return e.dataPtr=52+n,e.bpp=t,e.format=i,e.width=a,e.height=s,e.numSurfaces=l,e.numMipmaps=c,e.isCubemap=6===l,d._extract(e)},d._parseV2=function(e){var t,i=e.header,r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=(i[5],i[6]),c=(i[7],i[8],i[9],i[10]),u=(i[11],i[12]),p=255&a,f=c>0;if(25===p)t=f?h.RGBA_PVRTC_4BPPV1_Format:h.RGB_PVRTC_4BPPV1_Format,l=4;else{if(24!==p)throw new Error("pvrtc - unknown format "+p);t=f?h.RGBA_PVRTC_2BPPV1_Format:h.RGB_PVRTC_2BPPV1_Format,l=2}return e.dataPtr=r,e.bpp=l,e.format=t,e.width=o,e.height=n,e.numSurfaces=u,e.numMipmaps=s+1,e.isCubemap=6===u,d._extract(e)},d._extract=function(e){var t,i={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},r=e.buffer,n=e.dataPtr,o=e.bpp,s=e.numSurfaces,a=0,l=0,h=0,c=0,u=0;2===o?(l=8,h=4):(l=4,h=4),t=l*h*o/8,i.mipmaps.length=e.numMipmaps*s;for(var d=0;d<e.numMipmaps;){var p=e.width>>d,f=e.height>>d;(c=p/l)<2&&(c=2),(u=f/h)<2&&(u=2),a=c*u*t;for(var m=0;m<s;m++){var g={data:new Uint8Array(r,n,a),width:p,height:f};i.mipmaps[m*e.numMipmaps+d]=g,n+=a}d++}return i};const p=i(79916);let f=(0,n.getGlobal)(),m=f.document,g=new p;g.max=(0,n.isMobileDevice)()?4:6;let v=0,y=(0,n.isMobileDevice)()?32:1/0;y*=1048576;let b=0,x=1/0;const _=(e,t,i,r)=>{h.ImageUtils.loadTexture(e,t,i,r)};function E(e,t,i,s,a,p,y){var b=c.endpoint.getUseCredentials(),E=c.endpoint.getUseCookie();b&&E?h.ImageUtils.crossOrigin="use-credentials":c.endpoint.getUseCredentials()?h.ImageUtils.crossOrigin="anonymous":h.ImageUtils.crossOrigin="";var A="";b&&a&&(A="acmsession="+a),y&&y.queryParams&&(A=A?A+"&":"",A+=y.queryParams);const S=c.endpoint.initLoadContext({queryParams:A});e.startsWith("blob:")&&(S.queryParams=void 0),v++,g.go((function(a){var c=function(e,t){v--,t&&s?s(t):i(e),a()},g=p?c:function(e){function t(t){e&&(e.image=t),v--,i(e),a()}e&&e.image?function(e,t){let i,r,n=e.width,s=e.height;if(0==(n&n-1)&&0==(s&s-1)){if(n*s<=x)return void t(e);i=n,r=s}else{for(i=1;1.5*i<n;)i*=2;for(r=1;1.5*r<s;)r*=2}for(;i*r>x;)i=Math.max(i/2,1),r=Math.max(r/2,1);let a=m.createElement("canvas"),h=a.getContext("2d");a.width=i,a.height=r,h.drawImage(e,0,0,i,r);const c=new Image;c.src=a.toDataURL(),c.onload=function(){t(c)},c.onerror=function(e){l.logger.error(e,(0,o.errorCodeString)(o.ErrorCodes.UNKNOWN_FAILURE)),t(null)}}(e.image,t):t()},A=function(e){v--,l.logger.error("Texture load error",e),i(null),a()};if((0,n.isNodeJS)())return void function(e,t,i,n,s){var a=new h.DataTexture(void 0,i);function c(e){s&&s.extractImage&&(e=s.extractImage(e)),a.image={data:e,width:void 0,height:void 0},a.needsUpdate=!0,n&&n(a)}function u(e,t){var i="Error: "+e+" ("+t+")";l.logger.error(i,(0,o.errorCodeString)(o.ErrorCodes.NETWORK_SERVER_ERROR)),n&&n(null,{msg:t,args:e})}r.ViewingService.getItem(t,e,c,u)}(e,S,t,c,y);const w=S.queryParams?`?${S.queryParams}`:"";let M=`${e}${w}`;if(e.toLocaleLowerCase().endsWith(".dds"))(0,n.isIOSDevice)()?(M=`${e.slice(0,e.length-4)}.pvr${w}`,(new d).load(M,c,A)):(new u.DDSLoader).load(M,c,A);else if(b&&!E||y&&(y.rawData||y.extractImage))!function(e,t,i,n,s){var a=new h.Texture(void 0,i);function c(e){s&&s.extractImage&&(e=s.extractImage(e));var t,i,r=new Image;a.image=r,r.onload=function(){a.needsUpdate=!0,n&&n(a),f.URL.revokeObjectURL(r.src)},r.onerror=function(e){l.logger.error(e,(0,o.errorCodeString)(o.ErrorCodes.UNKNOWN_FAILURE)),n&&n(null)},r.src=(t=new Uint8Array(e),i=new Blob([t],{type:"image/jpeg"}),(f.URL||f.webkitURL).createObjectURL(i))}function u(e,t){var i="Error: "+e+" ("+t+")";l.logger.error(i,(0,o.errorCodeString)(o.ErrorCodes.NETWORK_SERVER_ERROR)),n&&n(null,{msg:t,args:e})}s&&s.rawData?c(s.rawData):r.ViewingService.getItem(t,e,c,u,s)}(e,S,t,g,y);else if(e.startsWith("data:"))_(e,t,g,A);else{/(\w+):\/\//gi.exec(e)&&!/^(https?|file|blob:\w+):\/\//gi.test(e)?Autodesk.Viewing.Private.ViewingService.rawGet("","",e,(function(i){let r=/\.(\w+)$/gi.exec(e);r=r?r[1]:"png";var n,o,s=`data:image/${r};base64, `+(n=i,o=Array.prototype.map.call(n,(function(e){return String.fromCharCode(e)})).join(""),btoa(o));_(s,t,g,A)}),console.error):_(M,t,g,A)}}))}function A(e,t,i){var n=t.getData();let o;return e.startsWith("embed:")?o=n.loadedBuffers[e.charAt(e.length-1)]:(e=e.replace(/\\/g,"/"),o=t.isOTG()?function(e){var t=c.endpoint.initLoadContext({});return n.makeSharedResourcePath(t.otg_cdn,"textures",e)}(e):function(e){for(var t=null,i=0;i<n.manifest.assets.length;++i){var o=n.manifest.assets[i];if(o.id.toLowerCase()==e.toLowerCase()){let e=o.URI;-1===e.indexOf("://")&&(e=n.basePath+e),t=(0,r.pathToURL)(e);break}}return t||(t=(0,r.pathToURL)(n.basePath+e)),t}(e)),E(o,h.UVMapping,i,null,n.acmSessionId)}function S(e,t,i){if(t.textureMaps&&!t.texturesLoaded){t.texturesLoaded=!0;var r=e.getData(),n=t.textureMaps;for(var o in n){var a=n[o];if(!i.matman().loadTextureFromCache(e,t,a,o))A(a.uri,e,function(n){return function(o){if(o){var a=r.materials.scene.SceneUnit,l=i.renderer()?i.renderer().getMaxAnisotropy():0;(n.converter||s.MaterialConverter.convertTexture)(n,o,a,l)}var h=i.matman();h&&(h.setTextureInCache(e,t,n,o),r.loadOptions.onTextureReceived&&r.loadOptions.onTextureReceived(h,n,o,!w()),!w()&&i&&r.loadDone&&!r.texLoadDone&&(r.texLoadDone=!0,i.onTextureLoadComplete(e)))}}(a))}}}function w(){return v}function M(e){e>=0&&(b=e,x=Math.max(16384,y/(4*b)))}const T={loadTextureWithSecurity:E,loadMaterialTextures:S,loadModelTextures:function(e,t){var i=t.matman(),r=i._getModelHash(e),n=e.isOTG(),o=0;if(n)o=e.getData().metadata.stats.num_textures||0;else for(let e in i._materials){if(-1===e.indexOf(r))continue;let t=i._materials[e];t.textureMaps&&(o+=Object.keys(t.textureMaps).length)}M(o);for(let o in i._materials){if(!n&&-1===o.indexOf(r))continue;S(e,i._materials[o],t)}var s=e.getData();!w()&&t&&s.loadDone&&!s.texLoadDone&&(s.texLoadDone=!0,t.onTextureLoadComplete(e))},loadCubeMap:function(e,t,i){var r,n=function(r){r?(r.mapping=h.CubeReflectionMapping,r.LogLuv=-1!==e.indexOf("logluv"),r.RGBM=-1!==e.indexOf("rgbm"),(0,a.DecodeEnvMap)(r,t,!1/*!isMobileDevice()*/,i)):i&&i(r)};return h.ImageUtils.crossOrigin="",Array.isArray(e)?(r=h.ImageUtils.loadTextureCube(e,h.CubeReflectionMapping,n)).format=h.RGBFormat:"string"==typeof e?-1!==e.toLowerCase().indexOf(".dds")?(r=(new u.DDSLoader).load(e,n)).mipmaps=r.mipmaps||[]:(r=_(e,h.SphericalReflectionMapping,i)).format=h.RGBFormat:e?i&&i(e):i&&i(null),r},requestsInProgress:w,calculateTextureSize:function(e){var t=4;switch(e.format){case h.AlphaFormat:t=1;break;case h.RGBFormat:t=3;break;case h.LuminanceFormat:t=1;break;case h.LuminanceAlphaFormat:t=2}switch(e.type){case h.ShortType:case h.UnsignedShortType:case h.HalfFloatType:t*=2;break;case h.IntType:case h.UnsignedIntType:case h.FloatType:t*=4;break;case h.UnsignedShort4444Type:case h.UnsignedShort5551Type:case h.UnsignedShort565Type:t=2}var i=t*e.image.width;return i+=e.unpackAlignment-1,i-=i%e.unpackAlignment,e.image.height*i},imageToCanvas:function(e,t,i){let r=e.width,n=e.height,o=m.createElement("canvas"),s=o.getContext("2d");return s.globalCompositeOperation="copy",o.width=r,o.height=n,t&&(s.fillStyle=i||"#FFFFFF",s.fillRect(0,0,r,n)),s.drawImage(e,0,0,r,n),o}}},66799:(e,t,i)=>{const{isNodeJS:r,getGlobal:n}=i(7247);var o,s,a,l,h,c,u=i(27156).getResourceUrl;r()?(c=i(15523).MainWorker,e.exports={createWorker:function(){return new c},initWorkerScript:function(e,t){e&&e()}}):(o=Autodesk.Viewing.Private,s=o.LMV_WORKER_URL||"src/file-loaders/workers/MainWorker-web.js",a=null,l=!1,h=[],e.exports={createWorker:function(e){let t;return t=o.ENABLE_INLINE_WORKER?new Worker(a):new Worker(u(s)),t.doOperation=t.postMessage,!0===e&&o.ViewingService.forwardProtocolHandlerToWorker(t),t},initWorkerScript:function(e,t){if(o.ENABLE_INLINE_WORKER&&!a){if(h.push({successCB:e}),!l){let e=new XMLHttpRequest;var i=s,r=u(s);r&&(i=r),e.open("GET",i,!0),e.withCredentials=!1,e.onload=function(){let t,i=n();l=!1,i.URL=i.URL||i.webkitURL;try{t=new Blob([e.responseText],{type:"application/javascript"})}catch(i){let r=new BlobBuilder;r.append(e.responseText),t=r.getBlob()}a=URL.createObjectURL(t);let r=h.concat();h=[];for(let e=0;e<r.length;++e)r[e].successCB&&r[e].successCB()},l=!0,e.send()}let t={cancel:function(){let t=-1;return!!h.some((function(i,r){return i.successCB==e&&(t=r,!0)}))&&(h.splice(t,1),!0)}};return t}return e&&e(),null},clearWorkerDataURL:function(){a=null}})},97047:(e,t,i)=>{"use strict";i.r(t),i.d(t,{loadWasmWorker:()=>o});const{getResourceUrl:r}=i(27156),{getGlobal:n}=i(7247);function o(e){const t={},i=r("wasm.worker.js");return new Promise(((t,s)=>{(function(e){const t=Autodesk.Viewing.Private;return new Promise((function(i){if(t.ENABLE_INLINE_WORKER){let t=new XMLHttpRequest;t.open("GET",e,!0),t.withCredentials=!1,t.onload=function(){let e,r=n();r.URL=r.URL||r.webkitURL;try{e=new Blob([t.responseText],{type:"application/javascript"})}catch(i){let r=new BlobBuilder;r.append(t.responseText),e=r.getBlob()}i(URL.createObjectURL(e))},t.send()}else i(e)}))})(i).then((function(i){const n=new Worker(i),a={},l=r(e);n.postMessage({eventType:"INITIALIZE",eventData:l}),n.addEventListener("message",(function(e){if("INITIALIZED"===e.data.eventType){e.data.eventData.forEach((e=>{a[e]=function(){return o(e,n,(t=>{t.postMessage({eventData:{method:e,arguments:Array.from(arguments)}})}))}}));const i="getBuffer";return a[i]=function(){return o(i,n,(e=>{e.postMessage({eventType:"GET_BUFFER"})}))},void t(a)}})),n.addEventListener("error",(function(e){s(e)}))}))}));function o(e,i,r){return new Promise(((n,o)=>{const s=function(e,i){let r,n;t&&Object.prototype.hasOwnProperty.call(t,e)?(r=t[e][0],n=r.inUse):(t[e]=[],n=!0);n&&(r={channel:new MessageChannel,inUse:!1},t[e].push(r),i.postMessage({eventType:"SET_CHANNEL_PORT",eventData:{method:e,port:r.channel.port2}},[r.channel.port2]));return r}(e,i),a=s.channel;s.inUse=!0,r(a.port1),a.port1.onmessage=function(i){s.inUse=!1;const r=i.data.eventType,a=i.data.eventData;"ERROR"===r?o(a):n(a),function(e,t){for(let i=1;i<t.length;i++){if(t[i].channel===e.channel)return t.splice(i,1),!0}}(s,t[e])}}))}}},22599:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ErrorCodes:()=>r,errorCodeString:()=>n,getErrorCode:()=>o});const r={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14,WEBGL_LOST_CONTEXT:15,LOAD_CANCELED:16};function n(e){return"ErrorCode:"+e+"."}function o(e){return 403===e||401===e?r.NETWORK_ACCESS_DENIED:404===e?r.NETWORK_FILE_NOT_FOUND:e>=500?r.NETWORK_SERVER_ERROR:r.NETWORK_UNHANDLED_RESPONSE_CODE}},68110:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ViewingService:()=>z,pathToURL:()=>j,textToArrayBuffer:()=>q});i(26699),i(92087),i(3462),i(83475),i(46273),i(51568),i(26349),i(10072),i(99137),i(71957),i(96306),i(103),i(8582),i(90618),i(74592),i(88440),i(58276),i(35082),i(12813),i(18222),i(24838),i(38563),i(50336),i(7512),i(46603),i(70100),i(10490),i(13187),i(60092),i(19041),i(30666),i(51638),i(62975),i(15728),i(46056),i(44299),i(5162),i(50292),i(1025),i(77479),i(34582),i(47896),i(12647),i(98558),i(84018),i(97507),i(61605),i(49076),i(34999),i(88921),i(96248),i(13599),i(11477),i(64362),i(15389),i(46006),i(90401),i(45164),i(91238),i(54837),i(87485),i(56767),i(69916),i(76651),i(61437),i(35285),i(39865),i(86035),i(67501),i(21568),i(48824),i(44130),i(78206),i(76478),i(79715),i(43561),i(32049),i(86020),i(56585),i(84633);var r=i(60489),n=i(22599),o=i(17252),s=i(97790),a=i(7247),l=i(24414),h=Uint8Array,c=Uint16Array,u=Int32Array,d=new h([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),p=new h([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),f=new h([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=function(e,t){for(var i=new c(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];var n=new u(i[30]);for(r=1;r<30;++r)for(var o=i[r];o<i[r+1];++o)n[o]=o-i[r]<<5|r;return{b:i,r:n}},g=m(d,2),v=g.b,y=g.r;v[28]=258,y[258]=28;for(var b=m(p,0),x=b.b,_=(b.r,new c(32768)),E=0;E<32768;++E){var A=(43690&E)>>1|(21845&E)<<1;A=(61680&(A=(52428&A)>>2|(13107&A)<<2))>>4|(3855&A)<<4,_[E]=((65280&A)>>8|(255&A)<<8)>>1}var S=function(e,t,i){for(var r=e.length,n=0,o=new c(t);n<r;++n)e[n]&&++o[e[n]-1];var s,a=new c(t);for(n=1;n<t;++n)a[n]=a[n-1]+o[n-1]<<1;if(i){s=new c(1<<t);var l=15-t;for(n=0;n<r;++n)if(e[n])for(var h=n<<4|e[n],u=t-e[n],d=a[e[n]-1]++<<u,p=d|(1<<u)-1;d<=p;++d)s[_[d]>>l]=h}else for(s=new c(r),n=0;n<r;++n)e[n]&&(s[n]=_[a[e[n]-1]++]>>15-e[n]);return s},w=new h(288);for(E=0;E<144;++E)w[E]=8;for(E=144;E<256;++E)w[E]=9;for(E=256;E<280;++E)w[E]=7;for(E=280;E<288;++E)w[E]=8;var M=new h(32);for(E=0;E<32;++E)M[E]=5;var T=S(w,9,1),C=S(M,5,1),P=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},D=function(e,t,i){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&i},L=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},I=function(e){return(e+7)/8|0},R=function(e,t,i){return(null==t||t<0)&&(t=0),(null==i||i>e.length)&&(i=e.length),new h(e.subarray(t,i))},O=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],N=function(e,t,i){var r=new Error(t||O[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,N),!i)throw r;return r},F=function(e,t,i,r){var n=e.length,o=r?r.length:0;if(!n||t.f&&!t.l)return i||new h(0);var s=!i,a=s||2!=t.i,l=t.i;s&&(i=new h(3*n));var c=function(e){var t=i.length;if(e>t){var r=new h(Math.max(2*t,e));r.set(i),i=r}},u=t.f||0,m=t.p||0,g=t.b||0,y=t.l,b=t.d,_=t.m,E=t.n,A=8*n;do{if(!y){u=D(e,m,1);var w=D(e,m+1,3);if(m+=3,!w){var M=e[(j=I(m)+4)-4]|e[j-3]<<8,O=j+M;if(O>n){l&&N(0);break}a&&c(g+M),i.set(e.subarray(j,O),g),t.b=g+=M,t.p=m=8*O,t.f=u;continue}if(1==w)y=T,b=C,_=9,E=5;else if(2==w){var F=D(e,m,31)+257,k=D(e,m+10,15)+4,V=F+D(e,m+5,31)+1;m+=14;for(var U=new h(V),B=new h(19),G=0;G<k;++G)B[f[G]]=D(e,m+3*G,7);m+=3*k;var z=P(B),H=(1<<z)-1,W=S(B,z,1);for(G=0;G<V;){var j,q=W[D(e,m,H)];if(m+=15&q,(j=q>>4)<16)U[G++]=j;else{var X=0,Y=0;for(16==j?(Y=3+D(e,m,3),m+=2,X=U[G-1]):17==j?(Y=3+D(e,m,7),m+=3):18==j&&(Y=11+D(e,m,127),m+=7);Y--;)U[G++]=X}}var K=U.subarray(0,F),Q=U.subarray(F);_=P(K),E=P(Q),y=S(K,_,1),b=S(Q,E,1)}else N(1);if(m>A){l&&N(0);break}}a&&c(g+131072);for(var Z=(1<<_)-1,J=(1<<E)-1,$=m;;$=m){var ee=(X=y[L(e,m)&Z])>>4;if((m+=15&X)>A){l&&N(0);break}if(X||N(2),ee<256)i[g++]=ee;else{if(256==ee){$=m,y=null;break}var te=ee-254;if(ee>264){var ie=d[G=ee-257];te=D(e,m,(1<<ie)-1)+v[G],m+=ie}var re=b[L(e,m)&J],ne=re>>4;re||N(3),m+=15&re;Q=x[ne];if(ne>3){ie=p[ne];Q+=L(e,m)&(1<<ie)-1,m+=ie}if(m>A){l&&N(0);break}a&&c(g+131072);var oe=g+te;if(g<Q){var se=o-Q,ae=Math.min(Q,oe);for(se+g<0&&N(3);g<ae;++g)i[g]=r[se+g]}for(;g<oe;++g)i[g]=i[g-Q]}}t.l=y,t.p=$,t.b=g,t.f=u,y&&(u=1,t.m=_,t.d=b,t.n=E)}while(!u);return g!=i.length&&s?R(i,0,g):i.subarray(0,g)},k=new h(0),V=function(e){31==e[0]&&139==e[1]&&8==e[2]||N(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[i++]);return i+(2&t)},U=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0};function B(e,t){var i=V(e);return i+8>e.length&&N(6,"invalid gzip data"),F(e.subarray(i,-8),{i:2},t&&t.out||new h(U(e)),t&&t.dictionary)}var G="undefined"!=typeof TextDecoder&&new TextDecoder;try{G.decode(k,{stream:!0}),1}catch(e){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;let z={WORKER_REGISTER_FILE_PORT:"REGISTER_FILE_PORT",WORKER_READ_FILE:"READ_FILE"};var H=!1;function W(e){var t=e.split("/");if(0==t.length)return e;for(var i=[],r=0;r<t.length;++r){var n=t[r];"."!==n&&(".."===n&&i.length?i.pop():i.push(n))}return 0==i.length?"":i.join("/")}function j(e,t){if(-1!==e.indexOf("://")||0===e.indexOf("urn:"))return e;if(t)return t+e;if("undefined"==typeof window)return e;const i=(0,a.getGlobal)();var r=i.location.pathname,n=r.lastIndexOf("/");return r=r.substr(0,n+1),i.location.protocol+"//"+i.location.host+r+e}function q(e,t){for(var i=e.length-t,r=new ArrayBuffer(i),n=new Uint8Array(r,0),o=0,s=t;o<i;o++,s++)n[o]=255&e.charCodeAt(s);return n}function X(e,t){return-1===t.indexOf("file://")&&(-1!==t.indexOf("://")||(!!e||void 0))}if(z.simplifyPath=W,z.OSS_PREFIX="urn:adsk.objects:os.object:",z.generateUrl=function(e,t,i,r,n,o){if(i=i||"",(0,a.isNodeJS)()&&!X(e,i))return i;var l=(i=W(i)).indexOf("urn:"),h=i.indexOf("?");if(i=-1!=l?-1!==h?i.slice(0,l)+encodeURIComponent(i.slice(l,h))+i.slice(h):i.slice(0,l)+encodeURIComponent(i.slice(l)):encodeURI(i),n&&z.isOSSUrl(i)){var c=i.indexOf("/objects/")+9,u=i.substring(c);i=i.substring(0,c)+encodeURIComponent(u)}if(!t||0!==decodeURIComponent(i).indexOf("urn:"))return X(null,i)?i:e+i;switch("items"!==t&&(i=i.substr(6)),t){case"items":return s.endpoint.getItemApi(e,i,r);case"bubbles":return s.endpoint.getManifestApi(e,i,r);case"thumbnails":return s.endpoint.getThumbnailApi(e,i,r);case"properties":return s.endpoint.getPropertyQueryApi(e,i,r,o)}},(0,a.isNodeJS)())!function(){var e=i(74617),t=i(78322),o=i(80959),s=i(75725),a=i(8575);let l=new o.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),h=new s.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10});var c=new o.Agent({maxSockets:10});z.rawGet=function(i,u,d,p,f,m){if(m=m||{},X(i,d=z.generateUrl(i,u,d,void 0,m.escapeOssObjects))){if(m.queryParams){var g=-1===d.indexOf("?")?"?":"&";d=d+g+m.queryParams}var v=a.parse(d),y={host:v.hostname,port:v.port,method:m.method||"GET",path:v.path,headers:{},retryCount:0,agent:"https:"===v.protocol?l:h};if(y.host.endsWith(".api.autodesk.com")&&(y.path.startsWith("/derivativeservice")||y.path.startsWith("/modelderivative"))&&(y.agent=c),m.headers)for(var b in m.headers)y.headers[b]=m.headers[b];y.headers["accept-encoding"]||(y.headers["accept-encoding"]="gzip, deflate"),m.range&&(y.headers.Range="bytes="+m.range.min+"-"+m.range.max),(m.ondata||m.onprogress)&&(m.responseType="arraybuffer");var x=("https:"===v.protocol?o:s).request(y,(function(e){var i=!(e.statusCode>=200&&e.statusCode<400),o=e;!i&&function(e,t){return!!("gzip"===e.headers["content-encoding"]||t.endsWith(".json.gz")||t.endsWith("FragmentList.pack")||t.endsWith("LightList.bin")||t.endsWith("CameraList.bin")||t.endsWith("CameraDefinitions.bin")||t.endsWith("LightDefinitions.bin"))}(e,v.pathname)&&(o=e.pipe(t.createGunzip())),"json"!==m.responseType&&"text"!==m.responseType&&m.responseType||o.setEncoding("utf8");var s=[],a=Buffer.allocUnsafe(65536),l=0;o.on("data",(function(e){if(m.onprogress){if(e.length+l>a.length){var t=Buffer.allocUnsafe(0|Math.ceil(1.5*a.length));a.copy(t,0,0,l),a=t}return e.copy(a,l,0,e.length),l+=e.length,void(m.onprogress(a,l)&&x.abort())}s.push(e),m.ondata&&m.ondata(e)})),o.on("end",(function(){if(e.statusCode>=200&&e.statusCode<400){if("json"===m.responseType){var i=JSON.parse(s.join(""));return void p(i)}if("text"===m.responseType||""===m.responseType){var o=s.join("");return void p(o)}var h=m.onprogress?a:Buffer.concat(s);if(31===h[0]&&139===h[1]){r.logger.warn("An LMV resource ("+d+") was double compressed, or Content-Encoding header missing");try{h=t.gunzipSync(h),l=h.length}catch(e){f(n.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:d,exception:e.toString(),stack:e.stack})}}200===x.status&&m.range&&(h=new Uint8Array(h,m.range.min,m.range.max-m.range.min)),p(h,l)}else f&&f(e.statusCode,e.statusMessage,{url:d})}))}));x.on("error",(function(e){f&&f(e.code,e.message,{url:d})})),m.postData&&x.write(m.postData),x.end()}else!function(i,r,n,o){function s(e){if("json"===o.responseType)try{return JSON.parse(e.toString("utf8"))}catch(e){n(e)}return e}0===i.indexOf("file://")&&(i=i.substr(7)),e.readFile(i,(function(e,a){e?n(0,0,{httpStatusText:e,url:i}):31===a[0]&&139===a[1]?t.gunzip(a,null,(function(e,t){e?n(0,0,{httpStatusText:e,url:i}):(t=s(t),o.ondata&&o.ondata(t),r(t))})):(a=s(a),o.ondata&&o.ondata(a),r(a))}))}(d,p,f,m)}}();else{var Y=new(i(79916));Y.max=25;var K={},Q={},Z={};z.registerProtocolPort=function(e,t){/^(http(s)?|file):/gi.test(e)?console.warn("http(s) or file protocol were not allowed to be handled"):t?(K[e]=t,t.onmessage=function(e){var t=e.data.url;if(Q[t]){var i=Q[t];if(e.data.error)i.onFailureWrapped(n.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:t,exception:e.data.error.message,stack:e.data.error.stack});else{var r=e.data.buffer;if(Q[t]=void 0,31===r[0]&&139===r[1]&&t.match(/(.f2d|.gz)$/gi))try{r=B(r),i.options&&i.options.ondata&&i.options.ondata(r),i.onSuccessWrapped(r)}catch(e){i.onFailureWrapped(n.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:t,exception:e.toString(),stack:e.stack})}else i.onSuccessWrapped(r)}}else if(Z[t]){var o=[];e.data&&e.data.buffer&&e.data.buffer.buffer instanceof ArrayBuffer&&o.push(e.data.buffer.buffer),Z[t].postMessage(e.data,o),Z[t]=void 0}}):K[e]&&K[e]instanceof MessagePort&&(K[e].onmessage=void 0,K[e]=void 0)},z.handlerProtocol=function(e,t,i,r,n){var o=K[e];Q[t]={onSuccessWrapped:i,onFailureWrapped:r,options:n},o.postMessage({operation:z.WORKER_READ_FILE,url:t})},z.forwardProtocolHandlerToWorker=function(e){var t={},i=new MessageChannel;for(var r in i.port1.onmessage=function(e){var t=new URL(e.data.url);K[t.protocol].postMessage(e.data),Z[t]=i.port1},K)K[r]instanceof MessagePort&&(t[r]=i.port2);e.doOperation({operation:z.WORKER_REGISTER_FILE_PORT,protocolPortMap:t},[i.port2])},z.rawGet=function(e,t,i,n,o,s){Y.go((a=>{let l=function(){a();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];o&&o.apply(o,t)},h=function(){a();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n&&n.apply(n,t)};var c=/^(\w+:)\/\//gi.exec(i);if(c&&2==c.length&&K[c[1]])z.handlerProtocol(c[1],i,h,l,s);else{let n=z._rawGet;null!=s&&s.useFetch&&(n=z._rawGetFetch),n(e,t,i,h,(function(){const n=arguments.length<=0?void 0:arguments[0];let o="get"===((null==s?void 0:s.method)||(null!=s&&s.noBody?"HEAD":"GET")).toLowerCase()&&(0===n||429===n||n>=500);if((arguments.length<=2?void 0:arguments[2]).aborted&&(o=!1),o){const o=arguments.length<=3?void 0:arguments[3];let a=100,c=5,u=!1;if(429!==n&&503!==n||null==o||!o.getResponseHeader("Retry-After")?0===n&&(u=3,c=2):u=o.getResponseHeader("Retry-After"),u){const e=Number(u);a=!isNaN(e)&&1e3*e||Date.parse(u)-(new Date).getTime(),a=a>100?a:100}z._retryRequest(e,t,i,s,a,c).then((e=>{r.logger.warn(`request ${i} successful after retries.`),h(...e)})).catch((e=>{r.logger.warn(`request ${i} unsuccessful after retries.`),l(...e)}))}else l(...arguments)}),s)}}))},z._retryRequest=function(e,t,i,n,o,s){const a={delayFirstAttempt:!0,startingDelay:o,numOfAttempts:4,retry:(e,t)=>{let[i,n,{url:o}]=e;return r.logger.warn(`request ${o} failed with status ${i} ${n}. Attempt ${t}`),!0},timeMultiple:s};return(0,l.backOff)((()=>new Promise(((r,o)=>{let s=z._rawGet;null!=n&&n.useFetch&&(s=z._rawGetFetch),s(e,t,i,(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r(t)}),(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o(t)}),n)}))),a)},z.isOSSUrl=function(e){return!!e&&-1!==e.indexOf("/oss/v2/buckets")},z.getSignedS3DownloadUrl=function(e){return new Promise((t=>{const i=e.indexOf("?acmsession=");-1!==i&&(e=e.substring(0,i)),e+="/signeds3download?useCdn=true";const r=new XMLHttpRequest;r.open("GET",e),r.setRequestHeader("Authorization",s.endpoint.HTTP_REQUEST_HEADERS.Authorization),r.responseType="json",r.send();const n=()=>{t(null)};r.onload=e=>{const i=e.currentTarget.response;t(i.url)},r.onerror=n,r.ontimeout=n,r.onabort=n}))},z._rawGet=async function(e,t,i,s,a,l){l=l||{},i=z.generateUrl(e,t,i,l.apiData,l.escapeOssObjects,l.guid);let h=!1;if(z.isOSSUrl(i)){const e=await z.getSignedS3DownloadUrl(i);e?(i=e,h=!0):console.warn("Failed getting signed URL - Fallback to direct OSS resource.")}if(l.queryParams&&!h){var c=-1===i.indexOf("?")?"?":"&";i=i+c+l.queryParams}var u=new XMLHttpRequest;function d(e){a&&a(u.status,u.statusText,{url:i},u)}function p(e){if("json"===l.responseType)try{if(e instanceof Uint8Array)return(0,o.Up)(e);if("string"==typeof e)return JSON.parse(e)}catch(e){}return e}function f(e){if(u.status>=200&&u.status<400)if(u.response&&u.response instanceof ArrayBuffer){var t;if(31===(t=200===u.status&&l.range?new Uint8Array(u.response,l.range.min,l.range.max-l.range.min):new Uint8Array(u.response))[0]&&139===t[1]){H||(H=!0,r.logger.warn("An LMV resource ("+i+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{t=B(t)}catch(e){a(n.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:i,exception:e.toString(),stack:e.stack},u)}}s&&s(p(t))}else{var o=u.response;o||l.responseType&&"text"!==l.responseType||(o=u.responseText),s&&s(p(o))}else d()}try{var m=!Object.prototype.hasOwnProperty.call(l,"asynchronous")||l.asynchronous;if(u.open(l.method||(l.noBody?"HEAD":"GET"),i,m),Object.prototype.hasOwnProperty.call(l,"responseType")&&(u.responseType=l.responseType),l.range&&u.setRequestHeader("Range","bytes="+l.range.min+"-"+l.range.max),!h&&(u.withCredentials=!0,Object.prototype.hasOwnProperty.call(l,"withCredentials")&&(u.withCredentials=l.withCredentials),l.headers))for(var g in l.headers)u.setRequestHeader(g,l.headers[g]),"authorization"===g.toLocaleLowerCase()&&(u.withCredentials=!1);m&&(u.onload=f,u.onerror=d,u.ontimeout=d,u.onabort=function(e){a&&a(u.status,"request was aborted",{url:i,aborted:!0},u)},(l.ondata||l.onprogress)&&(u.overrideMimeType("text/plain; charset=x-user-defined"),l._dlProgress={streamOffset:0},u.onreadystatechange=function(){if(u.readyState>2&&200===u.status)if(l.ondata){var e=u.responseText;if(l._dlProgress.streamOffset>=e.length)return;var t=q(e,l._dlProgress.streamOffset);l._dlProgress.streamOffset=e.length,l.ondata(t)}else if(l.onprogress){l.onprogress(u.responseText)&&u.abort()}})),u.send(l.postData),m||f()}catch(e){a(u.status,u.statusText,{url:i,exception:e},u)}},z._rawGetFetch=async function(e,t,i,r,n,s){s=s||{},i=z.generateUrl(e,t,i,s.apiData,s.escapeOssObjects,s.guid);let a=!1;if(z.isOSSUrl(i)){const e=await z.getSignedS3DownloadUrl(i);e?(i=e,a=!0):console.warn("Failed getting signed URL - Fallback to direct OSS resource.")}if(s.queryParams&&!a){var l=-1===i.indexOf("?")?"?":"&";i=i+l+s.queryParams}var h,c=new Request(i),u=new AbortController;function d(e){return{getResponseHeader:t=>{var i;return null==e||null===(i=e.headers)||void 0===i?void 0:i.get(t)}}}function p(e,t,r){n&&n(e,t,{url:i},d(r))}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;var i;e.status>=200&&e.status<400?(i=e.bodyUsed?t:s.responseType&&"text"!==s.responseType?await e.arrayBuffer():await e.text(),r&&r(function(e){if("json"===s.responseType)try{if(e instanceof Uint8Array)return(0,o.Up)(e);if("string"==typeof e)return JSON.parse(e)}catch(e){}return e}(i))):p(e.status,e.responseText,e)}try{const e={method:s.method||(s.noBody?"HEAD":"GET"),body:s.postData,headers:s.headers||{},signal:u.signal};if(s.range&&(e.headers.Range="bytes="+s.range.min+"-"+s.range.max),!a&&(e.credentials="include",Object.prototype.hasOwnProperty.call(s,"withCredentials")&&!1===s.withCredentials&&(e.credentials="omit"),s.headers))for(var m in s.headers)"authorization"===m.toLocaleLowerCase()&&(e.credentials="omit");if((h=await fetch(c,e)).ok)if(s.ondata||s.onprogress){const e=h.body.getReader();let t,r;if(s.onprogress){const e=h.headers.get("content-length");t=e?new Uint8Array(e):new Uint8Array(10240)}let o=0;const a=l=>{let{done:c,value:p}=l;if(c)return s.onprogress&&o<t.length&&(t=new Uint8Array(t.buffer,0,o)),void f(h,t);if(s.ondata)s.ondata(p);else{if(t.length<p.length+o){const e=Math.max(2*t.length,p.length+o);var m=new Uint8Array(e);m.set(t),t=m}t.set(p,o),o+=p.length,r=new Uint8Array(t.buffer,0,o);if(s.onprogress(r))return e.cancel(),u.abort(),void function(){n&&n(0,"request was aborted",{url:i,aborted:!0},d(arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0))}(h)}e.read().then(a)};e.read().then(a)}else f(h);else p(h.status,h.statusText,h)}catch(e){h?n(h.status,h.statusText,{url:i,exception:e},d(h)):n(0,"network error",{url:i,exception:e})}}}function J(e,t){Object.prototype.hasOwnProperty.call(t,"responseType")||(t.responseType="arraybuffer"),Object.prototype.hasOwnProperty.call(t,"withCredentials")||(t.withCredentials=!!e.auth),t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint,t.escapeOssObjects=e.escapeOssObjects}z.defaultFailureCallback=function(e,t,i){403==e?this.raiseError(n.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:i.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(n.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:i.url,httpStatus:e,httpStatusText:t}):0===e&&i.aborted?this.raiseError(n.ErrorCodes.LOAD_CANCELED,"Request aborted",{url:i.url,httpStatus:e,httpStatusText:t}):e>=500&&e<600?this.raiseError(n.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:i.url,httpStatus:e,httpStatusText:t}):i.exception?this.raiseError(n.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:i.url,exception:i.exception.toString(),stack:i.exception.stack}):this.raiseError(n.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:i.url,httpStatus:e,httpStatusText:t,data:i})},z.getItem=function(e,t,i,r,n){if(J(e,n=n||{}),n.range&&!e.supportsRangeRequests){let e="start="+n.range.min+"&end="+n.range.max;n.queryParams?n.queryParams+="&"+e:n.queryParams=e,n.range=void 0}z.rawGet(e.endpoint,"items",t,i,r,n)},z.getManifest=function(e,t,i,r,n){n=n||{},Object.prototype.hasOwnProperty.call(n,"responseType")||(n.responseType="json"),J(e,n),z.rawGet(e.endpoint,"bubbles",t,i,r,n)},z.getProperties=function(e,t,i,r,n,o){const s={};J(e,s),s.responseType="json",s.guid=i,s.method="POST",s.postData=JSON.stringify(r),s.headers["Content-Type"]="application/json",s.headers.accept="application/json",s.headers["Access-Control-Allow-Origin"]="*",z.rawGet(e.endpoint,"properties",t,n,o,s)},z.getThumbnail=function(e,t,i,r,n){J(e,n=n||{});var o=n.queryParams||"",s=[];if(-1===o.indexOf("guid=")&&n.guid&&s.push("guid="+encodeURIComponent(n.guid)),-1===o.indexOf("role=")){var a=n.role||"rendered";s.push("role="+a)}if(-1===o.indexOf("width=")){let e=n.size||400;s.push("width="+e)}if(-1===o.indexOf("height=")){let e=n.size||400;s.push("height="+e)}-1===o.indexOf("acmsession=")&&n.acmsession&&s.push("acmsession="+n.acmsession);var l=s.join("&");n.queryParams?n.queryParams=n.queryParams+"&"+l:n.queryParams=l,z.rawGet(e.endpoint,"thumbnails",t,i,r,n)},z.getACMSession=function(e,t,i,n){const o={numOfAttempts:4,timeMultiple:5,retry:(e,t)=>(r.logger.warn(`acmsession request failed. Attempt #${t}`),!0)};(0,l.backOff)((()=>new Promise(((i,r)=>{z._getACMSession(e,t,i,r)}))),o).then((function(){return i(...arguments)})).catch((function(){return n(...arguments)}))},z._getACMSession=function(e,t,i,r){var n,o={};for(var s in t)"oauth2AccessToken"===s?n=t[s]:-1!==s.indexOf("x-ads-acm")&&(o[s]=t[s]);o.application="autodesk";var a=new XMLHttpRequest;a.open("POST",e+"/oss-ext/v2/acmsessions",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+n),a.responseType="json",a.onload=function(){if(200===a.status&&a.response){var e="string"==typeof a.response?JSON.parse(a.response):a.response;e&&e.acmsession?i(e.acmsession):r(a.status,"Can't get acm session from response.")}else r(a.status)},a.onerror=r,a.ontimeout=r,a.send(JSON.stringify(o)),delete o.application}},97790:(e,t,i)=>{"use strict";i.r(t),i.d(t,{endpoint:()=>S,getEnv:()=>g,getOfflineResourcePrefix:()=>A,initLoadContext:()=>w,isOffline:()=>b,setEnv:()=>v,setOffline:()=>x,setOfflineResourcePrefix:()=>E});var r=i(7247),n=i(27156);const o=(0,r.getGlobal)();var s={},a=null;s.ENDPOINT_API_DERIVATIVE_SERVICE_V2="derivativeV2",s.ENDPOINT_API_MODEL_DERIVATIVE_V2="modelDerivativeV2",s.ENDPOINT_API_FLUENT="fluent",s.ENDPOINT_API_D3S="D3S",s.ENDPOINT_API_DERIVATIVE_STREAMING="streamingV2";var l,h={derivativeV2:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",propertyQueryURL:"/modelderivative/v2/designdata/:urn/metadata/:guid/properties:query"},derivativeV2_EU:{baseURL:"/derivativeservice/v2/regions/eu",itemURL:"/derivativeservice/v2/regions/eu/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/eu/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn"},derivativeV2_APAC:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},derivativeV2_Fedramp:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},modelDerivativeV2:{baseURL:"/modelderivative/v2/",itemURL:"/modelderivative/v2/designdata/:urn/manifest/:derivativeurn",manifestURL:"/modelderivative/v2/designdata/:urn/manifest",thumbnailsURL:"/modelderivative/v2/designdata/:urn/thumbnail",propertyQueryURL:"/modelderivative/v2/designdata/:urn/metadata/:guid/properties:query"},fluent:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S_EU:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S_APAC:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/APAC/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},streamingV2:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},streamingV2_EU:{baseURL:"/regions/eu/modeldata",itemURL:"/regions/eu/modeldata/file/:derivativeurn",manifestURL:"/regions/eu/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn",cdnURL:"/regions/eu/cdn",cdnWS:"/regions/eu/cdnws"},streamingV2_APAC:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},streamingV2_Fedramp:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"}},c="",u=s.ENDPOINT_API_DERIVATIVE_SERVICE_V2,d=!1,p=!1,f="",m=!1;function g(){return l}function v(e){l=e,e.startsWith("MD20")&&console.warn(`env=${e} is deprecated and will be removed in a future release. Use Autodesk{env}2 instead, where env=Development, Staging, or Production`)}s.HTTP_REQUEST_HEADERS={},s.queryParams={},s.setEndpointAndApi=function(e,t){null!=e&&(c=e),t&&(u=t,t.startsWith("D3S")&&console.warn(`api=${t} is deprecated and will be removed in a future release. Use streamingV2 or streamingV2_EU (europe region) instead`))},s.getEndpointAndApi=function(){return c+h[u].baseURL},s.getApiEndpoint=function(){return c},s.getApiFlavor=function(){return u},s.getCdnUrl=function(){return a||(c?c+h[u].cdnURL:void 0)},s.getCdnWebSocketEndpoint=function(){return c+(h[u].cdnWS||"")},s.setCdnUrl=function(e){a=e},s.getCdnRedirectUrl=function(){var e=h[u].cdnRedirectURL;return e?c+e:null},s.setAcmSession=function(e){f=e},s.getAcmSession=function(){return f},s.getManifestApi=function(e,t,i){var r=e||c;return t=t||"",r=(r+=h[i=i||u].manifestURL).replace(":urn",t)},s.getItemApi=function(e,t,i){var r=i||u,n=(e||c)+h[r].itemURL;t=t||"";var o=decodeURIComponent(t);if(-1!==n.indexOf(":urn")){var a=o.split("/")[0]||"";a=(a=a.split(":"))[a.length-1]||"",n=n.replace(":urn",a)}return r===s.ENDPOINT_API_MODEL_DERIVATIVE_V2&&(t=encodeURIComponent(o)),n=n.replace(":derivativeurn",t)},s.getThumbnailApi=function(e,t,i){return((e||c)+h[i||u].thumbnailsURL).replace(":urn",t||"")},s.getPropertyQueryApi=function(e,t,i,r){let n=(e||c)+h[i||u].propertyQueryURL;return n=n.replace(":urn",t||""),n.replace(":guid",r||"")},s.getUseCredentials=function(){return d},s.getDomainParam=function(){return console.warn("getDomainParam is deprecated, switch to getQueryParams instead."),this.getUseCredentials()&&!(0,r.isNodeJS)()?"domain="+encodeURIComponent(o.location.origin):""},s.addQueryParam=function(e,t){this.queryParams[e]=t},s.deleteQueryParam=function(e){delete this.queryParams[e]},s.getQueryParams=function(e){let t=this.getUseCredentials()&&!(0,r.isNodeJS)()?"domain="+encodeURIComponent(o.location.origin):"";(0,n.getParameterByName)("bypassds")&&(t=t?t+"&bypassds=1":"bypassds=1");let i=[];for(let e in this.queryParams)i.push(encodeURIComponent(e)+"="+encodeURIComponent(this.queryParams[e]));return i.length&&(t?t+="&"+i.join("&"):t=i.join("&")),t&&e&&(e.queryParams?e.queryParams+="&"+t:e.queryParams=t),t},s.setUseCredentials=function(e){d=e},s.setUseCookie=function(e){p=e},s.getUseCookie=function(){return p},s.isOtgBackend=function(){return this.getApiFlavor()===this.ENDPOINT_API_FLUENT},s.isSVF2Backend=function(){let e=this.getApiFlavor();return e.startsWith(this.ENDPOINT_API_D3S)||e.startsWith(this.ENDPOINT_API_DERIVATIVE_STREAMING)},s.setEscapeOssObjects=function(e){m=e},s.getEscapeOssObjects=function(){return m},s.initLoadContext=function(e){for(var t in(e=e||{}).auth=this.getUseCredentials(),e.endpoint||(e.endpoint=this.getApiEndpoint()),e.api||(e.api=this.getApiFlavor()),e.headers||(e.headers={}),this.HTTP_REQUEST_HEADERS)e.headers[t]=this.HTTP_REQUEST_HEADERS[t];return e.api,this.ENDPOINT_API_FLUENT,this.getQueryParams(e),e.otg_cdn=a||this.getCdnUrl(),e.otg_ws=this.getCdnWebSocketEndpoint(),e.escapeOssObjects=this.getEscapeOssObjects(),e};var y=!1;function b(){return y}function x(e){y=e}var _="";function E(e){_=e}function A(){return _}let S=s,w=s.initLoadContext.bind(s)},10209:(e,t,i)=>{"use strict";function r(e){return e[e.LMV_APP_NAMESPACE]=e[e.LMV_APP_NAMESPACE]||{}}function n(){const e="undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:i.g;return e.USE_LMV_APP_NAMESPACES?(e.globalProxy||(e.globalProxy=new Proxy({},{get(t,i){let r=e[i];return"function"==typeof r?function(e,t){return new Proxy(t,{get:(e,t)=>e[t],apply:(t,i,r)=>t.call(e||i,...r)})}(e,r):r},set:(t,i,n)=>(Object.prototype.hasOwnProperty.call(e,i)?e[i]!==n&&(e[i]=n):(r(e)[i]=n,Object.defineProperty(e,i,{get:()=>r(e)[i],set:t=>{r(e)[i]=t}})),!0)})),e.globalProxy):e}i.r(t),i.d(t,{getGlobal:()=>n})},26725:(e,t,i)=>{"use strict";i.r(t),i.d(t,{extendLocalization:()=>w,initializeLocalization:()=>T,setLanguage:()=>M});var r=i(7247);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var o=[],s=o.forEach,a=o.slice;function l(e){return s.call(a.call(arguments,1),(function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])})),e}function h(){return"function"==typeof XMLHttpRequest||"object"===("undefined"==typeof XMLHttpRequest?"undefined":n(XMLHttpRequest))}var c,u,d,p=i(83154),f=i.t(p,2);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}"function"==typeof fetch&&(c="undefined"!=typeof global&&global.fetch?global.fetch:"undefined"!=typeof window&&window.fetch?window.fetch:fetch),h()&&("undefined"!=typeof global&&global.XMLHttpRequest?u=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(u=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?d=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(d=window.ActiveXObject)),c||!f||u||d||(c=p||f),"function"!=typeof c&&(c=void 0);var g=function(e,t){if(t&&"object"===m(t)){var i="";for(var r in t)i+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t[r]);if(!i)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+i.slice(1)}return e},v=function(e,t,i){c(e,t).then((function(e){if(!e.ok)return i(e.statusText||"Error",{status:e.status});e.text().then((function(t){i(null,{status:e.status,data:t})})).catch(i)})).catch(i)},y=!1;const b=function(e,t,i,r){return"function"==typeof i&&(r=i,i=void 0),r=r||function(){},c?function(e,t,i,r){e.queryStringParams&&(t=g(t,e.queryStringParams));var n=l({},"function"==typeof e.customHeaders?e.customHeaders():e.customHeaders);i&&(n["Content-Type"]="application/json");var o="function"==typeof e.requestOptions?e.requestOptions(i):e.requestOptions,s=l({method:i?"POST":"GET",body:i?e.stringify(i):void 0,headers:n},y?{}:o);try{v(t,s,r)}catch(e){if(!o||0===Object.keys(o).length||!e.message||e.message.indexOf("not implemented")<0)return r(e);try{Object.keys(o).forEach((function(e){delete s[e]})),v(t,s,r),y=!0}catch(e){r(e)}}}(e,t,i,r):h()||"function"==typeof ActiveXObject?function(e,t,i,r){i&&"object"===m(i)&&(i=g("",i).slice(1)),e.queryStringParams&&(t=g(t,e.queryStringParams));try{var n;(n=u?new u:new d("MSXML2.XMLHTTP.3.0")).open(i?"POST":"GET",t,1),e.crossDomain||n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.withCredentials=!!e.withCredentials,i&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.overrideMimeType&&n.overrideMimeType("application/json");var o=e.customHeaders;if(o="function"==typeof o?o():o)for(var s in o)n.setRequestHeader(s,o[s]);n.onreadystatechange=function(){n.readyState>3&&r(n.status>=400?n.statusText:null,{status:n.status,data:n.responseText})},n.send(i)}catch(e){console&&console.log(e)}}(e,t,i,r):void r(new Error("No fetch and no xhr implementation found!"))};function x(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var _=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:function(e){return JSON.parse(e)},stringify:JSON.stringify,parsePayload:function(e,t,i){return function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},t,i||"")},request:b,reloadInterval:"undefined"==typeof window&&36e5,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},E=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.services=t,this.options=i,this.allOptions=r,this.type="backend",this.init(t,i,r)}var t,i,r;return t=e,i=[{key:"init",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=l(i,this.options||{},_()),this.allOptions=r,this.services&&this.options.reloadInterval&&setInterval((function(){return t.reload()}),this.options.reloadInterval)}},{key:"readMulti",value:function(e,t,i){this._readAny(e,e,t,t,i)}},{key:"read",value:function(e,t,i){this._readAny([e],e,[t],t,i)}},{key:"_readAny",value:function(e,t,i,r,n){var o,s=this,a=this.options.loadPath;"function"==typeof this.options.loadPath&&(a=this.options.loadPath(e,i)),(a=function(e){return!!e&&"function"==typeof e.then}(o=a)?o:Promise.resolve(o)).then((function(o){if(!o)return n(null,{});var a=s.services.interpolator.interpolate(o,{lng:e.join("+"),ns:i.join("+")});s.loadUrl(a,n,t,r)}))}},{key:"loadUrl",value:function(e,t,i,r){var n=this;this.options.request(this.options,e,void 0,(function(o,s){if(s&&(s.status>=500&&s.status<600||!s.status))return t("failed loading "+e+"; status code: "+s.status,!0);if(s&&s.status>=400&&s.status<500)return t("failed loading "+e+"; status code: "+s.status,!1);if(!s&&o&&o.message&&o.message.indexOf("Failed to fetch")>-1)return t("failed loading "+e+": "+o.message,!0);if(o)return t(o,!1);var a,l;try{a="string"==typeof s.data?n.options.parse(s.data,i,r):s.data}catch(t){l="failed parsing "+e+" to json"}if(l)return t(l,!1);t(null,a)}))}},{key:"create",value:function(e,t,i,r,n){var o=this;if(this.options.addPath){"string"==typeof e&&(e=[e]);var s=this.options.parsePayload(t,i,r),a=0,l=[],h=[];e.forEach((function(i){var r=o.options.addPath;"function"==typeof o.options.addPath&&(r=o.options.addPath(i,t));var c=o.services.interpolator.interpolate(r,{lng:i,ns:t});o.options.request(o.options,c,s,(function(t,i){a+=1,l.push(t),h.push(i),a===e.length&&n&&n(l,h)}))}))}}},{key:"reload",value:function(){var e=this,t=this.services,i=t.backendConnector,r=t.languageUtils,n=t.logger,o=i.language;if(!o||"cimode"!==o.toLowerCase()){var s=[],a=function(e){r.toResolveHierarchy(e).forEach((function(e){s.indexOf(e)<0&&s.push(e)}))};a(o),this.allOptions.preload&&this.allOptions.preload.forEach((function(e){return a(e)})),s.forEach((function(t){e.allOptions.ns.forEach((function(e){i.read(t,e,"read",null,null,(function(r,o){r&&n.warn("loading namespace ".concat(e," for language ").concat(t," failed"),r),!r&&o&&n.log("loaded namespace ".concat(e," for language ").concat(t),o),i.loaded("".concat(t,"|").concat(e),r,o)}))}))}))}}}],i&&x(t.prototype,i),r&&x(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();E.type="backend";const A=E;var S=i(58164),w=function(e){return null!==e&&"object"==typeof e&&(Object.keys(e).forEach((function(t){Autodesk.Viewing.i18n.addResourceBundle(t,"allstrings",e[t],!0,!0)})),!0)},M=function(e,t){return(0,r.getGlobal)().LOCALIZATION_REL_PATH="res/locales/"+e+"/",Autodesk.Viewing.i18n.changeLanguage(e).then((()=>Autodesk.Viewing.i18n.reloadResources())).then((()=>{t&&t()}))},T=function(e){const t=(0,r.getGlobal)(),i=t&&t.document;Autodesk.Viewing.i18n.localize=function(e){var t=e||i;Array.prototype.forEach.call(t.querySelectorAll("[data-i18n]"),(function(e){var t=e.getAttribute("data-i18n"),i=[null,t],r=i[0],n=i[1],o=Autodesk.Viewing.i18n.translate(n);o?r?e.setAttribute(r,o):e.placeholder?e.placeholder=o:e.textContent=o:r?e.setAttribute(r,n):e.textContent=n}))};var n=e&&e.language||navigator.language;n=S.Lang.getSupported(n),Autodesk.Viewing.i18n.use(A).init({lng:n,backend:{loadPath:Autodesk.Viewing.Private.getResourceUrl("res/locales/%(lng)/%(ns).json")},ns:"allstrings",defaultNS:"allstrings",fallbackLng:"en",debug:!1,useCookie:!1,interpolation:{prefix:"%(",suffix:")",escapeValue:!1}}),M(n)}},58164:e=>{"use strict";let t=new function(){this.names=[{symbol:"en",label:"English"},{symbol:"zh-Hans",label:"Chinese Simplified"},{symbol:"zh-Hant",label:"Chinese Traditional"},{symbol:"zh-HK",label:"Hong Kong Traditional"},{symbol:"ja",label:"Japanese"},{symbol:"cs",label:"Czech"},{symbol:"ko",label:"Korean"},{symbol:"pl",label:"Polish"},{symbol:"ru",label:"Russian"},{symbol:"fr",label:"French"},{symbol:"fr-CA",label:"Canadian French"},{symbol:"de",label:"German"},{symbol:"it",label:"Italian"},{symbol:"nl",label:"Dutch"},{symbol:"es",label:"Spanish"},{symbol:"pt-PT",label:"Portuguese Portugal"},{symbol:"pt-BR",label:"Portuguese Brazil"},{symbol:"tr",label:"Turkish"},{symbol:"sv",label:"Swedish"},{symbol:"da",label:"Danish"},{symbol:"no",label:"Norwegian"},{symbol:"en-GB",label:"British English"}],this.isSupported=function(e){for(var t=0;t<this.names.length;++t)if(this.names[t].symbol===e)return!0;return!1},this.getSupported=function(e){const t=e.split("-");if(e=t[0].toLowerCase(),t.length>1){let i=t[1].toUpperCase();i.length>2&&(i=i[0]+i.substring(1).toLowerCase()),e+="-"+i}return this.isSupported(e)||(e=e.indexOf("zh-CN")>-1?"zh-Hans":e.indexOf("zh-TW")>-1?"zh-Hant":t.length>1&&this.isSupported(t[0].toLowerCase())?t[0]:"en"),e},this.getLanguages=function(){return this.names.slice()}};e.exports={Lang:t}},27156:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DISABLE_FORGE_CANVAS_LOGO:()=>l,DISABLE_FORGE_LOGO:()=>a,fromUrlSafeBase64:()=>y,getHtmlTemplate:()=>u,getParameterByName:()=>f,getParameterByNameFromPath:()=>m,getResourceUrl:()=>p,getScript:()=>h,injectCSS:()=>c,isExperimentalFlagEnabled:()=>d,stringToDOM:()=>g,toUrlSafeBase64:()=>v});var r=i(7247),n=(0,r.getGlobal)(),o=n,s=o&&o.document;n.USE_FETCH_API=!0,n.LOCALIZATION_REL_PATH="",n.LMV_VIEWER_VERSION="7.96.0",n.LMV_BUILD_TYPE="Production",n.LMV_RESOURCE_ROOT="",n.LMV_IS_FLUENT_BUILD=!1,n.USE_OTG_DS_PROXY=!1,n.LMV_THIRD_PARTY_COOKIE=!(0,r.isNodeJS)()&&void 0,"v"===n.LMV_VIEWER_VERSION.charAt(0)&&(n.LMV_VIEWER_VERSION=n.LMV_VIEWER_VERSION.substr(1)),n.LMV_VECTOR_PDF=!1,n.LMV_RASTER_PDF=!0;let a=!1,l=!0;function h(e){e=e.toLowerCase();var t=s.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var i=0;i<t.length;++i)if(t[i].src&&-1!==t[i].src.toLowerCase().indexOf(e))return t[i];return null}function c(e,t,i){for(var r=e.indexOf("://")>0?e:p(e),n=s.getElementsByTagName("link"),o=0,a=n.length;o<a;o++)if(n[o].href===r)return void(t&&t());var l=s.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",r),t&&(l.onload=t),i&&(l.onerror=i),s.head.appendChild(l)}function u(e,t){var i=e.indexOf("://")>0?e:p(e),r=new XMLHttpRequest;function n(e){t(e,null)}r.onload=function(e){var i=e.currentTarget.responseText;t(null,i)},r.onerror=n,r.ontimeout=n,r.open("GET",i,!0),r.send()}function d(e,t){return!(!t||!Array.isArray(t.experimental))&&-1!==t.experimental.indexOf(e)}function p(e){return n.LMV_RESOURCE_ROOT+e}function f(e){return"undefined"==typeof window?"":m(e,o.location.href)}function m(e,t){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function g(e){var t=s.createElement("div");return t.innerHTML=e,t.firstChild}function v(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function y(e){for(e=(e=e.replace(/-/g,"+")).replace(/_/g,"/");e.length%4;)e+="=";return(0,r.isNodeJS)()?Buffer.from(e,"base64").toString():atob(e)}},54923:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AlertBox:()=>n});var r=i(91493);function n(){}n.instances=[],n.displayError=function(e,t,i,o,s,a){var l=e.ownerDocument,h=l.createElement("div");h.className="alert-box error",e.appendChild(h);var c=o;c||(c="img-item-not-found");var u=l.createElement("div");u.className="alert-box-image "+c,h.appendChild(u);var d=l.createElement("div");d.className="alert-box-msg",h.appendChild(d);var p=i;p||(p=r.Z.t("Error Occurred",{defaultValue:"Error Occurred"}));var f=l.createElement("div");f.className="alert-box-title",f.textContent=p,f.setAttribute("data-i18n",p),d.appendChild(f);var m=l.createElement("div");if(m.className="alert-box-text",m.textContent=t,m.setAttribute("data-i18n",t),d.appendChild(m),s){var g=l.createElement("div");g.className="alert-box-content",d.appendChild(g);var v=l.createElement("ul");v.className="alert-box-content";for(var y=0;y<s.length;y++){var b=s[y];if(b){var x=l.createElement("li"),_=this.extractList(b);if(_.list.length){var E=this.generateListElement(list,l);v.appendChild(E)}x.innerHTML=_.msg,x.setAttribute("data-i18n",_.msg),v.appendChild(x)}}g.appendChild(v)}var A=l.createElement("div");A.className="alert-box-ok",A.textContent=r.Z.t("OK",{defaultValue:"OK"});var S={alertBox:h,container:e,tag:a};A.addEventListener("click",(function(t){h.style.visibility="hidden",e.removeChild(h),n.instances.splice(n.instances.indexOf(S),1)})),h.appendChild(A),h.style.visibility="visible",n.instances.push(S)},n.displayErrors=function(e,t,i){var o=e.ownerDocument,s=o.createElement("div");s.className="alert-box errors",e.appendChild(s);var a=t;a||(a="img-item-not-found");var l=o.createElement("div");l.className="alert-box-image "+a,s.appendChild(l);var h=o.createElement("div");h.className="alert-box-msg errors",s.appendChild(h);for(var c=0;c<i.length;c++){var u=i[c].header;u||(u=r.Z.t("Error",{defaultValue:"Error"}));var d=o.createElement("div");d.className="alert-box-title errors",d.textContent=u,h.appendChild(d);var p=o.createElement("div");p.className="alert-box-text errors";var f=i[c].msg;if((_=this.extractList(f)).list.length){var m=o.createElement("div"),g=this.generateListElement(_.list,o);m.appendChild(g),p.textContent=_.msg,p.appendChild(m)}else p.textContent=f;if(h.appendChild(p),i[c].hints){var v=o.createElement("ul");v.className="alert-box-content";for(var y=i[c].hints,b=0;b<y.length;b++){var x=y[b];if(x){var _,E=o.createElement("li");if(v.appendChild(E),(_=this.extractList(x)).list.length){g=this.generateListElement(_.list,o);v.appendChild(g)}E.innerHTML=_.msg}}h.appendChild(v)}}var A=o.createElement("div");A.className="alert-box-ok",A.textContent=r.Z.t("OK",{defaultValue:"OK"});var S={alertBox:s,container:e};A.addEventListener("click",(function(t){s.style.visibility="hidden",e.removeChild(s),n.instances.splice(n.instances.indexOf(S),1)})),s.appendChild(A),s.style.visibility="visible",n.instances.push(S)},n.extractList=function(e){var t={msg:e,list:[]};if(e&&-1!=e.indexOf("<ul>")){var i=e.split("<ul>");t.msg=i[0],i=i[1].split("</ul>"),t.list=i[0].split(", "),1===t.list.length&&(t.list=i[0].split(","))}return t},n.generateListElement=function(e,t){for(var i=t.createElement("ul"),r=0;r<e.length;r++){var n=t.createElement("li");n.textContent=e[r],n.setAttribute("data-i18n",e[r]),i.appendChild(n)}return i},n.dismissByTag=function(e){var t=n.instances.findIndex((t=>t&&t.tag===e));if(-1==t)return!1;var i=n.instances[t];return i.alertBox.style.visibility="hidden",i.container.removeChild(i.alertBox),n.instances.splice(t,1),!0},n.dismiss=function(){if(n.instances.length>0){var e=n.instances.pop();return e.alertBox.style.visibility="hidden",e.container.removeChild(e.alertBox),!0}return!1}},46263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{OptionButton:()=>u,OptionCheckbox:()=>h,OptionDropDown:()=>d,OptionLabel:()=>c,OptionRow:()=>f,OptionSlider:()=>l,ResizeFooter:()=>p,SimpleList:()=>m});var r=i(68482),n=i(91493),o=i(7247),s=i(76542);const a=i(79058);function l(e,t,i,r,o){var s=this;this.tbody=r;var a=o&&o.insertAtIndex?o.insertAtIndex:-1;this.hideStepper=o&&o.hideStepper;var l=o&&o.hideCaption;this.sliderRow=this.tbody.insertRow(a),this.sliderRow.classList.add("switch-slider-row");var h=this.getDocument(),c=this.sliderRow.insertCell(0);function u(e){e.target!=s.stepperElement&&(s.stepperElement.value=s.sliderElement.value),s.fireChangeEvent()}this.caption=h.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=n.Z.t(e),l&&(this.caption.style.display="none"),c.appendChild(this.caption),c=this.sliderRow.insertCell(1),this.sliderElement=h.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=e+"_slider",this.sliderElement.min=t,this.sliderElement.max=i,this.sliderElement.style.width="85%",c.appendChild(this.sliderElement),c=this.sliderRow.insertCell(2),this.stepperElement=h.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=e+"_stepper",this.stepperElement.min=t,this.stepperElement.max=i,this.stepperElement.step=1,this.stepperElement.style.width="64px",this.hideStepper&&(this.stepperElement.style.display="none"),c.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",(function(e){e.target!=s.sliderElement&&(s.sliderElement.value=s.stepperElement.value),s.fireChangeEvent()}),!1),this.sliderElement.addEventListener("change",u,!1),this.sliderElement.addEventListener("input",u,!1)}function h(e,t,i,r,s,l){var h=this;this.tbody=t;var c=l&&l.insertAtIndex?l.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(c),this.sliderRow.classList.add("switch-slider-row");var u=this.getDocument(),d=this.sliderRow.insertCell(0);this.caption=u.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=n.Z.t(e),d.appendChild(this.caption),d=this.sliderRow.insertCell(1),r&&(this.description=u.createElement("div"),this.description.setAttribute("data-i18n",r),this.description.textContent=n.Z.t(r),d.appendChild(this.description),d=this.sliderRow.insertCell(2));var p=u.createElement("label");p.classList.add("switch"),this.checkElement=u.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=e+"_check",this.checkElement.checked=i,p.appendChild(this.checkElement);var f=u.createElement("div");f.classList.add("slider"),p.appendChild(f),d.appendChild(p),this.blockEvent=!1,this.checked=i,this.checkElement.addEventListener("change",(function(e){h.fireChangeEvent()}),!1),(0,o.isTouchDevice)()&&(this.sliderRowHammer=new a.Manager(this.sliderRow,{recognizers:[[a.Tap]],handlePointerEventMouse:!1,inputClass:a.TouchInput}),this.sliderRowHammer.on("tap",(function(e){e.preventDefault(),e.target.click()}))),this.checkElement.addEventListener("click",(function(e){e.stopPropagation()}),!1),this.sliderRow.addEventListener("click",(function(e){h.checkElement.disabled||(h.checkElement.checked=!h.checkElement.checked,h.fireChangeEvent())}),!1)}function c(e,t,i,r){this.tbody=t;var o=r&&r.insertAtIndex?r.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(o);var s=this.getDocument(),a=this.sliderRow.insertCell(0);this.caption=s.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=n.Z.t(e),a.appendChild(this.caption),a.colSpan="3",this.blockEvent=!1,this.removeFromParent=function(){this.tbody.removeChild(this.sliderRow),this.tbody=null,this.sliderRow=null,this.caption=null}}function u(e,t,i,r){this.tbody=t;var o=r&&r.insertAtIndex?r.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(o),this.sliderRow.insertCell();var s=this.sliderRow.insertCell();this.sliderRow.insertCell();var a=this.getDocument();this.caption=a.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=n.Z.t(e),this.caption.classList.add("adsk-button"),this.caption.classList.add("table-button"),s.appendChild(this.caption),this.removeFromParent=function(){this.tbody.removeChild(this.sliderRow),this._onClick&&(this.caption.removeEventListener("click",this._onClick),this._onClick=null),this.tbody=null,this.sliderRow=null,this.caption=null},this.setOnClick=function(e){this._onClick=e,this.caption.addEventListener("click",e,!1)}}function d(e,t,i,r,o,s,a){var l=this;this.tbody=t;var h=a&&a.insertAtIndex?a.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(h);var c=this.getDocument();this.dropdownElement=c.createElement("select"),this.dropdownElement.id=e+"_dropdown",this.dropdownElement.classList.add("option-drop-down");for(var u=0;u<i.length;u++){var d=c.createElement("option");d.value=u,d.setAttribute("data-i18n",i[u]),d.textContent=n.Z.t(i[u]),this.dropdownElement.add(d)}this.selectedIndex=this.dropdownElement.selectedIndex=r;var p=this.sliderRow.insertCell(0);this.caption=c.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=n.Z.t(e),p.appendChild(this.caption),o?(p.colSpan="2",this.sliderRow=this.tbody.insertRow(h),(p=this.sliderRow.insertCell(0)).appendChild(this.dropdownElement),p.colSpan="2",this.dropdownElement.classList.add("tabcell")):(p=this.sliderRow.insertCell(1)).appendChild(this.dropdownElement),p.style.paddingLeft=(a&&void 0!==a.paddingLeft?a.paddingLeft:5)+"px",p.style.paddingRight=(a&&void 0!==a.paddingRight?a.paddingRight:5)+"px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",(function(e){l.fireChangeEvent()}),!1)}function p(e,t,i){this.resizeCallback=t;var r=this.getDocument(),n=r.createElement("div");n.classList.add("docking-panel-footer");var o=r.createElement("div");o.classList.add("docking-panel-footer-resizer"),n.appendChild(o);var s=!1,a=e.getBoundingClientRect(),l={x:0,y:0},h=r.createElement("div");h.classList.add("adsk-viewing-viewer"),h.classList.add("docking-panel-resize-overlay");var c=function(t){s=!0,a=e.getBoundingClientRect(),this.getDocument().body.appendChild(h),this.addDocumentEventListener("touchmove",d),this.addDocumentEventListener("touchcancel",u),this.addDocumentEventListener("touchend",u),this.addDocumentEventListener("mousemove",d),this.addDocumentEventListener("mouseup",u),t.preventDefault(),t.stopPropagation()};c=c.bind(this);var u=function(e){var t=this.getDocument();t.body.contains(h)&&(t.body.removeChild(h),this.removeDocumentEventListener("touchmove",d),this.removeDocumentEventListener("touchcancel",u),this.removeDocumentEventListener("touchend",u),this.removeDocumentEventListener("mousemove",d),this.removeDocumentEventListener("mouseup",u),e.preventDefault(),e.stopPropagation())};u=u.bind(this);var d=function(t){"touchmove"===t.type&&(t.canvasX=t.touches[0].screenX,t.canvasY=t.touches[0].screenY),s&&(s=!1,l.x=t.canvasX||t.clientX,l.y=t.canvasY||t.clientY);var i=(t.canvasX||t.clientX)-l.x,r=(t.canvasY||t.clientY)-l.y,n=parseInt(a.width+i),o=parseInt(a.height+r);e.style.width=n+"px",e.style.height=o+"px",this.resizeCallback&&this.resizeCallback(n,o),t.preventDefault(),t.stopPropagation()};d=d.bind(this),o.addEventListener("touchstart",c),o.addEventListener("mousedown",c),e.style.resize="none",e.appendChild(n),this.footer=n,this.resizer=o}function f(e,t,i,r,o){this.tbody=t;var s=o&&o.insertAtIndex?o.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(s),this.sliderRow.classList.add("switch-slider-row");var a=this.getDocument(),l=this.sliderRow.insertCell(0);this.caption=a.createElement("div"),this.caption.setAttribute("data-i18n",e),this.caption.textContent=n.Z.t(e),l.appendChild(this.caption),l=this.sliderRow.insertCell(1),i&&(this.description=a.createElement("div"),this.description.setAttribute("data-i18n",i),this.description.textContent=n.Z.t(i),l.appendChild(this.description),l=this.sliderRow.insertCell(2))}l.prototype.constructor=l,r.EventDispatcher.prototype.apply(l.prototype),l.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var e=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(e)}},l.prototype.setValue=function(e){this.blockEvent=!0,this.value=e,this.sliderElement.value=e,this.stepperElement.value=e,this.blockEvent=!1},l.prototype.setDisabled=function(e){this.sliderElement.disabled=e,this.stepperElement.disabled=e,this.caption.disabled=e},s.GlobalManagerMixin.call(l.prototype),h.prototype.constructor=h,r.EventDispatcher.prototype.apply(h.prototype),s.GlobalManagerMixin.call(h.prototype),h.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var e=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(e)}},h.prototype.setChecked=function(e){this.checkElement.checked!=e&&(this.checkElement.checked=e,this.fireChangeEvent())},h.prototype.setValue=function(e){this.blockEvent=!0,this.checked=e,this.checkElement.checked=e,this.blockEvent=!1},h.prototype.getValue=function(){return this.checkElement.checked},h.prototype.setDisabled=function(e){this.checkElement.disabled=e,this.caption.disabled=e},h.prototype.setVisibility=function(e){this.sliderRow.style.display=e?"table-row":"none"},s.GlobalManagerMixin.call(c.prototype),s.GlobalManagerMixin.call(u.prototype),d.prototype.constructor=d,r.EventDispatcher.prototype.apply(d.prototype),d.prototype.setSelectedIndex=function(e){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=e,this.blockEvent=!1},d.prototype.setSelectedValue=function(e){this.blockEvent=!0,this.dropdownElement.selectedValue=e,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},d.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var e=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(e)}},d.prototype.setDisabled=function(e){this.dropdownElement.disabled=e,this.caption.disabled=e},s.GlobalManagerMixin.call(d.prototype),s.GlobalManagerMixin.call(p.prototype),s.GlobalManagerMixin.call(f.prototype);class m{constructor(e,t,i){this._parentDiv=e,this._renderRowFn=t,this._onClickFn=i,this._onRowClick=this._onRowClick.bind(this);const r=this.getDocument(),n=r.createElement("div");n.classList.add("settings-container"),this._parentDiv.appendChild(n),this._myContainer=n,this._myContainer.addEventListener("click",this._onRowClick,{capture:!0});const o=r.createElement("div");o.classList.add("settings-table"),this._rowsContainer=o,n.appendChild(o)}setData(e,t){this._removeAllRows(),this._items=e;for(let t=0;t<e.length;++t)this._addRow(t);this._updateSelection(t)}removeFromParent(){this._myContainer.removeEventListener("click",this._onRowClick,{capture:!0}),this._removeAllRows(),this._parentDiv.removeChild(this._myContainer),this._parentDiv=null,this._myContainer=null,this._rowsContainer=null,this._onClickFn=null,this._items=null}_addRow(e){const t=this._items[e],i=this.getDocument(),r=i.createElement("div");this._renderRowFn(r,t,{domDocument:i}),r.setAttribute("data-index",e),this._rowsContainer.appendChild(r)}_removeAllRows(){for(var e=this._rowsContainer.children;e.length;)this._rowsContainer.removeChild(e[0])}_updateSelection(e){const t=this._rowsContainer.children;for(let i=0;i<t.length;i++){const r=t[i];i===e?r.classList.add("border-select"):r.classList.remove("border-select")}}_onRowClick(e){for(var t,i=e.target;i!==this._myContainer&&!(t=i.getAttribute("data-index"));)i=i.parentNode;if(t){var r=parseInt(t);this._onClickFn(r)}}}s.GlobalManagerMixin.call(m.prototype)},36851:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ContextMenu:()=>l});var r=i(7247),n=i(60489),o=i(91493),s=i(76542),a=i(22753);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.viewer=e,this.setGlobalManager(e.globalManager),this.menus=[],this.container=null,this.open=!1,this._onDOMevent=this._onDOMevent.bind(this),this.onHide=t.onHide}l.prototype.constructor=l,s.GlobalManagerMixin.call(l.prototype),l.prototype.show=function(e,t){var i=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var r=e.clientX-i.left,n=e.clientY-i.top;this.open||(this.showMenu(t,r,n),this.open=!0),this._startX=e.clientX,this._startY=e.clientY},l.prototype.showMenu=function(e,t,i,o){var s,a=[],l=this.getDocument(),h=l.createElement("div");h.style.left="0",h.style.top="0",h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.zIndex="10";var c=l.createElement("div");c.classList.add("menu"),c.classList.add("docking-panel"),c.classList.add("docking-panel-container-solid-color-a"),h.appendChild(c),this.viewer.container.appendChild(h),this.container=h,this.menus.push(c);let u=!1;for(var d=0;d<e.length;++d){var p=e[d],f=p.title,m=p.target,g=p.icon,v=p.shortcut,y=p.divider;let t=Array.isArray(m);t&&!e.isChild?u=!0:t=!1,y?(s=this.createDivider(),c.appendChild(s)):(s=this.createMenuItem(f,g,v,t),c.appendChild(s),"function"==typeof m?this.addCallbackToMenuItem(s,m):t?a.push({menuItem:s,target:m}):n.logger.warn("Invalid context menu option:",f,m))}if(!u){const e=c.children;for(let t=0;t<e.length;t++){const i=e[t],r=i.getElementsByClassName("menu-item-expand");r.length>0&&i.removeChild(r[0])}}var b=c.getBoundingClientRect(),x=b.width,_=b.height,E=this.viewer.container.getBoundingClientRect(),A=E.width,S=E.height;(o=!!o||(0,r.isTouchDevice)()&&!this.viewer.navigation.getUseLeftHandedInput())&&(t-=x),t<0&&(t=0),A<t+x&&(t=A-x)<0&&(t=0),i<0&&(i=0),S<i+_&&(i=S-_)<0&&(i=0),c.style.top=Math.round(i)+"px",c.style.left=Math.round(t)+"px";const w=(e,t)=>{const i=e.getElementsByClassName("menu-item-expand");e.removeChild(i[0]);const r=e.getElementsByClassName("menu-item-icon");r.length>0&&e.insertBefore(r[0],e.childNodes[e.length-1]),this.setMenuExpand(e,!0,t)};let M=!1;for(d=0;d<a.length;++d){var T=a[d];const e=(s=T.menuItem).getBoundingClientRect(),r=this.viewer.container.getBoundingClientRect(),n=e.right-e.left;M=r.right-e.right<n||o,M&&w(s,!0),t=Math.round((M?e.left:e.right)-r.left),i=Math.round(e.top-r.top),this.addSubmenuCallbackToMenuItem(s,T.target,t,i,M)}if(a.length>0&&M){const e=c.children;for(let t=0;t<e.length;t++){const i=e[t];i.children.length>2&&-1!==i.children[2].className.indexOf("menu-item-expand")&&w(i,!1)}}this.container.addEventListener("touchend",this._onDOMevent),this.container.addEventListener("mousedown",this._onDOMevent),this.container.addEventListener("mouseup",this._onDOMevent),(0,r.isTouchDevice)()||this.container.addEventListener("mousemove",this._onDOMevent)},l.prototype._onDOMevent=function(e){switch(e.type){case"touchend":this._isContextMenu(e)||this.hide();break;case"mousedown":this._startX=e.clientX,this._startY=e.clientY;break;case"mouseup":this._isContextMenu(e)||(this.hide(),a.EventUtils.isRightClick(e)&&e.clientX===this._startX&&e.clientY===this._startY&&this.viewer.triggerContextMenu(e));break;case"mousemove":{if(!this.currentItem||this.menus.length<2)break;const t=this._isInside(e,this.currentItem),i=this._isInside(e,this.menus[1]);t||i?this.currentItem.backgroundColor&&(this.currentItem.style.backgroundColor=this.currentItem.backgroundColor):(this.hideMenu(this.menus[1]),this.currentItem.style.backgroundColor=null,this.currentItem=null);break}}},l.prototype.createMenuItem=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n=this.getDocument().createElement("div");return n.className="menu-item",i=i||"",this.setMenuItemIcon(n,t),this.setMenuItemText(n,e),this.setMenuExpand(n,!1,r),this.setMenuItemShortcut(n,i),n},l.prototype.createDivider=function(){var e=this.getDocument(),t=e.createElement("div");t.className="menu-divider-container";var i=e.createElement("div");return i.className="menu-divider",t.appendChild(i),t},l.prototype.setMenuItemIcon=function(e,t){var i=this.getDocument().createElement("div");i.classList.add("menu-item-icon"),t&&i.classList.add(t),e.appendChild(i)},l.prototype.setMenuItemText=function(e,t){var i=this.getDocument().createElement("div");i.classList.add("menu-item-text"),i.setAttribute("data-i18n",t),i.textContent=o.Z.t(t),e.appendChild(i)},l.prototype.setMenuItemShortcut=function(e,t){var i=this.getDocument().createElement("div");i.classList.add("menu-item-shortcut"),i.textContent=t,e.appendChild(i)},l.prototype.setMenuExpand=function(e,t,i){var r=this.getDocument().createElement("div");r.classList.add("menu-item-expand"),t?(r.style.transform="scale(-1)",e.insertBefore(r,e.childNodes[0])):e.appendChild(r);const n=0|i;r.style.opacity=n},l.prototype.addCallbackToMenuItem=function(e,t){var i=this;e.addEventListener("click",(function(e){return i.hide(),t(),e.preventDefault(),!1}),!1)},l.prototype.addSubmenuCallbackToMenuItem=function(e,t,i,n,o){var s=this;t.isChild=!0,(0,r.isTouchDevice)()?e.addEventListener("click",(function(){s.open=!0,s.currentItem=e,s.showMenu(t,i,n,o)}),!1):e.addEventListener("mouseenter",(function(){if(s._isInside(event,e)){s.open=!0,s.currentItem=e;const r=s.getWindow().getComputedStyle(s.currentItem).getPropertyValue("background-color");s.currentItem.backgroundColor=r,s.showMenu(t,i,n,o)}}),!1)},l.prototype.hideMenu=function(e){const t=e=>{e.removeEventListener("touchend",this._onDOMevent),e.removeEventListener("mousedown",this._onDOMevent),e.removeEventListener("mouseup",this._onDOMevent),(0,r.isTouchDevice)()||e.removeEventListener("mousemove",this._onDOMevent),e.parentNode.removeChild(e)};e&&-1!==this.menus.indexOf(e)&&e.parentNode&&(t(e.parentNode),this.menus.splice(this.menus.indexOf(e),1)),0===this.menus.length?(this.open=!1,this.container=null):1===this.menus.length&&(this.container=this.menus[0].parentNode)},l.prototype.hide=function(){if(this.open){for(;this.menus.length>0;)this.hideMenu(this.menus[0]);return this.onHide&&this.onHide(),!0}return!1},l.prototype._isContextMenu=function(e){for(let i=0;i<this.menus.length;i++){const r=this.menus[i];for(var t=e.target;t!==this.container;){if(t===r)return!0;t=t.parentNode}}return!1},l.prototype._isInside=function(e,t){var i=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var r=Math.ceil(e.clientX-i.left),n=Math.ceil(e.clientY-i.top);const o=t.getBoundingClientRect(),s=Math.floor(o.top-i.top),a=Math.ceil(o.bottom-i.top),l=Math.floor(o.left-i.left),h=Math.ceil(o.right-i.left);return n>=s&&n<=a&&r>=l&&r<=h}},54714:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DataTable:()=>o});var r=i(52072);const n=Autodesk.Viewing.UI;function o(e){if(!(e instanceof n.DockingPanel))throw new Error("Invalid docking panel");this.dockingPanel=e;let t=this.dockingPanel.getDocument();this.datatableDiv=t.createElement("div"),this.datatableDiv.setAttribute("id","datatable"),this.datatableDiv.setAttribute("class","datatable"),e.container.appendChild(this.datatableDiv),e.footerInstance&&(e.footerInstance.resizeCallback=this._fitHeaderColumns.bind(this)),this.groupedByColumn=!1,this.aggregated=!1}o.prototype._createColumns=function(e){let t=this.dockingPanel.getDocument();var i=t.createElement("div");i.setAttribute("id","columnArea"),i.setAttribute("class","clusterize-headers");var r='<table id="headersArea"><thead><tr id ="columnRow"></tr></thead></table>';i.innerHTML=r,this.datatableDiv.appendChild(i);var n=i.querySelector("tr");e.forEach((function(e){var i=t.createElement("th");i.appendChild(t.createTextNode(e)),n.appendChild(i)})),r=this.datatableDiv.querySelector("table"),this._makeTableSortable(r)},o.prototype._createRows=function(){var e=this.dockingPanel.getDocument().createElement("div");e.innerHTML='<div id="scrollArea" class="clusterize-scroll"><table id="bodyArea" class="table-striped"><tbody id="contentArea" class="clusterize-content"><tr class="clusterize-no-data"><td>Loading data</td></tr></tbody></table></div>',this.datatableDiv.appendChild(e)},o.prototype.setData=function(e,t){if(t.length!==e[0].length)throw new Error("Column length should be same as the row length");this._createColumns(t),this._createRows();var i=this;this.rowData=e,this.clusterize=new r({rows:this.rowData.map((function(e){return"<tr>"+e.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>"})),scrollId:"scrollArea",contentId:"contentArea",callbacks:{clusterChanged:function(){i._fitHeaderColumns(),i._syncHeaderWidth(),i.groupedByColumn&&i._updateClusterGroup()}}}),this.datatableDiv.querySelector(".clusterize-scroll").addEventListener("scroll",(function(){var e=this.scrollLeft;n(e)}));var n=function(e){i.datatableDiv.querySelector("#headersArea").style.setProperty("margin-left",-e+"px")}},o.prototype.destroyTable=function(){this.clusterize.destroy(!0),this.clusterize=null,this.rowData=null,this.groupedByColumn=!1},o.prototype._makeTableSortable=function(e){var t,i=this,r=e.tHead;if(r&&r.rows[0]&&(r=r.rows[0].cells),r)for(t=r.length;--t>=0;)!function(e){var t=1;r[e].addEventListener("click",(function(){i._sortTable(e,t=1-t)}))}(t)},o.prototype._sortTable=function(e,t){var i=this.rowData;this.sortFunction||this.restoreDefaultSortFunction();var r=this.sortFunction&&this.sortFunction.bind(this),n=(i=i.sort(r(e,t))).map((function(e){return"<tr>"+e.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>"}));this.clusterize.update(n);var o=this.datatableDiv.querySelector("#bodyArea");o.classList.contains("table-striped")||o.classList.add("table-striped")},o.prototype.setSortFunction=function(e){this.sortFunction=e},o.prototype.getSortFunction=function(){return this.sortFunction},o.prototype.restoreDefaultSortFunction=function(){this.sortFunction=function(e,t){return t=-(+t||-1),function(i,r){return t*i[e].localeCompare(r[e])}}},o.prototype.getGroupByColumn=function(e){var t=this.rowData,i={};for(let n=0;n<t.length;n++){var r=t[n][e];i[r]||(i[r]=[]),i[r].push(n)}return i},o.prototype.groupByColumn=function(e){var t=this.rowData,i={};for(let n=0;n<t.length;n++){let o=t[n];var r=o[e];if(i[r]||(i[r]=[]),i[r].length>0)o="<tr class= 'subrow'>"+o.map((function(e){return"<td>"+e+"</td>"})).join(" ")+"</tr>";else{const e=o.length;o="<tr class= 'parentrow'>"+o.map((function(t,i){return e===i+1?"<td>"+t+'<span value="click"></span></td>':"<td>"+t+"</td>"})).join(" ")+"</tr>"}i[r].push(o)}var n=[];for(let e in i){var o=i[e];for(let e=0;e<o.length;e++){let t=o[e];n.push(t)}}this.clusterize.update(n);var s=this.datatableDiv.querySelector("#bodyArea");s.classList.contains("table-striped")&&s.classList.remove("table-striped"),this.datatableDiv.querySelectorAll(".subrow").forEach((e=>{this._slideDown(e),e.style.fontSize="14px"}));var a=this._fitHeaderColumns.bind(this),l=this._expandContent.bind(this);this.datatableDiv.querySelectorAll("span").forEach((e=>{e.addEventListener("click",(function(e){l(this,e),a()}))})),this._fitHeaderColumns(),this.groupedByColumn||(this.groupedByColumn=!0)},o.prototype._updateClusterGroup=function(){var e=this._fitHeaderColumns.bind(this),t=this._expandContent.bind(this);this.datatableDiv.querySelectorAll("span").forEach((i=>{i.addEventListener("click",(function(i){t(this,i),e()}))})),this.datatableDiv.querySelectorAll(".subrow").forEach((e=>{this._slideDown(e),e.style.fontSize="14px"}))},o.prototype._expandContent=function(e){var t=!1;"collapsed"===e.className&&(t=!0);var i=t?14:0,r=e.closest("tr"),n=this._nextUntil(r,":not(.subrow)");for(let e=0;e<n.length;e++)this._slideToggle(n[e],500),n[e].style.fontSize=i+"px";e.classList.toggle("collapsed")},o.prototype._nextUntil=function(e,t,i){var r=[];for(e=e.nextElementSibling;e&&!e.matches(t);)!i||e.matches(i)?(r.push(e),e=e.nextElementSibling):e=e.nextElementSibling;return r},o.prototype._slideToggle=function(e,t){return"none"===this.dockingPanel.getWindow().getComputedStyle(e).display?this._slideDown(e,t):this._slideUp(e,t)},o.prototype._slideUp=function(e,t){e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.boxSizing="border-box",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")},o.prototype._slideDown=function(e,t){let i=this.dockingPanel.getWindow();e.style.removeProperty("display");let r=i.getComputedStyle(e).display;"none"===r&&(r="block"),e.style.display=r;e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.offsetHeight,e.style.boxSizing="border-box",e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height="21pxpx",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),i.setTimeout((()=>{e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")}),t)},o.prototype.getAggregate=function(e,t){var i,r=this.rowData,n=null;switch(e){case"MIN":n=function(){var e=r[0][t];for(let i=1;i<r.length;i++)e>r[i][t]&&(e=r[i][t]);return e||0}();break;case"MAX":n=function(){var e=r[0][t];for(let i=1;i<r.length;i++)e<r[i][t]&&(e=r[i][t]);return e||0}();break;case"SUM":n=o();break;case"AVG":i=o()/r.length,n=(i=parseFloat(i))||0;break;case"COUNT":n=r.length}return n;function o(){var e=0;for(let i=0;i<r.length;i++)e+=parseFloat(r[i][t]);return e||0}},o.prototype.aggregate=function(e,t){var i=this.datatableDiv.querySelector(".clusterize-content").querySelector("tr:not(.clusterize-extra-row):not(.first)");if(!i)return;for(var r=[],n=0;n<i.children.length;n++)r.push(i.children[n].clientWidth);var o=this.getAggregate(e,t);let s=this.dockingPanel.getDocument();if(!this.aggregated){var a=s.createElement("div");a.setAttribute("id","aggregate"),a.setAttribute("class","aggregate-headers");a.innerHTML='<table id="aggregateArea"><tbody></tbody></table>',this.datatableDiv.appendChild(a)}for(var l=this.datatableDiv.querySelector("#aggregateArea"),h=0;h<l.rows.length;h++){if(l.rows[h].cells[t].innerText.indexOf(e)>-1)return}for(var c=0;c<l.rows.length;c++){var u=l.rows[c].cells[t];if(0===u.innerText.length)return u.appendChild(s.createTextNode(e+": ")),void u.appendChild(s.createTextNode(o))}for(var d=l.insertRow(l.rows.length),p=0;p<r.length;p++){var f=s.createElement("td");d.appendChild(f),f.style.setProperty("min-width",r[p]+"px","important"),p===t&&(f.appendChild(s.createTextNode(e+": ")),f.appendChild(s.createTextNode(o)))}this.aggregated=!0},o.prototype.clearAggregates=function(){for(var e=this.datatableDiv.querySelectorAll(".aggregate-headers"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},o.prototype._fitHeaderColumns=function(){var e=this.datatableDiv.querySelector(".clusterize-content"),t=this.datatableDiv.querySelector("#headersArea"),i=e.querySelector("tr:not(.clusterize-extra-row):not(.first)");if(i){for(var r=[],n=[],o=0;o<i.children.length;o++)n.push(i.children[o].clientWidth);if(n.toString()!=r.toString()){for(var s=t.querySelector("tr"),a=0;a<s.children.length;a++)s.children[a].style.setProperty("clientWidth",n[a]+"px","important"),s.children[a].style.setProperty("min-width",n[a]+"px","important");if(this.aggregated)for(var l=this.datatableDiv.querySelector("#aggregateArea"),h=0;h<l.rows.length;h++)for(var c=l.rows[h],u=0;u<c.children.length;u++)c.children[u].style.setProperty("clientWidth",n[u]+"px","important"),c.children[u].style.setProperty("min-width",n[u]+"px","important");r=n}}},o.prototype._syncHeaderWidth=function(){var e=this.datatableDiv.querySelector(".clusterize-content"),t=this.datatableDiv.querySelector("#headersArea");t.style.setProperty("clientWidth",e.width),t.style.setProperty("min-idth",e.width)}},90650:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DockingPanel:()=>o});var r=i(91493),n=i(46263);function o(e,t,i,r){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.movedSinceCreate=!1,this.parentContainer=e;var n=this.getDocument();this.container=n.createElement("div"),this.container.id=t,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=i,r=r||{},Object.prototype.hasOwnProperty.call(r,"localizeTitle")||(r.localizeTitle=!0),Object.prototype.hasOwnProperty.call(r,"addFooter")||(r.addFooter=!0),this.options=r,this.container.classList.add("docking-panel"),e.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)}i(76542).GlobalManagerMixin.call(o.prototype),o.prototype.onSetGlobalManager=function(e){this.footerInstance&&this.footerInstance.setGlobalManager(e)},o.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer),this.options.addFooter&&(this.footer=this.createFooter(),this.container.appendChild(this.footer))},o.prototype.uninitialize=function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];t.target.removeEventListener(t.eventId,t.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},o.prototype.addVisibilityListener=function(e){this.visibilityCallbacks.push(e)},o.prototype.setVisible=function(e){if(e){var t=this.getContainerBoundingRect();if(this.container.dockRight){var i=t.width,r=300,n=this.container.lastWidth||this.container.style.width;n||(n=this.container.getBoundingClientRect().width),n&&(r=parseInt(n)),this.container.style.left=i-r+"px"}if(this.container.dockBottom){var o=t.height,s=300,a=this.container.lastHeight||this.container.style.height;a||(a=this.container.getBoundingClientRect().height),a&&(s=parseInt(a));var l=o-s;this.container.style.top=l>0?l+"px":0}this.container.style.maxHeight=t.height+"px",this.container.style.maxWidth=t.width+"px",this.container.style.display="block",this.bringToFront()}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var h=0;h<this.visibilityCallbacks.length;h++)this.visibilityCallbacks[h](e)},o.prototype.isVisible=function(){return"block"===this.container.style.display},o.prototype.visibilityChanged=function(){},o.prototype.initializeMoveHandlers=function(e){var t,i,r,n,o,s,a,l,h=this.container,c=this;function u(e){var u=h.style.minWidth?parseInt(h.style.minWidth):c.kMinWdth,d=h.style.minHeight?parseInt(h.style.minHeight):c.kMinHeight,p=c.getContainerBoundingRect();h.style.maxWidth&&parseInt(h.style.width)>parseInt(h.style.maxWidth)&&(h.style.width=h.style.maxWidth),h.style.maxHeight&&parseInt(h.style.height)>parseInt(h.style.maxHeight)&&(h.style.height=h.style.maxHeight),parseInt(h.style.width)<u&&(h.style.width=u+"px"),parseInt(h.style.height)<d&&(h.style.height=d+"px"),"touchmove"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),a+=e.screenX-r,l+=e.screenY-n,t=o+a,i=s+l;var f=parseInt(h.style.width),m=parseInt(h.style.height);isNaN(f)&&(f=c.container.getBoundingClientRect().width),isNaN(m)&&(m=c.container.getBoundingClientRect().height),t<5&&(t=0),i<5&&(i=0),h.dockRight=!1,h.dockBottom=!1,p.width-5<t+f&&(t=p.width-f,h.dockRight=!0),p.height-5<i+m&&(i=p.height-m,h.dockBottom=!0),h.style.left=t+"px",h.style.top=i+"px",h.style.maxWidth=p.width-t+"px",h.style.maxHeight=p.height-i+"px",r=e.screenX,n=e.screenY,c.onMove(e,t,i)}function d(e){c.removeWindowEventListener("mousemove",u),c.removeWindowEventListener("mouseup",d),c.removeWindowEventListener("touchmove",u),c.removeWindowEventListener("touchend",d),c.onEndMove(e,t,i)}function p(e){"touchstart"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),r=e.screenX,n=e.screenY,a=0,l=0,o=c.container.offsetLeft,s=c.container.offsetTop,c.addWindowEventListener("mousemove",u,!1),c.addWindowEventListener("mouseup",d,!1),c.addWindowEventListener("touchmove",u,!1),c.addWindowEventListener("touchend",d,!1),e.preventDefault(),c.onStartMove(e,o,s)}c.addEventListener(e,"mousedown",p),c.addEventListener(e,"touchstart",p)},o.prototype.initializeCloseHandler=function(e){var t=this;t.addEventListener(e,"click",(function(){t.setVisible(!1)}),!1)},o.prototype.createScrollContainer=function(e){var t=this.getDocument().createElement("div"),i=t.classList;return i.add("docking-panel-scroll"),i.add("docking-panel-container-solid-color-a"),i.add(e&&e.left?"left":"right"),e&&e.heightAdjustment&&(t.style.height="calc(100% - "+e.heightAdjustment+"px)"),e&&e.marginTop&&(t.style.marginTop=e.marginTop+"px"),t.id=this.container.id+"-scroll-container",this.container.appendChild(t),this.scrollContainer=t,this.scrollEaseCurve=e&&e.scrollEaseCurve||[0,0,.29,1],this.scrollEaseSpeed=e&&e.scrollEaseSpeed||.003,t},o.prototype.createTitleBar=function(e){var t=this.getDocument().createElement("div");t.classList.add("docking-panel-title"),t.textContent=e;var i=this;return i.addEventListener(t,"click",(function(e){i.movedSinceLastClick||i.onTitleClick(e),i.movedSinceLastClick=!1})),i.addEventListener(t,"mousedown",(function(){i.bringToFront()})),i.addEventListener(t,"dblclick",(function(e){i.onTitleDoubleClick(e)})),t},o.prototype.createFooter=function(){var e=new n.ResizeFooter(this.container);return e.setGlobalManager(this.globalManager),this.footerInstance=e,this.container.style.resize="none",e.footer},o.prototype.setTitle=function(e,t){t&&t.localizeTitle?(this.title.setAttribute("data-i18n",e),e=r.Z.t(e,t.i18nOpts)):this.title.removeAttribute("data-i18n"),this.title.textContent=e},o.prototype.createCloseButton=function(){var e=this.getDocument().createElement("div");return e.className="docking-panel-close",this.initializeCloseHandler(e),e},o.prototype.onStartMove=function(){},o.prototype.onEndMove=function(){},o.prototype.onMove=function(){this.movedSinceLastClick=!0,this.movedSinceCreate=!0},o.prototype.onTitleClick=function(){},o.prototype.onTitleDoubleClick=function(){},o.prototype.addEventListener=function(e,t,i){e.addEventListener(t,i),this.listeners.push({target:e,eventId:t,callback:i})},o.prototype.removeEventListener=function(e,t,i){for(var r=0;r<this.listeners.length;++r){var n=this.listeners[r];if(n.target===e&&n.eventId===t&&n.callback===i)return e.removeEventListener(t,i),this.listeners.splice(r,1),!0}return!1},o.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},o.prototype.resizeToContent=function(e){if(this.isVisible()){var t=this.getContentSize().height,i=this.container.getBoundingClientRect(),r=this.getContainerBoundingRect(),n=this.container.querySelector(".docking-panel-footer");n&&(t+=n.getBoundingClientRect().height);var o=r.height;o-=i.top-r.top+75,e&&void 0!==e.maxHeight&&(o=Math.min(o,e.maxHeight)),t>o&&(t=o),this.container.style.maxHeight=o.toString()+"px",this.container.style.height=t.toString()+"px"}},o.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},o.prototype.animateScroll=function(e,t,i){var r=this.scrollEaseCurve,n=this.scrollEaseSpeed,o=this.scrollContainer;var s=performance.now();requestAnimationFrame((function a(l){var h=(l-s)*n;h=Math.min(h,1);var c=function(e,t){var i=3*e[1],r=3*(e[3]-e[1])-i;return(((1-i-r)*t+r)*t+i)*t}(r,h),u=e+(t-e)*c;o.scrollTop=u,i&&i(u),h<1&&requestAnimationFrame(a)}))},o.prototype.onViewerResize=function(e,t,i,r,n,o){var s=this.container,a=s.getBoundingClientRect(),l=a.width,h=a.height;if(!l||!h)return!1;var c=a.top,u=a.bottom,d=a.left,p=a.right;return n<l&&(l=Math.round(n),s.style.width=l+"px"),o<h&&(h=Math.round(o),s.style.height=h+"px"),(r<p||s.dockRight)&&(d=Math.round(r-l-i),s.style.left=d+"px"),(t<u||s.dockBottom)&&((c=Math.round(t-h-e))<0&&(c=0),s.style.top=c+"px"),s.style.maxWidth=Math.round(n)+"px",s.style.maxHeight=Math.round(o)+"px",!0},o.prototype.bringToFront=function(){var e=this.scrollContainer?this.scrollContainer.scrollTop:0;this.parentContainer.appendChild(this.container),this.scrollContainer&&(this.scrollContainer.scrollTop=e)}},91629:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ErrorHandler:()=>l});var r=i(54923),n=i(60489),o=i(91493),s=i(6875),a={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unlock","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You dont have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We cant display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>Theres nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":{title:"Sorry",message:"The file extension loaded into the Viewer is not supported",hints:["Try a different file"]}},15:{img:"img-unsupported","globalized-msg":"Viewer-WebGlContextLost","default-msg":{title:"WebGL context lost",message:"Unable to recover from software mode.  Please restart your browser and reload the Viewer",hints:["If you continue to encounter this issue when viewing this model, we recommend switching to a different browser."]}}};function l(){}l.prototype.constructor=l,l.reportError=function(e,t,i,h,c,u){if(l.currentError=null,l.currentErrors=null,t){var d={category:"error",code:t,message:i,httpStatusCode:h,httpStatusText:c};n.logger.track(d,!0),l.currentError=[e,t,i,u];var p=a[t];if(p){(b={defaultValue:""}).defaultValue=p["default-msg"];var f=p.img,m=p["globalized-msg"],g=this.parseErrorString(m,b);if(t===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||t===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var v=(0,s.getWebGLHelpLink)()||"http://www.autodesk.com/a360-browsers",y=0;y<g.hints.length;y++){-1!==g.hints[y].indexOf('href="WEBGL_HELP"')&&(g.hints[y]=g.hints[y].replace('href="WEBGL_HELP"','href="'+v+'"'))}r.AlertBox.displayError(e,g.msg,g.header,f,g.hints)}else{f="img-unsupported";var b={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(i,b),(g=this.parseErrorString(t,b)).header||(g.header="warning"===u?o.Z.t("header-warning"):""),r.AlertBox.displayError(e,g.msg,g.header,f,g.hints,t)}}},l.reportErrors=function(e,t){if(l.currentError=null,l.currentErrors=null,t){l.currentErrors=[e,t];for(var i={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},s=[],a=0;a<t.length;a++)if(t[a].code){this.parseArguments(t[a].message,i);var h=this.parseErrorString(t[a].code,i);h.header||(h.header="warning"===t[0].type?o.Z.t("header-warning",{defaultValue:"Warning"}):""),s.push(h);var c={category:"error",code:t[a].code,message:t[a].message};n.logger.track(c,!0)}if(s.length){r.AlertBox.displayErrors(e,"img-unsupported",s)}}},l.parseArguments=function(e,t){if(e)if("string"==typeof e)t.defaultValue=e;else{t.defaultValue=e[0];for(var i=1;i<e.length;i++){t[(i-1).toString()]=e[i]}}},l.parseErrorString=function(e,t){var i={msg:null,msgList:null,header:null,hints:null};if(!e)return i;if("object"==typeof t.defaultValue){var r=t.defaultValue;return i.header=r.title,i.msg=r.message,i.hints=r.hints.concat(),i}var n=o.Z.t(e,t);if(!n)return i;if(-1!=n.indexOf("<title>")){var s=n.split("<title>")[1].split("</title>");i.header=s[0],n=s[1]}if(n&&-1!=n.indexOf("<message>")){s=n.split("<message>")[1].split("</message>");i.msg=s[0],n=s[1]}else i.msg=n;if(n&&-1!=n.indexOf("<hint>")){i.hints=[];for(var a=n.split("<hint>"),l=0;l<a.length;l++){var h=a[l].split("</hint")[0];i.hints.push(h)}}return i},l.localize=function(){if(r.AlertBox.instances.length>0)if(r.AlertBox.dismiss(),l.currentError){var e=l.currentError.shift(),t=l.currentError;l.reportError(e,t[0],t[1],t[2])}else{e=l.currentErrors.shift();var i=l.currentErrors[0];l.reportErrors(e,i)}},l.dismissError=function(e){return r.AlertBox.dismissByTag(e)}},72067:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GuiViewer3D:()=>P});var r=i(18878),n=i(64141),o=i(90625),s=i(7247),a=i(22599),l=i(26725),h=i(91493),c=i(58164),u=i(27156),d=i(60489),p=i(61599),f=i(54923),m=i(32800),g=i(25320),v=i(91629),y=i(61574),b=i(49547),x=i(83355),_=i(49378),E=i(51370),A=i(3109),S=i(53805),w=i(60503);function M(e,t){null!=t&&t.globalManager&&this.setGlobalManager(t.globalManager),w.ToolBar.call(this,e,t),this.onToolbarUpdated=(null==t?void 0:t.onToolbarUpdated)||function(){},this.screenModeDelegate=null==t?void 0:t.screenModeDelegate,this.navigation=null==t?void 0:t.navigation,this.onClickViewerOption=(null==t?void 0:t.onClickViewerOption)||function(){},this.onClickRenderOptions=(null==t?void 0:t.onClickRenderOptions)||function(){},this.onClickFullScreen=(null==t?void 0:t.onClickFullScreen)||function(){},this.navTools=new S.RadioButtonGroup(y.TOOLBAR.NAVTOOLSID),this.modelTools=new g.ControlGroup(y.TOOLBAR.MODELTOOLSID),this.settingsTools=new g.ControlGroup(y.TOOLBAR.SETTINGSTOOLSID),this.addControl(this.navTools),this.addControl(this.modelTools),this.addControl(this.settingsTools)}i(76542).GlobalManagerMixin.call(M.prototype),M.prototype=Object.create(w.ToolBar.prototype),M.prototype.constructor=M,M.prototype.initRenderOptionsButton=function(){this.settingsTools&&!this.renderOptionsButton&&(this.renderOptionsButton=new m.Button("toolbar-renderOptionsTool"),this.renderOptionsButton.setToolTip("Rendering options"),this.renderOptionsButton.setIcon("adsk-icon-settings-render"),this.renderOptionsButton.onClick=this.onClickRenderOptions,this.settingsTools.addControl(this.renderOptionsButton))},M.prototype.initSettingsOptionsButton=function(){var e=new m.Button("toolbar-settingsTool");this.viewerOptionButton=e,e.setIcon("adsk-icon-settings"),e.setToolTip("Settings"),this.viewerOptionButton.onClick=this.onClickViewerOption,this.settingsTools.addControl(e)},M.prototype.initModelTools=function(){if(!this.settingsTools.fullscreenbutton){var e=new m.Button("toolbar-fullscreenTool",{collapsible:!1});e.setToolTip("Full screen"),e.setIcon("adsk-icon-fullscreen"),e.onClick=this.onClickFullScreen,this.settingsTools.addControl(e),this.settingsTools.fullscreenbutton=e,this.updateFullscreenButton(this.screenModeDelegate.getMode())}},M.prototype.updateFullscreenButton=function(e){var t="adsk-icon-fullscreen";switch(e){case A.ScreenMode.kNormal:this.screenModeDelegate.isModeSupported(A.ScreenMode.kFullBrowser)||(t="adsk-icon-fullscreen");break;case A.ScreenMode.kFullBrowser:t=this.screenModeDelegate.isModeSupported(A.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case A.ScreenMode.kFullScreen:t="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(t)},M.prototype.updateToolbarButtons=function(e,t){var i,r,n;n=e>310,(r=this.modelTools.getControl("toolbar-explodeTool"))&&r.setVisible(n),n=e>380?"block":"none",(r=this.modelTools.getControl("toolbar-collaborateTool"))&&r.setDisplay(n),n=e>515?"block":"none";var o=this.navTools.getControl("toolbar-cameraSubmenuTool");o&&(o.setDisplay(n),(r=o.subMenu.getControl("toolbar-homeTool"))&&r.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(r=o.subMenu.getControl("toolbar-fitToViewTool"))&&r.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(r=o.subMenu.getControl("toolbar-focalLengthTool"))&&r.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(r=o.subMenu.getControl("toolbar-rollTool"))&&r.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),n=e>700?"block":"none",(r=this.modelTools.getControl("toolbar-measureTool"))&&r.setDisplay(n),(r=this.modelTools.getControl("toolbar-sectionTool"))&&r.setDisplay(n),n=e>740?"block":"none",(r=this.navTools.getControl("toolbar-beelineTool"))&&r.setDisplay(this.navigation.isActionEnabled("walk")?n:"none"),(r=this.navTools.getControl("toolbar-firstPersonTool"))&&r.setDisplay(this.navigation.isActionEnabled("walk")?n:"none"),(r=this.navTools.getControl("toolbar-zoomTool"))&&r.setDisplay(this.navigation.isActionEnabled("zoom")?n:"none"),(r=this.navTools.getControl("toolbar-panTool"))&&r.setDisplay(this.navigation.isActionEnabled("pan")?n:"none"),(r=this.navTools.getControl("toolbar-orbitTools"))&&r.setDisplay(this.navigation.isActionEnabled("orbit")?n:"none"),null===(i=this.onToolbarUpdated)||void 0===i||i.call(this,e,t)},M.prototype.registerCustomizeToolbarCB=function(e){this.onToolbarUpdated=e};var T=i(95277),C=i(77876);function P(e,t){t||(t={}),t.startOnInitialize=!1,o.Viewer3D.call(this,e,t),this.toolbar=null,this.dockingPanels=[],this.onFullScreenModeEvent=this.onFullScreenModeEvent.bind(this),this.onProgressBarUpdate=this.onProgressBarUpdate.bind(this),this.progressInModelLoad=!1}P.prototype=Object.create(o.Viewer3D.prototype),P.prototype.constructor=P,P.prototype.initialize=function(e){var t=o.Viewer3D.prototype.initialize.call(this,e);if(t>0)return v.ErrorHandler.reportError(this.container,t),t;var i=this;if(this.toolController){var n=new p.HotGestureTool(this);this.toolController.registerTool(n),this.toolController.activateTool(n.getName())}return this.addEventListener(r.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new x.ProgressBar(this.container),this.addEventListener(r.PROGRESS_UPDATE_EVENT,this.onProgressBarUpdate),this.addEventListener(r.VIEWER_RESIZE_EVENT,(function(e){var t;i.resizePanels(),null===(t=i.toolbar)||void 0===t||t.updateToolbarButtons(e.width,e.height)})),this.addEventListener(r.NAVIGATION_MODE_CHANGED_EVENT,(function(){var e;null===(e=i.toolbar)||void 0===e||e.updateToolbarButtons(i.container.clientWidth,i.container.clientHeight)})),this.initEscapeHandlers(),this.localize(),this.addEventListener(r.WEBGL_CONTEXT_LOST_EVENT,function(){for(var e=this.container,t=e.childElementCount,i=0;i<t;++i)e.children[i].classList.add("hide-while-context-lost");v.ErrorHandler.reportError(this.container,a.ErrorCodes.WEBGL_LOST_CONTEXT)}.bind(this)),this.addEventListener(r.WEBGL_CONTEXT_RESTORED_EVENT,function(){for(var e=this.container,t=e.childElementCount,i=0;i<t;++i)e.children[i].classList.remove("hide-while-context-lost");v.ErrorHandler.dismissError(a.ErrorCodes.WEBGL_CONTEXT_LOST_EVENT)}.bind(this)),this.run(),0},P.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),this.removeEventListener(r.FULLSCREEN_MODE_EVENT,this.onFullScreenModeEvent),this.removeEventListener(r.PROGRESS_UPDATE_EVENT,this.onProgressBarUpdate),this.progressbar=null,this.debugMenu=null,this.modelStats=null,this.toolbar=null,o.Viewer3D.prototype.uninitialize.call(this)},P.prototype.setUp=function(e){e||(e={}),e.startOnInitialize=!1,o.Viewer3D.prototype.setUp.call(this,e)},P.prototype.tearDown=function(e){o.Viewer3D.prototype.tearDown.call(this,e),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.debugMenu=null,this.removeEventListener(r.GEOMETRY_LOADED_EVENT,this.checkGeometry),this.checkGeometry=null},P.prototype.onPostExtensionLoad=function(e){var t,i=this.getToolbar();i&&e.onToolbarCreated&&e.onToolbarCreated(i),null===(t=this.toolbar)||void 0===t||t.updateToolbarButtons(this.container.clientWidth,this.container.clientHeight)},P.prototype.loadModel=function(e,t,i,r,n){var s=this;t={...t,addViews:function(e,t){var i,r;let n=null===(i=t.getDocumentNode())||void 0===i?void 0:i.getNamedViews();function o(e,t,i){if(e.children)for(let t=e.children.length-1;t>=0;t--)o(e.children[t],e,t);else{let r=n.find((t=>t.data.name==e.name));r&&(r.data.isViewpoint=!0,r.data.entry=e.entry,t.children.splice(i,1))}}if(n){var s;let t=null===(s=e.children)||void 0===s?void 0:s.length;for(;t--;)o(e.children[t],e,t)}let a=null===(r=t.getDocumentNode())||void 0===r?void 0:r.getRootNode();if(a){const t=new Autodesk.Viewing.BubbleNode(e);t.parent=a.children[0],a.children[0].children.push(t)}}};var l=o.Viewer3D.prototype.loadModel.call(this,e,t,(function(e){setTimeout((function(){t&&(t.loadAsHidden||t.headlessViewer)||function(e){s.running?s.createUI(e):d.logger.error("createUI expects the viewer to be running.",(0,a.errorCodeString)(a.ErrorCodes.VIEWER_INTERNAL_ERROR))}(e),i&&i.call(i,e)}),0)}),(function(e){e!==a.ErrorCodes.LOAD_CANCELED?v.ErrorHandler.reportError(s.container,e):d.logger.warn("A load was canceled"),r&&r.apply(r,arguments)}),n);return l},P.prototype.createUI=function(e,t){if(this.model!==e&&!t)return;var i=this;const n=this._createToolbar();this.checkGeometry=function(e){setTimeout((function(){if(i.impl&&!i.impl.is2d&&e.model&&!e.model.hasGeometry()){var t=a.ErrorCodes.BAD_DATA_MODEL_IS_EMPTY;v.ErrorHandler.reportError(i.container,t,"Model is empty"),i._loadingSpinner.hide()}}),0)};var o=this.config.disabledExtensions||{};const l=e=>-1===(this.profile&&this.profile.extensions.unload?this.profile.extensions.unload:[]).indexOf(e);this.initModelTools(e),(0,s.getGlobal)().ENABLE_DEBUG&&this.initDebugTools(),"true"===(0,u.getParameterByName)("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config);var h=function(e){i.getExtension(e)&&i.unloadExtension(e)};e.is2d()&&(h("Autodesk.BimWalk"),h("Autodesk.Section"),h("Autodesk.Viewing.FusionOrbit"),h("Autodesk.Explode")),o.measure||h("Autodesk.Measure"),n&&(this.dispatchEvent({type:y.TOOLBAR_CREATED_EVENT}),this.forEachExtension((e=>{e.onToolbarCreated&&e.onToolbarCreated(this.toolbar)})));var c="Autodesk.DefaultTools.NavTools",d=this.getExtension(c);d?d.updateUI(e.is3d()):this.loadExtension(c,i.config),this.resize(),e.is2d()?(this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),setTimeout((function(){if(!i.impl)return;const e={viewcube:"Autodesk.ViewCubeUi",measure:"Autodesk.Measure",hyperlink:"Autodesk.Hyperlink",layerManager:"Autodesk.LayerManager",propertiesPanel:"Autodesk.PropertiesManager"};(0,s.isMobileDevice)()||(e.boxSelection="Autodesk.BoxSelection");for(let t in e){const r=e[t];!o[t]&&l(r)&&i.loadExtension(r,i.config)}}),0)):(-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),setTimeout((function(){if(!i.impl)return;const e={viewcube:"Autodesk.ViewCubeUi",explode:"Autodesk.Explode",bimwalk:"Autodesk.BimWalk",fusionOrbit:"Autodesk.Viewing.FusionOrbit",measure:"Autodesk.Measure",section:"Autodesk.Section",layerManager:"Autodesk.LayerManager",modelBrowser:"Autodesk.ModelStructure",propertiesPanel:"Autodesk.PropertiesManager"};(0,s.isMobileDevice)()||(e.boxSelection="Autodesk.BoxSelection");for(let t in e){const r=e[t];!o[t]&&l(r)&&i.loadExtension(r,i.config)}!o.scalarisSimulation&&l("Autodesk.Viewing.ScalarisSimulation")&&i.model&&i.model.isScalaris&&i.loadExtension("Autodesk.Viewing.ScalarisSimulation",i.config)}),0),e.isLoadDone()?this.checkGeometry({model:e}):this.addEventListener(r.GEOMETRY_LOADED_EVENT,this.checkGeometry,{once:!0}))},P.prototype.onFullScreenModeEvent=function(e){this.resizePanels(),this.toolbar.updateFullscreenButton(e.mode)},P.prototype.onProgressBarUpdate=function(e){if(e.state==C.ProgressState.ROOT_LOADED||e.state==C.ProgressState.LOADING)this.progressInModelLoad=e.percent<100;else if(this.progressInModelLoad)return;e.percent>=0&&this.progressbar.setPercent(e.percent)},P.prototype.addOptionToggle=function(e,t,i,r,n){var o=n?this.prefs[n]:null;i="boolean"==typeof o?o:i;let a=this.getDocument();var l=a.createElement("li");l.className="toolbar-submenu-listitem";var c=a.createElement("input");c.className="toolbar-submenu-checkbox",c.type="checkbox",c.id=t,l.appendChild(c);var u=a.createElement("label");return u.setAttribute("for",t),u.setAttribute("data-i18n",t),u.textContent=h.Z.t(t),l.appendChild(u),e.appendChild(l),c.checked=i,c.addEventListener("touchstart",s.touchStartToClick),u.addEventListener("touchstart",s.touchStartToClick),l.addEventListener("touchstart",s.touchStartToClick),c.addEventListener("click",(function(e){r(c.checked),e.stopPropagation()})),u.addEventListener("click",(function(e){e.stopPropagation()})),l.addEventListener("click",(function(e){r(!c.checked),e.stopPropagation()})),n&&this.prefs.addListeners(n,(function(e){c.checked=e}),(function(e){c.checked=e,r(e)})),c},P.prototype.addOptionList=function(e,t,i,r,n,o){var s=this.prefs[o];r="number"==typeof s?s:r;let a=this.getDocument();var l=a.createElement("select");l.className="option-drop-down",l.id="selectMenu_"+t;for(var c=0;c<i.length;c++){var u=a.createElement("option");u.value=c,u.setAttribute("data-i18n",i[c]),u.textContent=h.Z.t(i[c]),l.add(u)}var d=a.createElement("li");d.className="toolbar-submenu-select";var p=a.createElement("div");return p.className="toolbar-submenu-selectlabel",p.setAttribute("for",t),p.setAttribute("data-i18n",t),p.textContent=h.Z.t(t),d.appendChild(p),d.appendChild(l),e.appendChild(d),l.selectedIndex=r,l.onchange=function(e){var t=e.target.selectedIndex;n(t),e.stopPropagation()},l.addEventListener("touchstart",(function(e){e.stopPropagation()})),l.addEventListener("click",(function(e){e.stopPropagation()})),o&&this.prefs.addListeners(o,(function(e){l.selectedIndex=e}),(function(e){l.selectedIndex=e,n(e)})),l},P.prototype.showViewer3dOptions=function(e){var t=this.getSettingsPanel(!0);e&&t.isVisible()&&t.setVisible(!1),t.setVisible(e)},P.prototype.showRenderingOptions=function(e){e&&this._createRenderingOptionsPanel(),this.renderoptions&&this.renderoptions.setVisible(e)},P.prototype._createRenderingOptionsPanel=function(){this.renderoptions||this.model.is2d()||(this.renderoptions=new _.RenderOptionsPanel(this),this.addPanel(this.renderoptions),this.toolbar.initRenderOptionsButton())},P.prototype.showLayerManager=function(){d.logger.warn('viewer.showLayerManager() is now handled the extension "Autodesk.LayerManager" and will be removed in version 8.0.0.')},P.prototype.initHotkeys=function(){d.logger.warn("viewer.initHotkeys() has been deprecated and will be removed in version 8.0.0.")},P.prototype.setModelStructurePanel=function(e){d.logger.warn('viewer.setModelStructurePanel() is deprecated and will be removed in v8.0.0 - Use extension "Autodesk.ModelStructure".');var t=this.getExtension("Autodesk.ModelStructure");return!!t&&t.setModelStructurePanel(e)},P.prototype.setLayersPanel=function(){d.logger.warn('viewer.setLayersPanel() is now handled the extension "Autodesk.LayerManager" and will be removed in version 8.0.0.')},P.prototype.setPropertyPanel=function(e){d.logger.warn('viewer.setPropertyPanel() is now handled by extension "Autodesk.PropertiesManager" and will be removed in version 8.0.0.');var t=this.getExtension("Autodesk.PropertiesManager");return!!t&&t.setPanel(e)},P.prototype.getPropertyPanel=function(e){d.logger.warn('viewer.getPropertyPanel() is now handled the extension "Autodesk.PropertiesManager" and will be removed in version 8.0.0.');var t=this.getExtension("Autodesk.PropertiesManager");return!t&&e&&(this.loadExtension("Autodesk.PropertiesManager"),t=this.getExtension("Autodesk.PropertiesManager")),t?t.getPanel():null},P.prototype.setSettingsPanel=function(e){var t=this;return(e instanceof E.SettingsPanel||!e)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=e,e&&(this.addPanel(e),e.addVisibilityListener((function(i){var r;i&&t.onPanelVisible(e,t),null===(r=t.toolbar)||void 0===r||r.viewerOptionButton.setState(i?m.Button.State.ACTIVE:m.Button.State.INACTIVE)}))),!0)},P.prototype.getSettingsPanel=function(e,t){return!this.viewerSettingsPanel&&e&&this.createSettingsPanel(t||this.model),this.viewerSettingsPanel},P.prototype.createSettingsPanel=function(e){var t=new T.ViewerSettingsPanel(this,e);this.setSettingsPanel(t),t.syncUI(),this.toolbar.initSettingsOptionsButton(),this.dispatchEvent({type:y.SETTINGS_PANEL_CREATED_EVENT})},P.prototype.initModelTools=function(e){this.createSettingsPanel(e),(0,s.getGlobal)().ENABLE_DEBUG&&this._createRenderingOptionsPanel(),this.canChangeScreenMode()&&(0,s.isFullscreenEnabled)(this.getDocument())&&(this.toolbar.initModelTools(),this.toolbar.updateFullscreenButton(this.getScreenMode()))},P.prototype.setPropertiesOnSelect=function(e){d.logger.warn('viewer.setPropertiesOnSelect() is now handled by viewer.prefs.set("openPropertiesOnSelect", <boolean>) and will be removed in version 8.0.0.'),this.prefs.set(n.Prefs.OPEN_PROPERTIES_ON_SELECT,e)},P.prototype.addDivider=function(e){var t=this.getDocument().createElement("li");return t.className="toolbar-submenu-horizontal-divider",e.appendChild(t),t},P.prototype.initDebugTools=function(){if(this.debugMenu)return!1;var e=new g.ControlGroup("debugTools");this.debugMenu=e;var t=new m.Button("toolbar-debugTool");return t.setIcon("adsk-icon-bug"),e.addControl(t),this.debugMenu.debugSubMenuButton=t,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(e),!0},P.prototype.removeDebugTools=function(){this.debugMenu&&(this.debugMenu.removeFromParent(),this.debugMenu=null)},P.prototype.createDebugSubmenu=function(e){var t=this,i=this.getDocument().createElement("div");i.id="toolbar-debugToolSubmenu",i.classList.add("toolbar-submenu"),i.classList.add("toolbar-settings-sub-menu"),i.classList.add("adsk-hidden"),this.debugMenu.subMenu=i,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(i),this.initModelStats(),this.addDivider(i),this.addDivider(i);var r=c.Lang.getLanguages(),n=r.map((function(e){return e.label})),o=r.map((function(e){return e.symbol}));function a(){t.localize()}var h=t.selectedLanguage?t.selectedLanguage:0;this.addOptionList(i,"Language",n,h,(function(e){var i=o[e];t.selectedLanguage=e,(0,l.setLanguage)(i,a)}),null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);this.addOptionList(i,"Error",["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"],0,(function(e){var i=e+1;v.ErrorHandler.reportError(t.container,i,"")}),null).parentNode.style.paddingBottom="15px";var u=i.getBoundingClientRect();this.debugMenu.subMenu.style.width=u.width+"px",this.container.removeChild(i),e.container.appendChild(i);var d=u.left+u.width,p=this.container.getBoundingClientRect().right;if(d>p){var f=-(d-p+10)+"px";this.debugMenu.subMenu.style.left=f}e.onMouseOver=function(){i.classList.remove("adsk-hidden")},e.onMouseOut=function(){i.classList.add("adsk-hidden")},(0,s.isTouchDevice)()&&(e.onClick=function(){i.classList.toggle("adsk-hidden")})},P.prototype.initModelStats=function(){var e=this;function t(t){var i=e.impl,r="";e.model&&(r+="Geom&nbsp;polys:&nbsp;"+i.modelQueue().getGeometryList().geomPolyCount+"<br>",r+="Instance&nbsp;polys:&nbsp;"+i.modelQueue().getGeometryList().instancePolyCount+"<br>",r+="Fragments:&nbsp;"+i.modelQueue().getFragmentList().getCount()+"<br>",r+="Geoms:&nbsp;"+i.modelQueue().getGeometryList().getCount()+"<br>",r+="Loading&nbsp;time:&nbsp;"+(i.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),r+="# "+(t||""),e.modelStats.innerHTML=r}this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,(function(i){i&&!e.modelStats&&(!function(){let i=e.getDocument();e.modelStats=i.createElement("div"),e.modelStats.className="statspanel",e.container.appendChild(e.modelStats),e.addEventListener(r.PROGRESS_UPDATE_EVENT,(function(e){e.message&&t(e.message)})),e.fpsDisplay=i.createElement("div"),e.fpsDisplay.className="fps",e.container.appendChild(e.fpsDisplay)}(),t("")),e.modelStats.style.visibility=i?"visible":"hidden",e.fpsDisplay.style.visibility=i?"visible":"hidden",e.impl.fpsCallback=i?function(t){e.fpsDisplay.textContent=""+(0|t)}:null}))},P.prototype.initEscapeHandlers=function(){var e=this;this.addEventListener(r.ESCAPE_EVENT,(function(){if(!e.contextMenu||!e.contextMenu.hide())if(e.renderoptions&&e.renderoptions.isVisible())e.renderoptions.setVisible(!1);else if(e.impl.selector.hasSelection())e.clearSelection();else{if(e.getActiveNavigationTool()!==e.getDefaultNavigationToolName())return e.toolController&&e.toolController.setIsLocked(!1),e.setActiveNavigationTool(),void b.HudMessage.dismiss();if(e.areAllVisible()){if(!f.AlertBox.dismiss()){for(var t=0;t<e.dockingPanels.length;++t){var i=e.dockingPanels[t];if("none"!==i.container.style.display&&""!==i.container.style.display)return void i.setVisible(!1)}e.escapeScreenMode()}}else e.showAll()}}))},P.prototype.getToolbar=function(){return this.toolbar},P.prototype._createToolbar=function(){if(this.toolbar)return!1;const e=this;if(this.toolbar=new M("guiviewer3d-toolbar",{globalManager:this.globalManager,navigation:this.navigation,screenModeDelegate:this.getScreenModeDelegate(),onClickFullScreen:e.nextScreenMode.bind(e),onClickRenderOptions:()=>{var e=this.renderoptions&&this.renderoptions.isVisible();this.renderoptions.setVisible(!e)},onClickViewerOption:()=>{e.getSettingsPanel(!0).isVisible()?e.showViewer3dOptions(!1):e.showViewer3dOptions(!0)}}),this._forgeLogo){const e=this._forgeLogo.getBoundingClientRect();this.toolbar.container.style.bottom=`${e.height+10}px`}return this.container.appendChild(this.toolbar.container),this.toolbar.updateToolbarButtons(this.container.clientWidth,this.container.clientHeight,this.navigation),!0},P.prototype.showModelStructurePanel=function(e){d.logger.warn('viewer.showModelStructurePanel() is deprecated and will be removed in v8.0.0 - Use extension "Autodesk.ModelStructure".'),e?this.activateExtension("Autodesk.ModelStructure"):this.deactivateExtension("Autodesk.ModelStructure")},P.prototype.onPanelVisible=function(e){this.dockingPanels.splice(this.dockingPanels.indexOf(e),1),this.dockingPanels.splice(0,0,e)},P.prototype.localize=function(){o.Viewer3D.prototype.localize.call(this),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),v.ErrorHandler.localize()},P.prototype.addPanel=function(e){return-1===this.dockingPanels.indexOf(e)&&(this.dockingPanels.push(e),!0)},P.prototype.removePanel=function(e){var t=this.dockingPanels.indexOf(e);return t>-1&&(this.dockingPanels.splice(t,1),!0)},P.prototype.resizePanels=function(e){e=e||{};var t=this.toolbar?this.toolbar.getDimensions().height:0,i=this.getDimensions(),r=i.height;e.dimensions&&e.dimensions.height?r=e.dimensions.height:e.dimensions={height:i.height,width:i.width},e.dimensions.height=r-t;var n=e?e.dockingPanels:null;n||(n=this.dockingPanels);var o,s,a=this.container.getBoundingClientRect(),l=a.top,h=a.bottom,c=a.left,u=a.right;e&&e.dimensions?(o=e.dimensions.width,h=l+(s=e.dimensions.height)):(o=a.width,s=a.height);for(var d=0;d<n.length;++d)n[d].onViewerResize(l,h,c,u,o,s)},P.prototype.initExplodeSlider=function(){d.logger.warn('viewer.initExplodeSlider() has been replaced by extension "Autodesk.Explode". initExplodeSlier() will be removed in version 7.0.0.')},P.prototype.registerCustomizeToolbarCB=function(e){var t,i;null===(t=this.toolbar)||void 0===t||t.registerCustomizeToolbarCB(e.bind(null,this)),null===(i=this.toolbar)||void 0===i||i.updateToolbarButtons(this.container.clientWidth,this.container.clientHeight)},Object.defineProperty(P.prototype,"navTools",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.navTools}}),Object.defineProperty(P.prototype,"modelTools",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.modelTools}}),Object.defineProperty(P.prototype,"settingsTools",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.settingsTools}}),Object.defineProperty(P.prototype,"updateFullscreenButton",{get(){var e;return null===(e=this.toolbar)||void 0===e?void 0:e.updateFullscreenButton.bind(this)}}),Autodesk.Viewing.Private.GuiViewer3D=P},61574:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SETTINGS_PANEL_CREATED_EVENT:()=>n,TOOLBAR:()=>s,TOOLBAR_CREATED_EVENT:()=>r,VIEW_CUBE_CREATED_EVENT:()=>o});const r="toolbarCreated",n="settingsPanelCreated",o="viewCubeCreated",s={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools",MEASURETOOLSID:"measureTools"}},49547:(e,t,i)=>{"use strict";i.r(t),i.d(t,{HudMessage:()=>n});var r=i(91493);function n(){}n.instances=[],n.displayMessage=function(e,t,i,o,s){let a=e.ownerDocument,l=a.defaultView||a.parentWindow;function h(e){var t=l.getComputedStyle(e),i=parseInt(t["margin-top"]),r=parseInt(t["margin-bottom"]);return e.getBoundingClientRect().height+i+r}function c(e,t,i){var r=l.getComputedStyle(e,null);if(!Array.isArray(t))return r[t];for(var n=i||{},o=0;o<t.length;o++){var s=t[o];n[s]=r[s]}return n}if(!(n.instances.length>0)){var u=t.msgTitleKey,d=t.msgTitleDefaultValue||u,p=t.messageKey,f=t.messageDefaultValue||p,m=t.buttonText,g=t.checkboxChecked||!1,v=t.position||"center",y=a.createElement("div");if(y.classList.add("docking-panel"),y.classList.add("hud"),"top"===v&&y.classList.add("top"),e.appendChild(y),u){var b,x=a.createElement("div");x.classList.add("docking-panel-title"),x.classList.add("docking-panel-delimiter-shadow"),x.textContent=r.Z.t(u,{defaultValue:d}),x.setAttribute("data-i18n",u),y.appendChild(x),i&&((b=a.createElement("div")).classList.add("docking-panel-close"),b.addEventListener("click",(function(e){n.dismiss(),i&&i(e)})),y.appendChild(b));var _=c(x,["width","font-size"]),E=function(e){var t=e.textContent,i=a.createElement("span");c(e,["font-size","font-weight","text-transform","padding","white-space","font-family"],i.style),i.textContent=t,i.style.position="absolute",i.style.top="10000px",i.style.left="-10000px",a.body.appendChild(i);var r=i.offsetWidth;return a.body.removeChild(i),r}(x),A=parseFloat(_["font-size"]),S=b?parseFloat(c(b,"width")):0,w=parseFloat(_.width)-S;x.style["font-size"]=E>w?w/E*A+"px":`${A}px`}var M=a.createElement("div");M.classList.add("hud-client"),M.classList.add("docking-panel-container-solid-color-b"),y.appendChild(M);var T=a.createElement("div");T.className="hud-message",T.textContent=r.Z.t(p,{defaultValue:f}),T.setAttribute("data-i18n",f),M.appendChild(T);var C=h(T);if(o){var P=a.createElement("div");P.classList.add("docking-panel-primary-button"),P.classList.add("hud-button"),P.textContent=r.Z.t(m,{defaultValue:m}),P.setAttribute("data-i18n",m),P.addEventListener("click",o),M.appendChild(P),C+=h(P)}if(s){var D=a.createElement("div"),L=a.createElement("input");L.className="hud-checkbox",L.type="checkbox",L.checked=g,D.appendChild(L);var I="Do not show this message again",R=a.createElement("label");R.setAttribute("for",I),R.setAttribute("data-i18n",I),R.textContent=r.Z.t(I,{defaultValue:I}),D.appendChild(R),L.addEventListener("change",s),M.appendChild(D),C+=h(s)}M.style.height=C+"px",y.style.height=C+(x?h(x):0)+"px";var O={hudMessage:y,container:e};n.instances.push(O)}},n.dismiss=function(){if(n.instances.length>0){var e=n.instances.pop();return e.hudMessage.style.visibility="hidden",e.container.removeChild(e.hudMessage),!0}return!1}},36261:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LoadingSpinner:()=>n});var r=i(91493);function n(e){this.parentDiv=e;var t=this.getDocument();this.container=t.createElement("div"),this.container.innerHTML=['<div class="path">','<svg width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<path d="M2.5,50a47.5,47.5 0 1,0 95,0a47.5,47.5 0 1,0 -95,0" vector-effect="non-scaling-stroke"/>','<path d="M 2.5 50 A 47.5 47.5 0 0 1 47.5 2.5" vector-effect="non-scaling-stroke"/>',"</svg>","</div>",'<div class="message" data-i18n="Spinner Loading">LOADING</div>'].join(""),this.container.className="loading-spinner"}i(76542).GlobalManagerMixin.call(n.prototype),n.prototype.addClass=function(e){this.container.classList.add(e)},n.prototype.attachToDom=function(){return!this.container.parentNode&&(r.Z.localize(this.container),this.parentDiv.appendChild(this.container),!0)},n.prototype.removeFromDom=function(){return!!this.container.parentNode&&(this.container.parentNode.removeChild(this.container),!0)},n.prototype.setVisible=function(e){e?this.attachToDom():this.removeFromDom()}},89461:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelStructurePanel:()=>f});var r=i(90650),n=i(29677),o=i(30210),s=i(60489),a=i(27156),l=i(91493),h=-1,c=-2;const u=-1e10;function d(e,t){o.TreeDelegate.call(this),this.panel=e,this.model=t;let i=this.getDocument();this.modelDiv=i.createElement("div"),this.modelDiv.classList.add("model-div"),this.modelDiv.setAttribute("lmv-modelId",t.id),this.instanceTree=null,this.rootId=h,this.state=1}function p(e){var t=function(e){var t=e.getData();if(t&&t.loadOptions&&t.loadOptions.modelNameOverride)return t.loadOptions.modelNameOverride;return""}(e);if(t)return t;if(!e.getData())return"";var i=e.getDocumentNode();return i?i.getModelName():"Model"}function f(e,t,i,n){r.DockingPanel.call(this,e,t,i,n),this.container.classList.add("model-structure-panel"),(n=n||{}).heightAdjustment||(n.heightAdjustment=40),n.marginTop||(n.marginTop=0),n.left=!0,this.createScrollContainer(n),this.onScroll=this.onScroll.bind(this),this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.style["overflow-x"]="hidden",this.options=n,this.tree=null,this._pendingModels=[],this.uiCreated=!1;var o=this;this.addVisibilityListener((function(e){e&&(o.uiCreated||o.createUI(),o.resizeToContent())}))}d.prototype=Object.create(o.TreeDelegate.prototype),d.prototype.constructor=d,d.prototype.isLoading=function(){return 1===this.state},d.prototype.isAvailable=function(){return 2===this.state},d.prototype.isNotAvailable=function(){return 3===this.state},d.prototype.isControlId=function(e){return e===h||e===c},d.prototype.getControlIdCss=function(e){return null},d.prototype.getRootId=function(){return this.rootId},d.prototype.getTreeNodeId=function(e){return"object"==typeof e?(s.logger.warn("Object used instead of dbId. Fix it."),e.dbId):e},d.prototype.getTreeNodeIndex=function(e){return this.instanceTree.nodeAccess.dbIdToIndex[e]},d.prototype.getTreeNodeLabel=function(e){if(e===h){var t=p(this.model);return l.Z.t("Loading model",{name:t})}return e===c||e===this.getRootId()?t=p(this.model):e==u?"Object 0":this.instanceTree.getNodeName(e,!0)||"Object "+e},d.prototype.getTreeNodeClass=function(e){return e===h||e===c?"message-unexpected":""},d.prototype.getTreeNodeParentId=function(e){if(e===u)return 0;let t=this.instanceTree.nodeAccess.getParentId(e);return 0===t?u:t},d.prototype.getTreeNodeCount=function(){return this.instanceTree.nodeAccess.getNumNodes()},d.prototype.getTreeNodeClientHeight=function(e){return 36},d.prototype.getTreeNodeDepthOffset=function(e,t){return 13+25*t},d.prototype.isTreeNodeGroup=function(e){return!this.isControlId(e)&&this.instanceTree.getChildCount(e)>0},d.prototype.shouldCreateTreeNode=function(e){return!0},d.prototype.createTreeNode=function(e,t){let i=this,r=i.getDocument();if(t.addEventListener("mousedown",(function(){var e=function(){this.classList.remove("highlight"),i.removeDocumentEventListener("mouseup",e)}.bind(t);t.classList.add("highlight"),i.addDocumentEventListener("mouseup",e)})),!this.isControlId(e)){var n=r.createElement("div");n.dbId=e,n.classList.add("visibility"),n.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopPropagation()})),n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(e.target.dbId);this.panel.onEyeIcon(t,this.model)}.bind(this)),t.appendChild(n)}if(e===h){var s=r.createElement("img");s.src=(0,a.getResourceUrl)("res/ui/spinner.png"),s.style.animation="loading-spinner-perpetual-motion 1s infinite linear",s.style.float="right",s.style.marginRight="5px",s.style.width="20px",t.appendChild(s)}var l={localize:e===h||e===c};o.TreeDelegate.prototype.createTreeNode.call(this,e,t,l)},d.prototype.onTreeNodeRightClick=function(e,t,i){this.isControlId(t)||this.panel.onTreeNodeRightClick(e,t,this.model,i)},d.prototype.onTreeNodeClick=function(e,t,i){this.isControlId(t)||this.panel.onTreeNodeClick(e,t,this.model,i)},d.prototype.onTreeNodeDoubleClick=function(e,t,i){},d.prototype.onTreeNodeIconClick=function(e,t,i){if(this.isTreeNodeGroup(t)){var r=e.isCollapsed(this,t);e.setCollapsed(this,t,!r)}},d.prototype.onTreeNodeReized=function(e){},d.prototype.forEachChild=function(e,t,i){this.isControlId(e)||this.instanceTree.enumNodeChildren(e,t,i)},d.prototype.setInstanceTree=function(e){this.instanceTree=e,this.state=e?2:3,this.rootId=e?e.getRootId():c,function(e){var t=e.instanceTree;if(!t)return;var i,r=e.rootId,n=t.getNodeName(r),o=0,s=0;t.enumNodeChildren(r,(function(e){s||(i=t.getNodeName(e),o=e),s++})),e.hasDoubleRoot=1===s&&n===i,e.rootId=e.hasDoubleRoot?o:r}(this)},d.prototype.clean=function(){for(var e,t=this.modelDiv;e=t.lastChild;)t.removeChild(e)},f.prototype=Object.create(r.DockingPanel.prototype),f.prototype.constructor=f,f.prototype.uninitialize=function(){var e;this.scrollContainer.addEventListener("scroll",this.onScroll),this.scrollContainer.parentNode.removeChild(this.scrollContainer),null===(e=this.tree)||void 0===e||e.destroy(),r.DockingPanel.prototype.uninitialize.call(this)},f.prototype.addModel=function(e){if(e)if(this.uiCreated)this.createTreeUI(e);else{if(-1!==this._pendingModels.indexOf(e))return;this._pendingModels.push(e)}},f.prototype.unloadModel=function(e){if(e)if(this.uiCreated)this.removeTreeUI(e);else{var t=this._pendingModels.indexOf(e);if(-1===t)return;this._pendingModels.splice(t,1)}},f.prototype.createUI=function(){if(!this.uiCreated){var e,t="";if(this.options&&this.options.defaultTitle?(t=this.options.defaultTitle,e=void 0===this.options.localizeTitle||!!this.options.localizeTitle):(t=this.modelTitle,e=!1),t||(t="Browser",e=!0),this.setTitle(t,{localizeTitle:e}),this.uiCreated=!0,this.tree=new n.TreeOnDemand(this.scrollContainer,this.options),this.tree.setGlobalManager(this.globalManager),0!==this._pendingModels.length){for(var i=0;i<this._pendingModels.length;++i)this.createTreeUI(this._pendingModels[i]);this._pendingModels=[]}}},f.prototype.createTreeUI=function(e){if(this.tree.getDelegate(e.id))return!1;var t=new d(this,e);t.setGlobalManager(this.globalManager),this.tree.pushDelegate(t);var i=this;return e.getObjectTree((function(e){i.setInstanceTree(t,e)}),(function(){i.setInstanceTree(t,null)})),!0},f.prototype.setInstanceTree=function(e,t){this.tree.setInstanceTree(e,t)},f.prototype.removeTreeUI=function(e){this.tree.removeDelegate(e.id)&&(this.scrollContainer.scrollTop=0,this.onScroll())},f.prototype.onScroll=function(){this.tree.setScroll(this.scrollContainer.scrollTop)},f.prototype.getNodeLabel=function(e){return this.myDelegate.getNodeLabel(e)},f.prototype.onTreeNodeClick=function(){throw new Error("Method must be overriden.")},f.prototype.onTreeNodeRightClick=function(){throw new Error("Method must be overriden.")},f.prototype.onTitleClick=function(){},f.prototype.onTitleDoubleClick=function(){}},47838:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ObjectContextMenu:()=>o});var r=i(36851),n=i(76542);function o(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.contextMenu=new r.ContextMenu(e)}o.prototype.constructor=o,n.GlobalManagerMixin.call(o.prototype),o.prototype.show=function(e){const t=this.viewer.getSelectionCount(),i=this.viewer.getSelectionVisibility(),r=this.viewer.impl.getCanvasBoundingClientRect(),n=r.width,o=r.height,s=e.clientX-r.left,a=e.clientY-r.top,l={event:e,numSelected:t,hasSelected:0<t,hasVisible:i.hasVisible,hasHidden:i.hasHidden,canvasX:s,canvasY:a,normalizedX:s/n*2-1,normalizedY:(o-a)/o*2-1},h=this.buildMenu(e,l);this.viewer.runContextMenuCallbacks(h,l),h&&0<h.length&&this.contextMenu.show(e,h)},o.prototype.hide=function(){return this.contextMenu.hide()},o.prototype.buildMenu=function(){return null}},83355:(e,t,i)=>{"use strict";function r(e){let t=e.ownerDocument;this.bg=t.createElement("div"),this.bg.className="progressbg",this.fg=t.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),e.appendChild(this.bg),this.lastValue=-1,this.fg.style.transform="scale(0, 1)"}i.r(t),i.d(t,{ProgressBar:()=>r}),r.prototype.setPercent=function(e){e!=this.lastValue&&(this.lastValue=e,e>=99?this.bg.style.opacity="0":(this.bg.style.opacity="1",this.fg.style.transform=`scale(${e/100}, 1)`))},r.prototype.setStyle=function(e){!this.fg.classList.contains(e)&&this.fg.classList.add(e)},r.prototype.removeStyle=function(e){this.fg.classList.contains(e)&&this.fg.classList.remove(e)}},36749:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PropertyPanel:()=>h});var r=i(90650),n=i(30210),o=i(11815),s=i(81467),a=i(91493),l=i(56857);function h(e,t,i,s){r.DockingPanel.call(this,e,t,i,s),this.title.classList.add("docking-panel-delimiter-shadow"),this.container.classList.add("property-panel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:70,marginTop:0}),this.highlightableElements={};var a=this;var l=function(){var e=new n.TreeDelegate;function t(e){return"category"===e.type}return e.setGlobalManager(a.globalManager),e.getTreeNodeId=function(e){return e.name+(Object.prototype.hasOwnProperty.call(e,"value")?e.value:"")+(Object.prototype.hasOwnProperty.call(e,"category")?e.category:"")},e.getTreeNodeClass=function(e){return t(e)?a.getCategoryClass(e):a.getPropertyClass(e)},e.isTreeNodeGroup=function(e){return t(e)},e.onTreeNodeClick=function(e,i,r){t(i)?a.onCategoryClick(i,r):a.onPropertyClick(i,r)},e.onTreeNodeRightClick=function(e,i,r){t(i)?a.onCategoryRightClick(i,r):a.onPropertyRightClick(i,r)},e.onTreeNodeDoubleClick=function(e,i,r){t(i)?a.onCategoryDoubleClick(i,r):a.onPropertyDoubleClick(i,r)},e.onTreeNodeIconClick=function(e,i,r){t(i)?a.onCategoryIconClick(i,r):a.onPropertyIconClick(i,r)},e.createTreeNode=function(e,i,r){var n=null;(n=t(e)?a.displayCategory(e,i,r):a.displayProperty(e,i,r))&&(a.highlightableElements[this.getTreeNodeId(e)]=n)},e}();this.tree=new o.Tree(l,null,this.scrollContainer,{}),this.tree.setGlobalManager(this.globalManager)}function c(e){e=String(e);var t=' target="blank" class="propertyLink" ';return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#/%?=~_|()!:,.;]*[a-z0-9-+&@#/%=~_|()]/gim,value:"<a"+t+'href="$&">$&</a>'},{pattern:/(^|[^/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+t+'href="http://$2">$2</a>'}].reduce((function(e,t){return e.replace(t.pattern,t.value)}),e)}h.prototype=Object.create(r.DockingPanel.prototype),h.prototype.constructor=h,h.prototype.setAggregatedProperties=function(e){this.removeAllProperties();const t=Autodesk.Viewing.Private,i=this.viewer.prefs.get(t.Prefs.DISPLAY_UNITS);let r=this.viewer.prefs.get(t.Prefs.DISPLAY_UNITS_PRECISION);const n=Object.prototype.hasOwnProperty.call(e.map,"Name")?e.map.Name.map((e=>e.displayValue)):[];function o(e,t){const n=Number(e);e=isNaN(n)?e:n;var o="number"==typeof r?r:t.precision||(0,s.calculatePrecision)(e),a=(0,s.convertToDisplayUnits)(e,t.type,t.units,i);return(0,s.formatValueWithUnits)(a.displayValue,a.displayUnits,t.type,o)}const h=e.getValue2PropertiesMap("Name");if(h){const e=Object.keys(h);if(1===e.length){const t=e[0],i={name:"aggregate-name"};this.tree.createElement_({name:"Name",value:t,type:"property",category:"",css:i},this.tree.myRootContainer)}else{const e={name:"Name",type:"category",value:"Varies"},t=this.tree.createElement_(e,this.tree.myRootContainer);this.setCategoryCollapsed(e,!0);for(let e in h)this.tree.createElement_({name:e,value:"",type:"property",category:"Name"},t)}}let c=e.getKeysWithCategories().length>0;e.forEach(((t,i)=>{if("Name"===t)return;const r=e.getAggregation(t),s=e.getValue2PropertiesMap(t);if(!r&&!s)return;const h=i[0];if(h.hidden)return;const u=!!h.displayCategory;let d,p="";if(u)p=h.displayCategory,d=this.tree.getElementForNode({name:p}),d=d||this.tree.createElement_({name:p,type:"category"},this.tree.myRootContainer);else if(c){if(p="Other",d=this.tree.getElementForNode({name:p}),!d){let e=p;d=this.tree.createElement_({name:e,type:"category"},this.tree.myRootContainer);const t=d.children[0].children[1];t.setAttribute("data-i18n",e),e=a.Z.t(e),t.textContent=e,t.title=e}}else d=this.tree.myRootContainer;const f=Object.keys(s);if(1===f.length){let e=f[0];return e=(0,l.OY)(i[0].type)?o(Number(e),h):e,void(d=this.tree.createElement_({name:h.displayName,value:e,type:"property",category:p,css:{name:"aggregate-name"}},d))}const m={name:h.displayName,value:"Varies",type:"category",category:p};if(d=this.tree.createElement_(m,d),this.setCategoryCollapsed(m,!0),p=h.displayName,(u||c)&&d.classList.add("indented"),r){const e={};for(let t in r){if("count"===t){e[t]=r[t];continue}if("mode"===t){e[t]=r[t].map((e=>o(e,h))).join(", ");continue}const i=r[t];e[t]=o(i,h)}this.tree.createElement_({map:e,default:"sum",type:"property",category:p},d)}const g=[];for(let e in s){const t=o(e,h),i=s[e];for(let e=0;e<i.length;++e){const t=n.indexOf(i[e]);t>-1&&n.splice(t,1)}g.push({name:i,value:t,type:"property",category:p})}n.length>0&&this.tree.createElement_({name:n,value:"--",type:"property",category:p},d),g.forEach((e=>{this.tree.createElement_(e,d)}))}))},h.prototype.setProperties=function(e){this.removeAllProperties();var t=[],i=[];for(let n=0;n<e.length;n++){let o=e[n];if(!o.hidden){var r=e[n].displayCategory;r&&"string"==typeof r&&""!==r?t.push(o):i.push(o)}}if(t.length+i.length===0)return void this.showNoProperties();i[0]&&"Name"===i[0].displayName&&(this.addProperty(i[0].displayName,i[0].displayValue),i.shift());const n=Autodesk.Viewing.Private,o=this.viewer.prefs.get(n.Prefs.DISPLAY_UNITS);let a=this.viewer.prefs.get(n.Prefs.DISPLAY_UNITS_PRECISION);for(let e=0;e<t.length;e++){let i=t[e],r="number"==typeof a?a:i.precision||(0,s.calculatePrecision)(i.displayValue),n=(0,s.convertToDisplayUnits)(i.displayValue,i.type,i.units,o),l=(0,s.formatValueWithUnits)(n.displayValue,n.displayUnits,i.type,r);this.addProperty(i.displayName,l,i.displayCategory)}for(var l=t.length>0,h=0;h<i.length;h++){let e=i[h],t="number"==typeof a?a:e.precision||(0,s.calculatePrecision)(e.displayValue),r=(0,s.convertToDisplayUnits)(e.displayValue,e.type,e.units,o),n=(0,s.formatValueWithUnits)(r.displayValue,r.displayUnits,e.type,t);this.addProperty(e.displayName,n,l?"Other":"",l?{localizeCategory:!0}:{})}},h.prototype.showNoProperties=function(){this.removeAllProperties();var e=this.tree.myRootContainer,t=this.getDocument().createElement("div");t.className="no-properties";var i="No properties to display";t.setAttribute("data-i18n",i),t.textContent=a.Z.t(i),e.appendChild(t)},h.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},h.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},h.prototype.addProperty=function(e,t,i,r){if(this.tree.getElementForNode({name:e,value:t,category:i}))return!1;var n=null,o={name:e,value:t,type:"property"};return i?((n=this.tree.getElementForNode({name:i}))||(n=this.tree.createElement_({name:i,type:"category"},this.tree.myRootContainer,r&&r.localizeCategory?{localize:!0}:null)),o.category=i):n=this.tree.myRootContainer,this.tree.createElement_(o,n,r&&r.localizeProperty?{localize:!0}:null),!0},h.prototype.hasProperties=function(){for(var e in this.highlightableElements)return!0;return!1},h.prototype.removeProperty=function(e,t,i){var r={name:e,value:t,category:i},n=this.tree.getElementForNode(r);return!!n&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(r)],n.parentNode.removeChild(n),!0)},h.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},h.prototype.setCategoryCollapsed=function(e,t){var i=this.tree.delegate().getTreeNodeId(e);this.tree.setCollapsed(i,t)},h.prototype.isCategoryCollapsed=function(e){var t=this.tree.delegate().getTreeNodeId(e);return this.tree.isCollapsed(t)},h.prototype.getContentSize=function(){var e=this.tree.myRootContainer;return{height:e.clientHeight+55,width:e.clientWidth}},h.prototype.highlight=function(e){function t(t){var i=t.innerHTML,r=i.replace(/(<highlight>|<\/highlight>)/gim,"");if(i!==r&&(t.innerHTML=r),e&&""!==e){var n=new RegExp("(\\b"+e+"\\b)","gim"),o=r.replace(n,"<highlight>$1</highlight>");t.innerHTML=o}}for(var i in this.highlightableElements)for(var r=this.highlightableElements[i],n=0;n<r.length;++n)t(r[n])},h.prototype.displayCategory=function(e,t,i){var r=this.getDocument(),n=r.createElement("div"),o=e.name;i&&i.localize&&(n.setAttribute("data-i18n",o),o=a.Z.t(o)),n.textContent=o,n.title=o,n.className="category-name",t.appendChild(n);const s=[n];if(e.value){var l=r.createElement("div");l.textContent=e.value;var h=e.value;l.title=h,h=c(h),l.innerHTML=h,l.className="category-value",t.appendChild(l),s.push(l)}return s},h.prototype.displayProperty=function(e,t,i){var r,n=this.getDocument(),o=n.createElement("div");if(o.className="separator",e.map){r=n.createElement("select");for(let t in e.map){var s=n.createElement("option");s.value=t,t=t.charAt(0).toUpperCase()+t.slice(1),s.setAttribute("data-i18n",t),s.textContent=a.Z.t(t),r.add(s)}r.value=e.default,e.value=e.map[e.default],r.className="property-drop-down",o.innerText="="}else{r=n.createElement("div");var l=e.name;i&&i.localize&&(r.setAttribute("data-i18n",l),l=a.Z.t(l)),r.textContent=l,r.title=l,r.className="property-name"}var h=n.createElement("div");h.textContent=e.value;var u=e.value;h.title=u,u=c(u),h.innerHTML=u,h.className="property-value",e.map&&r.addEventListener("change",(t=>{const i=t.target.value,r=e.map[i];h.title=r,h.innerHTML=r}),!1);const d=e.css;return d&&(d.name&&r.classList.add(d.name),d.value&&h.classList.add(d.value)),t.appendChild(r),t.appendChild(o),t.appendChild(h),[r,h]},h.prototype.getCategoryClass=function(){return"category"},h.prototype.getPropertyClass=function(){return"property"},h.prototype.onCategoryClick=function(e){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},h.prototype.onPropertyClick=function(){},h.prototype.onCategoryIconClick=function(e){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},h.prototype.onPropertyIconClick=function(){},h.prototype.onCategoryDoubleClick=function(){},h.prototype.onPropertyDoubleClick=function(){},h.prototype.onCategoryRightClick=function(){},h.prototype.onPropertyRightClick=function(){}},49378:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RenderOptionsPanel:()=>a});var r=i(90650),n=i(18878),o=i(46263),s=i(52156);function a(e){var t=this;this.viewer=e,this.setGlobalManager(e.globalManager),r.DockingPanel.call(this,e.container,"RenderOptionsPanel","Rendering Options");let i=this.getDocument();this.table=i.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=i.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.saoToggle=new o.OptionCheckbox("AO Enabled",this.tbody,!0),this.saoToggle.setGlobalManager(this.globalManager),this.addEventListener(this.saoToggle,"change",(function(i){var r=t.saoToggle.checked;e.prefs.set("ambientShadows",r),e.setQualityLevel(r,e.impl.renderer().settings.antialias)})),this.saoRadius=new o.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setGlobalManager(this.globalManager),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",(function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()})),this.saoIntensity=new o.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setGlobalManager(this.globalManager),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",(function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()})),this.groundShadowAlpha=new o.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setGlobalManager(this.globalManager),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",(function(i){e.setGroundShadowAlpha(parseFloat(t.groundShadowAlpha.value))})),this.groundShadowColor=new o.OptionCheckbox("Shadow Color",this.tbody),this.groundShadowColor.setGlobalManager(this.globalManager),this.groundShadowColor.checkElement.value="#000000",this.groundShadowColor.checkElement.type="color",this.addEventListener(this.groundShadowColor,"change",(function(i){var r=t.groundShadowColor.checkElement.value;e.setGroundShadowColor(new THREE.Color(parseInt(r.substr(1,7),16)))})),this.groundReflectionAlpha=new o.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setGlobalManager(this.globalManager),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",(function(i){e.setGroundReflectionAlpha(parseFloat(t.groundReflectionAlpha.value))})),this.groundReflectionColor=new o.OptionCheckbox("Reflection Color",this.tbody),this.groundReflectionColor.setGlobalManager(this.globalManager),this.groundReflectionColor.checkElement.value="#000000",this.groundReflectionColor.checkElement.type="color",this.addEventListener(this.groundReflectionColor,"change",(function(i){var r=t.groundReflectionColor.checkElement.value;e.setGroundReflectionColor(new THREE.Color(parseInt(r.substr(1,7),16)))}));for(var a=[],l=0;l<s.LightPresets.length;l++)a.push(s.LightPresets[l].name);this.envSelect=new o.OptionDropDown("Environment",this.tbody,a,e.impl.currentLightPreset()),this.envSelect.setGlobalManager(this.globalManager),this.addEventListener(this.envSelect,"change",(function(i){var r=t.envSelect.selectedIndex;e.setLightPreset(r)}));var h=e.impl.renderer().getToneMapMethod();this.toneMapMethod=new o.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],h),this.toneMapMethod.setGlobalManager(this.globalManager),this.addEventListener(this.toneMapMethod,"change",(function(){var i=t.toneMapMethod.selectedIndex;e.impl.setTonemapMethod(i)})),this.exposureBias=new o.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setGlobalManager(this.globalManager),this.exposureBias.setValue(e.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",(function(i){e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)})),this.exposureBias.setDisabled(0==h),this.whiteScale=new o.OptionSlider("Light Intensity",-5,20,this.tbody),this.whiteScale.setGlobalManager(this.globalManager);var c=0;e.impl.dir_light1&&(c=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(c),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",(function(i){e.impl.dir_light1.intensity=Math.pow(2,t.whiteScale.value),e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)})),this.fovAngle=new o.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setGlobalManager(this.globalManager),this.fovAngle.setValue(e.getFOV()),this.addEventListener(this.fovAngle,"change",(function(i){e.setFOV(parseFloat(t.fovAngle.value))})),this.frameRate=new o.OptionSlider("Frame rate:",1,100,this.tbody),this.frameRate.setGlobalManager(this.globalManager),this.frameRate.setValue(e.impl.getFrameRate()),this.frameRate.sliderElement.step=this.frameRate.stepperElement.step=1,this.addEventListener(this.frameRate,"change",(function(i){e.impl.setFrameRate(t.frameRate.value)})),this.addEventListener(this.viewer,n.CAMERA_CHANGE_EVENT,(function(i){var r=parseFloat(t.fovAngle.value),n=e.getFOV();r!=n&&t.fovAngle.setValue(n)})),this.addEventListener(this.viewer,n.RENDER_OPTION_CHANGED_EVENT,(function(e){t.syncUI()})),this.addEventListener(this.viewer,n.VIEWER_STATE_RESTORED_EVENT,(function(e){t.syncUI()})),this.addVisibilityListener((function(e){e&&t.resizeToContent()}))}a.prototype=Object.create(r.DockingPanel.prototype),a.prototype.constructor=a,a.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},a.prototype.syncUI=function(){var e=this.viewer.impl,t=0;e.dir_light1&&(t=0!=e.dir_light1.intensity?Math.log(e.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(t),this.exposureBias.setValue(e.renderer().getExposureBias());var i=e.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(i),this.envSelect.setSelectedIndex(e.currentLightPreset()),this.exposureBias.setDisabled(0==i),this.saoToggle.setValue(e.renderer().getAOEnabled()),this.saoRadius.setDisabled(!e.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!e.renderer().getAOEnabled()),this.saoRadius.setValue(e.renderer().getAORadius()),this.saoIntensity.setValue(e.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV())},a.prototype.uninitialize=function(){r.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null}},51370:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SettingsPanel:()=>l});var r=i(90650),n=i(91493),o=i(7247),s=i(46263);const a=40;function l(e,t,i,n){r.DockingPanel.call(this,e,t,i,n),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0,this.shown=!1;var o=this,s=n&&void 0!==n.width?n.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=s+"px",this.container.style.top="10px",this.container.style.left=e.offsetWidth/2-170+"px",this.container.style.position="absolute";var l=this.getDocument();this.tabContainer=l.createElement("div"),this.tabContainer.classList.add("docking-panel-container-solid-color-b"),this.tabContainer.classList.add("settings-tabs"),this.tabContainer.classList.add("docking-panel-delimiter-shadow"),this.container.appendChild(this.tabContainer),this.tabs=l.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=n&&n.heightAdjustment?n.heightAdjustment:179,n&&n.hideTabBar&&(this.heightAdjustment-=a,this.tabContainer.style.display="none",this.tabContainer.style.height=0),this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.tablesContainer=l.createElement("div"),this.tablesContainer.classList.add("settings-tabs-tables-container"),n&&n.hideTabBar&&(this.scrollContainer.style.top=90-a+"px"),this.scrollContainer.appendChild(this.tablesContainer),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",(function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver)return!0;for(var i=o.getWindow();t&&t.parentNode&&t.parentNode!=i;){if(t.parentNode==this||t==this){t.preventDefault&&t.preventDefault(),o.mouseOver=!0;for(var r=0;r<o.panelTabs.length;r++)o.panelTabs[r].classList.remove("selectedmouseout");return!0}t=t.parentNode}})),this.addEventListener(this.container,"mouseout",(function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver){for(var i=o.getWindow();t&&t.parentNode&&t.parentNode!=i;){if(t.parentNode==this||t==this)return t.preventDefault&&t.preventDefault(),!1;t=t.parentNode}o.mouseOver=!1;for(var r=0;r<o.panelTabs.length;r++)o.panelTabs[r].classList.contains("tabselected")&&o.panelTabs[r].classList.add("selectedmouseout")}})),this.expandID=function(e){return t+"-"+e}}l.prototype=Object.create(r.DockingPanel.prototype),l.prototype.constructor=l,l.prototype.setVisible=function(e){e&&(this.container.style.display="block",this.shown||(this.resizeToContent(),this.container.style.left=this.parentContainer.offsetWidth/2-this.container.getBoundingClientRect().width/2+"px"),this.shown=!0),r.DockingPanel.prototype.setVisible.call(this,e)},l.prototype.addTab=function(e,t,i){var r=this;if(void 0!==this.tabIdToIndex[e])return!1;var s=i&&void 0!==i.className?i.className:null,a=i&&void 0!==i.width?i.width:200,l=i&&void 0!==i.index?i.index:this.panelTabs.length;var h=this.getDocument(),c=h.createElement("li");c._id=e,c.id=this.expandID(c._id),c.classList.add(s);var u=h.createElement("a"),d=h.createElement("span");d.setAttribute("data-i18n",t),d.textContent=n.Z.t(t),u.appendChild(d),c.appendChild(u),this.tabs.appendChild(c);var p=h.createElement("table");p._id=e+"-table",p.id=this.expandID(p._id),p.classList.add("settings-table"),p.classList.add("adsk-lmv-tftable"),p.classList.add(s);var f=h.createElement("tbody");return f.style.display="table",f.style.width="100%",p.appendChild(f),this.tablesContainer.appendChild(p),this.addEventListener(c,"touchstart",o.touchStartToClick),this.addEventListener(c,"click",(function(){r.selectTab(e)})),this.panelTabs.push(c),this.tabIdToIndex[e]=l,a>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=a+"px"),!0},l.prototype.removeTab=function(e){var t=this.tabIdToIndex[e];if(!t)return!1;this.panelTabs.splice(t,1);var i=this.getDocument().getElementById(this.expandID(e));this.tabs.removeChild(i),this.tabIdToIndex={};for(var r=this.panelTabs.length,n=0;n<r;n++){var s=this.panelTabs[n];this.tabIdToIndex[s._id]=n,this.removeEventListener(s,"touchstart",o.touchStartToClick)}return!0},l.prototype.resizeTabs=function(){for(var e=this.tabs.getElementsByTagName("li"),t=100/e.length,i=0;i<e.length;i++)e[i].style.width=t+"%"},l.prototype.hasTab=function(e){var t=this.tabIdToIndex[e];return void 0!==this.panelTabs[t]},l.prototype.selectTab=function(e){if(this.isTabSelected(e))return!1;for(var t=this.getDocument(),i=this.panelTabs.length,r=0;r<i;r++){var n=this.panelTabs[r],o=t.getElementById(this.expandID(n._id+"-table"));e===n._id?(n.classList.add("tabselected"),o.classList.add("settings-selected-table"),this.mouseOver||n.classList.add("selectedmouseout")):(n.classList.remove("tabselected"),o.classList.remove("settings-selected-table"),this.mouseOver||this.panelTabs[r].classList.remove("selectedmouseout"))}return this.scrollContainer.scrollTop=0,!0},l.prototype.isTabSelected=function(e){var t=this.tabIdToIndex[e],i=this.panelTabs[t];return i&&i.classList.contains("tabselected")},l.prototype.getSelectedTabId=function(){for(var e in this.tabIdToIndex)if(this.isTabSelected(e))return e;return null},l.prototype.addLabel=function(e,t){var i,r=this.tabIdToIndex[e];if(-1===r)return!1;i=this.tablesContainer.childNodes[r];var n=new s.OptionLabel(t,i.tBodies[0]);return n.setGlobalManager(this.globalManager),n.sliderRow.classList.add("logical-group"),n},l.prototype.addButton=function(e,t){var i=this.tabIdToIndex[e];if(void 0===i)return null;var r=this.tablesContainer.childNodes[i],n=new s.OptionButton(t,r.tBodies[0]);return n.setGlobalManager(this.globalManager),this.addControl(e,n)},l.prototype.addCheckbox=function(e,t,i,r,n,o){var a=this.tabIdToIndex[e];if(void 0===a)return null;var l=this.tablesContainer.childNodes[a],h=new s.OptionCheckbox(t,l.tBodies[0],i,n,o);return h.setGlobalManager(this.globalManager),h.changeListener=function(e){var t=e.detail.target.checked;r(t)},this.addEventListener(h,"change",h.changeListener),this.addControl(e,h)},l.prototype.addRow=function(e,t,i,r){if(void 0===this.tabIdToIndex[e])return null;var n=this.getDocument().getElementById(this.expandID(e+"-table")),o=new s.OptionRow(t,n.tBodies[0],i,r);return o.setGlobalManager(this.globalManager),this.addControl(e,o)},l.prototype.addSlider=function(e,t,i,r,n,o,a){if(void 0===this.tabIdToIndex[e])return null;var l=this.getDocument().getElementById(this.expandID(e+"-table")),h=new s.OptionSlider(t,i,r,l.tBodies[0],a);h.setGlobalManager(this.globalManager),h.setValue(n);var c=1;return a&&a.step&&(c=a.step),h.sliderElement.step=h.stepperElement.step=c,this.addEventListener(h,"change",(function(e){o(e)})),this.addControl(e,h)},l.prototype.addSliderV2=function(e,t,i,r,n,o,s,a){(a=a||{}).hideStepper=!0,a.hideCaption=!0;const l=[];return l.push(this.addRow(e,t,i,a)),l.push(this.addSlider(e,t,r,n,o,s,a)),l},l.prototype.addDropDownMenu=function(e,t,i,r,n,o){if(void 0===this.tabIdToIndex[e])return null;var a=this.getDocument().getElementById(this.expandID(e+"-table")),l=new s.OptionDropDown(t,a.tBodies[0],i,r,null,this.globalManager,o);return l.setGlobalManager(this.globalManager),this.addEventListener(l,"change",(function(e){n(e)})),this.addControl(e,l)},l.prototype.addControl=function(e,t,i){if(void 0===this.tabIdToIndex[e])return null;if(!Object.prototype.hasOwnProperty.call(t,"sliderRow")){var r=i&&i.insertAtIndex?i.insertAtIndex:-1,o=i&&i.caption?i.caption:null,s=this.getDocument(),a=s.getElementById(this.expandID(e+"-table"));r>a.length&&(r=-1);var l=a.tBodies[0].insertRow(r),h=l.insertCell(0);if(o){var c=s.createElement("div");c.setAttribute("data-i18n",o),c.textContent=n.Z.t(o),h.appendChild(c),h=l.insertCell(1)}else h.colSpan=3;h.appendChild(t),t.sliderRow=l,t.tbody=a.tBodies[0]}var u=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[u]=t,t.parent=this,u},l.prototype.removeButton=function(e){return this.removeControl(e)},l.prototype.removeCheckbox=function(e){return this.removeControl(e)},l.prototype.removeSlider=function(e){return this.removeControl(e)},l.prototype.removeDropdownMenu=function(e){return this.removeControl(e)},l.prototype.removeControl=function(e){var t;if("object"==typeof e&&e.tbody){for(var i in t=e,this.controls)if(this.controls[i]===t){e=i;break}}else t=this.controls[e];if(void 0===t)return!1;if(t.removeFromParent)t.removeFromParent();else{var r=t.tbody,n=t.sliderRow.rowIndex;r.deleteRow(n)}return delete this.controls[e],t.parent=void 0,!0},l.prototype.getControl=function(e){return this.controls[e]||null},l.prototype.getContentSize=function(){for(var e=this.heightAdjustment,t=0,i=this.getDocument(),r=0;r<this.panelTabs.length;r++){var n=this.panelTabs[r],o=i.getElementById(this.expandID(n._id+"-table")),s=o?o.clientHeight:0;t=Math.max(t,s)}return{height:e+t,width:this.container.clientWidth}},l.prototype.sizeToContent=function(e){var t=this.getContentSize().height+this.heightAdjustment,i=e.clientHeight-this.heightAdjustment,r=Math.min(t,i);this.container.style.height=parseInt(r)+"px"},l.prototype.addSimpleList=function(e,t,i){var r=new s.SimpleList(e,t,i);return r.setGlobalManager(this.globalManager),r},l.prototype.removeSimpleList=function(e){return!!e&&(e.removeFromParent(),!0)}},11815:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Tree:()=>a});var r=i(7247),n=i(44160),o=i(76542);const s=i(79058);function a(e,t,i,r){this.myDelegate=e,this.mySelectedNodes=[],this.myOptions=r||{},this.parentContainer=i;this.groupClassName=this.myOptions.groupClassName||"expanded",this.leafClassName=this.myOptions.leafClassName||"expanded",this.selectedClassName=this.myOptions.selectedClassName||"selected",this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var n=this.myRootContainer=this.createHtmlElement_(i,"div","treeview"),o=this.rootElem=this.createElement_(t,n,r,0);this.setInputHandlers_(),r&&r.excludeRoot&&o.classList.add("exclude")}a.prototype.constructor=a,o.GlobalManagerMixin.call(a.prototype),a.prototype.destroy=function(){this.myDelegate=null,this.parentContainer&&(this.parentContainer.removeChild(this.myRootContainer),this.myRootContainer=null,this.parentContainer=null)},a.prototype.show=function(e){var t=this.myRootContainer;t.style.display=e?"block":"none"},a.prototype.getRootContainer=function(){return this.myRootContainer},a.prototype.getElementForNode=function(e){return"number"!=typeof e&&"string"!=typeof e&&(e=this.myDelegate.getTreeNodeId(e)),this.nodeToElement[e]},a.prototype.delegate=function(){return this.myDelegate},a.prototype.isCollapsed=function(e){return this.hasClass(e,"collapsed")},a.prototype.setCollapsed=function(e,t,i){t?(this.addClass(e,"collapsed",i),this.removeClass(e,"expanded",i)):(this.addClass(e,"expanded",i),this.removeClass(e,"collapsed",i))},a.prototype.setAllCollapsed=function(e){var t,i;e?(t=function(e){return e.classList.contains("expanded")},i=function(e){e.classList.add("collapsed"),e.classList.remove("expanded")}):(t=function(e){return e.classList.contains("collapsed")},i=function(e){e.classList.add("expanded"),e.classList.remove("collapsed")});for(var r=0;r<this.myGroupNodes.length;++r){var n=this.myGroupNodes[r];t(n)&&i(n)}},a.prototype.addToSelection=function(e){var t=this;function i(e){return-1===t.mySelectedNodes.indexOf(e)&&(t.mySelectedNodes.push(e),!0)}for(var r=e.length,n=0;n<r;++n){var o=e[n];i(o)&&this.addClass(o,this.selectedClassName)}},a.prototype.removeFromSelection=function(e){var t=this;function i(e){var i=t.mySelectedNodes.indexOf(e);return-1!==i&&(t.mySelectedNodes.splice(i,1),!0)}for(var r=e.length-1;r>=0;--r){var n=e[r];i(n)&&this.removeClass(n,this.selectedClassName)}},a.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(e),this.mySelectedNodes},a.prototype.getSelection=function(){return this.mySelectedNodes.concat()},a.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},a.prototype.isSelected=function(e){return this.hasClass(e,this.selectedClassName)},a.prototype.scrollTo=function(e){var t=this.getElementForNode(e);if(t){var i=t.offsetTop;for(t=t.parentNode;t&&t!=this.myRootContainer;)i+=t.offsetTop,t=t.parentNode;var r=this.myRootContainer.parentNode;this.myDelegate.getScrollContainer()&&(r=this.myDelegate.getScrollContainer()),r.scrollTop=i}},a.prototype.addClass=function(e,t,i){var r=this.getElementForNode(e);if(r){if(i){r=r.parentNode;for(var n=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;r&&r!==n;)r.classList.add(t),r=r.parentNode}else r.classList.add(t);return!0}return!1},a.prototype.removeClass=function(e,t,i){var r=this.getElementForNode(e);if(r){if(i){r=r.parentNode;for(var n=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;r&&r!==n;)r.classList.remove(t),r=r.parentNode}else r.classList.remove(t);return!0}return!1},a.prototype.hasClass=function(e,t){return this.getElementForNode(e).classList.contains(t)},a.prototype.clear=function(){for(var e=this.myRootContainer;e.hasChildNodes();)e.removeChild(e.lastChild);this.nodeToElement={},this.nodeIdToNode={}},a.prototype.createElement_=function(e,t,i,r){if(null==e)return null;if(!this.myDelegate.shouldCreateTreeNode(e))return null;var n,o=this;function s(t,n,s,a){var l=o.createHtmlElement_(t,n,s),h=o.myDelegate.getTreeNodeId(a);l.setAttribute("lmv-nodeId",h);var c=o.createHtmlElement_(l,"lmvheader"),u=o.createHtmlElement_(c,"icon");return u.addEventListener("mousedown",(function(e){e.stopPropagation(),e.preventDefault()}),!1),u.addEventListener("click",(function(t){o.myDelegate.onTreeNodeIconClick(o,e,t),t.stopPropagation(),t.preventDefault()}),!1),o.myDelegate.createTreeNode(e,c,i,n,r),l}var a=this.myDelegate.getTreeNodeId(e),l=o.myOptions.excludeRoot?1:0;o.myDelegate.isTreeNodeGroup(e)?(n=s(t,"group",o.groupClassName,e),o.nodeToElement[a]=n,o.nodeIdToNode[a]=e,r==l&&(n.style.left="0px"),o.myGroupNodes.push(n),o.myDelegate.forEachChild(e,(function(e){o.createElement_(e,n,i,r+1)}))):(n=s(t,"leaf",o.leafClassName,e),o.nodeToElement[a]=n,o.nodeIdToNode[a]=e,r==l&&(n.style.marginLeft="0px"));var h=o.myDelegate.getTreeNodeClass(e);return h&&n.classList.add(h),n},a.prototype.setInputHandlers_=function(){var e=this,t=this.myRootContainer,i=null,o=function(r){var n=null,o=!1;do{r&&r!==t?r.hasAttribute("lmv-nodeId")?(n=r,o=!0):r=r.parentElement:(n=null,o=!0)}while(!o);if(n){var s=n.getAttribute("lmv-nodeId");return e.nodeIdToNode[s]||i}return i};(0,r.isTouchDevice)()&&(this.hammer=new s.Manager(t,{recognizers:[n.GestureRecognizers.doubletap,n.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:s.TouchInput}),this.hammer.on("doubletap",(function(t){var r=o(t.target);r!==i&&e.myDelegate.onTreeNodeDoubleClick(e,r,t)})),this.hammer.on("press",(function(t){var r=o(t.target);r!==i&&e.myDelegate.onTreeNodeRightClick(e,r,t)}))),t.addEventListener("click",(function(t){var r=o(t.target);r!==i&&(e.myDelegate.onTreeNodeClick(e,r,t),t.stopPropagation(),t.target.classList.contains("propertyLink")||t.preventDefault())}),!1),t.addEventListener("dblclick",(function(t){var r=o(t.target);r!==i&&(e.myDelegate.onTreeNodeDoubleClick(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("contextmenu",(function(t){var r=o(t.target);r!==i&&(e.myDelegate.onTreeNodeRightClick(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("mouseover",(function(t){var r=o(t.target);r!==i&&(e.myDelegate.onTreeNodeHover(e,r,t),t.stopPropagation(),t.preventDefault())}),!1),t.addEventListener("mouseout",(function(t){var i=t.toElement||t.relatedTarget;if(o(t.target)!=o(i)){e.myDelegate.onTreeNodeHover(e,-1,t),t.stopPropagation(),t.preventDefault()}}),!1)},a.prototype.createHtmlElement_=function(e,t,i){var r=this.getDocument().createElement(t);return e.appendChild(r),i&&(r.className=i),r},a.prototype.iterate=function(e,t){if(null!=e&&this.myDelegate.shouldCreateTreeNode(e)){var i=this.getElementForNode(e);if(i){t(e,i);var r=this;this.myDelegate.forEachChild(e,(function(e){r.iterate(e,t)}))}}}},30210:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TreeDelegate:()=>n});var r=i(91493);function n(){}i(76542).GlobalManagerMixin.call(n.prototype),n.prototype.constructor=n,n.prototype.isTreeNodeGroup=function(e){throw"isTreeNodeGroup is not implemented."},n.prototype.getTreeNodeId=function(e){throw"getTreeNodeId is not implemented."},n.prototype.getTreeNodeIndex=function(e){throw"getTreeNodeIndex is not implemented."},n.prototype.getTreeNodeParentId=function(e){throw"getTreeNodeParentId is not implemented."},n.prototype.getTreeNodeLabel=function(e){return e.name},n.prototype.getTreeNodeCount=function(){throw"getTreeNodeCount is not implemented."},n.prototype.shouldCreateTreeNode=function(e){return!0},n.prototype.forEachChild=function(e,t){for(var i=e.children?e.children.length:0,r=0;r<i;++r){t(e.children[r])}},n.prototype.createTreeNode=function(e,t,i,n,o){var s=this.getDocument().createElement("label");t.appendChild(s);var a=this.getTreeNodeLabel(e);return i&&i.localize&&(s.setAttribute("data-i18n",a),a=r.Z.t(a)),s.textContent=a,s},n.prototype.onTreeNodeClick=function(e,t,i){},n.prototype.onTreeNodeIconClick=function(e,t,i){e.delegate().isTreeNodeGroup(t)&&e.setCollapsed(t,!e.isCollapsed(t))},n.prototype.onTreeNodeDoubleClick=function(e,t,i){},n.prototype.onTreeNodeRightClick=function(e,t,i){},n.prototype.onTreeNodeReized=function(e){},n.prototype.getTreeNodeClass=function(e){return""},n.prototype.getTreeNodeParentMaxSize=function(e){return{width:0,height:0}},n.prototype.getTreeNodeClientHeight=function(e){return 0},n.prototype.getTreeNodeDepthOffset=function(e,t){return 0},n.prototype.onTreeNodeHover=function(e,t,i){},n.prototype.getScrollContainer=function(){return null}},29677:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TreeOnDemand:()=>u});var r=i(7247),n=i(44160),o=i(36261),s=i(91493),a=i(76542);const l=i(79058);var h=150,c=300;function u(e,t){this.dirty=!1,this.nextFrameId=0,this.scrollY=0,this.delegates=[],this.idToDelegate={},this.options=t;var i=this.getDocument();this.rootContainer=i.createElement("div"),this.rootContainer.classList.add("docking-panel-container-gradient"),this.rootContainer.classList.add("treeview"),this.rootContainer.classList.add("on-demand"),e.appendChild(this.rootContainer),this.paddingDiv=i.createElement("div"),this.paddingDiv.style.border=0,this.paddingDiv.style.margin=0,this.paddingDiv.style.padding=0,this.sizedDiv=e.parentNode,this.nodeCssTable=[[],["group"],["leaf"]],this.cssStringToNodeCssTable={"":0,group:1,leaf:2},this.nodeIndexToNodeCssTables={};for(var s=[],a=h,c=0;c<a;++c){var u=_(i);s[c]=u}this.elementsPool=s,this.elementsUsed=0,this.spinner=new o.LoadingSpinner(e),this.spinner.setGlobalManager(this.globalManager),this.spinner.addClass("tree-loading-spinner");var d=(0,r.isTouchDevice)();d&&(this.hammer=new l.Manager(this.rootContainer,{recognizers:[n.GestureRecognizers.doubletap,n.GestureRecognizers.press],handlePointerEventMouse:!1,inputClass:l.TouchInput}));for(c=0;c<a;++c){u=s[c];d&&(this.hammer.on("doubletap",E.bind(this)),this.hammer.on("press",A.bind(this))),u.addEventListener("click",S.bind(this)),u.addEventListener("dblclick",w.bind(this)),u.addEventListener("contextmenu",M.bind(this)),u.icon.addEventListener("click",T.bind(this)),u.icon.addEventListener("mousedown",C.bind(this))}m(this)}var d=u.prototype;function p(e){if(e.dirty=!1,function(e){for(var t=e.elementsUsed,i=e.elementsPool,r=0;r<t;++r){var n=i[r];n.setAttribute("lmv-nodeId",""),n.className="";for(var o=n.header,s=o.childNodes.length-1,a=0;a<s;++a)o.removeChild(o.lastChild)}e.clear()}(e),e.displayNoProperties(!1),0!==e.delegates.length)if(1===e.delegates.length&&e.delegates[0].isLoading())e.spinner.setVisible(!0);else{if(1===e.delegates.length&&e.delegates[0].isNotAvailable())return e.spinner.setVisible(!1),void e.displayNoProperties(!0);e.spinner.setVisible(!1),function(e){var t=e.rootContainer,i=function(e){return{width:0|e.sizedDiv.clientWidth,height:0|e.sizedDiv.clientHeight}}(e),r=i.height,n=0,o=0,s=!0;t.appendChild(e.paddingDiv);var a=e.delegates.slice(0),l=e.isExcludeRoot();for(;a.length;){var h=a.shift(),u=h.modelDiv;t.appendChild(u);for(var d=[h.getRootId()],p={curr:l?-1:0,popIds:[]};d.length&&s;){if(n>e.scrollY+r+c){s=!1;break}if(e.elementsUsed===e.elementsPool.length){s=!1;break}var m=d.shift(),g=n+(M=-1===p.curr?0:h.getTreeNodeClientHeight(m));if(M>0&&g+c>=e.scrollY){var v=e.elementsPool[e.elementsUsed++];v.setAttribute("lmv-nodeId",m),h.createTreeNode(m,v.header);var y=h.getTreeNodeClass(m);y&&v.classList.add(y);var x=b(e,h,m);if(x)for(var _=x.length,E=0;E<_;++E)v.classList.add(x[E]);var A=h.getTreeNodeDepthOffset(m,p.curr);v.header.style.paddingLeft=A+"px",u.appendChild(v)}if(g+c<e.scrollY&&(o=g),n=g,(T=f(e,h,m,0===M))&&T.length>0){p.curr++;for(var S=T[T.length-1],w=p.popIds.length-1;w>=0&&p.popIds[w]===m;)p.popIds[w--]=S;p.popIds.push(S),d=T.concat(d)}for(;p.popIds.length>0&&m===p.popIds[p.popIds.length-1];)p.popIds.pop(),p.curr--}for(e.paddingDiv.style.height=o+"px";d.length;){var M,T;m=d.shift();n=g=n+(M=-1===p.curr?0:h.getTreeNodeClientHeight(m)),(T=f(e,h,m))&&T.length&&(d=T.concat(d))}}t.style.height=n+"px"}(e)}else e.spinner.setVisible(!1)}function f(e,t,i,r){if(!t.isTreeNodeGroup(i))return null;if(!r&&e.isCollapsed(t,i))return null;var n=[];return t.forEachChild(i,(function(e){n.push(e)})),n}function m(e,t){e.dirty&&!t||(t?p(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame((function(){p(e)}))))}function g(e,t){return"number"!=typeof t&&"string"!=typeof t?e.threeDelegate.getTreeNodeId(0|t):t}function v(e,t){for(var i=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-nodeId")){i=t;break}t=t.parentElement}if(!i)return null;var r=i.getAttribute("lmv-nodeId");return parseFloat(r)}function y(e,t){for(var i=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-modelId")){i=t;break}t=t.parentElement}if(!i)return null;var r=i.getAttribute("lmv-modelId");return parseInt(r)}function b(e,t,i){if(t.isControlId(i))return t.getControlIdCss(i);var r=t.getTreeNodeIndex(i);return e.nodeCssTable[e.nodeIndexToNodeCssTables[t.model.id][r]]}function x(e,t,i,r){var n=r.join(" "),o=e.cssStringToNodeCssTable[n]||e.nodeCssTable.length;o===e.nodeCssTable.length&&(e.nodeCssTable.push(r),e.cssStringToNodeCssTable[n]=o);var s=t.getTreeNodeIndex(i);e.nodeIndexToNodeCssTables[t.model.id][s]=o}function _(e,t,i){var r=e.createElement("lmvheader"),n=e.createElement("icon");r.appendChild(n);var o=e.createElement("div");return o.header=r,o.icon=n,o.appendChild(r),o}function E(e){var t=v(this,e.target);if(t){var i=y(this,e.target),r=this.getDelegate(i);r&&r.onTreeNodeDoubleClick(this,t,e)}}function A(e){var t=v(this,e.target);if(t){var i=y(this,e.target),r=this.getDelegate(i);r&&r.onTreeNodeRightClick(this,t,e)}}function S(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=v(this,e.target);if(t){var i=y(this,e.target),r=this.getDelegate(i);r&&(r.onTreeNodeClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function w(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=v(this,e.target);if(t){var i=y(this,e.target),r=this.getDelegate(i);r&&(r.onTreeNodeDoubleClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function M(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=v(this,e.target);if(t){var i=y(this,e.target),r=this.getDelegate(i);r&&(r.onTreeNodeRightClick(this,t,e),e.stopPropagation(),e.preventDefault())}}}function T(e){var t=v(this,e.target);if(t){var i=y(this,e.target),r=this.getDelegate(i);r&&(r.onTreeNodeIconClick(this,t,e),e.stopPropagation(),e.preventDefault())}}function C(e){e.stopPropagation(),e.preventDefault()}d.constructor=u,a.GlobalManagerMixin.call(d),d.pushDelegate=function(e){this.delegates.push(e),this.idToDelegate[e.model.id]=e,m(this)},d.removeDelegate=function(e){for(var t=0;t<this.delegates.length;++t){if(this.delegates[t].model.id===e)return this.delegates.splice(t,1),delete this.idToDelegate[e],delete this.nodeIndexToNodeCssTables[e],m(this),!0}return!1},d.setInstanceTree=function(e,t){if(e.setInstanceTree(t),m(this),t){var i=new Uint8Array(e.getTreeNodeCount()),r=e.instanceTree.getRootId();e.forEachChild(r,(function(t){var r=e.getTreeNodeIndex(t);i[r]=e.isTreeNodeGroup(t)?1:2}),!0);var n=e.model.id;this.nodeIndexToNodeCssTables[n]=i;var o=0,s=0;t.enumNodeChildren(r,(function(e){s||(o=e),s++})),this.setAllCollapsed(e,!0);var a=this.options.excludeRoot,l=this.options.startCollapsed;a?(this.setCollapsed(e,r,!1),l||this.setCollapsed(e,o,!1)):l||this.setCollapsed(e,e.rootId,!1),m(this,!0)}},d.show=function(e){this.rootContainer.style.display=block},d.getRootContainer=function(){return this.rootContainer},d.getDelegate=function(e){return this.idToDelegate[parseInt(e)]},d.isCollapsed=function(e,t){var i=b(this,e,t);return i&&-1!==i.indexOf("collapsed")},d.setCollapsed=function(e,t,i,r){i?(this.addClass(e,t,"collapsed",r),this.removeClass(e,t,"expanded",r)):(this.addClass(e,t,"expanded",r),this.removeClass(e,t,"collapsed",r))},d.setAllCollapsed=function(e,t){var i=function(t){this.addClass(e,t,"collapsed",!1),this.removeClass(e,t,"expanded",!1)}.bind(this),r=e.instanceTree.getRootId();this.iterate(e,r,(function(t){return e.isTreeNodeGroup(t)&&i(t),!0}))},d.addToSelection=function(e,t){for(var i=t.length,r=0;r<i;++r)this.addClass(e,t[r],"selected",!1);m(this)},d.removeFromSelection=function(e,t){for(var i=t.length,r=0;r<i;++r)this.removeClass(e,t[r],"selected",!1);m(this)},d.setSelection=function(e,t){return this.clearSelection(e),this.addToSelection(e,t),this.selectedNodes},d.clearSelection=function(e){var t=[],i=function(i){var r=b(this,e,i);r&&-1!==r.indexOf("selected")&&(t[0]=i,this.removeFromSelection(e,t))}.bind(this),r=e.instanceTree.getRootId();e.forEachChild(r,i,!0)},d.isSelected=function(e){var t=b(this,delegate,e);return t&&-1!==t.indexOf("selected")},d.scrollTo=function(e,t){var i=this.getDelegate(t.id);if(!i||!i.isNotAvailable()){var r=!1,n=[],o=function(t,i){if(!(r=r||e===t)){n.push(i.getTreeNodeClientHeight(t));var s=n.length,a=i.isTreeNodeGroup(t)&&-1!==b(this,i,t).indexOf("expanded");i.forEachChild(t,(function(e){o(e,i)})),a||r||n.length>s&&n.splice(s)}}.bind(this);this.setCollapsed(i,e,!1,!0);var s=i.getRootId();if(o(s,i),!r)return-1;for(var a=0,l=n.length,h=this.isExcludeRoot()?1:0;h<l;++h)a+=n[h];if(1===this.delegates.length)return m(this,!0),a;for(h=0;h<this.delegates.length;++h){var c=this.delegates[h];if(c===i)break;n=[],e=-1,r=!1,s=c.getRootId(),o(s,c),l=n.length;for(var u=0,d=0;d<l;++d)u+=n[d];a+=u}return m(this,!0),a}},d.addClass=function(e,t,i,r){function n(t,i,r){var n=b(t,e,i);n&&(-1===n.indexOf(r)&&((n=n.slice(0)).push(r),n.sort(),x(t,e,i,n)))}if(r)for(var o=e.getTreeNodeParentId(g(this,t));o;)n(this,o,i),o=e.getTreeNodeParentId(o);else n(this,t,i);return m(this),!0},d.removeClass=function(e,t,i,r){function n(t,i,r){var n=b(t,e,i);if(n){var o=n.indexOf(r);-1!==o&&((n=n.slice(0)).splice(o,1),x(t,e,i,n))}}if(r)for(var o=e.getTreeNodeParentId(g(this,t));o;)n(this,o,i),o=e.getTreeNodeParentId(o);else n(this,t,i);return m(this),!0},d.hasClass=function(e,t){return 1!==b(this,delegate,e).indexOf(t)},d.clear=function(){for(var e,t=this.rootContainer;e=t.lastChild;)t.removeChild(e);for(var i=0;i<this.delegates.length;++i)this.delegates[i].clean();this.elementsUsed=0},d.iterate=function(e,t,i){null!=t&&e.shouldCreateTreeNode(t)&&i(t)&&e.forEachChild(t,function(t){this.iterate(e,t,i)}.bind(this))},d.forEachDelegate=function(e){for(var t=0;t<this.delegates.length;++t)e(this.delegates[t])},d.destroy=function(){this.clear(),cancelAnimationFrame(this.nextFrameId),this.rootContainer.parentNode.removeChild(this.rootContainer),this.rootContainer=null,this.rootId=-1,this.nodeCssTable=null,this.nodeIndexToNodeCssTables=null,this.cssStringToNodeCssTable=null,this.elementsPool=null,this.elementsUsed=-1,this.scrollY=-1,this.hammer&&(this.hammer.destroy(),this.hammer=null)},d.setScroll=function(e){Math.abs(this.scrollY-e)>c&&(this.scrollY=e,m(this))},d.displayNoProperties=function(e){var t=this.getDocument();if(e){if(!this.divNoProps){this.divNoProps=t.createElement("div");var i="Model Browser is not available";this.divNoProps.innerText=s.Z.t(i),this.divNoProps.setAttribute("data-i18n",i),this.divNoProps.classList.add("lmv-no-properties")}if(!this.divNoProps.parentNode)this.rootContainer.parentNode.appendChild(this.divNoProps)}else this.divNoProps&&this.divNoProps.parentNode&&this.divNoProps.parentNode.removeChild(this.divNoProps)},d.isExcludeRoot=function(){return 1===this.delegates.length&&this.options.excludeRoot},d.getDelegateCount=function(){return this.delegates.length}},77288:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ViewerModelStructurePanel:()=>d,generateDefaultViewerHandlerOptions:()=>h});var r=i(89461),n=i(16098),o=i(18878),s=i(32195),a=i(60489),l=i(38241);const h=e=>({onSearchSelected:function(t){var i=t.id,r=e.impl.findModel(t.modelId);e.isolate(i,r)},onVisibilityIconClick:function(t,i){e.toggleVisibility(t,i)},onCreateUI:function(t){e.resizePanels&&e.resizePanels({dockingPanels:[t]}),t.scrollContainer.addEventListener("contextmenu",function(t){e.contextMenu.show(t)}.bind(t))},onIsolate:function(t,i){if(e.isolate(t,i),e.fitToView([t],i,!1),i){var r={type:o.SHOW_PROPERTIES_EVENT,dbId:t,model:i};e.dispatchEvent(r)}},onToggleMultipleOverlayedSelection:function(t){e.impl.selector.setAggregateSelection(t.map((t=>({model:e.impl.findModel(parseInt(t.modelId)),ids:t.ids}))));var i=e.getAggregateSelection();e.fitToView(i)},onToggleOverlayedSelection:function(t,i,r){r?e.select([],void 0,i):(e.select(t,i),e.fitToView([t],i,!1))},onTreeNodeRightClick:function(t){e.contextMenu.show(t)},onSelectOnly:function(t,i){e.select(t,i)},onDeselectAll:function(){e.clearSelection()},onSelectToggle:function(t,i){e.toggleSelect(t,i)},onShowAll:function(){e.showAll()},onFocus:function(){e.fitToView()},onHide:function(t,i){e.hide(t,i)},onShow:function(t,i){e.show(t,i)},onToggleVisibility:function(t,i){e.toggleVisibility(t,i)},getAggregateIsolation:e.getAggregateIsolation.bind(e),getAggregateHiddenNodes:e.getAggregateHiddenNodes.bind(e),getAggregateSelection:e.getAggregateSelection.bind(e),globalManager:e.globalManager,container:e.container,removeEventListener:e.removeEventListener.bind(e),addEventListener:e.addEventListener.bind(e)}),c=Autodesk.Viewing.Private;var u={click:{onObject:["isolate"]},clickShift:{onObject:["toggleMultipleOverlayedSelection"]},clickCtrl:{onObject:["toggleVisibility"]}};function d(e,t,i){let o={...i}||{},l=t;e instanceof Autodesk.Viewing.GuiViewer3D||e instanceof Autodesk.Viewing.Viewer3D?(a.logger.warn("Deprecated use of Viewer as parameter. Use options callbacks instead"),o={...o,...h(e)}):o={...e},this.visible=!1,this._trackNodeClick=!0,o.defaultTitle="Model",o.excludeRoot=void 0===o.excludeRoot||o.excludeRoot,o.startCollapsed=void 0!==o.startCollapsed&&o.startCollapsed,o.scrollEaseCurve=o.scrollEaseCurve||[0,0,.29,1],o.scrollEaseSpeed=void 0!==o.scrollEaseSpeed?o.scrollEaseSpeed:.003,o.addFooter=void 0===o.addFooter||o.addFooter,this.clickConfig=o&&o.docStructureConfig?o.docStructureConfig:u,this.isMac=-1!==navigator.userAgent.search("Mac OS"),o.hideSearch?(o.heightAdjustment=70,r.ModelStructurePanel.call(this,o.container,o.container.id+"ViewerModelStructurePanel",l,o),this.scrollContainer.classList.add("no-search")):(o.heightAdjustment=104,r.ModelStructurePanel.call(this,o.container,o.container.id+"ViewerModelStructurePanel",l,o),this.searchbox=new s.Searchbox(o.container.id+"ViewerModelStructurePanel-Searchbox",o.container,{excludeRoot:o.excludeRoot,searchFunction:p.bind(this)}),this.searchbox.setGlobalManager(this.globalManager),o.onSearchSelected&&this.searchbox.addEventListener(n.J,o.onSearchSelected),this.container.appendChild(this.searchbox.container)),this.setGlobalManager(o.globalManager),this._ignoreScroll=!1,this.selectedNodes={},this.onViewerSelect=this.onViewerSelect.bind(this),this.onViewerIsolate=this.onViewerIsolate.bind(this),this.onViewerHide=this.onViewerHide.bind(this),this.onViewerShow=this.onViewerShow.bind(this)}function p(e){var t=this.tree,i=e.toLowerCase(),r=[];return t.forEachDelegate((function(e){var n=e.getRootId(),o=[];t.iterate(e,n,(function(t){var r=e.instanceTree&&e.instanceTree.getNodeName(t);return r&&-1!==r.toLowerCase().indexOf(i)&&o.push(t),!0})),r.push({ids:o,delegate:e})})),c.analytics.track("viewer.model_browser",{from:"Panel",action:"Search"}),r}d.prototype=Object.create(r.ModelStructurePanel.prototype),d.prototype.constructor=d,l.ViewerPanelMixin.call(d.prototype),d.prototype.uninitialize=function(){var e,t,i,n,s,a,l,h;null===(e=(t=this.options).removeEventListener)||void 0===e||e.call(t,o.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),null===(i=(n=this.options).removeEventListener)||void 0===i||i.call(n,o.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),null===(s=(a=this.options).removeEventListener)||void 0===s||s.call(a,o.HIDE_EVENT,this.onViewerHide),null===(l=(h=this.options).removeEventListener)||void 0===l||l.call(h,o.SHOW_EVENT,this.onViewerShow),this.searchResults&&(this.searchResults.uninitialize(),this.searchResults=null),r.ModelStructurePanel.prototype.uninitialize.call(this)},d.prototype.resizeToContent=function(){var e=this.scrollContainer,t=this.tree?this.tree.getRootContainer():null;if(e&&t){var i="calc(100% + "+e.scrollLeft+"px)";t.style.width=i}},d.prototype.createUI=function(){var e,t,i,n,s,a,l,h,c,u;if(!this.uiCreated){r.ModelStructurePanel.prototype.createUI.call(this),this.scrollContainer.classList.remove("left");var d=function(){this.visible&&this.resizeToContent(),requestAnimationFrame(d)}.bind(this);d(),null===(e=(t=this.options).onCreateUI)||void 0===e||e.call(t,this);var p=this.options,f=p.maxHeight?p.maxHeight:"calc("+this.container.style.maxHeight+" - 30px)";this.container.style.top="10px",this.container.style.left="10px",this.container.style.height=f,this.container.style.maxHeight=f,null===(i=(n=this.options).addEventListener)||void 0===i||i.call(n,o.AGGREGATE_SELECTION_CHANGED_EVENT,this.onViewerSelect),null===(s=(a=this.options).addEventListener)||void 0===s||s.call(a,o.AGGREGATE_ISOLATION_CHANGED_EVENT,this.onViewerIsolate),null===(l=(h=this.options).addEventListener)||void 0===l||l.call(h,o.HIDE_EVENT,this.onViewerHide),null===(c=(u=this.options).addEventListener)||void 0===c||c.call(u,o.SHOW_EVENT,this.onViewerShow)}},d.prototype.onViewerSelect=function(e){this.setSelection(e.selections),this._ignoreScroll||this.scrollToSelection(e.selections),this._ignoreScroll=!1},d.prototype.onViewerIsolate=function(e){this.setIsolation(e.isolation)},d.prototype.onViewerHide=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!0)},d.prototype.onViewerShow=function(e){this.setHidden(e.nodeIdArray.slice(),e.model,!1)},d.prototype.setVisible=function(e){r.ModelStructurePanel.prototype.setVisible.call(this,e),this.visible!==e&&(this.visible=e,this.visible&&this.sync())},d.prototype.sync=function(){var e,t,i,r,n,o,s=(null===(e=(t=this.options).getAggregateIsolation)||void 0===e?void 0:e.call(t))||[],a=(null===(i=(r=this.options).getAggregateHiddenNodes)||void 0===i?void 0:i.call(r))||[],l=(null===(n=(o=this.options).getAggregateSelection)||void 0===n?void 0:n.call(o))||[];if(this.setIsolation(s),0===s.length)for(var h=0;h<a.length;++h){var c=a[h].model,u=a[h].ids;this.setHidden(u,c,!0)}this.setSelection(l),this.scrollToSelection(l)},d.prototype.removeTreeUI=function(e){delete this.selectedNodes[e.id],r.ModelStructurePanel.prototype.removeTreeUI.call(this,e)},d.prototype.setHidden=function(e,t,i){for(var r=this.tree,n=r.getDelegate(t.id),o=i?function(e){return r.addClass(n,e,"dim",!1),r.removeClass(n,e,"visible",!1),!0}:function(e){return r.removeClass(n,e,"dim",!1),r.addClass(n,e,"visible",!1),!0},s=0;s<e.length;++s)r.iterate(n,e[s],o)},d.prototype.setIsolation=function(e){var t=this.tree;if(0!==e.length){var i=[];e.length&&this.tree.forEachDelegate(function(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].model===t.model){r=n;break}-1===r&&i.push(t)}.bind(this));for(let i=0;i<e.length;++i){const n=e[i].model,o=n.getData().instanceTree;if(!o)continue;const s=o.getRootId(),a=t.getDelegate(n.id);t.iterate(a,s,(function(e){return t.removeClass(a,e,"dim",!1),t.removeClass(a,e,"visible",!1),!0}));var r=e[i].ids;if(0!==r.length){if(1===r.length&&r[0]===s)return;this.setHidden([s],n,!0),this.setHidden(r,n,!1)}}for(let e=0;e<i.length;++e){const r=i[e],n=r.model,o=r.instanceTree;if(!o)continue;const s=o.getRootId();t.iterate(r,s,(function(e){return t.removeClass(r,e,"dim",!1),t.removeClass(r,e,"visible",!1),!0})),this.setHidden([s],n,!0)}}else t.forEachDelegate(function(e){var i=e.model,r=e.instanceTree;if(r){var n=r.getRootId();t.iterate(e,n,(function(i){return t.removeClass(e,i,"dim",!1),t.removeClass(e,i,"visible",!1),!0})),this.setHidden([n],i,!1)}}.bind(this))},d.prototype.setSelection=function(e){var t,i,r,n,o,s,a,l=this.tree;for(var h in this.selectedNodes)if(o=this.selectedNodes[h],(s=l.getDelegate(h))&&(a=s.instanceTree)){for(i=0;i<o.length;++i)for(r=a.getNodeParentId(o[t]);r;)l.removeClass(s,r,"ancestor-selected"),r=a.getNodeParentId(r);l.clearSelection(s)}for(this.selectedNodes={},t=0;t<e.length;++t)if(n=e[t].model,o=e[t].dbIdArray||e[t].selection,(s=l.getDelegate(n.id))&&(a=s.instanceTree)){for(i=0;i<o.length;++i)for(r=a.getNodeParentId(o[t]);r;)l.addClass(s,r,"ancestor-selected"),r=a.getNodeParentId(r);l.setSelection(s,o),this.selectedNodes[n.id]=o.concat()}},d.prototype.scrollToSelection=function(e){var t=e[0];if(t){var i=t.model,r=t.dbIdArray||t.selection,n=this.tree.scrollTo(r[0],i),o=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=n;var s=this.scrollContainer.scrollTop;this.scrollContainer.scrollTop=o,this.options.scrollEaseSpeed>0?this.animateScroll(o,s,function(e){this.tree.setScroll(e)}.bind(this)):(this.scrollContainer.scrollTop=s,this.tree.setScroll(s))}},d.prototype.onEyeIcon=function(e,t){var i,r;null===(i=(r=this.options).onVisibilityIconClick)||void 0===i||i.call(r,e,t),c.analytics.track("viewer.model_browser",{from:"Panel",action:"Toggle Visibility"})},d.prototype.onTreeNodeClick=function(e,t,i,r){if(this._trackNodeClick&&(a.logger.track({category:"node_selected",name:"model_browser_tool"}),this._trackNodeClick=!1),!this.isMac||!r.ctrlKey){var n="click";this.ctrlDown(r)&&(n+="Ctrl"),r.shiftKey&&(n+="Shift"),r.altKey&&(n+="Alt");var o=["toggleOverlayedSelection"],s=this.clickConfig[n];s&&(o=s.onObject),c.analytics.track("viewer.model_browser",{from:"Panel",action:"Select"}),this.handleAction(o,t,i)}},d.prototype.onTreeNodeRightClick=function(e,t,i,r){if(this.isMac&&r.ctrlKey&&0===r.button)return this.clickConfig&&this.clickConfig.clickCtrl&&this.handleAction(this.clickConfig.clickCtrl.onObject,t,i),null;this.options.onTreeNodeRightClick&&this.options.onTreeNodeRightClick(r)},d.prototype.handleAction=function(e,t,i){var r,n,o,s,a,l,h,c,u,d,p,f,m,g,v,y;for(var b in e)switch(e[b]){case"toggleOverlayedSelection":this.toggleOverlayedSelection(t,i);break;case"toggleMultipleOverlayedSelection":this.toggleMultipleOverlayedSelection(t,i);break;case"selectOnly":this.options.onSelectOnly&&this.options.onSelectOnly(t,i);break;case"deselectAll":null===(r=(n=this.options).onDeselectAll)||void 0===r||r.call(n,t,i);break;case"selectToggle":null===(o=(s=this.options).onSelectToggle)||void 0===o||o.call(s,t,i);break;case"isolate":null===(a=(l=this.options).onIsolate)||void 0===a||a.call(l,t,i);break;case"showAll":null===(h=(c=this.options).onShowAll)||void 0===h||h.call(c,t,i);break;case"focus":null===(u=(d=this.options).onFocus)||void 0===u||u.call(d,t,i);break;case"hide":null===(p=(f=this.options).onHide)||void 0===p||p.call(f,t,i);break;case"show":null===(m=(g=this.options).onShow)||void 0===m||m.call(g,t,i);break;case"toggleVisibility":null===(v=(y=this.options).onToggleVisibility)||void 0===v||v.call(y,t,i)}},d.prototype.toggleOverlayedSelection=function(e,t){var i,r,n=this.selectedNodes[t.id],o=n?n.indexOf(e):-1;this._ignoreScroll=!0,null===(i=(r=this.options).onToggleOverlayedSelection)||void 0===i||i.call(r,e,t,-1!==o)},d.prototype.toggleMultipleOverlayedSelection=function(e,t){var i=this.selectedNodes[t.id],r=i?i.indexOf(e):-1;if(-1===r?(i||(i=this.selectedNodes[t.id]=[]),i.push(e)):i.splice(r,1),this.options.onToggleMultipleOverlayedSelection){var n=[];for(var o in this.selectedNodes)if(Object.prototype.hasOwnProperty.call(this.selectedNodes,o)){var s=this.selectedNodes[o];n.push({modelId:o,ids:s})}this.options.onToggleMultipleOverlayedSelection(n)}this._ignoreScroll=!0},d.prototype.ctrlDown=function(e){return this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey}},57869:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ViewerObjectContextMenu:()=>o});var r=i(47838),n=i(60489);function o(e){r.ObjectContextMenu.call(this,e)}o.prototype=Object.create(r.ObjectContextMenu.prototype),o.prototype.constructor=o,o.prototype.buildMenu=function(e,t){if(!this.viewer.model)return;var i=this,r=[],o=this.viewer.navigation,s=this.viewer.model.is2d();const a=Autodesk.Viewing.Private.analytics;t.hasSelected&&(r.push({title:"Isolate",target:function(){var e=i.viewer.getAggregateSelection();i.viewer.clearSelection(),i.viewer.impl.visibilityManager.aggregateIsolate(e),n.logger.track({name:"isolate_count",aggregate:"count"}),a.track("viewer.object.visibility",{action:"Isolate"})}}),t.hasVisible&&r.push({title:"Hide Selected",target:function(){const e=i.viewer.impl.selector.getAggregateSelection();i.viewer.clearSelection(),i.viewer.impl.visibilityManager.aggregateHide(e),a.track("viewer.object.visibility",{action:"Hide Selected"})}}),t.hasHidden&&r.push({title:"Show Selected",target:function(){var e=i.viewer.getSelection();i.viewer.clearSelection(),i.viewer.show(e),a.track("viewer.object.visibility",{action:"Show Selected"})}})),s&&r.push({title:"Show All Layers",target:function(){i.viewer.setLayerVisible(null,!0),a.track("viewer.object.visibility",{action:"Show All Layers"})}}),r.push({title:"Show All Objects",target:function(){i.viewer.showAll(),n.logger.track({name:"showall",aggregate:"count"}),a.track("viewer.object.visibility",{action:"Show All Objects"})}});var l=i.viewer.getAggregateSelection();if(!s&&1===l.length&&o.isActionEnabled("gotoview")&&r.push({title:"Focus",target:function(){if((l=i.viewer.getAggregateSelection()).length>0){var e=l[0];i.viewer.fitToView(e.selection,e.model)}else 0===l.length&&i.viewer.fitToView();n.logger.track({name:"fittoview",aggregate:"count"})}}),!s){var h=this.viewer.impl.getCanvasBoundingClientRect(),c=e.clientX-h.left,u=e.clientY-h.top,d=this.viewer.clientToWorld(c,u,!1);d&&r.push({title:"Pivot",target:()=>{this.viewer.navigation.setPivotPoint(d.point)}})}return t.hasSelected&&r.push({title:"Clear Selection",target:function(){i.viewer.clearSelection(),n.logger.track({name:"clearselection",aggregate:"count"})}}),r}},38241:(e,t,i)=>{"use strict";function r(){this.getContainerBoundingRect=function(){var e=this.parentContainer.getBoundingClientRect(),t={height:0,width:0,left:0,bottom:0,right:0,top:0},i=this.getDocument().getElementsByClassName("toolbar-menu");return i&&i.length>0&&(t=i[0].getBoundingClientRect()),{height:e.height-t.height,width:e.width,left:e.left,bottom:e.bottom-t.height,right:e.right,top:e.top}}}i.r(t),i.d(t,{ViewerPanelMixin:()=>r})},66417:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ViewerPropertyPanel:()=>l});var r=i(36749),n=i(38241),o=i(18878),s=i(90650),a=i(60489);function l(e){this.viewer=e,this.setGlobalManager(e.globalManager),this.currentNodeIds=[],this.currentModel=null,this.currentSelections=[],this.isDirty=!0,this.propertyNodeId=null,this.normalTitle="Properties",this.loadingTitle="Object Properties Loading",this._viewDbId=null,this.onProperties=this.onProperties.bind(this),this.onPropertySet=this.onPropertySet.bind(this),this.onPropError=this.onPropError.bind(this),this.setPropertiesIntoUI=this.setPropertiesIntoUI.bind(this),this.setAggregatedPropertiesIntoUI=this.setAggregatedPropertiesIntoUI.bind(this),this._onDisplayUnitPreferenceChanged=this._onDisplayUnitPreferenceChanged.bind(this),r.PropertyPanel.call(this,e.container,"ViewerPropertyPanel",this.loadingTitle)}function h(e){var t=e.getDocumentNode(),i=t&&t.findViewableParent();return!(!i||-1===i.name().toLocaleLowerCase().indexOf(".sld"))}l.prototype=Object.create(r.PropertyPanel.prototype),l.prototype.constructor=l,n.ViewerPanelMixin.call(l.prototype),l.prototype._onDisplayUnitPreferenceChanged=function(){this.isDirty=!0;const e=this.currentModel?this.currentModel.getRootId():null;if(null!==this.propertyNodeId&&this.propertyNodeId!==e){const e={model:this.currentModel};e.selection=Array.isArray(this.propertyNodeId)?this.propertyNodeId:[this.propertyNodeId],this.requestAggregatedNodeProperties(e)}else this.requestProperties()},l.prototype.initialize=function(){r.PropertyPanel.prototype.initialize.call(this);var e=this;this.viewer.prefs.addListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS,this._onDisplayUnitPreferenceChanged),this.viewer.prefs.addListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS_PRECISION,this._onDisplayUnitPreferenceChanged),e.addEventListener(e.viewer,o.AGGREGATE_SELECTION_CHANGED_EVENT,(function(t){t.selections&&t.selections.length?(e.currentNodeIds=t.selections[0].dbIdArray,e.currentModel=t.selections[0].model,e.currentSelections=[],t.selections.forEach((t=>{e.currentSelections.push({model:t.model,selection:t.dbIdArray})}))):e.resetCurrentModel(),e.isDirty=!0,e.requestProperties()})),e.addEventListener(e.viewer,o.SHOW_PROPERTIES_EVENT,(function(t){t&&t.dbId&&(e.currentModel=t.model,e.requestAggregatedNodeProperties({model:t.model,selection:[t.dbId]}))})),e.addEventListener(e.viewer,o.HIDE_EVENT,(function(t){e.isDirty=!0,e.requestProperties()})),e.addEventListener(e.viewer,o.OBJECT_TREE_CREATED_EVENT,(function(t){e.currentModel===t.model&&(e.isDirty=!0,e.requestProperties())})),e.addEventListener(e.viewer,o.SHOW_EVENT,(function(t){e.isDirty=!0,e.requestProperties()}));var t=this.viewer.getAggregateSelection();t.length?(this.currentModel=t[0].model,this.currentNodeIds=t[0].selection,this.currentSelections=t):this.resetCurrentModel()},l.prototype.resetCurrentModel=function(){var e=this.viewer?this.viewer.getVisibleModels():[];this.currentModel=1===e.length?e[0]:null,this.currentNodeIds=[],this.currentSelections=[]},l.prototype.setTitle=function(e,t){e||(e="Object Properties",(t=t||{}).localizeTitle=!0),r.PropertyPanel.prototype.setTitle.call(this,e,t)},l.prototype.setVisible=function(e){s.DockingPanel.prototype.setVisible.call(this,e),this.requestProperties()},l.prototype.visibilityChanged=function(){s.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},l.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentSelections.length>0?this.requestAggregatedNodeProperties(this.currentSelections):this.showDefaultProperties(),this.isDirty=!1)},l.prototype.onProperties=function(e){if(!this.viewer||!this.currentModel)return;if(e.dbId!==this.propertyNodeId)return;var t,i=[],r=e.properties;if(r)for(var n=0,o=r.length;n<o;++n){var s=r[n];"__internalref__"===s.displayCategory&&i.push(s.displayValue)}const a=this.currentModel;t=a.is3d()&&h(a)&&i.length>0?function(e,t,i){return new Promise((function(r,n){e.getBulkProperties2(t,{ignoreHidden:!0},(function(e){for(var t=0,n=e.length;t<n;++t)for(var o=e[t],s=0,a=o.properties.length;s<a;++s){for(var l=o.properties[s],h=!0,c=0,u=i.properties.length;c<u;++c)i.properties[c].displayName===l.displayName&&(h=!1,c=u);h&&i.properties.push(l)}r(i)}))}))}(a,i,e):Promise.resolve(e),t.then(this.setPropertiesIntoUI).catch((()=>{this.setProperties([]),this.highlight(""),this.resizeToContent(),this.respositionPanel()}))},l.prototype.onPropertySet=function(e){if(!this.viewer||!this.currentModel)return;if(0===e.getVisibleKeys().length)return this.onPropError(),this.resizeToContent(),void this.respositionPanel();const t=e.map,i=[];let r;e.getValidIds(null,"__internalref__").forEach((e=>{t[e].forEach((e=>{i.includes(e.displayValue)||i.push(e.displayValue)}))}));const n=this.currentModel;r=n.is3d()&&h(n)&&i.length>0?function(e,t,i){return new Promise(((r,n)=>{e.getPropertySet(t,(e=>{r(i.merge(e))}),n,{ignoreHidden:!0})}))}(n,i,e):Promise.resolve(e),r.then(this.setAggregatedPropertiesIntoUI).catch((e=>{a.logger.error(e),this.setProperties([]),this.highlight(""),this.resizeToContent(),this.respositionPanel()}))},l.prototype.setAggregatedPropertiesIntoUI=function(e){const t=e.getDbIds().length;if(1===t){let t=Object.prototype.hasOwnProperty.call(e.map,"Name"),i=t?e.map.Name[0]:this.normalTitle;"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"displayValue")&&(t=!0,i=i.displayValue),this.setTitle(i,{localizeTitle:!t})}else this.setTitle("Properties %(value)",{localizeTitle:!0,i18nOpts:{value:`(${t})`}});this.setAggregatedProperties(e),this.highlight(this.viewer.searchText),this.resizeToContent(),this.respositionPanel()},l.prototype.setPropertiesIntoUI=function(e){var t=e.name||this.normalTitle,i=!e.name;this.setTitle(t,{localizeTitle:i}),"name"in e&&e.properties&&e.properties.splice(0,0,{displayName:"Name",displayValue:e.name,displayCategory:null,attributeName:"Name",type:20,units:null,hidden:!1,precision:0}),this.setProperties(e.properties),this.highlight(this.viewer.searchText),this.resizeToContent(),this.respositionPanel()},l.prototype.onPropError=function(){this.setTitle(this.normalTitle,{localizeTitle:!0}),this.showNoProperties()},l.prototype.requestAggregatedNodeProperties=function(e){var t;1===(e=Array.isArray(e)?e:[e]).length&&1===(null===(t=e[0].selection)||void 0===t?void 0:t.length)&&(this.propertyNodeId=e[0].selection[0]);const i=[];e.forEach((e=>{var t,r;i.push(e.model.getPropertySetAsync(e.selection,{fileType:null===(t=e.model.getData())||void 0===t||null===(t=t.loadOptions)||void 0===t?void 0:t.fileExt,needsExternalId:null===(r=e.model.getData())||void 0===r||null===(r=r.loadOptions)||void 0===r?void 0:r.needsExternalId}))})),Promise.all(i).then((e=>{const t=e[0];for(let i=1;i<e.length;i++)t.merge(e[i]);this.onPropertySet(t)})).catch(this.onPropError)},l.prototype.requestNodeProperties=function(e){const t=this.currentModel;this.propertyNodeId=e;const i=Array.isArray(e);(i?t.getPropertySet.bind(t):t.getProperties2.bind(t))(e,(e=>{this.viewer&&t===this.currentModel&&(i?this.onPropertySet(e):this.onProperties(e))}),this.onPropError)},l.prototype.setNodeProperties=l.prototype.requestNodeProperties,l.prototype.requestViewProperties=function(e){if(null!==this._viewDbId){const e={model:this.currentModel,selection:[this._viewDbId]};return void this.requestAggregatedNodeProperties(e)}const t=this.currentModel,i=t.getRootId();this.propertyNodeId=i,t.getPropertySet([i],(r=>{if(!this.viewer)return;if(t!==this.currentModel)return;this._viewDbId=i;const n=e.name(),o=e.isSheet(),s=[],a=[],l=r.getValidIds("Sheet"),h=r.getValidIds("View");l.forEach((e=>{r.map[e].forEach((e=>{a.push(e.displayValue)}))})),h.forEach((e=>{r.map[e].forEach((e=>{s.push(e.displayValue)}))}));const c=o?a:s;if(0!==c.length){var u=this;t.getBulkProperties2(c,{propFilter:["name","dbId"],ignoreHidden:!0},(function(e){const s=[];for(let t=0;t<e.length;++t)if(-1!==n.indexOf(e[t].name)){const i=e[t].dbId;if(!o)return u._viewDbId=i,void u.requestAggregatedNodeProperties({model:u.currentModel,selection:[i]});s.push(i)}0!==s.length?function(e,t,i){return new Promise((function(r,n){i=i||e.myData.metadata.title,e.getBulkProperties2(t,{ignoreHidden:!0},(function(e){for(var t=0,n=e.length;t<n;++t){var o=e[t];if(o.name&&-1!==i.indexOf(o.name))for(var s=0,a=o.properties.length;s<a;++s){var l=o.properties[s];if("Sheet Number"===l.displayName&&-1!==i.indexOf(l.displayValue))return r(o)}}return r(null)}))}))}(t,s,n).then((function(e){e&&e.dbId&&e.dbId!==i?(u._viewDbId=e.dbId,u.requestAggregatedNodeProperties({model:u.currentModel,selection:[e.dbId]})):u.onPropertySet(r)})):u.onPropertySet(r)}))}else this.onPropertySet(r)}),this.onPropError)},l.prototype.respositionPanel=function(){if(this.isVisible()){var e=this.viewer.toolController,t=e.lastClickX,i=e.lastClickY,r=this.container.getBoundingClientRect(),n=r.left,o=r.top,s=r.width,a=r.height,l=this.viewer.impl.getCanvasBoundingClientRect(),h=l.left,c=l.top,u=l.width,d=l.height;n<=t&&t<n+s&&o<=i&&i<o+a&&(t<n+s/2&&t+s<h+u?(this.container.style.left=Math.round(t-h)+"px",this.container.dockRight=!1):h<=t-s?(this.container.style.left=Math.round(t-h-s)+"px",this.container.dockRight=!1):t+s<h+u?(this.container.style.left=Math.round(t-h)+"px",this.container.dockRight=!1):i+a<c+d?(this.container.style.top=Math.round(i-c)+"px",this.container.dockBottom=!1):c<=i-a&&(this.container.style.top=Math.round(i-c-a)+"px",this.container.dockBottom=!1))}},l.prototype.showDefaultProperties=function(){var e=this.currentModel?this.currentModel.getRootId():null;if(e){const t=this.currentModel.getDocumentNode();t&&!t.isMasterView()?this.requestViewProperties(t):this.requestAggregatedNodeProperties({model:this.currentModel,selection:[e]})}else this.propertyNodeId=null,this.setTitle(this.normalTitle,{localizeTitle:!0}),r.PropertyPanel.prototype.showDefaultProperties.call(this)},l.prototype.areDefaultPropertiesShown=function(){if(!this.currentModel)return!1;var e=this.currentModel.getRootId();return this.propertyNodeId===e},l.prototype.uninitialize=function(){r.PropertyPanel.prototype.uninitialize.call(this),this.viewer.prefs.removeListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS,this._onDisplayUnitPreferenceChanged),this.viewer.prefs.removeListeners(Autodesk.Viewing.Private.Prefs.DISPLAY_UNITS_PRECISION,this._onDisplayUnitPreferenceChanged),this.viewer=null,this._viewDbId=null,this.currentModel=null,this.currentSelections=[],this.propertyNodeId=null,this.currentNodeIds=null},l.prototype.onCategoryClick=function(e,t){r.PropertyPanel.prototype.onCategoryClick.call(this,e,t),this.resizeToContent()},l.prototype.onCategoryIconClick=function(e,t){r.PropertyPanel.prototype.onCategoryIconClick.call(this,e,t),this.resizeToContent()}},95277:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ViewerSettingTab:()=>E,ViewerSettingsPanel:()=>S});var r=i(51370),n=i(18878),o=i(60489),s=i(52156),a=i(91493),l=i(7247),h=i(38241),c=i(76542);class u{constructor(e,t){this._width=e||60,this._height=t||60}createThumbnail(e,t){return new Promise((t=>{var i=this.getDocument().createElement("canvas");i.width=this._width,i.height=this._height;var r=i.getContext("2d"),n=r.createLinearGradient(0,0,0,i.height),o=e.bgColorGradient,s=d(o[0],o[1],o[2]),a=d(o[3],o[4],o[5]);n.addColorStop(0,s),n.addColorStop(1,a),r.fillStyle=n,r.fillRect(0,0,i.width,i.height),i.toBlob((function(e){var i=URL.createObjectURL(e);t(i)}))}))}}function d(e,t,i){return e=parseInt(e),t=parseInt(t),i=parseInt(i),"#"+p(e)+p(t)+p(i)}function p(e){if(0===e)return"00";for(var t="",i=e>255?255:e;0!==i;){var r=i%16;i=i/16|0,t=f[r.toString()]+t}return t.length>1?t:"0"+t}c.GlobalManagerMixin.call(u.prototype);const f={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"};var m=i(23279),g=i.n(m),v=i(64141),y=i(44135),b=i(47654);const x=Autodesk.Viewing.Private;let _=0,E={Navigation:"navigationtab",Configuration:"performancetab",Appearance:"appearance",Environment:"environment"};var A=0;function S(e,t){let i={...e};if(e instanceof Autodesk.Viewing.GuiViewer3D||e instanceof Autodesk.Viewing.Viewer3D){const r=e;i={preferences:r.prefs,globalManager:r.globalManager,addEventListener:r.addEventListener.bind(r),removeEventListener:r.removeEventListener.bind(r),container:r.container,version:r.config.viewerVersion,onRestoreDefaults:r.restoreDefaultSettings.bind(r),detectIfModelsHaveEdge:()=>{if(t.is2d())return!1;let e=!1;const i=r.impl.modelQueue().getModels();for(let t=0;t<i.length;t++){if(i[t].hasEdges){e=!0;break}}return e},loadExtension:e=>{r.loadExtension(e)},unloadExtension:e=>{r.unloadExtension(e)},width:400,heightAdjustment:110}}this.options=i,this.preferences=i.preferences,this.is3dMode=!t.is2d(),this.visible=!1,this._externalButtonIds=[],this._externalButtonsLabel=null,r.SettingsPanel.call(this,this.options.container,"ViewerSettingsPanel"+_+++"-"+A++,"Settings",i),this.container.classList.add("viewer-settings-panel"),this.setGlobalManager(this.options.globalManager),this.addTab(E.Configuration,"Configuration",{className:"performance"}),this.addTab(E.Navigation,"Navigation",{className:"navigation"}),this.addTab(E.Appearance,"Appearance",{className:"appearance"}),this.is3dMode?this.addTab(E.Environment,"Environment",{className:"environment"}):this.container.classList.add("for-2d-model"),this.createRestoreDefaultSettingsButton(),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createConfigurationPanel(),this.createAppearancePanel(),this.modelPreferenceCount&&o.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI."),this.selectTab(E.Configuration),this.footer=this.createFooter(),this.createVersionLabel(this.footer),this.syncUI=this.syncUI.bind(this),this.options.addEventListener(n.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),this.options.addEventListener(n.VIEWER_STATE_RESTORED_EVENT,this.syncUI),this.updateEdgeToggle=this.updateEdgeToggle.bind(this),this.options.addEventListener(n.GEOMETRY_LOADED_EVENT,this.updateEdgeToggle),this.sendAnalyticsDebounced=g()(((e,t)=>{x.analytics.track("viewer.settings.changed",{setting_name:e,setting_value:t})}),500)}function w(e,t,i){e.createThumbnail(i).then((e=>{t.src=e,t.onload=function(){URL.revokeObjectURL(e)}}))}S.prototype=Object.create(r.SettingsPanel.prototype),S.prototype.constructor=S,h.ViewerPanelMixin.call(S.prototype),S.prototype.uninitialize=function(){var e,t,i,o,s,a;this._onBgEnvironmentChange&&this._onBgEnvironmentReset&&(this.preferences.removeListeners(x.Prefs3D.LIGHT_PRESET,this._onBgEnvironmentChange,this._onBgEnvironmentReset),this._onBgEnvironmentChange=null,this._onBgEnvironmentReset=null),null===(e=(t=this.options).removeEventListener)||void 0===e||e.call(t,n.RESTORE_DEFAULT_SETTINGS_EVENT,this.syncUI),null===(i=(o=this.options).removeEventListener)||void 0===i||i.call(o,n.VIEWER_STATE_RESTORED_EVENT,this.syncUI),null===(s=(a=this.options).removeEventListener)||void 0===s||s.call(a,n.GEOMETRY_LOADED_EVENT,this.updateEdgeToggle),r.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},S.prototype.setVisible=function(e){this.visible=e,r.SettingsPanel.prototype.setVisible.call(this,e),e&&this.sizeToContent(),e&&this.createEnvironmentPanel()},S.prototype.addCheckbox=function(e,t,i,n,o,s){const{preferences:a}=this;var l=a[s];n="boolean"==typeof l?l:n;var h=r.SettingsPanel.prototype.addCheckbox.call(this,e,t,n,(function(e){s&&(a.set(s,e),x.analytics.track("viewer.settings.changed",{setting_name:s,setting_value:e})),o&&o(e)}),i),c=this.getControl(h);return c.saveKey=s,s?a.addListeners(s,(function(e){c.setValue(e)}),(function(e){c.setValue(e),o&&o(e)})):c.sliderRow.classList.add("logical-group"),a.hasTag(s,"no-storage")&&(c.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),h},S.prototype.addDropDownMenu=function(e,t,i,n,o,s,a){const{preferences:l}=this;s&&(o=n.indexOf(l.get(s)));const h=r.SettingsPanel.prototype.addDropDownMenu.call(this,e,t,i,o,(function(e){s&&("displayUnits"==s?l.set(s,new y.EnumType(b.displayUnitsEnum,n[e.detail.value])):"displayUnitsPrecision"==s?l.set(s,new y.EnumType(b.displayUnitsPrecisionEnum,n[e.detail.value])):l.set(s,n[e.detail.value]),x.analytics.track("viewer.settings.changed",{setting_name:s,setting_value:n[e.detail.value]}))}),a),c=this.getControl(h);return s?l.addListeners(s,(function(e){c.setSelectedIndex(n.indexOf(e))}),(function(e){c.setSelectedIndex(n.indexOf(e))})):c.sliderRow.classList.add("logical-group"),l.hasTag(s,"no-storage")&&(c.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),h},S.prototype.addSliderV2=function(e,t,i,n,o,s,a,l){const{preferences:h}=this;var c=h.get(l);s="number"==typeof c?c:s,l&&!Object.prototype.hasOwnProperty.call(h,l)&&h.add(l,s,["2d","3d"]);var u=r.SettingsPanel.prototype.addSliderV2.call(this,e,t,i,n,o,s,(function(e){var t="number"==typeof e?e:Number(e.detail.value);l&&h.set(l,t)}),a),d=this.getControl(u[1]);return d.saveKey=l,l?h.addListeners(l,(function(e){d.setValue(e)})):d.sliderRow.classList.add("logical-group"),h.hasTag(l,"no-storage")&&(d.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),u},S.prototype.addGrid=function(e,t,i,r){const{preferences:n}=this;var o=e,s=this.getDocument(),l=s.createElement("div");l.classList.add("environments-container"),o.appendChild(l);var h=s.createElement("div");h.classList.add("environments-lighting-table"),l.appendChild(h);var c=new u(42,26);c.setGlobalManager(this.globalManager);for(var d=0;d<t.length;d++){let e=t[d];var p=s.createElement("div");p.classList.add("settings-environment-cell"),p.index=d;var f=s.createElement("img");f.classList.add("settings-environment-image"),w(c,f,e),p.appendChild(f);var m=s.createElement("span");m.textContent=a.Z.t(e.name),m.classList.add("settings-environment-name"),m.setAttribute("data-i18n",e.name),p.appendChild(m),p.addEventListener("click",(function(){n.set(r,this.index)})),h.appendChild(p)}return this.preferences.addListeners(r,i),h},S.prototype.updateEnvironmentSelection=function(){if(this.is3dMode&&this.envTabCreated){var e=this.preferences.get("lightPreset");if("string"==typeof e){e=s.LightPresets.map((e=>e.name)).indexOf(e)}for(var t=this.gridTable.querySelectorAll(".settings-environment-cell"),i=0;i<t.length;i++)t[i].index===e?t[i].classList.add("border-select"):t[i].classList.remove("border-select")}},S.prototype.removeCheckbox=function(e){return this.preferences.removeListeners(e.saveKey),this.removeEventListener(e,"change",e.changeListener),r.SettingsPanel.prototype.removeCheckbox.call(this,e)},S.prototype.createNavigationPanel=function(){var e=E.Navigation;function t(){return this.addSliderV2(e,"Drag Speed","Changes sensitivity of mouse movement with the zoom tool",5,300,this.options.initialZoomDragSpeed,{step:5},v.Prefs.ZOOM_DRAG_SPEED)[1]}function i(){return this.addSliderV2(e,"Scroll Speed","Changes sensitivity of the mouse scroll wheel when zooming",.1,3,this.options.initialZoomScrollScale,{step:.1},v.Prefs.ZOOM_SCROLL_SPEED)[1]}this.is3dMode&&(this.addLabel(e,"ViewCube"),this.addCheckbox(e,"Show ViewCube","Toggles availability of the ViewCube navigation control",!0,void 0,v.Prefs3D.VIEW_CUBE),(0,l.isMobileDevice)()||this.addCheckbox(e,"ViewCube acts on pivot","When enabled, the ViewCube orbits the view around the active pivot point When disabled, it orbits around the center of the view",!1,void 0,v.Prefs3D.ALWAYS_USE_PIVOT),this.addLabel(e,"Orbit"),this.addCheckbox(e,"Fusion style orbit","Enables Fusion-style orbit overlay and gives the ability to lock orbit axis",!1,(e=>{e?this.options.loadExtension("Autodesk.Viewing.FusionOrbit",null):this.options.unloadExtension("Autodesk.Viewing.FusionOrbit",null)}),v.Prefs.FUSION_ORBIT),this.addCheckbox(e,"Orbit past world poles","Allows view rotation to continue past the models North Pole",!0,void 0,v.Prefs3D.ORBIT_PAST_WORLD_POLES),this.addLabel(e,"Zoom"),(0,l.isMobileDevice)()||(this.addCheckbox(e,"Zoom towards pivot","When disabled, zooming operations are centered at the current cursor location",!1,void 0,v.Prefs3D.ZOOM_TOWARDS_PIVOT),this.addCheckbox(e,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,void 0,v.Prefs.REVERSE_MOUSE_ZOOM_DIR),this.scrollSpeed=i.call(this)),this.dragSpeed=t.call(this),this.addLabel(e,"Mouse"),(0,l.isMobileDevice)()||(this.addCheckbox(e,"Left handed mouse setup","Swaps the buttons on the mouse",!1,void 0,v.Prefs.LEFT_HANDED_MOUSE_SETUP),this.addCheckbox(e,"Set pivot with left mouse button","Change left-click behavior to set new pivot point (overrides select object)",!1,void 0,v.Prefs3D.CLICK_TO_SET_COI)),this.addCheckbox(e,"Open properties on select","Always show properties upon selecting object",!0,void 0,v.Prefs.OPEN_PROPERTIES_ON_SELECT)),this.is3dMode||(this.addLabel(e,"Zoom"),this.addCheckbox(e,"Reverse mouse zoom direction","Toggles direction of zooming in and out",!1,void 0,v.Prefs.REVERSE_MOUSE_ZOOM_DIR),(0,l.isMobileDevice)()||(this.scrollSpeed=i.call(this)),this.dragSpeed=t.call(this),this.addLabel(e,"Mouse"),this.addCheckbox(e,"Open properties on select","Always show properties upon selecting object",!0,void 0,v.Prefs.OPEN_PROPERTIES_ON_SELECT),(0,l.isMobileDevice)()||this.addCheckbox(e,"Left handed mouse setup","Swaps the buttons on the mouse",!1,void 0,v.Prefs.LEFT_HANDED_MOUSE_SETUP))},S.prototype.addConfigButton=function(e,t){if(!t)throw new Error("Must register a function callback.");this._externalButtonsLabel||(this._externalButtonsLabel=this.addLabel(E.Configuration,"More"));var i=this.addButton(E.Configuration,e);return this.getControl(i).setOnClick((()=>{this.setVisible(!1),t()})),this._externalButtonIds.push(i),i},S.prototype.removeConfigButton=function(e){var t=this._externalButtonIds.indexOf(e);if(-1===t)return!1;var i=this.getControl(e);return!!i&&(this.removeControl(i),this._externalButtonIds.splice(t,1),0===this._externalButtonIds.length&&null!==this._externalButtonsLabel&&(this._externalButtonsLabel.removeFromParent(),this._externalButtonsLabel=null),!0)},S.prototype.updateEdgeToggle=function(){const e=document.getElementById(this.edgeCheckboxName+"_check");if(!e)return;if(!this.is3dMode)return;this.options.detectIfModelsHaveEdge()?e.disabled=!1:(e.disabled=!0,e.checked=!1)},S.prototype.createConfigurationPanel=function(){var e=E.Configuration;this.is3dMode?(this.addLabel(e,"Performance Optimization"),this.optimizeNavigationhkBoxId=this.addCheckbox(e,"Smooth navigation","Provides faster response(but degrades quality) while navigating",(0,l.isMobileDevice)(),void 0,v.Prefs3D.OPTIMIZE_NAVIGATION),this.progressiveRenderChkBoxId=this.addCheckbox(e,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,void 0,v.Prefs.PROGRESSIVE_RENDERING),this.addLabel(e,"Display"),this.ghosthiddenChkBoxId=this.addCheckbox(e,"Ghost hidden objects","Leave hidden objects slightly visible",!0,void 0,v.Prefs3D.GHOSTING),this.displayLinesId=this.addCheckbox(e,"Display Lines","Toggles display of line objects",!0,void 0,v.Prefs3D.LINE_RENDERING),this.displayPointsId=this.addCheckbox(e,"Display Points","Toggles display of point objects",!0,void 0,v.Prefs.POINT_RENDERING),this.edgeCheckboxName="Display edges",this.displayEdgesId=this.addCheckbox(e,this.edgeCheckboxName,"Shows outline of model surfaces",!1,(e=>{this.getControl(this.displayEdgesId).setValue(e),this.updateEdgeToggle()}),v.Prefs3D.EDGE_RENDERING),this.updateEdgeToggle(),this.displaySectionHatchesId=this.addCheckbox(e,"Display Section Hatches","Shows hatch pattern for section planes this does not apply to section boxes",!0,null,x.Prefs3D.DISPLAY_SECTION_HATCHES)):(this.addLabel(e,"Performance Optimization"),this.progressiveRenderChkBoxId=this.addCheckbox(e,"Progressive display","Shows incremental updates of the view and allows for more responsive interaction with the model (some elements may flicker) This improves perceived waiting time",!0,void 0,v.Prefs.PROGRESSIVE_RENDERING),this.addLabel(e,"Display")),this.displayUnitsId=this.addDropDownMenu(e,"Display Units",x.displayUnits,x.displayUnitsEnum,null,x.Prefs.DISPLAY_UNITS),this.displayUnitsPrecisionId=this.addDropDownMenu(e,"Precision",x.displayUnitsPrecision,x.displayUnitsPrecisionEnum,null,x.Prefs.DISPLAY_UNITS_PRECISION),this.is3dMode&&this._addSelectionModeOption()},S.prototype._addSelectionModeOption=function(){const e=E.Configuration;this.addLabel(e,"Selection");const t=[],i=[];let r=0;for(let e in Autodesk.Viewing.SelectionMode)t[r]=e,i[r]=Autodesk.Viewing.SelectionMode[e],r++;const n=t.map((e=>e.split("_").map((e=>e.charAt(0)+e.slice(1).toLowerCase())).join(" ")));this.selectionModeId=this.addDropDownMenu(e,"Selection Mode",n,i,null,x.Prefs3D.SELECTION_MODE)},S.prototype.createAppearancePanel=function(){var e=E.Appearance;this.is3dMode?(this.addLabel(e,"Visual Quality Optimization"),this.antialiasingChkBoxId=this.addCheckbox(e,"Anti-aliasing","Remove jagged edges from lines",!0,void 0,v.Prefs3D.ANTIALIASING),this.ambientshadowsChkBoxId=this.addCheckbox(e,"Ambient shadows","Improve shading of occluded surfaces",!0,void 0,v.Prefs3D.AMBIENT_SHADOWS),this.groundShadowChkBoxId=this.addCheckbox(e,"Ground shadow","Add simulated ground surface shadows",!0,void 0,v.Prefs3D.GROUND_SHADOW),this.groundReflectionChkBoxId=this.addCheckbox(e,"Ground reflection","Add simulated ground surface reflections",!1,void 0,v.Prefs3D.GROUND_REFLECTION)):(this.addLabel(e,"Existing behavior"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(e,"2D Sheet Color","Switch sheet color white to black",!0,void 0,v.Prefs2D.SWAP_BLACK_AND_WHITE),this.loadingAnimationChkBoxId=this.addCheckbox(e,"Loading Animation","Animate lines during loading",!0,void 0,v.Prefs2D.LOADING_ANIMATION))},S.prototype.createEnvironmentPanel=function(){if(this.is3dMode&&!this.envTabCreated){this.envTabCreated=!0;var e=E.Environment,t=this.tablesContainer.childNodes[3];this.gridTable=t,this.addLabel(e,"Environment"),this.envMapBackgroundChkBoxId=this.addCheckbox(e,"Environment Image Visible","Shows lighting environment as background",!0,void 0,v.Prefs3D.ENV_MAP_BACKGROUND);var i=t.tBodies[0].insertRow(-1).insertCell(0),r=this.getDocument();this.caption=r.createElement("div"),this.caption.setAttribute("data-i18n","Environments and Lighting Selection"),this.caption.textContent=a.Z.t("Environments and Lighting Selection"),this.caption.classList.add("settings-row-title"),i.appendChild(this.caption),i.colSpan="3",this.envSelect=this.addGrid(t,s.LightPresets,this.updateEnvironmentSelection.bind(this),x.Prefs3D.LIGHT_PRESET),this.updateEnvironmentSelection(),this.envSelect.classList.add("with-environment")}},S.prototype.createVersionLabel=function(e){if(e){var t=this.getDocument();this.versionDiv=t.createElement("div"),this.versionDiv.textContent=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:LMV_VIEWER_VERSION;"@"===e.charAt(0)&&(e="0.0.0");return"v"+e}(this.options.version),this.versionDiv.className="docking-panel-version-label",this.addEventListener(this.versionDiv,"click",(e=>{e.shiftKey&&navigator.clipboard.writeText(this.versionDiv.textContent)})),e.appendChild(this.versionDiv)}},S.prototype.createRestoreDefaultSettingsButton=function(){var e=this.getDocument();this.restoreDiv=e.createElement("div"),this.restoreDiv.classList.add("docking-panel-container-solid-color-b"),this.restoreDiv.classList.add("restore-defaults-container"),this.restoreButton=e.createElement("div"),this.restoreButton.className="docking-panel-tertiary-button",this.restoreButton.setAttribute("data-i18n","Restore all default settings"),this.restoreButton.textContent=a.Z.t("Restore all default settings"),this.restoreDiv.appendChild(this.restoreButton),this.addEventListener(this.restoreDiv,"touchstart",l.touchStartToClick),this.addEventListener(this.restoreDiv,"click",(()=>{var e,t;null===(e=(t=this.options).onRestoreDefaults)||void 0===e||e.call(t),x.analytics.track("viewer.settings.default")}),!1),this.scrollContainer.appendChild(this.restoreDiv)},S.prototype.selectTab=function(e){r.SettingsPanel.prototype.selectTab.call(this,e),this.sizeToContent()},S.prototype.sizeToContent=function(){r.SettingsPanel.prototype.sizeToContent.call(this,this.options.container)},S.prototype.onViewerResize=function(e,t,i,r,n,o){this.sizeToContent()},S.prototype.syncUI=function(){var e=this.preferences;this.setControlValue(this.antialiasingChkBoxId,e.get("antialiasing")),this.setControlValue(this.ambientshadowsChkBoxId,e.get("ambientShadows")),this.setControlValue(this.groundShadowChkBoxId,e.get("groundShadow")),this.setControlValue(this.groundReflectionChkBoxId,e.get("groundReflection")),this.setControlValue(this.envMapBackgroundChkBoxId,e.get("envMapBackground")),this.setControlValue(this.progressiveRenderChkBoxId,e.get("progressiveRendering")),this.setControlValue(this.swapBlackAndWhiteChkBoxId,e.get("swapBlackAndWhite")),this.setControlValue(this.loadingAnimationChkBoxId,e.get("loadingAnimation")),this.setControlValue(this.ghosthiddenChkBoxId,e.get("ghosting")),this.setControlValue(this.displayLinesId,e.get("lineRendering")),this.setControlValue(this.displayPointsId,e.get("pointRendering")),this.setControlValue(this.displayEdgesId,e.get("edgeRendering")),this.setControlValue(this.displaySectionHatchesId,e.get("displaySectionHatches")),this.setControlValue(this.scrollSpeed,e.get("zoomScrollSpeed")),this.setControlValue(this.dragSpeed,e.get("zoomDragSpeed")),this.updateEnvironmentSelection()},S.prototype.setControlValue=function(e,t){var i=this.getControl(e);i&&i.setValue(t)}},26470:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Browser:()=>h,BrowserDelegate:()=>l});var r=i(28612),n=i(22599),o=i(60489);let s=(0,i(7247).getGlobal)(),a=s.document;function l(){}function h(e,t,i){this.myDelegate=e,this.mySelectedIds=[];var r="browserview";this.myRootContainerId=i+"-"+r,this.idToElement={},this.myRootContainer=a.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add(r),a.getElementById(i).appendChild(this.myRootContainer),this.createElements(t,this.myRootContainer)}l.prototype.constructor=l,l.prototype.getNodeId=function(e){throw"getId is not implemented."},l.prototype.getNodeLabel=function(e){return e.name},l.prototype.getNodeClass=function(e){return""},l.prototype.hasThumbnail=function(e){return!1},l.prototype.getThumbnailOptions=function(e){return null},l.prototype.getThumbnail=function(e){return null},l.prototype.onNodeClick=function(e,t,i){},l.prototype.onNodeHover=function(e,t,i){},l.prototype.selectItem=function(e){},l.prototype.deselectItem=function(e){},l.prototype.hasContent=function(e){return!1},l.prototype.addContent=function(e,t){},h.prototype.constructor=h,h.prototype.show=function(e){e?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},h.prototype.getRootContainer=function(){return this.myRootContainer},h.prototype.delegate=function(){return this.myDelegate},h.prototype.addToSelection=function(e){var t=this;function i(e){return-1==t.mySelectedIds.indexOf(e)&&(t.mySelectedIds.push(e),!0)}for(var r=0,n=e.length;r<n;++r){var o=e[r];if(i(o)){var s=t.idToElement[o];void 0===s?t.myDelegate.selectItem(o):s.classList.add("selected")}}},h.prototype.removeFromSelection=function(e){var t=this;function i(e){var i=t.mySelectedIds.indexOf(e);return-1!=i&&(t.mySelectedIds.splice(i,1),!0)}for(var r=e.length-1;r>=0;--r){var n=e[r];if(i(n)){var o=this.idToElement[n];void 0===o?t.myDelegate.deselectItem(n):o.classList.remove("selected")}}},h.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(e),this.mySelectedIds},h.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},h.prototype.createElements=function(e,t){if(e)for(var i=0;i<e.length;i++){var r=e[i];this.createElement(r,t)}},h.prototype.createElement=function(e,t){var i=this,l=i.myDelegate.getNodeId(e),h=a.createElement("item");t.appendChild(h),this.idToElement[l]=h,h.onmouseover=function(){i.myDelegate.onNodeHover(i,e)},h.onclick=function(t){i.myRootContainer.querySelector(".flipped").removeClass("flipped"),i.myDelegate.onNodeClick(i,e,t)};var c=a.createElement("div");c.classList.add("card"),h.appendChild(c);var u=a.createElement("div");u.classList.add("browserElement"),c.appendChild(u);var d=i.myDelegate.getNodeLabel(e),p=a.createElement("label");p.innerHTML=d,u.appendChild(p),p.onclick=function(t){i.myDelegate.onNodeClick(i,e,t)};var f=i.myDelegate.getThumbnail(e);if(f){var m=a.createElement("img");m.classList.add("thumb");var g=i.myDelegate.getThumbnailOptions(e);r.Document.requestThumbnailWithSecurity(g,(function(e,t){e?o.logger.error("Failed to load thumbnail: "+f,(0,n.errorCodeString)(n.ErrorCodes.NETWORK_FAILURE)):(m.src=s.URL.createObjectURL(t),m.onload=function(){s.URL.revokeObjectURL(m.src)})})),u.appendChild(m),m.onclick=function(t){i.myDelegate.onNodeClick(i,e,t)}}i.myDelegate.hasContent(e)&&i.myDelegate.addContent(e,c),h.classList.add(i.myDelegate.getNodeClass(e))}},32800:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Button:()=>a});var r,n,o=i(31224),s=i(7247);function a(e,t){o.Control.call(this,e,t);var i=this;this._state=a.State.INACTIVE;var r=this.getDocument();this.icon=r.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",(function(e){i.getState()!==a.State.DISABLED&&(i.dispatchEvent(a.Event.CLICK),i.onClick&&i.onClick(e)),e.stopPropagation()})),(0,s.isTouchDevice)()?this.container.addEventListener("touchstart",s.touchStartToClick):(this.container.addEventListener("mouseover",(function(e){i.onMouseOver(e)})),this.container.addEventListener("mouseout",(function(e){i.onMouseOut(e)}))),this.addClass("adsk-button"),this.addClass(a.StateToClassMap[this._state])}a.Event={VISIBILITY_CHANGED:o.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:o.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},a.State={ACTIVE:0,INACTIVE:1,DISABLED:2},a.StateToClassMap=(r=a.State,(n={})[r.ACTIVE]="active",n[r.INACTIVE]="inactive",n[r.DISABLED]="disabled",n),a.prototype=Object.create(o.Control.prototype),a.prototype.constructor=a,a.prototype.setState=function(e){if(e===this._state)return!1;this.removeClass(a.StateToClassMap[this._state]),this.addClass(a.StateToClassMap[e]),this._state=e;var t={type:a.Event.STATE_CHANGED,state:e};return this.dispatchEvent(t),!0},a.prototype.setIcon=function(e){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=e,this.icon.classList.add(e)},a.prototype.getState=function(){return this._state},a.prototype.onClick=function(e){},a.prototype.onMouseOver=function(e){},a.prototype.onMouseOut=function(e){}},82493:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ComboButton:()=>s});var r=i(32800),n=i(53805),o=i(27156);function s(e,t){r.Button.call(this,e,t),this.arrowButton=new r.Button(e+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new n.RadioButtonGroup(e+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var i=this;this.arrowButton.onClick=function(){i.subMenu.setVisible(!i.subMenu.isVisible())},this.toggleFlyoutVisible=function(){i.subMenu.setVisible(!i.subMenu.isVisible())},this.onClick=function(){i.subMenu.setVisible(!i.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(e){e.isActiveButton?(i.setIcon(e.target.getActiveButton().iconClass),i.setToolTip(e.target.getActiveButton().getToolTip()),i.setState(r.Button.State.ACTIVE),i.onClick=e.button.onClick):i.setState(r.Button.State.INACTIVE)},this.subMenu.addEventListener(n.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var s=(0,o.stringToDOM)('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(s,this.subMenu.container.firstChild),s.addEventListener("click",(function(e){i.subMenu.setVisible(!1),e.stopPropagation()}))}s.prototype=Object.create(r.Button.prototype),s.prototype.constructor=s,s.prototype.addControl=function(e){this.subMenu.addControl(e),e.addEventListener(r.Button.Event.CLICK,this.toggleFlyoutVisible)},s.prototype.removeControl=function(e){this.subMenu.removeControl(e),e.removeEventListener(r.Button.Event.CLICK,this.toggleFlyoutVisible)},s.prototype.setState=function(e){if(e===r.Button.State.INACTIVE){var t=this.subMenu.getActiveButton();t&&t.setState(r.Button.State.INACTIVE)}r.Button.prototype.setState.call(this,e)},s.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},s.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(r.Button.State.INACTIVE))}},31224:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Control:()=>n});var r=i(68482);function n(e,t){this._id=e,this._isCollapsible=!t||t.collapsible,this._toolTipElement=null,this._listeners={},this.container=this.getDocument().createElement("div"),this.container.id=e,this.addClass("adsk-control")}i(76542).GlobalManagerMixin.call(n.prototype),n.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},r.EventDispatcher.prototype.apply(n.prototype),n.prototype.constructor=n,n.prototype.container=null,n.prototype.getId=function(){return this._id},n.prototype.setVisible=function(e){if(!this.container.classList.contains("adsk-hidden")===e)return!1;e?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var t={type:n.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:e};return this.dispatchEvent(t),!0},n.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},n.prototype.setToolTip=function(e){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==e)&&(this._toolTipElement||(this._toolTipElement=this.getDocument().createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",e),this._toolTipElement.setAttribute("tooltipText",e),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),!0)},n.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},n.prototype.setCollapsed=function(e){if(!this._isCollapsible||this.isCollapsed()===e)return!1;e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var t={type:n.Event.COLLAPSED_CHANGED,isCollapsed:e};return this.dispatchEvent(t),!0},n.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},n.prototype.isCollapsible=function(){return this._isCollapsible},n.prototype.addClass=function(e){this.container.classList.add(e)},n.prototype.removeClass=function(e){this.container.classList.remove(e)},n.prototype.getPosition=function(){var e=this.container.getBoundingClientRect();return{top:e.top,left:e.left}},n.prototype.getDimensions=function(){var e=this.container.getBoundingClientRect();return{width:e.width,height:e.height}},n.prototype.setDisplay=function(e){this.container.style.display=e},n.prototype.removeFromParent=function(){return!!this.parent&&this.parent.removeControl(this)}},25320:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ControlGroup:()=>n});var r=i(31224);function n(e,t){r.Control.call(this,e,t);var i=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(e){var t={type:n.Event.SIZE_CHANGED,childEvent:e};i.dispatchEvent(t)}}n.Event={VISIBILITY_CHANGED:r.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:r.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},n.prototype=Object.create(r.Control.prototype),n.prototype.constructor=n,n.prototype.addControl=function(e,t){e.setGlobalManager(this.globalManager);var i=t&&void 0!==t.index?t.index:this._controls.length;if(null!==this.getControl(e.getId()))return!1;var o={type:n.Event.CONTROL_ADDED,control:e,index:i};return i<this._controls.length?(this.container.insertBefore(e.container,this._controls[i].container),this._controls.splice(i,0,e)):(this.container.appendChild(e.container),this._controls.push(e)),e.addEventListener(r.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),e.addEventListener(r.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),e instanceof n&&e.addEventListener(n.Event.SIZE_CHANGED,this.handleChildSizeChanged),e.parent=this,this.dispatchEvent(o),this.dispatchEvent(n.Event.SIZE_CHANGED),!0},n.prototype.indexOf=function(e){for(var t=0;t<this._controls.length;t++){var i=this._controls[t];if(i===e||"string"==typeof e&&e===i.getId())return t}return-1},n.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;if(!t)return!1;var i=this._controls.indexOf(t);if(-1===i)return!1;this._controls.splice(i,1),this.container.removeChild(t.container);var o={type:n.Event.CONTROL_REMOVED,control:t,index:i};return t.removeEventListener(r.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),t.removeEventListener(r.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),t instanceof n&&t.removeEventListener(n.Event.SIZE_CHANGED,this.handleChildSizeChanged),t.parent=void 0,this.dispatchEvent(o),this.dispatchEvent(n.Event.SIZE_CHANGED),!0},n.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e===this._controls[t].getId())return this._controls[t];return null},n.prototype.getControlId=function(e){return e<0||e>=this._controls.length?null:this._controls[e].getId()},n.prototype.getNumberOfControls=function(){return this._controls.length},n.prototype.setCollapsed=function(e){if(!this._isCollapsible)return!1;var t=!1;return this._controls.forEach((function(i){i.isCollapsible()&&i.setCollapsed(e)&&(t=!0)})),t&&(e?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.dispatchEvent({type:n.Event.COLLAPSED_CHANGED,isCollapsed:e})),t}},32555:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Filterbox:()=>o});var r=i(31224),n=i(91493);function o(e,t){this._id=e,this._listeners={},this._options=t||{},this._filterFunction=this._options.filterFunction||function(){};var i=this.getDocument();this.container=i.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-filterbox"),this.addClass("empty");var r=i.createElement("input");r.classList.add("filter-box"),r.classList.add("docking-panel-delimiter-shadow"),r.type="search",r.placeholder=n.Z.t("Enter filter term"),r.setAttribute("data-i18n","Enter filter term"),r.incremental="incremental",r.autosave=this.container.id+"filter",this.container.appendChild(r),this.filterbox=r;var o=this,s=function(e){0===(e=e.trim()).length?o.container.classList.add("empty"):o.container.classList.remove("empty"),o._filterFunction&&o._filterFunction(e)},a=i.createElement("div");a.className="filter-box-icon",this.container.insertBefore(a,r.nextSibling);var l=i.createElement("div");l.className="filter-box-close",l.addEventListener("click",(function(){o.filterbox.value="",o.addClass("empty")})),this.container.appendChild(l),r.addEventListener("keydown",(function(e){var t=o.getWindow();13===(e=e||t.event).keyCode&&o.filterbox.blur()})),r.addEventListener("input",(function(){s(this.value)})),r.addEventListener("change",(function(){s(this.value)})),r.addEventListener("focus",(function(){a.classList.add("focused")})),r.addEventListener("blur",(function(){a.classList.remove("focused")}))}o.prototype=Object.create(r.Control.prototype),o.prototype.constructor=o},53805:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RadioButtonGroup:()=>s});var r=i(25320),n=i(32800),o=i(31224);function s(e,t){r.ControlGroup.call(this,e,t);var i=this;this._activeButton=null,this._handleButtonStateChange=function(e){var t=n.Button.State;e.state===t.ACTIVE?(i._activeButton=e.target,i.dispatchEvent({type:s.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!0}),i._controls.forEach((function(i){i!==e.target&&i.getState()!==t.DISABLED&&i.setState(t.INACTIVE)}))):e.target===i._activeButton&&(i._activeButton=null,i.dispatchEvent({type:s.Event.ACTIVE_BUTTON_CHANGED,button:e.target,isActiveButton:!1}))}}s.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:o.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:o.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:r.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:r.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:r.ControlGroup.Event.SIZE_CHANGED},s.prototype=Object.create(r.ControlGroup.prototype),s.prototype.constructor=s,s.prototype.addControl=function(e,t){return e instanceof n.Button&&(!!r.ControlGroup.prototype.addControl.call(this,e,t)&&(e.addEventListener(n.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},s.prototype.removeControl=function(e){var t="string"==typeof e?this.getControl(e):e;return!(null===t||!r.ControlGroup.prototype.removeControl.call(this,t))&&(t.removeEventListener(n.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},s.prototype.getActiveButton=function(){return this._activeButton}},16098:(e,t,i)=>{"use strict";i.d(t,{J:()=>r});let r="search-selected"},32195:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Searchbox:()=>A});var r=i(31224),n=i(16098),o=i(60489),s=i(68482),a=i(46263),l=i(76542),h=50,c=150,u=100;function d(e,t,i){let r=i;this.excludeRoot=t,(r instanceof Autodesk.Viewing.GuiViewer3D||r instanceof Autodesk.Viewing.Viewer3D)&&(o.logger.warn("Deprecated use of Viewer as parameter. Provide container instead"),r=i.container),this.results=[],this.resultCount=0,this.selectedIndex=-1;let n=this.getDocument();this.container=n.createElement("div"),this.container.classList.add("docking-panel"),this.container.classList.add("adsk-search-results"),this.container.results=n.createElement("div"),this.container.results.classList.add("docking-panel-scroll"),this.container.results.classList.add("docking-panel-container-solid-color-b"),this.container.results.addEventListener("scroll",f.bind(this)),this.container.appendChild(this.container.results),e.insertBefore(this.container,e.firstChild),this.scrollingContainer=n.createElement("div"),this.scrollingContainer.classList.add("adsk-search-results-scrolling-panel"),this.scrollingContainer.addEventListener("click",p.bind(this)),this.container.results.appendChild(this.scrollingContainer),this.footer=new a.ResizeFooter(this.container,function(){var e=this.container.getBoundingClientRect(),t=r.getBoundingClientRect();t.right<e.right&&(this.container.style.width=t.right-e.left+"px"),t.bottom<e.bottom&&(this.container.style.height=t.bottom-e.top+"px")}.bind(this)),this.footer.setGlobalManager(this.globalManager),this.divNoResults=function(e){var t=e.createElement("div"),i=e.createElement("div"),r=e.createElement("div");t.classList.add("no-results-container"),t.style.display="none";var n="No Results";i.setAttribute("data-i18n",n),i.textContent=Autodesk.Viewing.i18n.translate(n),i.classList.add("no-results-title");var o="Try another term";return r.setAttribute("data-i18n",o),r.textContent=Autodesk.Viewing.i18n.translate(o),r.classList.add("no-results-description"),t.appendChild(i),t.appendChild(r),t.domTitle=i,t.domMessage=r,t}(n),this.scrollingContainer.appendChild(this.divNoResults),this.scrollY=0,this.dirty=!1,this.nextFrameId=0,this.it={init:function(e){return this.isDone=!1,this.results=e,this.indexRs=0,this.indexId=-1,this},done:function(){return this.isDone},next:function(){if(this.isDone)return this;for(this.indexId++;this.results.length!==this.indexRs&&this.indexId===this.results[this.indexRs].ids.length;)this.indexId=0,this.indexRs++;return this.isDone=this.indexRs===this.results.length,this},id:function(){return this.results[this.indexRs].ids[this.indexId]},delegate:function(){return this.results[this.indexRs].delegate}},this.elementsPool=[],this.elementsUsed=0;for(var s=0;s<c;++s)this.elementsPool[s]=y(n);this.setVisible(!1)}function p(e){var t=e.target,i=this._getNodeAndModelIds(t);i&&(this.fireEvent({type:n.J,id:i.nodeId,modelId:i.modelId}),e.preventDefault())}function f(){var e=this.container.results.scrollTop;Math.abs(this.scrollY-e)>=u&&(this.scrollY=e,m(this))}function m(e,t){e.dirty&&!t||(t?g(e):(e.dirty=!0,e.nextFrameId=requestAnimationFrame((function(){g(e)}))))}function g(e){e.dirty=!1,function(e){for(var t=e.elementsUsed,i=e.elementsPool,r=0;r<t;++r){b(i[r])}e.elementsUsed=0}(e),0!==e.resultCount?(e.setDisplayNoResults(!1),function(e){var t=e.container.results,i=0,r=t.clientHeight,n=e.scrollY,o=e.it.init(e.results),s=Math.max(0,e.scrollY-u),a=0|Math.floor(s/h),l=0;i=a*h;for(;a;)a--,l++,o.next();var c=e.elementsPool[e.elementsUsed++];c.style.height=i+"px",e.scrollingContainer.appendChild(c);var d=!0;for(;d;){if(o.next(),o.done()){d=!1;break}if(i>n+r+u){d=!1;break}if(e.elementsUsed===e.elementsPool.length){d=!1;break}var p=o.id(),f=o.delegate(),m=i+h,g=e.elementsPool[e.elementsUsed++];v(p,f,g,e,l===e.selectedIndex),e.scrollingContainer.appendChild(g),i=m,l++}var y=e.resultCount*h;e.scrollingContainer.style.height=y+"px"}(e)):e.setDisplayNoResults(!0)}function v(e,t,i,r,n){i.classList.add("search-result"),n?i.classList.add("selected"):i.classList.remove("selected"),i.setAttribute("lmv-nodeId",e),i.setAttribute("lmv-modelId",t.model.id),i.style.height=h+"px";var o=t.instanceTree.getNodeName(e),s=r.searchString,a=o.toLowerCase().indexOf(s.toLowerCase()),l=o.substr(0,a),c=o.substr(a,s.length),u=o.substr(a+s.length);i.domPrefix.innerText=l,i.domMatch.innerText=c,i.domSufix.innerText=u;var d=function(e,t,i){var r=[],n=t.getRootId(),o=i.isRootExcluded(),s=t.instanceTree,a=e,l=!1;for(;a&&!l&&(a!==n||(l=!0,!o));){var h=s.getNodeName(a);r.unshift(h),a=s.getNodeParentId(a)}return r}(e,t,r);i.domPath.innerText=d.join(" > ")}function y(e){var t=e.createElement("div"),i=e.createElement("div"),r=e.createElement("span"),n=e.createElement("span"),o=e.createElement("span"),s=e.createElement("span");return i.classList.add("search-result-container"),n.classList.add("search-match"),s.classList.add("search-path"),i.appendChild(r),i.appendChild(n),i.appendChild(o),i.appendChild(s),t.appendChild(i),t.domPrefix=r,t.domMatch=n,t.domSufix=o,t.domPath=s,t.domContainer=i,t}function b(e){e.setAttribute("lmv-nodeId",""),e.setAttribute("lmv-modelId",""),e.domPrefix.innerText="",e.domMatch.innerText="",e.domSufix.innerText="",e.domPath.innerText="",e.style.height="0"}function x(e,t){e.scrollTop+e.clientHeight<(t+1)*h&&(e.scrollTop+=(t+1)*h-(e.scrollTop+e.clientHeight)),e.scrollTop/h>t&&(e.scrollTop=t*h)}d.prototype.constructor=d,s.EventDispatcher.prototype.apply(d.prototype),l.GlobalManagerMixin.call(d.prototype),d.prototype.setPosition=function(e,t){this.container.style.left=e+"px",this.container.style.top=t+"px"},d.prototype.setMinWidth=function(e){this.container.style.width=e+"px"},d.prototype.setMaxWidth=function(e){this.container.style.maxHeight=e+"px"},d.prototype.setVisible=function(e){this.container.style.display=e?"":"none"},d.prototype.setResults=function(e,t){this.searchString=e,this.results=t,this.resultCount=function(e){for(var t=0,i=0;i<e.length;++i){t+=e[i].ids.length}return t}(t),this.selectedIndex=0==this.resultCount?-1:0,this.container.style.height=this.resultCount*h+20+"px",this.container.results.scrollTop=0,this.scrollY=0,0===this.resultCount?this.container.classList.add("no-content"):this.container.classList.remove("no-content"),m(this)},d.prototype.getSelection=function(){var e=this.scrollingContainer.querySelector(".selected");if(!e)return null;var t=this._getNodeAndModelIds(e);return t||null},d.prototype.isRootExcluded=function(){return!(this.results&&this.results.length>1)&&(!(this.modelCount>1)&&this.excludeRoot)},d.prototype.uninitialize=function(){this.setVisible(!1),this.container=null,this.container.parentNode&&this.container.parentNode.removeChild(this.container),cancelAnimationFrame(this.nextFrameId),this.clearListeners()},d.prototype.setDisplayNoResults=function(e){this.divNoResults.style.display=e?"":"none"},d.prototype.selectNext=function(){0!==this.resultCount&&(this.selectedIndex=Math.min(this.resultCount-1,this.selectedIndex+1),x(this.container.results,this.selectedIndex),m(this))},d.prototype.selectPrevious=function(){0!==this.resultCount&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),x(this.container.results,this.selectedIndex),m(this))},d.prototype._getNodeAndModelIds=function(e){for(;!e.hasAttribute("lmv-nodeId");)if(!(e=e.parentNode)||e===this.scrollingContainer)return;return{nodeId:parseInt(e.getAttribute("lmv-nodeId")),modelId:parseInt(e.getAttribute("lmv-modelId"))}};var _=i(91493);const E=i(23279);function A(e,t,i){this._id=e,this._listeners={},this._options=i||{},this._searchFunction=this._options.searchFunction||function(){};var r=this.getDocument();this.container=r.createElement("div"),this.container.id=e,this.addClass("adsk-control"),this.addClass("adsk-searchbox"),this.addClass("empty");var s=r.createElement("input");s.classList.add("search-box"),s.classList.add("docking-panel-delimiter-shadow"),s.type="search",s.results=[],s.placeholder=_.Z.t("Search"),s.setAttribute("data-i18n","Search"),s.incremental="incremental",s.autosave=this.container.id+"search_autosave",this.container.insertBefore(s,this.scrollContainer),this.searchbox=s;var a=function(){u.searchbox.value="",u.addClass("empty")},l=function(){u.searchbox.classList.remove("searching"),u.searchResults.setVisible(!1)},h=r.createElement("div");h.className="search-box-icon",this.container.insertBefore(h,s.nextSibling);var c=r.createElement("div");c.className="search-box-close",c.addEventListener("click",(function(){a(),l()})),this.container.appendChild(c),this.searchResults=new d(this.container,i.excludeRoot,t),this.searchResults.addEventListener(n.J,(function(e){a(),l(),u.fireEvent(e)}));var u=this,p=!0;s.addEventListener("keydown",(function(e){var t=u.getWindow();if(38===(e=e||t.event).keyCode&&(u.searchResults.selectPrevious(),e.preventDefault()),40===e.keyCode&&(u.searchResults.selectNext(),e.preventDefault()),13===e.keyCode){var i=u.searchResults.getSelection();if(!i)return!1;a(),l(),u.fireEvent({type:A.Events.ON_SEARCH_SELECTED,id:i.nodeId,modelId:i.modelId}),e.preventDefault()}}));var f=E((()=>{if(0===s.value.length)return u.container.classList.add("empty"),void l();u.container.classList.remove("empty"),s.value.length<3||function(){var e=s.value.trim();if(0!==e.length){p&&(o.logger.track({category:"search_node",name:"model_browser_tool"}),p=!1),s.classList.add("searching");var t=u._searchFunction(e);u.searchResults.setResults(e,t),u.searchResults.setVisible(!0)}else l()}()}),800);s.addEventListener("input",(function(){f()})),s.addEventListener("change",(function(e){var t=u.getDocument();e.target===t.activeElement&&f()})),s.addEventListener("focus",(function(){h.classList.add("focused")})),s.addEventListener("blur",(function(){h.classList.remove("focused")}))}A.prototype=Object.create(r.Control.prototype),A.prototype.constructor=A,A.Events={ON_SEARCH_SELECTED:n.J}},20011:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SplitViewLayout:()=>l});const r={down:{pointer:"pointerdown",mouse:"mousedown",touch:"touchstart"},up:{pointer:"pointerup",mouse:"mouseup",touch:"touchend"},move:{pointer:"pointermove",mouse:"mousemove",touch:"touchmove"}};function n(e,t,i){const n=(arguments.length>3&&void 0!==arguments[3]&&arguments[3]?"remove":"add")+"EventListener",o=function(e){const t=[];return Autodesk.Viewing.isMobileDevice()||t.push(r[e].mouse),Autodesk.Viewing.isTouchDevice()&&t.push(r[e].touch),t}(t);for(const t of o)e[n](t,i)}class o{constructor(e,t){this.container=e,this.isDragging=!1,this.resizeHandlerElement=null,this.onMoveCB=t,this.panelSizeThreshold=20,this.margin=16,this.initResizeHandlerElement()}onDown(e){this.isDragging=!0,e.preventDefault()}onUp(e){this.isDragging=!1}onMove(e){if(this.isDragging){"touchmove"===e.type&&(e.pageX=e.touches[0].pageX,e.pageY=e.touches[0].pageY);const t=this.container.getBoundingClientRect(),i=this.getTargetWidthPercentage(e,t);this.panelSizeThreshold<i&&i<100-this.panelSizeThreshold&&this.onMoveCB(i)}}getTargetWidthPercentage(e,t){}initResizeHandlerElement(){this.resizeHandlerElement=document.createElement("div"),this.handlerSplitLine=document.createElement("div"),this.resizeHandlerElement.appendChild(this.handlerSplitLine),n(this.resizeHandlerElement,"down",this.onDown.bind(this)),this.onUpBinded=this.onUp.bind(this),this.onMoveBinded=this.onMove.bind(this),n(document,"move",this.onMoveBinded),n(document,"up",this.onUpBinded),this.resizeHandlerElement.className="resize-handler",this.handlerSplitLine.className="resize-handler-center-mark"}setPosition(e){}terminate(){this.resizeHandlerElement.parentNode.removeChild(this.resizeHandlerElement),this.resizeHandlerElement=null,n(document,"up",this.onUpBinded,!0),n(document,"move",this.onMoveBinded,!0)}}class s extends o{initResizeHandlerElement(){super.initResizeHandlerElement(),this.resizeHandlerElement.classList.add("vertical"),this.handlerSplitLine.classList.add("vertical"),this.resizeHandlerElement.style.width=`${this.margin}px`}getTargetWidthPercentage(e,t){return(e.pageX-t.left)/t.width*100}setPosition(e){this.resizeHandlerElement.style.left=`calc(${e}% - ${this.margin/2}px)`}}class a extends o{initResizeHandlerElement(){super.initResizeHandlerElement(),this.resizeHandlerElement.classList.add("horizontal"),this.handlerSplitLine.classList.add("horizontal"),this.resizeHandlerElement.style.height=`${this.margin}px`}getTargetWidthPercentage(e,t){return(e.pageY-t.top)/t.height*100}setPosition(e){this.resizeHandlerElement.style.top=`calc(${e}% - ${this.margin/2}px)`}}class l{constructor(e){this._splitType=e||l.SplitType.Vertical,this.onResizeHandlerMove=this.onResizeHandlerMove.bind(this)}createSplitViewLayout(e,t,i){if(this.targetContainer=e,this.splitViewContainer=document.createElement("div"),this.splitViewContainer.classList.add("split-view-container"),this.targetContainer.parentNode.replaceChild(this.splitViewContainer,this.targetContainer),this.firstViewerContainer=this.wrapViewerContainer(t),this._splitType===l.SplitType.Vertical)this._resizeHandler=new s(this.splitViewContainer,this.onResizeHandlerMove);else{if(this._splitType!==l.SplitType.Horizontal)return void console.error("unknown splitType");this._resizeHandler=new a(this.splitViewContainer,this.onResizeHandlerMove)}this._resizeHandler&&this.splitViewContainer.appendChild(this._resizeHandler.resizeHandlerElement),this.secondViewerContainer=this.wrapViewerContainer(i),this.onResizeHandlerMove(50)}wrapViewerContainer(e){const t=document.createElement("div");return t.className="split-view-viewer-container",e&&t.appendChild(e),this.splitViewContainer.appendChild(t),t}restoreMainViewer(){this._resizeHandler&&(this._resizeHandler.terminate(),this._resizeHandler=null),this.splitViewContainer&&(this.splitViewContainer.parentNode.replaceChild(this.targetContainer,this.splitViewContainer),this.splitViewContainer=null,this.targetContainer=null,this.firstViewerContainer=null,this.secondViewerContainer=null)}onResizeHandlerMove(e){this._resizeHandler&&this._resizeHandler.setPosition(e),this._splitType===l.SplitType.Vertical?(this.firstViewerContainer.style.width=`${e}%`,this.secondViewerContainer.style.width=100-e+"%",this.secondViewerContainer.style.left=`${e}%`):this._splitType===l.SplitType.Horizontal&&(this.firstViewerContainer.style.height=`${e}%`,this.secondViewerContainer.style.height=100-e+"%",this.secondViewerContainer.style.top=`${e}%`)}}l.SplitType={Vertical:"vertical",Horizontal:"horizontal"}},60503:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ToolBar:()=>o});var r=i(25320),n=i(31224);function o(e,t){r.ControlGroup.call(this,e,t),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar"),t&&t.alignVertically&&this.addClass("adsk-toolbar-vertical")}o.Event={VISIBILITY_CHANGED:n.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:n.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:r.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:r.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:r.ControlGroup.Event.SIZE_CHANGED},o.prototype=Object.create(r.ControlGroup.prototype),o.prototype.constructor=o},6703:(e,t,i)=>{"use strict";i.r(t)},14966:(e,t,i)=>{function r(t,i){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e.exports[r]=t[r],i&&(e.exports[i][r]=t[r]))}i(26699),i(92087),i(3462),i(83475),i(46273),i(51568),i(26349),i(10072),i(99137),i(71957),i(96306),i(103),i(8582),i(90618),i(74592),i(88440),i(58276),i(35082),i(12813),i(18222),i(24838),i(38563),i(50336),i(7512),i(46603),i(70100),i(10490),i(13187),i(60092),i(19041),i(30666),i(51638),i(62975),i(15728),i(46056),i(44299),i(5162),i(50292),i(1025),i(77479),i(34582),i(47896),i(12647),i(98558),i(84018),i(97507),i(61605),i(49076),i(34999),i(88921),i(96248),i(13599),i(11477),i(64362),i(15389),i(46006),i(90401),i(45164),i(91238),i(54837),i(87485),i(56767),i(69916),i(76651),i(61437),i(35285),i(39865),i(86035),i(67501),i(21568),i(48824),i(44130),i(78206),i(76478),i(79715),i(43561),i(32049),i(86020),i(56585),i(84633),e.exports.Autodesk=i(91224).Autodesk;var n=Object.assign||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])};e.exports.THREE=i(75050),e.exports.av={},e.exports.avp={},e.exports.avu={},e.exports.ave={},r({Hammer:i(79058)},"av"),r(i(7247),"av"),r(i(7247),"avp"),r(i(27156),"avp"),r(i(27156),"av"),r(i(86056),"avp"),r(i(32131),"avp"),r(i(6875),"avp"),r(i(6875),"av"),r(i(44741),"avp");const o=i(91493).Z;o.translate=o.t.bind(o),o.localize=()=>{},r({i18n:o},"av"),r(i(26725),"avp"),r(i(58164),"avp"),r(i(60489),"avp"),r(i(93549),"avp"),r(i(75261),"avp"),r(i(93666),"avp"),r(i(73446),"avp"),r(i(17724),"avp"),r(i(45352),"avp"),r(i(3016),"avp"),r(i(77221),"avp"),r(i(74718),"avp"),r(i(86353),"avp"),r(i(5411),"avp"),r(i(32893),"avp"),r(i(85686),"avp"),r(i(75469),"avp"),r(i(68940),"avp"),r(i(92217),"avp"),r(i(77784),"avp"),r(i(2724),"avp"),r(i(22573),"avp"),r(i(51440),"avp"),r(i(11466),"avp"),r(i(19462),"avp"),r(i(38454),"avp"),r(i(742),"avp"),r(i(36097),"avp"),r(i(33736),"avp"),r(i(70179),"avp"),r(i(70333),"avp"),r(i(96164),"avp"),r(i(194),"avp"),r(i(60812),"avp"),r(i(97559),"avp"),r(i(90245),"avp"),r(i(70173),"avp"),r(i(33614),"avp"),r(i(60945),"avp"),r(i(7619),"avp"),r(i(56144),"avp"),r(i(28109),"avp"),r(i(67183),"avp"),r(i(75124),"avp"),r(i(78484),"avp"),r(i(86945),"avp"),r(i(12529),"avp"),r(i(75746),"avp"),r(i(44225),"avp"),r(i(32576),"avp"),r(i(86437),"avp"),r(i(71857),"avp"),r(i(33303),"avp"),r(i(36263),"av"),r(i(59957),"avp"),r(i(40929),"avp"),r(i(50982),"avp"),r(i(37765),"avp"),r(i(1098),"avp"),r(i(40841),"avp"),r(i(44434),"avp"),r(i(16650),"avp"),r(i(58203),"avp"),r(i(63026),"avp"),r(i(11056),"avp"),r(i(96199),"avp"),r(i(34302),"avp"),r(i(13770),"avp"),r(i(77220),"avp"),r(i(29059),"avp"),r(i(22599),"av"),r(i(97790),"av"),r(i(68110),"avp"),r(i(62688),"avp"),r(i(51751),"avp"),r(i(6972),"av"),r(i(39080),"av"),r(i(68482),"av"),r(i(24073),"av"),r(i(44631),"av"),r(i(31212),"av"),r(i(18878),"av"),r(i(22753),"av"),r(i(3109),"av"),r(i(52156),"avp"),r(i(70178),"avp"),r(i(40213),"avp"),r(i(45894),"av"),r(i(28612),"av"),r(i(70718),"avp"),r(i(64141),"avp"),r(i(56873),"av"),r(i(44135),"av"),r(i(90625),"av"),r(i(27848),"avp"),r(i(62832),"avp"),r(i(5202),"av"),r(i(27343),"av"),r(i(23976),"av"),r(i(87338),"av"),r(i(36660),"av"),r(i(49830),"av"),r(i(94357),"av"),r(i(51063),"av"),r(i(82977),"av"),r(i(81467),"avp"),e.exports.av.ModelUnits=i(81467).ModelUnits,r(i(24404),"avp"),r(i(22133),"av"),r(i(47654),"avp");var s=e.exports.av.MeasureCommon={};n(s,i(5621)),s.MeasurementTypes=i(33266).o,s.MeasurementTypesToAnalytics=i(33266).D,s.SnapType=i(602).t,s.Events=i(33542).n,s.Measurement=i(31799).g,s.SnapResult=i(80933).N,r(i(87312),"av"),r(i(76542),"av"),r(i(26754),"avp"),r(i(34740),"avp"),r(i(95765),"avp"),r(i(87432),"av"),r(i(52713),"av"),r(i(25161),"avp"),r(i(86142),"av"),r(i(91121),"avp"),r(i(70095),"av"),r(i(78464),"av"),r(i(70169),"av"),r(i(82553),"av"),r(i(81941),"av"),r(i(44160),"av"),r(i(31313),"av"),r(i(6223),"av"),r(i(61599),"av"),r(i(11496),"av"),r(i(55379),"av"),r(i(79416),"av"),r(i(86157),"avp"),r(i(20933),"avp"),r(i(80810),"avp"),r(i(39461),"avp"),r(i(10028),"avp"),r(i(33664),"avp"),r(i(5774),"avp"),r(i(88505),"avp"),r(i(45459),"avp"),r(i(66799),"avp"),r(i(77876),"av"),r(i(18507),"av"),r(i(97047),"avp"),r(i(45836),"avp"),i(6703),r(i(36261),"avu"),r(i(11815),"avu"),r(i(30210),"avu"),r(i(29677),"avu"),r(i(46263),"avp"),r(i(54714),"avu"),r(i(90650),"avu"),r(i(36851),"avp"),r(i(26470),"avp"),r(i(54923),"avp"),r(i(91629),"avp"),r(i(89461),"avu"),r(i(36749),"avu"),r(i(47838),"avu"),r(i(83355),"avp"),r(i(38241),"ave"),r(i(31224),"avu"),r(i(25320),"avu"),r(i(32800),"avu"),r(i(53805),"avu"),r(i(82493),"avu"),r(i(60503),"avu"),r(i(49547),"avp"),r(i(51370),"avu"),r(i(32555),"avu"),r(i(32195),"avu"),r(i(49378),"avp"),r(i(77288),"ave"),r(i(66417),"ave"),r(i(95277),"ave"),r(i(57869),"ave"),r(i(61574),"av"),r(i(72067),"av"),r(i(20011),"avu"),r(i(701),"av"),r(i(21749),"av"),r(i(33352),"av"),r(i(65872),"av"),r(i(46287),"avp"),r(i(63481),"av"),i(65942).i(e.exports)},65872:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CrossViewerInteractionCommon:()=>n});var r=i(18878);const n={onSelectionChanged:{eventName:r.AGGREGATE_SELECTION_CHANGED_EVENT,cb:(e,t,i)=>{const r=e.getAggregateSelection();if(t.impl.model)if(r.length>0)for(let e=0;e<r.length;e++){const i=r[e],n=i.model,o=i.selection;for(let e=0;e<t.impl.modelQueue().getModels().length;e++){const i=t.impl.modelQueue().getModels()[e];i&&i.getDocumentNode()&&n.getDocumentNode()&&i.getDocumentNode().originModel===n.getDocumentNode().originModel?(t.impl.is2d?t.select(o,i):(t.showAll(),t.select(o,i),t.isolate(o,i)),t.fitToView(o)):!t.impl.is2d&&i.visibilityManager&&i.visibilityManager.setAllVisibility(!1)}}else t.clearSelection(),t.impl.is2d||t.showAll()}}}},33352:(e,t,i)=>{"use strict";i.r(t),i.d(t,{createLeechViewer:()=>a});var r=i(38454);function n(e){Autodesk.Viewing.Private.RenderContext.call(this),this.originalInit=this.init.bind(this),this.init=function(t,i,r){var n;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.canvas=e,this.ctx2D=this.canvas.getContext("2d");const s=!0!==(null===(n=o.webglInitParams)||void 0===n?void 0:n.alpha),a=Object.assign({},o,{offscreen:!0,removeAlphaInOutput:s});this.originalInit(t,i,r,a),this.glrenderer=t;const l=this.glrenderer.getPixelRatio();this.setSize(i/l,r/l)},this.renderToCanvas=function(){this.ctx2D&&(this.getOffscreenTarget()||0!=this.widthWithPixelRatio&&0!=this.heightWithPixelRatio&&(this.ctx2D.clearRect(0,0,this.widthWithPixelRatio,this.heightWithPixelRatio),this.ctx2D.drawImage(this.glrenderer.domElement,0,this.glrenderer.domElement.height-this.heightWithPixelRatio,this.widthWithPixelRatio,this.heightWithPixelRatio,0,0,this.widthWithPixelRatio,this.heightWithPixelRatio)))},this.originalSetSize=this.setSize.bind(this),this.setSize=function(e,t,i,r){if(!r){const i=this.glrenderer.getPixelRatio();this.width=e,this.height=t,this.widthWithPixelRatio=e*i,this.heightWithPixelRatio=t*i,this.canvas.width=this.widthWithPixelRatio,this.canvas.height=this.heightWithPixelRatio,this.canvas.style.width=`${this.width}px`,this.canvas.style.height=`${this.height}px`}this.prepareViewport(i,r),this.restoreViewport()},this.prepareViewport=function(e,t){this.glrenderer.pushViewport();const i=this.glrenderer.getPixelRatio(),r=this.glrenderer.domElement.width/i,n=this.glrenderer.domElement.height/i;(r<this.width||n<this.height)&&this.glrenderer.setSize(Math.max(this.width,r),Math.max(this.height,n)),this.originalSetSize(this.width,this.height,e,t)},this.restoreViewport=function(){this.glrenderer.popViewport()}}n.prototype=Object.create(r.RenderContext.prototype),n.prototype.constructor=n;var o=i(52156);const s=new Map;function a(e,t,i,r){if(s.has(r)){return new(s.get(r))(e,t,i)}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.sharedResources=i,r.call(this,e,t),this.renderContext=new n(this.canvas),this.sharedResources.mrtFlags?this.renderContext.mrtFlags=this.sharedResources.mrtFlags:this.sharedResources.mrtFlags=this.renderContext.mrtFlags,this.resizeObserver=new ResizeObserver((e=>{const t=e[0].contentRect,i=Math.floor(t.width),r=Math.floor(t.height);i&&r&&(this.impl.resize(i,r,!0),this.dispatchEvent({type:Autodesk.Viewing.VIEWER_RESIZE_EVENT,width:i,height:r}),this.impl.tick(performance.now()))})),this.resizeObserver.observe(this.container)}a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.prototype.initialize=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={glrenderer:this.sharedResources.glrenderer,materialManager:this.sharedResources.materialManager,renderer:this.renderContext},i=Object.assign({},e,t),n=r.prototype.initialize.call(this,i);return this.overrideAPIs(),this.sharedResources.geomCache&&this.sharedResources.geomCache.initialized&&this.impl.setGeomCache(this.sharedResources.geomCache),n},a.prototype.uninitialize=function(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.originalLoadDocumentNode=null,this.loadDocumentNode=r.prototype.loadDocumentNode,r.prototype.uninitialize.call(this)},a.prototype.overrideAPIs=function(){var e=this;const t=this.impl.tick.bind(this.impl);this.impl.tick=()=>{if(!this.impl||!this.impl.glrenderer())return;this.impl.renderer().prepareViewport(),this.restoreViewerState();const e=performance.now();t(e),this.impl.renderer().restoreViewport()},this.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,(()=>{this.renderContext.renderToCanvas()}),{priority:-1e3});const i=this.impl.setLightPreset.bind(this.impl);this.impl.setLightPreset=(e,t,r)=>{if(this.impl.is2d){this.impl.initLights();const t=Autodesk.Viewing.Private.LightPresets[e].bgColorGradient;this.setBackgroundColor(...t),this.impl.setCurrentLightPreset(e);const i=this.impl.loadCubeMapFromColors(this.impl.clearColorTop,this.impl.clearColorBottom);this.impl.renderer().setCubeMap(i)}else i(e,t,r)};const r=this.toolController.__invokeStack.bind(this.toolController);this.toolController.__invokeStack=function(){return e.restoreViewerState(),r(...arguments)};const n=this.impl.unloadModel.bind(this.impl);this.impl.unloadModel=(e,t)=>{const i=e.leechViewerKey;let r=!1;const o=this.sharedResources.loadedModels[i];return o&&(o.usedByViewersCounter--,r=t||o.forceKeepResources||o.usedByViewersCounter>0,r||delete this.sharedResources.loadedModels[i]),n(e,t=t||r)},this.originalLoadDocumentNode=this.loadDocumentNode.bind(this),this.loadDocumentNode=function(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((n,o)=>{const s=function(e,t){let i=e.getModelKey();return i+=".ref:"+!!t.applyRefPoint,i+=".g:"+(t.globalOffset?[t.globalOffset.x,t.globalOffset.y,t.globalOffset.z]:[0,0,0]).toString(),t.placementTransform&&(i+=".p:"+t.placementTransform.toArray().toString()),t.customHash&&(i+=".h:"+t.customHash),i}(i,r),a=e.sharedResources.loadedModels[s];if(a){const t=e.onModelLoaded(a.model,r);n(t)}else e.originalLoadDocumentNode(t,i,r).then((t=>{t.leechViewerKey=s,e.sharedResources.loadedModels[s]={model:t,usedByViewersCounter:1,loadingViewer:e},n(t)})).catch(o)}))};const o=this.impl.geomCache.bind(this.impl);this.impl.geomCache=()=>(this.sharedResources.geomCache&&this.sharedResources.geomCache.initialized||(this.sharedResources.geomCache=o()),this.sharedResources.geomCache)},a.prototype.setViewerProfile=function(e,t){if(t.loadAsHidden)return;t.isAEC=e.isAEC();const i=this.chooseProfile(t);delete i.settings.lineRendering,delete i.settings.pointRendering,this.setProfile(i)},a.prototype.setViewerLight=function(e,t){if(!t.loadAsHidden)if(this.impl.is2d){this.impl.setLightPreset(o.DefaultLightPreset2d);const e=this.impl.clearColorTop.clone().multiplyScalar(255),i=this.impl.clearColorBottom.clone().multiplyScalar(255);t.isAEC?this.impl.setLightPresetForAec():this.impl.setLightPreset(o.DefaultLightPreset),this.impl.toggleEnvMapBackground(!1),this.setBackgroundColor(e.x,e.y,e.z,i.x,i.y,i.z)}else this.impl.toggleEnvMapBackground(this.profile.settings.envMapBackground)},a.prototype.cleanViewerBeforeLoadModel=function(e){if(!e.keepCurrentModels&&this.impl.hasModels()){let e=this.config;this.tearDown(),this.setUp(e)}!this.impl.hasModels()&&this._loadingSpinner&&this._loadingSpinner.show()};const l=new THREE.Vector4(0,0,-1,-1e20);function h(e){const t=!e,i=e&&!e.isLoadDone(),r=e&&e.getPropertyDb()&&!e.getPropertyDb().isLoadDone();return!(t||i||r)}return a.prototype.syncCutPlanes=function(){const e=this.impl.getAllCutPlanes()||[l],t=this.impl.matman(),i=Math.max(e.length,t._cutplanes.length);t._cutplanes.length=0;let r=0;for(;r<e.length;r++)t._cutplanes.push(e[r].clone());for(;r<i;r++)t._cutplanes.push(l);t.forEach((e=>{e.doNotCut||(e.cutplanes=t._cutplanes)}),!1,!0)},a.prototype.restoreViewerState=function(){this.sharedResources.lastRenderedViewer!==this&&(this.syncCutPlanes(),this.impl.is2d&&this.impl.updateCameraMatrices(),this.sharedResources.lastRenderedViewer=this)},a.prototype.onModelLoaded=function(e,t){const i=e.leechViewerKey;this.sharedResources.loadedModels[i].forceKeepResources=!0,this.cleanViewerBeforeLoadModel(t);const r=this.cloneModelToViewer(e);return this.addModelToViewer(r,t),delete this.sharedResources.loadedModels[i].forceKeepResources,r},a.prototype.addModelToViewer=function(e,t){this.impl.modelQueue().addHiddenModel(e),t.loadAsHidden||(this.setViewerProfile(e,t),this.showModel(e),this.setViewerLight(e,t),!t.headlessViewer&&this.createUI&&this.createUI(e)),this._loadingSpinner&&this._loadingSpinner.hide()},a.prototype.cloneModelToViewer=function(e){const t=e.clone(),i=e.leechViewerKey;t.leechViewerKey=i;const r=this.sharedResources.loadedModels[i];r.usedByViewersCounter++;const n=r.loadingViewer,o=()=>this.impl.invalidate(!1,!0,!1);return n.addEventListener(Autodesk.Viewing.LOADER_REPAINT_REQUEST_EVENT,o,{priority:-1e3}),function(e,t){return new Promise((i=>{h(t)&&i();const r=()=>{h(t)&&(e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,r),e.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,r),i())};e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,r),e.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,r)}))}(n,t).then((()=>{setTimeout((()=>{t.setInnerAttributes(e.getInnerAttributes()),this.impl.onLoadComplete(t)}),1),n.removeEventListener(Autodesk.Viewing.LOADER_REPAINT_REQUEST_EVENT,o)})),t},s.set(r,a),new a(e,t,i,r)}},21749:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MultiViewerFactory:()=>o});var r=i(33352),n=i(19462);class o{constructor(){const e=Autodesk.Viewing.Private.createRenderer(void 0,{alpha:!0}),t=new n.MaterialManager(e);this.sharedResources={glrenderer:e,materialManager:t,loadedModels:{}}}createViewer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Autodesk.Viewing.Viewer3D;return(0,r.createLeechViewer)(e,t,this.sharedResources,i)}destroy(){this.sharedResources=null}}},60489:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LogLevels:()=>l,Logger:()=>h,logger:()=>p,setLogger:()=>f});var r=i(7247),n=i(97790),o=i(32131);const s=(0,r.getGlobal)(),a=s,l={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0};function h(){this.runtimeStats={},this.level=-1,this.setLevel(l.ERROR),this._reportError=this._reportError.bind(this)}function c(e,t){let i;"string"==typeof t?i={message:t}:"object"==typeof t&&(i=t),o.analytics.track(e,i)}function u(){return"undefined"!=typeof window?encodeURI(a.location.href):""}function d(){}h.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var t=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+t.substring(4))}"number"==typeof e.logLevel&&this.setLevel(e.logLevel),this.environmentInfo={touch:(0,r.isTouchDevice)(),env:(0,n.getEnv)(),referer:u(),version:s.LMV_VIEWER_VERSION,build_type:s.LMV_BUILD_TYPE};var i={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,build_type:this.environmentInfo.build_type};this.track(i);var o=this;this.interval=setInterval((function(){o.reportRuntimeStats()}),6e4)},h.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},h.prototype.track=function(e){this.updateRuntimeStats(e),!(0,n.isOffline)()&&this.sessionId&&(this.callback&&(e.timestamp=Date.now(),e.sessionId=this.sessionId,this.callback(e)),"error"===(null==e?void 0:e.category)&&c("viewer.error.tracked",e))},h.prototype.updateRuntimeStats=function(e){if(Object.prototype.hasOwnProperty.call(e,"aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},h.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},h.prototype.setLevel=function(e){this.level!==e&&(this.level=e,this.debug=e>=l.DEBUG?console.log:d,this.log=e>=l.LOG?console.log:d,this.info=e>=l.INFO?console.info:d,this.warn=e>=l.WARNING?console.warn:d,this.error=e>=l.ERROR?this._reportError:d)},h.prototype._reportError=function(){console.error.apply(console,arguments);const e=Array.prototype.slice.call(arguments).join(" ");this.callback&&this.callback({category:"error",message:e}),c("viewer.error.logged",e)};let p=new h;function f(e){p=e}},47654:(e,t,i)=>{"use strict";i.r(t),i.d(t,{displayUnits:()=>s,displayUnitsEnum:()=>a,displayUnitsPrecision:()=>l,displayUnitsPrecisionEnum:()=>h,getUnitEnum:()=>u});var r=i(91493);const n=[{name:"File units",type:""},{name:"Millimeters",type:"mm",matches:["millimeter","millimeters"]},{name:"Centimeters",type:"cm",matches:["centimeter","centimeters"]},{name:"Meters",type:"m"},{name:"Inches",type:"in",matches:["inch","inches"]},{name:"Feet",type:"ft",matches:["foot"]},{name:"Feet and fractional inches",type:"ft-and-fractional-in"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Decimal feet",type:"decimal-ft"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters and centimeters",type:"m-and-cm"},{name:"Points",type:"pt",matches:["point","points"]}],o=[{name:"File precision",value:""},{name:"0 (1)",value:0},{name:"0.1 (1/2)",value:1},{name:"0.01 (1/4)",value:2},{name:"0.001 (1/8)",value:3},{name:"0.0001 (1/16)",value:4},{name:"0.00001 (1/32)",value:5},{name:"0.000001 (1/64)",value:6}],s=n.map((e=>e.name)),a=n.map((e=>e.type)),l=o.map((e=>e.name)),h=o.map((e=>e.value));n.forEach((e=>{if(e.matches){const t=e.matches.map((e=>r.Z.t(e)));e.matches=e.matches.concat(t)}}));const c=new Set(a);function u(e){if(e=e&&e.toLocaleLowerCase(),c.has(e))return e;for(let t in n){const i=n[t],r=i.matches;if(r&&r.indexOf(e)>-1)return i.type}return null}},5621:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EPSILON:()=>a,angleVectorToVector:()=>M,calculateDistance:()=>c,computeResult:()=>v,correctPerpendicularPicks:()=>h,createCommonOverlay:()=>L,getCircularArcRadius:()=>b,getEndPointsInEdge:()=>w,getFaceArea:()=>y,getSnapResultPosition:()=>l,inverseProject:()=>_,isEqualVectors:()=>S,isParallel:()=>C,isPerpendicular:()=>P,nearestPointInPointToLine:()=>E,nearestPointInPointToSegment:()=>A,nearestVertexInVertexToEdge:()=>D,project:()=>x,safeToggle:()=>I});var r=i(75050),n=i(602),o=i(33266),s=i(81467);const a=1e-4;function l(e,t){if(!e)return null;if(e.isPerpendicular)return e.intersectPoint;switch(e.geomType){case n.t.SNAP_VERTEX:case n.t.RASTER_PIXEL:case n.t.SNAP_MIDPOINT:case n.t.SNAP_CIRCLE_CENTER:return e.getGeometry();case n.t.SNAP_EDGE:var i=w(e.getGeometry()),r=i[0].clone(),o=i[1].clone();return E(e.intersectPoint,r,o);case n.t.SNAP_FACE:return T(e.intersectPoint,e.getGeometry().vertices[0],e.faceNormal);case n.t.SNAP_CIRCULARARC:if(t&&t.model&&t.model.is2d()){var s=e.snapPoint;return e.geomType=n.t.SNAP_VERTEX,e.geomVertex=s,s}return e.circularArcCenter;case n.t.SNAP_CURVEDEDGE:return D(e.intersectPoint,e.getGeometry());case n.t.SNAP_CURVEDFACE:return e.intersectPoint;case n.t.SNAP_INTERSECTION:return e.snapPoint;default:return null}}function h(e,t,i,o){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return!1;var s=l(e,i);if(o&&i)if(t.geomType===n.t.SNAP_EDGE){var a=new r.Vector3,h=new r.Vector3,c=t.getGeometry();if(a.subVectors(t.intersectPoint,s).normalize(),h.subVectors(c.vertices[0],c.vertices[1]).normalize(),P(a,h,.05))if(p=A(s,c.vertices[0],c.vertices[1],!0))return o.onMouseMove(x(p,i))&&o.setPerpendicular(!0),t.geomVertex=p,t.intersectPoint=p,!0}else if(t.geomType===n.t.SNAP_FACE){var u=new r.Vector3,d=t.getGeometry();if(u.subVectors(t.intersectPoint,s).normalize(),C(t.faceNormal,u,.05)){var p=T(s,d.vertices[0],t.faceNormal);return o.onMouseMove(x(p,i))&&o.setPerpendicular(!0),t.geomVertex=p,t.intersectPoint=p,!0}}}function c(e,t,i,r){var n;if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return null;var s=l(e,r),h=l(t,r);if(!s||!h)return null;if(S(s,h,a))return null;let c;r.model.is2d()&&(s=s.clone(),h=h.clone(),e.viewportIndex2d=r.model.isPdf?e.viewportIndex2d:e.viewportIndex2d||e.id,r.model.pageToModel(s,h,e.viewportIndex2d));const u=e.viewportIndex2d,d=null==r||null===(n=r.model)||void 0===n||null===(n=n.getData())||void 0===n?void 0:n.viewports;var p;d&&void 0!==u&&(c=null===(p=d[u])||void 0===p?void 0:p.units);if(i){i=m(i);var f=s.distanceTo(h);return{distanceXYZ:g(f,i),distanceX:g(f=Math.abs(s.x-h.x),i),distanceY:g(f=Math.abs(s.y-h.y),i),distanceZ:0,type:o.o.MEASUREMENT_DISTANCE,units:c}}return{distanceXYZ:s.distanceTo(h),distanceX:Math.abs(s.x-h.x),distanceY:Math.abs(s.y-h.y),distanceZ:Math.abs(s.z-h.z),type:o.o.MEASUREMENT_DISTANCE,units:c}}function u(e,t){if(e.is3d())return 0;if(e.isPdf())return 0;var i=e.getMetadata("page_dimensions","page_width",null),n=e.getMetadata("page_dimensions","logical_width",null),o=e.getMetadata("page_dimensions","page_height",null),s=e.getMetadata("page_dimensions","logical_height",null);if(!(i&&n&&o&&s))return 0;var a=i/n,l=o/s,h=new r.Vector3(0,0,0),c=new r.Vector3(a,l,0);return e.pageToModel(h,c,t),h.distanceTo(c)}function d(e,t){var i=[];for(var n in e)if(e.hasOwnProperty(n)){var o=l(e[n],t);o&&i.push(o)}if(3!==i.length||function(e){for(var t=0;t<e.length;t++)for(var i=0;i<e.length;i++)if(t!==i&&S(e[t],e[i],a))return!0;return!1}(i))return null;var s=new r.Vector3,h=new r.Vector3;return s.subVectors(i[0],i[1]),h.subVectors(i[2],i[1]),M(s,h)}function p(e,t){var i=[];for(var r in e)if(e.hasOwnProperty(r)){var n=l(e[r],t);n&&i.push(n.clone())}var o=l(e[1],t);o&&i.push(o.clone());for(var s=0;s<i.length;s+=2)t.model.pageToModel(i[s],i[s+1],e[1].viewportIndex2d);var a=0,h=0;for(s=0;s<i.length-1;s++)a+=i[s].x*i[s+1].y,h+=i[s].y*i[s+1].x;return Math.abs((a-h)/2)}function f(e,t,i,n){if(!(e&&t&&e.getGeometry()&&t.getGeometry()))return null;if(!e.circularArcRadius)return null;var o=l(e,n).clone(),s=l(t,n).clone();const h=e.circularArcCenter;var c=h instanceof r.Vector3?h.clone():new r.Vector3(h.x,h.y,h.z);if(!o||!s)return null;if(S(o,s,a))return 0;n.model.is2d()&&(n.model.pageToModel(o,s,e.viewportIndex2d),n.model.pageToModel(c,null,e.viewportIndex2d));var u=function(){var e=new r.Vector3,t=new r.Vector3;e.subVectors(o,c),t.subVectors(s,c);var i=e.length()*t.length(),n=e.dot(t);return Math.acos(n/i)*e.length()}();return i?g(u,i=m(i)):u}function m(e){var t=Math.log(e)/Math.log(10),i=Math.floor(t);return 1<e/Math.pow(10,i)&&i++,Math.pow(10,i)}function g(e,t){return Math.floor(e/t+.5)*t}function v(e,t,i,r){switch(t){case o.o.MEASUREMENT_DISTANCE:return c(s=e[1],e[2],u(i.model,s.viewportIndex2d),i);case o.o.MEASUREMENT_ANGLE:var n=d(e,i);return n?{angle:r&&r.angleOuter?360-n:n,type:t}:null;case o.o.MEASUREMENT_AREA:return{area:p(e,i),type:t};case o.o.MEASUREMENT_ARC:var s;return{arc:f(s=e[1],e[2],u(i.model,s.viewportIndex2d),i),type:t};case o.o.MEASUREMENT_LOCATION:return{location:l(e[1],i),type:t};default:return null}}function y(e,t,i,n,o,a){var l=0,h=new r.Vector3,c=new r.Vector3;const u=i.vertices.length;for(var d=0;d<u;d+=3){const e=i.vertices[d],t=i.vertices[d+1],r=i.vertices[d+2];h.subVectors(t,e),c.subVectors(r,e),l+=h.length()*c.length()*Math.sin(h.angleTo(c))/2}return l=(0,s.convertUnits)(e.model.getUnitString(),n,a,l,"square"),n?(0,s.formatValueWithUnits)(l,n+"^2",3,o):(0,s.formatValueWithUnits)(l,null,3,o)}function b(e,t,i,r,n,o){var a=i.radius;if(a){if(e.model.is2d()){var l=i.center.clone();const r=i.vertices[0].clone();e.model.pageToModel(l,r,t.getPick(1).viewportIndex2d),a=l.distanceTo(r)}return a=(0,s.convertUnits)(e.model.getUnitString(),r,o,a),(0,s.formatValueWithUnits)(a,r,3,n)}}function x(e,t,i){var n=t.navigation.getCamera(),o=t.navigation.getScreenViewport(),s=new r.Vector3(e.x,e.y,e.z);return s=s.project(n),i=i||0,new r.Vector2(Math.round((s.x+1)/2*o.width)+i,Math.round((1-s.y)/2*o.height)+i)}function _(e,t){var i=t.navigation.getCamera(),n=t.navigation.getScreenViewport(),o=new r.Vector3;return o.x=e.x/n.width*2-1,o.y=-(e.y/n.height*2-1),o.z=0,o=o.unproject(i)}function E(e,t,i){var n,o=new r.Vector3,s=new r.Vector3;return o.subVectors(t,e),s.subVectors(i,t),n=o.dot(s),o.subVectors(i,t),n=-n/o.dot(o),o.subVectors(i,t),o.multiplyScalar(n),o.add(t)}function A(e,t,i,n){var o,s,a=new r.Vector3,l=new r.Vector3;return a.subVectors(t,e),l.subVectors(i,t),s=a.dot(l),a.subVectors(i,t),(s=-s/a.dot(a))<0?o=n?null:t:s>1?o=n?null:i:(a.subVectors(i,t),a.multiplyScalar(s),o=a.add(t)),o}function S(e,t,i){return!(!e||!t)&&(Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i&&Math.abs(e.z-t.z)<=i)}function w(e){var t=[];const i=e.vertices,r=i.length;for(var n=0;n<r;++n){var o=!1;const e=i[n];for(var s=0;s<r;++s){const t=i[s];if(s!==n&&t.equals(e)){o=!0;break}}o||t.push(e)}return t.length<2&&(t[0]=i[0],t[1]=i[1]),t}function M(e,t){return 180*e.angleTo(t)/Math.PI}function T(e,t,i){var n=new r.Vector3,o=i.clone(),s=new r.Vector3;s.subVectors(e,t);var a=-o.dot(s)/o.dot(o);return n.addVectors(e,o.multiplyScalar(a)),n}function C(e,t,i){return i=i||a,1-Math.abs(e.dot(t))<i}function P(e,t,i){return i=i||a,Math.abs(e.dot(t))<i}function D(e,t){for(var i,r=Number.MAX_VALUE,n=0;n<t.vertices.length;n++){const s=t.vertices[n];var o=e.distanceTo(s);r>o&&(i=s,r=o)}return i}function L(e,t){e.impl.overlayScenes[t]||e.impl.createOverlayScene(t)}function I(e,t,i){(e.classList.contains(t)&&!i||!e.classList.contains(t)&&i)&&e.classList.toggle(t,i)}},33542:(e,t,i)=>{"use strict";i.d(t,{n:()=>r});var r={MEASUREMENT_CHANGED_EVENT:"measurement-changed",MEASUREMENT_COMPLETED_EVENT:"measurement-completed",UNITS_CALIBRATION_STARTS_EVENT:"units_calibration_starts_event",FINISHED_CALIBRATION_FOR_DIMENSION_EVENT:"finished_calibration_for_dimension_event",CALIBRATION_REQUIRED_EVENT:"calibration-required",OPEN_CALIBRATION_PANEL_EVENT:"open-calibration-panel",CLOSE_CALIBRATION_PANEL_EVENT:"close-calibration-panel",CLEAR_CALIBRATION_SIZE_EVENT:"clear-calibration-size",FINISHED_CALIBRATION:"finished-calibration",DISPLAY_UNITS_CHANGED:"display-units-changed",PRECISION_CHANGED:"precision-changed",MEASUREMENT_MODE_ENTER:"measure-mode-enter",MEASUREMENT_MODE_LEAVE:"measure-mode-leave",DELETE_MEASUREMENT:"delete-measurement",SELECT_MEASUREMENT:"select-measurement",MEASURE_TOOL_ACTIVE:"measure-tool-active"}},31799:(e,t,i)=>{"use strict";i.d(t,{g:()=>s});var r=i(80933),n=i(33266),o=i(5621);function s(e,t,i){this.measurementType=e,this.id=t,this.picks=[],this.closedArea=!1,this.isRestored=!1,this.options=i,this.resetMeasureValues()}s.prototype.clone=function(){var e;const t=new s(this.measurementType,this.id,this.options);return t.closedArea=this.closedArea,t.isRestored=this.isRestored,t.picks=this.clonePicks(),t.angle=this.angle,t.distanceX=this.distanceX,t.distanceY=this.distanceY,t.distanceZ=this.distanceZ,t.distanceXYZ=this.distanceXYZ,t.arc=this.arc,t.location=null===(e=this.location)||void 0===e?void 0:e.clone(),t.result=Object.assign({},this.result),t},s.prototype.resetMeasureValues=function(){this.angle=0,this.distanceX=0,this.distanceY=0,this.distanceZ=0,this.distanceXYZ=0,this.arc=0,this.location=null,this.result=null},s.prototype.setPick=function(e,t){var i=this.picks[e]=t;return i.id=parseInt(e),i},s.prototype.getPick=function(e){var t=this.picks[e];return t||(t=this.setPick(e,new r.N)),t},s.prototype.clonePicks=function(e){var t=[];for(var i in this.picks)if(Object.prototype.hasOwnProperty.call(this.picks,i)){var r=this.picks[i];t.push(r.clone())}return t},s.prototype.countPicks=function(){return Object.keys(this.picks).length},s.prototype.getMaxNumberOfPicks=function(){switch(this.measurementType){case n.o.MEASUREMENT_DISTANCE:case n.o.MEASUREMENT_LOCATION:case n.o.MEASUREMENT_CALLOUT:case n.o.MEASUREMENT_ARC:return 2;case n.o.MEASUREMENT_ANGLE:return 3;case n.o.MEASUREMENT_AREA:return this.closedArea?this.countPicks():Number.MAX_VALUE-1}},s.prototype.hasPick=function(e){return this.picks[e]&&!this.picks[e].isEmpty()||this.isRestored},s.prototype.isComplete=function(){var e=this.countPicks()===this.getMaxNumberOfPicks();for(var t in this.picks)if(Object.prototype.hasOwnProperty.call(this.picks,t)&&!(e=e&&this.hasPick(t)))break;return e},s.prototype.isEmpty=function(){var e=!0;for(var t in this.picks)if(Object.prototype.hasOwnProperty.call(this.picks,t)&&!(e=e&&!this.hasPick(t)))break;return e},s.prototype.clearPick=function(e){this.picks[e]&&this.picks[e].clear(),this.resetMeasureValues()},s.prototype.clearAllPicks=function(){for(var e in this.picks)Object.prototype.hasOwnProperty.call(this.picks,e)&&this.clearPick(e)},s.prototype.hasEqualPicks=function(e,t){if(!e||!t)return!1;if(e.geomType===t.geomType){var i=(0,o.getSnapResultPosition)(e),r=(0,o.getSnapResultPosition)(t);return(0,o.isEqualVectors)(i,r,o.EPSILON)}return!1},s.prototype.computeResult=function(e,t){if(this.resetMeasureValues(),!t.model)return this.result=null,!1;var i=this.result=(0,o.computeResult)(e,this.measurementType,t,this.options);if(null===i)return!this.isComplete();switch(i.type){case n.o.MEASUREMENT_DISTANCE:return this.distanceXYZ=i.distanceXYZ,this.distanceX=i.distanceX,this.distanceY=i.distanceY,this.distanceZ=i.distanceZ,!0;case n.o.MEASUREMENT_ANGLE:return this.angle=isNaN(i.angle)?0:i.angle,!0;case n.o.MEASUREMENT_AREA:return this.area=i.area,!0;case n.o.MEASUREMENT_ARC:return this.arc=i.arc,!0;case n.o.MEASUREMENT_LOCATION:return this.location=i.location,!0;case n.o.MEASUREMENT_CALLOUT:return!0;default:return!1}},s.prototype.getGeometry=function(e){return{type:this.picks[e].geomType,geometry:this.picks[e].getGeometry()}},s.prototype.attachIndicator=function(e,t,i){this.indicator=new i(e,this,t),this.indicator.init()}},33266:(e,t,i)=>{"use strict";i.d(t,{D:()=>n,o:()=>r});var r={MEASUREMENT_DISTANCE:1,MEASUREMENT_ANGLE:2,MEASUREMENT_AREA:3,CALIBRATION:4,MEASUREMENT_CALLOUT:5,MEASUREMENT_LOCATION:6,MEASUREMENT_ARC:7},n={[r.MEASUREMENT_DISTANCE]:"Distance",[r.MEASUREMENT_ANGLE]:"Angle",[r.MEASUREMENT_AREA]:"Area",[r.CALIBRATION]:"Calibration",[r.MEASUREMENT_CALLOUT]:"Callout",[r.MEASUREMENT_LOCATION]:"Location",[r.MEASUREMENT_ARC]:"Arc"}},22133:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PDFUtils:()=>a});var r=i(37765);function n(e){var t,i;const r=null===(t=e.impl)||void 0===t||null===(t=t.model)||void 0===t?void 0:t.getDocumentNode(),n=null==r||null===(i=r.search(Autodesk.Viewing.BubbleNode.LEAFLET_NODE)[0])||void 0===i?void 0:i._raw();if(!n)return null;const o={};return new Autodesk.Viewing.Document(r.getRootNode()._raw(),"").getLeafletParams(o,r,n),o}function o(e){const t=new Autodesk.Viewing.Private.TexQuadConfig,i=n(e);if(!i)return null;t.initFromLoadOptions(null,i);return t.getBBox()}function s(e){const t=o(e);if(!t)return null;return r.SceneMath.getNormalizingMatrix(null,t)}var a={leafletToPdfWorld:function(e,t){const i=s(e);if(!i)return null;let n;if(t.applyMatrix4(i),e.model.isLeaflet()){const t=e.model.getMetadata("page_dimensions"),i=new THREE.Box3(new THREE.Vector3,new THREE.Vector3(t.page_width,t.page_height,0));n=r.SceneMath.getNormalizingMatrix(void 0,i)}else n=r.SceneMath.getNormalizingMatrix(e.model);return t.applyMatrix4(n.invert()),t},pdfToLeafletWorld:function(e,t){const i=r.SceneMath.getNormalizingMatrix(e.model);t.applyMatrix4(i);let n=s(e);return n?(t.applyMatrix4(n.invert()),t):null},getLeafletLoadOptions:n,getLeafletBoundingBox:o,getLeafletNormalizingMatrix:s}},80933:(e,t,i)=>{"use strict";i.d(t,{N:()=>n});var r=i(602);function n(){this.clear()}n.prototype.clear=function(){this.geomType=null,this.modelId=null,this.fragId=null,this.fragPos=null,this.snapNode=null,this.geomVertex=null,this.geomEdge=null,this.geomFace=null,this.radius=null,this.intersectPoint=null,this.faceNormal=null,this.viewportIndex2d=null,this.circularArcCenter=null,this.circularArcRadius=null,this.fromTopology=!1,this.isPerpendicular=!1,this.snapPoint=null},n.prototype.copyTo=function(e){e.modelId=this.modelId,e.fragId=this.fragId,e.fragPos=this.fragPos,e.snapNode=this.snapNode,e.geomVertex=this.geomVertex,e.geomFace=this.geomFace,e.geomEdge=this.geomEdge,e.radius=this.radius,e.geomType=this.geomType,e.intersectPoint=this.intersectPoint,e.faceNormal=this.faceNormal,e.viewportIndex2d=this.viewportIndex2d,e.circularArcCenter=this.circularArcCenter,e.circularArcRadius=this.circularArcRadius,e.fromTopology=this.fromTopology,e.isPerpendicular=this.isPerpendicular,e.snapPoint=this.snapPoint},n.prototype.clone=function(){var e=new n;return this.copyTo(e),e},n.prototype.isEmpty=function(){return!this.getGeometry()};let o=null,s=null,a=null;const l=(e,t)=>(s=s||new THREE.Vector3,a=a||new THREE.Vector3,s.set(0,0,0),a.set(e,0,0),s.applyMatrix4(t),a.applyMatrix4(t),s.distanceTo(a));n.prototype.applyMatrix4=function(e){if(this.geomEdge&&this.geomEdge.applyMatrix4(e),this.geomFace&&this.geomFace.applyMatrix4(e),this.geomVertex&&this.geomVertex.applyMatrix4(e),this.intersectPoint&&this.intersectPoint.applyMatrix4(e),this.circularArcCenter&&this.circularArcCenter.applyMatrix4(e),this.snapPoint&&this.snapPoint.applyMatrix4(e),this.faceNormal){o=o||new THREE.Matrix4;const t=o.getNormalMatrix(e);this.faceNormal.applyMatrix4(t)}this.radius=l(this.radius,e),this.circularArcRadius=l(this.circularArcRadius,e)},n.prototype.getFace=function(){return this.geomFace},n.prototype.getEdge=function(){return this.geomEdge},n.prototype.getVertex=function(){return this.geomVertex},n.prototype.getGeometry=function(){switch(this.geomType){case r.t.SNAP_VERTEX:case r.t.SNAP_MIDPOINT:case r.t.SNAP_INTERSECTION:case r.t.SNAP_CIRCLE_CENTER:case r.t.RASTER_PIXEL:return this.geomVertex;case r.t.SNAP_EDGE:return this.geomEdge;case r.t.SNAP_FACE:return this.geomFace;case r.t.SNAP_CIRCULARARC:case r.t.SNAP_CURVEDEDGE:return this.geomEdge;case r.t.SNAP_CURVEDFACE:return this.geomFace}return null},n.prototype.setGeometry=function(e,t){switch(e){case r.t.SNAP_VERTEX:case r.t.SNAP_MIDPOINT:case r.t.SNAP_INTERSECTION:case r.t.SNAP_CIRCLE_CENTER:case r.t.RASTER_PIXEL:this.geomVertex=t;break;case r.t.SNAP_EDGE:this.geomEdge=t;break;case r.t.SNAP_FACE:this.geomFace=t;break;case r.t.SNAP_CIRCULARARC:case r.t.SNAP_CURVEDEDGE:this.geomEdge=t;break;case r.t.SNAP_CURVEDFACE:this.geomFace=t;break;default:return}this.geomType=e}},602:(e,t,i)=>{"use strict";i.d(t,{t:()=>r});var r={SNAP_VERTEX:0,SNAP_MIDPOINT:1,SNAP_CIRCLE_CENTER:2,SNAP_EDGE:3,SNAP_FACE:4,SNAP_CIRCULARARC:5,SNAP_CURVEDEDGE:6,SNAP_CURVEDFACE:7,RASTER_PIXEL:8,SNAP_INTERSECTION:9}},81467:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelUnits:()=>s,calculatePrecision:()=>x,convertToDisplayUnits:()=>_,convertUnits:()=>b,fixUnitString:()=>v,formatValueWithUnits:()=>g,getMainUnit:()=>E,getUnitData:()=>y});var r=i(91493),n=i(47654);const o=i(30325);var s={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in",POINT:"pt"};const a={[s.METER]:1,[s.CENTIMETER]:.01,[s.MILLIMETER]:.001,[s.FOOT]:.3048,[s.INCH]:.0254,[s.POINT]:.0254/72};function l(e){let t="";return 2===e?t=String.fromCharCode(178):3===e&&(t=String.fromCharCode(179)),t}function h(e){var t=0<=e?Math.floor(e):Math.ceil(e);return{intPart:t,fracPart:e-t}}function c(e,t,i){var r="";return i&&0===e&&(r+="-"),r+=0<t?e.toFixed(t):e.toFixed(0)}function u(e,t,i,r){for(var n,o,s="",a=1,l=e<0,u=0;u<t;++u)a*=2;e>0?e+=.5/a:e-=.5/a,i?o=e:(s+=c(n=h(e/12).intPart,0,l)+r.feet+" ",(o=e-12*n)<0&&(o=-o));var d=h(o).intPart,p=h((o-d)*a).intPart;if(0!==p&&0===d||(s+=c(d,0)),0!==p){for(d<0&&p<0&&(p=-p);p%2==0;)p/=2,a/=2;0!==d&&(s+="-"),s+=c(p,0)+"/"+c(a,0)}return s+=r.inches}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;var r="";e<0&&(r="-",e=Math.abs(e));var n=h(e),o=n.intPart,s=n.fracPart*Math.pow(100,i);const a=l(i);let u=c(o,0),d=c(s,t);return d.startsWith(Math.pow(100,i).toString())&&(u=c(o+1,0),d=c(0,t)),r+u+` m${a} `+d+` cm${a}`}function p(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;var n="";e<0&&(n="-",e=Math.abs(e));var o=h(e),s=o.intPart,a=o.fracPart*Math.pow(12,r);const u=l(r);let d=c(s,0),p=c(a,t);return p.startsWith(Math.pow(12,r).toString())&&(d=c(s+1,0),p=c(0,t)),n+d+i.feet+u+" "+p+i.inches+u}const f={feetFractionalInches:"ft-and-fractional-in",fractionalInches:"fractional-in",feet:"feet",inches:"inches",stationingFeet:"feet"};function m(e){if(!e||!e.startsWith("autodesk.unit.unit:"))return e;let t=e.split(":")[1].split("-")[0],i=o.unit[t];if(!i)return console.warn("Failed to find Forge unit schema for",e),e;{let e=f[t];if(e)return e;if(!i.symbols)return console.warn("Unit without symbols.",i),"";if(i.defaultSymbol&&i.symbols[i.defaultSymbol])return i.symbols[i.defaultSymbol];for(let e in i.symbols)return i.symbols[e]}}function g(e,t,i,n,o){var s;null==n&&(n=3);const a=(o=o||{}).preferLetters?{feet:" ft",inches:" in"}:{feet:"'",inches:'"'};t=m(t);try{if(1===i)s=r.Z.t(e?"Yes":"No");else if(24===i){var h=e.split(" ");s=[];for(var f=0;f<h.length;++f)s.push(g(parseFloat(h[f]),t,3,n));s=s.join(", ")}else if(2!==i&&3!==i||!isNaN(e))if("ft-and-fractional-in"===t)s=u(12*e,n,!1,a);else if("ft-and-fractional-in^2"===t)s=o.noMixedArea?c(e,n)+" ft"+l(2):u(12*e,n,!1,a)+" "+l(2);else if("ft-and-fractional-in^3"===t)s=o.noMixedVolume?c(e,n)+" ft"+l(3):u(12*e,n,!1,a)+" "+l(3);else if("ft-and-decimal-in"===t)s=p(e,n,a);else if("ft-and-decimal-in^2"===t)s=o.noMixedArea?c(e,n)+" ft"+l(2):p(e,n,a,2);else if("ft-and-decimal-in^3"===t)s=o.noMixedVolume?c(e,n)+" ft"+l(3):p(e,n,a,3);else if("decimal-in"===t||"in"===t||"inch"===t||"inches"===t)s=c(e,n)+a.inches;else if("decimal-in^2"===t||"in^2"===t||"inch^2"===t)s=c(e,n)+" in"+l(2);else if("decimal-in^3"===t||"in^3"===t||"inch^3"===t)s=c(e,n)+" in"+l(3);else if("decimal-in-sq"===t||"fractional-in-sq"===t)s=c(e,n)+" sq. in";else if("decimal-ft"===t||"ft"===t||"feet"===t||"foot"===t)s=c(e,n)+a.feet;else if("decimal-ft^2"===t||"ft^2"===t||"feet^2"===t||"foot^2"===t)s=c(e,n)+" ft"+l(2);else if("decimal-ft^3"===t||"ft^3"===t||"feet^3"===t||"foot^3"===t)s=c(e,n)+" ft"+l(3);else if("decimal-ft-sq"===t||"ft-and-fractional-in-sq"===t||"ft-and-decimal-in-sq"===t)s=c(e,n)+" sq. ft";else if("fractional-in"===t)s=u(e,n,!0,a);else if("fractional-in^2"===t)s=u(e,n,!0,a)+l(2);else if("fractional-in^3"===t)s=u(e,n,!0,a)+l(3);else if("m-and-cm"===t)s=d(e,n);else if("m-and-cm^2"===t)s=o.noMixedArea?c(e,n)+" m"+l(2):d(e,n,2);else if("m-and-cm^3"===t)s=o.noMixedVolume?c(e,n)+" m"+l(3):d(e,n,3);else if(t&&t.text){s=function(e,t){const i=t.space?" ":"";return"Prefix"===t.placement?t.text+i+e:e+i+t.text}(3===i?c(e,n):e,t)}else 3===i&&t?(t=(t=t.replace("^2",l(2))).replace("^3",l(3)),s=c(e,n)+" "+t):s=t?e+" "+t:3===i?c(e,n):e;else s="NaN"}catch(i){s=t?e+" "+t:e}return s}function v(e){var t;switch(e=null===(t=e)||void 0===t?void 0:t.toLowerCase()){case"meter":case"meters":case"m":return s.METER;case"foot":case"feet":case"ft":return s.FOOT;case"feet and inches":case"inch":case"inches":case"in":return s.INCH;case"centimeter":case"centimeters":case"cm":return s.CENTIMETER;case"millimeter":case"millimeters":case"mm":return s.MILLIMETER;case"point":case"points":case"pt":return s.POINT;default:return e}}function y(e){let t=v(e);return{unitString:t,unitScale:a[t]||1}}function b(e,t,i,r,n,o){if(i=i||1,o=o||72,(e=v(e))===(t=v(t))&&1===i)return r;const l=s,h=a;var c=1;switch(t){case l.MILLIMETER:c=1/h[l.MILLIMETER];break;case l.CENTIMETER:c=1/h[l.CENTIMETER];break;case l.METER:c=1;break;case l.INCH:c=1/h[l.INCH];break;case l.FOOT:case"ft-and-fractional-in":case"ft-and-decimal-in":c=1/h[l.FOOT];break;case"decimal-in":c=1/h[l.INCH];break;case"decimal-ft":c=1/h[l.FOOT];break;case"fractional-in":c=1/h[l.INCH];break;case"m-and-cm":c=1;break;case l.POINT:c=1/h[l.INCH]*o}var u=1;switch(e){case l.MILLIMETER:u=h[l.MILLIMETER];break;case l.CENTIMETER:u=h[l.CENTIMETER];break;case l.METER:u=h[l.METER];break;case l.INCH:u=h[l.INCH];break;case l.FOOT:case"ft-and-fractional-in":case"ft-and-decimal-in":u=h[l.FOOT];break;case"decimal-in":u=h[l.INCH];break;case"decimal-ft":u=h[l.FOOT];break;case"fractional-in":u=h[l.INCH];break;case"m-and-cm":u=1;break;case l.POINT:u=h[l.INCH]/o}return"square"===n?r?r*Math.pow(c*u*i,2):0:"cube"===n?r?r*Math.pow(c*u*i,3):0:r?r*c*u*i:0}function x(e){if(!e)return 0;var t=e.toString().split(".")[1];if(!t){var i=e.toString().split("/")[1],r=i&&i.match(/\d+/);if(r){var n=parseFloat(r);if(n&&!isNaN(n))return Math.floor(Math.log2(n))}return 0}return(t=t.match(/\d+/))&&t[0]&&t[0].length||0}function _(e,t,i,r){if(!i||!r)return{displayValue:e,displayUnits:i};let o=i,s=r;const a=m(o);let l;if("object"==typeof a&&"text"in a&&(o=a.text),o&&(o=o.replace(/$/,"^2").replace(/$/,"^3")),/\^2$/.test(o)?(o=o.replace("^2",""),s+="^2",l="square"):/\^3$/.test(o)&&(o=o.replace("^3",""),s+="^3",l="cube"),o=(0,n.getUnitEnum)(o),null===o)return{displayValue:e,displayUnits:i};if(2===t||3===t){return{displayValue:b(o,r,1,e,l,null),displayUnits:s}}if(24===t){return{displayValue:e.split(" ").map((e=>b(o,r,1,e,l,null))).join(" "),displayUnits:s}}return{displayValue:e,displayUnits:i}}function E(e){switch(e){case"decimal-ft":case"ft-and-fractional-in":case"ft-and-decimal-in":return"ft";case"decimal-in":case"fractional-in":return"in";case"m-and-cm":return"m"}return e}},24404:(e,t,i)=>{"use strict";i.r(t),i.d(t,{UnitParser:()=>r});var r={};function n(e,t,i,r){if(!e)return NaN;var n,o=(e=e.toString()).trim();if(0==o.length)return NaN;var s=i.join("| *"),a=r.join("| *");if(n=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+") *$")))return parseFloat(n[1])/parseFloat(n[2])/t;if(n=o.match(new RegExp("^([+-]?\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+s+")? *$")))return parseFloat(n[1])/parseFloat(n[2]);var l;if(!(n=o.match(/^[+-]? *(?:\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?/i)))return NaN;if(l=parseFloat(n[0].replace(/ */g,"")),0==(o=(o=o.slice(n[0].length)).replace("-"," ")).length||isNaN(l))return l;var h=Math.sign(l);return 0===h&&(h=1),o.match(new RegExp("^(?: *)(?:"+a+") *$","i"))?l/t:(n=o.match(new RegExp("^ +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+") *$","i")))?(l+h*parseFloat(n[1])/parseFloat(n[2]))/t:(n=o.match(new RegExp("^(?: *)(?:"+s+"|-| +-?) *","i")))?0==(o=o.slice(n[0].length).trim()).length?n[0].match(/-/)?NaN:l:(n=o.match(new RegExp("^(\\d+(?:\\.\\d*)?)(?: *)(?:"+a+")? *$")))?l+h*parseFloat(n[1])/t:(n=o.match(new RegExp("^(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+")? *$")))?l+h*(parseFloat(n[1])/parseFloat(n[2]))/t:(n=o.match(new RegExp("^(\\d+) +(\\d+)(?: *)/(?: *)(\\d+)(?: *)(?:"+a+")? *$")))?l+h*(parseFloat(n[1])+parseFloat(n[2])/parseFloat(n[3]))/t:NaN:NaN}r.parseFeet=function(e){return n(e,12,["ft","feet","'","`","",""],["in","inch",'\\"',"''","``","",""])},r.parseMeter=function(e){return n(e,100,["m","meter"],["cm","centimeter"])},r.parseNumber=function(e,t){switch(t){case"ft":case"decimal-ft":case"ft-and-fractional-in":case"ft-and-decimal-in":case"decimal-in":case"fractional-in":return r.parseFeet(e);default:return r.parseMeter(e)}},r.parsePositiveNumber=function(e,t){var i=r.parseNumber(e,t);return i>=0?i:NaN}},18507:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MobileCallbacks:()=>n});const r=(0,i(7247).getGlobal)();function n(){this.ios=r.webkit,this.android=r.JSINTERFACE,this.iosSend=function(e,t){return r.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:t})},this.androidSend=r.JSINTERFACE}var o=n.prototype;o.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},o.onSelectionChanged=function(e){this.ios?this.iosSend("selectionChanged",e):this.android&&this.androidSend.onSelectionChanged(e)},o.onLongTap=function(e,t){this.ios?this.iosSend("onLongTap",[e,t]):this.android&&this.androidSend.onLongTap(e,t)},o.onSingleTap=function(e,t){this.ios?this.iosSend("onSingleTap",[e,t]):this.android&&this.androidSend.onSingleTap(e,t)},o.onDoubleTap=function(e,t){this.ios?this.iosSend("onDoubleTap",[e,t]):this.android&&this.androidSend.onDoubleTap(e,t)},o.setRTCSession=function(e){this.ios?this.iosSend("setRTCSession",{id:e}):this.android&&this.androidSend.setRTCSessionID(e)},o.putProperties=function(e,t){this.ios?this.iosSend("putProperties",{name:e,value:t}):this.android&&this.androidSend.putProperties(e,t)},o.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},o.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},o.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},o.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},o.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},o.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},o.updateAnimationTime=function(e){this.ios?this.iosSend("updateAnimationTime",e):this.android&&this.androidSend.updateAnimationTime(e)},o.setLoadingProgress=function(e,t){this.ios?this.iosSend("setLoadingProgress",{state:e,progress:t}):this.android&&this.androidSend.setLoadingProgress(e,t)},o.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},o.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},o.putSheets=function(e,t){this.ios?this.iosSend("putSheets",[e,t]):this.android&&this.androidSend.putSheets(e,t)},o.putAllSheets=function(e){this.ios?this.iosSend("putAllSheets",e):this.android&&this.androidSend.putAllSheets(e)},o.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},o.instanceTree=function(e){this.ios?this.iosSend("instanceTree",e):this.android&&this.androidSend.instanceTree(e)},o.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},o.sheetSelected=function(e){this.ios?this.iosSend("sheetSelected",e):this.android&&this.androidSend.sheetSelected(e)},"undefined"!=typeof window&&(r.MobileCallbacks=n)},91224:(e,t,i)=>{const{getGlobal:r}=i(10209);function n(e){for(var t=r(),i=e.split("."),n=0;n<i.length;++n)t[i[n]]=t[i[n]]||{},t=t[i[n]];return t}n("Autodesk.Viewing.Private"),n("Autodesk.Viewing.Extensions"),n("Autodesk.Extensions"),n("Autodesk.Viewing.Shaders"),n("Autodesk.Viewing.UI"),n("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=r,Autodesk.Viewing.AutodeskNamespace=n,r().AutodeskNamespace=n;var o=r().Autodesk.Viewing.Private;o.LMV_WORKER_URL="lmvworker.min.js",o.ENABLE_DEBUG=o.ENABLE_DEBUG||!1,r().ENABLE_DEBUG=o.ENABLE_DEBUG,o.ENABLE_INLINE_WORKER=!0,e.exports.Autodesk=r().Autodesk},65942:(e,t,i)=>{"use strict";function r(e){var t=Autodesk.Viewing,i=t.Private,r=t.UI,n=t.Extensions;for(let i in e.av)t[i]=e.av[i];for(let t in e.avp)i[t]=e.avp[t];for(let t in e.avu)r[t]=e.avu[t];for(let t in e.ave)n[t]=e.ave[t];t.getGlobal().THREE=e.THREE,t.getGlobal().LMV=e,i.isRightClick=t.isRightClick,i.isMiddleClick=t.isMiddleClick}i.d(t,{i:()=>r})},44741:(e,t,i)=>{"use strict";i.r(t),i.d(t,{loadDependency:()=>a,theResourceLoader:()=>s});var r=i(27156);const n=(0,i(7247).getGlobal)(),o=n.document;const s=new class{constructor(){this.loadPromises={}}getResourceUrl(e){return e.indexOf("://")>0?e:(0,r.getResourceUrl)(e)}loadScriptIntoDom(e,t,i){const r=o.createElement("SCRIPT");r.src=e;const n=function(){r.onerror=null,r.onload=null};r.onload=function(){n(),t()},r.onerror=function(t){n(),i&&i(new Error(`Error loading script ${e}, with error ${t}`))},o.head.appendChild(r)}loadScript(e,t){if(t&&void 0!==n[t])return Promise.resolve();const i=(e=this.getResourceUrl(e)).toLowerCase();if(i in this.loadPromises)return this.loadPromises[i];const o=(0,r.getScript)(e);return this.loadPromises[i]=o?Promise.resolve():new Promise(((t,i)=>{this.loadScriptIntoDom(e,t,i)})),this.loadPromises[i]}_getLink(e){const t=o.getElementsByTagName("link");for(let i=0,r=t.length;i<r;i++)if(t[i].href===e)return t[i];return null}};function a(e,t,i,r){s.loadScript(t,e).then((()=>{i&&i()})).catch((e=>{r&&r(e)}))}Object.freeze(s)},63481:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SearchManager:()=>n});class r{constructor(e){this.viewer=e}search(e){return new Promise(((e,t)=>{}))}getProviderId(){return"Search Provider Id"}}class n{constructor(e){this.viewer=e,this.searchProviders=new Map}addSearchProvider(e){this.searchProviders.has(e)||this.searchProviders.set(e,new e(this.viewer))}search(e){return new Promise(((t,i)=>{const r=this.prepareSearchInput(e),n=[];this.searchProviders.forEach((e=>{const t=e.search(r),i=e.getProviderId();t.id=i,n.push(t)})),Promise.all(n).then((e=>{const i={};e.forEach(((e,t)=>{const r=n[t].id;i[r]=e})),t(i)})).catch(i)}))}removeAllProviders(){this.searchProviders.clear()}removeProvider(e){this.searchProviders.delete(e)}prepareSearchInput(e){return e.toLowerCase()}}const o=AutodeskNamespace("Autodesk.Viewing.Search");o.SearchManager=n,o.ModelPartsSearchProvider=class extends r{constructor(e){super(e)}search(e){return new Promise(((t,i)=>{const r=this.viewer.getVisibleModels(),n=[];0===r.length&&t(n);for(let t=0;t<r.length;t++){const i=r[t],o=[],s=i.getInstanceTree();i.getObjectTree((t=>{t.enumNodeChildren(t.getRootId(),(t=>{const i=s&&s.getNodeName(t);i&&-1!==i.toLowerCase().indexOf(e)&&o.push(t)}),!0)})),n.push({ids:o,model:i})}t(n)}))}getProviderId(){return"ModelPartsSearchProvider"}},o.PropertiesSearchProvider=class extends r{constructor(e){super(e)}search(e){return new Promise(((t,i)=>{const r=this.viewer.getVisibleModels(),n=[];0===r.length&&t(n);for(let o=0;o<r.length;o++){const s=r[o];s.search(e,(e=>{n.push({ids:e,model:s}),n.length===r.length&&t(n)}),i)}}))}getProviderId(){return"PropertiesSearchProvider"}},o.TextSearchProvider=class extends r{constructor(e){super(e),e.loadExtension("Autodesk.StringExtractor")}search(e){return new Promise((t=>{this.viewer.getExtensionAsync("Autodesk.StringExtractor").then((i=>i.getDocumentStrings().then((i=>{const r=[],n=this.viewer.impl.get2DModels();for(let t=0;t<n.length;t++){const o=n[t].id,s=!n[t].isLeaflet(),a=i[o];if(!a)continue;const l=a.strings,h=this.searchStrings(l,e,o,s);r.push({modelId:o,searchResult:h})}t(r)}))))}))}searchStrings(e,t,i,r){let n=[];if(r)for(let r=0;r<e.length;r++){let o=0;const s=[];for(;-1!==o;)o=e[r].string.toLowerCase().indexOf(t,o),-1!==o&&(s.push(o),o+=1);if(s.length>0){const o=this.splitOccurrences(e[r],s,t,i);n=n.concat(o)}}else for(let i=0;i<e.length;i++)-1!==e[i].string.toLowerCase().indexOf(t)&&n.push(e[i]);return n}splitOccurrences(e,t,i,r){const n=this.viewer.impl.findModel(r),o=[];let s=1/72;const a=n.getData();function l(t,i){const r=e.stringCharWidths.slice(t,i);if(!r.length)return 0;return r.reduce(((e,t)=>e+t))}if(n){const r=a.metadata.page_dimensions.page_units;s*=Autodesk.Viewing.Private.convertUnits(Autodesk.Viewing.Private.ModelUnits.INCH,r,1,1);const h=a.scaleX,c=(n.getData().scaleY||s)*e.stringHeight;for(let r=0;r<t.length;r++){const n={string:i};let a=l(0,t[r]),u=l(t[r],t[r]+i.length);if(e.stringWidth){const t=l(0,e.string.length),i=e.stringWidth/t*s;a*=i,u*=i}else a*=h,u*=h;const d=e.angle||0,p=Math.cos(d)*a,f=Math.sin(d)*a;let m=e.stringPosition[0]+p,g=e.stringPosition[1]+f,v=m+u,y=g+c;const b=new THREE.Vector2(m,g),x=new THREE.Vector2(v,y),_=new THREE.Box2(b,x);n.boundingBox=_,n.angle=e.angle,o.push(n)}}return o}getProviderId(){return"TextSearchProvider"}}},82553:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DefaultHandler:()=>n});i(75050);var r=i(7247);function n(e,t,i){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(e){this.clickConfig=e},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(e){},this.deactivate=function(e){},this.handleAction=function(t,r,n){for(var o=0;o<t.length;++o)switch(t[o]){case"selectOnly":e.selector&&r&&e.selector.setSelection([r.dbId],r.model,void 0,n);break;case"deselectAll":e.selector&&e.selector.setSelection([]);break;case"selectToggle":e.selector&&r&&e.selector.toggleSelection(r.dbId,r.model);break;case"isolate":r&&e.isolate(r.dbId);break;case"showAll":e.showAll();break;case"setCOI":r&&r.intersectPoint&&(i.setPivotPoint(r.intersectPoint,!0,!0),i.pivotActive(!0,!0));break;case"hide":r&&e.hide(r.dbId);break;case"show":r&&e.show(r.dbId);break;case"toggleVisibility":r&&e.toggleVisibility(r.dbId);break;case"focus":e.selector&&(r?e.selector.setSelection([r.dbId],r.model):e.selector.setSelection([]),i.fitToView())}},this.handleSingleClick=function(t,n){if((0,r.isMobileDevice)())return!1;const o=e.isRightBtnSelectionEnabled();var s=t.ctrlKey||t.metaKey,a=t.shiftKey,l=t.altKey;if(0===n||2===n&&o){var h=e.clientToViewport(t.canvasX,t.canvasY),c="click";s&&(c+="Ctrl"),a&&(c+="Shift"),l&&(c+="Alt");var u=(d=e.hitTestViewport(h,!1))?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[c]&&this.clickConfig[c][u])return this.handleAction(this.clickConfig[c][u],d,n),!0}else if(1===n&&a&&!l&&!s){var d;h=e.clientToViewport(t.canvasX,t.canvasY);if((d=e.hitTestViewport(h,!1))&&d.intersectPoint)return i.setPivotPoint(d.intersectPoint,!0,!0),i.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(r,n){if(e.selector&&0===n){var o=e.clientToViewport(r.canvasX,r.canvasY),s=e.hitTestViewport(o,!1);return s?e.selector.setSelection([s.dbId],s.model):e.selector.clearSelection(),i.fitToView(),!0}return 1===n&&(t.fitBounds(!1,i.getBoundingBox(!0)),t.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(i){if(i.clientX=i.pointers[0].clientX,i.clientY=i.pointers[0].clientY,e.api.triggerSingleTapCallback(i),i.hasOwnProperty("pointers")&&2===i.pointers.length)return t.setRequestHomeView(!0),!0;if(e.selector&&!e.selector.selectionDisabled){var r=e.clientToViewport(i.canvasX,i.canvasY),n=e.hitTestViewport(r,!1);return n?(e.selector.setSelection([n.dbId],n.model),e.api.triggerSelectionChanged([n.dbId])):(e.selector.clearSelection(),e.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(t){t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerDoubleTapCallback(t);var r=this.handleSingleTap(t,0);return i.fitToView(),r},this.handlePressHold=function(t){return"press"===t.type&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerContextMenu(t))},this.handleGesture=function(t){return!!t.type.includes("swipe")&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerSwipeCallback(t))}}},11496:(e,t,i)=>{"use strict";i.r(t),i.d(t,{FovTool:()=>n});var r=i(75050);function n(e){var t=.001,i=e.navigation,n=i.getCamera(),o=["fov"],s=!1,a=0,l=null,h=null,c=!1,u=0,d=-5,p=-1,f=d,m=new r.Vector3,g=new r.Vector3,v=new r.Vector3,y=null;function b(e){return e<0&&e>-3?-3:e>0&&e<3?3:e}this.getNames=function(){return o},this.getName=function(){return o[0]},this.activate=function(e){u=0},this.deactivate=function(e){f=d},this.getCursor=function(){return 0!==u&&f===d?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(e){var i=g.x-m.x,r=g.y-m.y,n=g.z-m.z;Math.abs(i)<t&&(i=0),Math.abs(r)<t&&(r=0),Math.abs(n)<t&&(n=0),e.set(i,r,n)},this.stepMotionDelta=function(e,t){t?(m.x+=.6*e.x,m.y+=.6*e.y,m.z+=.6*e.z):m.copy(g)},this.getAccumulatedWheelDelta=function(){var e=Date.now(),t=0;return h&&e-h>100?(t=b(a),a=0,l=null,h=null,c=!1):l&&e-l>100&&(c?Math.abs(a)>=3&&(t=a,a=0):(t=b(a),c=!0,a=0)),t},this.update=function(){var e=!1,t=f>d;if(f>d){this.controller.setIsLocked(!0),this.getMotionDelta(v);var r=v.x,o=v.y,a=v.z;if(0!==r||0!==o||0!==a)if(t=!0,f>=0)o=-o,0!==(a=Math.abs(r)>Math.abs(o)?r:o)&&(a*=-1,i.setVerticalFov(i.getVerticalFov()*(1+a),!0));else{var l=this.getAccumulatedWheelDelta()/3;0!==l&&i.setFocalLength(i.getFocalLength()+l,!0)}this.stepMotionDelta(v,!0),f===p&&Math.abs(a)<1e-5&&(this.interactionEnd(p),e=!0)}return t?this.utilities.pivotActive(i.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!s&&(e||f>d)&&(f>p&&m.copy(g),f=d,this.controller.setIsLocked(!1)),n.dirty},this.interactionStart=function(e,t){(t||e>f)&&(f=e,s=!0),i.toPerspective()},this.interactionEnd=function(e){e===f&&(e!==p&&this.utilities.pivotActive(!1),s=!1)},this.handleWheelInput=function(e){if(f>p)return!1;i.getReverseZoomDirection()&&(e*=-1),g.z+=e,a+=e;var t=Date.now();return l||(l=t),h=t,0!=e&&this.interactionStart(p),!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return this.handleButtonUp(e,0);case"drag3start":return y="drag",this.handleButtonDown(e,0);case"drag3move":return"drag"===y&&this.handleMouseMove(e);case"drag3end":return"drag"===y&&this.handleButtonUp(e,0),y=null,!1}return!1},this.handleButtonDown=function(e,t){return u+=1<<t,2!==t&&(m.x=.5*(e.normalizedX+1),m.y=1-.5*(e.normalizedY+1),g.copy(m),this.interactionStart(t),!0)},this.handleButtonUp=function(e,t){return u-=1<<t,2!==t&&(g.x=.5*(e.normalizedX+1),g.y=1-.5*(e.normalizedY+1),this.interactionEnd(t),!0)},this.handleMouseMove=function(e){return g.x=.5*(e.normalizedX+1),g.y=1-.5*(e.normalizedY+1),f>p},this.handleBlur=function(e){return this.interactionEnd(f),!1}}},44160:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GestureHandler:()=>s,GestureRecognizers:()=>o});var r=i(7247);let n;(0,r.isNodeJS)()||(n=i(79058));const o={};function s(e){var t=e.navigation,i=["gestures"],s=this,a=!0,l=!1,h=!0,c=null,u=!1,d=(0,r.isTouchDevice)();t.setIsTouchDevice(d),d&&((c=new n.Manager(e.canvasWrap,{recognizers:[o.drag,o.doubletap,o.doubletap2,o.singletap,o.singletap2,o.press,o.drag3,o.swipe,o.pan,o.pinch,o.rotate],handlePointerEventMouse:!1,inputClass:n.TouchInput})).get("pinch").recognizeWith([c.get("drag")]),e.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(e){e.preventDefault()},this.getNames=function(){return i},this.getName=function(){return i[0]},this.isActive=function(){return u},this.__clientToCanvasCoords=function(t){var i,r,n=e.impl.getCanvasBoundingClientRect(),o=n.width,s=n.height;t.hasOwnProperty("center")?(i=t.center.x-n.left,r=t.center.y-n.top):(i=t.pointers[0].clientX-n.left,r=t.pointers[0].clientY-n.top),t.canvasX=i,t.canvasY=r,t.normalizedX=i/o*2-1,t.normalizedY=(s-r)/s*2-1},this.distributeGesture=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handleGesture",e)&&e.preventDefault()},this.onSingleTap=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handleSingleTap",e)&&e.preventDefault()},this.onDoubleTap=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handleDoubleTap",e)&&e.preventDefault()},this.onPressHold=function(e){s.__clientToCanvasCoords(e),s.controller.distributeEvent("handlePressHold",e)&&e.preventDefault()},this.onHammerInput=function(e){s.setMouseDisabledWhenTouching(e)},this.setMouseDisabledWhenTouching=function(e){e.isFirst&&!l?(a=s.controller.enableMouseButtons(!1),l=!0):e.isFinal&&setTimeout((function(){s.controller.enableMouseButtons(a),l=!1}),10)},this.activate=function(e){c&&!u&&(c.on("dragstart dragmove dragend",this.distributeGesture),c.on("singletap",this.onSingleTap),c.on("singletap2",this.onSingleTap),c.on("doubletap",this.onDoubleTap),c.on("doubletap2",this.onDoubleTap),c.on("press pressup",this.onPressHold),c.on("drag3start drag3move drag3end",this.distributeGesture),c.on("swipeleft swiperight swipeup swipedown",this.distributeGesture),h&&(c.on("panstart panmove panend",this.distributeGesture),c.on("pinchstart pinchmove pinchend",this.distributeGesture),c.on("rotatestart rotatemove rotateend",this.distributeGesture)),c.on("hammer.input",this.onHammerInput),c.get("doubletap2").recognizeWith("doubletap"),c.get("singletap2").recognizeWith("singletap"),c.get("singletap").requireFailure("doubletap"),c.get("swipe").recognizeWith("drag")),u=!0},this.deactivate=function(e){c&&u&&(c.off("dragstart dragmove dragend",this.distributeGesture),c.off("singletap",this.onSingleTap),c.off("singletap2",this.onSingleTap),c.off("doubletap",this.onDoubleTap),c.off("doubletap2",this.onDoubleTap),c.off("press pressup",this.onPressHold),c.off("drag3start drag3move drag3end",this.distributeGesture),c.off("swipeleft swiperight swipeup swipedown",this.distributeGesture),h&&(c.off("panstart panmove panend",this.distributeGesture),c.off("pinchstart pinchmove pinchend",this.distributeGesture),c.off("rotatestart rotatemove rotateend",this.distributeGesture)),c.off("hammer.input",this.onHammerInput)),u=!1},this.update=function(){return!1},this.handleBlur=function(e){return!1},this.disableTwoFingerSwipe=function(){h=!1,c&&(c.remove(n.Pan),c.remove(n.Pinch),c.remove(n.Rotate),c.off("panstart panmove panend",this.distributeGesture),c.off("pinchstart pinchmove pinchend",this.distributeGesture),c.off("rotatestart rotatemove rotateend",this.distributeGesture))},this.setGestureParameter=function(e,t,i){const r=c&&c.get(e);return!!r&&(r.options[t]=i,!0)},this.restoreGestureParameterDefault=function(e,t){const i=c&&c.get(e);if(!i)return!1;const r=o[e][1];return i.options[t]=r.hasOwnProperty(t)?r[t]:i.defaults[t],!0}}n&&function(){if(!o.singletap){var e=o;e.singletap=[n.Tap,{event:"singletap",threshold:7,time:400}],e.singletap2=[n.Tap,{event:"singletap2",pointers:2,threshold:7,time:400}],e.press=[n.Press,{event:"press",time:500,threshold:50}],e.doubletap=[n.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],e.doubletap2=[n.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],e.swipe=[n.Swipe,{event:"swipe",pointers:1,threshold:200,velocity:1.7}],e.drag=[n.Pan,{event:"drag",pointers:1}],e.drag3=[n.Pan,{event:"drag3",pointers:3,threshold:15}],e.pan=[n.Pan,{event:"pan",pointers:2,threshold:20}],e.pinch=[n.Pinch,{event:"pinch",pointers:2,enable:!0,threshold:.05}],e.rotate=[n.Rotate,{event:"rotate",pointers:2,enable:!0,threshold:7}]}}()},61599:(e,t,i)=>{"use strict";function r(e){var t=["hottouch"],i={SHIFT:0,ALT:0,CONTROL:0},r=null,n=null,o=!1,s=!1,a=null,l=16,h=17,c=18;this.active=!1,this.getNames=function(){return t},this.getName=function(){return t[0]},this.activate=function(e){this.active=!0},this.deactivate=function(e){this.active=!1},this.isActive=function(){return this.active},this.__checkStart=function(){a&&(this.controller.distributeEvent("handleGesture",a),a=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var t=e.getActiveNavigationTool(),i=!1===o&&!0===s;if(i||!0===o&&!1===s){var a=i?"worldup":"fov";if(t===a)return!1;if(t===r)return e.setActiveNavigationTool(a),r=a,this.__checkStart(),!1;n=t,e.setActiveNavigationTool(a),r=a,this.__checkStart()}else r&&(e.setActiveNavigationTool(n),r=null,n=null);return!1},this.resetKeys=function(){i.SHIFT=0,i.CONTROL=0,i.ALT=0},this.updateModifierState=function(e){i.CONTROL=e.ctrlKey?1:0,i.SHIFT=e.shiftKey?1:0,i.ALT=e.altKey?1:0},this.handleGesture=function(t){if(t===a)return!1;switch(t.type){case"drag3start":e.navigation.isActionEnabled("fov")&&(a=t,o=!0);break;case"drag3move":case"rotatemove":break;case"drag3end":o=!1;break;case"rotatestart":e.navigation.isActionEnabled("roll")&&(a=t,s=!0);break;case"rotateend":s=!1}return!1},this.handleKeyDown=function(e,t){switch(this.updateModifierState(e),t){case l:i.SHIFT=1;break;case h:i.CONTROL=1;break;case c:i.ALT=1}return!1},this.handleKeyUp=function(e,t){switch(this.updateModifierState(e),t){case l:i.SHIFT=0;break;case h:i.CONTROL=0;break;case c:i.ALT=0}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),!1},this.handleButtonUp=function(e,t){return this.updateModifierState(e),!1},this.handleMouseMove=function(e){return this.updateModifierState(e),!1},this.handleBlur=function(e){return this.resetKeys(),!1}}i.r(t),i.d(t,{HotGestureTool:()=>r})},70169:(e,t,i)=>{"use strict";i.r(t),i.d(t,{HotkeyManager:()=>n});const r=function(e,t){return e-t};function n(){var e=[],t=[],i=[],n=[],o=["hotkeys"];this.getNames=function(){return o},this.getName=function(){return o[0]},this.pushHotkeys=function(t,i,n){if(e.some((function(e){return e.id===t})))return!1;for(var o=0;o<i.length;o++)e.push({id:t,keys:i[o].keycodes.sort(r).join(),onPress:i[o].onPress,onRelease:i[o].onRelease,options:n||{}});return!0},this.popHotkeys=function(t){for(var i=!1,r=e.length-1;r>=0;r--)e[r].id===t&&(e.splice(r,1),i=!0);return i};const s=function(){var e,r=t.join();for(e=0;e<n.length;)n[e].keys===r?n.splice(e,1):e++;for(e=0;e<i.length;)i[e].keys!==r?i.splice(e,1):e++};this.handleKeyDown=function(r,o){if(-1===t.indexOf(o)){for(var a=t.join(),l=t.slice(0),h=0;h<t.length&&t[h]<o;)h++;t.splice(h,0,o);var c=t.join(),u=t.slice(0);s();var d,p=[],f=[];for(h=e.length-1;h>=0;h--)(d=e[h]).keys===a&&d.onRelease?p.unshift(d):d.keys===c&&d.onPress&&f.unshift(d);for(h=p.length-1;h>=0&&!(d=p[h]).onRelease(l);h--)d.options.tryUntilSuccess&&n.unshift(d);for(h=f.length-1;h>=0&&!(d=f[h]).onPress(u);h--)d.options.tryUntilSuccess&&i.unshift(d)}},this.handleKeyUp=function(r,o){var a=t.join(),l=t.slice(0),h=t.indexOf(o);h>-1&&t.splice(h,1);var c=t.join(),u=t.slice(0);s();var d,p=[],f=[];for(h=e.length-1;h>=0;h--)(d=e[h]).keys===a&&d.onRelease?p.unshift(d):d.keys===c&&d.onPress&&f.unshift(d);for(h=p.length-1;h>=0&&!(d=p[h]).onRelease(l);h--)d.options.tryUntilSuccess&&n.unshift(d);for(h=f.length-1;h>=0&&!(d=f[h]).onPress(u);h--)d.options.tryUntilSuccess&&i.unshift(d)},this.update=function(){var e,t;for(t=0;t<n.length;)!0===(e=n[t]).onRelease(e.keys.split())?n.splice(t,1):t++;for(t=0;t<i.length;)!0===(e=i[t]).onPress(e.keys.split())?i.splice(t,1):t++;return!1},this.handleBlur=function(){for(var e=t.length-1;e>=0;e--)this.handleKeyUp(null,t[e])},this.activate=function(){},this.deactivate=function(){}}},70095:(e,t,i)=>{"use strict";i.r(t),i.d(t,{KeyCode:()=>r});const r={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,PLUS:107,PLUSMOZ:171,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224}},87432:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Navigation:()=>a});var r=i(75050),n=i(60489),o=i(68482);const s={TRANSITION_ACTIVE_FLAG_CHANGED:"transitionActiveFlagChanged"};function a(e){var t=6.88,i=1e-6;this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=i,this.__minDistance=1e-5;var n=void 0,o=void 0,s=2,a=200,l=null,h={left:0,top:0,width:1,height:1},c=Number.MAX_VALUE;this.uninitialize=function(){this.setCamera(null)},this.setMinimumLineWidth=function(e){c=e||Number.MAX_VALUE},this.setCamera=function(e){e!==l&&(l=e,e&&(Object.prototype.hasOwnProperty.call(e,"target")||(e.target=new r.Vector3(0,0,0)),Object.prototype.hasOwnProperty.call(e,"pivot")||(e.pivot=new r.Vector3(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return l},this.setScreenViewport=function(e){h=e},this.getScreenViewport=function(){return h},this.__setUp=function(e){if(e&&l&&0!==e.clone().normalize().sub(l.worldup).lengthSq())return l.worldup.copy(e).normalize(),l.dirty=!0,!0;return!1},this.__getUp=function(){return l?l.worldup:new r.Vector3(0,1,0)},this.setView=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!l)return;e&&t&&(l.position.copy(e),l.target.copy(t),null!=i&&l.up.copy(i),l.dirty=!0)},this.orientCameraUp=function(e){l&&(this.isActionEnabled("roll")||e)&&(l.up.copy(this.getAlignedUpVector()),l.dirty=!0)},this.getPivotPoint=function(){return l?l.pivot.clone():new r.Vector3(0,0,0)},this.setPivotPoint=function(e){l&&e&&l.pivot.copy(e)},this.getPosition=function(){return l?l.position.clone():new r.Vector3(0,0,1)},this.setPosition=function(e){l&&e&&(l.position.copy(e),l.dirty=!0)},this.setTarget=function(e){l&&e&&(l.target.copy(e),l.dirty=!0)},this.getTarget=function(){return l?l.target.clone():new r.Vector3(0,0,0)},this.getEyeVector=function(){return l?l.target.clone().sub(l.position):new r.Vector3(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(e){return l?e.getCenter(new r.Vector3).sub(l.position):new r.Vector3(0,0,-1)},this.getFovMin=function(){return t},this.getFovMax=function(){return 100},this.setZoomInLimitFactor=function(e){a=e},this.getZoomInLimitFactor=function(){return a},this.setZoomOutLimitFactor=function(e){s=e},this.getZoomOutLimitFactor=function(){return s},this.isPointVisible=function(e){return(new r.Frustum).setFromProjectionMatrix(l.projectionMatrix.clone().multiply(l.matrixWorldInverse)).containsPoint(e)},this.setVerticalFov=function(e,n){if((!l||l.isPerspective)&&(e<t?e=t:e>100&&(e=100),l&&this.isActionEnabled("fov"))){if(Math.abs(l.fov-e)<=i)return;if(n){var o=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),s=this.getPosition(),a=this.getEyeVector(),h=r.Math.degToRad(l.fov),c=r.Math.degToRad(e),u=o?this.getPivotPlaneDistance():a.length(),d=u*Math.tan(.5*h)/Math.tan(.5*c),p=a.normalize().multiplyScalar(u-d);this.setPosition(s.add(p)),o&&this.setTarget(this.getTarget().add(p))}l.setFov(e),l.dirty=!0}},this.applyRotation=(e,t,i,r)=>{e.sub(i),e.applyAxisAngle(r,t),e.add(i)},this.getSignedAngle=(e,t,i)=>{var r=e.angleTo(t),n=e.clone().cross(t).normalize();return r*(i.dot(n)>0?1:-1)},this.computeFit=function(t,i,n,o,s){if(!o||o.isEmpty())return{position:t,target:i};s=void 0===s?1:s;for(var a=o.getCenter(new r.Vector3),l=o.getSize(new r.Vector3),h=t.clone().sub(i).normalize(),c=Math.tan(r.Math.degToRad(.5*n)),u=0,d=this.computeOrthogonalUp(t,i),p=h.clone().cross(d).normalize(),f=new r.Vector3,m=0===l.z?4:8,g=0;g<m;g++){f.set(0==(1&g)?-.5*l.x:.5*l.x,0==(2&g)?-.5*l.y:.5*l.y,0==(4&g)?-.5*l.z:.5*l.z);var v=0;e.isPerspective&&(v=f.dot(h));var y=Math.abs(f.dot(d)),b=Math.abs(f.dot(p)),x=v+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*y/c;u<x&&(u=x),u<(x=v+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*b/(s*c))&&(u=x)}return a.add(d.multiplyScalar(-u*this.FIT_TO_VIEW_VERTICAL_OFFSET)),a.add(p.multiplyScalar(u*this.FIT_TO_VIEW_HORIZONTAL_OFFSET)),h.multiplyScalar(u),{position:a.clone().add(h),target:a}},this.computeOrthogonalUp=function(e,t){var i=this.__getUp(),r=t.clone().sub(e);if(0===r.lengthSq())return r.copy(i);var n=r.clone().cross(i);return 0===n.lengthSq()&&(i.z>i.y?r.y-=1e-4:r.z-=1e-4,n.crossVectors(r,i)),n.cross(r).normalize()},this.fitBounds=function(e,t,i,r){const n=this.getTarget(),o=this.getPosition();if(!this.isActionEnabled("gotoview")&&!r||!t||t.isEmpty())return{position:o,target:n};const s=this.getVerticalFov();i||(t=this.rotateBoundsToCamera(t,o,n));const a=this.computeFit(o,n,s,t,l.aspect),h=i?this.computeOrthogonalUp(o,n):l.up;return e?(l.up.copy(h),this.setView(a.position,a.target)):this.setRequestTransitionWithUp(!0,a.position,a.target,s,h),this.setPivotPoint(a.target),this.setPivotSetFlag(!0),a},this.rotateBoundsToCamera=function(e,t,i){const n=(e=e.clone()).getCenter(new r.Vector3),o=t.clone().sub(i).normalize(),s=this.getSignedAngle(this.getCameraUpVector(),this.getAlignedUpVector(),o);return this.applyRotation(e.min,s,n,o),this.applyRotation(e.max,s,n,o),e.setFromPoints([e.min.clone(),e.max.clone()]),e},this.computeOverviewDistance=function(e){var t=e.getSize(new r.Vector3);if(this.__is2D){var i=l.aspect,n=t.x/i,o=t.y;return Math.max(n,o)}var s=this.getVerticalFov(),a=t.length();return 0===a&&(a=2),l.isPerspective?.5*a/Math.tan(r.Math.degToRad(.5*s)):a},this.applyDollyConstraint=function(e,t){if(!(n||o||s)||!this.__is2D)return e;var i=e;if(n&&s&&t&&e>1){var r,h=l.isPerspective?this.getEyeToCenterOfBoundsVec(t):this.getEyeVector();r=n?s*this.computeOverviewDistance(n):s*this.computeOverviewDistance(t);var u=Math.abs(r/h.length());u=Math.max(u,1),i=Math.min(i,u)}if(o||a&&t){var d=(o?l.clientHeight/o:Math.min(c,this.computeOverviewDistance(t)/a))/-this.getEyeVector().z;d=Math.min(d,1),i=Math.max(i,d)}return i},this.applyPanningConstraint2D=function(e){if(this.__is2D&&n){var t=l.position.x+e.x,i=l.position.y+e.y;t=r.Math.clamp(t,n.min.x,n.max.x),i=r.Math.clamp(i,n.min.y,n.max.y);var o=t-l.position.x,s=i-l.position.y,a=Math.min(e.x,0),h=Math.min(e.y,0),c=Math.max(e.x,0),u=Math.max(e.y,0);o=r.Math.clamp(o,a,c),s=r.Math.clamp(s,h,u),e.x=o,e.y=s}},this.updateCamera=function(){l&&(l.updateProjectionMatrix(),this.orient(l,l.target,l.position,l.up),l.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,t){n=e,o=t},this.getConstrains2D=function(){return{maxViewRegion:n,maxPixelPerUnit:o}}}a.prototype.constructor=a,a.prototype.setIs2D=function(e){this.__is2D=!!e},a.prototype.getIs2D=function(){return this.__is2D},a.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},a.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},a.prototype.orient=function(){var e,t,i,n;return function(o,s,a,l){e||(e=new r.Matrix4,t=new r.Vector3,i=new r.Vector3,n=new r.Vector3);var h=e.elements;n.subVectors(a,s).normalize(),0===n.lengthSq()&&(n.z=1),t.crossVectors(l,n).normalize(),0===t.lengthSq()&&(l.z>l.y?n.y-=1e-4:n.z+=1e-4,t.crossVectors(l,n).normalize()),i.crossVectors(n,t),h[0]=t.x,h[4]=i.x,h[8]=n.x,h[1]=t.y,h[5]=i.y,h[9]=n.y,h[2]=t.z,h[6]=i.z,h[10]=n.z,o.setRotationFromMatrix(e)}}(),a.prototype.fov2fl=function(e){var t=r.Math.degToRad(e);return t<=0&&(t=1e-4),Math.round(12/Math.tan(.5*t))},a.prototype.fl2fov=function(e){e<=0&&(e=1e-4);var t=2*Math.atan(12/e);return r.Math.radToDeg(t)},a.prototype.setCameraUpVector=function(e,t){if(this.isActionEnabled("roll")||t){var i=this.getCamera();i.up.copy(e),i.dirty=!0}},a.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector();return e.cross(t).normalize()},a.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector();return e.cross(t).normalize()},a.prototype.getCameraRightVector=function(e){var t=new r.Vector3,i=e?this.getWorldUpVector():this.getCamera().up,n=this.getEyeVector();return t.crossVectors(n,i),0===t.lengthSq()&&(Math.abs(n.z)>=Math.abs(n.y)?i.set(0,1,0):i.set(0,0,1),t.crossVectors(n,i)),t.normalize()},a.prototype.setWorldUpVector=function(e,t,i){(this.isActionEnabled("roll")||i)&&(this.__setUp(e),t&&this.orientCameraUp(i))},a.prototype.getWorldUpVector=function(){return this.__getUp().clone()},a.prototype.getWorldRightVector=function(){var e=new r.Vector3;return e.copy(this.__getUp()),Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},a.prototype.getVerticalFov=function(){return this.getCamera().fov},a.prototype.getHorizontalFov=function(){var e=this.getScreenViewport();return this.getCamera().fov*(e.width/e.height)},a.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},a.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},a.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},a.prototype.setReverseHorizontalLookDirection=function(e){this.getIs2D()?n.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):this.__options.reverseHorizontalLookDirection=!!e},a.prototype.setReverseVerticalLookDirection=function(e){this.getIs2D()?n.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):this.__options.reverseVerticalLookDirection=!!e},a.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},a.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(n.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},a.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(n.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},a.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},a.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},a.prototype.setOrbitPastWorldPoles=function(e){this.getIs2D()?n.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):this.__options.orbitPastPoles=!!e},a.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(n.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},a.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},a.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},a.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},a.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},a.prototype.setWheelSetsPivot=function(e){this.__options.wheelSetsPivot=!!e},a.prototype.getWheelSetsPivot=function(){return this.__options.wheelSetsPivot},a.prototype.setSelectionSetsPivot=function(e){this.__options.SelectionSetsPivot=!!e},a.prototype.getSelectionSetsPivot=function(){return this.__options.SelectionSetsPivot},a.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},a.prototype.getIsLocked=function(){return this.__options.lockNavigation},a.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)Object.prototype.hasOwnProperty.call(e,t)&&(this.__lockSettings[t]=e[t])},a.prototype.getLockSettings=function(){var e={};for(var t in this.__lockSettings)e[t]=this.__lockSettings[t];return e},a.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||!0===this.__lockSettings[e]},a.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},a.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},a.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},a.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},a.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},a.prototype.getRequestHomeView=function(){return this.__homeViewRequested},a.prototype.setRequestTransition=function(e,t,i,r,n,o){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:r,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:n,pivot:o?o.clone():i.clone()}:null},a.prototype.setRequestTransitionWithUp=function(e,t,i,r,n,o,s){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:r,up:n.clone(),worldUp:o||this.getWorldUpVector(),reorient:!1,pivot:s?s.clone():i.clone()}:null},a.prototype.getRequestTransition=function(){return this.__destinationView},a.prototype.setTransitionActive=function(e){const t=this.__transitionActive!=e;this.__transitionActive=!!e,t&&this.fireEvent({type:s.TRANSITION_ACTIVE_FLAG_CHANGED,transitionActive:!!e})},a.prototype.getTransitionActive=function(){return this.__transitionActive},a.prototype.getWorldSize=function(e){var t=this.getCamera(),i=t.aspect,n=2*e*Math.tan(r.Math.degToRad(.5*t.fov)),o=n*i;return new r.Vector2(o,n)},a.prototype.screenToViewport=function(e,t){return e=2*e-1,t=2*(t=1-t)-1,new r.Vector3(e,t,1)},a.prototype.viewportToScreen=function(e,t){return e=(e+1)/2,t=1-(t=(t+1)/2),new r.Vector2(e,t)},a.prototype.getWorldPoint=function(e,t){var i=this.screenToViewport(e,t);e=i.x,t=i.y;var n,o=this.getCamera();o.isPerspective&&(n=(n=new r.Vector3(e,t,1)).unproject(o));var s,a,l=this.getEyeVector(),h=this.getPosition();if(!o.isPerspective||isNaN(n.x)){var c=this.getWorldSize(l.length()),u=this.getCameraRightVector(!1).multiplyScalar(.5*e*c.x),d=this.getCameraUpVector().multiplyScalar(.5*t*c.y);s=l.clone().add(u).add(d).normalize()}else s=n.sub(h).normalize();var p=this.getPivotPoint(),f=s.dot(l);return a=this.__pivotIsSetFlag&&(this.getIs2D()||o.isPerspective&&f>0)?0!==f?Math.abs(p.sub(h).dot(l))/f:p.sub(h).length():o.isPerspective?.5*(o.near+o.far):o.orthoScale,s.multiplyScalar(a).add(h)},a.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),i=this.getPosition();return e.sub(i).dot(t.normalize())},a.prototype.panRelative=function(e,t,i){if(this.isActionEnabled("pan")){var r=this.getScreenViewport(),n=this.getCamera(),o=this.getWorldSize(i),s=e*o.x*r.width/n.clientWidth,a=t*o.y*r.height/n.clientHeight,l=this.getCameraRightVector(!1).multiplyScalar(s),h=this.getCameraUpVector().multiplyScalar(a),c=l.add(h);this.applyPanningConstraint2D(c),this.setView(this.getPosition().add(c),this.getTarget().add(c))}},a.prototype.dollyFromPoint=function(e,t,i){if(this.isActionEnabled("zoom")&&!(Math.abs(e)<=this.__kEpsilon)){var r=this.getPosition(),n=this.getEyeVector();if(!this.getCamera().isPerspective){var o=n.lengthSq(),s=n.dot(this.getTarget().sub(t));t=n.clone().multiplyScalar(s/o).add(t)}var a=t.clone().sub(r),l=a.length(),h=l+e;h<this.__minDistance&&(h=this.__minDistance);var c=h/l;if(c=this.applyDollyConstraint(c,i),Math.abs(c-1)>this.__kEpsilon){a.multiplyScalar(c),a.set(-a.x,-a.y,-a.z);var u=a.add(t);n=this.getEyeVector(),this.getCamera().isPerspective||n.multiplyScalar(c),this.setView(u,n.add(u))}}},a.prototype.toPerspective=function(){if(this.getIs2D())n.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");else{var e=this.getCamera();e.isPerspective||(e.toPerspective(),e.dirty=!0)}},a.prototype.toOrthographic=function(){var e=this.getCamera();e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},a.snapToAxis=function(e){var t=new r.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e},o.EventDispatcher.prototype.apply(a.prototype),a.Events=s},6223:(e,t,i)=>{"use strict";i.r(t),i.d(t,{OrbitDollyPanTool:()=>s});var r=i(18878),n=i(76542),o=i(64141);function s(e,t,i){this.setGlobalManager(t.globalManager);var n,s,a=this,l=.001,h=.01,c=i&&i.hasOwnProperty("dollyDragScale")?i.dollyDragScale:100,u=-1!=navigator.userAgent.search("Mac OS"),d=i&&i.disablePinchRotation,p=t.navigation,f=p.getCamera(),m=["orbit","freeorbit","dolly","pan"],g=m[0],v=[g],y=g,b=null,x=1,_=0,E=0,A=0,S=0,w=!0,M=!1,T=null,C=!1,P=33,D=34,L=37,I=38,R=39,O=40,N=48,F=187,k=189,V=-4,U=-1,B=-5,G=new THREE.Vector3,z=new THREE.Vector3,H=new THREE.Vector2,W=new THREE.Vector2,j=new THREE.Vector2,q=new THREE.Vector2,X=new THREE.Vector3,Y=new THREE.Vector3,K=new THREE.Vector3,Q=new THREE.Vector3,Z=new THREE.Vector3,J=new THREE.Vector3,$=new THREE.Vector3,ee=new THREE.Vector3,te=new THREE.Vector3,ie=new THREE.Quaternion,re=new THREE.Plane,ne=[!1,!1,!1,!1,!1,!1],oe={SHIFT:0,ALT:0,CONTROL:0,SPACE:0};this.active=!1;var se,ae=function(t){e.renderer().rolloverObjectId(0,null,0)},le=.01,he=i&&i.hasOwnProperty("dollyScrollScale")?i.dollyScrollScale:.6,ce=1,ue=5,de=.025;function pe(e,t){var i=a.getWindow(),r=0,n=0,o=i.innerWidth,s=i.innerHeight;ee.set((e-.5*o-r)/(.5*o),(.5*s+n-t)/(.5*s),0);var l=ee.length();return l>1?ee.normalize():ee.z=Math.sqrt(1-l*l),Q.copy(f.position).sub(f.pivot),J.copy(f.up).setLength(ee.y),J.add($.copy(f.up).cross(Q).setLength(ee.x)),J.add(Q.setLength(ee.z)),J}this.getNames=function(){return m},this.getName=function(){return m[0]},this.activate=function(i){this.active=!0,v.push(i),y=i,w=t.prefs.get(o.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR),t.prefs.addListeners(o.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR,this._onPrefCursor),e.canvas.addEventListener("mouseout",ae),t.addEventListener(r.ESCAPE_EVENT,this.handleBlur)},this.deactivate=function(i){this.active=!1,t.prefs.removeListeners(o.Prefs3D.ENABLE_CUSTOM_ORBIT_TOOL_CURSOR,this._onPrefCursor);var n=v.length-1;n>0&&v[n]===i&&(v.pop(),y=v[n-1]),e.canvas.removeEventListener("mouseout",ae),t.removeEventListener(r.ESCAPE_EVENT,this.handleBlur)},this.isActive=function(){return this.active},this.adjustDollyLookSpeed=function(e){0===e?(de=.025,ue=5):((de*=e>0?1.1:.9)<1e-6&&(de=1e-6),(ue*=e>0?1.1:.9)<1e-6&&(ue=1e-6))},this.getDollySpeed=function(e,t){var i;if(!p.getZoomTowardsPivot()&&!p.getWheelSetsPivot()||f.isPerspective||p.getIs2D()){var r=p.getEyeVector(),n=p.getPosition();o=e.clone().sub(n).dot(r.normalize())*de;i=Math.abs(o)<le?o<0?-.01:le:o}else{var o=f.orthoScale*de;i=Math.abs(o)<5e-4&&t?0:o}return i},this.setPivotPointFromInput=function(t,i){if(!p.getIs2D()&&p.getWheelSetsPivot()){var r=e.hitTest(t,i,!0);if(r&&r.intersectPoint)this.utilities.setPivotPoint(r.intersectPoint,!0,!0);else{const r=p.getPivotPoint(),n=p.getEyeVector().normalize(),o=-r.dot(n);re.set(n,o);const s=e.viewportToRay(e.clientToViewport(t,i));let a=new THREE.Vector3;s.intersectPlane(re,a),this.utilities.setPivotPoint(a,!0,!0)}}},this.getDollyScrollScale=function(){return he},this.setDollyScrollScale=function(e){he=e},this.getDollyDragScale=function(){return c},this.setDollyDragScale=function(e){c=e},this.getLookSpeed=function(){return ue},this.coiIsActive=function(){return p.getPivotSetFlag()&&p.isPointVisible(p.getPivotPoint())},this.adjustSpeed=function(e){this.adjustDollyLookSpeed(e),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return 1===B&&oe.SHIFT?v[1]:(e=oe,2===B&&e.SHIFT&&!e.ALT&&!e.CONTROL||2===B&&e.ALT&&!e.SHIFT&&!e.CONTROL||"dolly"===y&&!e.ALT&&"pinch"!==b||0!==X.z?function(){var e=oe;return!(e.CONTROL||e.ALT||e.SHIFT||2!==B&&1!==B)}()?"pan":"dolly":function(){var e=oe;return 2===B&&!e.SHIFT&&!(e.ALT^e.CONTROL)||2===B&&e.SHIFT&&e.CONTROL||1===B&&!e.SHIFT&&!e.CONTROL||1===B&&e.ALT||1===B&&e.CONTROL&&!e.ALT||0===B&&e.SHIFT&&!e.CONTROL&&!e.ALT||"pan"===y&&1!==B&&!e.ALT&&!("pinch"===b)||e.SPACE}()?"pan":"pan"===b||"pinch"===b?"dollypan":y);var e},this.initTracking=function(e,t){var i;if(f.isPerspective){i=.5*(f.near+f.far);var r=this.utilities.getHitPoint(e,t),n=p.getPosition();if(r&&r.sub){var o=r.sub(n),s=p.getEyeVector().normalize();i=Math.abs(s.dot(o))}else{if(p.getPivotSetFlag()&&p.isPointVisible(p.getPivotPoint())){var a=p.getPivotPlaneDistance();a>.01&&(i=a)}}}else i=p.getEyeVector().length();ce=i},this.initOrbit=function(){this.utilities.setTemporaryPivot(f.isPerspective&&p.getPivotPoint().sub(p.getPosition()).dot(p.getEyeVector())<=0?p.getTarget():null)},this.getActiveMode=function(){return g},this.getCursor=function(){if(!w)return null;switch(g){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(e,t){var i=p&&p.getReverseZoomDirection()?-1.5:1.5;u&&(i*=-1),ne[0]&&(z.x+=h,j.x+=20),ne[1]&&(z.x-=h,j.x-=20),ne[2]&&(z.y+=h,j.y+=20),ne[3]&&(z.y-=h,j.y-=20),ne[4]&&(z.z+=i),ne[5]&&(z.z-=i);var r=z.x-G.x,n=z.y-G.y,o=z.z-G.z;Math.abs(r)<l&&(r=0),Math.abs(n)<l&&(n=0),Math.abs(o)<l&&(o=0),e.set(r,n,o),t&&t.set(j.x-W.x,j.y-W.y)},this.stepMotionDelta=function(e,t){t?(G.x+=.6*e.x,G.y+=.6*e.y,G.z+=.6*e.z):G.copy(z),W.copy(j)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(se=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),se},this.update=function(){var e,i=!1,r=!1;this.getMotionDelta(X,q);var o=X.x,a=X.y,l=X.z;if(M||this.checkInteractionMode(),(M=B>U)&&this.controller.setIsLocked(!0),0!==o||0!==a||0!==l){switch(g){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(q.x=-q.x,T&&this.utilities.autocam.orbit(j,T,q.multiplyScalar(2),this.utilities.autocam.startState));break;case"freeorbit":!function(){if(p.isActionEnabled("orbit")){Q.subVectors(f.position,f.pivot),Z.subVectors(f.position,f.target);var e=Z.length();Z.normalize();var t=Math.acos(Y.dot(K)/Y.length()/K.length());t&&(t*=2,te.crossVectors(Y,K).normalize(),ie.setFromAxisAngle(te,-t),Q.applyQuaternion(ie),f.up.applyQuaternion(ie),K.applyQuaternion(ie),Z.applyQuaternion(ie),Y.copy(K)),f.position.addVectors(f.pivot,Q),f.target.subVectors(f.position,Z.multiplyScalar(e)),f.dirty=!0}}();break;case"dolly":var h,u=new THREE.Vector2;l*=he,B>=0?(a=-a,l=Math.abs(o)>Math.abs(a)?o:a,p.getReverseZoomDirection()&&(l*=-1),l*=c,o=0,a=0,u=p.viewportToScreen(0,0)):(e=p.getScreenViewport(),n&&s?(u.x=n/e.width,u.y=s/e.height):u=p.viewportToScreen(0,0)),!p.getIs2D()&&p.getZoomTowardsPivot()?this.coiIsActive()?h=p.getPivotPoint():(u=p.viewportToScreen(0,0),h=p.getWorldPoint(u.x,u.y)):h=p.getWorldPoint(u.x,u.y),p.dollyFromPoint(l*this.getDollySpeed(h,l<0),h,this.getFitBounds());break;case"pan":p.panRelative(-o,a,ce);break;case"dollypan":0===o&&0===a||p.panRelative(-o,a,ce),e=p.getScreenViewport(),h=p.getWorldPoint(n/e.width,s/e.height);var v=p.getPosition(),y=p.getIs2D()?v.sub(h).length():ce,S=(_/E-1)*y;p.dollyFromPoint(S,h,this.getFitBounds());var w=new THREE.Vector3,P=new THREE.Quaternion,D=p.getCameraUpVector(),L=w.copy(f.position).sub(f.target).normalize();P.setFromAxisAngle(L,1.2*A),D.applyQuaternion(P),p.getIs2D()||d&&("pinch"===b||"pan"===b)||p.setCameraUpVector(D),_=E,x,ce=y+S}r=!0}return this.stepMotionDelta(X,"pan"!==g&&"dollypan"!==g),B===U&&Math.abs(l)<.01&&(this.interactionEnd(U),z.z=0,G.z=0,i=!0,r=!0),(oe.SHIFT||oe.ALT)&&-1!==m.indexOf(t.getActiveNavigationTool())&&(r=!0),!C&&(i||B>-5)&&(B>U&&(G.copy(z),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),B=-5,M&&this.controller.setIsLocked(!1),M=!1,T=null,b=null),r?this.utilities.pivotActive(p.getPivotSetFlag(),B<=U):this.utilities.pivotUpdate(),f.dirty},this.checkInteractionMode=function(){var e=this.getTriggeredMode();e!==g&&("pan"===(g=e)&&B>U||"dollypan"===g)&&this.initTracking(G.x,G.y)},this.interactionStart=function(e,t){(t||e>B)&&(B=e,C=!0,e>U&&("pan"===g&&this.initTracking(G.x,G.y),"orbit"===g&&this.initOrbit()),!p.getSelectionSetsPivot()&&this.utilities.pivotActive(p.getPivotSetFlag(),e===U),this.utilities.autocam&&(this.utilities.autocam.sync(f),this.utilities.autocam.startInteraction(W.x,W.y),T=W.clone()))},this.interactionCheck=function(){(ne[0]||ne[1]||ne[2]||ne[3]||ne[4]||ne[5]||oe.SHIFT||oe.CONTROL||oe.ALT||oe.SPACE)&&this.interactionStart(V,!0)},this.interactionEnd=function(e){e===B&&(e!==U&&this.utilities.pivotActive(!1),C=!1)},this.isInteractionActive=function(){return C},this.handleWheelInput=function(t,i){if(n=i.canvasX,s=i.canvasY,this.isDragging)return!1;if(p.getIs2D()){var r=p.getScreenViewport(),o=e.intersectGround(n+r.width,s+r.height);this.utilities.setPivotPoint(o,!0,!0)}else this.setPivotPointFromInput(n,s);return p.getReverseZoomDirection()&&(t*=-1),z.z+=t,0!=t&&this.interactionStart(U),!0},this.resetKeys=function(){this.autoMove(-1,!1),oe.SHIFT=0,oe.CONTROL=0,oe.ALT=0,oe.SPACE=0},this.autoMove=function(e,t){t&&this.isDragging||(e<0?ne[0]=ne[1]=ne[2]=ne[3]=ne[4]=ne[5]=t:ne[e]=t,t||this.interactionEnd(V),this.interactionCheck())},this.updateModifierState=function(e){oe.CONTROL=u&&e.metaKey||e.ctrlKey?1:0,oe.SHIFT=e.shiftKey?1:0,oe.ALT=e.altKey?1:0},this.handleKeyDown=function(e,t){this.updateModifierState(e);var i=!1;if(u&&oe.CONTROL)return this.autoMove(-1,!1),this.interactionEnd(V),!1;switch(t){case F:this.adjustSpeed(1),i=!0;break;case k:this.adjustSpeed(-1),i=!0;break;case N:this.adjustSpeed(0),i=!0;break;case L:this.autoMove(0,!0),i=!0;break;case R:this.autoMove(1,!0),i=!0;break;case P:this.autoMove(2,!0),i=!0;break;case D:this.autoMove(3,!0),i=!0;break;case I:this.autoMove(4,!0),i=!0;break;case O:this.autoMove(5,!0),i=!0;break;default:return!1}return this.isDragging||this.interactionStart(V),i},this.handleKeyUp=function(e,t){this.updateModifierState(e);var i=!1;if(u&&oe.CONTROL)return this.autoMove(-1,!1),this.interactionEnd(V),!1;switch(t){case L:this.autoMove(0,!1),i=!0;break;case R:this.autoMove(1,!1),i=!0;break;case P:this.autoMove(2,!1),i=!0;break;case D:this.autoMove(3,!1),i=!0;break;case I:this.autoMove(4,!1),i=!0;break;case O:this.autoMove(5,!1),i=!0;break;default:return!1}return i&&(this.interactionEnd(V),C||this.interactionCheck()),i},this.handleDollyPan=function(e){n=e.canvasX,s=e.canvasY;var t=p.getScreenViewport();j.x=n,j.y=s,z.x=j.x/t.width,z.y=j.y/t.height,E=function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY;return Math.sqrt(t*t+i*i)}(e);var i,r,o=THREE.Math.degToRad(e.rotation);A=o-S,Math.abs(A)>1&&(A=0),S=o,i=e.type,r="start",-1!==i.indexOf(r,i.length-r.length)&&(_=E,1,A=0,S=o),x=e.scale},this.handleGesture=function(e){switch(e.type){case"dragstart":return b="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"!==b&&(this.handleButtonDown(e,0),b="drag"),this.handleMouseMove(e);case"dragend":return"drag"===b&&(this.handleButtonUp(e,0),b=null,!0);case"panstart":return b="pan",this.handlePanStart(e),this.handleDollyPan(e),!0;case"panmove":return"pan"!==b&&(b="pan",this.handlePanStart(e)),this.handleDollyPan(e);case"panend":return"pan"===b&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0);case"pinchstart":return this.setPivotPointFromInput(e.center.x,e.center.y),this.isDragging=!0,b="pinch",G.x=.5*(e.normalizedX+1),G.y=1-.5*(e.normalizedY+1),H.set(e.canvasX,e.canvasY),W.set(e.canvasX,e.canvasY),M=!1,this.interactionStart(3),this.handleDollyPan(e),!0;case"pinchmove":return"pinch"===b&&this.handleDollyPan(e);case"pinchend":return"pinch"===b&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),G.x=.5*(e.normalizedX+1),G.y=1-.5*(e.normalizedY+1),W.set(e.canvasX,e.canvasY),z.copy(G),j.copy(W),Y.copy(pe(e.canvasX,e.canvasY)),K.copy(Y),n=e.canvasX,s=e.canvasY,this.isDragging=!0,this.interactionStart(t),!0},this.handlePanStart=function(e){return this.isDragging=!0,G.x=.5*(e.normalizedX+1),G.y=1-.5*(e.normalizedY+1),H.set(e.canvasX,e.canvasY),W.set(e.canvasX,e.canvasY),this.interactionStart(3),!0},this.handleButtonUp=function(e,t){return this.updateModifierState(e),z.x=.5*(e.normalizedX+1),z.y=1-.5*(e.normalizedY+1),j.set(e.canvasX,e.canvasY),K.copy(pe(e.canvasX,e.canvasY)),Y.copy(K),n=e.canvasX,s=e.canvasY,this.interactionEnd(t),this.isDragging=!1,!0},this.handleMouseMove=function(t){return this.updateModifierState(t),this.isDragging?(z.x=.5*(t.normalizedX+1),z.y=1-.5*(t.normalizedY+1),j.set(t.canvasX,t.canvasY),K.copy(pe(t.canvasX,t.canvasY)),n=t.canvasX,s=t.canvasY,!0):(G.x=.5*(t.normalizedX+1),G.y=1-.5*(t.normalizedY+1),W.set(t.canvasX,t.canvasY),z.x=G.x,z.y=G.y,j.copy(W),n=t.canvasX,s=t.canvasY,t.target===e.canvas&&e.rolloverObject(n,s),!1)},this.handleBlur=e=>{this.resetKeys(),this.interactionEnd(B)},this._onPrefCursor=function(e){w=e}.bind(this)}n.GlobalManagerMixin.call(s.prototype)},86142:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SelectionType:()=>r});var r={MIXED:1,REGULAR:2,OVERLAYED:3}},25161:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MultiModelSelector:()=>c,Selector:()=>h});var r=i(36263),n=i(86142),o=i(22599),s=i(60489),a=i(18878),l=i(75050);function h(e,t){var i=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=r.SelectionMode.LEAF_OBJECT,this.lockedNodes=[];var a={};function h(){return t.getData().instanceTree}function c(i){var r=h();if(a[i]>0)a[i]--,0==a[i]&&e.highlightObjectNode(t,i,!1);else if(a[i]<0)throw"Selection State machine broken. Negatively selected object!";r&&r.enumNodeChildren(i,(function(e){c(e)}),!1)}function u(i,r,o){var s=h();if(a[i])a[i]++;else{switch(o){default:case n.SelectionType.MIXED:e.highlightObjectNode(t,i,!0,r);break;case n.SelectionType.REGULAR:e.highlightObjectNode(t,i,!0,!0);break;case n.SelectionType.OVERLAYED:e.highlightObjectNode(t,i,!0,!1)}a[i]=1}s&&s.enumNodeChildren(i,(function(e){u(e,!0,o)}),!1)}function d(e){if(void 0!==e&&i.selectedObjectIds[e])return!0}function p(r,o){if(!i.isNodeSelectionLocked(r)){var s=h();if(o=o||n.SelectionType.MIXED,s){const n=function(){var r;const n="ifc"===(null===(r=t.getData())||void 0===r||null===(r=r.loadOptions)||void 0===r?void 0:r.fileExt),o=void 0!==e.api.prefs.getPrefFromLocalStorage(Autodesk.Viewing.Private.Prefs3D.SELECTION_MODE);return n&&!o?Autodesk.Viewing.SelectionMode.FIRST_OBJECT:i.selectionMode}();if(r=s.findNodeForSelection(r,n),!s.isNodeSelectable(r))return}d(r)||(i.selectedObjectIds[r]=o,i.selectionCount++,u(r,!1,o))}}function f(e){d(e)&&(c(e),i.selectedObjectIds[e]=0,i.selectionCount--)}this.getInstanceTree=h,this.hasSelection=function(){return i.selectionCount>0},this.getSelectionLength=function(){return i.selectionCount},this.getSelection=function(){var e=[],t=i.selectedObjectIds;for(var r in t)if(t[r]){var n=parseInt(r);e.push(n)}return e},this.isSelected=function(e){return d(e)},this.clearNodeSelection=function(e){return void 0!==e&&0!==this.selectionCount&&(c(e),delete i.selectedObjectIds[e],!0)},this.clearSelection=function(e){if(this.selectionCount>0){var t=i.selectedObjectIds;for(var r in t){var n=parseInt(r);void 0!==n&&c(n)}return i.selectedObjectIds={},i.selectionCount=0,!0}},this.deselectInvisible=function(){var r=!1,n=i.selectedObjectIds,o=e.visibilityManager;for(var s in n){var a=parseInt(s);a&&!o.isNodeVisible(t,a)&&(f(a),r=!0)}return r},this.toggleSelection=function(e,i){e||t.isLeaflet()?d(e)?f(e):p(e,i):s.logger.error("Attempting to select node 0.",(0,o.errorCodeString)(o.ErrorCodes.VIEWER_INTERNAL_ERROR))},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.isNodeSelectionLocked=function(e){if(-1===e)return!1;var t=h();return t?t.isNodeSelectionLocked(e):-1!==i.lockedNodes.indexOf(e)},this.lockSelection=function(e,t){var r=h();function n(e,t){if(e&&-1!==e)if(t)-1===i.lockedNodes.indexOf(e)&&(i.lockedNodes.push(e),i.clearNodeSelection(e));else{const t=i.lockedNodes.indexOf(e);i.lockedNodes.splice(t,1)}}e=Array.isArray(e)?e:[e],r?e.forEach((function(e){r.enumNodeChildren(e,(function(e){r.lockNodeSelection(e,!1),n(e,t),t&&r.lockNodeSelection(e,t)}),!0)})):e.forEach((e=>{n(e,t)}))},this.setSelection=function(e,t){if(!function(e){if(i.selectionCount!==e.length)return!1;for(var t=0;t<e.length;t++)if(!d(e[t]))return!1;return!0}(e)&&(this.clearSelection(!0),null!=e&&0!==e.length))for(var r=0;r<e.length;r++)p(e[r],t)},this.getSelectionBounds=function(){var e=new l.Box3,r=new l.Box3,n=h();if(n){var o=t.getFragmentList(),s=i.selectedObjectIds;for(var a in s){var c=parseInt(a);n.enumNodeFragments(c,(function(t){o.getWorldBounds(t,r),e.union(r)}),!0)}}return e},this.getSelectionVisibility=function(){var e=!1,r=!1,n=i.selectedObjectIds;for(var o in n){var s=parseInt(o);if(s){var a=h();if(a&&a.isNodeHidden(s)?r=!0:e=!0,e&&r)break}}return{hasVisible:e,hasHidden:r,model:t}},this.update2DSelectionHighlighting=function(){if(i._2DSelectionHighlightingUpdated)return;if(!t.isLoadDone())return;var r=t.getPropertyDb();if(r&&!r.isLoadDone())return;if(!e.overlayScenes[e.selection2dOverlayName(t)])return;for(var n=i.getSelection(),o=0;o<n.length;o++){c(a=n[o])}const s={};Object.keys(i.selectedObjectIds).forEach((e=>{s[t.remapDbId(e)]=i.selectedObjectIds[e]})),i.selectedObjectIds=s;for(o=0;o<n.length;o++){var a;u(a=n[o],!1,i.selectedObjectIds[a])}i._2DSelectionHighlightingUpdated=!0},this.dtor=function(){this.selectedObjectIds=null}}function c(e){var t=[];function i(){t.length>1&&s.logger.warn("This selection call does not yet support multiple models.")}function r(i){for(var r,n=[],o=0;o<t.length;o++){var s=[],l=[],h=t[o].selector.selectedObjectIds,c=t[o].selector.getInstanceTree();for(var u in h)if(h[u]){var d=parseInt(u);d&&(s.push(d),c&&c.enumNodeFragments(d,(function(e){l.push(e)}),!1))}s.length&&n.push({fragIdsArray:l,dbIdArray:s,nodeArray:s,model:t[o]})}1===t.length&&(r={type:a.SELECTION_CHANGED_EVENT,fragIdsArray:n[0]?n[0].fragIdsArray:[],dbIdArray:n[0]?n[0].dbIdArray:[],nodeArray:n[0]?n[0].dbIdArray:[],model:t[0],mouseButton:i},e.api.dispatchEvent(r)),r={type:a.AGGREGATE_SELECTION_CHANGED_EVENT,selections:n,mouseButton:i},e.api.dispatchEvent(r)}function n(){for(var e=!1,i=0;i<t.length;i++)e=t[i].selector.deselectInvisible()||e;e&&r()}function o(e){e.model.is2d()&&e.model.selector&&e.model.selector.update2DSelectionHighlighting()}this.highlightDisabled=!1,this.highlightPaused=!1,this.selectionDisabled=!1,this.addModel=function(i){-1==t.indexOf(i)&&(i.selector=new h(e,i),t.push(i))},this.removeModel=function(e){var i=t.indexOf(e);e.selector.getSelection();e.selector.clearSelection(),e.selector=null,t.splice(i,1)},this.hasSelection=function(){for(var e=0;e<t.length;e++)if(t[e].selector.hasSelection())return!0;return!1},this.getSelectionLength=function(){for(var e=0,i=0;i<t.length;i++)e+=t[i].selector.getSelectionLength();return e},this.getSelection=function(){return i(),t.length>1&&s.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),t[0]?t[0].selector.getSelection():[]},this.getAggregateSelection=function(){for(var e=[],i=0;i<t.length;i++){var r=t[i].selector.getSelection();r&&r.length&&e.push({model:t[i],selection:r})}return e},this.clearSelection=function(e){let i;for(var n=0;n<t.length;n++)t[n].selector.clearSelection(e)&&(i=!0);!e&&i&&r()},this.toggleSelection=function(e,n,o){this.selectionDisabled||(n||(i(),n=t[0]),n.selector.toggleSelection(e,o),r())},this.setSelectionMode=function(e){for(var i=0;i<t.length;i++)t[i].selector.setSelectionMode(e)},this.isNodeSelectionLocked=function(e,r){return r||(i(),r=t[0]),r&&r.selector.isNodeSelectionLocked(e)},this.lockSelection=function(e,r,n){n||(i(),n=t[0]),n&&n.selector.lockSelection(e,r)},this.unlockSelection=function(e,r){e||r?(r||(i(),r=t[0]),e=e||r.selector.lockedNodes.slice(),this.lockSelection(e,!1,r)):t.forEach((e=>{const t=e.selector.lockedNodes.slice();this.lockSelection(t,!1,e)}))},this.setSelection=function(e,n,o,s){if(!this.selectionDisabled){if(e&&0!==e.length){if(n)for(var a=0;a<t.length;a++)t[a]!==n&&t[a].selector.clearSelection();else i(),n=t[0];n.selector.setSelection(e,o)}else this.clearSelection(!0);r(s)}},this.setAggregateSelection=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.selectionDisabled){if(e&&0!==e.length)for(var i=0;i<e.length;++i){var n=e[i].model,o=e[i].ids,s=e[i].selectionType;n.selector.setSelection(o,s)}else this.clearSelection(!0);t&&r()}},this.getSelectionBounds=function(){if(1==t.length)return t[0].selector.getSelectionBounds();for(var e=new l.Box3,i=0;i<t.length;i++){var r=t[i].selector.getSelectionBounds();e.union(r)}return e},this.getSelectionVisibility=function(){for(var e={hasVisible:!1,hasHidden:!1,details:[]},i=0;i<t.length;i++){var r=t[i].selector.getSelectionVisibility();e.hasVisible=e.hasVisible||r.hasVisible,e.hasHidden=e.hasHidden||r.hasHidden,e.details.push(r)}return e},this.dtor=function(){for(var e=0;e<t.length;e++)t[e].selector.dtor()},e.api.addEventListener(a.ISOLATE_EVENT,(function(e){n()})),e.api.addEventListener(a.HIDE_EVENT,(function(e){n()})),e.api.addEventListener(a.GEOMETRY_LOADED_EVENT,o),e.api.addEventListener(a.OBJECT_TREE_CREATED_EVENT,o),e.api.addEventListener(a.OBJECT_TREE_UNAVAILABLE_EVENT,o)}},78464:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ToolController:()=>a});var r=i(60489),n=i(18878),o=i(70095),s=i(76542);function a(e,t,i,s,l){this.setGlobalManager(t.globalManager),this.domElement=t.canvasWrap,this.selector=e.selector,this.autocam=i,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0,this.keyMapCmd=!0,this.propagateInputEventTypes=[];var h=-1!==navigator.userAgent.search("Mac OS"),c=-1!==navigator.userAgent.search("Firefox"),u=-1!==navigator.userAgent.search("Chrome"),d=-1!==navigator.userAgent.search("Safari")&&!u,p={},f={},m={},g=[],v=!1,y=-1,b=-1,x=!1,_=null,E=!1,A={},S=this;function w(e){return e.getPriority instanceof Function&&e.getPriority()||0}function M(e,i){return t.navigation.getUseLeftHandedInput()&&0===e||c&&1===e||h&&!d&&0===e&&i.ctrlKey}this.__registerToolByName=function(e,t){p[t]=e},this.registerTool=function(e,t){var i=e.getNames();if(!i||0===i.length)return r.logger.warn("Cannot register tool with no name."),!1;for(var n=!1,o=0;o<i.length;++o)if("default"!==i[o]){this.__registerToolByName(e,i[o]);const r=t=>{const i=e.getName();t?this.activateTool(i):this.deactivateTool(i)};m[i[o]]=t&&t instanceof Function?t:r,n=!0}return e.utilities=s,e.controller=this,e.register&&e.register(),n},this.deregisterTool=function(e){this.deactivateTool(e.getName());var t=e.getNames();if(!t||0===t.length)return!1;for(var i=t.length;--i>=0;)this.__deregisterToolName(t[i]);return e.deregister&&e.deregister(),e.utilities=null,e.controller=null,!0},this.__deregisterToolName=function(e){e in p&&(!function(e){for(var t=g.length;--t>=0;)g[t].activeName===e&&(p[e].deactivate(e),g.splice(t,1))}(e),delete p[e])},this.getTool=function(e){return p[e]},this.getActiveToolName=function(){var e=g.length;return e>0?g[e-1].activeName:"default"},this.getActiveTool=function(){var e=g.length;return e>0?g[e-1]:p.default},this.getActiveTools=function(){return g.slice()},this.isToolActivated=function(e){for(var t=0;t<g.length;t++)if(g[t].activeName===e)return!0;return!1},this.setToolActiveName=function(e){var t=p[e];t&&(t.activeName=e)},this.rearrangeByPriorities=function(){g.sort((function(e,t){return w(e)-w(t)}))},this.activateToolModality=function(e){const t=this.getToolModality(e);for(let e in t){const i=t[e],r=m[e];i!==this.isToolActivated(e)&&r&&r(i,e)}},this.activateTool=function(e){if(v)return!1;var i=p[e];if(this.activateToolModality(e),i){void 0===i.count&&(i.count=0);var o=null;g.length&&"intercept"===g[g.length-1].activeName&&(o=g.pop());for(var s=0,a=0;a<g.length;a++)g[a]===i&&i.count++,w(g[a])<=w(i)&&(s=a+1);return i.activeName=e,0===i.count&&(i.count++,g.splice(s,0,i)),i.activate(e,t),o&&g.push(o),t.dispatchEvent({type:n.TOOL_CHANGE_EVENT,toolName:e,tool:i,active:!0}),!0}return r.logger.warn("activateTool not found: "+e),!1},this.deactivateTool=function(e){if(v)return!1;for(var i=g.length;--i>=0;)if(g[i].activeName===e){const r=p[e];return(!r.count||r.count<=1)&&(1!=r.count&&console.warn("Deactivating tool without activation: "+e),g.splice(i,1)),r.count--,r.deactivate(e),t.dispatchEvent({type:n.TOOL_CHANGE_EVENT,toolName:e,tool:r,active:!1}),!0}return r.logger.warn("deactivateTool not found: "+e),!1},this.getToolNames=function(){return Object.keys(p)},this.setDefaultTool=function(e){var t=this.getDefaultTool();return!(!e||e===t)&&(this.__registerToolByName(e,"default"),t&&t.deactivate("default"),e.activate("default"),!0)},this.getDefaultTool=function(){return p.default},this.setDefaultTool(l),this.setIsLocked=function(e){var t=v;return v=!!e,t},this.getIsLocked=function(){return v},this.__checkCursor=function(){for(var e=null,i=g.length;--i>=0;){var r=g[i];if(r.getCursor&&(e=r.getCursor()))break}e||(e="auto"),_!=e&&(t.canvas.style.cursor=e,_=e)},this.update=function(e){this.__checkCursor();var i=!1;s&&s.update()&&(i=!0);for(var r=g.length;--r>=0;){var n=g[r];n.update&&n.update(e)&&(i=!0)}if(t.navigation.getCamera().dirty?(t.navigation.updateCamera(),i=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,i)t.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){this.moveDelay-Date.now()>0?i=!0:this.moveDelay=0}return i},this.__clientToCanvasCoords=function(t,i,r){var n=e.getCanvasBoundingClientRect(),o=n.width,s=n.height,a=t.clientX-n.left,l=t.clientY-n.top;t.canvasX=a,t.canvasY=l,t.normalizedX=a/o*2-1,t.normalizedY=(s-l)/s*2-1,i&&i.set(a/o,l/s,0),r&&r.set(a,l)},this.__invokeStack=function(e,t,i){for(var r=g.length;--r>=0;){var n=g[r];if(n&&n[e]&&n[e](t,i))return!0}var o=this.getDefaultTool();return!(!o[e]||!o[e](t,i))},this.distributeEvent=function(e,t,i){return this.__invokeStack(e,t,i)},this.handleResize=function(){t.navigation.setScreenViewport(t.container.getBoundingClientRect());for(var e=g.length;--e>=0;){var i=g[e];i.handleResize&&i.handleResize()}},this.handleSingleClick=function(e){var t=this.applyButtonMappings(e);this.lastClickX=e.clientX,this.lastClickY=e.clientY,this.__invokeStack("handleSingleClick",e,t)&&this.__onEventHandled(e)},this.handleDoubleClick=function(e){var t=this.applyButtonMappings(e);this.__invokeStack("handleDoubleClick",e,t)&&this.__onEventHandled(e)},this.handleSingleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleSingleTap",e)&&this.__onEventHandled(e)},this.handleDoubleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleDoubleTap",e)&&this.__onEventHandled(e)},this.handleWheelInput=function(e,t){this.__invokeStack("handleWheelInput",e,t)&&this.__onEventHandled(t)},this.applyButtonMappings=function(e){var i=e.button;return"buttons"in e&&(e.firefoxSpoof?i=0:!x||1&e.buttons?2===i&&1&e.buttons&&(i=0,e.firefoxSpoof=x=!0):(e.firefoxSpoof=!0,x=!1,i=0)),t.navigation.getUseLeftHandedInput()&&(i=0===i?2:2===i?0:i),i},this.applyKeyMappings=function(e){switch(e.keyCode){case o.KeyCode.EQUALSMOZ:return o.KeyCode.EQUALS;case o.KeyCode.DASHMOZNEW:case o.KeyCode.DASHMOZ:return o.KeyCode.DASH}return e.keyCode},this.handleKeyDown=function(e){let t;!this.keyMapCmd||!h||"MetaLeft"!=e.code&&"MetaRight"!=e.code?(t=this.applyKeyMappings(e),t&&this.__invokeStack("handleKeyDown",e,t)&&this.__onEventHandled(e)):this.handleCmdKeyEvent(e,"keydown")},this.handleKeyUp=function(e){let t;!this.keyMapCmd||!h||"MetaLeft"!=e.code&&"MetaRight"!=e.code?(t=this.applyKeyMappings(e),t&&this.__invokeStack("handleKeyUp",e,t)&&this.__onEventHandled(e)):this.handleCmdKeyEvent(e,"keyup")},this.handleCmdKeyEvent=function(e,t){this.__onEventHandled(e);var i=new KeyboardEvent(t,{key:"Control",code:"MetaLeft"==e.code?"ControlLeft":"ControlRight",location:e.location,ctrlKey:!0,metaKey:!1,repeat:e.repeat,isComposing:e.isComposing,charCode:0,keyCode:17,which:17});window.dispatchEvent(i)},this.handleButtonDown=function(e,t){this.__invokeStack("handleButtonDown",e,t)&&this.__onEventHandled(e)},this.handleButtonUp=function(e,t){this.__invokeStack("handleButtonUp",e,t)&&this.__onEventHandled(e)},this.handleMouseMove=function(e){this.__invokeStack("handleMouseMove",e)&&this.__onEventHandled(e)},this.handleBlur=function(e){this.__invokeStack("handleBlur",e)&&this.__onEventHandled(e)},this.keydown=function(e){if(!a._lastTouchedElement||S.domElement.contains(a._lastTouchedElement)){var t=S.getDocument();if(!(t.activeElement instanceof HTMLInputElement||t.activeElement instanceof HTMLTextAreaElement||t.activeElement instanceof HTMLSelectElement)){if(t.activeElement){var i=t.activeElement.getAttribute("contenteditable");if("true"===i||""===i)return}S.handleKeyDown(e)}}},this.keyup=function(e){S.handleKeyUp(e)},this.mousedown=function(e){var t=S.getDocument();t.activeElement&&t.activeElement.blur&&t.activeElement.blur(),S.__clientToCanvasCoords(e);var i=S.applyButtonMappings(e);if(S.handleButtonDown(e,i),y=e.canvasX,b=e.canvasY,M(i,e)){var r=A,n=void 0!==r.time&&e.timeStamp-r.time<500,o=void 0!==r.x&&void 0!==r.y&&Math.abs(r.x-e.canvasX)<=2&&Math.abs(r.y-e.canvasY)<=2;(!n||!o||r.clickCount&&2<=r.clickCount)&&(r.clickCount=0),r.clickCount?1===r.clickCount&&(r.clickCount=2):(r.clickCount=1,r.x=e.canvasX,r.y=e.canvasY,r.time=e.timeStamp)}S.addDocumentEventListener("mouseup",(function e(t){S.applyButtonMappings(t)===i&&(S.removeDocumentEventListener("mouseup",e),S.mouseup(t))}),!1),S.registerWindowMouseMove()},this.mousemove=function(e){S.__clientToCanvasCoords(e);var t=y-e.canvasX,i=b-e.canvasY;(Math.abs(t)>2||Math.abs(i)>2)&&(y=-1,b=-1),S.handleMouseMove(e)},this.mouseup=function(e){S.__clientToCanvasCoords(e);var t=S.applyButtonMappings(e);S.handleButtonUp(e,t);var i=y-e.canvasX,r=b-e.canvasY;if(y=-1,b=-1,Math.abs(i)<=2&&Math.abs(r)<=2&&S.handleSingleClick(e),M(t,e)){var n=A;2===n.clickCount&&(S.handleDoubleClick(e),n.clickCount=0,n.x=void 0,n.y=void 0,n.time=void 0)}S.unregisterWindowMouseMove()},this.doubleclick=function(e){S.__clientToCanvasCoords(e),y=e.canvasX,b=e.canvasY,S.handleDoubleClick(e)},this.mousewheel=function(e){if(S.scrollInputEnabled){S.__clientToCanvasCoords(e);var t=0;if(e.wheelDelta)t=e.wheelDelta/40;else if(e.detail)t=-e.detail;else if(e.deltaY){var i=c?1:40;t=-e.deltaY/i}S.handleWheelInput(t,e)}},this.blur=function(e){S.handleBlur(e)},this.mouseover=function(e){a._lastTouchedElement=e.target},this.registerWindowMouseMove=function(){S.addWindowEventListener("mousemove",S.mousemove),S.addWindowEventListener("mouseover",S.mouseover),S.domElement.removeEventListener("mousemove",S.mousemove),S.domElement.removeEventListener("mouseover",S.mouseover)},this.unregisterWindowMouseMove=function(){S.removeWindowEventListener("mousemove",S.mousemove),S.removeWindowEventListener("mouseover",S.mouseover),S.domElement.addEventListener("mousemove",S.mousemove),S.domElement.addEventListener("mouseover",S.mouseover)},this.enableMouseButtons=function(e){e&&!E?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!e&&E&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var t=E;return E=e,t},this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),S.addWindowEventListener("keydown",this.keydown,!1),S.addWindowEventListener("keyup",this.keyup,!1),S.addWindowEventListener("blur",this.blur,!1),this.uninitialize=function(){for(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),this.removeWindowEventListener("mousemove",this.mousemove),this.removeWindowEventListener("mouseover",this.mouseover),this.removeWindowEventListener("keydown",this.keydown),this.removeWindowEventListener("keyup",this.keyup),this.removeWindowEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null,v=!1;g.length>0;)this.deactivateTool(g[g.length-1].activeName);p=null,g=null,S=null,s=null,t=null,e=null,a._lastTouchedElement=null},this.set2DMode=function(){},this.setAutocam=function(){},this.syncCamera=function(){},this.recordHomeView=function(){var e=t.navigation.getCamera();i.sync(e),i.setHomeViewFrom(e)},this.setMouseWheelInputEnabled=function(e){this.scrollInputEnabled=e},this.setModalityMap=function(e){f={};for(let t in e)this.setToolModality(t,e[t])},this.getModalityMap=function(){return Object.assign({},f)},this.getToolModality=function(e){return f[e]},this.setToolModality=function(e,t){e?t?f[e]=t:r.logger.warn("Cannot add tool modality. Missing tool map."):r.logger.warn("Cannot add tool modality. Missing tool name.")},this.__onEventHandled=function(e){this.propagateInputEventTypes.includes(e.type)||(e.preventDefault(),e.stopPropagation())}}Object.defineProperty(a,"_lastTouchedElement",{value:null,writable:!0}),s.GlobalManagerMixin.call(a.prototype)},31313:(e,t,i)=>{"use strict";function r(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.getPriority=function(){return 0},this.register=function(){},this.deregister=function(){},this.activate=function(e,t){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}i.r(t),i.d(t,{ToolInterface:()=>r})},52713:(e,t,i)=>{"use strict";i.r(t),i.d(t,{UnifiedCamera:()=>o});var r=i(75050),n=i(60489);class o extends r.Camera{constructor(e,t){super(),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.clientWidth=e,this.clientHeight=t,this.target=new r.Vector3(0,0,-1),this.worldup=new r.Vector3(0,1,0),this.viewInverseEnv=new r.Matrix4,this.projScreenMatrix=new r.Matrix4,this.orthographicCamera=new r.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new r.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.globalOffset=new r.Vector3,this.toPerspective()}get isOrthographicCamera(){return!this.isPerspective}clone(e){return e=e||new o(2*this.right,2*this.top),r.Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.clientWidth=this.clientWidth,e.clientHeight=this.clientHeight,e.isPerspective=this.isPerspective,e.globalOffset=this.globalOffset.clone(),e.orthoScale=this.orthoScale,e.updateProjectionMatrix(),e}__computeFovPosition(e){if(Math.abs(this.fov-e)<=1e-4)return this.position.clone();var t,i,n=this.target.clone().sub(this.position),o=n.clone().normalize(),s=r.Math.degToRad(this.fov),a=r.Math.degToRad(e),l=Math.tan(.5*s)/Math.tan(.5*a);this.pivot?(t=(new r.Plane).setFromNormalAndCoplanarPoint(o.clone().negate(),this.pivot).distanceToPoint(this.position),i=o.clone().multiplyScalar(t).add(this.position)):(t=n.length(),i=this.target);t*=l;var h=o.multiplyScalar(-t);return i.clone().add(h)}toPerspective(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0}toOrthographic(){if(this.isPerspective){this.saveFov=this.fov;var e=o.ORTHO_FOV;this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length();var t=.5*this.orthoScale,i=t*this.aspect;this.left=this.orthographicCamera.left=-i,this.right=this.orthographicCamera.right=i,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1}updateProjectionMatrix(){this.isPerspective?this.toPerspective():this.toOrthographic()}setSize(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2}setFov(e){this.fov=e,this.updateProjectionMatrix()}setLens(e,t){void 0===t&&(t=24);var i=2*r.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i}setViewFromBox(e,t){o.getViewParamsFromBox(e,t,this.aspect,this.up,this.fov,this),this.updateCameraMatrices()}updateCameraMatrices(){this.lookAt(this.target),this.updateProjectionMatrix(),this.updateMatrixWorld()}setView(e){if(e.position&&this.position.copy(e.position),e.target&&this.target.copy(e.target),e.up&&this.up.copy(e.up),void 0!==e.isPerspective&&(this.isPerspective=e.isPerspective),void 0!==e.orthoScale){this.orthoScale=e.orthoScale;const t=this.target.clone().sub(this.position);this.isPerspective||t.length()===this.orthoScale||(t.normalize().multiplyScalar(this.orthoScale),this.target.copy(t.add(this.position)))}this.updateCameraMatrices()}pixelsPerUnitAtDistance(e){if(!this.isPerspective)return this.clientHeight/this.orthoScale;const t=2*e*Math.tan(r.Math.degToRad(.5*this.fov));return this.clientHeight/t}UnifpixelsPerUnitAtPoint(e){const t=this.position.distanceTo(e);return this.pixelsPerUnitAtDistance(t)}setGlobalOffset(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i;(e!==this.position&&e!==this.target&&e!==this.pivot||(e=e.clone()),t)&&(this.position.add(this.globalOffset).sub(e),this.target.add(this.globalOffset).sub(e),null===(i=this.pivot)||void 0===i||i.add(this.globalOffset).sub(e));this.globalOffset.copy(e)}getGlobalPosition(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new r.Vector3).copy(this.position).add(this.globalOffset)}viewportToRay(e,t){e.z=-1;var i=new r.Vector3(e.x,e.y,1);return e=e.unproject(this),(i=i.unproject(this)).sub(e).normalize(),t||(t=new r.Ray),t.set(this.isPerspective?this.position:e,i),t}transformCurrentView(e){o.transformViewParams(this,e)}}o.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,o.getViewParamsFromBox=function(e,t,i,n,o,s){var a=s||{},l=e.getSize(new r.Vector3);if(a.target=e.getCenter(new r.Vector3),a.position||(a.position=new r.Vector3),a.up||(a.up=new r.Vector3),t){a.isPerspective=!1;var h=l.x/l.y,c=i;a.orthoScale=c>h?l.y:l.x/c,a.up.set(0,1,0),a.position.copy(a.target),a.position.z+=a.orthoScale,a.target.y+=1e-6*l.y}else a.isPerspective=!0,a.fov=o,a.up.copy(n),a.position.copy(a.target),a.position.z+=1.5*Math.max(l.x,l.y,l.z);return a},o.copyViewParams=function(e,t){return(t=t||{}).position=(t.position||new r.Vector3).copy(e.position),t.target=(t.target||new r.Vector3).copy(e.target),t.up=(t.up||new r.Vector3).copy(e.up),t.aspect=e.aspect,t.fov=e.fov,t.isPerspective=e.isPerspective,t.orthoScale=e.orthoScale,t},o.transformViewParams=function(e,t){var i;e.position.applyMatrix4(t),e.target.applyMatrix4(t),null===(i=e.pivot)||void 0===i||i.applyMatrix4(t),e.up.transformDirection(t)},o.adjustOrthoCamera=function(e,t){if(!e.isPerspective){var i=t.getSize(new r.Vector3),o=e.target.clone().sub(e.position),s=o.length();if(i>0&&s>1e3*i.length()){var a=e.position.distanceTo(t.getCenter(new r.Vector3));e.target.copy(e.position).add(o.normalize().multiplyScalar(a))}else{if(Math.abs(s-e.orthoScale)/s>1e-5)n.logger.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?"),!(0===e.fov&&1===e.orthoScale)&&e.position.copy(e.target).add(o.normalize().multiplyScalar(-e.orthoScale))}}},o.prototype.isUnifiedCamera=!0},81941:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ViewingUtilities:()=>n});var r=i(75050);function n(e,t,i){this.autocam=t,this.viewerImpl=e,this.setGlobalManager(this.viewerImpl.globalManager);var n=i.getCamera(),o={},s={};var a=new function(e){var t=.6,i=0,n=new r.SphereGeometry(1),o=new r.MeshPhongMaterial({color:32512,opacity:t,transparent:!0}),s=new r.Mesh(n,o),a=e,l=1;a.createOverlayScene("pivot"),s.visible=!1,this.shown=function(){return s.visible},this.show=function(e,r,n){s.scale.x=r*l,s.scale.y=r*l,s.scale.z=r*l,s.position.set(e.x,e.y,e.z),o.opacity=t,s.visible=!0,a.addOverlay("pivot",s),a.invalidate(!1,!1,!0),i=n?Date.now()+500:0},this.hide=function(){s.visible&&(s.visible=!1,a.removeOverlay("pivot",s),a.invalidate(!1,!1,!0),i=0)},this.fade=function(){if(i>0){var e=i-Date.now();if(e<=0)return this.hide(),!0;var r=e/500*t;return o.opacity=r,!0}return!1},this.fading=function(){return i>0},this.setSize=function(e){l=e},this.setColor=function(e,i){o.color=new r.Color(e),void 0!==i&&(t=i,o.opacity=t)}}(this.viewerImpl);this.transitionView=function(e,r,o,s,a,l,h){a=a||i.getWorldUpVector();var c=l?function(e,t,i){var r=t.clone().sub(e);if(0===r.lengthSq())return r.copy(i);var n=r.clone().cross(i);return 0===n.lengthSq()&&(i.z>i.y?r.y-=1e-4:r.z-=1e-4,n.crossVectors(r,i)),n.cross(r).normalize()}(e,r,a):s;c||(c=n.up);var u={position:e,center:r,pivot:h=h||r,fov:o,up:c,worldUp:a,isOrtho:!1===n.isPerspective};t.goToView(u)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),t.goHome()},this.getHitPoint=function(e,t){var r=this.viewerImpl.hitTestViewport(i.screenToViewport(e,t),!1);return r?r.intersectPoint:null},this.activatePivot=function(e){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var t=n.isPerspective?i.getPivotPlaneDistance():i.getEyeVector().length(),o=i.getVerticalFov(),s=2*t*Math.tan(r.Math.degToRad(.5*o)),l=i.getScreenViewport(),h=this.getWindow().devicePixelRatio||1,c=5*s/(l.height*h);a.show(i.getPivotPoint(),c,e)}},this.pivotActive=function(e,t){t=t||!1,(e=e&&!i.getIs2D())||!a.shown()?e&&this.activatePivot(t):a.hide()},this.pivotUpdate=function(){a.shown()&&a.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(e,t,r){i.setPivotPoint(e),t||i.setTarget(e),r&&i.setPivotSetFlag(!0),this.setTemporaryPivot(null),i.getIs2D()||a.shown()&&this.activatePivot(a.fading())},this.savePivot=function(e){e||(e="default"),o[e]=i.getPivotPoint(),s[e]=i.getPivotSetFlag()},this.restorePivot=function(e){if(e||(e="default"),o[e]){var t=s[e];this.setPivotPoint(o[e],!0,t),t||i.setPivotSetFlag(!1),delete o[e],delete s[e]}},this.setTemporaryPivot=function(e){if(e){var t=i.getPivotPoint(),r=i.getPivotSetFlag();this.setPivotPoint(e,!0,r),o.TEMP=t,s.TEMP=r}else delete o.TEMP,delete s.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.setPivotSize=function(e){a.setSize(e)},this.setPivotColor=function(e,t){a.setColor(e,t)},this.getBoundingBox=function(e){return this.viewerImpl.getFitBounds(e)},this.fitToView=function(e){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.selector.getAggregateSelection(),e),this.activatePivot(!0)},this.update=function(){i.getRequestFitToView()&&!i.getTransitionActive()&&(i.setRequestFitToView(!1),this.fitToView()),i.getRequestHomeView()&&!i.getTransitionActive()&&(i.setRequestHomeView(!1),this.goHome());var e=i.getRequestTransition();return e&&!i.getTransitionActive()&&(i.setRequestTransition(!1),this.transitionView(e.position,e.coi,e.fov,e.up,e.worldUp,e.reorient,e.pivot)),!1}}i(76542).GlobalManagerMixin.call(n.prototype)},91121:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MultiModelVisibilityManager:()=>s,VisibilityManager:()=>o});var r=i(60489),n=i(18878);function o(e,t){this.viewerImpl=e,this.model=t,this.isolatedNodes=[],this.hiddenNodes=[]}function s(e){this.viewerImpl=e,this.models=[]}function a(e){var t=e.getAggregateIsolatedNodes();if(1===e.models.length){var i={type:n.ISOLATE_EVENT,nodeIdArray:t.length?t[0].ids:[],model:e.models[0]};e.viewerImpl.api.dispatchEvent(i)}i={type:n.AGGREGATE_ISOLATION_CHANGED_EVENT,isolation:t};e.viewerImpl.api.dispatchEvent(i)}o.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},o.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},o.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},o.prototype.setAllVisibility=function(e){var t=this.model?this.model.getRootId():null;t&&this.setVisibilityOnNode(t,e),this.model.getData().is2d&&this.model.setAllVisibility(e)},o.prototype.isNodeVisible=function(e){var t=this.getInstanceTree();return t?!t.isNodeHidden(e):-1==this.hiddenNodes.indexOf(e)&&(0==this.isolatedNodes.length||-1!=this.isolatedNodes.indexOf(e))},o.prototype.isolate=function(e){var t=this.getInstanceTree(),i=t?t.getRootId():null,r="number"==typeof e&&e===i||"object"==typeof e&&e.dbId===i;e&&!r?this.isolateMultiple(Array.isArray(e)?e:[e]):this.isolateNone()},o.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0)},o.prototype.isolateMultiple=function(e){if(e&&0!=e.length){this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.setAllVisibility(!1),this.isolatedNodes=e.slice(0),this.hiddenNodes=[];const i=e.length-1;for(var t=0;t<e.length;t++)this.setVisibilityOnNode(e[t],!0,t!==i)}else this.isolateNone();this.viewerImpl.invalidate(!0)},o.prototype.hide=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i;if(Array.isArray(e)){const t=e.length-1;for(var r=0;r<e.length;++r)this.setVisibilityOnNode(e[r],!1,r!==t);e.length>0&&(i={type:n.HIDE_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!1),i={type:n.HIDE_EVENT,nodeIdArray:[e],model:this.model};i&&t&&this.viewerImpl.api.dispatchEvent(i)},o.prototype.show=function(e){var t;if(Array.isArray(e)){const r=e.length-1;for(var i=0;i<e.length;++i)this.setVisibilityOnNode(e[i],!0,i!==r);e.length>0&&(t={type:n.SHOW_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!0),t={type:n.SHOW_EVENT,nodeIdArray:[e],model:this.model};t&&this.viewerImpl.api.dispatchEvent(t)},o.prototype.toggleVisibility=function(e){var t=this.getInstanceTree();if(t){var i=t.isNodeHidden(e);this.setVisibilityOnNode(e,i);var r={type:i?n.SHOW_EVENT:n.HIDE_EVENT,nodeIdArray:[e],model:this.model};this.viewerImpl.api.dispatchEvent(r)}},o.prototype.setVisibilityOnNode=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var n,o=this.viewerImpl,s=this.model,a=this.getInstanceTree(),l=!t,h=s.getData().is2d;a?a.enumNodeChildren(e,(function(e){var i=a.isNodeVisibleLocked(e);if(a.setNodeHidden(e,l&&!i),h){var r=s.reverseMapDbIdFor2D(e);s.getFragmentList().setObject2DGhosted(r,!t&&!i)}else a.enumNodeFragments(e,(function(e){s.setVisibility(e,t||i)}),!1)}),r):h?s.isLeaflet()?s.setVisibility(null,t):null===(n=s.getFragmentList())||void 0===n||n.setObject2DGhosted(e,!t):s.setVisibility(e,t);o.sceneUpdated(!0,!1,i),this.updateNodeVisibilityTracking(e,t)},o.prototype.updateNodeVisibilityTracking=function(e,t){var i=t;if(this.isolatedNodes.length>0){var r=this.isolatedNodes.indexOf(e);i&&-1===r?this.isolatedNodes.push(e):i||-1===r||(this.isolatedNodes.splice(r,1),0===this.isolatedNodes.length&&(this.hiddenNodes=[this.model.getRootId()]))}else{var n=this.hiddenNodes.indexOf(e);i||-1!==n?i&&-1!==n&&this.hiddenNodes.splice(n,1):this.hiddenNodes.push(e)}var o=this.getInstanceTree();o&&o.root&&o.root.dbId===e&&(t?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[e]))},o.prototype.toggleNodeVisibleLocked=function(e){var t=this.getInstanceTree().isNodeVisbileLocked(e);this.lockNodeVisible(e,!t)},o.prototype.lockNodeVisible=function(e,t){var i=this.viewerImpl,r=this.model,n=this.getInstanceTree(),o=r.getData().is2d;if(n){var s=e=>{n.enumNodeChildren(e,(function(e){if(n.lockNodeVisible(e,t),t)if(n.setNodeHidden(e,!1),o){var i=r.reverseMapDbIdFor2D(e);r.getFragmentList().setObject2DGhosted(i,!1)}else n.enumNodeFragments(e,(function(e){r.setVisibility(e,!0)}),!1)}),!0),t&&(i.sceneUpdated(!0),this.updateNodeVisibilityTracking(e,t))};Array.isArray(e)?e.forEach(s):s(e)}},o.prototype.isNodeVisibleLocked=function(e){var t=this.getInstanceTree();return t&&t.isNodeVisibleLocked(e)},o.prototype.setNodeOff=function(e,t,i,r){var n=this.viewerImpl,o=this.model,s=this.getInstanceTree(),a=o.getData().is2d;if(!s)return a?o.getFragmentList().setObject2DVisible(e,!t):o.getFragmentList().setFragOff(e,t),void n.sceneUpdated(!0);if(i&&r){let e,n;if(a)for(let r=0;r<i.length;++r){e=i[r],s.setNodeOff(e,t);var l=o.reverseMapDbIdFor2D(e);o.getFragmentList().setObject2DVisible(l,!t)}else{for(let r=0;r<i.length;++r)e=i[r],s.setNodeOff(e,t);for(let e=0;e<r.length;++e)n=r[e],o.getFragmentList().setFragOff(n,t)}}else s.enumNodeChildren(e,(function(e){if(s.setNodeOff(e,t),a){var i=o.reverseMapDbIdFor2D(e);o.getFragmentList().setObject2DVisible(i,!t)}else s.enumNodeFragments(e,(function(e){o.getFragmentList().setFragOff(e,t)}),!1)}),!0);n.sceneUpdated(!0)},s.prototype.addModel=function(e){-1==this.models.indexOf(e)&&(e.visibilityManager=new o(this.viewerImpl,e),this.models.push(e))},s.prototype.removeModel=function(e){var t=this.models.indexOf(e);e.visibilityManager.isolateNone(),e.visibilityManager=null,this.models.splice(t,1)},s.prototype.warn=function(){this.models.length>1&&r.logger.warn("This selection call does not yet support multiple models.")},s.prototype.getAggregateIsolatedNodes=function(){for(var e=[],t=this.models,i=0;i<t.length;i++){var r=t[i].visibilityManager.getIsolatedNodes();r&&r.length&&e.push({model:t[i],ids:r})}return e},s.prototype.getIsolatedNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()},s.prototype.getAggregateHiddenNodes=function(){for(var e=[],t=this.models,i=0;i<t.length;i++){var r=t[i].visibilityManager.getHiddenNodes();r&&r.length&&e.push({model:t[i],ids:r})}return e},s.prototype.getHiddenNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()},s.prototype.isNodeVisible=function(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)},s.prototype.isolate=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.isolate(e),a(this)},s.prototype.aggregateIsolate=function(e,t){if(e&&0!==e.length){var i=this.models.concat();for(l=0;l<e.length;++l){var r=e[l].model,n=e[l].ids||e[l].selection,o=i.indexOf(r);i.splice(o,1),r.visibilityManager.isolate(n)}for(var s=!t||void 0!==t.hideLoadedModels&&t.hideLoadedModels;i.length&&s;)i.pop().visibilityManager.setAllVisibility(!1)}else for(var l=0;l<this.models.length;++l)this.models[l].visibilityManager.isolateNone();a(this)},s.prototype.hide=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)},s.prototype.aggregateHide=function(e){if(e&&0!==e.length){for(var t=0;t<e.length;++t){var i=e[t].model,r=e[t].ids||e[t].selection;i.visibilityManager.hide(r,1===this.models.length)}var o=this.getAggregateHiddenNodes(),s={type:n.AGGREGATE_HIDDEN_CHANGED_EVENT,hidden:o};this.viewerImpl.api.dispatchEvent(s)}},s.prototype.show=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)},s.prototype.toggleVisibility=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)},s.prototype.setVisibilityOnNode=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];i||(this.warn(),i=this.models[0]),i.visibilityManager.setVisibilityOnNode(e,t,r,n)},s.prototype.toggleVisibleLocked=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibleLocked(e)},s.prototype.lockNodeVisible=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.lockNodeVisible(e,t)},s.prototype.isNodeVisibleLocked=function(e,t){return t||(this.warn(),t=this.models[0]),t.visibilityManager.isNodeVisibleLocked(e,t)},s.prototype.setNodeOff=function(e,t,i,r,n){i||(this.warn(),i=this.models[0]),i.visibilityManager.setNodeOff(e,t,r,n)}},55379:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WorldUpTool:()=>o});var r=i(75050),n=i(18878);function o(e,t){var i,o=t.navigation,s=o.getCamera(),a=["worldup"],l=this,h=(i=new r.Vector3,function(e,t,n,o){var s=new r.Vector3(e,t,n),a=o.dot(s);return i.copy(o),i.multiplyScalar(a),s.sub(i)});var c=2*Math.PI,u=.001,d=1e-5,p=!1,f=!1,m=!1,g=new function(e,t){var i=2*Math.tan(r.Math.degToRad(15)),n=new r.MeshPhongMaterial({color:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),s=new r.Vector3,a=new r.Vector3,l=new r.Quaternion,u=new r.PerspectiveCamera(30,t.aspect,t.near,t.far),p=t,f=1,m=1,g=null,v=null,y=null,b=null,x=null,_=null,E=null,A=null,S=null,w=new Array(6),M=0,T=!1,C=!0,P=0,D=5*Math.PI/180,L=7*Math.PI/180,I=1,R=1e3,O=.1;function N(e,t){var i=Math.abs(e-t);return i>c?i:Math.min(c-i,i)}function F(e,t){var i=B(e);return i.distanceToSquared(t)<d||(a.set(-t.x,-t.y,-t.z),i.distanceToSquared(a)<d)}function k(e){return e>c?e:e<=0?e+Math.PI:e-Math.PI}function V(e,t,i){var r,n=e.clone().normalize(),o=new Array(3),s=new Array(6);o[0]=h(1,0,0,n),o[1]=h(0,1,0,n),o[2]=h(0,0,1,n);var c=t.clone().cross(n).normalize();for(r=0;r<3;++r){var u=o[r];s[r]=u.length(),s[r]<O?w[r]=R:(u.multiplyScalar(1/s[r]),w[r]=Math.atan2(c.dot(u),t.dot(u)))}for(w[3]=k(w[0]),w[4]=k(w[1]),w[5]=k(w[2]),s[3]=s[0],s[4]=s[1],s[5]=s[2],function(e,t){for(var i=D+L+2*Math.PI/180,r=0;r<6;++r)if(w[r]!==R)for(var n=r+1;n<6;++n)if(w[n]!==R&&N(w[r],w[n])<i){if(e[r]<e[n]&&!F(r,t)||F(n,t)){w[r]=R;break}w[n]=R}}(s,i),r=0;r<6;++r)if(w[r]!==R){var d=a.set(0,0,1);l.setFromAxisAngle(d,w[r]);var p=a.set(0,.54,0);p.applyQuaternion(l),A[r].position.copy(p),A[r].visible=!0}else A[r].visible=!1}function U(e,t,i,s,a){return _||(_=function(){_=new r.Object3D;var e=new r.RingGeometry(.5-.01*f,.5,60),t=new r.Mesh(e,n);v=t;var i=.007*f,o=new r.BoxGeometry(.93,i,i),s=new r.BoxGeometry(i,.93,i),a=new r.BoxGeometry(i,i,.93);y=new r.Mesh(o,n),b=new r.Mesh(s,n),x=new r.Mesh(a,n),_.add(y),_.add(b),_.add(x),E=new r.Mesh(new r.CircleGeometry(.005),n),_.add(E),A=new Array(6),S=new Array(6);for(var l=0;l<6;++l){var h=.005*f,c=.0025*f;A[l]=new r.Mesh(new r.CircleGeometry(h,16),n),S[l]=new r.Mesh(new r.CircleGeometry(c,16),n),S[l].visible=!1,A[l].add(S[l]),t.add(A[l])}return _.add(t),_}()),o.orient(v,t,u.position,s),V(i,a,s),_.scale.x=e,_.scale.y=e,_.scale.z=e,_.position.copy(t),_}function B(e){if(s.set(0,0,0),e>=0){var t=e>=3?-1:1;0===(e%=3)&&(s.x=t),1===e&&(s.y=t),2===e&&(s.z=t)}return T&&s.multiplyScalar(-1),s}function G(e,t){for(var i=N(w[0],e),r=0,n=1;n<6;++n){var o=N(w[n],e);o<i&&(i=o,r=n)}return i,i<t?r:-1}function z(e){o.setWorldUpVector(e,!0)}function H(e){if(0!==e){var t=30*Math.PI/180,i=a.copy(u.position).sub(g).normalize();l.setFromAxisAngle(i,e);var r=o.getWorldUpVector(),n=Math.abs(i.angleTo(r));(n<t||Math.PI-n<t)&&r.copy(o.getCameraUpVector()),r.applyQuaternion(l),z(r)}}function W(e,t,i,r){return e<t&&B(i).distanceToSquared(r)<d}function j(e,t){e.dot(t)<0&&(t=t.clone().multiplyScalar(-1)),o.orient(E,g,u.position,t),E.position.copy(t.multiplyScalar(.495));for(var i=!1,r=C?L:D,n=0;n<6;++n){var s=N(w[n],M),a=W(s,r,n,e);a&&(i=!0);var l=a?4:3*(1-3*s/Math.PI);l<1&&(l=1),l*=f,S[n].visible=a;var h=A[n];h.scale.x=l,h.scale.y=l,h.scale.z=l}return y.visible=i,b.visible=i,x.visible=i,i}function q(e){(M+=e)>Math.PI?M-=c:M<=-Math.PI&&(M=c+M);var t=function(){if(!C){var e=G(M,D);if(e>=0)return 0,C=!0,M=w[e],B(e)}return!1}();if(t)P=M,z(t);else if(function(){if(C){if(G(M,L)<0)return C=!1,!0;0}return!1}()){H(M-P),P=0}else{if(C)return!1;H(e)}return!0}e.createOverlayScene("roll",null,null,u),this.updateRollCamera=function(e,t){u.position.copy(p.position),u.quaternion.copy(p.quaternion),u.up.copy(p.up),u.aspect=p.aspect,e&&t&&(u.near=t-e,u.far=t+e),u.updateProjectionMatrix()},this.isSnapped=function(){return C},this.resize=function(){var e=I*i,t=e*p.aspect,r=(p.aspect<1?t:e)*m;_.scale.x=r,_.scale.y=r,_.scale.z=r},this.start=function(t,i){this.updateHUD(t,i),e.addOverlay("roll",_)},this.updateHUD=function(e,t){g=e,t<.35?t=.35:t>.8&&(t=.8),m=t,f=.8/t;var r=s.copy(e).sub(p.position),n=(I=r.length())*i,a=n*p.aspect,l=(p.aspect<1?a:n)*t;this.updateRollCamera(l,I);var h=o.getWorldUpVector(),c=o.getCameraUpVector();U(l,e,r,h,c),M=0,P=0;var u=h.dot(c);T=u<0,C=j(h,c)},this.handleRoll=function(e,t,i){if(this.updateRollCamera(),j(o.getWorldUpVector(),o.getCameraUpVector()),0!==e||0!==t){var r=i.x-e-.5,n=i.y-t-.5,s=i.x-.5,a=i.y-.5;return q(Math.atan2(a,s)-Math.atan2(n,r))}return!1},this.handleRollTouch=function(e){this.updateRollCamera(),j(o.getWorldUpVector(),o.getCameraUpVector());var t=e-M;return Math.abs(t)>.001&&q(t)},this.end=function(){e.removeOverlay("roll",_)}}(e,s),v=new r.Vector3,y=new r.Vector3,b=new r.Vector3,x=null,_=0;this.getNames=function(){return a},this.getName=function(){return a[0]},this.activate=function(e){t.addEventListener(n.CAMERA_CHANGE_EVENT,this.handleCameraChange),m=!1},this.deactivate=function(e){g.end(),t.removeEventListener(n.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),x=null,p=!1,m=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(e){var t=y.x-v.x,i=y.y-v.y,r=y.z-v.z;Math.abs(t)<u&&(t=0),Math.abs(i)<u&&(i=0),Math.abs(r)<u&&(r=0),e.set(t,i,r)},this.stepMotionDelta=function(){v.copy(y)},this.update=function(){if(!m){var e=o.getEyeVector(),t=.5*(s.near+s.far);e.normalize().multiplyScalar(t);var i=e.add(s.position);this.utilities.savePivot(),this.utilities.setPivotPoint(i,!0,!0),this.utilities.pivotActive(!0);g.start(i,.65),m=!0}var r=f;this.getMotionDelta(b);var n=b.x,a=b.y,l=b.z;return(f||"roll"===x||p&&(0!==n||0!==a||0!==l))&&(f="roll"===x?g.handleRollTouch(_):g.handleRoll(n,a,y)),this.stepMotionDelta(),s.dirty&&(r=!0),r},this.handleResize=function(){g.resize(),f=!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return x="drag",this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return x=null,this.handleButtonUp(e,0);case"rotatestart":return t.removeEventListener(n.CAMERA_CHANGE_EVENT,this.handleCameraChange),x="roll",_=r.Math.degToRad(e.rotation),{x:.5*(e.normalizedX+1),y:1-.5*(e.normalizedY+1)},function(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY,r=Math.sqrt(t*t+i*i),n=o.getScreenViewport();return r/Math.min(n.width,n.height)}(e),!0;case"rotatemove":return _=r.Math.degToRad(e.rotation),"roll"===x;case"rotateend":return t.addEventListener(n.CAMERA_CHANGE_EVENT,this.handleCameraChange),_=r.Math.degToRad(e.rotation),x=null,!1}return!1},this.handleWheelInput=function(e){return!0},this.handleCameraChange=function(){var e=o.getEyeVector(),t=.5*(s.near+s.far);e.normalize().multiplyScalar(t);var i=e.add(s.position);g.updateHUD(i,.65)},this.handleButtonDown=function(e,i){return v.x=.5*(e.normalizedX+1),v.y=1-.5*(e.normalizedY+1),y.copy(v),p=!0,x=null,this.controller.setIsLocked(!0),t.removeEventListener(n.CAMERA_CHANGE_EVENT,l.handleCameraChange),!0},this.handleButtonUp=function(e,i){return y.x=.5*(e.normalizedX+1),y.y=1-.5*(e.normalizedY+1),p=!1,f=!0,this.controller.setIsLocked(!1),t.addEventListener(n.CAMERA_CHANGE_EVENT,l.handleCameraChange),!0},this.handleMouseMove=function(e){return y.x=.5*(e.normalizedX+1),y.y=1-.5*(e.normalizedY+1),!0},this.handleBlur=function(e){return p=!1,x=null,!1}}},79416:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Autocam:()=>c});var r=i(75050),n=i(91493),o=i(76542),s=i(64141);const a=Number.MIN_VALUE||3e-308,l=1e-5;function h(e){const t=1e-12;Math.abs(e.x)<t&&Math.abs(e.y)<t?e.set(0,0,e.z>0?1:-1):Math.abs(e.y)<t&&Math.abs(e.z)<t?e.set(e.x>0?1:-1,0,0):Math.abs(e.z)<t&&Math.abs(e.x)<t&&e.set(0,e.y>0?1:-1,0)}function c(e,t,i){var o=this,c=null,u=!1;this.cube=null,this.camera=e,this.renderer="WEBGL",this.startState={},this.navApi=t,this.orthographicFaces=!1,this.canvas=i,this.cameraChangedCallback=function(){},this.pivotDisplayCallback=function(){},this.transitionCompletedCallback=function(){};var d,p=Date.now(),f=!1;function m(t){u=!0,e.target.copy(o.center),e.pivot.copy(o.pivot),e.worldup?e.worldup.copy(o.sceneUpDirection):e.up.copy(o.sceneUpDirection),o.cameraChangedCallback(t),u=!1}function g(e,t){e.position.copy(e.globalPosition).sub(t),e.center.copy(e.globalCenter).sub(t),e.pivot.copy(e.globalPivot).sub(t)}this.recordTime=!0,this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.transitionCompletedCallback=null,this.canvas=null,this.recordTime=!1,this.afAnimateTransition&&cancelAnimationFrame(this.afAnimateTransition)},this.registerCallbackCameraChanged=function(e){this.cameraChangedCallback=e},this.registerCallbackPivotDisplay=function(e){this.pivotDisplayCallback=e},this.registerCallbackTransitionCompleted=function(e){this.transitionCompletedCallback=e},this.showPivot=function(e){this.pivotDisplayCallback(e)},this.setWorldUpVector=function(e){u||e&&e.lengthSq()>0&&!e.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(e),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var e=this.sceneUpDirection.clone();return Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(e){if(this.navApi.isActionEnabled("gotoview")){var t={position:e.position.clone(),up:e.up.clone(),center:e.center.clone(),pivot:e.pivot.clone(),fov:e.fov,worldUp:e.worldUp.clone(),isOrtho:e.isOrtho};this.addGlobalPositions(t),o.elapsedTime=0,this.animateTransition(t)}},this.getCurrentView=function(){return{position:e.position.clone(),up:e.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:e.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===e.isPerspective}},this.setCurrentViewAsHome=function(e){e?(this.navApi.setRequestFitToView(!0),f=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(e){var t=e.pivot?e.pivot:this.center,i=e.target?e.target:this.pivot,r=e.worldup?e.worldup:this.sceneUpDirection;this.homeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:r.clone(),isOrtho:!1===e.isPerspective},this.originalHomeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:r.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===e.isPerspective},this.addGlobalPositions(this.homeVector),this.addGlobalPositions(this.originalHomeVector)},this.toPerspective=function(){e.isPerspective||(e.toPerspective(),m(!1))},this.toOrthographic=function(){e.isPerspective&&(e.toOrthographic(),m(!1))},this.setOrthographicFaces=function(e){this.orthographicFaces=e},this.getViewType=function(){return this.orthographicFaces?s.VIEW_TYPES.PERSPECTIVE_ORTHO_FACES:e.isPerspective?s.VIEW_TYPES.PERSPECTIVE:s.VIEW_TYPES.ORTHOGRAPHIC},this.setViewType=function(e,t){switch(e){case s.VIEW_TYPES.ORTHOGRAPHIC:return this.setOrthographicFaces(!1),this.toOrthographic(),!0;case s.VIEW_TYPES.PERSPECTIVE:return this.setOrthographicFaces(!1),this.toPerspective(),!0;case s.VIEW_TYPES.PERSPECTIVE_ORTHO_FACES:return this.setOrthographicFaces(!0),void 0===t&&(t=this.isFaceView()),t?this.toOrthographic():this.toPerspective(),!0;default:return!1}},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(e.position)},this.setCameraUp=function(t){var i=this.dir.clone(),r=i.cross(t).normalize();0===r.lengthSq()&&(i.copy(this.dir),t.z>t.y?i.y+=1e-4:i.z+=1e-4,r=i.cross(t).normalize()),e.up.copy(r).cross(this.dir).normalize()},this.addGlobalPositions=function(e){var t=this.camera.globalOffset;e.globalPosition=e.position.clone().add(t),e.globalCenter=e.center.clone().add(t),e.globalPivot=e.pivot.clone().add(t)},this.onGlobalOffsetChanged=function(e){g(this.homeVector,e),g(this.originalHomeVector,e),this.camera.setGlobalOffset(e)};var v,b,_,E,A=this;!function e(){A.recordTime&&requestAnimationFrame(e);var t=Date.now();d=t-p,p=t}(),this.ortho=!1,this.center=e.target?e.target.clone():new r.Vector3(0,0,0),this.pivot=e.pivot?e.pivot.clone():this.center.clone(),this.sceneUpDirection=e.worldup?e.worldup.clone():e.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(e.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=e.position.clone(),this.saveUp=e.up.clone(),this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(e);var S,w,M=new r.Quaternion,T=new r.Quaternion,C=new r.Quaternion,P=new r.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,e.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=r.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new r.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var D,L,I={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=I,this.zoomDelta=new r.Vector2;var R;function O(e,t,i){if(e<=t)return 0;if(e>=i)return 1;var r=(e-t)/(i-t);return.5*(Math.sin((r-.5)*Math.PI)+1)}function N(e){return Math.round(10*e)/10}function F(e,t){var i=new r.Vector2(0,0),n=o.getWindow();return i.x=e/n.innerWidth,i.y=t/n.innerHeight,i}function k(e,t,i){var r,n,s,a;r=n=s=a=0;var l=0,h=null,c=null,u=o.snapOrbitDeadZone,d=o.orbitMultiplier;return"h"==e?(r=o.snapOrbitThresholdH,n=o.snapOrbitAccelerationAX,s=o.snapOrbitAccelerationBX,a=1-o.snapOrbitAccelerationPointX,c=o.lockDeltaX,h=o.lockedX):(r=o.snapOrbitThresholdV,n=o.snapOrbitAccelerationAY,s=o.snapOrbitAccelerationBY,a=1-o.snapOrbitAccelerationPointY,c=o.lockDeltaY,h=o.lockedY),h?(c+=i)<-u?(l=(c+u)*d*1/s,h=!1):c>u&&(l=(c-u)*d*1/s,h=!1):(l=Math.abs(t)>r?i*d:Math.abs(t)>a*r?i*t>0?i*d*n:i*d*1/n:i*t>0?i*d*s:i*d*1/s)*t>0&&Math.abs(l)>Math.abs(t)&&(this.lockDeltaX=this.lockDeltaY=0,h=!0,l=t),l}function V(){return o.combined}function U(e,t){var i=!1,r=o.getWindow(),n=r.innerWidth,s=e.x%n,a=r.innerHeight,l=e.y%a,h=s>0?s-t.x:n+s-t.x,c=l>0?l-t.y:a+l-t.y;return Math.abs(h)<30&&Math.abs(c)<30&&(i=!0),i}function B(e,t,i){var n=o.getWindow();if(!R||!e){if(e){var s=new r.Vector2,a=t.x,l=t.y;!function(e,t,i){var r=o.getWindow();i.x=(e.x-t.x)/r.innerWidth,e.x=t.x+(e.x-t.x)%r.innerWidth,i.y=(e.y-t.y)/r.innerHeight,e.y=t.y+(e.y-t.y)%r.innerHeight}(t,i,s),n.innerWidth*s.x,n.innerHeight*s.y,a<i.x?a-=60:a+=60,l<i.y?l-=60:l+=60}R=e}}function G(e){var t=Math.pow(e,2);e<0&&(t=-t);var i=F(0,t),r=.01*(o.maxSceneBound-o.minSceneBound);i.y*=r;var n=o.userHeightSpeed*i.y;return n=function(e,t,i){if(0===t)return 0;var r=e,n=o.saveEye.clone().sub(worldUp.clone().multiplyScalar(i+r)),s=o.saveEye.clone().sub(worldUp.clone().multiplyScalar(i)),a=0,l=(o.maxSceneBound-o.minSceneBound)/1e3;o.topLimit&&t>0?(a=o.maxSceneBound-l,o.topLimit=!1):o.bottomLimit&&t<0?(a=o.minSceneBound+l,o.bottomLimit=!1):a=n.dot(worldUp);var h=s.dot(worldUp);return a<o.minSceneBound?h<o.minSceneBound&&(o.bottomLimit=!0,r=0):a>o.maxSceneBound&&h>o.maxSceneBound&&(o.topLimit=!0,r=0),r}(n,e,o.m_amount),n}function z(e){var t=o.sceneFrontDirection.clone().cross(o.sceneUpDirection),i=Math.abs(Math.abs(e.dot(o.sceneUpDirection))-1),r=Math.abs(Math.abs(e.dot(o.sceneFrontDirection))-1),n=Math.abs(Math.abs(e.dot(t))-1);return i<l||r<l||n<l}this.viewCubeMenuOpen=!1,this.menuSize=new r.Vector2(0,0),this.menuOrigin=new r.Vector2(0,0),e.lookAt(this.center),this.setCube=function(e){this.cube=e},this.sync=function(t){t.isPerspective!==e.isPerspective&&(t.isPerspective?e.toPerspective():(e.toOrthographic(),t.saveFov&&(e.saveFov=t.saveFov))),e.fov=t.fov,e.position.copy(t.position),t.target&&(this.center.copy(t.target),e.target.copy(t.target)),t.pivot&&(this.pivot.copy(t.pivot),e.pivot.copy(t.pivot)),this.dir.copy(this.center).sub(e.position),this.setCameraUp(t.up);var i=t.worldup?t.worldup:t.up;i.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(i),f&&!this.navApi.getTransitionActive()&&(f=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},r.Matrix3.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,s=i+i,a=r+r,l=n+n,h=i*s,c=i*a,u=i*l,d=r*a,p=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+f),t[3]=c-v,t[6]=u+g,t[1]=c+v,t[4]=1-(h+f),t[7]=p-m,t[2]=u-g,t[5]=p+m,t[8]=1-(h+d),this},r.Quaternion.prototype.setFromRotationMatrix3=function(e){var t,i=e.elements,r=i[0],n=i[3],o=i[6],s=i[1],a=i[4],l=i[7],h=i[2],c=i[5],u=i[8],d=r+a+u;return d>0?(t=.5/Math.sqrt(d+1),this.w=.25/t,this.x=(c-l)*t,this.y=(o-h)*t,this.z=(s-n)*t):r>a&&r>u?(t=2*Math.sqrt(1+r-a-u),this.w=(c-l)/t,this.x=.25*t,this.y=(n+s)/t,this.z=(o+h)/t):a>u?(t=2*Math.sqrt(1+a-r-u),this.w=(o-h)/t,this.x=(n+s)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*Math.sqrt(1+u-r-a),this.w=(s-n)/t,this.x=(o+h)/t,this.y=(l+c)/t,this.z=.25*t),this},r.Quaternion.prototype.rotate=function(e){var t=(new r.Matrix4).makeRotationFromQuaternion(this).elements,i=(new r.Matrix3).set(t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]);return e.applyMatrix3(i)},this.animateTransition=function(t){if(g(t,e.globalOffset),t){var i=!1,r=0;if(this.setCameraOrtho(t.isOrtho),o.elapsedTime>=I.duration)return r=1,o.center.copy(t.center),o.pivot.copy(t.pivot),e.position.copy(t.position),e.up.copy(t.up),e.target.copy(t.center),t.isOrtho||(e.fov=t.fov),e.dirty=!0,(i=!t.worldUp.equals(this.sceneUpDirection))&&this.setWorldUpVector(t.worldUp),this.currentlyAnimating=!1,m(i),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.navApi.setTransitionActive(!1),void this.transitionCompletedCallback();this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var n=I.destinationPercent,s=1-(r=O(o.elapsedTime/I.duration,0,n));o.elapsedTime+=d/500;var a=o.center.clone().multiplyScalar(s).add(t.center.clone().multiplyScalar(r)),l=e.position.clone().multiplyScalar(s).add(t.position.clone().multiplyScalar(r)),h=e.up.clone().multiplyScalar(s).add(t.up.clone().multiplyScalar(r)),c=e.pivot.clone().multiplyScalar(s).add(t.pivot.clone().multiplyScalar(r)),u=this.sceneUpDirection.clone().multiplyScalar(s).add(t.worldUp.clone().multiplyScalar(r)),p=e.fov*s+t.fov*r;o.center.copy(a),o.pivot.copy(c),e.position.copy(l),e.up.copy(h),e.target.copy(a),t.isOrtho||(e.fov=p),e.dirty=!0,(i=u.distanceToSquared(this.sceneUpDirection)>1e-4)&&this.setWorldUpVector(u),e.lookAt(o.center),m(i),this.cube&&requestAnimationFrame(this.cube.render),o.afAnimateTransition=requestAnimationFrame((function(){o.animateTransition(t)}))}},this.sphericallyInterpolateTransition=function(t){var i,n,s,a,l=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),o.elapsedTime>=I.duration)l=1,this.currentlyAnimating=!1;else{var h=I.destinationPercent;l=O(o.elapsedTime/I.duration,0,h),o.elapsedTime+=d/500}if(1===l)n=L.position,i=L.center,s=L.up;else{var c=new r.Matrix3,u=M.clone();u.slerp(T,l),c.makeRotationFromQuaternion(u);var p=S*(1-(a=l))+w*a,f=c.elements;n=(i=D.center.clone().multiplyScalar(1-l).add(L.center.clone().multiplyScalar(l))).clone().sub(new r.Vector3(f[0],f[1],f[2]).multiplyScalar(p)),s=new r.Vector3(f[3],f[4],f[5])}o.center.copy(i),e.position.copy(n),e.up.copy(s),o.navApi.getUsePivotAlways()||o.pivot.copy(i),e.lookAt(o.center),!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame((function(){o.sphericallyInterpolateTransition(t)}))):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),t&&t()),m(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var t=N(e.up.x),i=N(e.up.y),r=N(e.up.z),n=this.sceneFrontDirection.clone(),o=this.sceneUpDirection.clone(),s=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();n.x=N(n.x),n.y=N(n.y),n.z=N(n.z),o.x=N(o.x),o.y=N(o.y),o.z=N(o.z),s.x=N(s.x),s.y=N(s.y),s.z=N(s.z);var a=s.clone().multiplyScalar(-1),l=o.clone().multiplyScalar(-1),h=n.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(o.x==t&&o.y==i&&o.z==r)return"up";if(l.x==t&&l.y==i&&l.z==r)return"down";if(s.x==t&&s.y==i&&s.z==r)return"right";if(a.x==t&&a.y==i&&a.z==r)return"left";break;case"right":if(o.x==t&&o.y==i&&o.z==r)return"up";if(l.x==t&&l.y==i&&l.z==r)return"down";if(h.x==t&&h.y==i&&h.z==r)return"left";if(n.x==t&&n.y==i&&n.z==r)return"right";break;case"left":if(o.x==t&&o.y==i&&o.z==r)return"up";if(l.x==t&&l.y==i&&l.z==r)return"down";if(n.x==t&&n.y==i&&n.z==r)return"left";if(h.x==t&&h.y==i&&h.z==r)return"right";break;case"back":if(o.x==t&&o.y==i&&o.z==r)return"up";if(l.x==t&&l.y==i&&l.z==r)return"down";if(a.x==t&&a.y==i&&a.z==r)return"right";if(s.x==t&&s.y==i&&s.z==r)return"left";break;case"top":if(h.x==t&&h.y==i&&h.z==r)return"down";if(n.x==t&&n.y==i&&n.z==r)return"up";if(s.x==t&&s.y==i&&s.z==r)return"right";if(a.x==t&&a.y==i&&a.z==r)return"left";break;case"bottom":if(n.x==t&&n.y==i&&n.z==r)return"down";if(h.x==t&&h.y==i&&h.z==r)return"up";if(s.x==t&&s.y==i&&s.z==r)return"right";if(a.x==t&&a.y==i&&a.z==r)return"left"}}},this.setCameraOrtho=function(t){t&&e.isPerspective&&e.toOrthographic(),t||e.isPerspective||e.toPerspective()},this.resetOrientation=function(){this.cube&&this.cube.showCompass(this.cube.prevRenderCompass),this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),m(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front",this.cube.showCompass(!1)),this.sceneUpDirection.copy(e.up.clone()),h(this.sceneUpDirection),this.sceneFrontDirection.copy(this.getView()).normalize(),h(this.sceneFrontDirection),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),h(this.cubeFront),this.orthographicFaces&&this.setCameraOrtho(!0),m(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top",this.cube.showCompass(!1)),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),h(this.sceneUpDirection),this.sceneFrontDirection.copy(e.up),h(this.sceneFrontDirection),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),h(this.cubeFront),m(!0)},this.calculateCubeTransform=function(t){var i=this.sceneUpDirection.clone(),n=this.sceneFrontDirection.clone(),s=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();(D=e.clone()).center=o.center.clone(),D.pivot=o.pivot.clone(),(L=e.clone()).center=o.center.clone(),L.pivot=o.pivot.clone();var l=new r.Vector3(0,0,0);t.indexOf("back")>=0&&(l=l.add(n)),t.indexOf("front")>=0&&(l=l.sub(n)),t.indexOf("top")>=0&&(l=l.add(i)),t.indexOf("bottom")>=0&&(l=l.sub(i)),t.indexOf("right")>=0&&(l=l.add(s)),t.indexOf("left")>=0&&(l=l.sub(s));var h=i,c=l.clone().normalize();if(1-Math.abs(c.dot(i))<a)for(var u=this.getView().normalize(),d=[n.clone(),n.clone().negate(),s.clone(),s.clone().negate()],p=c.dot(i)>0?1:-1,f=u.clone().add(e.up.clone().multiplyScalar(p)).normalize(),m=-2,g=0;g<4;g++){var v=f.dot(d[g]);v>m&&(m=v,h=d[g].multiplyScalar(p))}w=S=this.getView().length(),L.position.copy(L.center.clone().add(l.multiplyScalar(w/l.length()))),L.up.copy(h);var y=D.center.clone().sub(D.position).normalize(),b=y.clone().cross(D.up).normalize(),x=b.clone().cross(y).normalize(),_=new r.Matrix3;_.set(y.x,x.x,b.x,y.y,x.y,b.y,y.z,x.z,b.z),M.setFromRotationMatrix3(_),x=(b=(y=L.center.clone().sub(L.position).normalize()).clone().cross(L.up).normalize()).clone().cross(y).normalize(),_.set(y.x,x.x,b.x,y.y,x.y,b.y,y.z,x.z,b.z),C.setFromAxisAngle(y,0),P.setFromAxisAngle(x,0),T.setFromRotationMatrix3(_),T.multiply(C).multiply(P).normalize()},this.drawDropdownMenu=function(e,t,i,r,o,s,a){var l=0,h=this.getDocument();if(c)s.appendChild(c);else{(c=h.createElement("div")).className="dropDownMenu",c.style.top="100px",c.style.left="-400px";for(var u=0,d=0,p=0;p<e.length;p++){var f;if(null===e[p])(f=h.createElement("li")).style.height="1px",u+=1,f.style.backgroundColor="#E0E0E0";else{var m=n.Z.t(e[p]);if(d=m.length>d?m.length:d,i[p]){f=h.createElement("div");var g=h.createElement("input"),v=h.createElement("label");g.type="radio",g.className="dropDownMenuCheck",v.innerHTML=m,v.className="dropDownMenuCheckText",f.appendChild(g),f.appendChild(v),f.className="dropDownMenuCheckbox"}else(f=h.createElement("li")).textContent=m,f.className=t[p]?"dropDownMenuItem":"dropDownMenuItemDisabled";f.id="menuItem"+l,l++,u+=25,f.setAttribute("data-i18n",e[p])}c.appendChild(f)}s.appendChild(c),c.style.minWidth=Math.max(256,7.4*d)+"px";var y=c.getBoundingClientRect().width;this.menuSize.x=y,this.menuSize.y=u}l=0;for(p=0;p<e.length;p++)if(null!==e[p]){if(i[p]){var b="menuItem"+l,x=h.getElementById(b);x&&(x.children[0].checked=i[p]())}l++}var _=o-15,E=r+1,A=this.canvas.getBoundingClientRect();E+this.menuSize.x>A.right&&(E=r-this.menuSize.x-1),_+this.menuSize.y>A.bottom&&(_=A.bottom-this.menuSize.y),_-=a.y,E-=a.x,c.style.top=_+"px",c.style.left=E+"px",this.menuOrigin.x=E,this.menuOrigin.y=_},this.removeDropdownMenu=function(e){e.removeChild(c)},this.isFaceView=function(){return z(this.center.clone().sub(e.position).normalize())&&z(e.up)},this.startInteraction=function(e,t){this.startCursor=new r.Vector2(e,t),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new r.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(t,i,n,s){if(this.navApi.isActionEnabled("orbit")&&!0!==this.currentlyAnimating){var a="wheel";if(o.orthographicFaces&&!e.isPerspective&&(e.toPerspective(),s&&s.saveEye.copy(this.camera.position)),s&&(a="cube"),"cube"==a?(this.saveCenter.copy(s.saveCenter),this.saveEye.copy(s.saveEye),this.savePivot.copy(s.savePivot),this.saveUp.copy(s.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(e.position),this.saveUp.copy(e.up),this.useSnap=!1,this.doCustomOrbit=!1),V()&&null==b&&(b=this.saveCenter.clone(),v=this.saveEye.clone(),E=this.savePivot.clone(),_=this.saveUp.clone()),this.preserveOrbitUpDirection){var l=F(t.x-i.x,t.y-i.y),h=F(n.x,n.y),c=this.sceneUpDirection.clone(),u=this.sceneFrontDirection.clone(),d=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),p=V()?E:this.savePivot,f=V()?v:this.saveEye,g=V()?b:this.saveCenter,y=V()?_:this.saveUp,x=p.clone().sub(f).normalize(),A=g.clone().sub(f).normalize(),S=A.clone().cross(y),w=f.clone().sub(p).length(),M=f.clone().sub(g).length(),T=x.clone().multiplyScalar(-1),C=A.clone().multiplyScalar(-1),P=S,D=y.clone();if(!this.constrainOrbitHorizontal){c.dot(this.saveUp)<-.009&&(l.x=-l.x,h.x=-h.x);var L=0;L=V()?h.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+k("h",0,-h.x):l.x*this.orbitMultiplier,this.lastSnapRotateX=L;var I=(new r.Quaternion).setFromAxisAngle(c,-L);T.applyQuaternion(I),C.applyQuaternion(I),P.applyQuaternion(I),D.applyQuaternion(I)}if(!this.constrainOrbitVertical){var R=u.clone().multiplyScalar(u.dot(P)),O=d.clone().multiplyScalar(d.dot(P)),N=R.clone().add(O);N.clone().normalize();var U=0;if(V())U=h.y*this.orbitMultiplier;else{var B=k("v",0,h.y);U=this.useSnap?this.lastSnapRotateY+B:l.y*this.orbitMultiplier}var G=(new r.Quaternion).setFromAxisAngle(N,-U);if(this.navApi.getOrbitPastWorldPoles())T.applyQuaternion(G).normalize(),C.applyQuaternion(G).normalize(),D.applyQuaternion(G).normalize();else{var z=D.clone();if(z.applyQuaternion(G).normalize(),c.dot(z)<0){var H=C.clone();H.applyQuaternion(G).normalize();var W=H.angleTo(c);Math.abs(W)>.5*Math.PI&&(W-=W>0?Math.PI:-Math.PI),U-=W,G.setFromAxisAngle(N,-U),T.applyQuaternion(G).normalize(),C.applyQuaternion(G).normalize(),D.applyQuaternion(G).normalize()}else T.applyQuaternion(G).normalize(),C.applyQuaternion(G).normalize(),D.applyQuaternion(G).normalize()}this.lastSnapRotateY=U}var j=T.multiplyScalar(w).add(p);e.position.copy(j),e.up.copy(D),this.center.copy(j),this.center.sub(C.multiplyScalar(M)),V()&&(b.copy(this.center),v.copy(e.position),E.copy(this.pivot),_.copy(e.up))}e.lookAt(this.center),m(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(t){if(this.navApi.isActionEnabled("walk")){var i=F(t.x,t.y),n=this.userLookSpeed,o=this.getView(),s=e.up,a=o.clone().cross(s).normalize(),l=this.sceneUpDirection.clone(),h=i.clone();h.x*=Math.PI,h.y*=Math.PI/e.aspect,h.multiplyScalar(n);var c=(new r.Quaternion).setFromAxisAngle(a,-h.y);if(e.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var u=s.clone();if(u.applyQuaternion(c).normalize(),u.dot(l)<0){var d=o.clone();d.applyQuaternion(c);var p=d.angleTo(l);Math.abs(p)>.5*Math.PI&&(p-=p>0?Math.PI:-Math.PI),h.y-=p,c.setFromAxisAngle(a,-h.y)}}o=c.clone().rotate(o),(s=c.clone().rotate(s)).normalize();var f=e.keepSceneUpright?l:s,g=(new r.Quaternion).setFromAxisAngle(f,-h.x);o=g.clone().rotate(o),s=g.clone().rotate(s),this.center.copy(o.add(e.position)),e.up.copy(s),e.lookAt(this.center),m(!1)}},this.pan=function(t){if(this.navApi.isActionEnabled("pan")){t=F(t.x,t.y);var i=this.getView(),n=e.up.clone().cross(i),o=i.clone().cross(n);n.normalize(),o.normalize(),i.normalize();var s=this.pivot.clone().sub(e.position),a=i.clone().dot(s),l=a*(Math.tan(r.Math.degToRad(e.leftFov))+Math.tan(r.Math.degToRad(e.rightFov))),h=a*(Math.tan(r.Math.degToRad(e.topFov))+Math.tan(r.Math.degToRad(e.bottomFov))),c=t.x*Math.abs(l),u=t.y*Math.abs(h),d=new r.Vector3,p=n.clone().multiplyScalar(c),f=o.clone().multiplyScalar(u);d=p.clone().add(f).clone().multiplyScalar(this.userPanSpeed),e.position.add(d),this.center.add(d),e.lookAt(this.center),m(!1)}},this.zoom=function(t){if(this.navApi.isActionEnabled("zoom")){var i=this.userZoomSpeed,r=Number.MAX_VALUE,n=t.x+t.y,s=Math.pow(i,n),a=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(s)),l=a.clone().add(o.D.clone().multiplyScalar(o.D.clone().dot(this.pivot.clone().sub(a).clone())));if(!(s>=r)){if(n>0){Math.pow(i,n-0);if(n<0)return void 0;e.position.copy(a),this.center.copy(l);var h=a.clone().sub(this.saveEye).dot(o.D);h>r?(e.position.copy(this.saveEye.sub(o.D).clone().multiplyScalar(r)),r>0?-1:0):-h/r}else e.position.copy(a),this.center.copy(l);e.lookAt(this.center),m(!1)}}},this.walk=function(t,i,n,o,s){if(this.navApi.isActionEnabled("walk")){var l=this.sceneUpDirection.clone(),h=this.sceneFrontDirection.clone(),c=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);U(t,i)?(wheel.cursorImage("SWWalk"),B(!0,t,i),x=i.x,y=i.y):B(!1,t,i),x=t.x,y=t.y;var u=F(x-i.x,y-i.y),d=-u.x,p=-u.y,f=d<0?-1:1,g=p<0?-1:1,v=Math.abs(d),b=Math.abs(p),_=new r.Vector2(30,30);_=F(_.x,_.y),v=U(t,i)?0:Math.abs(d)-_.x,b=U(t,i)?0:Math.abs(p)-_.y;b/=.25;var E=(v=(v/=.25)<1?O(v,0,1):Math.pow(v,1))>0?v*f:0,A=(b=b<1?O(b,0,1):Math.pow(b,1))>0?b*g:0,S=this.getView(),w=S.length();S.normalize(),S.clone().cross(e.up).normalize();var M=c.clone().multiplyScalar(c.clone().dot(S)),T=h.clone().multiplyScalar(h.clone().dot(S)).clone().add(M);T=T.clone().length()>a?T.normalize():e.up;var C=A*(1*this.walkMultiplier),P=T,D=Math.cos(.65);1!=D&&(l.clone().dot(e.up)<-a&&l.clone().dot(S)<-D||l.clone().dot(e.up)>a&&l.clone().dot(S)>D)&&(P=-P);var L=-E*this.walkMultiplier*.05,I=e.up;(l.clone().dot(e.up)<-a||Math.abs(l.clone().dot(e.up))<a&&l.clone().dot(S)>a)&&(L=-L),I=l;var R=(new r.Quaternion).setFromAxisAngle(I,L);R.normalize(),(S=R.clone().rotate(S)).normalize(),e.up.copy(R.clone().rotate(e.up)),e.up.normalize(),e.position.add(P.clone().multiplyScalar(C)),this.center.copy(e.position.clone().add(S.clone().multiplyScalar(w))),(P=l).normalize(),0===C&&(C=.01),e.lookAt(this.center),m(!1)}},this.updown=function(t){if(!this.navApi.getIsLocked()){var i=G(t);o.m_amount+=i;var n=new r.Vector3(0,1,0),s=o.saveEye.clone().sub(n.clone().multiplyScalar(o.m_amount)),a=s.clone().dot(n);e.position.copy(s),a<o.minSceneBound&&e.position.add(n.clone().multiplyScalar(o.minSceneBound-a)),a>o.maxSceneBound&&e.position.add(n.clone().multiplyScalar(o.maxSceneBound-a)),this.center.copy(e.position.clone().add(o.saveCenter.clone().sub(o.saveEye))),e.lookAt(this.center),m(!1)}}}o.GlobalManagerMixin.call(c.prototype)},86157:(e,t,i)=>{"use strict";const{getGlobal:r}=i(7247),n=r();function o(){this.stop=null,this.isRunning=!0}function s(e,t,i,r,s){var a=performance.now(),l=1e3*i,h=0,c=new o;c.stop=function(){h&&n.cancelAnimationFrame(h),c.isRunning=!1},c.skip=function(){c.isRunning&&(r(t),c.stop(),s&&s())};var u=function(i){var o=(i-a)/l;o=Math.max(o,0),o=Math.min(o,1),r(e+o*(t-e)),o<1?h=n.requestAnimationFrame(u):(c.isRunning=!1,s&&s())};return u(a),c}function a(e,t,i){return(1-i)*e+i*t}function l(e){return THREE.Math.smootherstep(e,0,1)}function h(e){var t=new THREE.Vector3,i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,h=0,c=0,u=new THREE.Quaternion,d=new THREE.Quaternion,p=new THREE.Vector3,f=new THREE.Quaternion,m=new THREE.Object3D;new THREE.Matrix4;function g(e,t,i,r){Autodesk.Viewing.Navigation.prototype.orient(m,i,t,r),e.copy(m.quaternion)}this.init=function(e,a,l,p){let f=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t.copy(e.position),i.copy(e.target),r.copy(f?e.worldup:e.up),n.copy(a),o.copy(l),s.copy(f?e.worldup:p),h=t.distanceTo(i),c=n.distanceTo(o),g(u,t,i,r),g(d,n,o,s)},this.updateCamera=function(e,i){var r=l(e);i.position.lerpVectors(t,n,r),f.slerpQuaternions(u,d,r),f.normalize();var o=a(h,c,r);!function(e,t,i){p.set(0,0,-i).applyQuaternion(t),e.target.addVectors(e.position,p),p.set(0,1,0).applyQuaternion(t),e.up.copy(p)}(i,f,o),i.dirty=!0},this.updateViewerCamera=function(e,t){this.updateCamera(e,t.impl.camera),t.impl.syncCamera(),t.impl.invalidate(!0,!0)}}var c;e.exports={flyToView:function(e,t,i,r){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];c||(c=new h),i=i||2;var o=e.impl.camera;return c.init(o,t.position,t.target,t.up,n),s(0,1,i,(function(t){c.updateViewerCamera(t,e)}),r)},ShadowFader:function(e,t,i){var r=1,n=null,o=t,a=void 0,l=i;function h(t){r=t,e.impl.setGroundShadowAlpha(t)}function c(){n=null,l&&l(a)}this.shadowOn=function(){n&&a||(n&&!a&&(n.stop(),n=null),r>=1||(n=s(r,1,o*(1-r),h,c),a=!0))},this.shadowOff=function(){n&&!a||(n&&a&&(n.stop(),n=null),r<=0||(n=s(r,0,o*r,h,c),a=!1))},this.isFading=function(){return n&&n.isRunning}},lerp:a,smootherStep:l,fadeValue:s,AnimatedParam:class{constructor(e,t,i){this.setValueCb=t,this.animTime=i,this.fadeAnim=null,this.targetValue=e,this.curValue=e,t(e),this.pendingFinishedCallbacks=[]}stopAnim(){this.fadeAnim&&(this.fadeAnim.stop(),this.fadeAnim=null)}_onAnimEnded(){this.pendingFinishedCallbacks.forEach((e=>e())),this.pendingFinishedCallbacks.length=0}fadeTo(e,t){const i=this.fadeAnim&&this.fadeAnim.isRunning;if(!i&&this.curValue==e)return void(t&&t());if(t&&this.pendingFinishedCallbacks.push(t),i&&e===this.targetValue)return;this.stopAnim();this.targetValue=e,this.fadeAnim=s(this.curValue,this.targetValue,this.animTime,(e=>{e=l(e),this.curValue=e,this.setValueCb(e)}),(()=>this._onAnimEnded()))}skipAnim(){this.fadeAnim&&this.fadeAnim.skip()}setValue(e){this.stopAnim(),this.curValue=e,this.setValueCb(e)}}}},45836:(e,t,i)=>{"use strict";function r(e,t){try{WebAssembly.instantiateStreaming||(WebAssembly.instantiateStreaming=async(e,t)=>{const i=await(await e).arrayBuffer();return await WebAssembly.instantiate(i,t)})}catch(e){throw new Error("WebAssembly is not supported for the current browser.")}if(!e)throw new Error("Expecting a wasm file path.");let i=256,r=256;t&&t.memory&&(i=t.memory.initial,r=t.memory.maximum),this._wasmPath=e,this._memory=new WebAssembly.Memory({initial:i,maximum:r})}i.r(t),i.d(t,{Wasm:()=>r}),r.prototype.constructor=r,r.prototype.instantiate=function(){const e={env:{abortStackOverflow:e=>{throw new Error("overflow")},table:new WebAssembly.Table({initial:0,maximum:0,element:"anyfunc"}),__table_base:0,memory:this._memory,__memory_base:1024,STACKTOP:0,STACK_MAX:this.getBuffer().byteLength}};return new Promise(((t,i)=>{try{WebAssembly.instantiateStreaming(fetch(this._wasmPath),e).then((e=>{const i=e.instance.exports;this.proxy=i,t(i)}))}catch(e){i(e)}}))},r.prototype.getBuffer=function(){return this._memory.buffer}},93549:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CONSOLIDATION_MEMORY_LIMIT:()=>s,ENABLE_PIXEL_CULLING:()=>u,GEOMETRY_OVERHEAD:()=>h,GPU_MEMORY_LIMIT:()=>n,GPU_OBJECT_LIMIT:()=>o,PIXEL_CULLING_THRESHOLD:()=>c,USE_VAO:()=>l,disableGpuObjectLimit:()=>a});var r=i(7247);let n=1024*((0,r.isMobileDevice)()?64:256)*1024,o=(0,r.isMobileDevice)()?2500:1e4,s=n/2;const a=function(){o=4294967295};let l=!(0,r.isMobileDevice)();const h=336,c=.75,u=!0},36671:(e,t,i)=>{"use strict";i.d(t,{Q:()=>l});var r=i(75050),n=i(59047),o=i.n(n),s=i(2867),a=i.n(s);let l={uniforms:{color1:{type:"v3",value:new r.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new r.Vector3(1/255,2/255,3/255)},opacity:{type:"f",value:1},envMap:{type:"t",value:null},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},uCamDir:{type:"v3",value:new r.Vector3},uCamUp:{type:"v3",value:new r.Vector3},uResolution:{type:"v2",value:new r.Vector2(600,400)},uHalfFovTan:{type:"f",value:.5},envMapBackground:{type:"i",value:0},backgroundTexture:{type:"t",value:null}},vertexShader:o(),fragmentShader:a()}},45352:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BasicShader:()=>h});var r=i(75050),n=i(77221),o=i(75101),s=i.n(o),a=i(48544),l=i.n(a);let h={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.fog,r.UniformsLib.shadowmap,n.ShaderChunks.CutPlanesUniforms,n.ShaderChunks.IdUniforms,n.ShaderChunks.ThemingUniform,n.ShaderChunks.PointSizeUniforms,n.ShaderChunks.WideLinesUniforms,n.ShaderChunks.DepthTextureTestUniforms]),vertexShader:s(),fragmentShader:l()};r.ShaderLib.firefly_basic=h},5411:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CelShader:()=>h});var r=i(75050),n=i(77221),o=i(66209),s=i.n(o),a=i(40518),l=i.n(a);let h={uniforms:r.UniformsUtils.merge([n.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new r.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},tFill:{type:"t",value:null},tPaper:{type:"t",value:null},style:{type:"i",value:0},idEdges:{type:"i",value:1},normalEdges:{type:"i",value:1},depthEdges:{type:"i",value:1},brightness:{type:"f",value:0},contrast:{type:"f",value:0},grayscale:{type:"i",value:0},preserveColor:{type:"i",value:0},levels:{type:"f",value:6},repeats:{type:"f",value:3},rotation:{type:"f",value:0},outlineRadius:{type:"f",value:1},outlineNoise:{type:"i",value:0},tGraphite1:{type:"t",value:null},tGraphite2:{type:"t",value:null},tGraphite3:{type:"t",value:null},tGraphite4:{type:"t",value:null},tGraphite5:{type:"t",value:null},tGraphite6:{type:"t",value:null},tGraphite7:{type:"t",value:null},tGraphite8:{type:"t",value:null}}]),vertexShader:s(),fragmentShader:l()}},32893:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CopyShader:()=>a});var r=i(66209),n=i.n(r),o=i(67086),s=i.n(o);let a={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:n(),fragmentShader:s()}},3016:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CreateCubeMapFromColors:()=>s,DecodeEnvMap:()=>p});var r=i(75050),n=i(68940),o=i(60489);function s(e,t){for(var i=255*e.x,n=255*e.y,o=255*e.z,s=255*t.x,a=255*t.y,l=255*t.z,h=new Uint8Array(16),c=new Uint8Array(16),u=new Uint8Array(16),d=0;d<4;d++)h[4*d]=i,h[4*d+1]=n,h[4*d+2]=o,h[4*d+3]=255,c[4*d]=s,c[4*d+1]=a,c[4*d+2]=l,c[4*d+3]=255,d>1?(u[4*d]=i,u[4*d+1]=n,u[4*d+2]=o,u[4*d+3]=255):(u[4*d]=s,u[4*d+1]=a,u[4*d+2]=l,u[4*d+3]=255);var p=new r.DataTexture(u,2,2,r.RGBAFormat),f=new r.DataTexture(u,2,2,r.RGBAFormat),m=new r.DataTexture(c,2,2,r.RGBAFormat),g=new r.DataTexture(h,2,2,r.RGBAFormat),v=new r.DataTexture(u,2,2,r.RGBAFormat),y=new r.DataTexture(u,2,2,r.RGBAFormat),b=new r.Texture(null,r.CubeReflectionMapping,r.RepeatWrapping,r.RepeatWrapping,r.LinearFilter,r.LinearFilter,r.RGBAFormat);return b.image=[f,p,g,m,y,v],b.needsUpdate=!0,b}var a=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268];function l(e,t){var i=255*t[2]+t[3],r=Math.pow(2,(i-127)/2),n=r/t[1],o=t[0]*n,s=a[0]*o+a[3]*r+a[6]*n,l=a[1]*o+a[4]*r+a[7]*n,h=a[2]*o+a[5]*r+a[8]*n;s<0&&(s=0),l<0&&(l=0),h<0&&(h=0),e[0]=s,e[1]=l,e[2]=h}function h(e,t,i){var r=.0625*Math.sqrt(t[0]*i),n=.0625*Math.sqrt(t[1]*i),o=.0625*Math.sqrt(t[2]*i),s=Math.max(Math.max(r,n),Math.max(o,1e-6));s>1&&(s=1);var a=Math.ceil(255*s)/255;r>1&&(r=1),n>1&&(n=1),o>1&&(o=1),e[3]=a;var l=1/a;e[0]=r*l,e[1]=n*l,e[2]=o*l}function c(e,t,i){var r=Math.sqrt(t[0]*i),n=Math.sqrt(t[1]*i),o=Math.sqrt(t[2]*i),s=65504;r>s&&(r=s),n>s&&(n=s),o>s&&(o=s),e[0]=r,e[1]=n,e[2]=o}var u=new Float32Array(4),d=new Float32Array(4);function p(e,t,i,s){if(e.LogLuv){for(var a=Math.pow(2,t),p=Array.isArray(e.image)?e.image:[e.image],f=0;f<p.length;f++)for(var m=p[f],g=0;g<m.mipmaps.length;g++){var v,y=m.mipmaps[g],b=y.data;i?(v=new Uint16Array(b.length/4*3),y.data=v):v=b.buffer;for(var x=0,_=0;_<b.length;_+=4)u[0]=b[_]/255,u[1]=b[_+1]/255,u[2]=b[_+2]/255,u[3]=b[_+3]/255,l(d,u),i?(c(u,d,a),v[x++]=(0,n.FloatToHalf)(u[0]),v[x++]=(0,n.FloatToHalf)(u[1]),v[x++]=(0,n.FloatToHalf)(u[2])):(h(u,d,a),b[_]=Math.round(255*u[0]),b[_+1]=Math.round(255*u[1]),b[_+2]=Math.round(255*u[2]),b[_+3]=Math.round(255*u[3]))}e.LogLuv=!1,i?(e.type=r.HalfFloatType,e.format=r.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,s&&s(e)}else o.logger.warn("Environment map expected to be in LogLuv format.")}},22645:(e,t,i)=>{"use strict";i.d(t,{D:()=>c});var r=i(75050),n=i(3911),o=i.n(n),s=i(93285),a=i.n(s),l=i(86353),h={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new r.Vector4(1,1,1,1)}},vertexShader:o(),fragmentShader:a()};let c=function(e,t,i,n,o){var s,a,c,u=e,d=t,p=i||3,f=n||1,m=o.hasAlpha||!1,g=o.blending||!1,v=o.flipUV||!1;this.render=function(e,t,i){s.render(e,c,i),a.render(e,t,c)},this.setSize=function(e,t){this.cleanup(),u=e,d=t,(c=new r.WebGLRenderTarget(e,t,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:void 0!==o.format?o.format:r.RGBAFormat,type:void 0!==o.type?o.type:r.UnsignedByteType,stencilBuffer:!1})).texture.generateMipmaps=!1,s.material.defines.KERNEL_SCALE_H=a.material.defines.KERNEL_SCALE_H=(f/u).toFixed(4),s.material.defines.KERNEL_SCALE_V=a.material.defines.KERNEL_SCALE_V=(f/d).toFixed(4),s.material.needsUpdate=a.material.needsUpdate=!0},this.cleanup=function(){c&&c.dispose()},this.setColor=function(e){a.material.uniforms.uColor.value.x=e.r,a.material.uniforms.uColor.value.y=e.g,a.material.uniforms.uColor.value.z=e.b},this.setAlpha=function(e){a.material.uniforms.uColor.value.w=e},s=new l.ShaderPass(h),a=new l.ShaderPass(h),this.setSize(e,t),s.material.blending=a.material.blending=r.NoBlending,s.material.depthWrite=a.material.depthWrite=!1,s.material.depthTest=a.material.depthTest=!1,s.material.defines.HORIZONTAL=1,s.material.defines.KERNEL_RADIUS=a.material.defines.KERNEL_RADIUS=p.toFixed(1),g&&(a.material.transparent=!0,a.material.blending=r.NormalBlending),m&&(s.material.defines.HAS_ALPHA=a.material.defines.HAS_ALPHA=""),v&&(s.material.defines.FLIP_UV="")}},79646:(e,t,i)=>{"use strict";i.d(t,{S:()=>r});class r{needsClear(e,t){if(e.length!==t.length)return!0;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!0}}},36097:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GroundFlags:()=>r});var r={GROUND_UNFINISHED:0,GROUND_FINISHED:1,GROUND_RENDERED:2}},75261:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GroundReflection:()=>f});var r=i(86353),n=i(22645),o=i(36671),s=i(66209),a=i.n(s),l=i(24687),h=i.n(l),c=i(79646),u=i(36097),d=i(75050),p={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:a(),fragmentShader:h()};let f=function(e,t,i,s){var a,l,h,c,f,m,g=e,v=g.getContext(),y=t||512,b=i||512,x=!1,_=new d.Color(0,0,0),E=!1,A=!1;this.inTarget=void 0,this.outTarget=void 0;var S,w,M,T,C,P=!0,D=u.GroundFlags.GROUND_UNFINISHED,L={color:new d.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/18};if(this.setTransform=function(e,t,i){c=e,h.normal=t,h.constant=-e.dot(t)},this.cleanup=function(){a&&a.cleanup(),this.inTarget&&this.inTarget.dispose(),this.outTarget&&this.outTarget.dispose()},this.setSize=function(e,t){y=e,b=t,this.cleanup(),this.inTarget=new d.WebGLRenderTarget(y*L.texScale,b*L.texScale,{magFilter:d.LinearFilter,minFilter:d.LinearFilter,format:d.RGBAFormat,stencilBuffer:!1}),this.inTarget.texture.generateMipmaps=!1,this.inTarget.name="GroundReflection inTarget",this.outTarget=new d.WebGLRenderTarget(y*L.texScale,b*L.texScale,{magFilter:d.LinearFilter,minFilter:d.LinearFilter,format:d.RGBAFormat,stencilBuffer:!1}),this.outTarget.texture.generateMipmaps=!1,this.outTarget.name="GroundReflection outTarget",a?a.setSize(y*L.texScale*L.blurTexScale,b*L.texScale*L.blurTexScale):a=new n.D(y*L.texScale*L.blurTexScale,b*L.texScale*L.blurTexScale,L.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})},this.updateCamera=function(e){var t;t=e.isPerspective?c.clone():e.target.clone();var i=e.position.clone().sub(t).normalize(),r=Math.PI/2-i.angleTo(h.normal);if(!(x=r<0)){if(L.fadeAngle>0){var n=Math.min(L.fadeAngle,r)/L.fadeAngle;a.setAlpha(n*L.alpha)}var o,s,l,u=(s=(o=h).normal,l=o.constant,(new d.Matrix4).set(1-2*s.x*s.x,-2*s.y*s.x,-2*s.x*s.z,-2*l*s.x,-2*s.x*s.y,1-2*s.y*s.y,-2*s.y*s.z,-2*l*s.y,-2*s.x*s.z,-2*s.y*s.z,1-2*s.z*s.z,-2*l*s.z,0,0,0,1));(f=e.clone()).applyMatrix4(u),f.projectionMatrix.elements[5]*=-1,f.matrixWorldNeedsUpdate=!0,e.worldUpTransform?f.worldUpTransform=e.worldUpTransform.clone():f.worldUpTransform=new d.Matrix4}},this.renderIntoReflection=function(e){x||(g.setRenderTarget(this.inTarget),g.render(e,f))},this.prepareGroundReflection=(w=[],M=0,T=0,C=0,function(e,t,i,r,n,o){var s=t.modelQueue();if(D!==u.GroundFlags.GROUND_UNFINISHED||s.isEmpty())return D=u.GroundFlags.GROUND_FINISHED,n;const a=s.getGeomScenesPerModel();if(P=this.needsClear(w,a)||P){if(P=!1,this.updateCamera(t.camera),this.isGroundCulled())return D=u.GroundFlags.GROUND_FINISHED,n;this.clear(),w=a,S=s.getGeomScenes(),M=S.length,T=0,C=r?Math.max(Math.ceil(M/100),r):M,D=u.GroundFlags.GROUND_UNFINISHED}else{if(D!==u.GroundFlags.GROUND_UNFINISHED)return D=u.GroundFlags.GROUND_FINISHED,n;0===r&&(C=M)}var l,h,c;n&&(l=performance.now(),h=(o=void 0===o?1:o)*n);for(var d=0;d<C&&T<M;){var p=S[T++];if(p&&(d++,p.forceVisible=!0,this.renderIntoReflection(p),p.forceVisible=!1,n)){var f=performance.now()-l;if(h<f&&T<M){D=u.GroundFlags.GROUND_UNFINISHED,c=n-f;break}}}return T<M&&(D=u.GroundFlags.GROUND_UNFINISHED,c=n?n-performance.now()+l:1),void 0===c||i?(this.postprocess(t.camera,t.matman()),e&&e.enabled&&t.renderGroundShadow(this.outTarget),this.renderReflection(t.camera,t.renderer().getColorTarget()),void 0===c&&(D=u.GroundFlags.GROUND_RENDERED),n?n-performance.now()+l:1):c}),this.renderReflection=function(e,t){x||(v.depthRange(.999999,1),l.render(g,t,this.outTarget),v.depthRange(0,1))},this.toggleEnvMapBackground=function(e){A=e,m.uniforms.envMapBackground.value=e},this.postprocess=function(e){if(!x){if(E||A){const t=m.uniforms.uCamDir.value||new d.Vector3;m.uniforms.uCamDir.value=e.worldUpTransform?e.getWorldDirection(t).applyMatrix4(e.worldUpTransform):e.getWorldDirection(t),m.uniforms.uCamUp.value=e.worldUpTransform?e.up.clone().applyMatrix4(e.worldUpTransform):e.up,m.uniforms.uResolution.value.set(y,b),m.uniforms.uHalfFovTan.value=Math.tan(d.Math.degToRad(.5*e.fov)),m.render(g,this.outTarget),g.setRenderTarget(this.outTarget),g.clear(!1,!0,!1)}else g.setClearColor(_,1),g.setRenderTarget(this.outTarget),g.clear(!0,!0,!1);a.render(g,this.outTarget,this.inTarget)}},this.clear=function(){g.setClearColor(_,0),g.setRenderTarget(this.inTarget),g.clear(!0,!0,!1),g.clearBlend()},this.setClearColors=function(e,t,i){t?(_.setRGB(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)),E=!e.equals(t)&&!i):(_.copy(e),E=!1),E&&(m.uniforms.color1.value.copy(e),m.uniforms.color2.value.copy(t))},this.setEnvRotation=function(e){m.material.envRotationSin=Math.sin(e),m.material.envRotationCos=Math.cos(e)},this.isGroundCulled=function(){return x},this.getStatus=function(){return D},this.setDirty=function(){P=!0,D=u.GroundFlags.GROUND_UNFINISHED},this.setColor=function(e){a.setColor(L.color),L.color.set(e)},this.setAlpha=function(e){a.setAlpha(L.alpha),L.alpha=e},s)for(var I in L)L[I]=void 0!==s[I]?s[I]:L[I];(l=new r.ShaderPass(p)).material.blending=d.NoBlending,l.material.depthTest=!0,l.material.depthWrite=!1,l.scene.position.z=-.999999,s.clearPass?m=s.clearPass:((m=new r.ShaderPass(o.Q)).material.blending=d.NoBlending,m.material.depthWrite=!1,m.material.depthTest=!1),this.setSize(y,b),a.setAlpha(L.color),a.setAlpha(L.alpha),h=new d.Plane(new d.Vector3(0,1,0),0),c=new d.Vector3(0,0,0)};f.prototype=c.S.prototype,f.prototype.constructor=f},93666:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GroundShadow:()=>N,createGroundShape:()=>R,setGroundShapeTransform:()=>O});var r=i(92217),n=i(86353),o=i(40520),s=i.n(o),a=i(57165),l=i.n(a),h=i(66209),c=i.n(h),u=i(24009),d=i.n(u),p=i(8242),f=i.n(p),m=i(14810),g=i.n(m),v=i(79646),y=i(36097),b=i(93549),x=i(86437),_=i(60812),E=i(33736),A=i(75050);const S=2;var w={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:s(),fragmentShader:l()},M={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new A.Vector3(1,1,1)}},defines:{},vertexShader:c(),fragmentShader:d()},T={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:c(),fragmentShader:f()},C={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new A.Vector4(0,0,0,1)}},vertexShader:c(),fragmentShader:g()};let P,D,L,I=new _.LmvBox3;function R(e){var t=new A.PlaneBufferGeometry(1,1);return t.index.array.reverse(),new A.Mesh(t,e)}function O(e,t,i,r,n){P||(P=new A.Matrix4),D||(D=new A.Vector3),L||(L=new A.Vector3),D.subVectors(t,r),P.lookAt(D,t,n),L.copy(r).multiplyScalar(-.5*i.y).add(t),e.position.copy(L),e.rotation.setFromRotationMatrix(P),e.scale.set(i.z,i.x,i.y)}function N(e,t){var i,o=e;const s=new x.FrustumIntersector;var a,l,h,c,u,d,p,f,m,g,v,_,P,D,L,N,F,k,V,U=!1,B=!0,G=y.GroundFlags.GROUND_FINISHED,z={texSize:64,pixScale:1,blurRadius:7,debug:!1};if(this.setTransform=(v=new A.Vector3(0,0,0),_=new A.Vector3(0,0,0),P=new A.Vector3(0,0,0),D=new A.Vector3(0,0,0),function(e,t,r,n){e.equals(v)&&t.equals(_)&&r.equals(P)&&n.equals(D)||(v.copy(e),_.copy(t),P.copy(r),D.copy(n),this.setDirty(),i.left=-t.z/2,i.right=t.z/2,i.top=t.x/2,i.bottom=-t.x/2,i.near=1,i.far=t.y+i.near,i.updateProjectionMatrix(),O(l,e,t,r,n),i.position.addVectors(e,r.clone().multiplyScalar(-t.y/2-i.near)),n&&i.up.set(n.x,n.y,n.z),i.lookAt(e),z.debug&&(g.position.set(e.x,e.y,e.z),g.rotation.set(i.rotation.x,i.rotation.y,i.rotation.z),g.scale.set(t.z,t.x,t.y)),m.uniforms.worldSize.value.copy(t),i.orthoScale=t.x,i.clientHeight=z.texSize,s.reset(i),s.areaCullThreshold=S)}),this.renderIntoShadow=function(e){if(!e.overrideMaterial||!e.overrideMaterial.transparent){e.forEachNoMesh&&b.ENABLE_PIXEL_CULLING&&(e.forEachNoMesh((t=>{e.frags.getWorldBounds(t,I);const i=e.frags.vizflags[t]&E.MeshFlags.MESH_VISIBLE,r=s.estimateProjectedDiameter(I)<s.areaCullThreshold;e.frags.setFlagFragment(t,E.MeshFlags.MESH_RENDERFLAG,i&&!r)})),e.forceVisible=!1);var t=e.overrideMaterial;e.overrideMaterial=u,o.setRenderTarget(h),o.render(e,i),e.overrideMaterial=t}},this.prepareGroundShadow=(N=[],F=0,k=0,V=0,function(e,t,i,r){if(!this.enabled||e.isEmpty())return G=y.GroundFlags.GROUND_FINISHED,i;const n=e.getGeomScenesPerModel();if(B=this.needsClear(N,n)||B)this.clear(),B=!1,N=n,L=e.getGeomScenes(),F=L.length,k=0,V=t?Math.max(Math.ceil(F/100),t):F;else{if(G===y.GroundFlags.GROUND_RENDERED||G===y.GroundFlags.GROUND_FINISHED)return G=y.GroundFlags.GROUND_FINISHED,i;0===t&&(V=F)}var o,a,l;i&&(o=performance.now(),a=(r=void 0===r?1:r)*i);for(var h=0;h<V&&k<F;){var c=L[k++];if(c&&(!(b.ENABLE_PIXEL_CULLING&&c.getBoundingBox&&s.estimateProjectedDiameter(c.getBoundingBox())<s.areaCullThreshold)&&(h++,c.forceVisible=!0,this.renderIntoShadow(c),c.forceVisible=!1,i))){var u=performance.now()-o;if(a<u){G=y.GroundFlags.GROUND_UNFINISHED,l=i-u;break}}}return k<F&&(G=y.GroundFlags.GROUND_UNFINISHED,l=i?i-performance.now()+o:1),void 0!==l?l:(this.postprocess(),G=y.GroundFlags.GROUND_RENDERED,i?i-performance.now()+o:1)}),this.renderShadow=function(e,t){U&&(t&&o.setRenderTarget(t),o.render(a,e))},this.postprocess=function(){f.render(o,c,h),p.render(o,h,c),U=!0},this.clear=function(){var e=o.getClearColor(new A.Color).getHex(),t=o.getClearAlpha();o.setClearColor(0,0),o.setRenderTarget(h),o.clear(!0,!0,!1),o.setClearColor(e,t),o.clearBlend(),U=!1},this.setColor=function(e){d.uniforms.uShadowColor.value.x=e.r,d.uniforms.uShadowColor.value.y=e.g,d.uniforms.uShadowColor.value.z=e.b},this.getColor=function(){return new A.Color(d.uniforms.uShadowColor.value.x,d.uniforms.uShadowColor.value.y,d.uniforms.uShadowColor.value.z)},this.setAlpha=function(e){d.uniforms.uShadowColor.value.w=e},this.getAlpha=function(){return d.uniforms.uShadowColor.value.w},this.isValid=function(){return U},this.getStatus=function(){return G},this.setDirty=function(){B=!0,G=y.GroundFlags.GROUND_UNFINISHED},this.getDepthMaterial=function(){return u},t)for(var H in z)z[H]=t[H]||z[H];a=new A.Scene,i=new A.OrthographicCamera,(h=new A.WebGLRenderTarget(z.texSize,z.texSize,{minFilter:A.LinearFilter,magFilter:A.LinearFilter,format:A.RGBAFormat,stencilBuffer:!1})).texture.generateMipmaps=!1,h.name="GroundShadow targetH",(c=new A.WebGLRenderTarget(z.texSize,z.texSize,{minFilter:A.LinearFilter,magFilter:A.LinearFilter,format:A.RGBAFormat,stencilBuffer:!1})).texture.generateMipmaps=!1,c.name="GroundShadow targetV",(u=(0,r.createShaderMaterial)(w)).type="GroundDepthShader",u.side=A.DoubleSide,u.blending=A.NoBlending,p=new n.ShaderPass(T,"tDepth"),f=new n.ShaderPass(T,"tDepth"),m=new n.ShaderPass(M,"tDepth"),p.material.defines.KERNEL_SCALE=f.material.defines.KERNEL_SCALE=(z.pixScale/z.texSize).toFixed(4),p.material.defines.KERNEL_RADIUS=f.material.defines.KERNEL_RADIUS=z.blurRadius.toFixed(2),m.material.blending=p.material.blending=f.material.blending=A.NoBlending,m.material.depthWrite=p.material.depthWrite=f.material.depthWrite=!1,m.material.depthTest=p.material.depthTest=f.material.depthTest=!1,p.material.defines.HORIZONTAL=1,(d=(0,r.createShaderMaterial)(C)).uniforms.tDepth.value=h.texture,d.depthWrite=!1,d.transparent=!0,l=R(d),a.add(l),z.debug&&(g=new A.Mesh(new A.BoxGeometry(1,1,1),new A.MeshBasicMaterial({color:65280,wireframe:!0})),a.add(g)),this.setTransform(new A.Vector3(0,0,0),new A.Vector3(1,1,1),new A.Vector3(0,1,0),A.Object3D.DefaultUp)}N.prototype=v.S.prototype,N.prototype.constructor=N},68940:(e,t,i)=>{"use strict";i.r(t),i.d(t,{FloatToHalf:()=>a,HALF_INT_MAX:()=>h,HalfTest:()=>d,HalfToFloat:()=>l,HalfToInt:()=>u,IntToHalf:()=>c});var r=new Float32Array(1),n=new Uint32Array(r.buffer),o=new Uint16Array(1),s=new Uint16Array(1);let a=function(e){r[0]=e;var t=n[0],i=0;if(0==(2147483647&t))s[i++]=t>>16;else{var a=2147483648&t,l=2139095040&t,h=8388607&t;if(0===l)s[i++]=a>>16;else if(2139095040==l)s[i++]=0===h?a>>16|31744:65024;else{var c,u,d=a>>16,p=(0|l>>23)-127+15;p>=31?s[i++]=a>>16|31744:p<=0?(14-p>24?c=0:(c=(h|=8388608)>>14-p,o[0]=c,c=o[0],h>>13-p&1&&(c+=1)),s[i++]=d|c):(u=p<<10,o[0]=u,u=o[0],c=h>>13,o[0]=c,c=o[0],s[i++]=4096&h?1+(d|u|c):d|u|c)}}return s[0]},l=function(e){var t,i=65535&e;if(0==(32767&i))t=i<<16;else{var o=32768&i,s=31744&i,a=1023&i;if(0===s){var l=-1;do{l++,a<<=1}while(0==(1024&a));var h=o<<16,c=(s<<16>>26)-15+127-l,u=c<<23,d=(1023&a)<<13;t=h|u|d}else t=31744==s?0===a?o<<16|2139095040:4290772992:(h=o<<16)|(u=(c=(s<<16>>26)-15+127)<<23)|(d=a<<13)}return n[0]=t,r[0]},h=59390,c=function(e){if(e>h-1||e<0)return console.log("out of range"),a(NaN);if(0===e)return 0;var t=!1;e>h/2-1&&(t=!0,e-=h/2-1);var i=0|Math.abs(e/1024),r=Math.pow(2,i-13),n=r+(e-1024*i)*r/1024;return t&&(n=-n),a(n)},u=function(e){if(0===e)return 0;var t=l(e),i=!1;t<0&&(i=!0,t=-t);var r=0|Math.floor(Math.log(t)/Math.log(2)),n=Math.pow(2,r),o=(t-n)/n*1024+1024*(r+13);return i&&(o+=h/2-1),o},d=function(){for(var e=[-1/255,-.17,-75,-1789,-.005],t=0;t<e.length;t++)console.log("input",e[t],"encoded",a(e[t]),"decoded",l(a(e[t])));for(let e=0;e<h;e++){var i=u(c(e));i!==e&&console.log("Roundtrip failed for",e,i)}}},75469:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LineStyleDefs:()=>n,createLinePatternForDef:()=>l,createLinePatternTexture:()=>a,createLinePatternTextureData:()=>o,createLinePatternTextureFromDefs:()=>s});var r=i(75050);let n=[{id:"SOLID",name:"Solid",ascii_art:"_______________________________________",def:[1]},{id:"BORDER",name:"Border",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.5,-.25,.5,-.25,0,-.25]},{id:"BORDER2",name:"Border (.5x)",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.25,-.125,.25,-.125,0,-.125]},{id:"BORDERX2",name:"Border (2x)",ascii_art:"____  ____  .  ____  ____  .  ___",def:[1,-.5,1,-.5,0,-.5]},{id:"CENTER",name:"Center",ascii_art:"____ _ ____ _ ____ _ ____ _ ____ _ ____",def:[1.25,-.25,.25,-.25]},{id:"CENTER2",name:"Center (.5x)",ascii_art:"___ _ ___ _ ___ _ ___ _ ___ _ ___",def:[.75,-.125,.125,-.125]},{id:"CENTERX2",name:"Center (2x)",ascii_art:"________  __  ________  __  _____",def:[2.5,-.5,.5,-.5]},{id:"DASHDOT",name:"Dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . __",def:[.5,-.25,0,-.25]},{id:"DASHDOT2",name:"Dash dot (.5x)",ascii_art:"_._._._._._._._._._._._._._._.",def:[.25,-.125,0,-.125]},{id:"DASHDOTX2",name:"Dash dot (2x)",ascii_art:"____  .  ____  .  ____  .  ___",def:[1,-.5,0,-.5]},{id:"DASHED",name:"Dashed",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ _",def:[.5,-.25]},{id:"DASHED2",name:"Dashed (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.25,-.125]},{id:"DASHEDX2",name:"Dashed (2x)",ascii_art:"____  ____  ____  ____  ____  ___",def:[1,-.5]},{id:"DIVIDE",name:"Divide",ascii_art:"____ . . ____ . . ____ . . ____ . . ____",def:[.5,-.25,0,-.25,0,-.25]},{id:"DIVIDE2",name:"Divide (.5x)",ascii_art:"__..__..__..__..__..__..__..__.._",def:[.25,-.125,0,-.125,0,-.125]},{id:"DIVIDEX2",name:"Divide (2x)",ascii_art:"________  .  .  ________  .  .  _",def:[1,-.5,0,-.5,0,-.5]},{id:"DOT",name:"Dot",ascii_art:". . . . . . . . . . . . . . . . . . . . . . . .",def:[0,-.25]},{id:"DOT2",name:"Dot (.5x)",ascii_art:"........................................",def:[0,-.125]},{id:"DOTX2",name:"Dot (2x)",ascii_art:".  .  .  .  .  .  .  .  .  .  .  .  .  .",def:[0,-.5]},{id:"HIDDEN",name:"Hidden",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ __",def:[.25,-.125]},{id:"HIDDEN2",name:"Hidden (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.125,-.0625]},{id:"HIDDENX2",name:"Hidden (2x)",ascii_art:"____ ____ ____ ____ ____ ____ ____",def:[.5,-.25]},{id:"PHANTOM",name:"Phantom",ascii_art:"______  __  __  ______  __  __  ______",def:[1.25,-.25,.25,-.25,.25,-.25]},{id:"PHANTOM2",name:"Phantom (.5x)",ascii_art:"___ _ _ ___ _ _ ___ _ _ ___ _ _",def:[.625,-.125,.125,-.125,.125,-.125]},{id:"PHANTOMX2",name:"Phantom (2x)",ascii_art:"____________    ____    ____   _",def:[2.5,-.5,.5,-.5,.5,-.5]},{id:"ACAD_ISO02W100",name:"ISO dash",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __",def:[12,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO03W100",name:"ISO dash space",ascii_art:"__    __    __    __    __    __",def:[12,-18],pen_width:1,unit:"mm"},{id:"ACAD_ISO04W100",name:"ISO long-dash dot",ascii_art:"____ . ____ . ____ . ____ . _",def:[24,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO05W100",name:"ISO long-dash double-dot",ascii_art:"____ .. ____ .. ____ .",def:[24,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO06W100",name:"ISO long-dash triple-dot",ascii_art:"____ ... ____ ... ____",def:[24,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO07W100",name:"ISO dot",ascii_art:". . . . . . . . . . . . . . . . . . . .",def:[.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO08W100",name:"ISO long-dash short-dash",ascii_art:"____ __ ____ __ ____ _",def:[24,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO09W100",name:"ISO long-dash double-short-dash",ascii_art:"____ __ __ ____",def:[24,-3,6,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO10W100",name:"ISO dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . ",def:[12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO11W100",name:"ISO double-dash dot",ascii_art:"__ __ . __ __ . __ __ . __ _",def:[12,-3,12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO12W100",name:"ISO dash double-dot",ascii_art:"__ . . __ . . __ . . __ . .",def:[12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO13W100",name:"ISO double-dash double-dot",ascii_art:"__ __ . . __ __ . . _",def:[12,-3,12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO14W100",name:"ISO dash triple-dot",ascii_art:"__ . . . __ . . . __ . . . _",def:[12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO15W100",name:"ISO double-dash triple-dot",ascii_art:"__ __ . . . __ __ . .",def:[12,-3,12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"FENCELINE1",name:"Fenceline circle",ascii_art:"----0-----0----0-----0----0-----0--",def:[.25,-.1,["CIRC1","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"FENCELINE2",name:"Fenceline square",ascii_art:"----[]-----[]----[]-----[]----[]---",def:[.25,-.1,["BOX","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"TRACKS",name:"Tracks",ascii_art:"-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-",def:[.15,["TRACK1","ltypeshp.shx","s=.25"],.15]},{id:"BATTING",name:"Batting",ascii_art:"SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",def:[1e-4,-.1,["BAT","ltypeshp.shx","x=-.1","s=.1"],-.2,["BAT","ltypeshp.shx","r=180","x=.1","s=.1"],-.1]},{id:"HOT_WATER_SUPPLY",name:"Hot water supply",ascii_art:"---- HW ---- HW ---- HW ----",def:[.5,-.2,["HW","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.2]},{id:"GAS_LINE",name:"Gas line",ascii_art:"----GAS----GAS----GAS----GAS----GAS----GAS--",def:[.5,-.2,["GAS","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.25]},{id:"ZIGZAG",name:"Zig zag",ascii_art:"/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/",def:[1e-4,-.2,["ZIG","ltypeshp.shx","x=-.2","s=.2"],-.4,["ZIG","ltypeshp.shx","r=180","x=.2","s=.2"],-.2]}],o=function(e,t){for(var i=e+3,n=t,o=1;o<i;)o*=2;for(i=o,o=1;o<n;)o*=2;n=o;var s=new Uint8Array(i*n),a=new r.DataTexture(s,i,n,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter,0);return a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,{tex:s,pw:i,ph:n,lineStyleTex:a}},s=function(e){for(var t=e.length,i=0,r=0;r<t;r++){var n=e[r];n.def.length>i&&(i=n.def.length)}let{tex:s,pw:a,lineStyleTex:h}=o(i,t);for(var c=0;c<t;c++){let t=e[c];l(t,s,c,a)}return h},a=function(){return s(n)},l=function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:96;for(var o=i*r,s=e.unit&&"mm"==e.unit?1/25.4:1,a=e.pen_width||0,l=e.def,h=0,c=0;c<l.length;c++){var u=Math.abs(l[c]);u<=.5*a&&(u=0);var d=0|u*n*s;h+=d,t[o+c+2]=d||1}t[o]=h%256,t[o+1]=h/256,t[o+l.length+2]=0}},8544:(e,t,i)=>{"use strict";i.d(t,{I5:()=>n,ZP:()=>r,p1:()=>o});class r{constructor(){this.webglContextId=1}onContextRestored(){this.webglContextId++}refreshTargetIfNeeded(e){this.refreshIfNeeded(e);const t=null==e?void 0:e.shareDepthFrom;this.refreshIfNeeded(t)}refreshTargetsIfNeeded(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.refreshTargetIfNeeded(e[t]);else this.refreshTargetIfNeeded(e)}refreshIfNeeded(e){if(!e||e.__webglContextId===this.webglContextId)return!1;this._refreshGlData(e),e.__webglContextId=this.webglContextId}_refreshGlData(e){e instanceof THREE.Mesh&&this._refreshMeshGlData(e),e instanceof THREE.BufferGeometry&&this._refreshBufferGeometryGlData(e),e instanceof THREE.WebGLRenderTarget&&this._refreshTargetGlData(e),e instanceof THREE.Texture&&this._refreshTextureGlData(e),e instanceof THREE.Material&&this._refreshMaterialGlData(e)}_refreshMeshGlData(e){var t;e.__webglActive&&(e.__webglActive=void 0),null!==(t=e.geometry)&&void 0!==t&&t.__webglInit&&(e.geometry.__webglInit=void 0)}_refreshBufferGeometryGlData(e){e.__webglInit&&(e.__webglInit=void 0,e.needsUpdate=!0),e.vbbuffer&&(e.vbbuffer=void 0,e.needsUpdate=!0),e.ibbuffer&&(e.ibbuffer=void 0,e.needsUpdate=!0),e.iblinesbuffer&&(e.iblinesbuffer=void 0,e.needsUpdate=!0),e.vaos&&(e.vaos=void 0,e.needsUpdate=!0);for(let t in e.attributes){const i=e.attributes[t];i.buffer&&(i.buffer=void 0,e.needsUpdate=!0)}}_refreshTargetGlData(e){e.__webglFramebuffer&&(e.__webglFramebuffer=null),e.__webglRenderbuffer&&(e.__webglRenderbuffer=null),e.__webglBoundBuffers&&(e.__webglBoundBuffers=null),e.__webglTexture&&(e.__webglTexture=null)}_refreshTextureGlData(e){e.__webglInit&&(e.__webglInit=void 0,e.needsUpdate=!0),e.__webglTexture&&(e.__webglTexture=void 0,e.needsUpdate=!0),e.__webglTextureCube&&(e.__webglTextureCube=null,e.needsUpdate=!0)}_refreshMaterialGlData(e){(e.program||e.programs)&&(e.program=null,e.programs=[],e.needsUpdate=!0)}}const n=e=>{const t={};return e.getAllModels().forEach((e=>{e.isConsolidated()&&(e.unconsolidate(),t[e.id]=!0)})),t},o=(e,t)=>{e.getAllModels().forEach((i=>{t[i.id]&&e.impl.consolidateModel(i)}))}},11466:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MaterialConverter:()=>s});var r=i(75050),n=i(51440);const o=Autodesk.Viewing;let s={convertMaterial:async function(e,t,i,o){if(h(e))return await a(),i=s.convertPrismMaterial(e,t,i,o),e.transparent=i.transparent,i;o=o||e.userassets;var c,u,d=e.materials,p=d[o],f=p.properties;if(i){if(!(i instanceof r.MeshPhongMaterial))return null;i.needsUpdate=!0}else i=new r.MeshPhongMaterial;if(i.proteinMat=e,i.proteinCategories=p.categories,i.packedNormals=!0,p&&"SimplePhong"===p.definition){i.tag=p.tag,i.proteinType=p.proteinType,void 0===i.proteinType&&(i.proteinType=null);var m=(0,n.parseMaterialBoolean)(f,"generic_baked_lighting",!1);i.disableEnvMap=m;var g=i.ambient=(0,n.parseMaterialColor)(f,"generic_ambient"),v=i.color=(0,n.parseMaterialColor)(f,"generic_diffuse"),y=i.specular=(0,n.parseMaterialColor)(f,"generic_specular"),b=i.emissive=(0,n.parseMaterialColor)(f,"generic_emissive");i.shininess=(0,n.parseMaterialScalar)(f,"generic_glossiness",30),i.opacity=1-(0,n.parseMaterialScalar)(f,"generic_transparency",0),i.reflectivity=(0,n.parseMaterialScalar)(f,"generic_reflectivity_at_0deg",0);var x=(0,n.parseMaterialBoolean)(f,"generic_bump_is_normal"),_=(0,n.parseMaterialScalar)(f,"generic_bump_amount",0);null==_&&(_=1),x?(_>1&&(_=1),i.normalScale=new r.Vector2(_,_)):(_>=1&&(_=.03),i.bumpScale=_);var E=(0,n.parseMaterialBoolean)(f,"generic_is_metal");void 0!==E&&(i.metal=E);var A=(0,n.parseMaterialBoolean)(f,"generic_backface_cull");void 0===A||A||(i.side=r.DoubleSide),i.transparent=p.transparent,i.textureMaps={};var S=p.textures;for(var w in S)if((c={}).textureObj=d[S[w].connections[0]],u=c.textureObj.properties,c.textureObj.matrix=l(c.textureObj),c.uriPointer=u.uris.unifiedbitmap_Bitmap.values,c.uri=c.uriPointer[0],c.uri){if("generic_diffuse"==w)c.mapName="map",(!i.color||0===i.color.r&&0===i.color.g&&0===i.color.b)&&i.color.setRGB(1,1,1);else if("generic_bump"==w)c.mapName=x?"normalMap":"bumpMap";else if("generic_specular"==w)c.mapName="specularMap";else{if("generic_alpha"!=w)continue;c.mapName="alphaMap",i.side=r.DoubleSide,i.transparent=!0}i.textureMaps[c.mapName]=c}0===v.r&&0===v.g&&0===v.b&&0===y.r&&0===y.g&&0===y.b&&0===g.r&&0===g.g&&0===g.b&&0===b.r&&0===b.g&&0===b.b&&(v.r=v.g=v.b=.4),i.extraDepthOffset=(0,n.parseMaterialScalar)(f,"generic_depth_offset"),i.extraDepthOffset&&(i.polygonOffset=!0,i.polygonOffsetFactor=i.extraDepthOffset,i.polygonOffsetUnits=0)}else i.ambient=new r.Color(197379),i.color=new r.Color(7829367),i.specular=new r.Color(3355443),i.shininess=30,i.shading=r.SmoothShading;return e.transparent=i.transparent,i},convertTexture:function(e,t,i,o){"bumpMap"==e.mapName||"normalMap"==e.mapName?t.anisotropy=0:t.anisotropy=o||0;t.flipY=void 0===e.flipY||e.flipY,t.invert=!1,t.wrapS=r.RepeatWrapping,t.wrapT=r.RepeatWrapping,t.offset=e.offset??t.offset,t.rotation=e.rotation??t.rotation??0,t.repeat=e.repeat??t.repeat,e.isPrism?s.convertPrismTexture(e.textureObj,t,i):function(e,t){if(!e)return;var i=e.properties;t.invert=(0,n.parseMaterialBoolean)(i,"unifiedbitmap_Invert"),t.clampS=!(0,n.parseMaterialBoolean)(i,"texture_URepeat",!0),t.clampT=!(0,n.parseMaterialBoolean)(i,"texture_VRepeat",!0),t.wrapS=t.clampS?r.ClampToEdgeWrapping:r.RepeatWrapping,t.wrapT=t.clampT?r.ClampToEdgeWrapping:r.RepeatWrapping,t.matrix=e.matrix||(e.matrix=(0,n.Get2DSimpleMapTransform)(i))}(e.textureObj,t)},isPrismMaterial:h,convertMaterialGltf:function(e,t){var i=new r.MeshPhongMaterial({name:e.name??""});i.packedNormals=!0,i.textureMaps={},i.reflectivity=0;var n=e.pbrMetallicRoughness||{},o=n.baseColorTexture||n.baseColorFactor;if(o)if(Array.isArray(o))i.color=new r.Color(o[0],o[1],o[2]),i.opacity=o[3];else if("object"==typeof o){i.color=new r.Color(1,1,1);var s={mapName:"map"},a=t.gltf.textures[o.index];s.uri=t.gltf.images[a.source].uri,s.flipY=!1,i.textureMaps[s.mapName]=s,u(o,s)}var l=n.metallicRoughnessTexture;if(l){s={mapName:"metallicRoughnessTexture"},a=t.gltf.textures[l.index];s.uri=t.gltf.images[a.source].uri,s.flipY=!1,i.textureMaps[s.mapName]=s,u(l,s)}else i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1;!0===e.doubleSided&&(i.side=r.DoubleSide);var h=e.alphaMode||c.OPAQUE;h===c.BLEND?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,h===c.MASK&&(i.alphaTest=void 0!==e.alphaCutoff?e.alphaCutoff:.5));if(void 0!==e.normalTexture){s={mapName:"normalTexture"},a=t.gltf.textures[e.normalTexture.index];s.uri=a.source,s.flipY=!1,s.uri=t.gltf.images[a.source].uri,u(e.normalTexture,s),i.normalScale=s.repeat,void 0!==e.normalTexture.scale&&i.normalScale.set(e.normalTexture.scale,e.normalTexture.scale)}if(void 0!==e.occlusionTexture){s={mapName:"occlusionTexture"},a=t.gltf.textures[e.occlusionTexture.index];s.uri=t.gltf.images[a.source].uri,s.flipY=!1,i.textureMaps[s.mapName]=s,void 0!==e.occlusionTexture.strength&&(i.aoMapIntensity=e.occlusionTexture.strength),u(e.occlusionTexture,s)}void 0!==e.emissiveFactor&&(i.emissive=(new r.Color).fromArray(e.emissiveFactor));if(void 0!==e.emissiveTexture){s={mapName:"emissiveTexture"},a=t.gltf.textures[e.emissiveTexture.index];s.uri=t.gltf.images[a.source].uri,s.flipY=!1,i.textureMaps[s.mapName]=s,u(e.emissiveTexture,s)}return i},applyAppearanceHeuristics:function(e,t,i){var n=e.proteinMat?e.proteinMat:null,o=e.prismType&&-1!==e.prismType.indexOf("Prism");o&&e.transparent&&(e.side===r.FrontSide&&"PrismGlazing"!==e.prismType&&(e.side=r.DoubleSide),e.side===r.DoubleSide&&e.depthTest&&(e.twoPassTransparency=!0));var s=e.textureMaps||{};if(!t){var a,l=e.proteinType&&-1!==e.proteinType.indexOf("Prism");if(e.metal)e.reflectivity||(e.reflectivity=d(e.specular)),n&&(1===e.reflectivity&&(e.reflectivity=d(e.specular)),0===e.color.r&&0===e.color.g&&0===e.color.b||(e.color.r*=.1,e.color.g*=.1,e.color.b*=.1));else if(l){var h=!1;if("PrismLayered"===e.proteinType){e.clearcoat=!0,e.reflectivity=.06;var c=e.proteinCategories;c&&c.length&&-1!=c[0].indexOf("Metal")&&(h=!0)}e.reflectivity=Math.sqrt(e.reflectivity),h?e.specular.copy(e.color):(e.specular.r=e.reflectivity,e.specular.g=e.reflectivity,e.specular.b=e.reflectivity)}else e.reflectivity?e.reflectivity>.3?(e.metal=!0,e.specular.r=e.color.r,e.specular.g=e.color.g,e.specular.b=e.color.b,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1):(e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):1!==e.color.r||1!==e.color.g||1!==e.color.b||1!==e.specular.r||1!==e.specular.g||1!==e.specular.b||s.map||s.specularMap?(e.reflectivity=.01+.06*d(e.specular),e.specular.r*=e.reflectivity,e.specular.g*=e.reflectivity,e.specular.b*=e.reflectivity):(e.metal=!0,e.reflectivity=.7,e.color.r*=.1,e.color.g*=.1,e.color.b*=.1),e.opacity<1&&(e.reflectivity=1);(e.transparent||-1!==(null===(a=s.map)||void 0===a||null===(a=a.uri)||void 0===a?void 0:a.toLowerCase().indexOf(".png"))||s.alphaMap)&&(e.alphaTest=.01)}if(s.normalMap){var u=e.bumpScale;(void 0===u||u>=1)&&(u=1),e.normalScale=new r.Vector2(u,u)}else(void 0===e.bumpScale&&(s.map||s.bumpMap)||e.bumpScale>=1)&&(e.bumpScale=.03);if((!t||o)&&e.transparent){if(o)e.lmv_depthWriteTransparent=!0,e.depthWrite=!!i;else if(e.opacity>=1)s.alphaMap||(e.transparency=!1);else e.lmv_depthWriteTransparent=!0,e.depthWrite=!!i}void 0!==e.shininess&&(e.shininess*=.25)},applyGeometryFlagsToMaterial:function(e,t){t.attributes.color&&(e.vertexColors=r.VertexColors,e.needsUpdate=!0);if(!e.proteinType&&t.attributes.uv&&t.attributes.uv.isPattern){var i=!1;e.map&&!e.bumpMap&&(e.bumpMap=e.map,e.needsUpdate=!0,i=!0),e.textureMaps&&e.textureMaps.map&&!e.textureMaps.bumpMap&&(e.textureMaps.bumpMap=e.textureMaps.map,e.needsUpdate=!0,i=!0),i&&void 0===e.bumpScale&&(e.bumpScale=.03)}},hasTiling:function(e){var t=e.materials[e.userassets[0]];if(t){if("TilingPattern"===t.definition)return!0}return!1},loadMaterialConverterPrismLibrary:a};async function a(){if(o.MaterialConverterPrism&&o.MaterialConverterPrism.convertPrismMaterial||await o.theExtensionManager.downloadExtension("Autodesk.Viewing.MaterialConverterPrism"),!s.convertPrismMaterial)for(let e in o.MaterialConverterPrism)s[e]=o.MaterialConverterPrism[e]}function l(e){return e.matrix||(e.matrix=(0,n.Get2DSimpleMapTransform)(e.properties)),e.matrix}function h(e){var t=e.materials,i=t[e.userassets[0]];if(i){var r=i.definition;if("TilingPattern"===r)(i=t[i.properties.references.grout_material.connections[0]])&&(r=i.definition);return"PrismLayered"===r||"PrismMetal"===r||"PrismOpaque"===r||"PrismTransparent"===r||"PrismGlazing"===r||"PrismWood"===r}return!1}var c={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function u(e,t){var i;t.offset=new r.Vector2(0,0),t.repeat=new r.Vector2(1,1),t.rotation=0;const n=null===(i=e.extensions)||void 0===i?void 0:i.KHR_texture_transform;if(n&&"object"==typeof n){const{scale:e,offset:i,rotation:o}=n;i&&(t.offset=new r.Vector2(i[0],i[1])),e&&(t.repeat=new r.Vector2(e[0],e[1])),o&&(t.rotation=o)}}function d(e){return.299*e.r+.587*e.g+.114*e.b}},51440:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Get2DSimpleMapTransform:()=>c,MaterialConverterCommon:()=>u,SRGBToLinear:()=>h,SRGBToLinearFloat:()=>l,parseMaterialBoolean:()=>s,parseMaterialColor:()=>n,parseMaterialGeneric:()=>a,parseMaterialScalar:()=>o});var r=i(75050);function n(e,t,i){if(!e||!e.colors)return new r.Color(1,0,0);var n=e.colors[t];if(!n)return new r.Color(0,0,0);var o=n.values;if(!o||!o.length)return new r.Color(1,0,0);var s=o[0];return new r.Color(s.r,s.g,s.b)}function o(e,t,i){if(!e||!e.scalars)return i;var r=e.scalars[t];return r?r.values[0]:i}function s(e,t,i){if(!e||!e.booleans)return i;var r=e.booleans[t];return void 0===r?i:r}function a(e,t,i,r){if(!e||!e[t])return r;var n=e[t][i];return n?n.values[0]:r}function l(e){var t=e;return t<=.04045?t/=12.92:t=Math.pow((t+.055)/1.055,2.4),t}function h(e){var t,i,n;return t=l(e.r),i=l(e.g),n=l(e.b),new r.Color(t,i,n)}function c(e){var t=o(e,"texture_UScale",1),i=o(e,"texture_VScale",1),r=o(e,"texture_UOffset",0),n=o(e,"texture_VOffset",0),s=o(e,"texture_WAngle",0);return{elements:[Math.cos(s)*t,Math.sin(s)*i,0,-Math.sin(s)*t,Math.cos(s)*i,0,r,n,1]}}let u={parseMaterialColor:n,parseMaterialScalar:o,parseMaterialBoolean:s,parseMaterialGeneric:a,SRGBToLinearFloat:l,SRGBToLinear:h,Get2DSimpleMapTransform:c}},19462:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MATERIAL_VARIANT:()=>A,MaterialManager:()=>w});var r=i(75050),n=i(33664),o=i(60489),s=i(71519),a=i.n(s),l=i(18350),h=i.n(l),c=i(77221);let u={uniforms:r.UniformsUtils.merge([c.ShaderChunks.CutPlanesUniforms,{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new r.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new r.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new r.Vector4(0,0,1,1)},modelId:{type:"v3",value:new r.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0},grayscale:{type:"f",value:0},viewportBounds:{type:"v4",value:new r.Vector4(0,0,1,1)},unpackXform:{type:"v4",value:new r.Vector4(1,1,0,0),perObject:!0},tIdColor:{type:"t",value:null,perObject:!0},vIdColorTexSize:{type:"v2",value:new r.Vector2(256,1),perObject:!0},meshAnimTime:{type:"f",value:0,perObject:!0}}]),vertexShader:a(),fragmentShader:h()};var d=i(84325),p=i.n(d),f=i(59191),m=i.n(f);let g={uniforms:r.UniformsUtils.merge([u.uniforms,{aaRange:{type:"f",value:1},size:{type:"v2",value:new r.Vector2(1024,768)},cameraPos:{type:"v3",value:new r.Vector3},tanHalfFov:{type:"f",value:0},miterLimit:{type:"f",value:6},miterScaleFactor:{type:"f",value:1023},miterCP:{type:"f",value:65536}}]),vertexShader:p(),fragmentShader:m()};class v extends r.ShaderMaterial{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e.isScreenSpace?{uniforms:r.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}:{uniforms:r.UniformsUtils.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}),this.isScreenSpace=!!e.isScreenSpace,e.hasLineStyles&&(this.hasLineStyles=!0),this.is2d=!0,this.supportsViewportBounds=!0,this.depthWrite=!1,this.depthTest=!1,this.side=r.DoubleSide,this.transparent=!0,this.blending=r.NormalBlending,this.type="LMVLineMaterial"+(this.isScreenSpace?"SS":""),"multiply"==e.compositeOperation?this.blending=r.MultiplyBlending:"min"==e.compositeOperation||"darken"==e.compositeOperation?(this.blending=r.CustomBlending,this.blendEquation=r.MinEquation,this.blendEquationAlpha=r.AddEquation,this.blendSrcAlpha=r.SrcAlphaFactor,this.blendDstAlpha=r.DstAlphaFactor):"max"!=e.compositeOperation&&"lighten"!=e.compositeOperation||(this.blending=r.CustomBlending,this.blendEquation=r.MaxEquation,this.blendEquationAlpha=r.AddEquation,this.blendSrcAlpha=r.SrcAlphaFactor,this.blendDstAlpha=r.DstAlphaFactor)}}var y=i(75469),b=i(11466);function x(e,t,i){e.x=t.r,e.y=t.g,e.z=t.b,e.w=i}var _=new r.Color("#0000FF"),E=.6;const A={INSTANCED:0,VERTEX_IDS:1},S=(e,t,i)=>{e[t]=i,e.needsUpdate=!0};function w(e){this._renderer=e,this._textures={},this._texturesToUpdate=[],this._materials={},this._materialsNonHDR={},this._exposureBias=0,this._tonemapMethod=0,this._envMapExposure=1,this._envRotationSin=0,this._envRotationCos=1,this._reflectionMap=null,this._irradianceMap=null,this._cutplanes=[],this.cutplanesHideInterior=0,this._mrtNormals=!1,this._mrtIdBuffer=void 0,this._polygonOffsetOn=!1,this._pixelsPerUnit=1,this._lineStyleTex=null,this._swapBlackAndWhite=0,this._grayscaleLines=0,this._depthWriteTransparent=!0,this._needsTwoSided=!1,this._hasTransparentMaterial=!1,this.hasPrism=!1,this._forceDoubleSided=!1,this._layerMaskTextures={},this._layerMaps={},this._selectionTextures={},this._prismWoodTextures=void 0,this.defaultMaterial=new r.MeshPhongMaterial({color:7829367,specular:3355443,shininess:30,reflectivity:0}),this.addMaterial("__defaultMaterial__",this.defaultMaterial),this.initLineStyleTexture(),this.refCount=0}w.prototype.dtor=function(){this.cleanup(),r.Cache.clear(),this._renderer=null},w.prototype._getModelHash=function(e){const t=e&&("number"==typeof e?e:e.id);return"model:"+(t||"")+"|"},w.prototype._getMaterialHash=function(e,t){return e&&e.isOTG()?t:this._getModelHash(e)+"mat:"+t},w.prototype._getTextureHash=function(e,t,i,r){return`${this._getModelHash(e)}mat:${r}|tex:${t}|map:${i}`},w.prototype.addNonHDRMaterial=function(e,t){t.doNotCut||(t.cutplanes=this._cutplanes),this._applyMRTFlags(t),this._materialsNonHDR[e]=t},w.prototype.removeNonHDRMaterial=function(e){delete this._materialsNonHDR[e]},w.prototype.addMaterialNonHDR=function(e,t){this.addNonHDRMaterial(e,t)},w.prototype.addHDRMaterial=function(e,t){this._reflectionMap&&!t.disableEnvMap&&(t.envMap=this._reflectionMap),this._irradianceMap&&(t.irradianceMap=this._irradianceMap),t.exposureBias=Math.pow(2,this._exposureBias),t.tonemapOutput=this._tonemapMethod,t.envMapExposure=this._envMapExposure,t.envRotationSin=this._envRotationSin,t.envRotationCos=this._envRotationCos,this._applyCutPlanes(t),this._applyMRTFlags(t),this._applyPolygonOffset(t,this._polygonOffsetOn),this._materials[e]=t},w.prototype._applyCutPlanes=function(e){e.doNotCut?e.cutplanes=null:(e.cutplanes=this._cutplanes,e.cutplanesHideInterior=this.cutplanesHideInterior,e.needsUpdate=!0,this._cutplanes&&this._cutplanes.length>0?e.side=r.DoubleSide:this._needsTwoSided||e.is2d||this._forceDoubleSided||(e.side=r.FrontSide))},w.prototype.addMaterial=function(e,t,i){var n=t.prismType&&-1!==t.prismType.indexOf("Prism");this.hasPrism=n||this.hasPrism,b.MaterialConverter.applyAppearanceHeuristics(t,n||i,this.isDepthWriteTransparentEnabled()),t.side===r.DoubleSide&&(this._needsTwoSided=!0),this.addHDRMaterial(e,t)},w.prototype.addLineMaterial=function(e,t,i){var r=i&&this._layerMaskTextures[i];r&&(t.defines.HAS_LAYERS=1,t.uniforms.tLayerMask.value=r),t.hasLineStyles&&(t.defines.HAS_LINESTYLES=1,t.defines.MAX_LINESTYLE_LENGTH=this._lineStyleTex.image.width,t.uniforms.tLineStyle.value=this._lineStyleTex,t.uniforms.vLineStyleTexSize.value.set(this._lineStyleTex.image.width,this._lineStyleTex.image.height)),t.uniforms.swap.value=this._swapBlackAndWhite,t.uniforms.grayscale.value=this._grayscaleLines,t.doNotCut||(t.cutplanes=this._cutplanes),this._updatePixelScaleForMaterial(t),this._materials[e]=t,this._applyMRTFlags(t)},w.prototype.addOverrideMaterial=function(e,t){if(this.addNonHDRMaterial(e,t),t.variants)for(var i=0;i<t.variants.length;i++){var r=t.variants[i];if(r){var n=e+"_variant_"+i;this.addNonHDRMaterial(n,r)}}},w.prototype.getMaterialVariant=function(e,t,i){var r=!!e.hash,n=(r?e.hash:this._getModelHash(i)+e.id)+"|"+t,o=this._materials[n];return o||(o=this.cloneMaterial(e,i),t===A.INSTANCED?(o.useInstancing=!0,o.vertexIds=!0):t===A.VERTEX_IDS&&(o.vertexIds=!0),this.addHDRMaterial(n,o)),r&&this._addMaterialRef(o,i.id),o},w.prototype.addInstancingSupport=function(e){var t=e.clone();t.useInstancing=!0,t.packedNormals=e.packedNormals;var i=e.clone();i.wideLines=!0,i.packedNormals=e.packedNormals,e.variants=[t,i],e.getCustomOverrideMaterial=function(e){return e.useInstancing?this.variants[0]:e.wideLines?(this.variants[1].linewidth=e.linewidth,this.variants[1]):null}},w.prototype.addCompactLayoutSupport=function(e){var t=function(t){var i=t.clone();return e.uniforms.tSelectionTexture.value&&(i.uniforms.tSelectionTexture.value=e.uniforms.tSelectionTexture.value),e.uniforms.tLayerMask.value&&(i.uniforms.tLayerMask.value=e.uniforms.tLayerMask.value),i.is2d=e.is2d,i.supportsViewportBounds=e.supportsViewportBounds,i.modelScale=e.modelScale,i.defines=Object.assign({},e.defines),i.attributes=Object.assign({},e.attributes),i},i=t(e);i.defines.UNPACK_POSITIONS=1;var r=t(e);r.defines.USE_INSTANCING=1;var n=t(e);n.defines.UNPACK_POSITIONS=1,n.defines.USE_INSTANCING=1,e.variants=[i,r,n],e.getCustomOverrideMaterial=function(e){if(e.defines){var t=(e.defines.UNPACK_POSITIONS?1:0)+(e.defines.USE_INSTANCING?2:0);if(t>0)return this.variants[t-1]}return null}},w.prototype.removeMaterial=function(e){delete this._materials[e]},w.prototype.findMaterial=function(e,t){var i=this._getMaterialHash(e,t);return this._materials[i]},w.prototype.convertSharedMaterial=async function(e,t,i){var r=this.findMaterial(e,i);return r||((r=await this.convertOneMaterial(e,t,i)).hash=i),this._addMaterialRef(r,e.id),r},w.prototype.convertOneMaterial=async function(e,t,i){var n=b.MaterialConverter.isPrismMaterial(t);n&&await b.MaterialConverter.loadMaterialConverterPrismLibrary();var s=e.getData(),a=s&&s.materials?s.materials.scene.SceneUnit:"inch",l=n&&b.MaterialConverter.swapPrismWoodTextures(this._prismWoodTextures);l&&o.logger.warn("Unexpected wood textures converting a material");var h=await b.MaterialConverter.convertMaterial(t,a);if(s.doubleSided&&(h.side=r.DoubleSide),this.addMaterial(i,h),this._hasTransparentMaterial=this._hasTransparentMaterial||h.transparent,b.MaterialConverter.hasTiling(t)){h.decals=[];var c=t.materials,u=c[t.userassets[0]];let e=u.properties.references.base_materials.connections,r=u.properties.references.tiles.connections,n=[];for(let o=0;o<r.length;o++){let s=c[r[o]];n.push(s),(m=await b.MaterialConverter.convertMaterial(t,a,null,e[o])).useTiling=!0,m.transparent=!0,h.decals.push({uv:0,material:m}),this.addMaterial(i+"|tile|"+o,m)}b.MaterialConverter.materialTilingPattern(t,u,n,h.decals,a)}if(t.decals){h.decals||(h.decals=[]);for(var d=0,p=t.decals.length;d<p;d++){var f=t.decals[d],m=await b.MaterialConverter.convertMaterial(f.material,a);h.decals.push({uv:f.uv||0,material:m}),this.addMaterial(i+"|decal|"+d,m)}}return this._prismWoodTextures=n&&b.MaterialConverter.swapPrismWoodTextures(l),h},w.prototype.forEach=function(e,t,i,r){for(var n in r=r||this._materials){var o=r[n];t&&o.is2d||(e(o,n),i&&o.variants&&o.variants.forEach((function(t){t&&e(t)})))}},w.prototype.forEachInModel=function(e,t,i){const r=this._getModelHash(e),n=(e,t)=>{-1!==t.indexOf(r)&&i(e)};this.forEach(n,!1,t),this.forEach(n,!1,t,this._materialsNonHDR)};var M={needsClear:!1,needsRender:!1,overlayDirty:!1};function T(e,t,i){let r=e.slots[i];r?-1==r.indexOf(t)&&r.push(t):e.slots[i]=[t]}w.prototype.updateMaterials=function(){for(M.needsRender=!1;this._texturesToUpdate.length;){var e=this._texturesToUpdate.pop();for(let i in e.slots){let r=e.slots[i];for(var t=0;t<r.length;t++)r[t][i]=e.tex,r[t].needsUpdate=!0,M.needsRender=!0}}return M},w.prototype.setTextureInCache=function(e,t,i,r){var n=this._getTextureHash(e,i.uri,i.mapName,t.id),o=this._textures[n];if(o){for(var s in o.tex||(o.tex=r),o.slots)for(var a=o.slots[s],l=0;l<a.length;l++)a[l][s]=r;this._texturesToUpdate.push(o)}},w.prototype.loadTextureFromCache=function(e,t,i,r){var n=this._getTextureHash(e,i.uri,i.mapName,t.id),o=this._textures[n];if(o)o.tex?(t[r]=o.tex,t.needsUpdate=!0):(o.slots[r]||(o.slots[r]=[]),o.slots[r].push(t));else{var s={};s[r]=[t],this._textures[n]={slots:s,tex:null}}return!!o},w.prototype.getOtgMaterials=function(e){const t=(e,t)=>{const i=t.indexOf(e);if(-1!==i)return{hash:e,idx:i};const r=e+"|"+A.INSTANCED,n=t.indexOf(r);if(-1!==n)return{hash:r,idx:n};const o=e+"|"+A.VERTEX_IDS,s=t.indexOf(o);return-1!==s?{hash:o,idx:s}:void 0};let i={};const r=e.getData(),n=r.fragments.materials,o=Object.keys(this._materials);for(let e=0;e<n.length;e++){const s=n[e],a=t(r.getMaterialHash(s),o);a&&(i[a.hash]=this._materials[a.hash],o.splice(a.idx,1))}return i},w.prototype.getModelMaterials=function(e,t){var i=this._getModelHash(e);let r={};const n={};t&&e.isOTG()&&(r=this.getOtgMaterials(e));for(let e in this._materials)if(-1!==e.indexOf(i)){var o=this._materials[e];o.defines&&o.defines.hasOwnProperty("SELECTION_RENDERER")?n[e]=o:r[e]=o}var s={};for(let e in this._materialsNonHDR)-1!==e.indexOf(i)&&(s[e]=this._materialsNonHDR[e]);var a={};for(let e in this._textures)-1!==e.indexOf(i)&&(a[e]=this._textures[e]);return{mats:r,selectionMats:n,matsNonHDR:s,textures:a}},w.prototype.exportModelMaterials=function(e,t){const i=this.getModelMaterials(e);return this.cleanup(e),i},w.prototype.importModelMaterials=function(e,t){for(var i in e.mats){var r=e.mats[i];r.is2d?this.addLineMaterial(i,r,t):this.addHDRMaterial(i,r)}for(var i in e.matsNonHDR)this.addMaterialNonHDR(i,e.matsNonHDR[i]);for(var n in e.textures)this._textures[n]=e.textures[n]},w.prototype.cloneMaterial=function(e,t){var i=e.clone();if(e.defines&&(i.defines=Object.assign({},e.defines)),(i instanceof r.MeshPhongMaterial||i.isPrismMaterial)&&(i.packedNormals=e.packedNormals,i.exposureBias=e.exposureBias,i.irradianceMap=e.irradianceMap,i.envMapExposure=e.envMapExposure,i.envRotationSin=e.envRotationSin,i.envRotationCos=e.envRotationCos,i.proteinType=e.proteinType,i.proteinMat=e.proteinMat,i.proteinCategories=e.proteinCategories,i.tonemapOutput=e.tonemapOutput,i.cutplanes=e.cutplanes,i.textureMaps=e.textureMaps,i.texturesLoaded=e.texturesLoaded),e.doNotCut&&(i.doNotCut=!0),e.is2d&&(i.is2d=!0),e.disableEnvMap&&(i.disableEnvMap=!0),e.supportsViewportBounds&&(i.supportsViewportBounds=!0),e.textureMaps)for(var n in e.textureMaps)if(e[n])i[n]=e[n];else if(t){var s=i.textureMaps[n],a=s.uri,l=s.mapName,h=this._getTextureHash(t,a,l,e.id),c=this._textures[h];c?T(c,i,n):o.logger.error("Missing texture receiver",h)}else o.logger.error("Cannot connect pending texture maps because cloneMaterial was called without a model");return this._applyMRTFlags(i),i},w.prototype.setupMaterial=function(e,t,i){var n=e.getData(),s=this.findMaterial(e,i);if(!s){s=this.cloneMaterial(this.defaultMaterial,e);var a=this._getMaterialHash(e,i);this._materials[a]=s,o.logger.warn("Material ("+i+") missing, using default material instead.")}if(t.isLines||t.isWideLines||t.isPoints){var l=!!t.attributes.color,h=s;if(h||(h=this.defaultMaterial.clone()),t.isPoints)s=new r.PointCloudMaterial({vertexColors:l,size:t.pointSize});else{var c=l?"cachedLineMaterialVC":"cachedLineMaterial";s=h[c],t.isWideLines?(s||((s=h[c]=new r.MeshBasicMaterial({vertexColors:l})).wideLines=!0),t.isLines=!1,s.polygonOffset=h.polygonOffset,s.polygonOffsetFactor=h.polygonOffsetFactor,s.polygonOffsetUnits=h.polygonOffsetUnits,s.linewidth=h.linewidth):s||(s=h[c]=new r.LineBasicMaterial({vertexColors:l}))}l||(s.color=h.color),s.svfMatId=i;var u=this._getMaterialHash(e,i+"_line_"+s.id);this.addMaterialNonHDR(u,s),n.hasLines=!0}else s.svfMatId=i,b.MaterialConverter.applyGeometryFlagsToMaterial(s,t);return s},w.prototype._addMaterialRef=function(e,t){e._sharedBy||(e._sharedBy=[]);var i=e._sharedBy;-1===i.indexOf(t)&&i.push(t)},w.prototype._removeMaterialRef=function(e,t){var i=e._sharedBy,r=i?i.indexOf(t):-1;-1!==r&&i.splice(r,1)},w.prototype.cleanup=function(e){var t=this._getModelHash(e),i={};for(var n in this._textures){var o=this._textures[n];-1===n.indexOf(t)?i[n]=o:o.tex&&(o.tex.dispose(),o.tex.needsUpdate=!0)}this._textures=i;var s={},a={type:"dispose"};for(var l in this._materials){var h=this._materials[l],c=!e||-1!==l.indexOf(t);if(h._sharedBy&&(c?h._sharedBy.length=0:(this._removeMaterialRef(h,e.id),0===h._sharedBy.length&&(c=!0))),c){if((h=this._materials[l]).dispatchEvent(a),h.needsUpdate=!0,h.envMap=null,h.is2d){h.uniforms.tLayerMask.value=null,h.uniforms.tLineStyle.value=null;var u=h.uniforms.tRaster;u&&u.value instanceof r.Texture&&(u.value.dispose(),u.value.needsUpdate=!0)}}else s[l]=this._materials[l]}this._materials=s;var d={};for(var l in this._materialsNonHDR){if(e&&-1===l.indexOf(t))d[l]=this._materialsNonHDR[l];else(h=this._materialsNonHDR[l]).dispatchEvent(a),h.needsUpdate=!0}this._materialsNonHDR=d;var p=(e,t)=>{var i=this._selectionTextures[e];i&&(i.dispose(),i.needsUpdate=!0,t&&delete this._selectionTextures[e])},f=(e,t)=>{const i=this._layerMaskTextures[e];void 0!==i&&(i.dispose(),i.needsUpdate=!0,t&&delete this._layerMaskTextures[e])};if(this._prismWoodTextures&&b.MaterialConverter.disposePrismWoodTextures(this._prismWoodTextures),this._prismWoodTextures=void 0,e)p(e.id,!0),f(e.id,!0),delete this._layerMaps[e.id];else{for(var m in this._selectionTextures)this._selectionTextures.hasOwnProperty(m)&&p(m,!1);for(var m in this._selectionTextures={},this._layerMaskTextures)this._layerMaskTextures.hasOwnProperty(m)&&f(m,!1);this._layerMaskTextures={},this._layerMaps={},this._reflectionMap=null,this._irradianceMap=null}},w.prototype.toggleDepthWriteTransparent=function(e){this._depthWriteTransparent!=e&&(this._depthWriteTransparent=e,this.forEach((function(t){t.lmv_depthWriteTransparent&&(t.depthWrite=e)}),!1,!0))},w.prototype.isDepthWriteTransparentEnabled=function(){return this._depthWriteTransparent},w.prototype.hasTwoSidedMaterials=function(){return this._needsTwoSided},w.prototype.hasTransparentMaterial=function(){return this._hasTransparentMaterial},w.prototype.texturesLoaded=function(){return 0===this._texturesToUpdate.length},w.prototype.renderer=function(){return this._renderer},w.prototype.setTonemapExposureBias=function(e){this._exposureBias=e;var t=Math.pow(2,e);this.forEach((function(e){S(e,"exposureBias",t)}),!0,!0)},w.prototype.setTonemapMethod=function(e){this._tonemapMethod=e,this.forEach((function(t){t.tonemapOutput=e,t.needsUpdate=!0}),!0,!0)},w.prototype.setEnvExposure=function(e){var t=Math.pow(2,e);this._envMapExposure=t,this.forEach((function(e){S(e,"envMapExposure",t)}),!0,!0)},w.prototype.setEnvRotation=function(e){var t=this._envRotationSin=Math.sin(e),i=this._envRotationCos=Math.cos(e);this.forEach((function(e){e.envRotationSin=t,e.envRotationCos=i,e.needsUpdate=!0}),!0,!0)},w.prototype.setReflectionMap=function(e){this._reflectionMap=e,this.forEach((function(t){t.disableEnvMap||S(t,"envMap",e)}),!0,!0)},w.prototype.setIrradianceMap=function(e){this._irradianceMap=e,this.forEach((function(t){S(t,"irradianceMap",e)}),!0,!0)},w.prototype.setDoubleSided=function(e,t){this._forceDoubleSided=e;let i={};i=t?this.getModelMaterials(t,!0).mats:this._materials,this.forEach((function(t){t.side=e?r.DoubleSide:r.FrontSide,t.needsUpdate=!0}),!0,!0,i)},w.prototype.setCutPlanes=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var i=!1;const n=this._cutplanes.length!==(e&&e.length||0),o=t!==this.cutplanesHideInterior,s=n||o;for(;this._cutplanes.length>0;)this._cutplanes.pop();if(this.cutplanesHideInterior=t,e)for(var a=0;a<e.length;a++)this._cutplanes.push(e[a].clone());if(s)for(var l in this.forEach((e=>{this._applyCutPlanes(e),i=i||e.side==r.DoubleSide}),!1,!0),this._materialsNonHDR)this._materialsNonHDR[l].doNotCut||(this._materialsNonHDR[l].needsUpdate=!0);return i||this._needsTwoSided},w.prototype.getCutPlanes=function(){return this._cutplanes.slice()},w.prototype.getCutPlanesRaw=function(){return this._cutplanes},w.prototype._applyPolygonOffset=function(e){(e instanceof r.MeshPhongMaterial||e.isPrismMaterial)&&(e.polygonOffset=this._polygonOffsetOn,e.polygonOffsetFactor=this._polygonOffsetFactor,e.polygonOffsetUnits=this._polygonOffsetUnits,e.extraDepthOffset&&(e.polygonOffsetFactor+=e.extraDepthOffset),e.needsUpdate=!0)},w.prototype.getPolygonOffsetOn=function(){return this._polygonOffsetOn},w.prototype.getPolygonOffsetFactor=function(){return this._polygonOffsetFactor},w.prototype.getPolygonOffsetUnits=function(){return this._polygonOffsetUnits},w.prototype.togglePolygonOffset=function(e,t,i){this._polygonOffsetOn=e,this._polygonOffsetFactor=e?t||1:0,this._polygonOffsetUnits=e?i||.1:0;var r=this;this.forEach((function(e){r._applyPolygonOffset(e)}),!1,!0)},w.prototype._applyMRTFlags=function(e){var t=e.supportsMrtNormals||e instanceof r.MeshPhongMaterial||e.isPrismMaterial||e instanceof r.MeshBasicMaterial||e instanceof r.LineBasicMaterial||e instanceof r.PointCloudMaterial||e instanceof r.PointsMaterial,i=e.mrtNormals,n=e.mrtIdBuffer;e.skipMrtNormals||(e.mrtNormals=t&&this._mrtNormals),e.mrtIdBuffer=this._mrtIdBuffer,e.mrtNormals===i&&e.mrtIdBuffer===n||(e.needsUpdate=!0)},w.prototype.toggleMRTSetting=function(e){this._mrtNormals=e.mrtNormals,this._mrtIdBuffer=e.mrtIdBuffer;var t=this;function i(e){t._applyMRTFlags(e)}this.forEach(i,!1,!0),this.forEach(i,!1,!0,this._materialsNonHDR)},w.prototype.adjustMaterialMRTSetting=function(e){this._applyMRTFlags(e)},w.prototype.initLineStyleTexture=function(){this._lineStyleTex=(0,y.createLinePatternTexture)()},w.prototype.setLineStyleTexture=function(e){this._lineStyleTex=e},w.prototype.initLayersTexture=function(e,t,i){for(var n=this._layerMaskTextures[i],o=n?n.image.data:new Uint8Array(65536),s=0,a=e;s<a;s++)o[s]=255;(n=n||new r.DataTexture(o,256,256,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter,0)).generateMipmaps=!1,n.flipY=!1,n.needsUpdate=!0,this._layerMaskTextures[i]=n,this._layerMaps[i]=t},w.prototype.setLayerVisible=function(e,t,i){for(var r=this._layerMaskTextures[i],n=r.image.data,o=this._layerMaps[i],s=t?255:0,a=0;a<e.length;++a){n[o[e[a]]]=s}r.needsUpdate=!0,this.forEach((function(e){e.is2d&&(e.needsUpdate=!0)}))},w.prototype.initSelectionTexture=function(e,t){if(this._selectionTextures[t])return this._selectionTextures[t];for(var i=e||1,n=4096,o=0|Math.ceil(i/n),s=1;s<o;)s*=2;o=s;for(var a=new Uint8Array(n*o),l=0;l<i;l++)a[l]=0;var h=new r.DataTexture(a,n,o,r.LuminanceFormat,r.UnsignedByteType,r.UVMapping,r.ClampToEdgeWrapping,r.ClampToEdgeWrapping,r.NearestFilter,r.NearestFilter,0);return h.generateMipmaps=!1,h.flipY=!1,h.needsUpdate=!0,this._selectionTextures[t]=h,h},w.prototype.highlightObject2D=function(e,t,i){var r=this._selectionTextures[i];r&&(r.image.data[e]=t?255:0,r.needsUpdate=!0)},w.prototype._updatePixelScaleForMaterial=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._camera,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._deviceWidth,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._deviceHeight,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._pixelsPerUnit,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(e.is2d){if(e.isScreenSpace)if(e.uniforms.size.value.set(i,r),e.uniforms.aaRange.value=.5,null!=t&&t.isPerspective){e.uniforms.cameraPos.value.copy(t.position);const i=t.fov*Math.PI/180;e.uniforms.tanHalfFov.value=Math.tan(.5*i)}else e.uniforms.tanHalfFov.value=0;else e.uniforms.aaRange.value=.5/(n*e.modelScale*o);e.uniforms.pixelsPerUnit.value=n*e.modelScale*o}},w.prototype.updatePixelScale=function(e,t,i,r){this._pixelsPerUnit=e,this._deviceWidth=t,this._deviceHeight=i,this._camera=r,this.forEach((n=>this._updatePixelScaleForMaterial(n,r,t,i,e)))},w.prototype.updatePixelScaleForModel=function(e,t,i,r,n,o){const s=this.getModelMaterials(e),a=e=>this._updatePixelScaleForMaterial(e,o,i,r,t,n);Object.values(s.mats).forEach(a),Object.values(s.matsNonHDR).forEach(a),Object.values(s.selectionMats).forEach(a)},w.prototype.updateSwapBlackAndWhite=function(e){var t=this._swapBlackAndWhite=e?1:0;this.forEach((function(e){e.is2d&&(e.uniforms.swap.value=t)}))},w.prototype.setGrayscale=function(e){var t=this._grayscaleLines=e?1:0;this.forEach((function(e){e.is2d&&(e.uniforms.grayscale.value=t)}))},w.prototype.updateViewportId=function(e){this.forEach((function(t){t.is2d&&(t.uniforms.viewportId.value=e,t.needsUpdate=!0)}))},w.prototype.create2DMaterial=function(e,t,i,o,s){var a=e?e.getData():null,l="__lineMaterial__";t.image&&(l+="|image:"+t.image.name),t.clip&&(l+="|clip:"+JSON.stringify(t.clip)),i&&(l+="|id"),o&&(l+="|selection"),t.skipEllipticals&&(l+="|skipEllipticals"),t.skipCircles&&(l+="|skipCircles"),t.skipTriangleGeoms&&(l+="|skipTriangleGeoms"),t.skipMiterLines&&(l+="|skipMiterLines"),t.useInstancing&&(l+="|useInstancing"),t.isScreenSpace&&(l+="|isScreenSpace"),t.unpackPositions&&(l+="|unpackPositions"),t.hasLineStyles&&(l+="|hasLineStyles"),t.compositeOperation&&(l+="|"+t.compositeOperation),t.hasOpacity&&(l+="|hasOpacity"),t.noIdOutput&&(l+="|noIdOutput");var h=this._getMaterialHash(e,l);if(!this._materials.hasOwnProperty(h)){var c=new v(t);if(i?(c.defines.ID_COLOR=1,c.blending=r.NoBlending):o?(c.uniforms.tSelectionTexture.value=o,c.uniforms.vSelTexSize.value.set(o.image.width,o.image.height),c.defines.SELECTION_RENDERER=1,this.get2dSelectionColor(c.uniforms.selectionColor)):(this.get2dSelectionColor(c.uniforms.selectionColor),c.mrtIdBuffer=this._mrtIdBuffer),t.skipEllipticals||(c.defines.HAS_ELLIPTICALS=1),t.skipCircles||(c.defines.HAS_CIRCLES=1),t.skipTriangleGeoms||(c.defines.HAS_TRIANGLE_GEOMS=1),t.skipMiterLines||(c.defines.HAS_MITER_LINES=1),t.noIdOutput&&(c.defines.NO_ID_OUTPUT=1),t.useInstancing&&(c.defines.USE_INSTANCING=1),t.unpackPositions&&!i&&(c.defines.UNPACK_POSITIONS=1),t.msdfFontTexture&&(c.defines.MSDF_TEXTURE_FONT=1),t.imageUVTexture&&(c.defines.IMAGE_UV_TEXTURE=1),t.viewportBounds&&(c.uniforms.viewportBounds.value=t.viewportBounds.clone(),c.defines.VIEWPORT_CLIPPING=1),"number"==typeof t.opacity&&(c.uniforms.opacity.value=t.opacity),t.image){var u=function(i,n){i?(i.wrapS=r.ClampToEdgeWrapping,i.wrapT=r.ClampToEdgeWrapping,i.minFilter=n?r.LinearFilter:r.LinearMipMapLinearFilter,i.magFilter=r.LinearFilter,i.anisotropy=1,i.flipY=!0,i.generateMipmaps=!0,i.needsUpdate=!0,t.msdfFontTexture||t.imageUVTexture||(c.defines.HAS_RASTER_QUADS=1),c.uniforms.tRaster.value=i,c.needsUpdate=!0,s&&s(i,e)):s&&s(i,e,t)};if("undefined"!=typeof HTMLCanvasElement&&t.image instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t.image instanceof HTMLImageElement)u(new r.Texture(n.TextureLoader.imageToCanvas(t.image,"multiply"==t.compositeOperation,t.compositeCanvasColor),r.UVMapping),!0);else n.TextureLoader.loadTextureWithSecurity(t.image.dataURI,r.UVMapping,u,null,a.acmSessionId)}c.modelScale=t.modelScale||1,t.doNotCut&&(c.doNotCut=!0),c.textureMaps={},this.addLineMaterial(h,c,e&&e.id),(i||o)&&this.addCompactLayoutSupport(c)}return l},w.prototype.set2dSelectionColor=function(e,t){_=new r.Color(e),E=null==t?E:t,this.forEach((function(e){if(e.is2d&&e.uniforms){var t=e.uniforms.selectionColor;t&&(x(t.value,_,E),e.needsUpdate=!0)}}))},w.prototype.get2dSelectionColor=function(e){return e&&x(e.value,_,E),_},w.prototype.get2dSelectionOpacity=function(){return E},w.prototype.setMaterialViewportBounds=function(e,t){e.supportsViewportBounds&&(t?e.defines.VIEWPORT_CLIPPING?e.uniforms.viewportBounds.value.set(t.min.x,t.min.y,t.max.x,t.max.y):(e.uniforms.viewportBounds.value=new r.Vector4(t.min.x,t.min.y,t.max.x,t.max.y),e.defines.VIEWPORT_CLIPPING=1,e.needsUpdate=!0):e.defines.VIEWPORT_CLIPPING&&(delete e.defines.VIEWPORT_CLIPPING,e.needsUpdate=!0))},w.prototype.setViewportBoundsForModel=function(e,t){this.forEachInModel(e,!1,(e=>{this.setMaterialViewportBounds(e,t)}))}},17724:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PhongShader:()=>h});var r=i(75050),n=i(77221),o=i(4352),s=i.n(o),a=i(83039),l=i.n(a);let h={uniforms:r.UniformsUtils.merge([r.UniformsLib.common,r.UniformsLib.bump,r.UniformsLib.normalmap,r.UniformsLib.lights,r.UniformsLib.fog,n.ShaderChunks.CutPlanesUniforms,n.ShaderChunks.IdUniforms,n.ShaderChunks.ThemingUniform,n.ShaderChunks.ShadowMapUniforms,n.ShaderChunks.WideLinesUniforms,{emissive:{type:"c",value:new r.Color(0)},specular:{type:"c",value:new r.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},texMatrix:{type:"m3",value:new r.Matrix3},texMatrixBump:{type:"m3",value:new r.Matrix3},texMatrixAlpha:{type:"m3",value:new r.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1}}]),vertexShader:s(),fragmentShader:l()};r.ShaderLib.firefly_phong=h},2724:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GetPrismMapUniforms:()=>n,PrismUtil:()=>o});var r=i(75050);function n(e){var t=e+"_texMatrix",i=e+"_invert",n={};return n[e]={type:"t",value:null},n[t]={type:"m3",value:new r.Matrix3},n[i]={type:"i",value:0},n}let o={GetPrismMapUniforms:n}},38454:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RenderContext:()=>te});var r=i(75050),n=i(7247),o=i(22599),s=i(60489),a=i(36671),l=i(77221),h=i(66209),c=i.n(h),u=i(20505),d=i.n(u);let p={uniforms:r.UniformsUtils.merge([l.ShaderChunks.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},aoOpacity:{type:"f",value:.625},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},useOverlayAlpha:{type:"i",value:1},tID:{type:"t",value:null},tID2:{type:"t",value:null},objIDv4:{type:"v4",value:new r.Vector4(0,0,0,0)},modelIDv2:{type:"v2",value:new r.Vector2(0,0)},modelIDsv2v:{type:"v2v",value:[]},edgeObjIDv4:{type:"v4",value:new r.Vector4(0,0,0,0)},edgeModelIDv2:{type:"v2",value:new r.Vector2(0,0)},highlightIntensity:{type:"f",value:1},highlightColor:{type:"c",value:new r.Color(1,1,1)},resolution:{type:"v2",value:new r.Vector2(1/1024,1/512)},selectionColor:{type:"c",value:new r.Color(0,0,0)},expand2dSelection:{type:"f",value:.5},tCrossFadeTex0:{type:"t",value:null},tCrossFadeTex1:{type:"t",value:null},crossFadeOpacity0:{type:"f",value:0},crossFadeOpacity1:{type:"f",value:0},highlightFullModel:{type:"f",value:0}}]),vertexShader:c(),fragmentShader:d()};var f=i(32893),m=i(63332),g=i.n(m),v=i(49510),y=i.n(v);let b={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new r.Vector2(1/1024,1/512)}},vertexShader:g(),fragmentShader:y()};var x=i(79282),_=i.n(x),E=i(6750),A=i.n(E);let S={uniforms:{color:{type:"v4",value:new r.Vector4(0,0,0,.3)},cutplanes:{type:"v4v",value:[]}},vertexShader:_(),fragmentShader:A()};var w=i(5030),M=i.n(w),T=i(74957),C=i.n(T);let P={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:M(),fragmentShader:C()};var D=i(92217);const L={Color:1,Depth:2,ModelId:3,Overlay:4,Post1:5,Post2:6,SSAO:7,PostDisplay:8};function I(e,t,i,n,o){var s=new r.WebGLRenderTarget(e,t,{minFilter:r.NearestFilter,magFilter:r.NearestFilter,format:i,type:n,stencilBuffer:!1});return o&&(s.shareDepthFrom=o),s.name="depthTarget",s}const R=new r.Vector4(1,1,1,.5),O=new r.Vector4(1,1,1,1);function N(e,t){var i=new r.WebGLRenderTarget(e,t,{minFilter:r.NearestFilter,magFilter:r.NearestFilter,format:r.RGBAFormat,type:r.UnsignedByteType,stencilBuffer:!1});return i.texture.generateMipmaps=!1,i.canReadPixels=!0,i}function F(e){e.material.blending=r.NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}function k(e,t){if(e&&t){t.length=0;for(let i=0;i<e.length;i++)t[i]=e[i]}}var V=i(85686),U=i(50410),B=i.n(U);let G={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new r.Vector2(512,512)},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)},axis:{type:"v2",value:new r.Vector2(1,0)},radius:{type:"f",value:50}},vertexShader:c(),fragmentShader:B()};var z=i(11342),H=i.n(z),W=i(92003),j=i.n(W),q=i(3819),X=i.n(q);const Y={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)}},vertexShader:H(),fragmentShader:j()},K={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)}},vertexShader:H(),fragmentShader:X()};var Q=i(74718),Z=i(86353);const J=(0,n.getGlobal)().document,$=new r.Color(16777215),ee=new r.Color(0);function te(){var e,t,i,l,h,c,u,d,m,g,v,y,x,_,E,A=!1,w=new V.RenderContextPostProcessManager;this.postShadingManager=function(){return w};var M,T,C,U,B={},z=void 0,H=null,W=null,j=null,q=null,X=null,te=null,ie=null,re=[],ne=null,oe=0,se=0,ae=0,le=0,he=1,ce=!1,ue=!1;let de=!1;var pe={},fe={},me=[0,0],ge=new r.Vector4(0,0,0,.3),ve=null,ye=1,be=1,xe=!1,_e={isRenderingHidden:!1,isRenderingOverlays:!1},Ee=r.RGBAFormat,Ae=r.FloatType,Se=!1,we=0,Me=0,Te=0,Ce=[.42,0,1,1],Pe=!0,De={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,envMapBg:!1,numIdTargets:1,renderEdges:!1,useIdBufferSelection:!1,copyDepth:!1},Le={},Ie=null,Re=null;function Oe(t){try{var i=I(2,2,t.format,t.type);i.texture.generateMipmaps=!1,e.setRenderTarget(i);var r=e.getContext(),n=r.checkFramebufferStatus(r.FRAMEBUFFER);return e.setRenderTarget(null),i.dispose(),n===r.FRAMEBUFFER_COMPLETE}catch(e){return!1}}function Ne(e){De.useIdBufferSelection=e,e?_.material.defines.USE_IDBUFFER_SELECTION="1":delete _.material.defines.USE_IDBUFFER_SELECTION}function Fe(e){e(t);for(var i=1;i<t.variants.length;i++)e(t.variants[i])}function ke(e){switch(e){case L.Color:return!0;case L.Depth:return Se&&(De.sao||w.isPostProcShaded());case L.ModelId:return De.idbuffer;case L.Overlay:return!0;case L.SSAO:return De.sao;case L.Post1:return De.antialias||De.sao||De.customPresentPass||w.isPostProcShaded();case L.Post2:return w.isPostProcShaded()||De.customPresentPass;case L.PostDisplay:return De.antialias&&w.isPostProcShaded()}}function Ve(){var t=q,i=H;if(_.uniforms.useAO.value){const n=function(){var e=[_.uniforms.useOverlay.value,_.uniforms.objIDv4.value];return _.uniforms.useOverlay.value=0,_.uniforms.objIDv4.value=new r.Vector4,e}();_.render(e,t,i),i=t,t=ie,function(e){_.uniforms.useOverlay.value=e[0],_.uniforms.objIDv4.value=e[1]}(n)}var n=t===q?ie:q;if(t=(i=w.render(e,t,i,n,!1))===q?ie:q,_.uniforms.useOverlay.value||_.uniforms.objIDv4.value){const r=function(){var e=_.uniforms.useAO.value;return _.uniforms.useAO.value=0,e}();_.render(e,t,i),i=t,function(e){_.uniforms.useAO.value=e}(r)}return n=(t=i===q?ie:q)===q?ie:q,i=w.render(e,t,i,n,!0)}function Ue(e,t){return(t=t||new r.Vector2).set((255&e)/255,(e>>8&255)/255),t}function Be(e,t,i){t=t||0;const r=function(e){return e!==Me&&(Me=e,-1===e&&(e=0),_.uniforms.objIDv4.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255),!0)}(e),n=function(e){if(Array.isArray(e)&&1==e.length&&(e=e[0]),e===Te)return!1;const t=Array.isArray(Te)?Te.length:1,i=Array.isArray(e)?e.length:1;return!(i>1&&(e.sort(),i==t&&!Te.some(((t,i)=>t!==e[i])))||(i!=t&&(1==i?delete _.material.defines.HIGHLIGHT_MODEL_ID_COUNT:_.material.defines.HIGHLIGHT_MODEL_ID_COUNT=i.toString(),_.material.needsUpdate=!0),Te=e,1==i?Ue(e=Array.isArray(e)?e[0]:e,_.uniforms.modelIDv2.value):_.uniforms.modelIDsv2v.value=e.map((e=>Ue(e))),0))}(t);if(r||n)return _.uniforms.highlightIntensity.value=0,we=performance.now(),_.uniforms.highlightFullModel.value=i?1:0,!0}this.settings=De,this.depthTargetSupported=function(){return Se},this.isWeakDevice=function(){return xe},this.init=function(l,h,c){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const A=u.offscreen,w=void 0!==u.useIdBufferSelection&&u.useIdBufferSelection;var M;(t=function(){var e=P;const t=(0,D.createShaderMaterial)(e);t.blending=r.NoBlending,t.packedNormals=!0,t.depthWrite=!1;var i=1,n=2,o=4,s=8,a=[];a[0]=null;for(var l=1;l<s;l++){var h=t.clone();h.packedNormals=t.packedNormals,l&i&&(h.cutplanes=null,h.doNotCut=!0),l&n&&(h.useInstancing=!0),l&o&&(h.packedNormals=!1),a[l]=h}return t.variants=a,t.getCustomOverrideMaterial=function(e){var t=!e||!e.cutplanes||0==e.cutplanes.length,r=e.useInstancing,s=!e.packedNormals,a=(t?i:0)|(r?n:0)|(s?o:0);return this.variants[a]},t}(),i=function(e,t){var i=S;const n=(0,D.createShaderMaterial)(i);n.depthWrite=!0,n.depthTest=!0,n.isEdgeMaterial=!0,n.transparent=!0,n.blending=r.NormalBlending,n.supportsMrtNormals=!0;var o=1,s=2,a=4,l=[];l[0]=null;for(var h=1;h<a;h++){var c=n.clone();c.defines=Object.assign({},n.defines),c.isEdgeMaterial=!0,c.supportsMrtNormals=!0,h&o&&(c.useInstancing=!0),h&s&&(c.doNotCut=!0,c.cutplanes=[]),l[h]=c}return n.variants=l,n.getCustomOverrideMaterial=function(i){var r=i.useInstancing?o:0;i.doNotCut&&(r|=s);var a=this.variants[r]||n;return e.isRenderingOverlays?e.isRenderingHidden?a.uniforms.color.value.copy(R):a.uniforms.color.value.copy(O):a.uniforms.color.value.copy(t),void 0!==i.edgeOpacity&&(a.uniforms.color.value.w=i.edgeOpacity),a.uniforms.color.needsUpdate=!0,a},n}(_e,ge),F(g=new Z.ShaderPass(Q.SAOShader)),F(m=new Z.ShaderPass(G)),F(y=new Z.ShaderPass(Y)),F(v=new Z.ShaderPass(K)),F(x=new Z.ShaderPass(b)),F(_=new Z.ShaderPass(p)),F(d=new Z.ShaderPass(a.Q)),F(E=new Z.ShaderPass(f.CopyShader)),l)?(xe=(0,n.isMobileDevice)(),De.idbuffer=!xe,w&&(De.idbuffer=!0,De.numIdTargets=2,_.material.defines.USE_MODEL_ID="1",Ne(!0)),C=h,U=c,e=l,ue=!!A,de=!!u.removeAlphaInOutput,(M=(xe?[{format:r.RGBAFormat,type:r.HalfFloatType},{format:r.RGBAFormat,type:r.FloatType}]:[{format:r.RGBAFormat,type:r.FloatType},{format:r.RGBAFormat,type:r.HalfFloatType}]).find(Oe))?(Se=!0,Ee=M.format,Ae=M.type):(Se=!1,s.logger.warn("Depth target is unsupported for this device."))):(0,n.isNodeJS)()||s.logger.error("You need a gl context to make a renderer. Things will go downhill from here.",(0,o.errorCodeString)(o.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED))},this.setDepthMaterialOffset=function(e,t,i){Fe((function(r){r.polygonOffset=e,r.polygonOffsetFactor=t,r.polygonOffsetUnits=i,r.extraDepthOffset&&(r.polygonOffsetFactor+=r.extraDepthOffset),r.needsUpdate=!0}))},this.setNoDepthNoBlend=F,this.overlayUpdate=function(){if(0===Me||-1===Me)return!1;var e=_.uniforms.highlightIntensity.value,t=1;if(Pe){var i=.004*(performance.now()-we);i=Math.min(i,1),t=function(e,t){var i=3*e[1],r=3*(e[3]-e[1])-i;return(((1-i-r)*t+r)*t+i)*t}(Ce,i)}return e!=t&&(_.uniforms.highlightIntensity.value=t,!0)},this.setRollOverFadeEnabled=function(e){Pe=e},this.beginScene=function(t,i,a,l){if(h=i,u=t.fog,c=a,A=!1,B={},!H&&C)this.initPostPipeline(De.sao,De.antialias);else if(!H&&!C)return void(ce||(0,n.isNodeJS)()||(s.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",(0,o.errorCodeString)(o.ErrorCodes.VIEWER_INTERNAL_ERROR)),ce=!0));if(l&&function(){var t=De.envMapBg&&!!d.material.envMap,i=!!d.material.useBackgroundTexture;if(!ve||t||i){const t=d.uniforms.uCamDir.value||new r.Vector3;d.uniforms.uCamDir.value=h.worldUpTransform?h.getWorldDirection(t).applyMatrix4(h.worldUpTransform):h.getWorldDirection(t),d.uniforms.uCamUp.value=h.worldUpTransform?h.up.clone().applyMatrix4(h.worldUpTransform):h.up,d.uniforms.uResolution.value.set(C,U),d.uniforms.uHalfFovTan.value=Math.tan(r.Math.degToRad(.5*h.fov)),d.uniforms.opacity.value=ye,e.setRenderTarget(H),e.clear(!1,!0,!1),d.render(e,H,null)}else e.setClearColor(ve,ye),e.setRenderTarget(H),e.clear(!0,!0,!1);Ie&&Ie.clearTarget(e);for(var n=0;n<re.length;n++)e.setClearColor($,1),e.setRenderTarget(re[n]),e.clear(!0,!1,!1);ke(L.Depth)&&(e.setClearColor(ee,0),e.setRenderTarget(T),e.clear(!0,!1,!1))}(),ke(L.Depth)){var p=i.near,f=i.far;g.uniforms.cameraNear.value=p,g.uniforms.cameraFar.value=f,y.uniforms.cameraNear.value=p,y.uniforms.cameraInvNearFar.value=1/(p-f);var m=i.projectionMatrix.elements;i.isPerspective?g.uniforms.projInfo.value.set(-2/(H.width*m[0]),-2/(H.height*m[5]),(1-m[8])/m[0],(1+m[9])/m[5]):g.uniforms.projInfo.value.set(-2/(H.width*m[0]),-2/(H.height*m[5]),(1-m[12])/m[0],(1-m[13])/m[5]),_.uniforms.projInfo.value.copy(g.uniforms.projInfo.value);var v=i.isPerspective?0:1;g.uniforms.isOrtho.value=v,_.uniforms.isOrtho.value=v;if(g.uniforms.projScale.value=H.height*m[5]*.125,_.uniforms.worldMatrix_mainPass.value=i.matrixWorld,w.isPostProcShaded()){const e=Autodesk.Viewing.Navigation.prototype.fov2fl(i.fov);w.updateUniformValue("focalLength",e),w.updateUniformValue("unitScale",he),w.updateUniformValue("worldMatrix_mainPass",i.matrixWorld,!0),w.updateUniformValue("cameraPos",i.position,!0),w.updateUniformValue("cameraNear",p),w.updateUniformValue("cameraFar",f),w.updateUniformValue("projInfo",g.uniforms.projInfo.value,!0),w.updateUniformValue("isOrtho",v)}}De.sao||(_.uniforms.useAO.value=0),this.renderScenePart(t,!0,!0,!0,!0)},this._render=function(e,t,i,r,n){e.setRenderTarget(t),e.render(i,r,n)},this._renderDepthTarget=function(i,r,n,o){if(r&&!i.sortObjects&&n){const r=i.overrideMaterial;i.overrideMaterial=t,t.depthWrite!==o&&function(e,t){e.depthWrite=t;for(var i=0;i<e.variants.length;i++){var r=e.variants[i];r&&(r.depthWrite=t)}}(t,o),this._render(e,n,i,h),i.overrideMaterial=r}},this.renderScenePart=function(t,r,n,o,s){void 0!==t.skipColorTarget&&(r=!t.skipColorTarget),void 0!==t.skipDepthTarget&&(n=!t.skipDepthTarget),void 0!==t.skipIdTarget&&(o=!t.skipIdTarget),r&&De.renderEdges&&(t.edgeMaterial=i);var a=n&&ke(L.Depth),l=H,d=T;Ie&&(l=Ie.chooseColorTarget(t,l),(d=Ie.getRenderSao(t)?T:null)&&T.shareDepthFrom),A=!1,B={};var p,f=s?c:void 0;t.fog=u,p=ke(L.ModelId)&&o&&a?[l,d].concat(re):a?[l,d]:ke(L.ModelId)&&o?[l].concat(re):l,this._render(e,p,t,h,f),t.edgeMaterial=void 0},this.clearAllOverlays=function(){e.setRenderTarget(W),e.clear(!0,!1,!1)},this.renderOverlays=function(t,n,o){var s=0;_e.isRenderingOverlays=!0;let a=!1,l=!1,c=Object.values(t).sort(((e,t)=>e.needSeparateDepth==t.needSeparateDepth?0:1==e.needSeparateDepth?1:1==t.needSeparateDepth?-1:void 0));for(let t=0;t<c.length;++t){var u=c[t],d=u.scene,p=u.camera?u.camera:h,f=e;if(d.children.filter((e=>"lmvInternal"!==e.name)).length){let e=W;if(f.setRenderTarget(e),s||(s=1,o||(f.setClearColor(ee,0),f.clear(!0,!1,!1))),u.materialPre&&(d.overrideMaterial=u.materialPre),u.needSeparateDepth&&!l?(e=W,e.shareDepthFrom=null,f.setRenderTarget(e),f.clear(!1,!0,!1),l=!0):e.shareDepthFrom=H,u.needIdTarget&&ke(L.ModelId)){ne||((ne=N(e.width,e.height)).shareDepthFrom=H,ne.name="overlayId"),0==a&&(f.setRenderTarget(ne),f.clear(!0,!1,!1),a=!0);var m=[e];u.needIdTarget&&m.push(ne),this._render(f,m,d,p,n)}else this._render(f,e,d,p,n),u.needIdTarget&&(ne||((ne=N(e.width,e.height)).shareDepthFrom=H,ne.name="overlayId"),f.setProgramPrefix(1,"#define ID_COLOR","#define ID_COLOR"),this._render(f,ne,d,p,n),f.setProgramPrefix(0,"",""));u.materialPost&&(_e.isRenderingHidden=!0,f.getContext().depthFunc(f.getContext().GREATER),u.materialPost.depthFunc=r.GreaterDepth,De.renderEdges&&(i.depthWrite=!1,i.depthTest=!1,d.overrideMaterial=i,this._render(f,e,d,p)),d.overrideMaterial=u.materialPost,this._render(f,e,d,p,n),f.getContext().depthFunc(f.getContext().LEQUAL),u.materialPost.depthFunc=r.LessEqualDepth,_e.isRenderingHidden=!1),De.renderEdges&&u.materialPre&&(i.depthWrite=!1,i.depthTest=!0,d.overrideMaterial=i,this._render(f,e,d,p)),d.overrideMaterial=null}}_e.isRenderingOverlays=!1,i.depthWrite=!0,i.depthTest=!0,_.uniforms.useOverlay.value=s,s&&(_.uniforms.useOverlayAlpha.value=be)},this.computeSSAO=function(t){if(!t&&De.sao){if(!A){if(z&&z.length){var i=z[0];y.uniforms.resolution.value.set(1/i.width,1/i.height),y.render(e,i,T);for(var r=1;r<z.length;r++){var n=z[r];v.uniforms.resolution.value.set(1/n.width,1/n.height),v.render(e,n,i),i=n}}g.render(e,te,H),m.uniforms.axis.value.set(1,0),m.render(e,q,te),m.uniforms.axis.value.set(0,1),m.render(e,te,q),A=!0}_.uniforms.useAO.value=1}else _.uniforms.useAO.value=0},this.getFinalTarget=function(){return Re||null},this.presentBuffer=function(t){if(e){var i=this.getFinalTarget();if(!(_.uniforms.useAO.value||_.uniforms.useOverlay.value||Ie||0!==Me&&-1!==Me||0!==Te&&-1!==Te))if(De.antialias)if(t)x.render(e,q,H),t.render(e,i,q);else if(w.isPostProcShaded()){const t=w.render(e,q,H,ie);E.render(e,X,t),x.render(e,i,X)}else x.render(e,i,H);else if(t)t.render(e,i,H);else if(w.isPostProcShaded()){const t=w.render(e,q,H,ie);E.render(e,i,t)}else E.render(e,i,H);else if(De.antialias)if(t)_.render(e,q,H),x.render(e,ie,q),t.render(e,i,ie);else if(w.isPostProcShaded()){let t=Ve();E.render(e,X,t),x.render(e,i,X)}else _.render(e,q,H),x.render(e,i,q);else if(t)_.render(e,q,H),t.render(e,i,q);else if(w.isPostProcShaded()){let t=Ve();E.render(e,i,t)}else _.render(e,i,H);if(de){const t=e.getContext(),r=t.getParameter(t.COLOR_WRITEMASK)||[!0,!0,!0,!0],n=e.getClearAlpha();e.setRenderTarget(i),t.colorMask(!1,!1,!1,!0),e.setClearAlpha(1),e.clear(),t.colorMask(...r),e.setClearAlpha(n)}}},this.composeFinalFrame=function(e,t){this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){e&&e.setRenderTarget(null),H&&(H.dispose(),H=null),T&&(T.dispose(),T=null),W&&(W.dispose(),W=null),ne&&(ne.dispose(),ne=null),j&&(j.dispose(),j=null),M&&(M.dispose(),M=null),Ie&&Ie.disposeTargets(),q&&(q.dispose(),q=null),te&&(te.dispose(),te=null),ie&&(ie.dispose(),ie=null),z&&(z.forEach((e=>e.dispose())),z=void 0);for(var t=0;t<re.length;t++)re[t]&&re[t].dispose();re=[],B={},pe={},fe={}},this.setSize=function(t,i,n,o){var a,l,h,c;if(C=t,U=i,De.logicalWidth=t,De.logicalHeight=i,0===t&&0===i||!e)return void this.cleanup();const u=e.getPixelRatio();let d=Math.max(0,t*u),p=Math.max(0,i*u);var f;De.deviceWidth=d,De.deviceHeight=p,o||(ue?e.setViewport(0,0,t,i):e.setSize(t,i));var v=d,y=p;(De.useSSAA||w.isPostProcShaded()&&!xe&&e.getPixelRatio()<=1&&w.postProcessEdgesOn())&&(d*=2,p*=2);var b=1/d,E=1/p;if(!n&&H&&H.width==d&&H.height==p||(s.logger.log("Reallocating render targets."),this.cleanup(),(H=new r.WebGLRenderTarget(d,p,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat,type:De.useHdrTarget?r.FloatType:r.UnsignedByteType,stencilBuffer:!1})).texture.generateMipmaps=!1,H.name="colorTarget",(W=new r.WebGLRenderTarget(d,p,{minFilter:r.NearestFilter,magFilter:r.NearestFilter,format:r.RGBAFormat,stencilBuffer:!1})).texture.generateMipmaps=!1,W.name="overlayTarget",W.shareDepthFrom=H,T=null,q=null,X=null,te=null,ie=null,z=void 0),Ie&&Ie.updateTargets(d,p,n,De.useHdrTarget),ke(L.Post1)&&(!n&&q&&q.width==d&&q.height==p||((q=new r.WebGLRenderTarget(d,p,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).texture.generateMipmaps=!1,q.name="postTarget1")),!te&&ke(L.SSAO)&&((te=q.clone()).name="SSAO target"),!ie&&ke(L.Post2)&&((ie=q.clone()).name="post target 2"),!X&&ke(L.PostDisplay)&&((X=new r.WebGLRenderTarget(v,y,{minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).texture.generateMipmaps=!1,X.name="postTargetNormal"),ke(L.Depth)){if(n||!T||T.width!=d||T.height!=p){T=I(d,p,Ee,Ae,H);const e=5,t=Math.floor(Math.log2(Math.max(1,Math.min(d,p)))),i=Math.min(e,t);z=new Array(i),g.material.defines.USE_MIPMAP=i>0,g.material.defines.MAX_MIP_LEVEL=i,g.material.needsUpdate=!0;for(let e=1;e<=i;++e){const t=d>>e,i=p>>e,n=new r.WebGLRenderTarget(t,i,{minFilter:r.NearestFilter,magFilter:r.NearestFilter,format:r.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});n.texture.generateMipmaps=!1,n.name=`depthTarget_mipmap ${e}`,z[e-1]=n,g.uniforms[`tDepth_mip${e}`].value=n.texture}for(let t=i+1;t<=e;++t)g.uniforms[`tDepth_mip${t}`].value=null}g.uniforms.size.value.set(d,p),g.uniforms.resolution.value.set(b,E),g.uniforms.tDepth.value=T.texture,m.uniforms.size.value.set(d,p),m.uniforms.resolution.value.set(b,E),w.updateUniformValue("tDepth",T),_.uniforms.tDepth.value=T.texture}if(ke(L.ModelId)){if(n||!re[0]||re[0].width!=d||re[0].height!=p){for(f=0;f<re.length;f++)re[f]&&re[f].dispose();for(re=[],f=0;f<De.numIdTargets;f++){var A=N(d,p);A.shareDepthFrom=H,A.name="id "+f,re.push(A)}}w.updateUniformValue("tID",re[0])}else if(re[0]){for(f=0;f<re.length;f++)re[f].dispose(),re[f]=null;re.length=0}x.uniforms.uResolution.value.set(b,E),w.changeResolution(b,E),_.uniforms.tOverlay.value=null===(a=W)||void 0===a?void 0:a.texture,_.uniforms.tAO.value=null===(l=te)||void 0===l?void 0:l.texture,_.uniforms.useAO.value=De.sao?1:0,_.uniforms.resolution.value.set(b,E),_.uniforms.tID.value=(null===(h=re[0])||void 0===h?void 0:h.texture)||null,_.uniforms.tID2.value=(null===(c=re[1])||void 0===c?void 0:c.texture)||null,Ie&&Ie.updateBlendPass()},this.getMaxAnisotropy=function(){return e?e.getMaxAnisotropy():0},this.mrtFlags=function(){return{mrtNormals:ke(L.Depth),mrtIdBuffer:ke(L.ModelId)?De.numIdTargets:void 0}},this.setIdTargetCount=function(e){if(!(e>2||e<1)&&e!==De.numIdTargets&&(De.numIdTargets=e,0!==re.length&&2===e&&1===re.length)){var t=N(re[0].width,re[0].height);return t.shareDepthFrom=H,t.name="id "+re.length,re.push(t),_.uniforms.tID2.value=t,_.material.defines.USE_MODEL_ID="1",_.material.needsUpdate=!0,!0}},this.getAntialiasing=function(){return De.antialias},this.initPostPipeline=function(e,t){De.sao=e&&Se,De.antialias=t,De.haveTwoSided&&Fe((function(e){e.side=r.DoubleSide})),Fe((function(e){e.needsUpdate=!0})),g.material.needsUpdate=!0,m.material.needsUpdate=!0,y.material.needsUpdate=!0,v.material.needsUpdate=!0,x.material.needsUpdate=!0,w.setMaterialNeedsUpdate(),_.material.needsUpdate=!0,d.material.needsUpdate=!0,E.material.needsUpdate=!0,this.setSize(C,U)},this.setClearColors=function(e,t){e instanceof r.Color?ve=e.clone():!t||e.equals(t)?ve=new r.Color(e.x,e.y,e.z):xe?ve=new r.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):(ve=void 0,d.uniforms.color1.value.copy(e),d.uniforms.color2.value.copy(t))},this.useOverlayAlpha=function(e){be=e},this.setClearAlpha=function(e){ye=e},this.setAOEnabled=function(e){De.sao=e&&Se,Le.sao=De.sao,this.setSize(C,U,!1,!0)},this.setAOOptions=function(e,t,i){void 0!==e&&(g.uniforms.radius.value=e,g.uniforms.bias.value=(0,n.isMobileDevice)()?.1:.01,m.uniforms.radius.value=e),void 0!==t&&(g.uniforms.intensity.value=t),_.uniforms.aoOpacity.value=void 0!==i?i:1,A=!1},this.getAOEnabled=function(){return De.sao},this.getAORadius=function(){return g.uniforms.radius.value},this.getAOIntensity=function(){return g.uniforms.intensity.value},this.setCubeMap=function(e){d.material.envMap=e,e||this.toggleEnvMapBackground(!1),e&&De.envMapBg&&(d.uniforms.envMapBackground.value=!0)},this.setBackgroundTexture=function(e){const t=d.material.useBackgroundTexture;d.uniforms.backgroundTexture.value=e,d.material.useBackgroundTexture=!!e,!!e!==t&&(d.material.needsUpdate=!0)},this.getCubeMap=function(){return d.material.envMap},this.setEnvRotation=function(e){ae=e,d.material.envRotationSin=Math.sin(e),d.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return ae},this.setEnvExposure=function(e){const t=d.material.envMapExposure,i=Math.pow(2,e);d.uniforms.envMapExposure.value=i,d.material.envMapExposure=i,i!==t&&(d.material.needsUpdate=!0),oe=e},this.setTonemapExposureBias=function(e){se=e,d.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return se},this.setCamera=function(e){h=e},this.setTonemapMethod=function(t){const i=le;le=t,e.gammaInput=0!==t,d.material.tonemapOutput=le,t!==i&&(d.material.needsUpdate=!0)},this.getToneMapMethod=function(){return le},this.toggleTwoSided=function(e){De.haveTwoSided!=e&&t&&Fe((function(t){t.side=e?r.DoubleSide:r.FrontSide,t.needsUpdate=!0})),De.haveTwoSided=e},this.toggleEdges=function(e){De.renderEdges=e,Le.renderEdges=e},this.getRenderEdges=function(){return De.renderEdges},this.toggleEnvMapBackground=function(e){De.envMapBg=e,d.uniforms.envMapBackground.value=e&&!!d.material.envMap},this.enter2DMode=function(e,t){l=e,Le.sao=De.sao,Le.antialias=De.antialias,Le.idbuffer=De.idbuffer,Le.renderEdges=De.renderEdges,Le.useIdBufferSelection=De.useIdBufferSelection,t&&(Le.selectionColor=De.selectionColor,this.setSelectionColor(t)),De.idbuffer=!0,De.renderEdges=!1,_.material.defines.IS_2D="",Ne(De.idbuffer),this.initPostPipeline(!1,!1)},this.exit2DMode=function(){l=null,De.idbuffer=Le.idbuffer,De.renderEdges=Le.renderEdges,Le.selectionColor&&this.setSelectionColor(Le.selectionColor),delete _.material.defines.IS_2D,Ne(Le.idbuffer),this.initPostPipeline(Le.sao,Le.antialias)},this.idAtPixel=function(e,t,i,r){return this.idAtPixels(e,t,1,i,r)},this.idAtPixels=function(t,i,r,n,o){if(o&&o[0]||(o=re),!o[0])return 0;r%2==0&&(r+=1);const s=.5*(t+1)*o[0].width-.5*(r-1),a=.5*(i+1)*o[0].height-.5*(r-1);if(B[r]&&s===B[r][4]&&a===B[r][5]&&B[r][6]==o[0].name)return k(B[r],n),B[r][0];const l=4*r*r;pe[l]||(pe[l]=new Uint8Array(l));const h=pe[l];let c;return e.readRenderTargetPixels(o[0],s,a,r,r,h),o[1]&&(fe[l]||(fe[l]=new Uint8Array(l)),c=fe[l],e.readRenderTargetPixels(o[1],s,a,r,r,c)),function(e,t,i,r,n,o,s){let a;s=s||re;let l=0,h=0,c=0,u=-1;B[i]=[-1,-1,null,null,e,t,s[0].name];for(let o=0;o<i*i;o++){const o=l+(i-1)/2,p=h+(i-1)/2;if(o>=0&&o<=i&&p>=0&&p<=i){const l=o+p*i;if(a=r[4*l+2]<<16|r[4*l+1]<<8|r[4*l],a=a<<8>>8,B[i][0]=a,n){var d=n[4*l+1]<<8|n[4*l];B[i][1]=d<<16>>16}if(B[i][2]=2*(e+o)/s[0].width-1,B[i][3]=2*(t+p)/s[0].height-1,-1!==a)break}if(l==h||l<0&&l==-h||l>0&&l==1-h){const e=c;c=-u,u=e}l+=c,h+=u}return k(B[i],o),a}(s,a,r,h,c,n,o)},this.idsAtPixelsBox=function(t,i,r,n,o,s){if((s=s||re)[0]){var a=r*s[0].width,l=n*s[0].height,h=0|.5*(t+1)*s[0].width,c=0|.5*(i+1)*s[0].height,u=new Uint8Array(4*a*l);e.readRenderTargetPixels(s[0],h,c,a,l,u);var d=void 0;o&&s[1]&&(d=new Uint8Array(4*a*l),e.readRenderTargetPixels(s[1],h,c,a,l,d));var p={};for(let e=0;e<u.length;e+=4){var f=u[4*e+2]<<16|u[4*e+1]<<8|u[4*e];if((f=f<<8>>8)>0){var m=0;d&&(m=(m=d[4*e+1]<<8|d[4*e])<<16>>16);var g=f+"-"+m;p[g]||(p[g]=!0,o.push([f,m]))}}}},this.readbackTargetId=function(){if(!re[0])return null;var t=new Uint8Array(4*re[0].width*re[0].height);return e.readRenderTargetPixels(re[0],0,0,re[0].width,re[0].height,t),{buffer:t,width:re[0].width,height:re[0].height}},this.rolloverObjectViewport=function(e,t){me[1]=0;var i=this.idAtPixel(e,t,me);return this.rolloverObjectId(i,null,me[1])},this.rolloverObjectId=function(e,t,i){return Be(e,i,!1)},this.getRollOverDbId=function(){return Me},this.getRollOverModelId=function(){return Te},this.rollOverModelId=function(e){return Be(1,e,!0)},this.setRollOverHighlightColor=function(e){e?_.uniforms.highlightColor.value.copy(e):_.uniforms.highlightColor.value.setRGB(1,1,1)},this.setDbIdForEdgeDetection=function(e,t){_.uniforms.edgeObjIDv4.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255,(e>>24&255)/255),_.uniforms.edgeModelIDv2.value.set((255&t)/255,(t>>8&255)/255)},this.setSpatialFilterForRollOver=function(e){if(!e||this.spatialFilterForRollOverSupported()){var t="SPATIAL_FILTER";_.material.defines[t]!==e&&(e&&""!==e?_.material.defines[t]=e:delete _.material.defines[t],_.material.needsUpdate=!0,_.uniforms.highlightIntensity.value=0,we=performance.now())}else s.logger.warn("Spatial filter for mouse-over can only be used with depth target")},this.spatialFilterForRollOverSupported=function(){return ke(L.Depth)},this.setEdgeColor=function(e){ge.copy(e)},this.setSelectionColor=function(e){var t=new r.Color(e);t.r=Math.pow(t.r,2),t.g=Math.pow(t.g,2),t.b=Math.pow(t.b,2),_.uniforms.selectionColor.value.set(t),_.material.needsUpdate=!0,De.selectionColor=e},this.setUnitScale=function(e){he=e},this.getUnitScale=function(){return he},this.getBlendPass=function(){return _},this.getClearPass=function(){return d},this.getColorTarget=function(){return H},this.getIDTargets=function(){return re},this.getDepthTarget=function(){return T},this.getIdTarget=function(){return re[0]},this.getOverlayIdTarget=function(){return ne},this.getDepthMaterial=function(){return t},this.getPostTarget=function(){return q},this.getEdgeMaterial=function(){return i},this.setCrossFade=function(e){Ie=e},this.getCrossFade=function(){return Ie},this.setOffscreenTarget=function(e){Re=e},this.getOffscreenTarget=function(){return Re},this.getNamedTarget=function(e){switch(e){case"color":return H;case"overlay":return W;case"id":return re[0];case"post1":return q;case"post2":return ie;case"postdisplay":return X;case"ssao":return te;case"depth":return T}return null},this.getCurrentFramebuffer=function(){return e.getCurrentFramebuffer()},this.getConfig=function(){return{renderEdges:De.renderEdges,envMapBackground:De.envMapBg,envMap:d.material.envMap,envExposure:oe,toneMapExposureBias:se,envRotation:this.getEnvRotation(),tonemapMethod:le,clearColor:ve&&ve.clone(),clearColorTop:!ve&&d.uniforms.color1.value.clone(),clearColorBottom:!ve&&d.uniforms.color2.value.clone(),clearAlpha:ye,useOverlayAlpha:be,aoEnabled:this.getAOEnabled(),aoRadius:this.getAORadius(),aoIntensity:this.getAOIntensity(),twoSided:De.haveTwoSided,edgeColor:ge.clone(),unitScale:this.getUnitScale(),is2D:!!_.material.defines.IS_2D,antialias:this.getAntialiasing(),idMaterial:l,selectionColor:De.selectionColor}},this.applyConfig=function(e){this.toggleEdges(e.renderEdges),this.toggleEnvMapBackground(e.envMapBackground),this.setCubeMap(e.envMap),this.setEnvExposure(e.envExposure),this.setTonemapExposureBias(e.toneMapExposureBias),this.setEnvRotation(e.envRotation),this.setTonemapMethod(e.tonemapMethod),this.toggleTwoSided(e.twoSided),this.setEdgeColor(e.edgeColor),this.setUnitScale(e.unitScale),e.clearColor?this.setClearColors(e.clearColor):this.setClearColors(e.clearColorTop,e.clearColorBottom),this.setClearAlpha(e.clearAlpha),this.useOverlayAlpha(e.useOverlayAlpha);var t=!!_.material.defines.IS_2D;e.is2D&&!t?this.enter2DMode(e.idMaterial,e.selectionColor):!e.is2D&&t&&(this.setSelectionColor(e.selectionColor),this.exit2DMode());var i=e.aoEnabled!=this.getAOEnabled(),r=e.antialias!=this.getAntialiasing();(i||r)&&this.initPostPipeline(e.aoEnabled,e.antialias)},this.targetToCanvas=function(t){var i=t.width,r=t.height,n=new Uint8Array(i*r*4);e.readRenderTargetPixels(t,0,0,i,r,n);var o=J.createElement("canvas");o.width=i,o.height=r;var s,a=o.getContext("2d"),l=new Uint8ClampedArray(n);return s=new ImageData(l,i,r),a.putImageData(s,0,0),a.globalCompositeOperation="copy",a.translate(0,r),a.scale(1,-1),a.drawImage(o,0,0,i,r),a.globalCompositeOperation="source-over",{canvas:o,ctx:a}},this.resetRenderStats=function(){e.info.reset()},this.getRenderStats=function(){return Object.assign({},e.info.render)}}},85686:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RenderContextPostProcessExtension:()=>r,RenderContextPostProcessManager:()=>n});class r{constructor(e,t){this.viewer=t,this.renderContext=e,this.postProcPass=null,this.postProcShaded=!1,this.setGlobalManager(t.globalManager)}load(){}unload(){this.viewer=null,this.renderContext=null,this.postProcPass=null}enable(){this.setPostProcShaded(!0);const e=this.renderContext.settings;this.renderContext.initPostPipeline(e.sao,e.antialias),this.viewer.impl.fireRenderOptionChanged(),this.viewer.impl.invalidate(!0,!0,!0)}disable(){this.setPostProcShaded(!1),this.viewer.impl.invalidate(!1,!1,!0)}shouldRenderAfterOverlays(){return!1}render(e,t,i,r){const n=void 0===r||r===this.shouldRenderAfterOverlays();return!(!this.isPostProcShaded()||!n)&&(this.postProcPass.render(e,t,i),!0)}updateUniformValue(e,t,i){this.postProcPass.uniforms[e]&&(i?this.postProcPass.uniforms[e].value.copy(t):this.postProcPass.uniforms[e].value=t,this.viewer.impl.invalidate(!1,!1,!0))}updateDefineValue(e,t){this.postProcPass.material.defines[e]!==t&&(null!==t?this.postProcPass.material.defines[e]=t:delete this.postProcPass.material.defines[e],this.setMaterialNeedsUpdate())}getUniformValue(e){return this.postProcPass.uniforms[e].value}getDefineValue(e){return this.postProcPass.material.defines[e]}changeResolution(e,t){this.postProcPass.uniforms.resolution.value.set(e,t)}setMaterialNeedsUpdate(){this.postProcPass.material.needsUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0)}postProcessEdgesOn(){return!1}setPostProcShaded(e){this.postProcShaded=e}isPostProcShaded(){return this.postProcShaded}getOrder(){return 0}}class n{constructor(){this.rcExtensions=[]}registerPostProcessingExtension(e){this.rcExtensions.push(e),this.rcExtensions.sort(((e,t)=>t.getOrder()-e.getOrder()))}removePostProcessingExtension(e){const t=this.rcExtensions.indexOf(e);-1!==t&&(e.unload(),this.rcExtensions.splice(t,1))}render(e,t,i,r,n){for(let o=0;o<this.rcExtensions.length;o++){if(this.rcExtensions[o].render(e,t,i,n)){i=t;const e=t;t=r,r=e}}return i}updateUniformValue(e,t,i){for(let r=0;r<this.rcExtensions.length;r++)this.rcExtensions[r].updateUniformValue(e,t,i)}changeResolution(e,t){for(let i=0;i<this.rcExtensions.length;i++)this.rcExtensions[i].changeResolution(e,t)}setMaterialNeedsUpdate(){for(let e=0;e<this.rcExtensions.length;e++)this.rcExtensions[e].setMaterialNeedsUpdate()}postProcessEdgesOn(){return this.rcExtensions.some((e=>e.postProcessEdgesOn()))}isPostProcShaded(){return this.rcExtensions.some((e=>e.isPostProcShaded()))}}},74718:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SAOShader:()=>h});var r=i(75050),n=i(77221),o=i(66209),s=i.n(o),a=i(6890),l=i.n(a);let h={uniforms:r.UniformsUtils.merge([n.ShaderChunks.DepthTextureUniforms,{size:{type:"v2",value:new r.Vector2(512,512)},resolution:{type:"v2",value:new r.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:12},bias:{type:"f",value:.1},projScale:{type:"f",value:500},intensity:{type:"f",value:1},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}}]),vertexShader:s(),fragmentShader:l()}},77221:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CutPlanesShaderChunk:()=>Ue,CutPlanesUniforms:()=>Ee,DepthTextureTestUniforms:()=>De,DepthTextureUniforms:()=>Pe,EnvSamplingShaderChunk:()=>ze,FinalOutputShaderChunk:()=>Xe,HatchPatternShaderChunk:()=>Ge,IdFragmentDeclaration:()=>je,IdOutputShaderChunk:()=>qe,IdUniforms:()=>Ae,IdVertexDeclaration:()=>He,IdVertexShaderChunk:()=>We,InstancingVertexDeclaration:()=>Qe,OrderedDitheringShaderChunk:()=>Ve,PackDepthShaderChunk:()=>Fe,PackNormalsShaderChunk:()=>Be,PointSizeDeclaration:()=>tt,PointSizeShaderChunk:()=>it,PointSizeUniforms:()=>Te,ShaderChunks:()=>rt,ShadowMapCommonUniforms:()=>we,ShadowMapDeclareCommonUniforms:()=>Ze,ShadowMapFragmentDeclaration:()=>et,ShadowMapUniforms:()=>Me,ShadowMapVertexDeclaration:()=>Je,ShadowMapVertexShaderChunk:()=>$e,ThemingFragmentDeclaration:()=>Ye,ThemingFragmentShaderChunk:()=>Ke,ThemingUniform:()=>Se,TonemapShaderChunk:()=>ke,WideLinesUniforms:()=>Ce,resolve:()=>Ne});var r=i(75050),n=i(23300),o=i.n(n),s=i(25334),a=i.n(s),l=i(73985),h=i.n(l),c=i(52035),u=i.n(c),d=i(32263),p=i.n(d),f=i(15931),m=i.n(f),g=i(52698),v=i.n(g),y=i(7246),b=i.n(y),x=i(7959),_=i.n(x),E=i(61539),A=i.n(E),S=i(74610),w=i.n(S),M=i(46223),T=i.n(M),C=i(53833),P=i.n(C),D=i(94005),L=i.n(D),I=i(25759),R=i.n(I),O=i(58121),N=i.n(O),F=i(4949),k=i.n(F),V=i(11458),U=i.n(V),B=i(36238),G=i.n(B),z=i(65080),H=i.n(z),W=i(72448),j=i.n(W),q=i(81456),X=i.n(q),Y=i(65355),K=i.n(Y),Q=i(58998),Z=i.n(Q),J=i(72438),$=i.n(J),ee=i(14227),te=i.n(ee),ie=i(16006),re=i.n(ie),ne=i(26649),oe=i.n(ne),se=i(13458),ae=i.n(se),le=i(16017),he=i.n(le),ce=i(68643),ue=i.n(ce),de=i(21600),pe=i.n(de),fe=i(96654),me=i.n(fe),ge=i(86386),ve=i.n(ge),ye=i(19719),be=i.n(ye),xe=i(75603),_e=i.n(xe);let Ee={cutplanes:{type:"v4v",value:[]},cutplanesHideInterior:{type:"i",value:0},hatchParams:{type:"v2",value:new r.Vector2(1,10)},hatchTintColor:{type:"c",value:new r.Color(16777215)},hatchTintIntensity:{type:"f",value:1}},Ae={dbId:{type:"v3",value:new r.Vector3(0,0,0)},modelId:{type:"v3",value:new r.Vector3(0,0,0)}},Se={themingColor:{type:"v4",value:new r.Vector4(0,0,0,0)}},we={shadowESMConstant:{type:"f",value:0}},Me=r.UniformsUtils.merge([{shadowMap:{type:"t",value:null},shadowMapSize:{type:"v2",value:new r.Vector2(0,0)},shadowBias:{type:"f",value:0},shadowDarkness:{type:"f",value:0},shadowMatrix:{type:"m4",value:new r.Matrix4},shadowLightDir:{type:"v3",value:new r.Vector3}},we]),Te={point_size:{type:"f",value:1}},Ce={view_size:{type:"v2",value:new r.Vector2(640,480)}},Pe={tDepth:{type:"t",value:null},projInfo:{type:"v4",value:new r.Vector4},isOrtho:{type:"f",value:0},worldMatrix_mainPass:{type:"m4",value:new r.Matrix4}},De={tDepthTest:{type:"t",value:null},tDepthResolution:{type:"v2",value:new r.Vector2(1/1024,1/1024)}};var Le={};for(var Ie in r.ShaderChunk)Le[Ie]=r.ShaderChunk[Ie];Le.pack_depth=o(),Le.depth_texture=a(),Le.tonemap=h(),Le.ordered_dither=u(),Le.cutplanes=p(),Le.pack_normals=m(),Le.hatch_pattern=v(),Le.env_sample=b(),Le.id_decl_vert=_(),Le.id_vert=A(),Le.id_decl_frag=w(),Le.id_frag=T(),Le.final_frag=P(),Le.theming_decl_frag=L(),Le.theming_frag=R(),Le.instancing_decl_vert=N(),Le.shadowmap_decl_common=k(),Le.shadowmap_decl_vert=U(),Le.shadowmap_vert=G(),Le.shadowmap_decl_frag=H(),Le.float3_average=j(),Le.line_decl_common=X(),Le.prism_wood=K(),Le.prism_glazing=Z(),Le.prism_transparency=$(),Le.normal_map=te(),Le.decl_point_size=re(),Le.point_size=oe(),Le.wide_lines_decl=ae(),Le.wide_lines_vert=he(),Le.hsv=ue(),Le.importance_sampling=pe(),Le.logdepthbuf_decl_frag=me(),Le.logdepthbuf_frag=ve(),Le.logdepthbuf_decl_vert=be(),Le.logdepthbuf_vert=_e();var Re={},Oe={};for(Ie in Re)Oe[Ie]=new RegExp("#"+Ie+" *<([\\w\\d., ]*)>","g");let Ne=function(e){for(var t in Re){var i=Oe[t];e=e.replace(i,(function(e,i){var r=i.split(",").map((function(e){return e.trim()}));return Re[t].apply(null,r)}))}return e.replace(/#include *<([\w\d.]+)>/g,(function(e,t){if(!Le[t])throw new Error("Cannot resolve #include<"+t+">");return Ne(Le[t])}))},Fe=Le.pack_depth,ke=Le.tonemap,Ve=Le.ordered_dither,Ue=Le.cutplanes,Be=Le.pack_normals,Ge=Le.hatch_pattern,ze=Le.env_sample,He=Le.id_decl_vert,We=Le.id_vert,je=Le.id_decl_frag,qe=Le.id_frag,Xe=Le.final_frag,Ye=Le.theming_decl_frag,Ke=Le.theming_frag,Qe=Le.instancing_decl_vert,Ze=Le.shadowmap_decl_common,Je=Le.shadowmap_decl_vert,$e=Le.shadowmap_vert,et=Le.shadowmap_decl_frag,tt=Le.decl_point_size,it=Le.point_size,rt={IdUniforms:Ae,ThemingUniform:Se,CutPlanesUniforms:Ee,ShadowMapCommonUniforms:we,ShadowMapUniforms:Me,PointSizeUniforms:Te,WideLinesUniforms:Ce,DepthTextureUniforms:Pe,DepthTextureTestUniforms:De,PackDepthShaderChunk:Fe,TonemapShaderChunk:ke,OrderedDitheringShaderChunk:Ve,CutPlanesShaderChunk:Ue,PackNormalsShaderChunk:Be,HatchPatternShaderChunk:Ge,EnvSamplingShaderChunk:ze,IdVertexDeclaration:He,IdVertexShaderChunk:We,IdFragmentDeclaration:je,IdOutputShaderChunk:qe,FinalOutputShaderChunk:Xe,ThemingFragmentDeclaration:Ye,ThemingFragmentShaderChunk:Ke,InstancingVertexDeclaration:Qe,ShadowMapDeclareCommonUniforms:Ze,ShadowMapVertexDeclaration:Je,ShadowMapVertexShaderChunk:$e,ShadowMapFragmentDeclaration:et,PointSizeDeclaration:tt,PointSizeShaderChunk:it,...Le,resolve:Ne}},86353:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ShaderPass:()=>o});var r=i(92217),n=i(75050);let o=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.material=(0,r.createShaderMaterial)(e),this.uniforms=this.material.uniforms,this.renderToScreen=!1,this.enabled=!0,this.clear=!1,this.camera=new n.OrthographicCamera(-1,1,1,-1,0,1);var i=new n.BufferGeometry,o=new Float32Array(9);o[0]=-1,o[1]=-1,o[2]=0,o[3]=3,o[4]=-1,o[5]=0,o[6]=-1,o[7]=3,o[8]=0;var s=new Float32Array(6);s[0]=0,s[1]=0,s[2]=2,s[3]=0,s[4]=0,s[5]=2;var a=new Float32Array(9);a[0]=0,a[1]=0,a[2]=1,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=1,i.setAttribute("position",new n.BufferAttribute(o,3)),i.setAttribute("normal",new n.BufferAttribute(a,3)),i.setAttribute("uv",new n.BufferAttribute(s,2)),this.quad=new n.Mesh(i,this.material),this.scene=new n.Scene,this.scene.add(this.quad)};o.prototype={render:function(e,t,i,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i),e.setRenderTarget(t),!this.renderToScreen&&this.clear&&e.clear(),e.render(this.scene,this.camera)}}},92217:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ShaderUtils:()=>a,createShaderMaterial:()=>n,removeMacro:()=>s,setMacro:()=>o});var r=i(75050);let n=function(e){let t={vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return e.uniforms&&(t.uniforms=r.UniformsUtils.clone(e.uniforms)),e.defines&&(t.defines=Object.assign({},e.defines)),e.extensions&&(t.extensions=Object.assign({},e.extensions)),e.attributes&&(t.attributes=e.attributes),new r.ShaderMaterial(t)},o=function(e,t,i){i=i||"",e.defines||(e.defines={}),e.defines[t]!=i&&(e.defines[t]=i,e.needsUpdate=!0)},s=function(e,t){(e.defines||e.defines[t])&&(delete e.defines[t],e.needsUpdate=!0)};const a={createShaderMaterial:n,setMacro:o,removeMacro:s}},22573:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GroundShadowShader:()=>x,SHADOWMAP_INCOMPLETE:()=>S,SHADOWMAP_NEEDS_UPDATE:()=>A,SHADOWMAP_VALID:()=>w,ShadowConfig:()=>E,ShadowMapOverrideMaterials:()=>_,ShadowMapShader:()=>b,ShadowMaps:()=>C,ShadowRender:()=>P});var r=i(77221),n=i(92217),o=i(2724),s=i(93666),a=i(22645),l=i(70179),h=i(75050),c=i(47065),u=i.n(c),d=i(18214),p=i.n(d),f=i(2680),m=i.n(f),g=i(83159),v=i.n(g);let y=function(e,t,i){var r="uv_"+e+"_map",n="";return t&&i?n="if ("+r+".x < 0.0 || "+r+".x > 1.0 || "+r+".y < 0.0 || "+r+".y > 1.0) { discard; }":t?n="if ("+r+".x < 0.0 || "+r+".x > 1.0) { discard; }":i&&(n="if ("+r+".y < 0.0 || "+r+".y > 1.0) { discard; }"),"#define "+e.toUpperCase()+"_CLAMP_TEST "+n},b={uniforms:h.UniformsUtils.merge([r.ShaderChunks.ShadowMapCommonUniforms,{shadowMapRangeMin:{type:"f",value:0},shadowMapRangeSize:{type:"f",value:0},shadowMinOpacity:{type:"f",value:0},map:{type:"t",value:null},alphaMap:{type:"t",value:null},texMatrix:{type:"m3",value:new h.Matrix3},texMatrixAlpha:{type:"m3",value:new h.Matrix3}},(0,o.GetPrismMapUniforms)("surface_cutout_map")]),vertexShader:u(),fragmentShader:p()},x={uniforms:r.ShaderChunks.ShadowMapUniforms,vertexShader:m(),fragmentShader:v()};function _(){var e=[],t=(0,n.createShaderMaterial)(b),i=new h.Material;i.visible=!1;var r=[];var o=new function(){this.init=function(){this.isPrism=!1,this.alphaMap=!1,this.alphaClampS=!1,this.alphaClampT=!1,this.alphaInvert=!1,this.rgbaMap=!1,this.rgbaClampS=!1,this.rgbaClampT=!1,this.rgbaInvert=!1,this.instanced=!1,this.decalIndex=-1},this.init(),this.getMaterialIndex=function(){return(this.isPrism?1:0)|(this.alphaMap?2:0)|(this.alphaClampS?4:0)|(this.alphaClampT?8:0)|(this.alphaInvert?16:0)|(this.rgbaMap?32:0)|(this.rgbaClampS?64:0)|(this.rgbaClampT?128:0)|(this.rgbaInvert?256:0)|(this.instanced?512:0)|1024*(this.decalIndex+1)}};function s(r,s){if((a=r)instanceof h.MeshPhongMaterial?a.opacity<E.ShadowMinOpacity:a.isPrismMaterial?"PrismTransparent"===a.prismType||"PrismGlazing"===a.prismType:!a.visible)return i;var a,l=r instanceof h.MeshPhongMaterial,c=r.isPrismMaterial;if(!l&&!c)return null;var u=l?r.alphaMap:r.surface_cutout_map,d=l&&r.alphaTest?r.map:null;if(!u&&!d&&!r.useInstancing)return null;var p=o;p.init(),p.isPrism=c,p.alphaMap=!!u,p.rgbaMap=!!d,p.instanced=r.useInstancing,p.decalIndex=void 0===s?-1:s,u&&(p.alphaClampS=u.clampS,p.alphaClampT=u.clampT,p.alphaInvert=u.invert),d&&(p.rgbaClampS=d.clampS,p.rgbaClampT=d.clampT,p.rgbaInvert=d.invert);var f=function(i,r){var o=i.getMaterialIndex();if(!e[o]){var s=t.clone();i.isPrism&&i.alphaMap&&((0,n.setMacro)(s,"USE_SURFACE_CUTOUT_MAP"),s.fragmentShader=y("surface_cutout",i.alphaClampS,i.alphaClampT)+"\n"+s.fragmentShader),i.instanced&&(s.useInstancing=!0),e[o]=s}return e[o]}(p);return u&&(l?(f.uniforms.alphaMap.value=u,f.uniforms.texMatrixAlpha.value=u.matrix,f.alphaMap=u,f.side=r.side):(f.uniforms.surface_cutout_map.value=u,f.uniforms.surface_cutout_map_texMatrix.value.copy(u.matrix),f.uniforms.surface_cutout_map_invert.value=u.invert,f.side=h.DoubleSide)),d&&(f.uniforms.map.value=d,f.uniforms.texMatrix.value=d.matrix,f.map=d),f}this.forEachMaterial=function(i){for(var r=0;r<e.length;r++){var n=e[r];n&&i(n)}i(t)},this.getCustomOverrideMaterial=function(e){var t=s(e);if(!t)return null;if(!e.decals)return t.decals=null,t;if(e.decals){r.length=0;for(var i=0;i<e.decals.length;i++){var n=e.decals[i],o=s(n.material,i);if(!o)return null;r.push({uv:n.uv,material:o})}}return t.decals=r,t},this.dispose=function(){this.forEachMaterial((function(e){e.dispose()}))}}const E={ShadowMapSize:1024,ShadowESMConstant:80,ShadowBias:.001,ShadowDarkness:.7,ShadowMapBlurRadius:4,ShadowMinOpacity:.9,UseHardShadows:!1,BlurShadowMap:!0},A=0,S=1,w=2;function M(){this.shadowMap=void 0,this.shadowMapSize=void 0,this.shadowMatrix=void 0,this.shadowLightDir=void 0,this.init=function(e){this.shadowMap=e,this.shadowMapSize=new h.Vector2(e.width,e.height),this.shadowMatrix=new h.Matrix4,this.shadowLightDir=new h.Vector3},this.apply=function(e){e.shadowMap=this.shadowMap,e.shadowMatrix=this.shadowMatrix,e.shadowLightDir=this.shadowLightDir,this.shadowMap?((0,n.setMacro)(e,"USE_SHADOWMAP"),E.UseHardShadows&&(0,n.setMacro)(e,"USE_HARD_SHADOWS")):((0,n.removeMacro)(e,"USE_SHADOWMAP"),(0,n.removeMacro)(e,"USE_HARD_SHADOWS"))}}var T=new M;function C(e){var t=null,i=null,r=new h.OrthographicCamera,o=Math.exp(E.ShadowESMConstant),c=E.UseHardShadows?new h.Color(1,1,1):new h.Color(o,1,1),u=e,d=null,p=null,f=null,m=(0,n.createShaderMaterial)(b),g=new _;m.getCustomOverrideMaterial=g.getCustomOverrideMaterial;var v=null;function y(e,t){e.forEach((function(e){t.apply(e)}))}function C(e){var t=new h.WebGLRenderTarget(e,e,{minFilter:h.LinearFilter,magFilter:h.LinearFilter,format:h.RGBAFormat,type:h.FloatType,stencilBuffer:!1,generateMipmaps:!1});return t.texture.generateMipmaps=!1,t}function P(e){u.setRenderTarget(e),u.setClearColor(c,1),u.clear()}var D,L,I,R,O,N,F,k,V,U,B,G=(D=new h.Matrix4,L=new h.Matrix4,I=new h.Vector3(0,0,0),R=new h.Box3,O=new h.Vector3,N=new h.Vector3,function(e,t,i){e.position.copy(i),e.lookAt(I),D.makeRotationFromQuaternion(e.quaternion),L.copy(D).invert(),R.copy(t).applyMatrix4(L),N=R.getCenter(N),O.set(N.x,N.y,R.max.z),O.applyMatrix4(D),e.position.copy(O),N=R.size(N),e.left=-.5*N.x,e.right=.5*N.x,e.bottom=-.5*N.y,e.top=.5*N.y,e.near=0,e.far=N.z,e.updateMatrixWorld(),e.updateProjectionMatrix()});function z(e){e.uniforms.shadowMapRangeMin.value=r.near,e.uniforms.shadowMapRangeSize.value=r.far-r.near,e.uniforms.shadowESMConstant.value=E.ShadowESMConstant,e.uniforms.shadowMinOpacity.value=E.ShadowMinOpacity}this.init=function(){(t=new M).init(C(E.ShadowMapSize)),i=E.BlurShadowMap?new a.D(E.ShadowMapSize,E.ShadowMapSize,E.ShadowMapBlurRadius,1,{type:t.shadowMap.type,format:t.shadowMap.format}):void 0,(d=(0,n.createShaderMaterial)(x)).depthWrite=!1,d.transparent=!0,p=(0,s.createGroundShape)(d),(f=new h.Scene).add(p),this.groundShapeBox=new h.Box3,P(v=C(1))},this.init(),this.state=A,this.startUpdate=function(e,t,i,n,o){var s=e.getVisibleBounds(!0);return this.beginShadowMapUpdate(i,s,n),e.reset(r,l.RenderFlags.RENDER_SHADOWMAP,!0),this.state=S,t=this.continueUpdate(e,t,o)},this.continueUpdate=function(e,i,r){return i=e.renderSome(this.renderSceneIntoShadowMap,i),e.isDone()?(this.state=w,this.finishShadowMapUpdate(r)):function(e){var i=t.shadowMap;t.shadowMap=v,y(e,t),t.apply(d),t.shadowMap=i}(r),i},this.beginShadowMapUpdate=function(e,i,o){G(r,i,o),z(m),g.forEachMaterial(z),E.UseHardShadows&&((0,n.setMacro)(m,"USE_HARD_SHADOWS"),g.forEachMaterial((function(e){(0,n.setMacro)(e,"USE_HARD_SHADOWS")}))),P(t.shadowMap),this.renderSceneIntoShadowMap(f)},this.renderSceneIntoShadowMap=function(e){e.overrideMaterial=m,u.render(e,r,t.shadowMap),e.overrideMaterial=null},this.finishShadowMapUpdate=function(e){i&&!E.UseHardShadows&&i.render(u,t.shadowMap,t.shadowMap),t.shadowMatrix.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),t.shadowMapRangeMin=r.near,t.shadowMapRangeSize=r.far-r.near,t.shadowLightDir.copy(r.position).normalize(),y(e,t),t.apply(d),this.isValid=!0},this.cleanup=function(e){i&&i.cleanup(),t.shadowMap&&t.shadowMap.dispose(),y(e,T),m.dispose(),g.dispose(),d.dispose(),p.geometry.dispose()},this.setGroundShadowTransform=function(e,t,i,r){(0,s.setGroundShapeTransform)(p,e,t,i,r),this.groundShapeBox.setFromObject(p)},this.renderGroundShadow=function(e,t){u.render(f,e,t,!1)},this.expandByGroundShadow=(F=new h.Plane,k=new h.Ray,V=new h.Vector3,U=new h.Vector3,B=new h.Box3,function(e,t){F.normal.set(0,1,0),F.constant=-e.min.y,k.direction.copy(t).negate().normalize();var i,r,n,o=e.getCenter(V),s=100*o.distanceToSquared(e.min)*100;B.makeEmpty();for(var a=0;a<8;a++){k.origin=(i=e,r=a,n=void 0,(n=new h.Vector3).x=1&r?i.max.x:i.min.x,n.y=2&r?i.max.y:i.min.y,n.z=4&r?i.max.z:i.min.z,n);var l=k.intersectPlane(F,U);l&&(l.distanceToSquared(o)>=s||B.expandByPoint(l))}e.union(B)}),this.getShadowParams=function(){return t},this.getShadowCamera=function(){return r}}const P=function(){};P.RefreshUniformsShadow=function(e,t){e.shadowMap&&(e.shadowMap.value=t.shadowMap),e.shadowMatrix&&(e.shadowMatrix.value=t.shadowMatrix),e.shadowLightDir&&(e.shadowLightDir.value=t.shadowLightDir),e.shadowESMConstant&&(e.shadowESMConstant.value=E.ShadowESMConstant),e.shadowBias&&(e.shadowBias.value=E.ShadowBias),e.shadowMapSize&&(e.shadowMapSize.value=E.ShadowMapSize),e.shadowDarkness&&(e.shadowDarkness.value=E.ShadowDarkness)}},86008:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(70057),n=i.n(r),o=i(70125),s=i.n(o);class a{constructor(e,t,i,r){this.viewerImpl=e,this.renderContext=t,this.glRenderer=i,this.materialManager=r,this.materialName="__material_2Don3D__",this.tmpVec=new THREE.Vector3,this.tmpBox=new THREE.Box3}createContext(){this.sheetContext=new Autodesk.Viewing.Private.RenderContext,this.sheetContext.init(this.glRenderer,this.renderContext.settings.logicalWidth,this.renderContext.settings.logicalHeight,{offscreen:!0});const e=this.renderContext.getConfig();e.antialias=!1,e.renderEdges=!1,e.clearAlpha=0,e.clearColor?e.clearColor.set(1,1,1):(e.clearColorBottom.set(1,1,1),e.clearColorTop.set(1,1,1)),this.sheetContext.applyConfig(e),this.prototypeScene=new THREE.Scene}setSize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.renderContext;this.sheetContext&&(this.sheetContext.setSize(e.settings.logicalWidth,e.settings.logicalHeight),this.updateMaterial())}createScene(){this.setSize(),this.scene=new THREE.Scene,this.planeGeometry=new THREE.PlaneBufferGeometry(1,1),this.material=new THREE.ShaderMaterial({uniforms:{sheetMap:{type:"t",value:this.sheetContext.getColorTarget()},idMap:{type:"t",value:this.sheetContext.getIDTargets()[0]},modelIDv2:{type:"v3",value:new THREE.Vector3},resolution:{type:"v2",value:new THREE.Vector2},alphaTest:{type:"f",value:0}},vertexShader:n(),fragmentShader:s(),side:THREE.DoubleSide,transparent:!0}),this.scene.skipDepthTarget=!0,this.updateMaterial(),this.materialManager.addMaterialNonHDR(this.materialName,this.material),this.mesh=new THREE.Mesh(this.planeGeometry,this.material),this.mesh.matrixAutoUpdate=!1,this.scene.add(this.mesh)}updateMaterial(){if(this.material){const e=this.sheetContext.getColorTarget();this.material.uniforms.sheetMap.value=e,this.material.uniforms.idMap.value=this.sheetContext.getIDTargets()[0],this.material.uniforms.resolution.value.set(1/(e.width||1),1/(e.height||1))}}renderScenePart(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.renderContext;if(!e.frags||!e.frags.is2d)return;this.sheetContext||this.createContext(),this.scene||this.createScene(),this.material.uniforms.alphaTest.value=!e.needsTwoPasses||e.isSecondPass?0:.9;const o=e.modelId,s=this.viewerImpl.modelQueue().findModel(o),a=this.tmpBox.copy(s.getBoundingBox(!0)),l=s.getViewportBounds();l&&a.intersect(l);const h=s.getModelToViewerTransform();this.material.uniforms.modelIDv2.value.set((255&o)/255,(o>>8&255)/255,(o>>16&255)/255),n.getAOEnabled()!==this.sheetContext.getAOEnabled()&&this.sheetContext.initPostPipeline(n.getAOEnabled(),!1),r=r&&s.areAllVisible(),i=!1;this.lastRenderedModel===s&&e.isSecondPass||(this.sheetContext.beginScene(this.prototypeScene,this.viewerImpl.camera,this.viewerImpl.noLights,!0),this.sheetContext.renderScenePart(e,t,i,r,!1),this.sheetContext.presentBuffer());const c=a.getSize(new THREE.Vector3);this.mesh.matrix.makeScale(c.x,c.y,1),a.getCenter(this.tmpVec),this.mesh.matrix.setPosition(this.tmpVec),h&&this.mesh.matrix.multiplyMatrices(h,this.mesh.matrix),this.mesh.matrixWorld.copy(this.mesh.matrix),this.scene.modelId=o,n.renderScenePart(this.scene,t,i,r),this.lastRenderedModel=s}destroy(){this.material&&(this.material.dispose(),this.materialManager.removeNonHDRMaterial(this.materialName),this.material=null),this.planeGeometry&&(this.planeGeometry.dispose(),this.planeGeometry=null),this.sheetContext&&(this.sheetContext.cleanup(),this.context=null),this.renderContext=null,this.glRenderer=null}}},77784:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebGLProgram:()=>l});var r=i(73446),n=i(77221),o=i(75050);const s="#version 300 es\n    #define texture2D texture\n    #define textureCube texture\n    #define attribute in\n    #define varying out\n",a="#version 300 es\n    #define texture2D texture\n    #define textureCube texture\n    #define textureCubeLodEXT textureLod\n    #define gl_FragColor outFragColor\n    #define varying in\n";let l=(h=0,c=function(e){return""!==e},u=function(e,t,i,r,n){var o=r?"1.0-":"",s="texture2D("+e+", (UV))",a="";return n=n||"vec4(0.0)",t&&i?a="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+n+" : ":t?a="((UV).x < 0.0 || (UV).x > 1.0) ? "+n+" : ":i&&(a="((UV).y < 0.0 || (UV).y > 1.0) ? "+n+" : "),"#define GET_"+e.toUpperCase()+"(UV) ("+a+o+s+")"},function(e,t,i,l,d){var p=e,f=p.context,m=i.defines,g=i.__webglShader.uniforms;let v={};v={...i.attributes,...d.attributes};var y=(0,n.resolve)(l.vertexShader),b=(0,n.resolve)(l.fragmentShader),x=i.index0AttributeName;void 0===x&&!0===l.morphTargets&&(x="position");var _,E,A="ENVMAP_MODE_REFLECTION",S=e.gammaFactor>0?e.gammaFactor:1,w=function(e){var t,i,r=[];for(var n in e)!1!==(t=e[n])&&(i="#define "+n+" "+t,r.push(i));return r.join("\n")}(m),M=f.createProgram();i instanceof o.RawShaderMaterial?((_=[s,w].filter(c).join("\n")).length>0&&(_+="\n"),(E=[a,"precision "+l.precisionFragment+" float;",w,"out vec4 outFragColor;"].filter(c).join("\n")).length>0&&(E+="\n")):(_=[s,"precision "+l.precision+" float;","precision "+l.precision+" int;",w,l.vertexPrefix,l.supportsVertexTextures?"#define VERTEX_TEXTURES":"",p.gammaInput?"#define GAMMA_INPUT":"",p.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+S,l.mrtNormals?"#define MRT_NORMALS":"",l.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_BONES "+l.maxBones,"#define NUM_CUTPLANES "+l.numCutplanes,l.loadingAnimationDuration>0?"#define LOADING_ANIMATION":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+A:"",l.irradianceMap?"#define USE_IRRADIANCEMAP":"",l.lightMap?"#define USE_LIGHTMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.vertexIds?"#define USE_VERTEX_ID":"",l.useTiling?"#define USE_TILING":"",l.useInstancing?"#define USE_INSTANCING":"",l.wideLines?"#define WIDE_LINES":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals?"#define USE_MORPHNORMALS":"",l.wrapAround?"#define WRAP_AROUND":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.packedNormals?"#define UNPACK_NORMALS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","#ifdef UNPACK_NORMALS","attribute vec2 normal;","#else","attribute vec3 normal;","#endif","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","   attribute vec3 color;","#endif",""].join("\n"),E=[a,w,l.fragmentPrefix,"#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define NUM_CUTPLANES "+l.numCutplanes,l.loadingAnimationDuration>0?"#define LOADING_ANIMATION":"",l.alphaTest?"#define ALPHATEST "+l.alphaTest:"",p.gammaInput?"#define GAMMA_INPUT":"",p.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+S,l.mrtNormals?"#define MRT_NORMALS":"",l.mrtIdBuffer?"#define MRT_ID_BUFFER":"",l.mrtIdBuffer>1?"#define MODEL_COLOR":"","#define TONEMAP_OUTPUT "+(l.tonemapOutput||0),l.useBackgroundTexture?"#define USE_BACKGROUND_TEXTURE":"",l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define ENVMAP_TYPE_CUBE":"",l.envMap?"#define "+A:"",l.envMap?"#define ENVMAP_BLENDING_MULTIPLY":"",l.irradianceMap?"#define USE_IRRADIANCEMAP":"",l.envGammaEncoded?"#define ENV_GAMMA":"",l.irrGammaEncoded?"#define IRR_GAMMA":"",l.envRGBM?"#define ENV_RGBM":"",l.irrRGBM?"#define IRR_RGBM":"",l.lightMap?"#define USE_LIGHTMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.vertexColors?"#define USE_COLOR":"",l.vertexIds?"#define USE_VERTEX_ID":"",l.metal?"#define METAL":"",l.clearcoat?"#define CLEARCOAT":"",l.wrapAround?"#define WRAP_AROUND":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.hatchPattern?"#define HATCH_PATTERN":"",l.mapInvert?"#define MAP_INVERT":"",l.useTiling?"#define USE_TILING":"",l.useTiling?"#define TILE_RANGE_X_MIN "+l.tilingRepeatRange[0]:"",l.useTiling?"#define TILE_RANGE_Y_MIN "+l.tilingRepeatRange[1]:"",l.useTiling?"#define TILE_RANGE_X_MAX "+l.tilingRepeatRange[2]:"",l.useTiling?"#define TILE_RANGE_Y_MAX "+l.tilingRepeatRange[3]:"",l.hasRoundCorner?"#define USE_TILING_NORMAL":"",l.useRandomOffset?"#define USE_TILING_RANDOM":"",u("map",l.mapClampS,l.mapClampT),u("bumpMap",l.bumpMapClampS,l.bumpMapClampT),u("normalMap",l.normalMapClampS,l.normalMapClampT),u("specularMap",l.specularMapClampS,l.specularMapClampT),u("alphaMap",l.alphaMapClampS,l.alphaMapClampT,l.alphaMapInvert),l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF_EXT":"",l.logarithmicDepthBuffer&&l.polygonOffset?"#define POLYGON_OFFSET":"","precision "+l.precisionFragment+" float;","precision "+l.precisionFragment+" int;","layout(location = 0) out vec4 outFragColor;","uniform highp mat4 viewMatrix;","uniform highp mat4 projectionMatrix;","uniform highp vec3 cameraPosition;","#if defined(USE_ENVMAP) || defined(USE_IRRADIANCEMAP)","uniform mat4 viewMatrixInverse;","#endif",""].join("\n"));var T=new r.WebGLShader(f,f.VERTEX_SHADER,_+y),C=new r.WebGLShader(f,f.FRAGMENT_SHADER,E+b);f.attachShader(M,T),f.attachShader(M,C),void 0!==x&&f.bindAttribLocation(M,0,x),f.linkProgram(M),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===f.getProgramParameter(M,f.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",f.getProgramParameter(M,f.VALIDATE_STATUS)),console.error("gl.getError()",f.getError())),""!==f.getProgramInfoLog(M)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",f.getProgramInfoLog(M))),f.deleteShader(T),f.deleteShader(C);var P=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","viewMatrixInverse","mvpMatrix","dbId"];for(var D in g)P.push(D);for(var L in P.push("logDepthBufFC","polygonOffset"),this.uniforms=function(e,t,i){for(var r={},n=0,o=i.length;n<o;n++){var s=i[n];r[s]=e.getUniformLocation(t,s)}return r}(f,M,P),P=["position","normal","uv","uv2","tangent","color","lineDistance","uvw","id","instOffset","instScaling","instRotation","prev","next","side","uvp","pointScale"],v)P.push(L);return this.attributes=function(e,t,i){for(var r={},n=0,o=i.length;n<o;n++){var s=i[n];r[s]=e.getAttribLocation(t,s)}return r}(f,M,P),this.attributesKeys=Object.keys(this.attributes),this.id=h++,this.code=t,this.usedTimes=1,this.program=M,this.vertexShader=T,this.fragmentShader=C,this});var h,c,u},742:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEBUG_TEXTURE_LOAD:()=>c,WebGLRenderer:()=>p});var r=i(77784),n=i(22573),o=i(8544),s=i(56144),a=i(7247),l=i(75050),h=i(93549);let c=!1;const u=(0,a.getGlobal)(),d=u.document;let p=function(e){console.log("THREE.WebGLRenderer",l.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:d.createElement("canvas"),i=null,a=void 0!==e.precision?e.precision:"highp",p=a,f=void 0!==e.alpha&&e.alpha,m=void 0===e.premultipliedAlpha||e.premultipliedAlpha,g=void 0!==e.antialias&&e.antialias,v=void 0===e.stencil||e.stencil,y=void 0===e.preserveDrawingBuffer||e.preserveDrawingBuffer,b=e.logarithmicDepthBuffer,x=new l.Color(0),_=0,E=[],A={},S=new l.Matrix4,w=new l.Matrix3;this.highResTimeStamp=0;var M=[],T=[];this.domElement=t,this.context=null,this.refCount=0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0},reset:function(){this.render.calls=0}};var C,P=this,D=[],L=null,I=null,R=null,O=null,N=-1,F=null,k="",V=0,U="",B="",G=0,z=0,H=0,W=t.width,j=t.height,q=(new l.Vector4,{}),X=new l.Frustum,Y=new l.Matrix4,K=new l.Matrix4,Q=new l.Vector3,Z=new l.Vector3,J=!0,$={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};P.capabilities={};try{var ee={alpha:f,premultipliedAlpha:m,antialias:g,stencil:v,powerPreference:"high-performance",preserveDrawingBuffer:y};if(C=t.getContext("webgl2",ee),P.capabilities.isWebGL2=!0,null===C)throw null!==t.getContext("webgl2",ee)?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";const e=C.getExtension("WEBGL_debug_renderer_info");if(e){const t=C.getParameter(e.UNMASKED_VENDOR_WEBGL),i=C.getParameter(e.UNMASKED_RENDERER_WEBGL);console.log("WebGL Renderer: "+i),console.log("WebGL Vendor: "+t)}0==C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.HIGH_FLOAT).precision&&(p="mediump"),t.addEventListener("webglcontextlost",(function(e){e.preventDefault(),ae(),se(),A={},ft={},mt=0,le.dispose(),D.length=0}),!1),t.addEventListener("webglcontextrestored",(function(e){e.preventDefault(),P.enableContextRestore&&(ne(),xe(),P.lostContextRecovery=P.lostContextRecovery||new o.ZP,P.lostContextRecovery.onContextRestored(),L=null,I=null)}))}catch(e){return void console.error(e)}let te,ie,re;function ne(){te=new l.WebGLExtensions(C),ie=new l.WebGLState(C,Ut),re=ie,te.get("EXT_texture_filter_anisotropic"),te.get("WEBGL_compressed_texture_s3tc"),te.get("EXT_color_buffer_float"),P.extensions=te}void 0===C.getShaderPrecisionFormat&&(C.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),ne();var oe=function(e,t,i,r){!0===m&&(e*=r,t*=r,i*=r),C.clearColor(e,t,i,r)},se=function(){C.clearColor(0,0,0,1),C.clearDepth(1),C.clearStencil(0),C.enable(C.DEPTH_TEST),C.depthFunc(C.LEQUAL),C.frontFace(C.CCW),C.cullFace(C.BACK),C.enable(C.CULL_FACE),C.enable(C.BLEND),C.blendEquation(C.FUNC_ADD),C.blendFunc(C.SRC_ALPHA,C.ONE_MINUS_SRC_ALPHA),C.viewport(z,H,W,j),oe(x.r,x.g,x.b,_)},ae=function(){L=null,F=null,k="",N=-1,J=!0,ie.reset(),re.disableUnusedAttributes()};se(),this.context=C,this.state=ie;for(var le,he=C.getParameter(C.MAX_TEXTURE_IMAGE_UNITS),ce=C.getParameter(C.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ue=C.getParameter(C.MAX_TEXTURE_SIZE),de=C.getParameter(C.MAX_CUBE_MAP_TEXTURE_SIZE),pe=ce>0,fe=C.getShaderPrecisionFormat(C.VERTEX_SHADER,C.HIGH_FLOAT),me=C.getShaderPrecisionFormat(C.VERTEX_SHADER,C.MEDIUM_FLOAT),ge=C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.HIGH_FLOAT),ve=C.getShaderPrecisionFormat(C.FRAGMENT_SHADER,C.MEDIUM_FLOAT),ye=new Uint8Array(16),be=0;be<4;be++)c?1===be||2===be?(ye[4*be]=246,ye[4*be+1]=140,ye[4*be+2]=220):(ye[4*be]=48,ye[4*be+1]=195,ye[4*be+2]=3):ye[4*be]=ye[4*be+1]=ye[4*be+2]=0,ye[4*be+3]=255;function xe(){(le=new l.DataTexture(ye,2,2,l.RGBAFormat,l.UnsignedByteType,l.UVMapping,l.RepeatWrapping,l.RepeatWrapping,l.NearestFilter,l.NearestFilter)).needsUpdate=!0}xe();var _e,Ee,Ae=function(){if(void 0!==_e)return _e;if(_e=[],te.get("WEBGL_compressed_texture_pvrtc")||te.get("WEBGL_compressed_texture_s3tc"))for(var e=C.getParameter(C.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)_e.push(e[t]);return _e},Se=fe.precision>0,we=me.precision>0;"highp"!==a||Se||(we?(a="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(a="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==a||we||(a="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),Se=ge.precision>0,we=ve.precision>0,"highp"!==p||Se||(we?(p="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(p="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==p||we||(p="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return C},this.isWebGL2=function(){return!0},this.forceContextLoss=function(){te.get("WEBGL_lose_context").loseContext()},this.forceContextRestore=function(){te.get("WEBGL_lose_context").restoreContext()},this.getMaxAnisotropy=function(){if(void 0!==Ee)return Ee;var e=te.get("EXT_texture_filter_anisotropic");return Ee=null!==e?C.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPixelRatio=function(){return i||u.devicePixelRatio||1},this.setPixelRatio=function(e){i=e},this.getCurrentFramebuffer=function(){return I},this.setSize=function(e,i,r){const n=this.getPixelRatio();t.width=e*n,t.height=i*n,!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i)},this.setViewport=function(e,t,i,r){const n=this.getPixelRatio();z=e*n,H=t*n,W=i*n,j=r*n,C.viewport(z,H,W,j)};var Me=!1;this.enableViewportOnOffscreenTargets=function(e){Me=e};var Te=[];function Ce(e){e.__webglVertexBuffer=C.createBuffer(),e.__webglNormalBuffer=C.createBuffer(),e.__webglTangentBuffer=C.createBuffer(),e.__webglColorBuffer=C.createBuffer(),e.__webglUVBuffer=C.createBuffer(),e.__webglUV2Buffer=C.createBuffer(),e.__webglSkinIndicesBuffer=C.createBuffer(),e.__webglSkinWeightsBuffer=C.createBuffer(),e.__webglFaceBuffer=C.createBuffer(),e.__webglLineBuffer=C.createBuffer(),P.info.memory.geometries++}this.pushViewport=function(){Te.push(z),Te.push(H),Te.push(W),Te.push(j)},this.popViewport=function(){var e=Te.length-4;z=Te[e],H=Te[e+1],W=Te[e+2],j=Te[e+3],C.viewport(z,H,W,j),Te.length=e},this.setScissor=function(e,t,i,r){const n=this.getPixelRatio();C.scissor(e*n,t*n,i*n,r*n)},this.enableScissorTest=function(e){e?C.enable(C.SCISSOR_TEST):C.disable(C.SCISSOR_TEST)},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new l.Color),e.copy(x)},this.setClearColor=function(e,t){x.set(e),_=void 0!==t?t:1,oe(x.r,x.g,x.b,_)},this.getClearAlpha=function(){return _},this.setClearAlpha=function(e){_=e,oe(x.r,x.g,x.b,_)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=C.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=C.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=C.STENCIL_BUFFER_BIT),C.clear(r)},this.clearColor=function(){C.clear(C.COLOR_BUFFER_BIT)},this.clearDepth=function(){C.clear(C.DEPTH_BUFFER_BIT)},this.clearStencil=function(){C.clear(C.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.resetGLState=ae;var Pe=function(e){e.target.traverse((function(e){e.removeEventListener("remove",Pe),function(e){(e instanceof l.Mesh||e instanceof l.PointCloud||e instanceof l.Line)&&delete A[e.id];delete e.__webglInit,delete e.__webglActive}(e)}))},De=function(e){var t=e.target;t.removeEventListener("dispose",De),Ne(t)},Le=function(e){var t=e.target;t.removeEventListener("dispose",Le),Be(t),P.info.memory.textures--},Ie=function(e){var t=e.target;t.removeEventListener("dispose",Ie),Ge(t),P.info.memory.textures--},Re=function(e){var t=e.target;t.removeEventListener("dispose",Re),ze(t)},Oe=function(e){if(void 0!==e.__webglVertexBuffer&&(C.deleteBuffer(e.__webglVertexBuffer),e.__webglVertexBuffer=void 0),void 0!==e.__webglNormalBuffer&&(C.deleteBuffer(e.__webglNormalBuffer),e.__webglNormalBuffer=void 0),void 0!==e.__webglTangentBuffer&&(C.deleteBuffer(e.__webglTangentBuffer),e.__webglTangentBuffer=void 0),void 0!==e.__webglColorBuffer&&(C.deleteBuffer(e.__webglColorBuffer),e.__webglColorBuffer=void 0),void 0!==e.__webglUVBuffer&&(C.deleteBuffer(e.__webglUVBuffer),e.__webglUVBuffer=void 0),void 0!==e.__webglUV2Buffer&&(C.deleteBuffer(e.__webglUV2Buffer),e.__webglUV2Buffer=void 0),void 0!==e.__webglSkinIndicesBuffer&&(C.deleteBuffer(e.__webglSkinIndicesBuffer),e.__webglSkinIndicesBuffer=void 0),void 0!==e.__webglSkinWeightsBuffer&&(C.deleteBuffer(e.__webglSkinWeightsBuffer),e.__webglSkinWeightsBuffer=void 0),void 0!==e.__webglFaceBuffer&&(C.deleteBuffer(e.__webglFaceBuffer),e.__webglFaceBuffer=void 0),void 0!==e.__webglLineBuffer&&(C.deleteBuffer(e.__webglLineBuffer),e.__webglLineBuffer=void 0),void 0!==e.__webglLineDistanceBuffer&&(C.deleteBuffer(e.__webglLineDistanceBuffer),e.__webglLineDistanceBuffer=void 0),void 0!==e.__webglCustomAttributesList){for(var t in e.__webglCustomAttributesList)C.deleteBuffer(e.__webglCustomAttributesList[t].buffer);e.__webglCustomAttributesList=void 0}P.info.memory.geometries--},Ne=function(e){var t,i,r,n;if(e.__webglInit=void 0,e instanceof l.BufferGeometry){if(void 0!==e.vbbuffer&&(C.deleteBuffer(e.vbbuffer),e.vbbuffer=void 0),void 0!==e.ibbuffer&&(C.deleteBuffer(e.ibbuffer),e.ibbuffer=void 0),void 0!==e.iblinesbuffer&&(C.deleteBuffer(e.iblinesbuffer),e.iblinesbuffer=void 0),e.vaos){for(t=0;t<e.vaos.length;t++)C.deleteVertexArray(e.vaos[t].vao);e.vaos=void 0}var o=e.attributes;for(var s in o)void 0!==o[s].buffer&&(C.deleteBuffer(o[s].buffer),o[s].buffer=void 0);P.info.memory.geometries--}else{var a=ft[e.id];if(void 0!==a){for(t=0,i=a.length;t<i;t++){var h=a[t];if(void 0!==h.numMorphTargets){for(r=0,n=h.numMorphTargets;r<n;r++)C.deleteBuffer(h.__webglMorphTargetsBuffers[r]);delete h.__webglMorphTargetsBuffers}if(void 0!==h.numMorphNormals){for(r=0,n=h.numMorphNormals;r<n;r++)C.deleteBuffer(h.__webglMorphNormalsBuffers[r]);delete h.__webglMorphNormalsBuffers}Oe(h)}delete ft[e.id]}else Oe(e)}};this.deallocateGeometry=Ne;var Fe,ke,Ve,Ue,Be=function(e){if(e.__webglTextureCube)C.deleteTexture(e.__webglTextureCube),e.__webglTextureCube=void 0;else{if(!e.__webglInit)return;C.deleteTexture(e.__webglTexture),e.__webglInit=void 0,e.__webglTexture=void 0}},Ge=function(e){e&&e.__webglTexture&&(C.deleteTexture(e.__webglTexture),C.deleteFramebuffer(e.__webglFramebuffer),void 0!==e.__webglRenderbuffer&&C.deleteRenderbuffer(e.__webglRenderbuffer),void 0!==e.__webglRenderbufferOwn&&(C.deleteRenderbuffer(e.__webglRenderbufferOwn),e.__webglRenderbufferOwn=void 0))},ze=function(e){var t=!1;e.program=void 0,e.programs.forEach((function(e){var i,r,n,o;if(void 0!==e&&null!=(i=e.program))for(r=0,n=D.length;r<n;r++)if((o=D[r])&&o.program===i){o.usedTimes--,0===o.usedTimes&&(D[r]=void 0,C.deleteProgram(i),P.info.memory.programs--,t=!0);break}}),!1),e.programs.length=0,t&&(D=D.filter((function(e){return void 0!==e})))};function He(e,t){var i=e.vertices.length,r=t.material;if(r.attributes)for(var n in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),r.attributes){var o=r.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(i*s),o.buffer=C.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function We(e,t){var i=t.geometry,r=e.faces3,n=3*r.length,o=1*r.length,s=3*r.length,a=je(t,e),l=Ye(a),h=qe(a),c=Xe(a);e.__vertexArray=new Float32Array(3*n),h&&(e.__normalArray=new Float32Array(3*n)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*n)),c&&(e.__colorArray=new Float32Array(3*n)),l&&(i.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*n)),i.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*n))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*n),e.__skinWeightArray=new Float32Array(4*n));var u=o>21845?Uint32Array:Uint16Array;if(e.__typeArray=u,e.__faceArray=new u(3*o),e.__lineArray=new u(2*s),e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes)for(var d in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),a.attributes){var p=a.attributes[d],f={};for(var m in p)f[m]=p[m];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3),f.size=g,f.array=new Float32Array(n*g),f.buffer=C.createBuffer(),f.buffer.belongsToAttribute=d,p.needsUpdate=!0,f.__original=p}e.__webglCustomAttributesList.push(f)}e.__inittedArrays=!0}function je(e,t){return e.material instanceof l.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function qe(e){return!(e instanceof l.MeshBasicMaterial&&!e.envMap||e instanceof l.MeshDepthMaterial)&&(function(e){return e&&(void 0!==e.shading&&e.shading===l.SmoothShading||void 0!==e.flatShading&&!1===e.flatShading)}(e)?l.SmoothShading:l.FlatShading)}function Xe(e){return!!e.vertexColors&&e.vertexColors}function Ye(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e instanceof l.ShaderMaterial)}function Ke(e){return!0===e.needsUpdate}function Qe(e){e.needsUpdate=!1}function Ze(e,t,i,r,n){if(e.__inittedArrays){var o,s,a,h,c,u,d,p,f,m,g,v,y,b,x,_,E,A,S,w,M,T,P,D,L,I,R=qe(n),O=Xe(n),N=Ye(n),F=R===l.SmoothShading,k=0,V=0,U=0,B=0,G=0,z=0,H=0,W=0,j=0,q=0,X=e.__vertexArray,Y=e.__uvArray,K=e.__uv2Array,Q=e.__normalArray,Z=e.__tangentArray,J=e.__colorArray,$=e.__webglCustomAttributesList,ee=e.__faceArray,te=e.__lineArray,ie=t.geometry,re=ie.verticesNeedUpdate,ne=ie.elementsNeedUpdate,oe=ie.uvsNeedUpdate,se=ie.normalsNeedUpdate,ae=ie.tangentsNeedUpdate,le=ie.colorsNeedUpdate,he=ie.vertices,ce=e.faces3,ue=ie.faces,de=ie.faceVertexUvs[0],pe=ie.faceVertexUvs[1];if(re){for(o=0,s=ce.length;o<s;o++)g=he[(a=ue[ce[o]]).a],v=he[a.b],y=he[a.c],X[V]=g.x,X[V+1]=g.y,X[V+2]=g.z,X[V+3]=v.x,X[V+4]=v.y,X[V+5]=v.z,X[V+6]=y.x,X[V+7]=y.y,X[V+8]=y.z,V+=9;C.bindBuffer(C.ARRAY_BUFFER,e.__webglVertexBuffer),C.bufferData(C.ARRAY_BUFFER,X,i)}if(le&&O){for(o=0,s=ce.length;o<s;o++)u=(a=ue[ce[o]]).vertexColors,d=a.color,3===u.length&&O===l.VertexColors?(E=u[0],A=u[1],S=u[2]):(E=d,A=d,S=d),J[j]=E.r,J[j+1]=E.g,J[j+2]=E.b,J[j+3]=A.r,J[j+4]=A.g,J[j+5]=A.b,J[j+6]=S.r,J[j+7]=S.g,J[j+8]=S.b,j+=9;j>0&&(C.bindBuffer(C.ARRAY_BUFFER,e.__webglColorBuffer),C.bufferData(C.ARRAY_BUFFER,J,i))}if(ae&&ie.hasTangents){for(o=0,s=ce.length;o<s;o++)b=(p=(a=ue[ce[o]]).vertexTangents)[0],x=p[1],_=p[2],Z[H]=b.x,Z[H+1]=b.y,Z[H+2]=b.z,Z[H+3]=b.w,Z[H+4]=x.x,Z[H+5]=x.y,Z[H+6]=x.z,Z[H+7]=x.w,Z[H+8]=_.x,Z[H+9]=_.y,Z[H+10]=_.z,Z[H+11]=_.w,H+=12;C.bindBuffer(C.ARRAY_BUFFER,e.__webglTangentBuffer),C.bufferData(C.ARRAY_BUFFER,Z,i)}if(se&&R){for(o=0,s=ce.length;o<s;o++)if(h=(a=ue[ce[o]]).vertexNormals,c=a.normal,3===h.length&&F)for(w=0;w<3;w++)T=h[w],Q[z]=T.x,Q[z+1]=T.y,Q[z+2]=T.z,z+=3;else for(w=0;w<3;w++)Q[z]=c.x,Q[z+1]=c.y,Q[z+2]=c.z,z+=3;C.bindBuffer(C.ARRAY_BUFFER,e.__webglNormalBuffer),C.bufferData(C.ARRAY_BUFFER,Q,i)}if(oe&&de&&N){for(o=0,s=ce.length;o<s;o++)if(void 0!==(f=de[ce[o]]))for(w=0;w<3;w++)P=f[w],Y[U]=P.x,Y[U+1]=P.y,U+=2;U>0&&(C.bindBuffer(C.ARRAY_BUFFER,e.__webglUVBuffer),C.bufferData(C.ARRAY_BUFFER,Y,i))}if(oe&&pe&&N){for(o=0,s=ce.length;o<s;o++)if(void 0!==(m=pe[ce[o]]))for(w=0;w<3;w++)D=m[w],K[B]=D.x,K[B+1]=D.y,B+=2;B>0&&(C.bindBuffer(C.ARRAY_BUFFER,e.__webglUV2Buffer),C.bufferData(C.ARRAY_BUFFER,K,i))}if(ne){for(o=0,s=ce.length;o<s;o++)ee[G]=k,ee[G+1]=k+1,ee[G+2]=k+2,G+=3,te[W]=k,te[W+1]=k+1,te[W+2]=k,te[W+3]=k+2,te[W+4]=k+1,te[W+5]=k+2,W+=6,k+=3;C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,ee,i),C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,te,i)}if($)for(w=0,M=$.length;w<M;w++)if(Ke((I=$[w]).__original)){if(q=0,1===I.size){if(void 0===I.boundTo||"vertices"===I.boundTo)for(o=0,s=ce.length;o<s;o++)a=ue[ce[o]],I.array[q]=I.value[a.a],I.array[q+1]=I.value[a.b],I.array[q+2]=I.value[a.c],q+=3;else if("faces"===I.boundTo)for(o=0,s=ce.length;o<s;o++)L=I.value[ce[o]],I.array[q]=L,I.array[q+1]=L,I.array[q+2]=L,q+=3}else if(2===I.size){if(void 0===I.boundTo||"vertices"===I.boundTo)for(o=0,s=ce.length;o<s;o++)a=ue[ce[o]],g=I.value[a.a],v=I.value[a.b],y=I.value[a.c],I.array[q]=g.x,I.array[q+1]=g.y,I.array[q+2]=v.x,I.array[q+3]=v.y,I.array[q+4]=y.x,I.array[q+5]=y.y,q+=6;else if("faces"===I.boundTo)for(o=0,s=ce.length;o<s;o++)g=L=I.value[ce[o]],v=L,y=L,I.array[q]=g.x,I.array[q+1]=g.y,I.array[q+2]=v.x,I.array[q+3]=v.y,I.array[q+4]=y.x,I.array[q+5]=y.y,q+=6}else if(3===I.size){var fe;if(fe="c"===I.type?["r","g","b"]:["x","y","z"],void 0===I.boundTo||"vertices"===I.boundTo)for(o=0,s=ce.length;o<s;o++)a=ue[ce[o]],g=I.value[a.a],v=I.value[a.b],y=I.value[a.c],I.array[q]=g[fe[0]],I.array[q+1]=g[fe[1]],I.array[q+2]=g[fe[2]],I.array[q+3]=v[fe[0]],I.array[q+4]=v[fe[1]],I.array[q+5]=v[fe[2]],I.array[q+6]=y[fe[0]],I.array[q+7]=y[fe[1]],I.array[q+8]=y[fe[2]],q+=9;else if("faces"===I.boundTo)for(o=0,s=ce.length;o<s;o++)g=L=I.value[ce[o]],v=L,y=L,I.array[q]=g[fe[0]],I.array[q+1]=g[fe[1]],I.array[q+2]=g[fe[2]],I.array[q+3]=v[fe[0]],I.array[q+4]=v[fe[1]],I.array[q+5]=v[fe[2]],I.array[q+6]=y[fe[0]],I.array[q+7]=y[fe[1]],I.array[q+8]=y[fe[2]],q+=9;else if("faceVertices"===I.boundTo)for(o=0,s=ce.length;o<s;o++)g=(L=I.value[ce[o]])[0],v=L[1],y=L[2],I.array[q]=g[fe[0]],I.array[q+1]=g[fe[1]],I.array[q+2]=g[fe[2]],I.array[q+3]=v[fe[0]],I.array[q+4]=v[fe[1]],I.array[q+5]=v[fe[2]],I.array[q+6]=y[fe[0]],I.array[q+7]=y[fe[1]],I.array[q+8]=y[fe[2]],q+=9}else if(4===I.size)if(void 0===I.boundTo||"vertices"===I.boundTo)for(o=0,s=ce.length;o<s;o++)a=ue[ce[o]],g=I.value[a.a],v=I.value[a.b],y=I.value[a.c],I.array[q]=g.x,I.array[q+1]=g.y,I.array[q+2]=g.z,I.array[q+3]=g.w,I.array[q+4]=v.x,I.array[q+5]=v.y,I.array[q+6]=v.z,I.array[q+7]=v.w,I.array[q+8]=y.x,I.array[q+9]=y.y,I.array[q+10]=y.z,I.array[q+11]=y.w,q+=12;else if("faces"===I.boundTo)for(o=0,s=ce.length;o<s;o++)g=L=I.value[ce[o]],v=L,y=L,I.array[q]=g.x,I.array[q+1]=g.y,I.array[q+2]=g.z,I.array[q+3]=g.w,I.array[q+4]=v.x,I.array[q+5]=v.y,I.array[q+6]=v.z,I.array[q+7]=v.w,I.array[q+8]=y.x,I.array[q+9]=y.y,I.array[q+10]=y.z,I.array[q+11]=y.w,q+=12;else if("faceVertices"===I.boundTo)for(o=0,s=ce.length;o<s;o++)g=(L=I.value[ce[o]])[0],v=L[1],y=L[2],I.array[q]=g.x,I.array[q+1]=g.y,I.array[q+2]=g.z,I.array[q+3]=g.w,I.array[q+4]=v.x,I.array[q+5]=v.y,I.array[q+6]=v.z,I.array[q+7]=v.w,I.array[q+8]=y.x,I.array[q+9]=y.y,I.array[q+10]=y.z,I.array[q+11]=y.w,q+=12;C.bindBuffer(C.ARRAY_BUFFER,I.buffer),C.bufferData(C.ARRAY_BUFFER,I.array,i)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Je(e){if(e.streamingDraw){if(!e.streamingIndex){var t=e.index;t&&(t.buffer=C.createBuffer(),C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,t.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,t.array||e.ib,C.STATIC_DRAW))}}else{e.vb&&void 0===e.vbbuffer&&(e.vbbuffer=C.createBuffer(),e.vbNeedsUpdate=!0),e.ib&&void 0===e.ibbuffer&&(e.ibbuffer=C.createBuffer(),e.ibNeedsUpdate=!0),e.iblines&&void 0===e.iblinesbuffer&&(e.iblinesbuffer=C.createBuffer(),e.iblinesNeedsUpdate=!0);for(var i=e.attributes,r=Object.keys(e.attributes),n=0,o=r.length;n<o;n++){var s=r[n],a=i[s],l="index"===s;if(a.array&&void 0===a.buffer&&(a.buffer=C.createBuffer(),a.needsUpdate=!0),Ke(a)){var h=l?C.ELEMENT_ARRAY_BUFFER:C.ARRAY_BUFFER;C.bindBuffer(h,a.buffer),C.bufferData(h,a.array,C.STATIC_DRAW),Qe(a),e.discardAfterUpload&&(a.array=null)}}e.vbNeedsUpdate&&(C.bindBuffer(C.ARRAY_BUFFER,e.vbbuffer),C.bufferData(C.ARRAY_BUFFER,e.vb,C.STATIC_DRAW),e.vbNeedsUpdate=!1,e.discardAfterUpload&&(e.vbLength=e.vb.length,e.vb=null)),e.ibNeedsUpdate&&(C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,e.ibbuffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,e.ib,C.STATIC_DRAW),e.ibNeedsUpdate=!1,e.discardAfterUpload&&(e.ibLength=e.ib.length,e.ibByteSize=e.ib instanceof Uint32Array?4:2,e.ib=null)),e.iblinesNeedsUpdate&&(C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,e.iblinesbuffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,e.iblines,C.STATIC_DRAW),e.iblinesNeedsUpdate=!1,e.discardAfterUpload&&(e.iblinesLength=e.iblines.length,e.iblinesByteSize=e.iblines instanceof Uint32Array?4:2,e.iblines=null))}}function $e(e,t,i,r){var n=i.vaos;if(n)for(var o=0,s=n.length;o<s;o++){var a=n[o];if(a.geomhash===t.id&&a.uv===r)return C.bindVertexArray(a.vao),!0}else if(null===n)return!1;return function(e,t,i,r){var n,o,s;if(!h.USE_VAO||i.streamingDraw)return i.vaos=null,!1;if(void 0===i.vaos&&(i.vaos=[]),s=C.createVertexArray(),i.vaos.push({geomhash:t.id,uv:r,vao:s}),C.bindVertexArray(s),e.isEdgeMaterial)C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,i.iblinesbuffer);else{var a=i.index;a&&C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,a.buffer||i.ibbuffer)}for(var l=null,c=t.attributes,u=t.attributesKeys,d=i.vbstride,p=null!==(n=i.groups)&&void 0!==n&&n.length?i.groups[0].index:0,f=null!==(o=i.groups)&&void 0!==o&&o.length&&i.groups[0].instanceStart||0,m=0,g=u.length;m<g;m++){var v=u[m],y=c[v];if(y>=0){var b=i.attributes[v];if("uv"===v&&r&&(b=i.attributes["uv"+(r+1)]),!b){C.bindVertexArray(null);for(var x=0;x<i.vaos.length;x++)C.deleteVertexArray(i.vaos[x].vao);return i.vaos=null,!1}var _=C.FLOAT,E=b.bytesPerItem||4;1===E?_=C.UNSIGNED_BYTE:2===E&&(_=C.UNSIGNED_SHORT),C.enableVertexAttribArray(y);var A=p;b.divisor&&(A+=f),void 0!==b.itemOffset?(l!=i.vbbuffer&&(C.bindBuffer(C.ARRAY_BUFFER,i.vbbuffer),l=i.vbbuffer),C.vertexAttribPointer(y,b.itemSize,_,b.normalized,4*d,4*(b.itemOffset+A*d))):(C.bindBuffer(C.ARRAY_BUFFER,b.buffer),l=b.buffer,C.vertexAttribPointer(y,b.itemSize,_,b.normalized,0,A*b.itemSize*E)),C.vertexAttribDivisor(y,i.numInstances&&b.divisor||0)}}return!0}(e,t,i,r)}function et(e,t){var i=q[e];return i||(i=C.createBuffer(),q[e]=i),C.bindBuffer(C.ARRAY_BUFFER,i),C.bufferData(C.ARRAY_BUFFER,t,C.DYNAMIC_DRAW),i}function tt(e,t,i,r,n,o,s){var a,l=t.attributes,h=t.attributesKeys,c=0;if(n)if(!n.buffer&&i.streamingDraw){var u=q.index;u||(u=C.createBuffer(),q.index=u),C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,u),e.isEdgeMaterial?C.bufferData(C.ELEMENT_ARRAY_BUFFER,i.iblines,C.DYNAMIC_DRAW):C.bufferData(C.ELEMENT_ARRAY_BUFFER,n.array||i.ib,C.DYNAMIC_DRAW)}else e.isEdgeMaterial?C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,i.iblinesbuffer):C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,n.buffer||i.ibbuffer);for(var d=0,p=h.length;d<p;d++){var f=h[d],m=l[f];if(m>=0){var g=i.attributes[f];if("uv"===f&&o&&(g=i.attributes["uv"+(o+1)]),g){var v,y,b=void 0!==g.itemOffset;b?(v=i.vbstride,y=g.itemOffset,c!==a&&(i.streamingDraw?c=et("interleavedVB",i.vb):(c=i.vbbuffer,C.bindBuffer(C.ARRAY_BUFFER,c)),a=c)):(v=g.itemSize,y=0,i.streamingDraw?c=et(f,g.array):(c=g.buffer,C.bindBuffer(C.ARRAY_BUFFER,c)));var x=C.FLOAT,_=g.bytesPerItem||4;1===_?x=C.UNSIGNED_BYTE:2===_&&(x=C.UNSIGNED_SHORT),b&&(_=4),re.enableAttribute(m);var E=r;g.divisor&&(E+=s),C.vertexAttribPointer(m,g.itemSize,x,g.normalized,v*_,(y+E*v)*_),C.vertexAttribDivisor(m,i.numInstances&&g.divisor||0)}else if(e.defaultAttributeValues){var A=e.defaultAttributeValues[f];A&&2===A.length?C.vertexAttrib2fv(m,e.defaultAttributeValues[f]):A&&3===A.length?C.vertexAttrib3fv(m,e.defaultAttributeValues[f]):A&&4===A.length&&C.vertexAttrib4fv(m,e.defaultAttributeValues[f])}}}re.disableUnusedAttributes()}function it(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?e.z-t.z:e.id-t.id}function rt(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?t.z-e.z:e.id-t.id}function nt(e){st(e,!0)}function ot(e){st(e,!1)}function st(e,t,i){var r,n;if(i||!1!==e.visible){if(e instanceof l.Scene||e instanceof l.Group);else if(e instanceof s.RenderBatch)e.forEach(t?nt:ot);else if(function(e){P.lostContextRecovery&&P.lostContextRecovery.refreshIfNeeded(e),void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",Pe));var t=e.geometry;void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",De),t instanceof l.BufferGeometry||(e instanceof l.Mesh?gt(e,t):e instanceof l.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=C.createBuffer(),e.__webglColorBuffer=C.createBuffer(),e.__webglLineDistanceBuffer=C.createBuffer(),P.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,He(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof l.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=C.createBuffer(),e.__webglColorBuffer=C.createBuffer(),P.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__webglPointCount=i,He(e,t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0)));if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof l.Mesh){if(t instanceof l.BufferGeometry)vt(A,t,e);else if(t instanceof l.Geometry)for(var i=ft[t.id],r=0,n=i.length;r<n;r++)vt(A,i[r],e)}else(e instanceof l.Line||e instanceof l.PointCloud)&&vt(A,t,e)}(e),e instanceof l.Light)E.push(e);else{var o=A[e.id];if(o&&(!1===e.frustumCulled||!0===X.intersectsObject(e)))for(r=0,n=o.length;r<n;r++){var a=o[r];pt(a),a.render=!0,!0===t&&(Q.setFromMatrixPosition(e.matrixWorld),Q.applyProjection(Y),a.z=Q.z)}}if(e.children)for(r=0,n=e.children.length;r<n;r++)st(e.children[r],t,i)}}function at(e,t){if(!t.getCustomOverrideMaterial)return t;var i=t.getCustomOverrideMaterial(e);return i||t}function lt(e,t,i,r,n){for(var o,s=0,a=e.length;s<a;s++){var h=e[s],c=h.object,u=h.buffer;if(n)o=at(h.material,n);else{if(!(o=h.material))continue;Et(o)}if(o.twoPassTransparency){var d=o.side;o.side=l.BackSide,ht(o,t,i,r,u,n,c),o.side=l.FrontSide,ht(o,t,i,r,u,n,c),o.side=d}else ht(o,t,i,r,u,n,c)}}function ht(e,t,i,r,n,o,s){if(P.setMaterialFaces(e),n instanceof l.BufferGeometry?P.renderBufferDirect(t,i,r,e,n,s):P.renderBuffer(t,i,r,e,n,s),e.decals)for(var a=e.decals,h=0,c=a.length;h<c;h++){var u=a[h];Et(e=u.material),P.setMaterialFaces(e),n instanceof l.BufferGeometry&&P.renderBufferDirect(t,i,r,e,n,s,u.uv)}}function ct(e,t){if(e.visible&&!e.hide){var i;if(Ue)i=at(e.material,Ue);else{if(!(i=e.material))return;Et(i)}if(i.twoPassTransparency){var r=i.side;i.side=l.BackSide,ut(e,i),i.side=l.FrontSide,ut(e,i),i.side=r}else ut(e,i)}}function ut(e,t){if(P.setMaterialFaces(t),P.renderBufferDirect(Fe,ke,Ve,t,e.geometry,e),t.decals)for(var i=t.decals,r=0,n=i.length;r<n;r++){var o=i[r];Et(t=o.material),P.setMaterialFaces(t),P.renderBufferDirect(Fe,ke,Ve,t,e.geometry,e,o.uv)}}function dt(e,t,i,r,n,o){ke=r,Ve=n,Ue=o||null,Fe=i,e.forEach(ct,e.forceVisible?1:32,!1)}function pt(e){var t=e.object,i=e.buffer,r=t.geometry,n=t.material;if(n instanceof l.MeshFaceMaterial){var o=r instanceof l.BufferGeometry?0:i.materialIndex;n=n.materials[o],e.material=n,n.transparent?T.push(e):M.push(e)}else n&&(e.material=n,n.transparent?T.push(e):M.push(e))}this.renderBufferDirect=function(e,t,i,r,n,o,s){var a;if(P.lostContextRecovery&&P.lostContextRecovery.refreshIfNeeded(n),!1!==r.visible&&(!r.isEdgeMaterial||n.iblines||n.iblinesbuffer)){Je(o.geometry);var h=At(e,t,i,r,o),c=!1,u=r.wireframe?1:0,d="direct_"+n.id+(s?"/"+s:"")+"_"+h.id+"_"+u;d!==k&&(k=d,c=!0);var p,f=null===(a=n.groups)||void 0===a?void 0:a.length,m=f&&n.groups.some((function(e){return e.index>=0||e.instanceStart>=0}));m?c=!0:(p=$e(r,h,n,s||0),c=c&&!p),c&&re.initAttributes();var g,v=n.index;if(v){var y,b=n.ibByteSize,x=v.array?v.array:n.ib;let e=n.ibLength;x&&(v.bytesPerItem=x.BYTES_PER_ELEMENT),r.isEdgeMaterial&&(v=n.attributes.indexlines,x=n.iblines,e=n.iblinesLength,b=n.iblinesByteSize),v.bytesPerItem?b=v.bytesPerItem:x&&(b=x instanceof Uint32Array?4:x instanceof Uint16Array?2:1),4===b?y=C.UNSIGNED_INT:2===b?y=C.UNSIGNED_SHORT:1===b&&(y=C.UNSIGNED_BYTE);var _=n.groups;f&&r.isEdgeMaterial&&!Object.prototype.hasOwnProperty.call(_[0],"edgeStart")&&(_=null);var E=0;do{var A,S,w,M,T;if(f){var D,L=_[E];A=L.index,S=r.isEdgeMaterial?L.edgeStart||0:L.start,w=r.isEdgeMaterial?L.edgeCount||(null===(D=x)||void 0===D?void 0:D.length)||e:L.count,M=L.instanceStart||0,T=L.numInstances||n.numInstances;var I=r.program.uniforms;if(I.themingColor&&"themingColor"in L){var R=L.themingColor;R instanceof l.Vector4?C.uniform4f(I.themingColor,R.x,R.y,R.z,R.w):C.uniform4f(I.themingColor,0,0,0,0)}}else{var O;A=0,S=0,w=(null===(O=x)||void 0===O?void 0:O.length)||e,M=0,T=n.numInstances}c&&(tt(r,h,n,A,v,s,M),m||(c=!1)),g=C.TRIANGLES,n.isPoints||o instanceof l.PointCloud?g=C.POINTS:(n.isLines||r.isEdgeMaterial||o instanceof l.Line)&&(g=C.LINES),T?C.drawElementsInstanced(g,w,y,S*b,T):C.drawElements(g,w,y,S*b),++this.info.render.calls}while(_&&++E<_.length)}else{var N;(null===(N=n.groups)||void 0===N?void 0:N.length)>1&&console.error("Geometry with draw calls and no index buffer"),c&&tt(r,h,n,0,void 0,s,0);var F=n.attributes.position;g=C.TRIANGLES,n.isPoints||o instanceof l.PointCloud?g=C.POINTS:(n.isLines||r.isEdgeMaterial||o instanceof l.Line)&&(g=C.LINES),n.numInstances?C.drawArraysInstanced(g,0,F.array.length/3,n.numInstances):C.drawArrays(g,0,F.array.length/F.itemSize),++this.info.render.calls}p&&C.bindVertexArray(null)}},this.renderBuffer=function(e,t,i,r,n,o){if(!1!==r.visible&&!r.isEdgeMaterial){!function(e){var t,i,r=e.geometry;if(r instanceof l.BufferGeometry)Je(r);else if(e instanceof l.Mesh){!0===r.groupsNeedUpdate&&gt(e,r);for(var n=ft[r.id],o=0,s=n.length;o<s;o++){var a=n[o];t=(i=je(e,a)).attributes&&yt(i),(r.verticesNeedUpdate||r.morphTargetsNeedUpdate||r.elementsNeedUpdate||r.uvsNeedUpdate||r.normalsNeedUpdate||r.colorsNeedUpdate||r.tangentsNeedUpdate||t)&&Ze(a,e,C.DYNAMIC_DRAW,!r.dynamic,i)}r.verticesNeedUpdate=!1,r.morphTargetsNeedUpdate=!1,r.elementsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.tangentsNeedUpdate=!1,i.attributes&&bt(i)}else e instanceof l.Line?(t=(i=je(e,r)).attributes&&yt(i),(r.verticesNeedUpdate||r.colorsNeedUpdate||r.lineDistancesNeedUpdate||t)&&function(e,t){var i,r,n,o,s,a,l,h,c,u,d,p,f=e.vertices,m=e.colors,g=e.lineDistances,v=f.length,y=m.length,b=g.length,x=e.__vertexArray,_=e.__colorArray,E=e.__lineDistanceArray,A=e.verticesNeedUpdate,S=e.colorsNeedUpdate,w=e.lineDistancesNeedUpdate,M=e.__webglCustomAttributesList;if(A){for(i=0;i<v;i++)o=f[i],x[s=3*i]=o.x,x[s+1]=o.y,x[s+2]=o.z;C.bindBuffer(C.ARRAY_BUFFER,e.__webglVertexBuffer),C.bufferData(C.ARRAY_BUFFER,x,t)}if(S){for(r=0;r<y;r++)a=m[r],_[s=3*r]=a.r,_[s+1]=a.g,_[s+2]=a.b;C.bindBuffer(C.ARRAY_BUFFER,e.__webglColorBuffer),C.bufferData(C.ARRAY_BUFFER,_,t)}if(w){for(n=0;n<b;n++)E[n]=g[n];C.bindBuffer(C.ARRAY_BUFFER,e.__webglLineDistanceBuffer),C.bufferData(C.ARRAY_BUFFER,E,t)}if(M)for(l=0,h=M.length;l<h;l++)if(Ke(p=M[l])&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(s=0,u=p.value.length,1===p.size)for(c=0;c<u;c++)p.array[c]=p.value[c];else if(2===p.size)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,s+=2;else if(3===p.size)if("c"===p.type)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.r,p.array[s+1]=d.g,p.array[s+2]=d.b,s+=3;else for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,s+=3;else if(4===p.size)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,p.array[s+3]=d.w,s+=4;C.bindBuffer(C.ARRAY_BUFFER,p.buffer),C.bufferData(C.ARRAY_BUFFER,p.array,t)}}(r,C.DYNAMIC_DRAW),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,r.lineDistancesNeedUpdate=!1,i.attributes&&bt(i)):e instanceof l.PointCloud&&(t=(i=je(e,r)).attributes&&yt(i),(r.verticesNeedUpdate||r.colorsNeedUpdate||t)&&function(e,t){var i,r,n,o,s,a,l,h,c,u,d,p=e.vertices,f=e.colors,m=p.length,g=f.length,v=e.__vertexArray,y=e.__colorArray,b=e.verticesNeedUpdate,x=e.colorsNeedUpdate,_=e.__webglCustomAttributesList;if(b){for(i=0;i<m;i++)n=p[i],v[o=3*i]=n.x,v[o+1]=n.y,v[o+2]=n.z;C.bindBuffer(C.ARRAY_BUFFER,e.__webglVertexBuffer),C.bufferData(C.ARRAY_BUFFER,v,t)}if(x){for(r=0;r<g;r++)s=f[r],y[o=3*r]=s.r,y[o+1]=s.g,y[o+2]=s.b;C.bindBuffer(C.ARRAY_BUFFER,e.__webglColorBuffer),C.bufferData(C.ARRAY_BUFFER,y,t)}if(_)for(a=0,l=_.length;a<l;a++)if(Ke(d=_[a])&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(o=0,c=d.value.length,1===d.size)for(h=0;h<c;h++)d.array[h]=d.value[h];else if(2===d.size)for(h=0;h<c;h++)u=d.value[h],d.array[o]=u.x,d.array[o+1]=u.y,o+=2;else if(3===d.size)if("c"===d.type)for(h=0;h<c;h++)u=d.value[h],d.array[o]=u.r,d.array[o+1]=u.g,d.array[o+2]=u.b,o+=3;else for(h=0;h<c;h++)u=d.value[h],d.array[o]=u.x,d.array[o+1]=u.y,d.array[o+2]=u.z,o+=3;else if(4===d.size)for(h=0;h<c;h++)u=d.value[h],d.array[o]=u.x,d.array[o+1]=u.y,d.array[o+2]=u.z,d.array[o+3]=u.w,o+=4;C.bindBuffer(C.ARRAY_BUFFER,d.buffer),C.bufferData(C.ARRAY_BUFFER,d.array,t)}}(r,C.DYNAMIC_DRAW),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,i.attributes&&bt(i))}(o);var s=At(e,t,i,r,o),a=s.attributes,h=!1,c=r.wireframe?1:0,u=n.id+"_"+s.id+"_"+c;if(u!==k&&(k=u,h=!0),h&&re.initAttributes(),!r.morphTargets&&a.position>=0&&h&&(C.bindBuffer(C.ARRAY_BUFFER,n.__webglVertexBuffer),re.enableAttribute(a.position),v(a.position,3,C.FLOAT,!1,0,0)),h){if(n.__webglCustomAttributesList)for(var d=0,p=n.__webglCustomAttributesList.length;d<p;d++){var f=n.__webglCustomAttributesList[d];a[f.buffer.belongsToAttribute]>=0&&(C.bindBuffer(C.ARRAY_BUFFER,f.buffer),re.enableAttribute(a[f.buffer.belongsToAttribute]),v(a[f.buffer.belongsToAttribute],f.size,C.FLOAT,!1,0,0))}a.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(C.bindBuffer(C.ARRAY_BUFFER,n.__webglColorBuffer),re.enableAttribute(a.color),v(a.color,3,C.FLOAT,!1,0,0)):r.defaultAttributeValues&&C.vertexAttrib3fv(a.color,r.defaultAttributeValues.color)),a.normal>=0&&(C.bindBuffer(C.ARRAY_BUFFER,n.__webglNormalBuffer),re.enableAttribute(a.normal),v(a.normal,3,C.FLOAT,!1,0,0)),a.tangent>=0&&(C.bindBuffer(C.ARRAY_BUFFER,n.__webglTangentBuffer),re.enableAttribute(a.tangent),v(a.tangent,4,C.FLOAT,!1,0,0)),a.uv>=0&&(o.geometry.faceVertexUvs[0]?(C.bindBuffer(C.ARRAY_BUFFER,n.__webglUVBuffer),re.enableAttribute(a.uv),v(a.uv,2,C.FLOAT,!1,0,0)):r.defaultAttributeValues&&C.vertexAttrib2fv(a.uv,r.defaultAttributeValues.uv)),a.uv2>=0&&(o.geometry.faceVertexUvs[1]?(C.bindBuffer(C.ARRAY_BUFFER,n.__webglUV2Buffer),re.enableAttribute(a.uv2),v(a.uv2,2,C.FLOAT,!1,0,0)):r.defaultAttributeValues&&C.vertexAttrib2fv(a.uv2,r.defaultAttributeValues.uv2)),a.lineDistance>=0&&(C.bindBuffer(C.ARRAY_BUFFER,n.__webglLineDistanceBuffer),re.enableAttribute(a.lineDistance),v(a.lineDistance,1,C.FLOAT,!1,0,0))}if(re.disableUnusedAttributes(),o instanceof l.Mesh){var m=n.__typeArray===Uint32Array?C.UNSIGNED_INT:C.UNSIGNED_SHORT;r.wireframe?(ie.setLineWidth(r.wireframeLinewidth*this.getPixelRatio()),h&&C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),C.drawElements(C.LINES,n.__webglLineCount,m,0)):(h&&C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),C.drawElements(C.TRIANGLES,n.__webglFaceCount,m,0)),++this.info.render.calls}else if(o instanceof l.Line){var g=o.mode===l.LineStrip?C.LINE_STRIP:C.LINES;ie.setLineWidth(r.linewidth*this.getPixelRatio()),C.drawArrays(g,0,n.__webglLineCount),++this.info.render.calls}else o instanceof l.PointCloud&&(C.drawArrays(C.POINTS,0,n.__webglPointCount),++this.info.render.calls)}function v(e,t,i,r,n,o){C.vertexAttribPointer(e,t,i,r,n,o),C.vertexAttribDivisor(e,0)}},this.render=function(e,t,i,r){var n,o,a;let h,c=i,u=r;if(arguments.length>2&&(i instanceof l.WebGLRenderTarget||Array.isArray(i))&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),h=i,c=r,u=arguments[4]),t instanceof l.Camera!=!1){if(!C.isContextLost()){k="",N=-1,F=null,void 0!==u&&(E.length=0,J=!0);var d=e.fog;!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.worldUpTransform?K.multiplyMatrices(t.worldUpTransform,t.matrixWorld):K.copy(t.matrixWorld),Y.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),X.setFromProjectionMatrix(Y);var p=e instanceof s.RenderBatch&&e.renderImmediate;if(p||(M.length=0,T.length=0,st(e,!0===P.sortObjects,!0===e.forceVisible),!0===P.sortObjects&&(M.sort(rt),T.sort(it))),J&&(u&&u.length&&(E=u.slice()),Dt(E)),void 0!==h&&this.setRenderTarget(h),this.resetGLState(),(this.autoClear||c)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){let i=e.overrideMaterial;Et(i),p?dt(e,"",t,E,d,i):(lt(M,t,E,d,i),lt(T,t,E,d,i))}else p?dt(e,"",t,E,d,null):(ie.setBlending(l.NoBlending),lt(M,t,E,d,null),lt(T,t,E,d,null));if(e.edgeMaterial){C.depthFunc(C.LESS);let i=e.edgeMaterial;Et(i),p?dt(e,"",t,E,d,i):(lt(M,t,E,d,i),lt(T,t,E,d,i)),C.depthFunc(C.LEQUAL)}!O&&null!==(n=R)&&void 0!==n&&null!==(n=n.texture)&&void 0!==n&&n.generateMipmaps&&(null===(o=R)||void 0===o?void 0:o.texture.minFilter)!==l.NearestFilter&&(null===(a=R)||void 0===a?void 0:a.texture.minFilter)!==l.LinearFilter&&function(e){C.bindTexture(C.TEXTURE_2D,e.__webglTexture),C.generateMipmap(C.TEXTURE_2D),C.bindTexture(C.TEXTURE_2D,null)}(R),this.resetGLState(),ie.setDepthTest(!0),ie.setDepthWrite(!0)}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setProgramPrefix=function(e,t,i){V=e,U=t,B=i},this.getProgramPrefix=function(){return{programPrefix:V,vertexPrefix:U,fragmentPrefix:B}};var ft={},mt=0;function gt(e,t){var i=e.material,r=!1;void 0!==ft[t.id]&&!0!==t.groupsNeedUpdate||(delete A[e.id],ft[t.id]=function(e,t){for(var i,r,n={},o=e.morphTargets?e.morphTargets.length:0,s=e.morphNormals?e.morphNormals.length:0,a={},l=[],h=0,c=e.faces.length;h<c;h++){var u=e.faces[h],d=t?u.materialIndex:0;d in n||(n[d]={hash:d,counter:0}),(i=n[d].hash+"_"+n[d].counter)in a||(r={id:mt++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:o,numMorphNormals:s},a[i]=r,l.push(r)),a[i].vertices+3>4294967296&&(n[d].counter+=1,(i=n[d].hash+"_"+n[d].counter)in a||(r={id:mt++,faces3:[],materialIndex:d,vertices:0,numMorphTargets:o,numMorphNormals:s},a[i]=r,l.push(r))),a[i].faces3.push(h),a[i].vertices+=3}return l}(t,i instanceof l.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var n=ft[t.id],o=0,s=n.length;o<s;o++){var a=n[o];void 0===a.__webglVertexBuffer?(Ce(a),We(a,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,r=!0):r=!1,(r||void 0===e.__webglActive)&&vt(A,a,e)}e.__webglActive=!0}function vt(e,t,i){var r=i.id;e[r]=e[r]||[],e[r].push({id:r,buffer:t,object:i,material:null,z:0})}function yt(e){for(var t in e.attributes)if(Ke(e.attributes[t]))return!0;return!1}function bt(e){for(var t in e.attributes)Qe(e.attributes[t])}var xt={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshLambertMaterial:"lambert",LineDashedMaterial:"dashed",MeshBasicMaterial:"firefly_basic",LineBasicMaterial:"firefly_basic",PointCloudMaterial:"firefly_basic",PointsMaterial:"firefly_basic",MeshPhongMaterial:"firefly_phong"};function _t(e,t,i,n){e.addEventListener("dispose",Re);var o=xt[e.type];if(o){var s=l.ShaderLib[o];let t=l.UniformsUtils.clone(s.uniforms);e.uniforms&&(t=l.UniformsUtils.merge([t,e.uniforms])),e.__webglShader={uniforms:t,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var h,c,u=function(e){for(var t=0,i=0,r=0,n=0,o=0,s=e.length;o<s;o++){var a=e[o];a.onlyShadow||(a instanceof l.DirectionalLight&&t++,a instanceof l.PointLight&&i++,a instanceof l.SpotLight&&r++,a instanceof l.HemisphereLight&&n++)}return{directional:t,point:i,spot:r,hemi:n}}(t),d={vertexShader:e.__webglShader.vertexShader,fragmentShader:e.__webglShader.fragmentShader,precision:a,precisionFragment:p,supportsVertexTextures:pe,loadingAnimationDuration:P.loadingAnimationDuration,map:!!e.map,envMap:!!e.envMap,irradianceMap:!!e.irradianceMap,envIsSpherical:e.envMap&&e.envMap.mapping==l.SphericalReflectionMapping,envGammaEncoded:e.envMap&&e.envMap.GammaEncoded,irrGammaEncoded:e.irradianceMap&&e.irradianceMap.GammaEncoded,envRGBM:e.envMap&&e.envMap.RGBM,irrRGBM:e.irradianceMap&&e.irradianceMap.RGBM,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,vertexColors:e.vertexColors,vertexIds:e.vertexIds,useInstancing:e.useInstancing,wideLines:e.wideLines,fog:i,useFog:e.fog,useBackgroundTexture:e.useBackgroundTexture,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:b,polygonOffset:e.polygonOffset,maxDirLights:u.directional,maxPointLights:u.point,maxSpotLights:u.spot,maxHemiLights:u.hemi,alphaTest:e.alphaTest,metal:e.metal,clearcoat:e.clearcoat,wrapAround:e.wrapAround,doubleSided:e.side===l.DoubleSide,flipSided:e.side===l.BackSide,mrtNormals:e.mrtNormals,mrtIdBuffer:e.mrtIdBuffer,vertexPrefix:U,fragmentPrefix:B,tonemapOutput:e.tonemapOutput,packedNormals:e.packedNormals,hatchPattern:!!e.hatchParams,numCutplanes:e.cutplanes?e.cutplanes.length:0,useTiling:e.useTiling,tilingRepeatRange:e.useTiling&&e.tilingRepeatRange,hasRoundCorner:e.hasRoundCorner,useRandomOffset:e.useRandomOffset,mapInvert:e.map&&e.map.invert,mapClampS:e.map&&e.map.clampS,mapClampT:e.map&&e.map.clampT,bumpMapClampS:e.bumpMap&&e.bumpMap.clampS,bumpMapClampT:e.bumpMap&&e.bumpMap.clampT,normalMapClampS:e.normalMap&&e.normalMap.clampS,normalMapClampT:e.normalMap&&e.normalMap.clampT,specularMapClampS:e.specularMap&&e.specularMap.clampS,specularMapClampT:e.specularMap&&e.specularMap.clampT,alphaMapInvert:e.alphaMap&&e.alphaMap.invert,alphaMapClampS:e.alphaMap&&e.alphaMap.clampS,alphaMapClampT:e.alphaMap&&e.alphaMap.clampT},f=[];for(var m in o?f.push(o):(f.push(e.fragmentShader),f.push(e.vertexShader)),e.defines)f.push(m),f.push(e.defines[m]);for(h in d)f.push(h),f.push(d[h]);var g,v=f.join();for(h=0,c=D.length;h<c;h++){var y=D[h];if(y.code===v){(g=y).usedTimes++;break}}for(var x in void 0===g&&(e.onBeforeCompile(d,P),g=new r.WebGLProgram(P,v,e,d,n.geometry),D.push(g),P.info.memory.programs=D.length),e.programs||(e.programs=[]),e.programs[V]=g,e.uniformsLists||(e.uniformsLists=[]),e.uniformsList=e.uniformsLists[V]=[],e.__webglShader.uniforms){var _=g.uniforms[x];_&&e.uniformsList.push([e.__webglShader.uniforms[x],_])}}function Et(e){!0===e.transparent?ie.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):ie.setBlending(l.NoBlending),ie.setDepthTest(e.depthTest),ie.setDepthWrite(e.depthWrite),ie.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function At(e,i,r,o,s){G=0,P.lostContextRecovery&&P.lostContextRecovery.refreshIfNeeded(o),Ke(o)?(o.program&&ze(o),_t(o,i,r,s),Qe(o)):o.programs&&o.programs[V]||_t(o,i,r,s);var a=!1,h=!1,c=!1;o.uniformsList=o.uniformsLists[V];var u,d=o.program=o.programs[V],p=d.uniforms,f=o.__webglShader.uniforms;if(d.id!==L&&(C.useProgram(d.program),L=d.id,a=!0,h=!0,c=!0),o.id!==N&&(-1===N&&(c=!0),N=o.id,h=!0),p.meshAnimTime){var m=1;s.geometry.creationTime&&P.loadingAnimationDuration>0&&(m=Math.min((P.highResTimeStamp-s.geometry.creationTime)/P.loadingAnimationDuration,1)),C.uniform1f(p.meshAnimTime,m)}if((a||e!==F)&&(C.uniformMatrix4fv(p.projectionMatrix,!1,e.projectionMatrix.elements),b&&(C.uniform1f(p.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),o.polygonOffset&&C.uniform2f(p.polygonOffset,o.polygonOffsetFactor,o.polygonOffsetUnits)),e!==F&&(F=e),(o instanceof l.ShaderMaterial||o instanceof l.MeshPhongMaterial||o.envMap)&&null!==p.cameraPosition&&(Q.setFromMatrixPosition(e.matrixWorld),C.uniform3f(p.cameraPosition,Q.x,Q.y,Q.z)),(o instanceof l.MeshPhongMaterial||o instanceof l.MeshLambertMaterial||o instanceof l.ShaderMaterial||o.skinning)&&(null!==p.viewMatrix&&C.uniformMatrix4fv(p.viewMatrix,!1,e.matrixWorldInverse.elements),null!==p.viewMatrixInverse&&C.uniformMatrix4fv(p.viewMatrixInverse,!1,K.elements),p.mvpMatrix&&C.uniformMatrix4fv(p.mvpMatrix,!1,Y.elements),c?(wt(f,o),Mt(f,!0)):Mt(f,!1))),p.unpackXform){var g=s.geometry,v=g.unpackXform;if(v?C.uniform4f(p.unpackXform,v.x,v.y,v.z,v.w):C.uniform4f(p.unpackXform,1,1,0,0),p.tIdColor){C.uniform2f(p.vIdColorTexSize,g.vIdColorTexSize.x,g.vIdColorTexSize.y);var y=Ct();C.uniform1i(p.tIdColor,y),P.setTexture(g.tIdColor,y)}}if(h){if((o instanceof l.MeshPhongMaterial||o instanceof l.MeshLambertMaterial||o.lights)&&(J&&(c=!0,Dt(i),J=!1),c?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(f,$),Tt(f,!0)):Tt(f,!1)),(o instanceof l.MeshBasicMaterial||o instanceof l.MeshLambertMaterial||o instanceof l.MeshPhongMaterial)&&(!function(e,t){e.opacity.value=t.opacity,e.diffuse.value.copy(t.color),e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));function i(e,t,i,r){const{x:n,y:o}=i,{x:s,y:a}=t,l=n*Math.cos(r),h=n*Math.sin(r),c=o*Math.cos(r),u=o*Math.sin(r),d=e.elements,p=d[0],f=d[3],m=d[6],g=d[1],v=d[4],y=d[7],b=d[2],x=d[5],_=d[8];d[0]=p*l+g*h+b*s,d[3]=f*l+v*h+x*s,d[6]=m*l+y*h+_*s,d[1]=p*-u+g*c+b*a,d[4]=f*-u+v*c+x*a,d[7]=m*-u+y*c+_*a}function r(e,t,r){const{offset:n,repeat:o,rotation:s}=r;if(t){var a=t.value;r.matrix?a.copy(r.matrix):a.identity(),i(a,n,o,s??0)}else e.offsetRepeat.value.set(n.x,n.y,o.x,o.y)}t.alphaMap&&r(e,e.texMatrixAlpha,t.alphaMap);var n,o;t.normalMap?n=t.normalMap:t.bumpMap&&(n=t.bumpMap);void 0!==n&&r(e,e.texMatrixBump,n);t.map?o=t.map:t.specularMap&&(o=t.specularMap);void 0!==o&&r(e,e.texMatrix,o);e.envMap.value=t.envMap,e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap);e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(f,o),wt(f,o)),o instanceof l.PointCloudMaterial||o instanceof l.PointsMaterial?function(e,t){St(e,t),e.point_size.value=t.size,e.map.value=t.map}(f,o):o instanceof l.LineBasicMaterial?St(f,o):o instanceof l.LineDashedMaterial?(St(f,o),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(f,o)):o instanceof l.MeshPhongMaterial?function(e,t){if(e.shininess.value=t.shininess,e.reflMipIndex){var i=Math.log(Math.max(1+1e-10,t.shininess));e.reflMipIndex.value=Math.max(0,-.72134752*i+5.5)}e.emissive&&e.emissive.value.copy(t.emissive);e.specular.value.copy(t.specular),e.exposureBias&&(e.exposureBias.value=t.exposureBias)}(f,o):o instanceof l.MeshLambertMaterial?function(e,t){e.emissive.value.copy(t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(f,o):o instanceof l.MeshDepthMaterial?(f.mNear.value=e.near,f.mFar.value=e.far,f.opacity.value=o.opacity):o instanceof l.MeshNormalMaterial?f.opacity.value=o.opacity:"function"==typeof o.refreshUniforms&&o.refreshUniforms(f),o.wideLines){var x=s.geometry.lineWidth;void 0!==o.linewidth&&(x=o.linewidth);const e=1/Math.max(Number.EPSILON,x);f.view_size.value=new l.Vector2(t.width*e,t.height*e)}n.ShadowRender&&o.shadowMap&&n.ShadowRender.RefreshUniformsShadow(f,o);var _=f.cutplanes;o.cutplanes&&o.cutplanes.length>0&&_&&(_.value=o.cutplanes,null!=f&&f.cutplanesHideInterior&&(f.cutplanesHideInterior.value=o.cutplanesHideInterior),_._array&&_._array.length!=4*o.cutplanes&&(_._array=void 0)),o.hatchParams&&f.hatchParams&&(f.hatchParams.value.copy(o.hatchParams),f.hatchTintColor.value.copy(o.hatchTintColor),f.hatchTintIntensity.value=o.hatchTintIntensity),function(e){for(var t,i,r,n=0,o=e.length;n<o;n++){var s=e[n][0];if(!1!==s.needsUpdate&&!s.perObject){var a,h,c=s.type,u=s.value,d=e[n][1];switch(c){case"1i":case"i":C.uniform1i(d,u);break;case"1f":case"f":C.uniform1f(d,u);break;case"2f":C.uniform2f(d,u[0],u[1]);break;case"3f":C.uniform3f(d,u[0],u[1],u[2]);break;case"4f":C.uniform4f(d,u[0],u[1],u[2],u[3]);break;case"1iv":case"iv1":C.uniform1iv(d,u);break;case"3iv":case"iv":C.uniform3iv(d,u);break;case"1fv":case"fv1":C.uniform1fv(d,u);break;case"2fv":C.uniform2fv(d,u);break;case"3fv":case"fv":C.uniform3fv(d,u);break;case"4fv":C.uniform4fv(d,u);break;case"Matrix3fv":C.uniformMatrix3fv(d,!1,u);break;case"Matrix4fv":C.uniformMatrix4fv(d,!1,u);break;case"v2":C.uniform2f(d,u.x,u.y);break;case"v3":C.uniform3f(d,u.x,u.y,u.z);break;case"v4":C.uniform4f(d,u.x,u.y,u.z,u.w);break;case"c":C.uniform3f(d,u.r,u.g,u.b);break;case"v2v":for(void 0===s._array&&(s._array=new Float32Array(2*u.length)),a=0,h=u.length;a<h;a++)r=2*a,s._array[r]=u[a].x,s._array[r+1]=u[a].y;C.uniform2fv(d,s._array);break;case"v3v":for(void 0===s._array&&(s._array=new Float32Array(3*u.length)),a=0,h=u.length;a<h;a++)r=3*a,s._array[r]=u[a].x,s._array[r+1]=u[a].y,s._array[r+2]=u[a].z;C.uniform3fv(d,s._array);break;case"v4v":for(void 0===s._array&&(s._array=new Float32Array(4*u.length)),a=0,h=u.length;a<h;a++)r=4*a,s._array[r]=u[a].x,s._array[r+1]=u[a].y,s._array[r+2]=u[a].z,s._array[r+3]=u[a].w;C.uniform4fv(d,s._array);break;case"m3":C.uniformMatrix3fv(d,!1,u.elements);break;case"m3v":for(void 0===s._array&&(s._array=new Float32Array(9*u.length)),a=0,h=u.length;a<h;a++)u[a].flattenToArrayOffset(s._array,9*a);C.uniformMatrix3fv(d,!1,s._array);break;case"m4":C.uniformMatrix4fv(d,!1,u.elements);break;case"m4v":for(void 0===s._array&&(s._array=new Float32Array(16*u.length)),a=0,h=u.length;a<h;a++)u[a].flattenToArrayOffset(s._array,16*a);C.uniformMatrix4fv(d,!1,s._array);break;case"t":if(t=u,i=Ct(),C.uniform1i(d,i),!t){C.activeTexture(C.TEXTURE0+i),C.bindTexture(C.TEXTURE_2D,le.__webglTexture);continue}P.lostContextRecovery&&P.lostContextRecovery.refreshIfNeeded(t),Array.isArray(t.image)&&6===t.image.length||t instanceof l.CubeTexture?Ke(t)?Rt(t,i):(C.activeTexture(C.TEXTURE0+i),C.bindTexture(C.TEXTURE_CUBE_MAP,t.__webglTextureCube)):t instanceof l.WebGLRenderTargetCube?Ot(t,i):P.setTexture(t,i);break;case"tv":for(void 0===s._array&&(s._array=[]),a=0,h=s.value.length;a<h;a++)s._array[a]=Ct();for(C.uniform1iv(d,s._array),a=0,h=s.value.length;a<h;a++)t=s.value[a],i=s._array[a],t&&(P.lostContextRecovery&&P.lostContextRecovery.refreshIfNeeded(t),P.setTexture(t,i));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+c)}}}}(o.uniformsList)}if(function(e,t,i){S.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),C.uniformMatrix4fv(e.modelViewMatrix,!1,S.elements),e.normalMatrix&&(w.getNormalMatrix(S),C.uniformMatrix3fv(e.normalMatrix,!1,w.elements));null!==e.modelMatrix&&C.uniformMatrix4fv(e.modelMatrix,!1,t.matrixWorld.elements);e.modelLocalMatrix&&C.uniformMatrix4fv(e.modelLocalMatrix,!1,t.matrix.elements)}(p,s,e),p.modelId){p.dbId&&(u=s.dbId||s.fragId||0,C.uniform3f(p.dbId,(255&u)/255,(u>>8&255)/255,(u>>16&255)/255));var E=s.modelId;C.uniform3f(p.modelId,(255&E)/255,(E>>8&255)/255,(u>>24&255)/255)}else null!==p.dbId&&(u=s.dbId||s.fragId||0,C.uniform3f(p.dbId,(255&u)/255,(u>>8&255)/255,(u>>16&255)/255));if(p.themingColor){var A=s.themingColor;A instanceof l.Vector4?C.uniform4f(p.themingColor,A.x,A.y,A.z,A.w):C.uniform4f(p.themingColor,0,0,0,0)}return d}function St(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function wt(e,t){e.envMap&&(e.envMap.value=t.envMap),e.irradianceMap&&(e.irradianceMap.value=t.irradianceMap),e.envMapExposure&&(e.envMapExposure.value=t.envMapExposure),e.envRotationSin&&e.envRotationCos&&(e.envRotationSin.value=t.envRotationSin,e.envRotationCos.value=t.envRotationCos)}function Mt(e,t){e.envMap&&(e.envMap.needsUpdate=t),e.irradianceMap&&(e.irradianceMap.needsUpdate=t),e.envMapExposure&&(e.envMapExposure.needsUpdate=t)}function Tt(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Ct(){var e=G;return e>=he&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+he),G+=1,e}function Pt(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function Dt(e){var t,i,r,n,o,s,a,h,c=0,u=0,d=0,p=$,f=p.directional.colors,m=p.directional.positions,g=p.point.colors,v=p.point.positions,y=p.point.distances,b=p.spot.colors,x=p.spot.positions,_=p.spot.distances,E=p.spot.directions,A=p.spot.anglesCos,S=p.spot.exponents,w=p.hemi.skyColors,M=p.hemi.groundColors,T=p.hemi.positions,C=0,P=0,D=0,L=0,I=0,R=0,O=0,N=0,F=0,k=0,V=0,U=0;for(t=0,i=e.length;t<i;t++)if(!(r=e[t]).onlyShadow)if(n=r.color,a=r.intensity,h=r.distance,r instanceof l.AmbientLight){if(!r.visible)continue;c+=n.r,u+=n.g,d+=n.b}else if(r instanceof l.DirectionalLight){if(I+=1,!r.visible)continue;Z.setFromMatrixPosition(r.matrixWorld),Q.setFromMatrixPosition(r.target.matrixWorld),Z.sub(Q),Z.normalize(),m[F=3*C]=Z.x,m[F+1]=Z.y,m[F+2]=Z.z,Pt(f,F,n,a),C+=1}else if(r instanceof l.PointLight){if(R+=1,!r.visible)continue;Pt(g,k=3*P,n,a),Q.setFromMatrixPosition(r.matrixWorld),v[k]=Q.x,v[k+1]=Q.y,v[k+2]=Q.z,y[P]=h,P+=1}else if(r instanceof l.SpotLight){if(O+=1,!r.visible)continue;Pt(b,V=3*D,n,a),Q.setFromMatrixPosition(r.matrixWorld),x[V]=Q.x,x[V+1]=Q.y,x[V+2]=Q.z,_[D]=h,Z.copy(Q),Q.setFromMatrixPosition(r.target.matrixWorld),Z.sub(Q),Z.normalize(),E[V]=Z.x,E[V+1]=Z.y,E[V+2]=Z.z,A[D]=Math.cos(r.angle),S[D]=r.exponent,D+=1}else if(r instanceof l.HemisphereLight){if(N+=1,!r.visible)continue;Z.setFromMatrixPosition(r.matrixWorld),Z.normalize(),T[U=3*L]=Z.x,T[U+1]=Z.y,T[U+2]=Z.z,o=r.color,s=r.groundColor,Pt(w,U,o,a),Pt(M,U,s,a),L+=1}for(t=3*C,i=Math.max(f.length,3*I);t<i;t++)f[t]=0;for(t=3*P,i=Math.max(g.length,3*R);t<i;t++)g[t]=0;for(t=3*D,i=Math.max(b.length,3*O);t<i;t++)b[t]=0;for(t=3*L,i=Math.max(w.length,3*N);t<i;t++)w[t]=0;for(t=3*L,i=Math.max(M.length,3*N);t<i;t++)M[t]=0;p.directional.length=C,p.point.length=P,p.spot.length=D,p.hemi.length=L,p.ambient[0]=c,p.ambient[1]=u,p.ambient[2]=d}function Lt(e,t,i){var r;i?(C.texParameteri(e,C.TEXTURE_WRAP_S,Ut(t.wrapS)),C.texParameteri(e,C.TEXTURE_WRAP_T,Ut(t.wrapT)),C.texParameteri(e,C.TEXTURE_MAG_FILTER,Ut(t.magFilter)),C.texParameteri(e,C.TEXTURE_MIN_FILTER,Ut(t.minFilter))):(C.texParameteri(e,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(e,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),t.wrapS===l.ClampToEdgeWrapping&&t.wrapT===l.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),C.texParameteri(e,C.TEXTURE_MAG_FILTER,kt(t.magFilter)),C.texParameteri(e,C.TEXTURE_MIN_FILTER,kt(t.minFilter)),t.minFilter!==l.NearestFilter&&t.minFilter!==l.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(r=te.get("EXT_texture_filter_anisotropic"))&&t.type!==l.FloatType&&t.type!==l.HalfFloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(C.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,P.getMaxAnisotropy())),t.__oldAnisotropy=t.anisotropy)}function It(e,t){if(e.width<=t&&e.height<=t)return e;if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var i=t/Math.max(e.width,e.height),r=Math.max(Math.floor(e.width*i),1),n=Math.max(Math.floor(e.height*i),1),o=d.createElement("canvas");return o.width=r,o.height=n,o.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r,n),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}function Rt(e,t){if(6===e.image.length)if(Ke(e)){e.__webglTextureCube||(e.addEventListener("dispose",Le),e.__webglTextureCube=C.createTexture(),P.info.memory.textures++),C.activeTexture(C.TEXTURE0+t),C.bindTexture(C.TEXTURE_CUBE_MAP,e.__webglTextureCube),C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,e.flipY);var i,r=e instanceof l.CompressedTexture,n=e.image[0]instanceof l.DataTexture,o=[];for(i=0;i<6;i++)!P.autoScaleCubemaps||r||n?o[i]=n?e.image[i].image:e.image[i]:o[i]=It(e.image[i],de);var s=o[0],a=l.Math.isPowerOfTwo(s.width)&&l.Math.isPowerOfTwo(s.height),h=Ut(e.format),c=Ut(e.type);for(Lt(C.TEXTURE_CUBE_MAP,e,a),i=0;i<6;i++)if(r)for(var u,d=o[i].mipmaps,p=0,f=d.length;p<f;p++)u=d[p],e.format!==l.RGBAFormat&&e.format!==l.RGBFormat?Ae().indexOf(h)>-1?C.compressedTexImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+i,p,h,u.width,u.height,0,u.data):console.warn("Attempt to load unsupported compressed texture format"):C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+i,p,h,u.width,u.height,0,h,c,u.data);else n?C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,h,o[i].width,o[i].height,0,h,c,o[i].data):C.texImage2D(C.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,h,h,c,o[i]);e.generateMipmaps&&a&&C.generateMipmap(C.TEXTURE_CUBE_MAP),Qe(e),e.onUpdate&&e.onUpdate()}else C.activeTexture(C.TEXTURE0+t),C.bindTexture(C.TEXTURE_CUBE_MAP,e.__webglTextureCube)}function Ot(e,t){C.activeTexture(C.TEXTURE0+t),C.bindTexture(C.TEXTURE_CUBE_MAP,e.__webglTexture)}function Nt(e){var t=C.COLOR_ATTACHMENT0,i=[t];for(be=1;be<e.length;be++)i.push(t+be);C.drawBuffers(i)}function Ft(e){var t=l.Math.isPowerOfTwo(e.width)&&l.Math.isPowerOfTwo(e.height),i=Ut(e.texture.format),r=Ut(e.texture.type),n=Vt(e.texture.format,e.texture.type);e.addEventListener("dispose",Ie),e.__webglTexture=C.createTexture(),P.info.memory.textures++,C.bindTexture(C.TEXTURE_2D,e.__webglTexture),Lt(C.TEXTURE_2D,e.texture,t),C.texImage2D(C.TEXTURE_2D,0,n,e.width,e.height,0,i,r,null),t&&e.texture.generateMipmaps&&C.generateMipmap(C.TEXTURE_2D)}function kt(e){return e===l.NearestFilter||e===l.NearestMipMapNearestFilter||e===l.NearestMipMapLinearFilter?C.NEAREST:C.LINEAR}function Vt(e,t){if(e===l.RGBFormat)switch(t){case l.UnsignedByteType:return C.RGB8;case l.FloatType:return C.RGB32F;case l.HalfFloatType:return C.RGB16F}else if(e===l.RGBAFormat)switch(t){case l.UnsignedByteType:return C.RGBA8;case l.FloatType:return C.RGBA32F;case l.HalfFloatType:return C.RGBA16F}else if(e===l.LuminanceFormat&&t===l.UnsignedByteType)return C.LUMINANCE;return console.error("failed to map texture format and type to internalformat"),Ut(e)}function Ut(e){var t;if(e===l.RepeatWrapping)return C.REPEAT;if(e===l.ClampToEdgeWrapping)return C.CLAMP_TO_EDGE;if(e===l.MirroredRepeatWrapping)return C.MIRRORED_REPEAT;if(e===l.NearestFilter)return C.NEAREST;if(e===l.NearestMipMapNearestFilter)return C.NEAREST_MIPMAP_NEAREST;if(e===l.NearestMipMapLinearFilter)return C.NEAREST_MIPMAP_LINEAR;if(e===l.LinearFilter)return C.LINEAR;if(e===l.LinearMipMapNearestFilter)return C.LINEAR_MIPMAP_NEAREST;if(e===l.LinearMipMapLinearFilter)return C.LINEAR_MIPMAP_LINEAR;if(e===l.UnsignedByteType)return C.UNSIGNED_BYTE;if(e===l.UnsignedShort4444Type)return C.UNSIGNED_SHORT_4_4_4_4;if(e===l.UnsignedShort5551Type)return C.UNSIGNED_SHORT_5_5_5_1;if(e===l.UnsignedShort565Type)return C.UNSIGNED_SHORT_5_6_5;if(e===l.ByteType)return C.BYTE;if(e===l.ShortType)return C.SHORT;if(e===l.UnsignedShortType)return C.UNSIGNED_SHORT;if(e===l.IntType)return C.INT;if(e===l.UnsignedIntType)return C.UNSIGNED_INT;if(e===l.FloatType)return C.FLOAT;if(e===l.HalfFloatType)return C.HALF_FLOAT;if(e===l.AlphaFormat)return C.ALPHA;if(e===l.RGBFormat)return C.RGB;if(e===l.RGBAFormat)return C.RGBA;if(e===l.LuminanceFormat)return C.LUMINANCE;if(e===l.LuminanceAlphaFormat)return C.LUMINANCE_ALPHA;if(e===l.AddEquation)return C.FUNC_ADD;if(e===l.MinEquation)return C.MIN;if(e===l.MaxEquation)return C.MAX;if(e===l.SubtractEquation)return C.FUNC_SUBTRACT;if(e===l.ReverseSubtractEquation)return C.FUNC_REVERSE_SUBTRACT;if(e===l.ZeroFactor)return C.ZERO;if(e===l.OneFactor)return C.ONE;if(e===l.SrcColorFactor)return C.SRC_COLOR;if(e===l.OneMinusSrcColorFactor)return C.ONE_MINUS_SRC_COLOR;if(e===l.SrcAlphaFactor)return C.SRC_ALPHA;if(e===l.OneMinusSrcAlphaFactor)return C.ONE_MINUS_SRC_ALPHA;if(e===l.DstAlphaFactor)return C.DST_ALPHA;if(e===l.OneMinusDstAlphaFactor)return C.ONE_MINUS_DST_ALPHA;if(e===l.DstColorFactor)return C.DST_COLOR;if(e===l.OneMinusDstColorFactor)return C.ONE_MINUS_DST_COLOR;if(e===l.SrcAlphaSaturateFactor)return C.SRC_ALPHA_SATURATE;if(null!==(t=te.get("WEBGL_compressed_texture_s3tc"))){if(e===l.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===l.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===l.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===l.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=te.get("WEBGL_compressed_texture_pvrtc"))){if(e===l.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===l.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===l.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===l.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=te.get("EXT_blend_minmax"))){if(e===l.MinEquation)return t.MIN_EXT;if(e===l.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===l.CullFaceNone?C.disable(C.CULL_FACE):(t===l.FrontFaceDirectionCW?C.frontFace(C.CW):C.frontFace(C.CCW),e===l.CullFaceBack?C.cullFace(C.BACK):e===l.CullFaceFront?C.cullFace(C.FRONT):C.cullFace(C.FRONT_AND_BACK),C.enable(C.CULL_FACE))},this.setMaterialFaces=function(e){ie.setDoubleSided(e.side===l.DoubleSide),ie.setFlipSided(e.side===l.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",Le),e.__webglTexture=C.createTexture(),P.info.memory.textures++),C.bindTexture(C.TEXTURE_2D,e.__webglTexture),C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,e.flipY),C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),C.pixelStorei(C.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=It(e.image,ue);var t=e.image,i=l.Math.isPowerOfTwo(t.width)&&l.Math.isPowerOfTwo(t.height),r=Ut(e.format),n=Ut(e.type),o=Vt(e.format,e.type);Lt(C.TEXTURE_2D,e,i);var s,a,h,c=e.mipmaps;if(e instanceof l.DataTexture)if(c.length>0&&i){for(a=0,h=c.length;a<h;a++)s=c[a],C.texImage2D(C.TEXTURE_2D,a,o,s.width,s.height,0,r,n,s.data);e.generateMipmaps=!1}else C.texImage2D(C.TEXTURE_2D,0,o,t.width,t.height,0,r,n,t.data);else if(e instanceof l.CompressedTexture){for(a=0,h=c.length;a<h;a++)s=c[a],e.format!==l.RGBAFormat&&e.format!==l.RGBFormat?Ae().indexOf(r)>-1?C.compressedTexImage2D(C.TEXTURE_2D,a,o,s.width,s.height,0,s.data):console.warn("Attempt to load unsupported compressed texture format"):C.texImage2D(C.TEXTURE_2D,a,o,s.width,s.height,0,r,n,s.data);if(c.length>1&&Ae().indexOf(r)>-1)for(var u,d=s.width>>1,p=s.height>>1,f=c.length;d>=1||p>=1;)u=4==s.width&&4==s.height?s.data:new DataView(s.data.buffer,s.data.byteOffset,s.data.byteLength*(Math.max(d,4)*Math.max(p,4))/(s.width*s.height)),C.compressedTexImage2D(C.TEXTURE_2D,f,o,Math.max(d,1),Math.max(p,1),0,u),d>>=1,p>>=1,++f}else if(c.length>0&&i){for(a=0,h=c.length;a<h;a++)C.texImage2D(C.TEXTURE_2D,a,o,r,n,c[a]);e.generateMipmaps=!1}else C.texImage2D(C.TEXTURE_2D,0,o,r,n,e.image);e.generateMipmaps&&i&&C.generateMipmap(C.TEXTURE_2D),Qe(e),e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){C.activeTexture(C.TEXTURE0+t),Ke(e)?P.uploadTexture(e):e.__webglTexture?C.bindTexture(C.TEXTURE_2D,e.__webglTexture):C.bindTexture(C.TEXTURE_2D,le.__webglTexture)},P.uploadTexture(le),this.initFrameBufferMRT=function(e,t){var i=e[0],r=!1;if(i&&!i.__webglFramebuffer){var n;if(void 0===i.depthBuffer&&(i.depthBuffer=!0),void 0===i.stencilBuffer&&(i.stencilBuffer=!0),i.__webglFramebuffer=C.createFramebuffer(),C.bindFramebuffer(C.FRAMEBUFFER,i.__webglFramebuffer),i.shareDepthFrom)n=i.__webglRenderbuffer=i.shareDepthFrom.__webglRenderbuffer,i.__isUsingShared=!0;else if(n=i.__webglRenderbuffer,i.__isUsingShared=!1,i.depthBuffer){let e;n||(n=i.__webglRenderbuffer=C.createRenderbuffer(),i.__webglRenderbufferOwn=n),C.bindRenderbuffer(C.RENDERBUFFER,n),e=i.stencilBuffer?C.DEPTH24_STENCIL8:C.DEPTH_COMPONENT32F,C.renderbufferStorage(C.RENDERBUFFER,e,i.width,i.height)}if(i.depthBuffer){const e=i.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT;C.framebufferRenderbuffer(C.FRAMEBUFFER,e,C.RENDERBUFFER,n)}r=!0}else if(i)if(i.shareDepthFrom&&0==i.__isUsingShared){if(n=i.shareDepthFrom.__webglRenderbuffer,i.__isUsingShared=!0,i.depthBuffer){const e=i.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT;C.framebufferRenderbuffer(C.FRAMEBUFFER,e,C.RENDERBUFFER,n)}}else if(null==i.shareDepthFrom&&1==i.__isUsingShared){if(n=i.__webglRenderbufferOwn,i.__isUsingShared=!1,null==n&&i.depthBuffer){let e;n=i.__webglRenderbuffer=C.createRenderbuffer(),i.__webglRenderbufferOwn=n,C.bindRenderbuffer(C.RENDERBUFFER,n),e=i.stencilBuffer?C.DEPTH24_STENCIL8:C.DEPTH_COMPONENT32F,C.renderbufferStorage(C.RENDERBUFFER,e,i.width,i.height)}if(i.depthBuffer){const e=i.stencilBuffer?C.DEPTH_STENCIL_ATTACHMENT:C.DEPTH_ATTACHMENT;C.framebufferRenderbuffer(C.FRAMEBUFFER,e,C.RENDERBUFFER,n)}}var o=I;if(C.bindFramebuffer(C.FRAMEBUFFER,i.__webglFramebuffer),function(e,t){let i=e.__webglBoundBuffers;if(!i)return!0;if(i.length!==t.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!0;return!1}(i,e)){var s;for(s=0;s<e.length;s++){var a=e[s];a&&!a.__webglTexture&&Ft(a),C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+s,C.TEXTURE_2D,a&&a.__webglTexture,0)}s=e.length;for(var l=i.__webglBoundBuffers&&i.__webglBoundBuffers.length||s;s<l;)C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0+s,C.TEXTURE_2D,null,0),s++;i.__webglBoundBuffers=e.slice()}if(Nt(e),t){var h=C.checkFramebufferStatus(C.FRAMEBUFFER);h!==C.FRAMEBUFFER_COMPLETE&&(console.log("Can't use multiple render targets. Falling back to two passes. "+h),o===i.__webglFramebuffer&&(o=I=null),C.bindFramebuffer(C.FRAMEBUFFER,o),C.deleteFramebuffer(i.__webglFramebuffer),delete i.__webglFramebuffer,t=!1)}return C.bindFramebuffer(C.FRAMEBUFFER,o),r&&(C.bindTexture(C.TEXTURE_2D,null),C.bindRenderbuffer(C.RENDERBUFFER,null),C.bindFramebuffer(C.FRAMEBUFFER,null)),t},this.setRenderTarget=function(e){var t,i,r,n,o,s;if(Array.isArray(e)&&e.length>0?(R=e[0],O=!0):(R=e,O=!1),P.lostContextRecovery&&P.lostContextRecovery.refreshTargetsIfNeeded(e),Array.isArray(e))this.initFrameBufferMRT(e),(t=e[0]).initForMRT=!0;else if(e){var a=e.__webglFramebuffer;a&&I===a&&!e.initForMRT&&null!=e.shareDepthFrom==!!e.__isUsingShared||this.initFrameBufferMRT([e]),(t=e).initForMRT=!1}!t||Me?(r=W,n=j,o=z,s=H):(r=t.width,n=t.height,o=0,s=0),(i=t?t.__webglFramebuffer:null)!==I&&(C.bindFramebuffer(C.FRAMEBUFFER,i),I=i),C.viewport(o,s,r,n)},this.readRenderTargetPixels=function(e,t,i,r,n,o){if(e instanceof l.WebGLRenderTarget){if(P.lostContextRecovery&&P.lostContextRecovery.refreshTargetsIfNeeded(e),e.__webglFramebuffer){if(e.texture.format!==l.RGBAFormat&&e.texture.format!==l.RGBFormat||e.texture.type!==l.UnsignedByteType)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not a readable format.");var s=!1;e.__webglFramebuffer!==I&&(C.bindFramebuffer(C.FRAMEBUFFER,e.__webglFramebuffer),s=!0),e.canReadPixels||C.checkFramebufferStatus(C.FRAMEBUFFER)===C.FRAMEBUFFER_COMPLETE?C.readPixels(t,i,r,n,C.RGBA,C.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&C.bindFramebuffer(C.FRAMEBUFFER,I)}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}},73446:(e,t,i)=>{"use strict";i.r(t),i.d(t,{WebGLShader:()=>n});var r=function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")};function n(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),"undefined"!=typeof DEBUG_SHADERS&&DEBUG_SHADERS&&(!1===e.getShaderParameter(n,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(n),r(i))),n}},50982:(e,t,i)=>{"use strict";function r(e,t){var i,r;this.bytes_per_node=t?32:36,e instanceof ArrayBuffer?(i=e.byteLength/this.bytes_per_node,r=e,this.nodeCount=i):(i=0|e,r=new ArrayBuffer(this.bytes_per_node*i),this.nodeCount=0),this.nodeCapacity=i,this.nodesRaw=r,this.is_lean_node=t,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}i.r(t),i.d(t,{BVHBuilder:()=>a,NodeArray:()=>r}),r.prototype.setLeftChild=function(e,t){this.nodesI[e*this.node_stride+6]=t},r.prototype.getLeftChild=function(e){return this.nodesI[e*this.node_stride+6]},r.prototype.setPrimStart=function(e,t){this.is_lean_node?this.nodesI[e*this.node_stride+6]=t:this.nodesI[e*this.node_stride+8]=t},r.prototype.getPrimStart=function(e){return this.is_lean_node?this.nodesI[e*this.node_stride+6]:this.nodesI[e*this.node_stride+8]},r.prototype.setPrimCount=function(e,t){this.nodesS[e*this.node_stride_short+14]=t},r.prototype.getPrimCount=function(e){return this.nodesS[e*this.node_stride_short+14]},r.prototype.setFlags=function(e,t,i,r){this.nodesS[e*this.node_stride_short+15]=r<<3|i<<2|3&t},r.prototype.getFlags=function(e){return this.nodesS[e*this.node_stride_short+15]},r.prototype.setBox0=function(e,t){var i=e*this.node_stride,r=this.nodesF;r[i]=t[0],r[i+1]=t[1],r[i+2]=t[2],r[i+3]=t[3],r[i+4]=t[4],r[i+5]=t[5]},r.prototype.getBoxThree=function(e,t){var i=e*this.node_stride,r=this.nodesF;t.min.x=r[i],t.min.y=r[i+1],t.min.z=r[i+2],t.max.x=r[i+3],t.max.y=r[i+4],t.max.z=r[i+5]},r.prototype.getBoxArray=function(e,t,i){var r=e*this.node_stride,n=this.nodesF;t[0+(i=i||0)]=n[r],t[1+i]=n[r+1],t[2+i]=n[r+2],t[3+i]=n[r+3],t[4+i]=n[r+4],t[5+i]=n[r+5]},r.prototype.setBoxThree=function(e,t){var i=e*this.node_stride,r=this.nodesF;r[i]=t.min.x,r[i+1]=t.min.y,r[i+2]=t.min.z,r[i+3]=t.max.x,r[i+4]=t.max.y,r[i+5]=t.max.z},r.prototype.makeEmpty=function(e){var t=e*this.node_stride,i=this.nodesI;i[t+6]=-1,i[t+7]=0,this.is_lean_node||(i[t+8]=-1)},r.prototype.realloc=function(e){if(this.nodeCount+e>this.nodeCapacity){var t=0|3*this.nodeCapacity/2;t<this.nodeCount+e&&(t=this.nodeCount+e);var i=new ArrayBuffer(t*this.bytes_per_node),r=new Int32Array(i);r.set(this.nodesI),this.nodeCapacity=t,this.nodesRaw=i,this.nodesF=new Float32Array(i),this.nodesI=r,this.nodesS=new Uint16Array(i)}},r.prototype.nextNodes=function(e){this.realloc(e);var t=this.nodeCount;this.nodeCount+=e;for(var i=0;i<e;i++)this.makeEmpty(t+i);return t},r.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var n=3,o=function(){function e(e,t,i){e[0]>t[i]&&(e[0]=t[i]),e[3]<t[i]&&(e[3]=t[i]),e[1]>t[i+1]&&(e[1]=t[i+1]),e[4]<t[i+1]&&(e[4]=t[i+1]),e[2]>t[i+2]&&(e[2]=t[i+2]),e[5]<t[i+2]&&(e[5]=t[i+2])}function t(e,t,i){e[0]>t[i]&&(e[0]=t[i]),e[1]>t[i+1]&&(e[1]=t[i+1]),e[2]>t[i+2]&&(e[2]=t[i+2]),e[3]<t[i+3]&&(e[3]=t[i+3]),e[4]<t[i+4]&&(e[4]=t[i+4]),e[5]<t[i+5]&&(e[5]=t[i+5])}function i(e,t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5])}function r(e,t,i,r){for(var n=0;n<3;n++)e[t+n]=i[r+3+n]-i[r+n]}function n(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]}var o=1/0;function s(e){e[0]=o,e[1]=o,e[2]=o,e[3]=-o,e[4]=-o,e[5]=-o}function a(e){var t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return t<0||i<0||r<0?0:2*(t*i+i*r+r*t)}function l(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function h(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function c(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}l.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},h.prototype.reset=function(){this.num_prims=0,s(this.box_bbox),s(this.box_centroid)},c.prototype.reset=function(){this.NL=0,this.AL=0,s(this.BL),s(this.CL)};var u,d=[];for(u=0;u<16;u++)d.push(new h);var p=[];for(u=0;u<15;u++)p.push(new c);var f=new Float32Array(6),m=new Float32Array(6);function g(r,o,s,l,h,c,u){if(c[l]<r.scene_epsilon)u.best_cost=1/0;else{var g,v,y=16;for(y>s-o+1&&(y=s-o+1),g=0;g<y;g++)d[g].reset();for(g=0;g<y-1;g++)p[g].reset();for(u.num_bins=y,function(i,r,n,o,s,a,l){for(var h=i.centroids,c=i.primitives,u=i.finfo.boxes,p=i.finfo.boxStride,f=.99999*l/a[o],m=s[o],g=i.sort_prims,v=r;v<=n;v++){var y=0|c[v],b=0|f*(h[3*y+o]-m);b<0?b=0:b>=l&&(b=l-1),g[v]=b,d[b].num_prims++,t(d[b].box_bbox,u,y*p),e(d[b].box_centroid,h,3*y)}}(r,o,s,l,h,c,y),n(p[0].BL,d[0].box_bbox),n(p[0].CL,d[0].box_centroid),p[0].AL=a(p[0].BL),p[0].NL=d[0].num_prims,g=1;g<y-1;g++){v=d[g];var b=p[g];n(b.BL,p[g-1].BL),i(b.BL,v.box_bbox),b.AL=a(b.BL),n(b.CL,p[g-1].CL),i(b.CL,v.box_centroid),b.NL=p[g-1].NL+v.num_prims}n(f,d[g=y-1].box_bbox),n(m,d[g].box_centroid);var x=a(f),_=d[g].num_prims,E=g,A=x*_+p[g-1].AL*p[g-1].NL;for(n(u.vb_right,f),n(u.cb_right,d[g].box_centroid),n(u.vb_left,p[g-1].BL),n(u.cb_left,p[g-1].CL),u.num_left=p[g-1].NL,g-=1;g>=1;g--){v=d[g],i(f,v.box_bbox),i(m,v.box_centroid);var S=(x=a(f))*(_+=v.num_prims)+p[g-1].AL*p[g-1].NL;S<=A&&(A=S,E=g,n(u.vb_right,f),n(u.cb_right,m),n(u.vb_left,p[g-1].BL),n(u.cb_left,p[g-1].CL),u.num_left=p[g-1].NL)}u.best_split=E,u.best_cost=A}}var v=new Float32Array(3);return{bvh_subdivide:function(t,i,n,o,a,h,c,u){r(v,0,h,0);var d=t.nodes,p=c?t.frags_per_leaf_node_transparent:t.frags_per_leaf_node,f=c?t.frags_per_inner_node_transparent:t.frags_per_inner_node,m=t.max_polys_per_node,y=0;v[1]>v[0]&&(y=1),v[2]>v[y]&&(y=2),d.setBox0(i,a);var b=0,x=0,_=o-n+1;if(t.finfo.hasPolygonCounts&&t.frags_per_inner_node)for(var E=_<=t.frags_per_inner_node?o:n+t.frags_per_inner_node-1,A=n;A<=E&&(x++,!((b+=t.finfo.getPolygonCount(t.primitives[A]))>m));A++);if(_<=p&&b<m||1===_||u>15||v[y]<t.scene_epsilon)return d.setLeftChild(i,-1),d.setPrimStart(i,n),d.setPrimCount(i,o-n+1),void d.setFlags(i,0,0,c?1:0);f&&(y=function(t,i,n,o,a,l,h,c){var u=t.primitives,d=t.centroids,p=a-o+1;p>t.frags_per_inner_node&&(p=t.frags_per_inner_node),p>c&&(p=c),i.setPrimStart(n,o),i.setPrimCount(n,p),o+=p,s(l);for(var f=o;f<=a;f++)e(l,d,3*u[f]);r(h,0,l,0);var m=0;return h[1]>h[0]&&(m=1),h[2]>h[m]&&(m=2),m}(t,d,i,n,o,h,v,x),n+=d.getPrimCount(i));var S=new l;if(g(t,n,o,y,h,v,S),S.num_bins<0)d.setPrimCount(i,d.getPrimCount(i)+o-n+1);else{!function(e,t,i,r,n,o,s){var a,l,h=e.primitives,c=e.sort_prims,u=0,d=0|t,p=0|s.best_split;for(a=t;a<=i;a++){var f=0|h[a];c[a]<p?h[d++]=f:c[u++]=f}for(l=0;l<u;l++)h[d+l]=c[l]}(t,n,o,0,0,0,S);var w=d.nextNodes(2),M=.5*(S.vb_left[3+y]+S.vb_left[y]),T=.5*(S.vb_right[3+y]+S.vb_right[y]);d.setFlags(i,y,M<T?0:1,c?1:0),d.setLeftChild(i,w),t.recursion_stack.push([t,w+1,n+S.num_left,o,S.vb_right,S.cb_right,c,u+1]),t.recursion_stack.push([t,w,n,n+S.num_left-1,S.vb_left,S.cb_left,c,u+1])}},compute_boxes:function(i){var n=i.boxv_o,o=i.boxc_o,a=i.boxv_t,l=i.boxc_t;s(n),s(o),s(a),s(l);for(var h,c,u,d,p=i.centroids,f=i.finfo.boxes,m=i.finfo.boxStride,g=0,y=i.prim_count;g<y;g++){var b=i.primitives[g];u=f,d=m*b,(h=p)[c=3*b]=.5*(u[d]+u[d+3]),h[c+1]=.5*(u[d+1]+u[d+4]),h[c+2]=.5*(u[d+2]+u[d+5]),g>=i.first_transparent?(e(l,p,3*b),t(a,f,m*b)):(e(o,p,3*b),t(n,f,m*b))}r(v,0,i.boxv_o,0);var x=Math.max(v[0],v[1],v[2]);i.scene_epsilon=1e-5*x},box_area:function(e,t){var i=e[t+3]-e[t],r=e[t+4]-e[t+1],n=e[t+5]-e[t+2];return i<0||r<0||n<0?0:2*(i*r+r*n+n*i)}}}();function s(e,t){this.boxes=e.boxes,this.polygonCounts=e.polygonCounts,this.hasPolygonCounts=!!this.polygonCounts,this.materials=e.materials,this.materialDefs=t,this.count=e.length,this.boxStride=6,this.wantSort=!0}function a(e,t,i){this.finfo=i||new s(e,t),this.prim_count=this.finfo.getCount(),this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(n*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}s.prototype.getCount=function(){return this.count},s.prototype.isTransparent=function(e){return!(!this.materialDefs||!this.materialDefs[this.materials[e]])&&this.materialDefs[this.materials[e]].transparent},s.prototype.getPolygonCount=function(e){return this.polygonCounts[e]},a.prototype.sortPrimitives=function(e){var t,i,r=new Float32Array(this.work_buf),n=this.primitives,s=0,a=e;for(t=0,i=this.prim_count;t<i;t++){n[t]=t;var l=this.finfo.isTransparent(t);l&&s++,a?(r[t]=o.box_area(this.finfo.boxes,this.finfo.boxStride*t),l&&(r[t]=-r[t])):r[t]=l?-1:1}if(a)Array.prototype.sort.call(this.primitives,(function(e,t){return r[t]-r[e]}));else if(s&&s<this.prim_count){var h=new Int32Array(s),c=0,u=0;for(t=0,i=this.prim_count;t<i;t++)r[t]>=0?n[c++]=n[t]:h[u++]=n[t];n.set(h,this.prim_count-s)}this.first_transparent=this.prim_count-s},a.prototype.build=function(e){var t=e&&!!e.useSlimNodes,i=this;function n(t,r){Object.prototype.hasOwnProperty.call(e,t)?i[t]=e[t]:i[t]=r}if(t)n("frags_per_leaf_node",1),n("frags_per_inner_node",0),n("frags_per_leaf_node_transparent",1),n("frags_per_inner_node_transparent",0),n("max_polys_per_node",1/0);else{var s=e.isWeakDevice?.5:1;n("frags_per_leaf_node",0|256*s),n("frags_per_inner_node",0|this.frags_per_leaf_node),n("frags_per_leaf_node_transparent",this.frags_per_leaf_node),n("frags_per_inner_node_transparent",0),n("max_polys_per_node",0|2e4*s)}if(this.nodes&&this.nodes.is_lean_node==t)this.nodes.nodeCount=0;else{for(var a=this.prim_count/this.frags_per_leaf_node,l=1;l<a;)l*=2;this.nodes=new r(l,!!e&&e.useSlimNodes)}this.sortPrimitives(this.finfo.wantSort),o.compute_boxes(this);var h,c=this.nodes.nextNodes(2);for(o.bvh_subdivide(this,c,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)h=this.recursion_stack.pop(),o.bvh_subdivide(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(o.bvh_subdivide(this,c+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)h=this.recursion_stack.pop(),o.bvh_subdivide(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7])}},70173:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BoundsCallback:()=>n});var r=i(75050);function n(e){this.bounds=e,this.point=new r.Vector4,this.point.z=0,this.point.w=1}n.prototype.onVertex=function(e,t,i){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},n.prototype.onLineSegment=function(e,t,i,r,n){this.onVertex(e,t),this.onVertex(i,r)},n.prototype.onCircularArc=function(e,t,i,r,n,o){this.onEllipticalArc(e,t,i,r,n,n,0,o)},n.prototype.onEllipticalArc=function(e,t,i,r,n,o,s,a){0==s?i<=0&&r>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*n,2*o,s,a):(this.point.x=e+Math.cos(i)*n,this.point.y=t+Math.sin(i)*o,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(r)*n,this.point.y=t+Math.sin(r)*o,this.bounds.expandByPoint(this.point),i>r&&(this.point.x=e+n,this.point.y=t,this.bounds.expandByPoint(this.point),i-=2*Math.PI),i<.5*Math.PI&&r>.5*Math.PI&&(this.point.x=e,this.point.y=t+o,this.bounds.expandByPoint(this.point)),i<Math.PI&&r>Math.PI&&(this.point.x=e-n,this.point.y=t,this.bounds.expandByPoint(this.point)),i<1.5*Math.PI&&r>1.5*Math.PI&&(this.point.x=e,this.point.y=t-o,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*n,2*o,s,a)},n.prototype.onTexQuad=function(e,t,i,n,o,s){var a=.5*i,l=.5*i;if(0==o)this.onVertex(e-a,t-l),this.onVertex(e+a,t+l);else{var h=new r.Matrix4,c=new r.Matrix4;h.makeRotationZ(o),c.makeTranslation(e,t,0),c.multiply(h);for(var u=0;u<4;u++)this.point.x=u%2==1?a:-a,this.point.y=u>=2?l:-l,this.point.applyMatrix4(c),this.bounds.expandByPoint(this.point)}},n.prototype.onOneTriangle=function(e,t,i,r,n,o,s){this.onVertex(e,t),this.onVertex(i,r),this.onVertex(n,o)}},86945:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BufferGeometryUtils:()=>m,createBufferGeometry:()=>p,findBufferAttribute:()=>a,meshToGeometry:()=>f});var r=i(7247),n=i(75050),o=i(60489),s={};function a(e,t,i){var r,a=t.normalize||t.normalized;if(!t.isInterleavedBufferAttribute&&t.array)r=new n.BufferAttribute(t.array,t.itemSize);else{var l=e+"|"+t.bytesPerItem+"|"+a+"|"+t.isPattern+"|"+t.divisor+"|"+t.offset;if(r=s[l])return r;r=new n.BufferAttribute(void 0,t.itemSize),s[l]=r}return r.normalized=a,r.bytesPerItem=t.bytesPerItem,r.isPattern=t.isPattern,i&&(r.divisor=t.divisor),!t.isInterleavedBufferAttribute&&t.array||(Object.prototype.hasOwnProperty.call(t,"offset")?r.offset=t.offset:o.logger.warn("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.")),r}var l,h,c={};var u=1,d=function(){this.id=u++,this.attributes={},this.__webglInit=void 0};function p(e){return l||((l=new n.BufferAttribute(void 0,1)).bytesPerItem=2,(h=new n.BufferAttribute(void 0,1)).bytesPerItem=4),new d}function f(e){var t=e.mesh,i=p(t.numInstances);for(var o in(0,r.isNodeJS)()&&(i.packId=e.packId,i.meshIndex=e.meshIndex),i.byteSize=0,i.vb=t.vb,i.vbbuffer=void 0,i.vbNeedsUpdate=!0,i.vbstride=t.vbstride,i.byteSize+=t.vb.byteLength,i.hash=e.hash,t.isLines&&(i.isLines=t.isLines),t.isWideLines&&(i.isWideLines=!0,i.lineWidth=t.lineWidth),t.isPoints&&(i.isPoints=t.isPoints,i.pointSize=t.pointSize),e.is2d&&(i.is2d=!0),i.numInstances=t.numInstances,t.vblayout){var s=t.vblayout[o];i.attributes[o]=a(o,s,t.numInstances)}return i.index=t.indices instanceof Uint32Array?h:l,i.ib=t.indices,i.ibbuffer=void 0,t.iblines&&(i.attributes.indexlines=t.iblines instanceof Uint32Array?h:l,i.iblines=t.iblines,i.iblinesbuffer=void 0),i.attributesKeys=function(e){var t="";for(var i in e.attributes)t+=i+"|";var r=c[t];return r||(r=Object.keys(e.attributes),c[t]=r,r)}(i),i.byteSize+=t.indices.byteLength,t.boundingBox&&(i.boundingBox=(new n.Box3).copy(t.boundingBox),i.boundingSphere=(new n.Sphere).copy(t.boundingSphere)),i}d.prototype=Object.create(n.BufferGeometry.prototype),d.prototype.clone=function(){const e=new d;e.ib=this.ib,e.vb=this.vb,e.vbstride=this.vbstride,e.byteSize=this.byteSize,e.isLines=this.isLines,e.isWideLines=this.isWideLines,e.lineWidth=this.lineWidth,e.isPoints=this.isPoints,e.pointSize=this.pointSize,e.index=this.index;for(const t in this.attributes){const i=this.attributes[t],r=i.array?new i.array.constructor(this.array):void 0,o=new n.BufferAttribute(r,i.itemSize);o.itemOffset=i.itemOffset,o.bytesPerItem=i.bytesPerItem,o.normalized=i.normalized,e.setAttribute(t,o)}if(this.groups)for(var t=0,i=this.groups.length;t<i;t++){var r=this.groups[t];e.groups.push({start:r.start,index:r.index,count:r.count})}return e},d.prototype.constructor=d,d.prototype.isLeanBufferGeometry=!0;let m={meshToGeometry:f,createBufferGeometry:p,findBufferAttribute:a}},12529:(e,t,i)=>{"use strict";function r(e){var t;if(!e)return 0;return((null===(t=e.attributes.index)||void 0===t?void 0:t.array)||e.ib).length/3||0}function n(e){var t,i,r;return((null===(t=e.vb)||void 0===t?void 0:t.byteLength)||0)+((null===(i=e.ib)||void 0===i?void 0:i.byteLength)||0)+((null===(r=e.iblines)||void 0===r?void 0:r.byteLength)||0)}i.r(t),i.d(t,{getByteSize:()=>n,getPolygonCount:()=>r})},33614:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeshAccessor:()=>f,createWireframe:()=>m});var r=i(97559),n=i(96164),o=i(60812);const s=1e-6;const a={x:0,y:0,z:0};class l{constructor(e,t,i){this.getVertex=e,this.bbox=t,this.boxSize=this.bbox.getSize().length(),i||(i=s),i>0?(this.precisionTolerance=i,this.scale=1/this.precisionTolerance):(this.precisionTolerance=-i*this.boxSize,this.scale=1/this.precisionTolerance),this.snapBaseX=this.bbox.min.x,this.snapBaseY=this.bbox.min.y,this.snapBaseZ=this.bbox.min.z,this.xymap={}}findOrAddPoint(e,t,i,r){let n,o=0|(e-this.snapBaseX)*this.scale,s=0|(t-this.snapBaseY)*this.scale,l=0|(i-this.snapBaseZ)*this.scale,h=1/0;for(let r=o-1;r<=o+1;r++){let o=this.xymap[r];if(o)for(let r=s-1;r<=s+1;r++){let s=o[r];if(s)for(let r=l-1;r<=l+1;r++){let o=s[r];if(void 0===o)continue;this.getVertex(o,a);let l=a,c=(l.x-e)*(l.x-e)+(l.y-t)*(l.y-t)+(l.z-i)*(l.z-i);c<h&&(n=o,h=c)}}}if(Math.sqrt(h)>this.precisionTolerance&&(n=void 0),void 0===n){let e=this.xymap[o];e||(e=this.xymap[o]={});let t=e[s];return t||(t=e[s]={}),t[l]=r,r}return n}}let h=new n.LmvVector3,c=new n.LmvVector3,u=new n.LmvVector3,d=new n.LmvVector3,p=new n.LmvVector3;class f{constructor(e,t,i){let s=e.boundingBox||i,a=new o.LmvBox3;s&&a.copy(s),this.geom=e,this.myVerts=function(e,t){var i=new Float32Array(3*(0,r.getVertexCount)(e));return(0,r.enumMeshVertices)(e,(function(e,r,n,o){t&&t.expandByPoint(e),i[3*o]=e.x,i[3*o+1]=e.y,i[3*o+2]=e.z})),i}(e,s?null:a);let h=new l(this.getV.bind(this),a,-1/65536);this.remap=new Array((0,r.getVertexCount)(e));for(let e=0,t=0;e<this.myVerts.length;e+=3,t++)this.remap[t]=h.findOrAddPoint(this.myVerts[e],this.myVerts[e+1],this.myVerts[e+2],t);t&&function(e,t){let i=new n.LmvVector3;for(let r=0;r<e.length;r+=3)i.x=e[r],i.y=e[r+1],i.z=e[r+2],i.applyMatrix4(t),e[r]=i.x,e[r+1]=i.y,e[r+2]=i.z}(this.myVerts,t)}getV(e,t){t.x=this.myVerts[3*e],t.y=this.myVerts[3*e+1],t.z=this.myVerts[3*e+2]}getNormal(e,t,i,r){this.getV(e,h),this.getV(t,c),this.getV(i,u),c.sub(h),u.sub(h),c.cross(u),r.copy(c).normalize()}}function m(e,t,i,n){if("isLines"in e&&e.isLines||"indexlines"in e||"iblines"in e)return;let o=new f(e,t,i);var s={},a=[];function l(e,t,i){var r=o.remap[e],l=o.remap[t],h=o.remap[i];if(r!==l&&r!==h&&l!==h){var c=!1;if(r>l){var u=r;r=l,l=u,c=!0}var f=s[r];if(f){var m=f[l];if(void 0===m)f[l]=c?-i-1:i;else{if(n)a.push(e),a.push(t);else{o.getNormal(e,t,i,d),m<0?o.getNormal(l,r,o.remap[-m-1],p):o.getNormal(r,l,o.remap[m],p);var g=d.dot(p);Math.abs(g)<.25&&(a.push(e),a.push(t))}delete f[l]}}else s[r]={},s[r][l]=i}}for(var h in(0,r.enumMeshTriangles)(e,(function(e,t,i,r,n,o){l(r,n,o),l(n,o,r),l(o,r,n)})),s)for(var c in s[h])a.push(parseInt(h)),a.push(parseInt(c));a.length<2||(e.iblines=new Uint16Array(a.length),e.iblines.set(a))}},71857:(e,t,i)=>{"use strict";function r(){let e,t,i,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=0;const s=[],a=[];let l,h,c,u;const d=n.timeSlice||15,p=n.sliceDelay||0,f=n.delay??-1;function m(e){o&&clearTimeout(o),o=0,i=e,s.length=0,a.length=0,l=null,h=-1,c=0,u=0}function g(){o=0;const n=performance.now()+d;for(;performance.now()<n;){var l;if(!x())return m(null),void(null===(l=t)||void 0===l||l());e(a[u],s[c],r,u+1>=a.length,!i||h>=i.length)}o=setTimeout((()=>g()),p)}function v(){if(i&&h<i.length)for(;++h<i.length;){if(l=i[h].getInstanceTree(),s.length=0,l)l.enumNodeChildren(i[h].getRootId(),(function(e){s.push(e)}),!0);else{var e;const t=i[h].getFragmentList();null!=t&&null!==(e=t.fragments)&&void 0!==e&&e.dbId2fragId&&s.push(...Object.keys(t.fragments.dbId2fragId).map((e=>parseInt(e))))}if(s.length>0)return r=i[h],r}return r=null,!1}function y(e){if(l)return!l.isNodeHidden(e)&&!l.isNodeOff(e);return!i[h].getFragmentList().dbIdIsGhosted[e]}function b(){if(c>=s.length)return!1;for(;++c<s.length;){const e=s[c];if(n.includeHidden||y(e)){a.length=0;const t=i[h].getFragmentList();if(l)l.enumNodeFragments(e,(function(e){t.isFragVisible(e)&&a.push(e)}),!1);else if(t){let i=t.fragments.dbId2fragId[e];Array.isArray(i)||(i=[i]),i=i.filter((e=>t.isFragVisible(e))),a.push(...i)}if(a.length>0)return!0}}return!1}function x(){if(++u<a.length)return!0;for(u=0;;){if(b())return!0;if(!v())return!1;c=-1}}this.start=function(i,r,n){Array.isArray(i)||(i=[i]),m(i),e=r,t=n,r&&(f>=0?o=setTimeout((()=>g()),f):g())},this.stop=function(){m(null)}}i.r(t),i.d(t,{FragmentIterator:()=>r})},33303:(e,t,i)=>{"use strict";i.r(t),i.d(t,{FragmentList:()=>y,FragmentPointer:()=>b});var r=i(75050),n=i(33736),o=i(60489),s=i(27923),a=i(90245),l=new Uint32Array(1);function h(e){var t;this.geometry=e,this.vb=e.vb.buffer,this.stride=e.vbstride,this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.vcount=this.vbi.length/this.stride,this.useCompactBuffers=e.unpackXform,this.texData=this.useCompactBuffers&&(null===(t=e.tIdColor)||void 0===t||null===(t=t.image)||void 0===t?void 0:t.data)&&new Uint32Array(e.tIdColor.image.data.buffer),this.texColMap=(()=>{if(!this.texData)return null;const e={},t=new Set;for(let i=0;i<this.vcount;++i){const r=this.vbs[i*this.stride*2+6];t.has(r)||(e[this.texData[r]]=r,t.add(r))}return e})()}h.prototype.setColorAt=function(e,t){if(this.texData){if(r=t,l[0]=r,!((t=l[0])in this.texColMap)){const e=this.texData;if(e.length+1>65536)return void o.logger.warn("setColorAt() cannot add new color as size limit reached");const r=new Uint32Array(e.length+1);r.set(e,0),r[e.length]=t,this.texColMap[t]=e.length;var i=new THREE.DataTexture(new Uint8Array(r.buffer),r.length,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);i.generateMipmaps=!1,i.flipY=!1,i.needsUpdate=!0,this.geometry.tIdColor.dispose(),this.geometry.tIdColor=i,this.texData=new Uint32Array(i.image.data.buffer),this.geometry.vIdColorTexSize=new THREE.Vector2(r.length,1)}this.vbs[e*this.stride*2+6]=this.texColMap[t]}else this.vbi[e*this.stride+6]=t;var r},h.prototype.setVertexFlagsAt=function(e,t){this.texData?this.vbi[e*this.stride+4]=t:this.vbi[e*this.stride+8]=t};const c=new r.Matrix4,u=new r.Box3,d=new r.Quaternion,p=new r.Vector3,f=new r.Vector3,m=new r.Matrix4,g=new r.Color,v=new r.Color;class y{is2d;modelId;fragments;geoms;isFixedSize;vizflags;useThreeMesh;vizMeshes;allVisible=!0;allVisibleDirty=!0;linesHidden=!1;pointsHidden=!1;matrix=null;viewBounds=null;materialmap={};materialIdMap={};nextMaterialId=1;materialIdMapOriginal=null;db2ThemingColor=[];originalColors=[];themingOrGhostingNeedsUpdate={};themingOrGhostingNeedsUpdateByDbId={};dbIdOpacity=[];dbIdIsGhosted=[];animxforms=null;nextAvailableFragID;constructor(e,t,i,r,n,o){var a;this.is2d=o.is2d,this.modelId=i,this.fragments=e,this.geoms=t,this.isFixedSize=this.fragments.length>0,this.isFixedSize?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!1):(this.boxes=null,this.transforms=null,this.useThreeMesh=!0);const l=this.fragments.length;this.vizflags=new Uint16Array(l),this.useThreeMesh&&(this.vizmeshes=new Array(l)),o.isOTG?(this.materialids=(0,s.R)(l,r),this.geomids=(0,s.R)(l,n)):(this.geomids=new Int32Array(l),this.materialids=new Int32Array(l));for(let e=0;e<l;e++)this.vizflags[e]=1;!o.isOTG&&null!==(a=this.fragments)&&void 0!==a&&a.visibilityFlags&&this.vizflags.set(this.fragments.visibilityFlags),this.nextAvailableFragID=l}getNextAvailableFragmentId(){return this.nextAvailableFragID++}fragmentsHaveBeenAdded(){return this.vizflags.length>this.fragments.length}getSvfMaterialId(e){var t=this.getMaterial(e);return t?t.svfMatId:void 0}setMesh(e,t,i,s){if(this.vizmeshes){const t=this.vizmeshes[e];t&&t.parent&&t.parent.remove(t)}if(this.vizflags.length<=e){this.isFixedSize&&(o.logger.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);let t=Math.ceil(1.5*Math.max(this.vizflags.length,e))||1;this.useThreeMesh&&t<this.vizmeshes.length&&(t=this.vizmeshes.length);const i=new Uint16Array(t);if(i.set(this.vizflags),this.vizflags=i,this.transforms){const e=new Float32Array(12*t);e.set(this.transforms),this.transforms=e}if(this.boxes){const e=new Float32Array(6*t);e.set(this.boxes),this.boxes=e}if(this.geomids){const e=new Int32Array(t);e.set(this.geomids),this.geomids=e}if(this.materialids){const e=new Int32Array(t);e.set(this.materialids),this.materialids=e}}if(this.useThreeMesh){let i;s&&t instanceof r.Mesh?(i=t,t.matrix&&i.matrixWorld.copy(t.matrix),i.dbId=i.dbId||0):(i=new r.Mesh(t.geometry,t.material),t.matrix&&(i.matrix&&i.matrix.copy(t.matrix),i.matrixWorld.copy(t.matrix)),i.is2d=t.is2d,i.isLine=t.isLine,i.isWideLine=t.isWideLine,i.isPoint=t.isPoint,i.dbId=0|this.fragments.fragId2dbId[e]),i.matrixAutoUpdate=!1,i.frustumCulled=!1,i.fragId=e,i.modelId=this.modelId,this.matrix&&i.matrixWorld.multiplyMatrices(this.matrix,i.matrix),this.vizmeshes[e]=i}else{let i;t.geometry.hash?(void 0===t.geomId&&console.error("meshInfo must provide geomId"),i=t.geomId):i=t.geometry.svfid,this.geomids[e]=i,this.setMaterial(e,t.material)}let a=0;if(t.isLine?a=n.MeshFlags.MESH_ISLINE:t.isWideLine?a=n.MeshFlags.MESH_ISWIDELINE:t.isPoint&&(a=n.MeshFlags.MESH_ISPOINT),this.isFixedSize?this.vizflags[e]|=a:this.vizflags[e]|=n.MeshFlags.MESH_VISIBLE|a,i&&this.transforms&&this.boxes){const i=t.matrix,r=12*e,n=i.elements,o=this.transforms;if(o[r]=n[0],o[r+1]=n[1],o[r+2]=n[2],o[r+3]=n[4],o[r+4]=n[5],o[r+5]=n[6],o[r+6]=n[8],o[r+7]=n[9],o[r+8]=n[10],o[r+9]=n[12],o[r+10]=n[13],o[r+11]=n[14],!this.fragments.boxesLoaded){t.bbox?u.copy(t.bbox):(t.geometry&&t.geometry.boundingBox?u.copy(t.geometry.boundingBox):this.geoms.getModelBox(this.geomids[e],u),u.isEmpty()||u.applyMatrix4(i));const r=6*e,n=this.boxes;n[r]=u.min.x,n[r+1]=u.min.y,n[r+2]=u.min.z,n[r+3]=u.max.x,n[r+4]=u.max.y,n[r+5]=u.max.z}}this.#E(e)}isFlagSet(e,t){return!!(this.vizflags[e]&t)}setFlagFragment(e,t,i){var r=this.vizflags[e];return!!(r&t)!=i&&(this.vizflags[e]=i?r|t:r&~t,!0)}setFlagGlobal(e,t){var i=this.vizflags,r=0,n=i.length;if(t)for(;r<n;r++)i[r]=i[r]|e;else for(var o=~e;r<n;r++)i[r]=i[r]&o}hideLines(e){this.linesHidden=e}hidePoints(e){this.pointsHidden=e}hideFragments(e,t){var i=n.MeshFlags.MESH_HIDE,r=this.vizflags,o=0,s=r.length;if(t)for(;o<s;o++)r[o]&e&&(r[o]=r[o]|i);else for(var a=~i;o<s;o++)r[o]&e&&(r[o]=r[o]&a);this.allVisibleDirty=!0}isFragVisible(e){var t=this.linesHidden&&(this.isLine(e)||this.isWideLine(e)),i=this.pointsHidden&&this.isPoint(e);return 1==(7&this.vizflags[e])&&!t&&!i}isFragOff(e){return!!(this.vizflags[e]&n.MeshFlags.MESH_HIDE)}isVisible(e){return!!(this.vizflags[e]&n.MeshFlags.MESH_VISIBLE)}isNotLoaded(e){return!!(this.vizflags[e]&n.MeshFlags.MESH_NOTLOADED)}isLine(e){return!!(this.vizflags[e]&n.MeshFlags.MESH_ISLINE)}isWideLine(e){return this.isFlagSet(e,n.MeshFlags.MESH_ISWIDELINE)}isPoint(e){return this.isFlagSet(e,n.MeshFlags.MESH_ISPOINT)}unload(e){if(this.useThreeMesh)return 0;let t=0;for(const i of e)this.setFlagFragment(i,n.MeshFlags.MESH_NOTLOADED,!0)&&(this.setFragOff(i,!0),this.geoms.removeInstance(this.geomids[i]),++t);return t}areAllVisible(){if(this.allVisibleDirty){for(var e=this.vizflags,t=!0,i=0,r=e.length;i<r;i++)if(0==(1&e[i])||4==(4&e[i])){t=!1;break}this.allVisible=t,this.allVisibleDirty=!1}return this.allVisible}static#A(e){const t=e.r;return e.r=e.b,e.b=t,e}#S(e,t){return g.set(16777215&e),y.#A(g),t&&(v.setRGB(t.x,t.y,t.z),g.lerp(v,t.w)),y.#A(g).getHex()|4278190080&e}#w(e){var t=this.originalColors[e],i=this.getGeometry(e);if(!i.vb)return void console.error("Unexpected non-interleaved vertex buffer");const r=new a.VertexBufferReader(i),n=new h(i);if(r.isInterleavedVb){for(var o=!1,s=r.vcount,l=0;l<s;l++){var c=r.getDbIdAt(l),u=t?t[l]:r.getColorAt(l),d=r.getLayerIndexAt(l),p=-1===(c=c<<8>>8)&&0===d,f=this.db2ThemingColor[c],m=0===this.dbIdOpacity[c];if(f||m){if(!t){t=new Uint32Array(s);for(var g=0;g<s;g++)t[g]=r.getColorAt(g);this.originalColors[e]=t}u=m?0:this.#S(u,f),o=!0}else t&&(u=t[l]);if(!m){let e=this.dbIdOpacity[c];if(!isNaN(e)){e=255*e<<24,u=u&parseInt("00FFFFFF",16)|e}}n.setColorAt(l,u);var v=this.dbIdIsGhosted[c]&&!p,y=r.getVertexFlagsAt(l);v?y|=255<<24:y&=16777215,n.setVertexFlagsAt(l,y)}o||(this.originalColors[e]=null),i.vbNeedsUpdate=!0}}#M(e){this.themingOrGhostingNeedsUpdate[e]&&(this.#w(e),this.themingOrGhostingNeedsUpdate[e]=!1)}#E(e){if(this.is2d&&!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(this.themingOrGhostingNeedsUpdateByDbId)){let t=this.getDbIds(e);t=Array.isArray(t)?t:[t],t=t.filter((e=>this.themingOrGhostingNeedsUpdateByDbId[e])),t.length&&(this.#w(e),t.forEach((e=>{delete this.themingOrGhostingNeedsUpdateByDbId[e]})))}}getVizmesh(e){if(this.is2d&&this.#M(e),this.useThreeMesh){const t=this.vizmeshes[e];return t&&(t.themingColor=this.db2ThemingColor[t.dbId]),t}const t=this.scratchMesh=this.scratchMesh||function(){var e=new r.Mesh;return e.isTemp=!0,e.dbId=0,e.modelId=0,e.fragId=-1,e.hide=!1,e.isLine=!1,e.isWideLine=!1,e.isPoint=!1,e.frustumCulled=!1,e}();return t.geometry=this.getGeometry(e),t.material=this.getMaterial(e),t.dbId=this.getDbIds(e),t.modelId=this.modelId,t.fragId=e,t.visible=!0,t.isLine=this.isLine(e),t.isWideLine=this.isWideLine(e),t.isPoint=this.isPoint(e),t.hide=this.isFragOff(e),t.themingColor=this.db2ThemingColor[t.dbId],this.getWorldMatrix(e,t.matrixWorld),t}getMaterialId(e){var t=this.getMaterial(e);return t?t.id:0}getMaterial(e){return this.useThreeMesh?this.vizmeshes[e].material:this.materialIdMap[this.materialids[e]]}storeOriginalMaterials(){let e,t;this.materialIdMapOriginal=[];for(let i=0;i<this.fragments.length;i++)e=this.getMaterial(i),t=e.id,this.materialIdMapOriginal.push(t)}restoreOriginalMaterials(){if(!this.materialIdMapOriginal)return;let e;for(let t=0;t<this.materialIdMapOriginal.length;t++)e=this.materialIdMapOriginal[t],this.setMaterial(t,this.materialIdMap[this.materialmap[e]])}getGeometry(e){var t;return this.useThreeMesh?(t=this.vizmeshes[e])?t.geometry:null:this.geoms.getGeometry(this.geomids[e])}hasGeometry(e){var t;return this.useThreeMesh?!!(t=this.vizmeshes[e])&&!!t.geometry:this.geoms.hasGeometry(this.geomids[e])}getGeometryId(e){return this.useThreeMesh?e:this.geomids[e]}setMaterial(e,t){if(this.useThreeMesh)this.vizmeshes[e].material=t;else{var i=this.materialmap[t.id];i||(i=this.nextMaterialId++,this.materialids=(0,s.W)(this.materialids,i),this.materialIdMap[i]=t,this.materialmap[t.id]=i),this.materialids[e]=i}}getCount(){return this.vizmeshes?this.vizmeshes.length:this.vizflags.length}getDbIds(e){return this.fragments.fragId2dbId[e]}getThemingColor(e){return this.db2ThemingColor[this.fragments.fragId2dbId[e]]}dispose(){if(this.useThreeMesh)for(var e={type:"dispose"},t={type:"removed"},i=0;i<this.vizmeshes.length;i++){var r=this.vizmeshes[i];r&&(r.dispatchEvent(t),r.geometry.dispatchEvent(e))}else this.geoms.dispose()}dtor(){this.dispose(),this.scratchMesh=null,this.fragments=null,this.geoms.dtor(),this.geoms=null,this.boxes=null,this.transforms=null,this.vizflags=null,this.vizmeshes=null,this.geomids=null,this.materialids=null,this.materialmap=null,this.materialIdMap=null,this.db2ThemingColor=null,this.originalColors=null,this.themingOrGhostingNeedsUpdate=null,this.themingOrGhostingNeedsUpdateByDbId=null,this.dbIdOpacity=null,this.dbIdIsGhosted=null,this.animxforms=null,this.matrix=null,this.viewBounds=null}setVisibility(e,t){this.setFlagFragment(e,n.MeshFlags.MESH_VISIBLE,t),this.allVisibleDirty=!0}setFragOff(e,t){this.setFlagFragment(e,n.MeshFlags.MESH_HIDE,t),this.allVisibleDirty=!0}setAllVisibility(e){if(this.is2d){var t=this.fragments;if(t&&t.dbId2fragId)for(var i in t.dbId2fragId)this.setObject2DGhosted(parseInt(i),!e)}else this.setFlagGlobal(n.MeshFlags.MESH_VISIBLE,e);this.allVisible=e,this.allVisibleDirty=!1}updateAnimTransform(e,t,i,r){var o,s=this.animxforms;if(!s){var a=this.getCount();s=this.animxforms=new Float32Array(10*a);for(var l=0;l<a;l++)s[o=10*l]=1,s[o+1]=1,s[o+2]=1,s[o+3]=0,s[o+4]=0,s[o+5]=0,s[o+6]=1,s[o+7]=0,s[o+8]=0,s[o+9]=0}o=10*e;var h=!1;t&&(s[o]=t.x,s[o+1]=t.y,s[o+2]=t.z,h=!0),i&&(s[o+3]=i.x,s[o+4]=i.y,s[o+5]=i.z,s[o+6]=i.w,h=!0),r&&(s[o+7]=r.x,s[o+8]=r.y,s[o+9]=r.z,h=!0),this.setFlagFragment(e,n.MeshFlags.MESH_MOVED,h),h||(s[o]=1,s[o+1]=1,s[o+2]=1,s[o+3]=0,s[o+4]=0,s[o+5]=0,s[o+6]=1,s[o+7]=0,s[o+8]=0,s[o+9]=0)}getAnimTransform(e,t,i,r){if(!this.animxforms)return!1;if(!this.isFlagSet(e,n.MeshFlags.MESH_MOVED))return!1;var o=10*e,s=this.animxforms;return t&&(t.x=s[o],t.y=s[o+1],t.z=s[o+2]),i&&(i.x=s[o+3],i.y=s[o+4],i.z=s[o+5],i.w=s[o+6]),r&&(r.x=s[o+7],r.y=s[o+8],r.z=s[o+9]),!0}getOriginalWorldMatrix(e,t){var i=12*e,r=t.elements,n=this.transforms;if(n)r[0]=n[i],r[1]=n[i+1],r[2]=n[i+2],r[3]=0,r[4]=n[i+3],r[5]=n[i+4],r[6]=n[i+5],r[7]=0,r[8]=n[i+6],r[9]=n[i+7],r[10]=n[i+8],r[11]=0,r[12]=n[i+9],r[13]=n[i+10],r[14]=n[i+11],r[15]=1;else if(this.useThreeMesh){var o=this.vizmeshes[e];o?t.copy(o.matrix):t.identity()}else t.identity()}getWorldMatrix(e,t){this.getOriginalWorldMatrix(e,t),this.isFlagSet(e,n.MeshFlags.MESH_MOVED)&&(this.getAnimTransform(e,f,d,p),m.compose(p,d,f),t.multiplyMatrices(m,t)),this.matrix&&t.multiplyMatrices(this.matrix,t)}setModelMatrix(e){e?(this.matrix=this.matrix||new r.Matrix4,this.matrix.copy(e),this.useThreeMesh&&this.vizmeshes.forEach((e=>{e.matrixWorld.multiplyMatrices(this.matrix,e.matrix)}))):(this.matrix=null,this.useThreeMesh&&this.vizmeshes.forEach((e=>{e.matrixWorld.copy(e.matrix)}))),this.invMatrix=null}getInverseModelMatrix(){return this.matrix?(this.invMatrix||(this.invMatrix=this.matrix.clone().invert()),this.invMatrix):null}getWorldBounds(e,t){if(this.boxes&&!this.isFlagSet(e,n.MeshFlags.MESH_MOVED)){var i=this.boxes,r=6*e;return t.min.x=i[r],t.min.y=i[r+1],t.min.z=i[r+2],t.max.x=i[r+3],t.max.y=i[r+4],t.max.z=i[r+5],void(this.matrix&&t.applyMatrix4(this.matrix))}if(this.useThreeMesh){var o=this.vizmeshes[e];o&&o.geometry&&t.copy(o.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],t);this.viewBounds&&t.intersect(this.viewBounds),t.isEmpty()?t.makeEmpty():(this.getWorldMatrix(e,c),t.applyMatrix4(c))}getOriginalWorldBounds(e,t){if(this.boxes){var i=this.boxes,r=6*e;return t[0]=i[r],t[1]=i[r+1],t[2]=i[r+2],t[3]=i[r+3],t[4]=i[r+4],void(t[5]=i[r+5])}if(this.useThreeMesh){var n=this.vizmeshes[e];n&&n.geometry&&u.copy(n.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[e],u);u.isEmpty()||(this.getOriginalWorldMatrix(e,c),u.applyMatrix4(c)),t[0]=u.min.x,t[1]=u.min.y,t[2]=u.min.z,t[3]=u.max.x,t[4]=u.max.y,t[5]=u.max.z}#T(e){if(this.is2d){var t=this.fragments.dbId2fragId[e];if(Array.isArray(t))for(var i=0;i<t.length;i++)this.themingOrGhostingNeedsUpdate[t[i]]=!0;else"number"==typeof t?this.themingOrGhostingNeedsUpdate[t]=!0:this.themingOrGhostingNeedsUpdateByDbId[e]=!0}}setThemingColor(e,t){var i=this.db2ThemingColor[e];i===t||i&&t&&i.equals(t)||(this.db2ThemingColor[e]=t||void 0,this.#T(e))}clearThemingColors(){if(this.is2d){for(var e in this.fragments.dbId2fragId)this.#T(parseInt(e));delete this.db2ThemingColor[-1]}this.db2ThemingColor.length=0}setObject2DGhosted(e,t){!!t!=!!this.dbIdIsGhosted[e]&&(this.dbIdIsGhosted[e]=t,this.#T(e))}setObject2DOpacity(e,t){t!==this.dbIdOpacity[e]&&(this.dbIdOpacity[e]=t,this.#T(e))}setObject2DVisible(e,t){t!==(0!==this.dbIdOpacity[e])&&(this.dbIdOpacity[e]=0|t,this.#T(e))}getViewBounds(){return this.viewBounds}setViewBounds(e){e?(this.viewBounds=this.viewBounds||new r.Box3,this.viewBounds.copy(e),Object.prototype.hasOwnProperty.call(e.max,"z")||(this.viewBounds.max.z=1/0,this.viewBounds.min.z=-1/0)):this.viewBounds=null}getDoNotCut(){return this.doNotCut}setDoNotCut(e){this.doNotCut=e}}class b{frags;fragId;scale=null;quaternion=null;position=null;constructor(e,t){this.frags=e,this.fragId=t}getWorldMatrix(e){this.frags.getWorldMatrix(this.fragId,e)}getOriginalWorldMatrix(e){this.frags.getOriginalWorldMatrix(this.fragId,e)}getWorldBounds(e){return this.frags.getWorldBounds(this.fragId,e)}getAnimTransform(){return this.scale||(this.scale=new r.Vector3(1,1,1),this.quaternion=new r.Quaternion(0,0,0,1),this.position=new r.Vector3(0,0,0)),this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)}updateAnimTransform(){this.scale||(this.scale=new r.Vector3(1,1,1),this.quaternion=new r.Quaternion(0,0,0,1),this.position=new r.Vector3(0,0,0)),this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)}getMaterial(){return this.frags.getMaterial(this.fragId)}setMaterial(e){return this.frags.setMaterial(this.fragId,e)}}},86437:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CONTAINMENT_UNKNOWN:()=>h,CONTAINS:()=>l,FrustumIntersector:()=>o,INTERSECTS:()=>a,OUTSIDE:()=>s});var r=i(75050),n=[[1,5,4,7,3,2,6],[0,3,2,1,5,4,6],[0,3,2,6,5,4,6],[0,4,7,3,2,1,6],[0,3,2,1,-1,-1,4],[0,3,2,6,5,1,6],[0,4,7,6,2,1,6],[0,3,7,6,2,1,6],[0,3,7,6,5,1,6],[0,1,5,4,7,3,6],[0,1,5,4,-1,-1,4],[0,1,2,6,5,4,6],[0,4,7,3,-1,-1,4],[-1,-1,-1,-1,-1,-1,0],[1,2,6,5,-1,-1,4],[0,4,7,6,2,3,6],[2,3,7,6,-1,-1,4],[1,2,3,7,6,5,6],[0,1,5,6,7,3,6],[0,1,5,6,7,4,6],[0,1,2,6,7,4,6],[0,4,5,6,7,3,6],[4,5,6,7,-1,-1,4],[1,2,6,7,4,5,6],[0,4,5,6,2,3,6],[2,3,7,4,5,6,6],[1,2,3,7,4,5,6]];function o(){this.frustum=new r.Frustum,this.viewProj=new r.Matrix4,this.viewDir=[0,0,1],this.ar=1,this.viewport=new r.Vector3(1,1,1),this.areaConv=1,this.areaCullThreshold=1,this.eye=new r.Vector3,this.perspective=!1,this.projScale=1}const s=0,a=1,l=2,h=-1;var c,u;function d(e,t,i){return i.x=1&t?e.max.x:e.min.x,i.y=2&t?e.max.y:e.min.y,i.z=4&t?e.max.z:e.min.z,i}o.OUTSIDE=s,o.INTERSECTS=a,o.CONTAINS=l,o.CONTAINMENT_UNKNOWN=h,o.prototype.reset=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.viewProj.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.perspective=e.isPerspective,this.frustum.setFromProjectionMatrix(this.viewProj);var n=e.matrixWorldInverse.elements;this.ar=e.aspect,this.viewDir[0]=-n[2],this.viewDir[1]=-n[6],this.viewDir[2]=-n[10],this.eye.x=e.position.x,this.eye.y=e.position.y,this.eye.z=e.position.z,this.areaConv=e.clientWidth*e.clientHeight/4,this.cutPlanes=t,this.cutplanesHideInterior=i,this.perspective?this.projScale=e.clientHeight/(2*Math.tan(r.Math.degToRad(e.fov/2))):this.projScale=e.clientHeight/e.orthoScale},o.prototype.projectedArea=function(){var e=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],t=new r.Box2;function i(e,t){var i=e.x,r=e.y,n=e.z,o=t.elements,s=o[3]*i+o[7]*r+o[11]*n+o[15];s<0&&(s=-s);var a=1/s;e.x=(o[0]*i+o[4]*r+o[8]*n+o[12])*a,e.y=(o[1]*i+o[5]*r+o[9]*n+o[13])*a}return function(r){if(r.isEmpty())return 0;var n=this.viewProj;e[0].set(r.min.x,r.min.y,r.min.z),e[1].set(r.min.x,r.min.y,r.max.z),e[2].set(r.min.x,r.max.y,r.min.z),e[3].set(r.min.x,r.max.y,r.max.z),e[4].set(r.max.x,r.min.y,r.min.z),e[5].set(r.max.x,r.min.y,r.max.z),e[6].set(r.max.x,r.max.y,r.min.z),e[7].set(r.max.x,r.max.y,r.max.z);for(var o=0;o<8;o++)i(e[o],n);return t.makeEmpty(),t.setFromPoints(e),t.min.x<-1&&(t.min.x=-1),t.min.x>1&&(t.min.x=1),t.min.y<-1&&(t.min.y=-1),t.min.y>1&&(t.min.y=1),t.max.x>1&&(t.max.x=1),t.max.x<-1&&(t.max.x=-1),t.max.y>1&&(t.max.y=1),t.max.y<-1&&(t.max.y=-1),(t.max.x-t.min.x)*(t.max.y-t.min.y)}}(),o.prototype.projectedBoxArea=function(){for(var e,t=[],i=[],o=0;o<10;o++)t.push(new r.Vector3),i.push(new r.Vector3);function s(e,t){var i=e.x,r=e.y,n=e.z,o=t.elements,s=o[3]*i+o[7]*r+o[11]*n+o[15];s<0&&(s=-s);var a=1/s;e.x=(o[0]*i+o[4]*r+o[8]*n+o[12])*a,e.y=(o[1]*i+o[5]*r+o[9]*n+o[13])*a}return function(r,o){if(r.isEmpty())return 0;var a,l=this.viewProj;if(this.perspective?(a=this.eye.x>=r.min.x?this.eye.x>r.max.x?2:1:0,this.eye.y>=r.min.y&&(a+=this.eye.y>r.max.y?6:3),this.eye.z>=r.min.z&&(a+=this.eye.z>r.max.z?18:9)):(a=this.viewDir[0]<=0?this.viewDir[0]<0?2:1:0,this.viewDir[1]<=0&&(a+=this.viewDir[1]<0?6:3),this.viewDir[2]<=0&&(a+=this.viewDir[2]<0?18:9)),13===a)return 4;var h,c=n[a][6];for(h=0;h<c;h++){var u=n[a][h];t[h].set((u+1)%4<2?r.min.x:r.max.x,u%4<2?r.min.y:r.max.y,u<4?r.min.z:r.max.z),s(t[h],l)}var d=0;if(o)for(d=(t[c-1].x-t[0].x)*(t[c-1].y+t[0].y),h=0;h<c-1;h++)d+=(t[h].x-t[h+1].x)*(t[h].y+t[h+1].y);else{var p=function(t,r){var n,o,s,a,l,h,c,u,d=t,p=i,f=function(e){switch(c){case 0:return e.x>=-1;case 1:return e.x<=1;case 2:return e.y>=-1;case 3:return e.y<=1}},m=function(e){p[u].x=e.x,p[u++].y=e.y},g=function(){var e,t;switch(c){case 0:e=-1,t=o.y+(s.y-o.y)*(e-o.x)/(s.x-o.x);break;case 1:e=1,t=o.y+(s.y-o.y)*(e-o.x)/(s.x-o.x);break;case 2:t=-1,e=o.x+(s.x-o.x)*(t-o.y)/(s.y-o.y);break;case 3:t=1,e=o.x+(s.x-o.x)*(t-o.y)/(s.y-o.y)}p[u].x=e,p[u++].y=t};for(c=0;c<4&&r>2;c++){for(u=0,a=f(o=d[r-1]),h=0;h<r;h++)l=f(s=d[h]),a?l?m(s):g():l&&(g(),m(s)),o=s,a=l;r=u,n=d,d=p,p=n}return e=r,d}(t,c);if(e>=3)for(d=(p[e-1].x-p[0].x)*(p[e-1].y+p[0].y),h=0;h<e-1;h++)d+=(p[h].x-p[h+1].x)*(p[h].y+p[h+1].y)}return Math.abs(.5*d)}}(),o.prototype.estimateDepth=function(e){var t=this.viewProj.elements,i=(e.min.x+e.max.x)/2,r=(e.min.y+e.max.y)/2,n=(e.min.z+e.max.z)/2,o=1/(t[3]*i+t[7]*r+t[11]*n+t[15]);return(t[2]*i+t[6]*r+t[10]*n+t[14])*o},o.prototype.estimateProjectedDiameter=function(e){const t=(e.min.x+e.max.x)/2,i=(e.min.y+e.max.y)/2,r=(e.min.z+e.max.z)/2,n=Math.max(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z);if(this.perspective){const e=(t-this.eye.x)*this.viewDir[0]+(i-this.eye.y)*this.viewDir[1]+(r-this.eye.z)*this.viewDir[2];return n<e?n*this.projScale/e:this.projScale}return n*this.projScale},o.prototype.intersectsBox=(c=new r.Vector3,u=new r.Vector3,function(e){for(var t=this.frustum.planes,i=0,r=0;r<6;r++){var n=t[r];c.x=n.normal.x>0?e.min.x:e.max.x,u.x=n.normal.x>0?e.max.x:e.min.x,c.y=n.normal.y>0?e.min.y:e.max.y,u.y=n.normal.y>0?e.max.y:e.min.y,c.z=n.normal.z>0?e.min.z:e.max.z,u.z=n.normal.z>0?e.max.z:e.min.z;var s=n.distanceToPoint(c),a=n.distanceToPoint(u);if(s<0&&a<0)return o.OUTSIDE;s>0&&a>0&&i++}return 6==i?o.CONTAINS:o.INTERSECTS});var p,f=function(e,t){p||(p=new r.Vector3);for(var i=0;i<8;i++){var n=d(e,i,p);if(s=t,!((o=n).x*s.x+o.y*s.y+o.z*s.z+s.w>1e-6))return!1}var o,s;return!0};let m;o.prototype.boxOutsideCutPlanes=function(e){if(this.cutplanesHideInterior||!this.cutPlanes)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];m||(m=new r.Vector4);let i=0;for(let r=0;r<t.length;r++)m.copy(t[r]).negate(),f(e,m)&&i++;return t.length>3&&i===t.length}(e,this.cutPlanes);for(var t=0;t<this.cutPlanes.length;t++){var i=this.cutPlanes[t];if(f(e,i))return!0}return!1}},7619:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GeometryList:()=>o});var r=i(75050),n=i(1098);function o(e,t,i,r){this.geoms=[null],this.geomPolyCount=0,this.instancePolyCount=0,this.is2d=t,this.geomBoxes=r?null:new Float32Array(6*Math.max(1,e+1)),this.numObjects=e,this.disableStreaming=!!i,this.instanceCount=[null]}o.prototype._getMemoryStat=function(e){const t=n.MemoryTracker.geomListStats.get(this);return t?t[e]:0},Object.defineProperty(o.prototype,"numGeomsInMemory",{get(){return this._getMemoryStat("geomCount")}}),Object.defineProperty(o.prototype,"geomMemory",{get(){return this._getMemoryStat("geomMemory")}}),Object.defineProperty(o.prototype,"gpuNumMeshes",{get(){return this._getMemoryStat("gpuGeomCount")}}),Object.defineProperty(o.prototype,"gpuMeshMemory",{get(){return this._getMemoryStat("gpuGeomMemory")}}),o.prototype.getGeometry=function(e){return this.geoms[e]},o.prototype.hasGeometry=function(e){return!!this.geoms[e]},o.prototype.getCount=function(){return this.geoms.length},o.prototype._addBbox=function(e,t){if(this.geomBoxes){var i=this.geomBoxes.length/6|0;if(i<this.getCount()){var n=3*this.getCount()/2|0,o=new Float32Array(6*n);o.set(this.geomBoxes);var s=new r.Box3;for(s.makeEmpty();i<n;)o[6*i]=s.min.x,o[6*i+1]=s.min.y,o[6*i+2]=s.min.z,o[6*i+3]=s.max.x,o[6*i+4]=s.max.y,o[6*i+++5]=s.max.z;this.geomBoxes=o}this.geomBoxes[6*e]=t.min.x,this.geomBoxes[6*e+1]=t.min.y,this.geomBoxes[6*e+2]=t.min.z,this.geomBoxes[6*e+3]=t.max.x,this.geomBoxes[6*e+4]=t.max.y,this.geomBoxes[6*e+5]=t.max.z}},o.prototype._getPolygonCount=function(e){const t=e.ib;var i=e.isLines?2:3;return t?t.length/i:e.vb?e.vb.length/(i*e.vbstride):e.attributes.position.array.length/(3*i)},o.prototype.addGeometry=function(e,t,i){return e.hash&&e.modelRefCount++,n.MemoryTracker.trackGeometry(this,e),n.MemoryTracker.setMemoryType(this,e,t),(void 0===i||i<=0)&&(i=this.geoms.length),this.geoms[i]=e,e.boundingBox||e.hash||console.error("Mesh without bbox and without hash should not be."),this._addBbox(i,e.boundingBox),this.is2d||(e.boundingBox=null,e.boundingSphere=null),e.polyCount=this._getPolygonCount(e),this.instanceCount[i]=t||1,this.geomPolyCount+=e.polyCount,this.instancePolyCount+=e.polyCount*this.instanceCount[i],e.svfid=i,i},o.prototype.addInstance=function(e){const t=this.getGeometry(e);t&&(this.instancePolyCount+=t.polyCount||0,++this.instanceCount[e])},o.prototype.removeInstance=function(e){const t=this.getGeometry(e);t&&(this.instancePolyCount-=t.polyCount||0,0==--this.instanceCount[e]&&this.removeGeometry(e))},o.prototype.getInstanceCount=function(e){return this.instanceCount[e]},o.prototype.removeGeometry=function(e){var t=this.getGeometry(e);if(!t)return 0;t.hash?(1===t.modelRefCount&&t.dispose(),t.modelRefCount--):t.dispose();const i=n.MemoryTracker.untrackGeometry(this,t);return this.geoms[e]=null,this.geomPolyCount-=t.polyCount,this.instancePolyCount-=this.instanceCount[e]*t.polyCount,this.instanceCount[e]=0,i},o.prototype.getModelBox=function(e,t){if(this.geomBoxes)if(0===e||this.geomBoxes.length/6<=e)t.makeEmpty();else{var i=6*e,r=this.geomBoxes;t.min.x=r[i],t.min.y=r[i+1],t.min.z=r[i+2],t.max.x=r[i+3],t.max.y=r[i+4],t.max.z=r[i+5]}else e>=1&&e<=this.numObjects?(t.min.x=-.5,t.min.y=-.5,t.min.z=-.5,t.max.x=.5,t.max.y=.5,t.max.z=.5):t.makeEmpty()},o.prototype.dispose=function(){let e;for(var t=0,i=this.geoms.length;t<i;t++){if(e=this.geoms[t],!e)return;e.hash?1===e.modelRefCount&&e.dispose():e.dispose()}},o.prototype.dtor=function(){for(var e=1;e<this.geoms.length;e++)this.removeGeometry(e);this.geoms=null,this.instanceCount=null,this.geomBoxes=null},o.prototype.printStats=function(){console.log("Total geometry size: "+this.geomMemory/1048576+" MB"),console.log("Number of meshes: "+(this.getCount()-1)),console.log("Num Meshes on GPU: "+this.gpuNumMeshes),console.log("Net GPU geom memory used: "+this.gpuMeshMemory)}},59957:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InstanceTree:()=>l,NODE_TYPE:()=>o});var r=i(36263),n=i(60489);const o={NODE_TYPE_ASSEMBLY:0,NODE_TYPE_INSERT:1,NODE_TYPE_LAYER:2,NODE_TYPE_COLLECTION:3,NODE_TYPE_COMPOSITE:4,NODE_TYPE_MODEL:5,NODE_TYPE_GEOMETRY:6,NODE_TYPE_BITS:7};var s=1073741824,a=2147483648;function l(e,t,i){this.nodeAccess=e,this.maxDepth=i,this.objectCount=t,this.numHidden=0,this.numOff=0,this.fragList=null}l.prototype.dtor=function(){this.nodeAccess.dtor(),this.nodeAccess=null,this.fragList=null},l.prototype.setFlagNode=function(e,t,i){var r=this.nodeAccess.getNodeFlags(e);return!!(r&t)!=i&&(i?this.nodeAccess.setNodeFlags(e,r|t):this.nodeAccess.setNodeFlags(e,r&~t),!0)},l.prototype.setFlagGlobal=function(e,t){var i=this.nodeAccess,r=0,n=i.numNodes;if(t)for(;r<n;r++)i.setNodeFlags(r,i.getNodeFlags(r)|e);else for(var o=~e;r<n;r++)i.setNodeFlags(r,i.getNodeFlags(r)&o)},l.prototype.setNodeOff=function(e,t){var i=this.setFlagNode(e,s,t);return i&&(t?this.numOff++:this.numOff--),i},l.prototype.isNodeOff=function(e){return!!(this.nodeAccess.getNodeFlags(e)&s)},l.prototype.setNodeHidden=function(e,t){var i=this.setFlagNode(e,a,t);return i&&(t?this.numHidden++:this.numHidden--),i},l.prototype.isNodeHidden=function(e){return!!(this.nodeAccess.getNodeFlags(e)&a)},l.prototype.lockNodeSelection=function(e,t){return this.setFlagNode(e,16384,t)},l.prototype.isNodeSelectionLocked=function(e){return!!(16384&this.nodeAccess.getNodeFlags(e))},l.prototype.lockNodeVisible=function(e,t){return this.setFlagNode(e,4096,t)},l.prototype.isNodeVisibleLocked=function(e){return!!(4096&this.nodeAccess.getNodeFlags(e))},l.prototype.isNodeExplodeLocked=function(e){return!!(8192&this.nodeAccess.getNodeFlags(e))},l.prototype.lockNodeExplode=function(e,t){return this.setFlagNode(e,8192,t)},l.prototype.getNodeType=function(e){return this.nodeAccess.getNodeFlags(e)&o.NODE_TYPE_BITS},l.prototype.isNodeSelectable=function(e){return!(536870912&this.nodeAccess.getNodeFlags(e))},l.prototype.getNodeParentId=function(e){return this.nodeAccess.getParentId(e)},l.prototype.getRootId=function(){return this.nodeAccess.rootId},l.prototype.getNodeName=function(e,t){return this.nodeAccess.name(e,t)},l.prototype.getChildCount=function(e){return this.nodeAccess.getNumChildren(e)};var h=new Array(6);l.prototype.getNodeBox=function(e,t){if(!this.nodeAccess.nodeBoxes)return this.fragList?(t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0,void this.enumNodeFragments(e,(e=>{this.fragList.getOriginalWorldBounds(e,h),t[0]=Math.min(t[0],h[0]),t[1]=Math.min(t[1],h[1]),t[2]=Math.min(t[2],h[2]),t[3]=Math.max(t[3],h[3]),t[4]=Math.max(t[4],h[4]),t[5]=Math.max(t[5],h[5])}),!0)):void n.logger.error("getNodeBox() requires fragBoxes or nodeBoxes");this.nodeAccess.getNodeBox(e,t)},l.prototype.getNodeIndex=function(e){return this.nodeAccess.getIndex(e)},l.prototype.enumNodeFragments=function(e,t,i){var r;"number"==typeof e?r=e:e&&(r=e.dbId);const n=e=>{var r=this.nodeAccess.enumNodeFragments(e,t);return r||(i&&(r=this.enumNodeChildren(e,(e=>n(e))))?r:void 0)};return n(r)},l.prototype.enumNodeChildren=function(e,t,i){var r;if("number"==typeof e?r=e:e&&(r=e.dbId),i&&t(r))return r;const n=e=>{var r=this.nodeAccess.enumNodeChildren(e,(r=>t(r,e)?r:i?n(r):void 0));if(r)return r};return n(r)},l.prototype.findNodeForSelection=function(e,t){if(t===r.SelectionMode.LEAF_OBJECT)return e;var i,n,s=e;if(t===r.SelectionMode.FIRST_OBJECT){var a=[];for(i=e;i;)a.push(i),i=this.getNodeParentId(i);for(var l=a.length-1;l>=0;l--)if((n=this.getNodeType(a[l]))!==o.NODE_TYPE_MODEL&&n!==o.NODE_TYPE_LAYER&&n!==o.NODE_TYPE_COLLECTION){s=a[l];break}}else if(t===r.SelectionMode.LAST_OBJECT)for(i=e;i;){if((n=this.getNodeType(i))===o.NODE_TYPE_COMPOSITE){s=i;break}i=this.getNodeParentId(i)}return s},l.prototype.setFragmentList=function(e){this.fragList=e}},40929:(e,t,i)=>{"use strict";i.r(t),i.d(t,{FlatStringStorage:()=>n,InstanceTreeAccess:()=>l,InstanceTreeStorage:()=>s});var r=i(17252);class n{constructor(e){e?(this.buf=e.buf,this.idx=e.idx,this.next=e.next):(this.buf=new Uint8Array(256),this.next=0,this.idx=[0])}allocate(e){if(this.buf.length-this.next<e){var t=Math.max(3*this.buf.length/2,this.buf.length+e),i=new Uint8Array(t);i.set(this.buf),this.buf=i}}add(e){if(null==e)return 0;if(!e.length)return this.idx.push(this.next),this.idx.length-1;var t=(0,r.Ss)(e,null);return this.allocate(t),this.next+=(0,r.Ss)(e,this.buf,this.next),this.idx.push(this.next),this.idx.length-1}get(e){if(e){var t=this.idx[e-1],i=this.idx[e];return t===i?"":(0,r.MA)(this.buf,t,i-t)}}flatten(){this.idx=a(this.idx)}}var o=5;function s(){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=new n,this.nameSuffixes=[],this.getIndex(0)}function a(e){var t=new Int32Array(e.length);return t.set(e),t}function l(e,t,i){this.nodes=e.nodes,this.children=e.children,this.dbIdToIndex=e.dbIdToIndex,this.names=e.names,this.nameSuffixes=e.nameSuffixes,this.strings=new n(e.strings),this.rootId=t,this.numNodes=this.nodes.length/o,this.visibleIds=null,this.nodeBoxes=i}s.prototype.getIndex=function(e){var t=this.dbIdToIndex[e];if(t)return t;t=this.nextNode++,this.nodes.push(e);for(var i=1;i<o;i++)this.nodes.push(0);return this.dbIdToIndex[e]=t,t},s.prototype.setNode=function(e,t,i,r,n,s){var a,l=this.getIndex(e),h=l*o,c=n.length,u=s&&s.length;for(u&&(c+=s.length),this.nodes[h+1]=t,this.nodes[h+2]=this.nextChild,this.nodes[h+3]=u?-c:c,this.nodes[h+4]=r,a=0;a<n.length;a++)this.children[this.nextChild++]=this.getIndex(n[a]);if(u)for(a=0;a<s.length;a++)this.children[this.nextChild++]=-s[a]-1;this.nextChild>this.children.length&&console.error("Child index out of bounds -- should not happen"),this.processName(l,i)},s.prototype.processName=function(e,t){var i,r,n=-1,o=-1;if(t&&(o=t.lastIndexOf("]"),-1!==(n=t.lastIndexOf("["))&&-1!==o||(n=t.lastIndexOf(":"),o=t.length)),n>=0&&o>n){i=t.slice(0,n+1);var s=t.slice(n+1,o);(r=parseInt(s,10))&&r+""===s||(i=t,r=0)}else i=t,r=0;var a=this.s2i[i];void 0===a&&(a=this.strings.add(i),this.s2i[i]=a),this.names[e]=a,this.nameSuffixes[e]=r},s.prototype.flatten=function(){this.nodes=a(this.nodes),this.children=a(this.children),this.names=a(this.names),this.nameSuffixes=a(this.nameSuffixes),this.strings.flatten(),this.s2i=null},l.prototype.dtor=function(){this.nodes=null,this.children=null,this.dbIdToIndex=null,this.names=null,this.nameSuffixes=null,this.strings=null,this.visibleIds=null,this.nodeBoxes=null},l.prototype.getNumNodes=function(){return this.numNodes},l.prototype.getIndex=function(e){return this.dbIdToIndex[e]},l.prototype.name=function(e,t){var i,r=this.dbIdToIndex[e],n=this.strings.get(this.names[r]),o=this.nameSuffixes[r];o?i="["===n.charAt(n.length-1)?n+o+"]":n+o:i=n;return t&&(this.childCounts||this.computeChildCounts(),this.childCounts[e]>0&&(i+=" ("+this.childCounts[e]+")")),i},l.prototype.getParentId=function(e){var t=this.dbIdToIndex[e];return this.nodes[t*o+1]},l.prototype.getNodeFlags=function(e){var t=this.dbIdToIndex[e];return this.nodes[t*o+4]},l.prototype.setNodeFlags=function(e,t){var i=this.dbIdToIndex[e];i&&(this.nodes[i*o+4]=t)},l.prototype.getNumChildren=function(e){var t=this.dbIdToIndex[e],i=this.nodes[t*o+3];if(i>=0)return i;var r=this.nodes[t*o+2];i=Math.abs(i);for(var n=0,s=0;s<i;s++){if(this.children[r+s]<0)break;n++}return n},l.prototype.getNumFragments=function(e){var t=this.dbIdToIndex[e],i=this.nodes[t*o+3];if(i>=0)return 0;for(var r=this.nodes[t*o+2],n=0,s=(i=Math.abs(i))-1;s>=0;s--){if(this.children[r+s]>=0)break;n++}return n},l.prototype.getNodeBox=function(e,t){for(var i=6*this.getIndex(e),r=0;r<6;r++)t[r]=this.nodeBoxes[i+r]},l.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map((function(e){return parseInt(e)}))),this.visibleIds},l.prototype.enumNodeChildren=function(e,t){var i=this.dbIdToIndex[e],r=this.nodes[i*o+2],n=this.nodes[i*o+3];n=Math.abs(n);for(var s=0;s<n;s++){var a=this.children[r+s];if(a<0)break;if(t(this.nodes[a*o+0],e,i))return e}},l.prototype.enumNodeFragments=function(e,t){var i=this.dbIdToIndex[e],r=this.nodes[i*o+2],n=this.nodes[i*o+3];if(n<0){n=-n;for(var s=0;s<n;s++){var a=this.children[r+s];if(!(a>0)&&t(-a-1,e,i))return e}}},l.prototype.computeBoxes=function(e){this.nodeBoxes||(this.nodeBoxes=new Float32Array(6*this.numNodes));var t=this,i=t.getIndex(t.rootId),r=t.nodeBoxes;function n(e,i,n){var o=t.getIndex(e);s(e,o);for(var a=6*n,l=6*o,h=0;h<3;h++)r[a+h]>r[l+h]&&(r[a+h]=r[l+h]),r[a+h+3]<r[l+h+3]&&(r[a+h+3]=r[l+h+3])}function o(t,i,n){for(var o=6*t,s=6*n,a=0;a<3;a++)r[s+a]>e[o+a]&&(r[s+a]=e[o+a]),r[s+a+3]<e[o+a+3]&&(r[s+a+3]=e[o+a+3])}function s(e,i){var s=6*i;r[s]=r[s+1]=r[s+2]=1/0,r[s+3]=r[s+4]=r[s+5]=-1/0,t.getNumChildren(e)&&t.enumNodeChildren(e,n,!0),t.getNumFragments(e)&&t.enumNodeFragments(e,o)}s(t.rootId,i)},l.prototype.computeChildCounts=function(){this.childCounts||(this.childCounts=new Uint32Array(this.numNodes));var e=this,t=(e.getIndex(e.rootId),e.childCounts);function i(i,n,o){let s=r(i,e.getIndex(i));t[n]+=s}function r(r,n){let o=0;return 4===e.getNodeFlags(r)?o=1:(e.getNumChildren(r)&&e.enumNodeChildren(r,i,!0),e.getNumFragments(r)&&(o=1)),o+t[r]}r(e.rootId)}},27923:(e,t,i)=>{"use strict";function r(e,t){return t<=255?new Uint8Array(e):t<=65535?new Uint16Array(e):new Uint32Array(e)}function n(e,t){if(t<=255)return e;if(t<=65535&&e instanceof Uint8Array){let t=new Uint16Array(e.length);return t.set(e),t}if(!(e instanceof Uint32Array)){let t=new Uint32Array(e.length);return t.set(e),t}return e}i.d(t,{R:()=>r,W:()=>n})},60812:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LmvBox3:()=>n});var r=i(96164);let n=function(e,t){this.min=void 0!==e?e:new r.LmvVector3(1/0,1/0,1/0),this.max=void 0!==t?t:new r.LmvVector3(-1/0,-1/0,-1/0)};var o,s;n.prototype={constructor:n,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromArray:function(e,t){return this.min.x=e[t],this.min.y=e[t+1],this.min.z=e[t+2],this.max.x=e[t+3],this.max.y=e[t+4],this.max.z=e[t+5],this},copyToArray:function(e,t){e[t]=this.min.x,e[t+1]=this.min.y,e[t+2]=this.min.z,e[t+3]=this.max.x,e[t+4]=this.max.y,e[t+5]=this.max.z},setFromCenterAndSize:(s=new r.LmvVector3,function(e,t){var i=s.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},isEmpty:function(){return this.empty()},center:function(e){return console.warn("LmvBox3.center() is deprecated. Use LmvBox3.getCenter() instead."),this.getCenter(e)},getCenter:function(e){return(e||new r.LmvVector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new r.LmvVector3).subVectors(this.max,this.min)},getSize:function(e){return(e||new r.LmvVector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new r.LmvVector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsBox:function(e){return this.isIntersectionBox(e)},clampPoint:function(e,t){return(t||new r.LmvVector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new r.LmvVector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(o=[new r.LmvVector3,new r.LmvVector3,new r.LmvVector3,new r.LmvVector3,new r.LmvVector3,new r.LmvVector3,new r.LmvVector3,new r.LmvVector3],function(e){return o[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),o[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),o[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),o[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),o[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),o[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),o[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),o[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(o),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}},194:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LmvMatrix4:()=>n});var r=i(96164);let n=function(e){this.elements=e?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.isDoublePrecision=!!e};n.prototype={constructor:n,set:function(e,t,i,r,n,o,s,a,l,h,c,u,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,s=i+i,a=r+r,l=n+n,h=i*s,c=i*a,u=i*l,d=r*a,p=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+f),t[4]=c-v,t[8]=u+g,t[1]=c+v,t[5]=1-(h+f),t[9]=p-m,t[2]=u-g,t[6]=p+m,t[10]=1-(h+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],_=r[0],E=r[4],A=r[8],S=r[12],w=r[1],M=r[5],T=r[9],C=r[13],P=r[2],D=r[6],L=r[10],I=r[14],R=r[3],O=r[7],N=r[11],F=r[15];return n[0]=o*_+s*w+a*P+l*R,n[4]=o*E+s*M+a*D+l*O,n[8]=o*A+s*T+a*L+l*N,n[12]=o*S+s*C+a*I+l*F,n[1]=h*_+c*w+u*P+d*R,n[5]=h*E+c*M+u*D+d*O,n[9]=h*A+c*T+u*L+d*N,n[13]=h*S+c*C+u*I+d*F,n[2]=p*_+f*w+m*P+g*R,n[6]=p*E+f*M+m*D+g*O,n[10]=p*A+f*T+m*L+g*N,n[14]=p*S+f*C+m*I+g*F,n[3]=v*_+y*w+b*P+x*R,n[7]=v*E+y*M+b*D+x*O,n[11]=v*A+y*T+b*L+x*N,n[15]=v*S+y*C+b*I+x*F,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14];return e[3]*(+n*a*c-r*l*c-n*s*u+i*l*u+r*s*d-i*a*d)+e[7]*(+t*a*d-t*l*u+n*o*u-r*o*d+r*l*h-n*a*h)+e[11]*(+t*l*c-t*s*d-n*o*c+i*o*d+n*s*h-i*l*h)+e[15]*(-r*s*h-t*a*c+t*s*u+r*o*c-i*o*u+i*a*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},invert:function(e){const t=this.elements,i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=u*g*h-m*d*h+m*l*p-a*g*p-u*l*v+a*d*v,b=f*d*h-c*g*h-f*l*p+s*g*p+c*l*v-s*d*v,x=c*m*h-f*u*h+f*a*p-s*m*p-c*a*v+s*u*v,_=f*u*l-c*m*l-f*a*d+s*m*d+c*a*g-s*u*g,E=i*y+r*b+n*x+o*_;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/E;return t[0]=y*A,t[1]=(m*d*o-u*g*o-m*n*p+r*g*p+u*n*v-r*d*v)*A,t[2]=(a*g*o-m*l*o+m*n*h-r*g*h-a*n*v+r*l*v)*A,t[3]=(u*l*o-a*d*o-u*n*h+r*d*h+a*n*p-r*l*p)*A,t[4]=b*A,t[5]=(c*g*o-f*d*o+f*n*p-i*g*p-c*n*v+i*d*v)*A,t[6]=(f*l*o-s*g*o-f*n*h+i*g*h+s*n*v-i*l*v)*A,t[7]=(s*d*o-c*l*o+c*n*h-i*d*h-s*n*p+i*l*p)*A,t[8]=x*A,t[9]=(f*u*o-c*m*o-f*r*p+i*m*p+c*r*v-i*u*v)*A,t[10]=(s*m*o-f*a*o+f*r*h-i*m*h-s*r*v+i*a*v)*A,t[11]=(c*a*o-s*u*o-c*r*h+i*u*h+s*r*p-i*a*p)*A,t[12]=_*A,t[13]=(c*m*n-f*u*n+f*r*d-i*m*d-c*r*g+i*u*g)*A,t[14]=(f*a*n-s*m*n-f*r*l+i*m*l+s*r*g-i*a*g)*A,t[15]=(s*u*n-c*a*n+c*r*l-i*u*l-s*r*d+i*a*d)*A,this},getInverse:function(e,t){if(console.warn("LmvMatrix4.getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert(),0===this.determinant()){const e="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(e);console.warn(e),this.identity()}return this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,h=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,h*s+i,h*a-r*o,0,l*a-r*s,h*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new r.LmvVector3,t=new n(!0);return function(i,r,n){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var h=1/s,c=1/a,u=1/l;return t.elements[0]*=h,t.elements[1]*=h,t.elements[2]*=h,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,r.setFromRotationMatrix(t),n.x=s,n.y=a,n.z=l,this}}(),transformPoint:function(e){var t=e.x,i=e.y,r=e.z,n=this.elements;return e.x=n[0]*t+n[4]*i+n[8]*r+n[12],e.y=n[1]*t+n[5]*i+n[9]*r+n[13],e.z=n[2]*t+n[6]*i+n[10]*r+n[14],e},transformDirection:function(e){var t=e.x,i=e.y,r=e.z,n=this.elements;e.x=n[0]*t+n[4]*i+n[8]*r,e.y=n[1]*t+n[5]*i+n[9]*r,e.z=n[2]*t+n[6]*i+n[10]*r;var o=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(o>0){var s=1/o;e.x*=s,e.y*=s,e.z*=s}return e},equals(e){const t=this.elements,i=e.elements;for(var r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return new n(this.isDoublePrecision).fromArray(this.elements)}}},96164:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LmvVector3:()=>r});let r=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};var n,o,s,a;r.prototype={constructor:r,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,h=a*i+s*t-n*r,c=a*r+n*i-o*t,u=-n*t-o*i-s*r;return this.x=l*a+u*-n+h*-s-c*-o,this.y=h*a+u*-o+c*-n-l*-s,this.z=c*a+u*-s+l*-o-h*-n,this},transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(e,t){return void 0===s&&(s=new r,a=new r),s.set(e,e,e),a.set(t,t,t),this.clamp(s,a)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this},projectOnVector:function(e){return void 0===n&&(n=new r),n.copy(e).normalize(),o=this.dot(n),this.copy(n).multiplyScalar(o)},projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new r),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new r),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){var i=4*e,r=t.elements;return this.x=r[i],this.y=r[i+1],this.z=r[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}}},1098:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MemoryTracker:()=>p,RESOURCE_EVENTS:()=>h,RESOURCE_TYPES:()=>l});var r=i(93549),n=i(7247),o=i(68482);const s=1/0,a=10485760,l={MEMORY:1},h={LIMIT_REACHED_EVENT:"resLimitReached",BELOW_LIMIT_EVENT:"belowResLimit"},c=r.GPU_MEMORY_LIMIT,u=2*c,d=r.GPU_OBJECT_LIMIT;class p{static geomMemory=0;static geomCount=0;static gpuGeomMemory=0;static gpuGeomCount=0;static geomListStats=new WeakMap;static#C(e){let t=this.geomListStats.get(e);return t||(t={geomMemory:0,geomCount:0,gpuGeomMemory:0,gpuGeomCount:0},this.geomListStats.set(e,t)),t}static#P=s;static#D=1/0;static#L=!1;static printStats(){console.log("MemoryTracker Global Stats:"),console.log("--------------------------"),this.#I(this),this.#R||console.log("Available GPU resources are tracked per model.")}static printModelStats(e){console.log("MemoryTracker Model Stats:"),console.log("--------------------------");const t=e.getGeometryList(),i=this.geomListStats.get(t);i?(this.#I(i),this.#R||(console.log("gpuGeomMemory remaining (low/high):",r.GPU_MEMORY_LIMIT-i.gpuGeomMemory,2*r.GPU_MEMORY_LIMIT-i.gpuGeomMemory),console.log("gpuGeomCount remaining:",r.GPU_OBJECT_LIMIT-i.gpuGeomCount))):console.log("No stats tracked for this model yet.")}static#I(e){console.log("geomMemory:",e.geomMemory),console.log("geomCount:",e.geomCount),console.log("gpuGeomMemory:",e.gpuGeomMemory),console.log("gpuGeomCount:",e.gpuGeomCount),this.#R&&(console.log("gpuGeomMemory remaining (low/high):",r.GPU_MEMORY_LIMIT-this.gpuGeomMemory,2*r.GPU_MEMORY_LIMIT-this.gpuGeomMemory),console.log("gpuGeomCount remaining:",r.GPU_OBJECT_LIMIT-this.gpuGeomCount))}static#R=!1;static setMemoryType(e,t,i){const r=void 0!==t.streamingDraw,n=this.#O(e,t,i);r&&!!t.streamingDraw===n?t.modelRefCount>1&&r&&!n&&this.#N(e,t,!0):(t.streamingDraw=t.streamingIndex=n,n?r&&this.untrackGeometry(e,t,!1,!0,!0):this.#N(e,t))}static#O(e,t,i){if(0===c)return!0;let r,n;if(this.#R)r=this.gpuGeomMemory,n=this.gpuGeomCount;else{const t=this.#C(e);r=t.gpuGeomMemory,n=t.gpuGeomCount}return!(e.disableStreaming||r<c&&n<d)&&(r>=u||n>=d||(e.is2d?100001:t.byteSize*(i||1))<1e5)}static#N(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=this.#C(e);(0,n.isMobileDevice)()&&(i||(this.geomMemory+=t.byteSize),r.geomMemory+=t.byteSize),i||(this.gpuGeomMemory+=t.byteSize,this.gpuGeomCount++),r.gpuGeomMemory+=t.byteSize,r.gpuGeomCount++}static trackGeometry(e,t){const i=t.byteSize+r.GEOMETRY_OVERHEAD;void 0!==t.modelRefCount&&1!==t.modelRefCount||(this.geomMemory+=i,this.geomCount++);const n=this.#C(e);n.geomMemory+=i,n.geomCount++,this.#F(!0)}static untrackGeometry(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=0;const l=this.geomListStats.get(e);return void 0===o&&(o=!1===t.streamingDraw),i&&(a=t.byteSize+r.GEOMETRY_OVERHEAD,l.geomMemory-=a,l.geomCount--,!t.modelRefCount||s?(this.geomMemory-=a,this.geomCount--,t.streamingDraw=void 0,t.streamingIndex=void 0):a=0),o&&(l.gpuGeomMemory-=t.byteSize,l.gpuGeomCount--,(0,n.isMobileDevice)()&&(t.modelRefCount&&!s||(a+=t.byteSize,this.geomMemory-=t.byteSize),l.geomMemory-=t.byteSize),t.modelRefCount&&!s||(this.gpuGeomMemory-=t.byteSize,this.gpuGeomCount--)),this.#F(!1),a}static memoryLimitReached(){return this.geomMemory>=this.#P}static memoryHardLimitReached(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.geomMemory+e>=this.#D}static getGeometrySize(e){return e.byteSize+r.GEOMETRY_OVERHEAD}static#F(e){e?this.memoryLimitReached()&&!this.#L&&(this.#L=!0,this.fireEvent({type:h.LIMIT_REACHED_EVENT,resourceType:l.MEMORY})):this.memoryLimitReached()||(this.#L&&this.fireEvent({type:h.BELOW_LIMIT_EVENT,resourceType:l.MEMORY}),this.#L=!1)}static get memorySoftLimit(){return this.#P}static get memoryHardLimit(){return this.#D}static setMemoryLimit(e,t){t||(t=e+a);const i=e>this.#P;this.#P=e,this.#D=t,this.#F(!i)}}o.EventDispatcher.prototype.apply(p)},33736:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MeshFlags:()=>r});let r={MESH_VISIBLE:1,MESH_HIGHLIGHTED:2,MESH_HIDE:4,MESH_ISLINE:8,MESH_MOVED:16,MESH_RENDERFLAG:32,MESH_NOTLOADED:64,MESH_ISPOINT:128,MESH_ISWIDELINE:256,MESH_TRAVERSED:512,MESH_DRAWN:1024}},13908:(e,t,i)=>{"use strict";i.d(t,{i:()=>l});var r=i(75050),n=new r.Vector3,o=new Float32Array(6);const s="hierarchy";var a=s;class l{constructor(){}static setStrategy(e){if(a!==e)return a=e,!0}static getStrategy(){return a}static explode(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var l=e.getData().instanceTree,h=e.getFragmentList(),c=e.getVisibleBounds(!0).getCenter(new r.Vector3);if(a===s&&l&&0!==t){const{magnitude:e,depthDampening:r}=i;!function(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;var l=i*e.maxDepth+1;1===e.maxDepth&&(l=i);var h=0|l,c=l-h;function u(r,l,d,p,f,m,g,v){var y=i*s/Math.pow(l,a);l==h&&(y*=c),e.getNodeBox(r,o);var b=.5*(o[0]+o[3]),x=.5*(o[1]+o[4]),_=.5*(o[2]+o[5]);l>0&&l<=h&&(m+=(b-d)*y,g+=(x-p)*y,v+=(_-f)*y);e.isNodeExplodeLocked(r)&&(m=g=v=0),e.enumNodeChildren(r,(function(e){u(e,l+1,b,x,_,m,g,v)}),!1),n.x=m,n.y=g,n.z=v,e.enumNodeFragments(r,(function(e){t.updateAnimTransform(e,null,null,n)}),!1)}u(e.getRootId(),0,r.x,r.y,r.z,0,0,0)}(l,h,t,c,e,r)}else!function(e,t,i,r){var o,s,a=e.fragments.boxes;e.useThreeMesh?o=e.vizmeshes:s=e.fragments.fragId2dbId;for(var l=0,h=e.getCount();l<h;l++)if(0==i||t&&t.isNodeExplodeLocked(o?o[l]&&o[l].dbId:s[l]))e.updateAnimTransform(l);else{var c=6*l,u=.5*(a[c]+a[c+3]),d=.5*(a[c+1]+a[c+4]),p=.5*(a[c+2]+a[c+5]);n.x=i*(u-r.x),n.y=i*(d-r.y),n.z=i*(p-r.z),e.updateAnimTransform(l,null,null,n)}}(h,l,t,c)}}},67183:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelIteratorBVH:()=>a});var r=i(86437),n=i(75050);const o=new n.Box3,s=new n.Box3;class a{#k;#V;#U;#B;#G;#z;#H;#W;#j;#q;#X;#Y;#K;#Q;#Z;#J;#$;#ee;#te;constructor(){this.#k=null,this.#V=null,this.#U=null,this.#B=null,this.#G=null,this.#z=null,this.#H=null,this.#W=0,this.#j=0,this.#q=1,this.#X=!0,this.#Y=!1,this.#K=!1,this.#Q=null,this.#Z=!1,this.#J=null,this.#$=!0,this.#ee=null,this.#te=null}initialize(e,t,i,r){this.#ee=e,this.#te=r,this.#k=e.getFragmentList(),this.#J=e.RenderBatch,r&&r.hasOwnProperty("prioritize_screen_size")&&(this.#X=r.prioritize_screen_size),this.#U=i,this.#B=new Array(t.nodeCount),this.#G=new Int8Array(t.nodeCount),this.#V=t,this.#z=new Int32Array(t.nodeCount+1),this.#H=new Float32Array(t.nodeCount);for(let e=0;e<t.nodeCount;e++){const i=t.getPrimCount(e);if(0===i)continue;this.#B[e]=new this.#J(this.#k,this.#U,t.getPrimStart(e),i);const r=this.#B[e];r.lastItem=r.start+i,r.numAdded=i,r.nodeIndex=e,8&t.getFlags(e)&&(r.sortObjects=!0),t.getBoxArray(e,r.bboxes)}}dtor(){this.#J=null,this.#k=null,this.#ee=null}reset(e,t){if(this.#Q=e,this.#W=0,this.#j=0,this.#G[0]=this.#G[1]=r.FrustumIntersector.CONTAINMENT_UNKNOWN,this.#z[this.#j++]=0,this.#Y=!1,this.#K=!1,this.#Z=!1,this.#$){let e=this.#B,t=e.length;for(let i=0;i<t;++i){let t=e[i];t&&t.resetVisStatus&&t.resetVisStatus()}this.#$=!1}}#ie(e){const t=this.#H[e];let i=this.#j;if(this.#q)for(;i>this.#W&&this.#H[this.#z[i-1]]>t;)this.#z[i]=this.#z[i-1],i--;else for(;i>this.#W&&this.#H[this.#z[i-1]]<t;)this.#z[i]=this.#z[i-1],i--;this.#z[i]=e,this.#j++}nextBatch(){for(this.#K||this.#Y||this.#W!==this.#j||(this.#z[this.#j++]=1,this.#Y=!0);this.#W!==this.#j;){const e=this.#q||this.#Y?this.#z[--this.#j]:this.#z[this.#W++];let t=this.#G[e];if(t!==r.FrustumIntersector.CONTAINS&&(this.#V.getBoxThree(e,o),t=this.#Q.intersectsBox(o)),t!==r.FrustumIntersector.OUTSIDE){const i=this.#V.getLeftChild(e);let n,s;if(-1!==i){const a=this.#V.getFlags(e),l=this.#Q.viewDir[3&a]<0?1:0;let h=a>>2&1,c=a>>3&1;const u=this.#q||this.#Y?1:0;let d=0,p=0;this.#X&&!this.#Y?(n=i+h,s=i+1-h,this.#V.getBoxThree(n,o),this.#H[n]=d=this.#Q.projectedBoxArea(o,t===r.FrustumIntersector.CONTAINS),this.#V.getBoxThree(s,o),this.#H[s]=p=this.#Q.projectedBoxArea(o,t===r.FrustumIntersector.CONTAINS),this.#G[n]=this.#G[s]=t,d>0&&this.#ie(n),p>0&&this.#ie(s)):(l^u^c&&(h=1-h),n=i+h,s=i+1-h,this.#z[this.#j++]=n,this.#H[n]=-1,this.#z[this.#j++]=s,this.#H[s]=-1,this.#G[n]=this.#G[s]=t)}if(0!==this.#V.getPrimCount(e)){const t=this.#B[e];return t.renderImportance=1,t}}this.#Y||this.#K||this.#W!==this.#j||(this.#z[this.#j++]=1,this.#Y=!0)}return this.#Z=!0,null}skipOpaqueShapes(){this.#Y||this.#K||(this.#W=0,this.#j=0,this.#z[this.#j++]=1,this.#K=!0)}#re(e){const t=this.#V.getLeftChild(e);-1!==t&&(this.#re(t),this.#re(t+1)),o.makeEmpty(),-1!==t&&(this.#V.getBoxThree(t,s),o.union(s),this.#V.getBoxThree(t+1,s),o.union(s));this.#V.getPrimCount(e)&&(o.union(this.#B[e].getBoundingBox()),o.union(this.#B[e].getBoundingBoxHidden())),this.#V.setBoxThree(e,o)}getVisibleBounds(e,t){for(let i=0;i<this.#B.length;i++){let r=this.#B[i];if(!r)continue;r.calculateBounds();let n=r.getBoundingBox();e.union(n),t.union(n),t.union(r.getBoundingBoxHidden())}this.#re(0),this.#re(1)}rayCast(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=e.ray.origin;let s=[1,0],a=new n.Vector3,l=new n.Box3;for(;s.length>0;){const n=s.pop();if(this.#V.getBoxThree(n,l),l.expandByScalar(.5),null!=r.maxDistance){if(l.distanceToPoint(o)>r.maxDistance)continue}if(null===e.ray.intersectBox(l,a))continue;const h=this.#V.getLeftChild(n);-1!==h&&(s.push(h),s.push(h+1));if(0!==this.#V.getPrimCount(n)){this.#B[n].raycast(e,t,i,r)}}}intersectFrustum(e,t){let i=[1,r.FrustumIntersector.CONTAINMENT_UNKNOWN,0,r.FrustumIntersector.CONTAINMENT_UNKNOWN];for(;i.length;){const n=i.pop(),s=i.pop();let a;if(n===r.FrustumIntersector.CONTAINS?a=r.FrustumIntersector.CONTAINS:(this.#V.getBoxThree(s,o),a=e.intersectsBox(o)),a===r.FrustumIntersector.OUTSIDE)continue;const l=this.#V.getLeftChild(s);-1!==l&&(i.push(l),i.push(a),i.push(l+1),i.push(a));if(0!==this.#V.getPrimCount(s)){let i=this.#B[s];i&&i.intersectFrustum(e,t,a===r.FrustumIntersector.CONTAINS)}}}getSceneCount(){return this.#B.length}getGeomScenes(){return this.#B}done(){return this.#Z}resetVisStatus(){this.#$=!0}clone(){const e=new a;return e.initialize(this.#ee,this.#V,this.#U,this.#te),e}}},28109:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelIteratorLinear:()=>o});i(56144);var r=i(7247),n=i(86437);class o{constructor(e){this._frags=e.getFragmentList(),this._RenderBatch=e.RenderBatch,this._model=e,this._is2d=this._model.is2d(),this._fragsPerScene=function(e){let t=500;return e&&(t/=6),(0,r.isMobileDevice)()&&(t/=3),t=Math.floor(t),t>0?t:500}(e.is2d()),this._fragOrder=[],this._geomScenes=[],this._secondPassIndex=null;const t=this._frags.getCount();this._currentScene=0;let i=new Int32Array(t);for(let e=0;e<t;e++)i[e]=e;this.setFragmentOrder(i,t)}dtor(){this.model=null,this._RenderBatch=null,this._frags=null}setFragmentOrder(e,t){this._fragCount=t,this._fragOrder[0]=e;var i=Math.floor((this._fragCount+this._fragsPerScene-1)/this._fragsPerScene);this._geomScenes.length=i;for(let e=0;e<i;e++){let t=e*this._fragsPerScene,i=this._geomScenes[e]=new this._RenderBatch(this._frags,this._fragOrder,t,this._fragsPerScene),r=t+this._fragsPerScene;r>this._fragCount&&(r=this._fragCount),i.lastItem=r,i.count=i.lastItem-t}}addFragment(e){if(this._fragOrder[0].length<=e){var t=2*this._fragOrder[0].length;t<=e&&(t=e+1);var i=new Int32Array(t);i.set(this._fragOrder[0]),this._fragOrder[0]=i,this.visibleBoundsDirty=!0}this._fragOrder[0][e]=e;var r=Math.floor(e/this._fragsPerScene);if(this._geomScenes){var n=this._geomScenes[r];n&&!n.isSecondPass||(n=new this._RenderBatch(this._frags,this._fragOrder,r*this._fragsPerScene,this._fragsPerScene),null===this._secondPassIndex?this._geomScenes[r]=n:this.insertSceneToSecondPass(r,n)),n&&(n.onFragmentAdded(e),null!==this._secondPassIndex&&this._geomScenes[this._secondPassIndex+r].onFragmentAdded(e))}}insertSceneToSecondPass(e,t){const i=this._geomScenes.slice(0,this._secondPassIndex),r=this._geomScenes.slice(this._secondPassIndex);i[e]=t,r[e]=this.cloneForSecondPass(t),this._secondPassIndex=i.length,this._geomScenes=i.concat(r)}reset(e,t){if(this._currentScene=0,this._is2d&&this._geomScenes[0]&&(this._geomScenes[0].drawEnd=0,null!==this._secondPassIndex&&(this._geomScenes[this._secondPassIndex].drawEnd=0)),this._resetVisStatus){let e=this._geomScenes,t=e.length;for(let r=0;r<t;++r){var i=e[r];i&&i.resetVisStatus&&i.resetVisStatus()}this._resetVisStatus=!1}}getSceneCount(){return this._geomScenes.length}getGeomScenes(){return this._geomScenes}resetVisStatus(){this._resetVisStatus=!0}done(){return!(this._is2d&&!this._model.isLoadDone())&&(this._currentScene>=this._geomScenes.length-1&&(!(e=this._geomScenes[this._currentScene])||e.drawStart>=e.lastItem));var e}nextBatch(){if(this._currentScene>=this.getSceneCount())return null;let e=this._geomScenes[this._currentScene];if(this._is2d){const t=this.areTwoPassesNeeded();if(e.lastItem>=e.start+e.count&&(++this._currentScene,this._geomScenes[this._currentScene]&&(this._geomScenes[this._currentScene].drawEnd=this._geomScenes[this._currentScene].start)),e.drawStart=e.drawEnd,e.drawEnd=e.lastItem,e.hasOwnProperty("drawStart")&&e.lastItem<=e.drawStart){return t&&!this._isSecondPass?(this._currentScene=this._secondPassIndex,this.nextBatch()):null}const i=!this._model.areAllVisible()||this._isSecondPass;e.renderImportance=i?-1:1e20,e.needsTwoPasses=t}else e.renderImportance=0,++this._currentScene;return e}areTwoPassesNeeded(){const e=this._model.hasPaperTransparency();return e&&null===this._secondPassIndex&&this.addSecondPassScenes(),this._isSecondPass=!!(e&&this._currentScene>=this._secondPassIndex),e}cloneForSecondPass(e){if(!e)return;const t=e.clone();return t.isSecondPass=!0,t}addSecondPassScenes(){const e=this._geomScenes.length;e&&(this._geomScenes=this._geomScenes.concat(this._geomScenes.map(this.cloneForSecondPass)),this._secondPassIndex=e)}getVisibleBounds(e,t){for(var i=this.getSceneCount(),r=0;r<i;r++){this._geomScenes[r].calculateBounds();var n=this._geomScenes[r].getBoundingBox();e.union(n),t.union(n),t.union(this._geomScenes[r].getBoundingBoxHidden())}}rayCast(e,t,i){for(var r=this.getSceneCount(),n=0;n<r;n++)this._geomScenes[n].raycast(e,t,i)}intersectFrustum(e,t){for(let i of this._geomScenes){if(!i)continue;let r=e.intersectsBox(i.getBoundingBox());r!==n.FrustumIntersector.OUTSIDE&&i.intersectFrustum(e,t,r===n.FrustumIntersector.CONTAINS)}}clone(){return new o(this._model)}}},78484:(e,t,i)=>{"use strict";i.r(t),i.d(t,{NoOpTraversalController:()=>n});class r{constructor(){}dtor(){}clone(){}nextBatch(){}reset(e,t){}getGeomScenes(){}getSceneCount(){}getVisibleBounds(e,t,i){}rayCast(e,t,i){}}class n extends r{nextBatch(){return null}getGeomScenes(){return new Array}getSceneCount(){return 0}clone(){return new n}}},56144:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RenderBatch:()=>d});var r=i(60945),n=i(86437),o=i(33736),s=i(70179),a=i(60489),l=i(60812),h=i(93549),c=new l.LmvBox3,u=null;class d{frags;indices;start;count;lastItem;overrideMaterial=null;sortDone=!1;numAdded=0;avgFrameTime=void 0;nodeIndex=void 0;bboxes=new Array(12);sortObjects=!1;sortByShaderDone=!1;frustumCulled=!0;forceVisible=!1;renderImmediate;renderImportance=0;constructor(e,t,i,r){this.frags=e,this.indices=t,this.start=i,this.count=r,this.lastItem=i,this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,this.renderImmediate=!e.useThreeMesh}clone(){const e=new d(this.frags,this.indices,this.start,this.count);return e.sortDone=this.sortDone,e.sortByShaderDone=this.sortByShaderDone,e.lastItem=this.lastItem,e.visibleStats=this.visibleStats,e.numAdded=this.numAdded,e.bboxes=this.bboxes.slice(),e}getIndices(){return Array.isArray(this.indices)?this.indices[0]:this.indices}sortByMaterial(){if(!(this.numAdded<this.count)){var e=this.frags,t=this.getIndices();if(t){var i=t.subarray(this.start,this.start+this.count);Array.prototype.sort.call(i,(function(t,i){var r=e.getMaterialId(t),n=e.getMaterialId(i);return void 0===r?n?1:0:void 0===n?-1:r-n})),this.numAdded=0,this.sortDone=!0}else a.logger.warn("Only indexed RenderSubsets can be sorted.")}}sortByShader(){if(this.sortDone&&!this.sortByShaderDone){var e=this.frags,t=this.getIndices().subarray(this.start,this.start+this.count);Array.prototype.sort.call(t,(function(t,i){var r=e.getMaterial(t),n=e.getMaterial(i),o=r.program.id-n.program.id;return o||r.id-n.id})),this.numAdded=0,this.sortByShaderDone=!0}}sortByDepth(e){var t=this.frags,i=this.getIndices(),r=e,n=c;if(i){(!u||u.length<this.count)&&(u=new Float32Array(this.count));var o,s,l=u,h=this.start;this.forEachNoMesh(((e,i)=>{t.hasGeometry(e)?(t.getWorldBounds(e,n),l[i]=r.estimateDepth(n)):l[i]=-1/0}));for(var d=1;d<this.count;d++)for(var p=d;p>0&&l[p-1]<l[p];)o=l[p-1],l[p-1]=l[p],l[p]=o,s=i[h+p-1],i[h+p-1]=i[h+p],i[h+p]=s,p--}else a.logger.warn("Only indexed RenderSubsets can be sorted.")}addToBox(e,t){var i=t?6:0,r=this.bboxes;r[0+i]=Math.min(r[0+i],e.min.x),r[1+i]=Math.min(r[1+i],e.min.y),r[2+i]=Math.min(r[2+i],e.min.z),r[3+i]=Math.max(r[3+i],e.max.x),r[4+i]=Math.max(r[4+i],e.max.y),r[5+i]=Math.max(r[5+i],e.max.z)}getBoundingBox(e){e=e||c;var t=this.bboxes;return e.min.x=t[0],e.min.y=t[1],e.min.z=t[2],e.max.x=t[3],e.max.y=t[4],e.max.z=t[5],e}getBoundingBoxHidden(e){e=e||c;var t=this.bboxes;return e.min.x=t[6],e.min.y=t[7],e.min.z=t[8],e.max.x=t[9],e.max.y=t[10],e.max.z=t[11],e}onFragmentAdded(e){this.frags.getWorldBounds(e,c),this.addToBox(c,!1),this.sortDone=!1,this.lastItem<=e&&(this.lastItem=e+1,void 0!==this.visibleStats&&(this.visibleStats=0)),this.numAdded++}forEach(e,t,i){var r,n,s,a,l=this.getIndices(),h=this.frags,c=!this.sortByShaderDone;if(t||i||c){const u=Object.prototype.hasOwnProperty.call(this,"drawStart");for(r=t===o.MeshFlags.MESH_RENDERFLAG&&u?this.drawStart:this.start,n=this.lastItem;r<n;r++)s=l?l[r]:r,a=h.getVizmesh(s),!c||a&&a.material&&a.material.program||(c=!1),!(i||a&&a.geometry)||t&&!h.isFlagSet(s,t)||e(a,s)}else for(r=this.start,n=this.lastItem;r<n;r++)s=l?l[r]:r,(a=h.getVizmesh(s))&&a.geometry&&e(a,s);c&&this.sortByShader()}forEachNoMesh(e,t,i){for(var r=this.getIndices(),n=this.frags,o=this.start,s=this.lastItem;o<s;o++){var a=r?r[o]:o;!i&&!n.hasGeometry(a)||t&&!n.isFlagSet(a,t)||e(a,o-this.start)}}raycast(e,t,i,n){!1!==e.ray.intersectsBox(this.getBoundingBox())&&this.forEach(((s,a)=>{if(!this.frags.isFlagSet(a,o.MeshFlags.MESH_HIDE)){if(i&&i.length){var l=0|this.frags.getDbIds(a);if(-1===i.indexOf(l))return}this.frags.getWorldBounds(a,c),c.expandByScalar(.5),e.ray.intersectsBox(c)&&r.VBIntersector.rayCast(s,e,t,n)}}),o.MeshFlags.MESH_VISIBLE)}intersectFrustum(e,t,i){if(!i){let t=e.intersectsBox(this.getBoundingBox());if(t===n.FrustumIntersector.OUTSIDE)return;t===n.FrustumIntersector.CONTAINS&&(i=!0)}this.forEach(((r,s)=>{if(this.frags.isFlagSet(s,o.MeshFlags.MESH_HIDE))return;if(i)return void t(s,i);this.frags.getWorldBounds(s,c);let a=e.intersectsBox(c);a!==n.FrustumIntersector.OUTSIDE&&t(s,a===n.FrustumIntersector.CONTAINS)}),o.MeshFlags.MESH_VISIBLE)}calculateBounds(){this.bboxes[0]=this.bboxes[1]=this.bboxes[2]=1/0,this.bboxes[3]=this.bboxes[4]=this.bboxes[5]=-1/0,this.bboxes[6]=this.bboxes[7]=this.bboxes[8]=1/0,this.bboxes[9]=this.bboxes[10]=this.bboxes[11]=-1/0,this.forEachNoMesh((e=>{this.frags.getWorldBounds(e,c);var t=this.frags.vizflags[e];this.addToBox(c,!(1&t))}),0,!0)}applyVisibility(e,t){let i,r,l,u,d,p,f;function m(e){var t=!1;return i.getWorldBounds(e,c),d&&!l.intersectsBox(c)&&(t=!0),h.ENABLE_PIXEL_CULLING&&!t&&l.estimateProjectedDiameter(c)<l.areaCullThreshold&&(t=!0),t||f||!l.boxOutsideCutPlanes(c)||(t=!0),t}function g(e,t,i){let n=!1;const a=o.MeshFlags.MESH_RENDERFLAG,l=r[e]&~a;switch(u){case s.RenderFlags.RENDER_HIDDEN:n=!(l&o.MeshFlags.MESH_VISIBLE);break;case s.RenderFlags.RENDER_HIGHLIGHTED:n=l&o.MeshFlags.MESH_HIGHLIGHTED;break;default:n=1==(l&(o.MeshFlags.MESH_VISIBLE|o.MeshFlags.MESH_HIGHLIGHTED|o.MeshFlags.MESH_HIDE))}if(t){const e=l&(o.MeshFlags.MESH_ISLINE|o.MeshFlags.MESH_ISWIDELINE);n=n&&!e}if(i){const e=l&o.MeshFlags.MESH_ISPOINT;n=n&&!e}return r[e]=l|(n?a:0),n}p=!0,l=t,u=e;var v=u===s.RenderFlags.RENDER_HIDDEN?this.getBoundingBoxHidden():this.getBoundingBox(),y=l.intersectsBox(v);return y===n.FrustumIntersector.OUTSIDE||h.ENABLE_PIXEL_CULLING&&l.estimateProjectedDiameter(v)<l.areaCullThreshold?p:(f=this.frags.doNotCut,!f&&t.boxOutsideCutPlanes(v)||(r=this.frags.vizflags,i=this.frags,d=y!==n.FrustumIntersector.CONTAINS,i.useThreeMesh?this.forEach((function(e,t){if(!e&&i.useThreeMesh||!e.geometry)return;if(m(t))return e?e.visible=!1:a.logger.warn("Unexpected null mesh"),void(r[t]=r[t]&~o.MeshFlags.MESH_RENDERFLAG);const n=g(t,i.linesHidden,i.pointsHidden);e&&(e.visible=!!n),p=p&&!n}),null):this.forEachNoMesh((function(e,t){if(!i.getGeometryId(e))return;if(m(e))return void(r[e]=r[e]&~o.MeshFlags.MESH_RENDERFLAG);const n=g(e,i.linesHidden,i.pointsHidden);p=p&&!n}),0,!1),i=null),p)}}},70179:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RenderFlags:()=>r});var r={RENDER_NORMAL:0,RENDER_HIGHLIGHTED:1,RENDER_HIDDEN:2,RENDER_SHADOWMAP:3,RENDER_FINISHED:4}},32576:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RenderModel:()=>E});var r=i(93549),n=i(7619),o=i(33303),s=i(56144),a=i(16650),l=i(75124),h=i(67183),c=i(60945),u=i(75050),d=i(33736),p=i(70179),f=i(60489),m=i(194),g=i(51063),v=i(12529),y=i(1098);const b=Autodesk.Viewing;var x=(()=>{const e=new u.Vector4;return(t,i)=>{e.copy(t);for(let t=0;t<i.length;t++)if(i[t].dot(e)>1e-6)return!0;return!1}})(),_=1;class E{#ne=new u.Box3;#oe=new u.Box3;#se=new u.Box3;visibleBoundsDirty=!1;enforceBvh=!1;#ae=0;id=_++;#le=null;#k=null;#he=new l.SceneTraversal;#ce=null;#ue=null;#de=0;#Q=null;#pe=p.RenderFlags.RENDER_NORMAL;#fe=null;#me=null;#ge=null;#ve;#ye;#be;RenderBatch=s.RenderBatch;#xe=!1;#_e;#Ee;visibilityManager=null;#Ae=new u.Plane;#Se=new u.Vector3;#we;#Me;#Te;#Ce;#Pe={};constructor(e){this.#Ce=e,this.#we=e.modelSpaceBBox,this.#Me=e.bbox,this.#Te=e.placementWithOffset}dtor(){this.#r()}setModelFormat(e){this.#Pe=e}initialize(){var e,t;const i=this.#Ce.numGeoms,s=!function(e,t,i){return!(e&&e-3*t*2<=r.GPU_MEMORY_LIMIT&&i<r.GPU_OBJECT_LIMIT)}(this.#Ce.packFileTotalSize,this.#Ce.primitiveCount,i);this.#le=new n.GeometryList(i,this.#Pe.is2d,s,this.#Pe.isOTG);const a=(null===(e=this.#Ce.metadata)||void 0===e||null===(e=e.stats)||void 0===e?void 0:e.num_materials)??0,l=(null===(t=this.#Ce.metadata)||void 0===t||null===(t=t.stats)||void 0===t?void 0:t.num_geoms)??0,h=this.#Ce.fragments;this.#k=new o.FragmentList(h,this.getGeometryList(),this.id,a,l,this.#Pe);const c=this.getModelBounds();c&&(this.#ne.copy(c),this.#oe.copy(c))}addTraversalController(e,t){this.#he.addTraversalController(e,t),this.visibleBoundsDirty=!0}getGeometryList(){return this.#le}getFragmentList(){return this.#k}getModelId(){return this.id}getIterator(){return this.#he.getTraversalController()}isIdRemapValid(){return null!=this.#_e}#r(){this.#he.isEnabledConsolidation()&&this.untrackConsolidatedGeometry(),this.#he.dtor(),this.#le=null,this.#k&&(this.#k.dtor(),this.#k=null)}activateFragment(e,t,i){this.#k&&(this.#k.setMesh(e,t,i),this.#he.addFragment(e),this.#k.getWorldBounds(e,this.#se),this.#ne.union(this.#se),this.#oe.union(this.#se))}setFragment(e,t,i){return void 0===e&&(e=this.getFragmentList().getNextAvailableFragmentId()),this.#k.setMesh(e,t,!0,i),this.#he.addFragment(e),this.#k.getWorldBounds(e,this.#se),this.#ne.union(this.#se),this.#oe.union(this.#se),e}setBVH(e,t,i){var r;const n=new h.ModelIteratorBVH;n.initialize(this,e,t,i),this.#he.addTraversalController("BVH",n),null!==(r=this.#k)&&void 0!==r&&r.matrix&&this.invalidateBBoxes()}resetIterator(e,t,i){var r;this.#de=0,this.#pe=i,this.#Q=t;const n=null===(r=this.#k)||void 0===r?void 0:r.fragmentsHaveBeenAdded();return this.#he.updateView(e,t,i,n),this.getIterator()}setRaycastIterator(e){var t;this.#ce=e,null===(t=this.#ce)||void 0===t||t.getVisibleBounds(this.#ne,this.#oe,!0)}getRaycastIterator(){return this.#ce}nextBatch(){for(;;){this.#de++;const e=this.#he.nextBatch();if(!e)return null;if(e.modelId=this.id,e instanceof u.Scene)return e;if(this.applyVisibility(e,this.#pe,this.#Q))return e}}applyVisibility(e,t,i){const r=!e.applyVisibility(t,i);return this.#Pe.is2d?r:!!r&&(e.sortObjects&&!this.getFragmentList().useThreeMesh?(e.sortByDepth(i),!0):(e.sortDone||e.sortByMaterial(),!0))}trimPageShadowGeometry(e){if(this.hasPageShadow()){const t=Autodesk.Viewing.Private.F2dShadowRatio;e=e.clone();const i=this.getMetadata("page_dimensions","page_width");e.max.x-=i*t,e.min.y+=i*t}return e}getVisibleBounds(e,t){var i;this.visibleBoundsDirty&&(this.#ne.makeEmpty(),this.#oe.makeEmpty(),this.#he.getVisibleBounds(this.#ne,this.#oe,e),null===(i=this.#ce)||void 0===i||i.getVisibleBounds(this.#ne,this.#oe,e),this.visibleBoundsDirty=!1);let r=e?this.#oe:this.#ne;return t&&(r=this.trimPageShadowGeometry(r)),r}rayIntersect2D(e,t,i,r){const n=this.getModelBounds(!0),o=n.getCenter(new u.Vector3);let s=new u.Vector3;this.#Ae.normal.set(0,0,1),this.#Ae.constant=-o.z;const a=this.getModelToViewerTransform();if(a&&this.#Ae.applyMatrix4(a),s=e.ray.intersectPlane(this.#Ae,s),s){this.#Se.copy(s);const a=this.getInverseModelToViewerTransform();if(a&&(this.#Se.applyMatrix4(a),this.#Se.z=o.z),n.containsPoint(this.#Se)){var l;const n=null===(l=this.#k)||void 0===l||null===(l=l.getMaterial(0))||void 0===l?void 0:l.cutplanes;if(n&&x(s,n))return;const o=e.ray.origin.distanceTo(s);if(o<e.near||o>e.far)return;let a,c;if(r){const e=r(s);if(a=e[0],t&&t.length>0&&!t.includes(a))return;const i=e[1];if(0!==i&&i!==this.id)return;var h;c=null===(h=this.#k)||void 0===h?void 0:h.fragments.dbId2fragId[a]}const u={intersectPoint:s,point:s,distance:o,dbId:a&&this.remapDbIdFor2D(a),fragId:c,model:this};return i&&i.push(u),u}}return null}rayIntersect(e,t,i,r,n,o){if(this.ignoreRayIntersect)return null;if(this.#Pe.is2d)return this.rayIntersect2D(e,i,r,n);this.visibleBoundsDirty&&this.getVisibleBounds();var s,a=[];if(i&&i.length>0){var l=this.getInstanceTree(),h=[];if(l)for(s=0;s<i.length;s++)l.enumNodeFragments(i[s],(function(e){h.push(e)}),!0);else h=i;if(h.length>2){(this.#ce||this.getIterator()).rayCast(e,a,i)}else for(s=0;s<h.length;s++){var u=this.#k.getVizmesh(h[s]);if(u){var d=c.VBIntersector.rayCast(u,e,a,o);d&&a.push(d)}}}else{(this.#ce||this.getIterator()).rayCast(e,a,void 0,o)}if(!a.length)return null;a.sort((function(e,t){return e.distance-t.distance}));var p=!!r;for(r=r||[],s=0;s<a.length;s++){var f=a[s].fragId;if(this.isFragVisible(f)){var m=this.#k.getMaterial(f);if(t&&m.transparent)continue;var g=a[s],v=!1;if(m&&m.cutplanes&&(v=x(g.point,m.cutplanes)),v||r.push(g),g.model=this,!p&&r.length>0)break}}var y=r[0]||null;return y&&(y.model=this),y}setHighlighted(e,t){if(!this.#k)return!1;var i=this.#k.setFlagFragment(e,d.MeshFlags.MESH_HIGHLIGHTED,t);return i&&(t?this.#ae++:this.#ae--),i}setVisibility(e,t){this.#k?this.#k.setVisibility(e,t):this.isLeaflet()&&this.#he.setVisibilityLeaflet(t),this.invalidateBBoxes()}setAllVisibility(e){this.#k?this.#k.setAllVisibility(e):this.isLeaflet()&&this.#he.setVisibilityLeaflet(e),this.invalidateBBoxes()}hideLines(e){this.#k&&this.#k.hideLines(e)}hidePoints(e){this.#k&&this.#k.hidePoints(e)}hasHighlighted(){return!!this.#ae}isFragVisible(e){return this.#k.isFragVisible(e)}areAllVisible(){return!this.#k||this.#k.areAllVisible()}getGeomScenes(){return this.#he.getScenes()}getRenderProgress(){const e=this.#de/this.#he.getSceneCount();return e>1?1:e}update(e){return this.#he.needsRedrawLeaflet(e)}setThemingColor(e,t,i){if(this.#k){e=this.reverseMapDbIdFor2D(e);const r=this.getInstanceTree();return i&&r?void r.enumNodeChildren(e,(e=>{this.#k.setThemingColor(e,t)}),!0):void this.#k.setThemingColor(e,t)}this.#he.setThemingColorLeaflet(t)||f.logger.warn("Theming colors are not supported by this model type.")}clearThemingColors(){this.#k?this.#k.clearThemingColors():this.#he.clearThemingColorsLeaflet()}getLeaflet(){return this.#he.getLeafletIterator()}chooseMemoryTypes(){const e=this.#he.getConsolidation();var t=this.getGeometryList(),i=[];for(r=1;r<t.getCount();r++)(o=t.getGeometry(r))&&(y.MemoryTracker.untrackGeometry(t,o,!1,!o.streamingDraw,!0),o.streamingDraw=o.streamingIndex=void 0);if(e)for(var r=0;r<e.meshes.length;r++){var n=e.meshes[r],o=n.geometry;o.byteSize||(o.byteSize=(0,v.getByteSize)(o));var s=Number.isInteger(n.fragId);if(s){const e=void 0!==o.id?o.id:o.svfid;if(i[e])continue;i[e]=!0}y.MemoryTracker.setMemoryType(t,o,o.numInstances||1),s||(o.streamingDraw?y.MemoryTracker.trackGeometry(t,o):o.discardAfterUpload=!0)}for(r=1;r<t.getCount();r++){if(!(o=t.getGeometry(r)))continue;i[void 0!==o.id?o.id:r]||y.MemoryTracker.setMemoryType(t,o,t.getInstanceCount(r)),o.streamingDraw&&o.dispose()}}consolidate(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=(0,a.consolidateFragmentList)(this,e,t,r,i,this.#ue);this.#he.enableConsolidation(this.#k,n),this.chooseMemoryTypes(),this.#ue=n.consolidationMap}untrackConsolidatedGeometry(){const e=this.#he.getConsolidation();for(let t=0;t<e.meshes.length;t++){const i=e.meshes[t],r=i.geometry;Number.isInteger(i.fragId)||y.MemoryTracker.untrackGeometry(this.getGeometryList(),r,r.streamingDraw)}}unconsolidate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.#he.isEnabledConsolidation()&&(this.untrackConsolidatedGeometry(),this.#he.disableConsolidation(),t&&(this.#ue=null),e&&this.chooseMemoryTypes())}isConsolidated(){return this.#he.isEnabledConsolidation()}getConsolidation(){return this.#he.getConsolidation()}setDbIdRemap(e){this.#_e=e}remapDbId(e){return this.#_e&&e>0&&e<this.#_e.length?this.#_e[e]:e}remapDbIdFor2D(e){return this.#Pe.is2d?this.remapDbId(e):e}reverseMapDbId(e){if(!this.#_e||e<=0)return e;if(!this.#Ee){this.#Ee={};for(var t=0;t<this.#_e.length;t++)this.#Ee[this.#_e[t]]=t}return this.#Ee[e]}reverseMapDbIdFor2D(e){return this.#Pe.is2d?this.reverseMapDbId(e):e}updateRenderProxy(e,t){this.#he.updateRenderProxy(e,t)}skipOpaqueShapes(){this.#he.skipOpaqueShapes()}invalidateBBoxes(){this.visibleBoundsDirty=!0}changePaperVisibility(e){var t;this.#Pe.is2d&&(null===(t=this.#k)||void 0===t||t.setObject2DVisible(-1,e))}hasPaperTransparency(){var e;if(!this.#Pe.is2d)return!1;const t=(null===(e=this.#k)||void 0===e?void 0:e.dbIdOpacity[-1])??1;return t>0&&t<1}setModelTransform(e){this.#he.setModelTransformLeaflet(e),this.isLeaflet()||(this.#k.setModelMatrix(e),this.#he.updateModelTransformConsolidation()),this.invalidateBBoxes(),this.getVisibleBounds(!0),this.#me=null,this.#ge=null}getModelTransform(){var e;const t=this.#he.getModelTransformLeaflet();return t||(null===(e=this.#k)||void 0===e?void 0:e.matrix)}getModelBounds(e,t){if(!this.#we&&!this.#Me)return null;const i=new u.Box3;if(i.copy(this.#we||this.#Me),t&&i.copy(this.trimPageShadowGeometry(i)),e)return i;this.#Te&&this.#we&&i.applyMatrix4(this.#Te);const r=this.getModelTransform();return r&&i.applyMatrix4(r),i}updateModelBBoxOriginal(e){this.#we=e}getInverseModelTransform(){var e;const t=this.#he.getInverseModelTransformLeaflet();return t||(null===(e=this.#k)||void 0===e?void 0:e.getInverseModelMatrix())}getPlacementTransform(){return this.#fe=this.#fe||new m.LmvMatrix4(!0),this.#ve||this.getData().placementTransform||this.#fe}getGlobalOffset(){return this.#ye||this.getData().globalOffset}setPlacementTransform(e){this.#ve=(this.#ve||new m.LmvMatrix4(!0)).copy(e),g.DynamicGlobalOffset.updateModelMatrix(this,e,this.getGlobalOffset())}setGlobalOffset(e){this.#ye=this.#ye||new u.Vector3,this.#ye.copy(e);var t=this.getPlacementTransform();g.DynamicGlobalOffset.updateModelMatrix(this,t,e)}getModelToViewerTransform(){var e;if(this.#me)return this.#me;const t=this.getModelTransform(),i=null===(e=this.getData())||void 0===e?void 0:e.placementWithOffset;return(t||i)&&(this.#me=new u.Matrix4,t&&this.#me.multiply(t),i&&this.#me.multiply(i)),this.#me}getInverseModelToViewerTransform(){if(this.#ge)return this.#ge;const e=this.getModelToViewerTransform();return e&&(this.#ge=e.clone().invert()),this.#ge}getInversePlacementWithOffset(){return this.myData.placementWithOffset?(this.#be||(this.#be=new m.LmvMatrix4(!0).copy(this.myData.placementWithOffset).invert()),this.#be):null}setInnerAttributes(e){this.id=e._id,this.#ne=e._visibleBounds,this.#oe=e._visibleBoundsWithHidden,this.#se=e._tmpBox,this.enforceBvh=e._enforceBvh,this.#ae=e._numHighlighted,this.#le=e._geoms,this.#k=e._frags,this.#ue=e._consolidationMap,this.#de=e._renderCounter,this.#Q=e._frustum,this.#pe=e._drawMode,this.#_e=e._idRemap,this.#Ee=e._reverseMap;const t={_iterator:e._iterator,_linearIterator:e._linearIterator,_bvhIterator:e._bvhIterator,_consolidationIterator:e._consolidationIterator,_bvhOn:e._bvhOn};this.#he.setInnerAttributes(t)}getInnerAttributes(){const e=this.#he.getInnerAttributes();return{_id:this.id,_visibleBounds:this.#ne,_visibleBoundsWithHidden:this.#oe,_tmpBox:this.#se,_enforceBvh:this.enforceBvh,_numHighlighted:this.#ae,_geoms:this.#le,_frags:this.#k,_linearIterator:e.linearIterator,_bvhIterator:e.bvhIterator,_iterator:e.currentIterator,_consolidationIterator:e.consolidationIterator,_consolidationMap:this.#ue,_renderCounter:this.#de,_frustum:this.#Q,_drawMode:this.#pe,_bvhOn:e.bvhOn,_idRemap:this.#_e,_reverseMap:this.#Ee}}setDoNotCut(e,t){if(this.#xe===t)return;this.#xe=t,this.#k?this.#k.setDoNotCut(t):this.isLeaflet()&&this.#he.setDoNotCut(t);e.forEachInModel(this,!1,(i=>{var r;i.doNotCut=t;(null===(r=i.cutplanes)||void 0===r?void 0:r.length)>0===t&&(e._applyCutPlanes(i),i.needsUpdate=!0)}))}getDoNotCut(){return this.#xe}setViewportBounds(e,t){this.isLeaflet()?this.#he.setViewportBoundsLeaflet(t):this.#k&&(t=t||this.isPdf()&&this.getModelBounds(!0,!0),this.#k.setViewBounds(t),e.setViewportBoundsForModel(this,t)),this.invalidateBBoxes()}getViewportBounds(){var e;return this.isLeaflet()?this.#he.getViewportBoundsLeaflet():null===(e=this.#k)||void 0===e?void 0:e.getViewBounds()}load(e){let t=0;return(this.#Pe.isSVF2||this.#Pe.isOTG)&&(t=this.loader.loadFragments(e)),t}unload(e){let t=0;return(this.#Pe.isSVF2||this.#Pe.isOTG)&&(t=this.getFragmentList().unload(e),t>0&&(this.getData().fragsLoaded-=t,this.#De({type:b.FRAGMENTS_UNLOADED_EVENT,model:this}))),t}#De(e){this.loader.viewer3DImpl.api.dispatchEvent(e)}}},75746:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RenderScene:()=>c});var r=i(93549),n=i(86437),o=i(75050),s=i(70179),a=i(70333),l=i(13908);const h=new o.Box3;class c{#Z=!1;#Le=[];#Ie=[];#Re=[];#Oe=[];#Q=new n.FrustumIntersector;#Ne=new o.Raycaster;enableNonResumableFrames=!1;budgetForTransparent=.1;#Fe=!1;#ke=[];#Ve=null;constructor(){}frustum(){return this.#Q}#Ue(e,t){for(let i=0;i<e.length;i++){const r=e[i];if(r&&r.id===t)return r}return null}findModel(e){return this.#Ue(this.#Le,e)}findHiddenModel(e){return this.#Ue(this.#Oe,e)}addModel(e){-1===this.#Le.indexOf(e)&&(this.#Le.push(e),this.#Ie.length=this.#Le.length,this.#Re.length=this.#Le.length,this.recomputeLinePrecision())}removeModel(e){const t=this.#Le.indexOf(e);return t>=0&&this.#Le.splice(t,1),this.#Ie.length=this.#Le.length,this.#Re.length=this.#Le.length,this.recomputeLinePrecision(),t>=0}addHiddenModel(e){const t=this.#Oe.indexOf(e);return t<0&&this.#Oe.push(e),t<0}removeHiddenModel(e){const t=this.#Oe.indexOf(e);return t>=0&&this.#Oe.splice(t,1),t>=0}isEmpty(){return 0===this.#Le.length}recomputeLinePrecision(){let e=1;const t=new o.Vector3;for(let i=0,r=this.#Le.length;i<r;++i){const r=this.#Le[i].getData().bbox;if(0===r.getSize(t).length())continue;const n=.001*o.Box3.prototype.getBoundingSphere.call(r,new o.Sphere).radius;e=Math.min(e,n)}this.#Ne.params.Line.threshold=e}#Be(e,t){void 0!==e.avgFrameTime?e.avgFrameTime=.8*e.avgFrameTime+.2*t:e.avgFrameTime=t}#Ge(e,t,i){let r,n;for(r=0;r<e.length;r++){n=e[r];const i=n.boundingBox||n.getBoundingBox();n.cameraDistance=i.distanceToPoint(t.position)}e.sort((function(e,t){return t.cameraDistance-e.cameraDistance}));let o=performance.now();for(r=0;r<e.length;r++){n=e[r],i(n);const t=performance.now(),s=t-o;o=t,this.#Be(n,s)}}frameResumePossible(){return!this.#Fe}renderSome(e,t){let i=performance.now(),r=i;const n=this.budgetForTransparent*t;let o=null;for(;;){let s=0,a=null;for(let e=0;e<this.#Ie.length;e++){let i=this.#Ie[e];o=this.#Le[e],i||(this.#Ie[e]=i=o.nextBatch());if(this.#Fe&&t<n){i&&!i.sortObjects&&(o.skipOpaqueShapes(),this.#Ie[e]=i=o.nextBatch())}if(null===i)continue;a||(s=e,a=i);const r=i.sortObjects==a.sortObjects&&i.renderImportance>a.renderImportance,l=!i.sortObjects&&a.sortObjects;(r||l)&&(s=e,a=i)}if(!a){this.#Z=!0;break}if(this.#Ie[s]=this.#Le[s].nextBatch(),a.sortObjects&&this.#Fe)this.#ke.push(a),t-=void 0===a.avgFrameTime?.05:a.avgFrameTime;else{e(a),Object.prototype.hasOwnProperty.call(a,"drawEnd")&&(a.drawEnd=a.lastItem),r=performance.now();const n=r-i;i=r,this.#Be(a,n),t-=a.avgFrameTime}if(t<=0)break}return this.#ke.length>0&&(this.#Ge(this.#ke,this.#Ve,e),this.#ke.length=0),t}reset(e,t,i,n){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.#Z=!1,this.#Q.reset(e,n,o),this.#Q.areaCullThreshold=r.PIXEL_CULLING_THRESHOLD,this.#Le.length){this.#Fe=this.enableNonResumableFrames&&i==a.ResetFlags.RESET_RELOAD&&t===s.RenderFlags.RENDER_NORMAL,this.#Ve=e;for(let r=0;r<this.#Le.length;r++)this.#Le[r].resetIterator(e,this.#Q,t,i),this.#Ie[r]=this.#Le[r].nextBatch(),this.#Re[r]=null}}isDone(){return this.#Z||this.isEmpty()}setAllVisibility(e){for(let t=0;t<this.#Le.length;t++)this.#Le[t].setAllVisibility(e)}hideLines(e){for(let t=0;t<this.#Le.length;t++)this.#Le[t].hideLines(e)}hidePoints(e){for(let t=0;t<this.#Le.length;t++)this.#Le[t].hidePoints(e)}hasHighlighted(){for(let e=0;e<this.#Le.length;e++)if(this.#Le[e].hasHighlighted())return!0;return!1}areAllVisible(){for(let e=0;e<this.#Le.length;e++)if(!this.#Le[e].areAllVisible())return!1;return!0}areAll2D(){for(let e=0;e<this.#Le.length;e++)if(!this.#Le[e].is2d())return!1;return!0}areAll3D(){for(let e=0;e<this.#Le.length;e++)if(!this.#Le[e].is3d())return!1;return!0}invalidateVisibleBounds(){for(let e=0;e<this.#Le.length;e++)this.#Le[e].visibleBoundsDirty=!0}getVisibleBounds(e,t,i){h.makeEmpty();for(let r=0;r<this.#Le.length;r++){const n=this.#Le[r].getVisibleBounds(e,i);t&&!t(n)||h.union(n)}return h}rayIntersect(e,t,i,r,n,o,s,a){if(this.#Ne.set(e,t),this.#Le.length>1){const e=[];if(n)for(let t=0;t<n.length;t++){const l=this.findModel(n[t]);if(l){const n=r&&r[t],h=l.rayIntersect(this.#Ne,i,n,o,s,a);h&&e.push(h)}}else for(let t=0;t<this.#Le.length;t++){const n=this.#Le[t].rayIntersect(this.#Ne,i,r,o,s,a);n&&e.push(n)}return e.length?(e.sort((function(e,t){return e.distance-t.distance})),e[0]):null}{if(!this.#Le.length)return null;const e=this.#Le[0];return n&&-1===n.indexOf(e.id)?null:e.rayIntersect(this.#Ne,i,r,o,s,a)}}getRenderProgress(){return this.#Le[0].getRenderProgress()}getModels(){return this.#Le}getHiddenModels(){return this.#Oe}getAllModels(){return this.#Le.concat(this.#Oe)}getFragmentList(){return this.#Le[0].getFragmentList()}getGeometryList(){return this.#Le[0].getGeometryList()}getSceneCount(){return this.#Le[0].getSceneCount()}getGeomScenes(){let e=[];for(let t=0;t<this.#Le.length;t++){const i=this.#Le[t].getGeomScenes();for(let t=0;t<i.length;t++){const r=i[t];r&&e.push(r)}}return e}getGeomScenesPerModel(){return this.#Le.reduce(((e,t)=>(e.push(t.getGeomScenes()),e)),[])}explode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.#Le.length){for(let i=0;i<this.#Le.length;i++){const r=this.#Le[i];l.i.explode(r,e,t)}this.invalidateVisibleBounds()}}update(e){let t=!1;for(let i=0;i<this.#Le.length;i++){const r=this.#Le[i];t=t||r.update(e)}return t}hideModel(e){for(let t=0;t<this.#Le.length;t++){const i=this.#Le[t];if(i&&i.id===e)return this.removeModel(i),this.#Oe.push(i),!0}return!1}showModel(e){for(let t=0;t<this.#Oe.length;++t){const i=this.#Oe[t];if(i&&i.id===e)return this.addModel(i),this.#Oe.splice(t,1),!0}return!1}}},70333:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ResetFlags:()=>r});var r={RESET_NORMAL:0,RESET_REDRAW:1,RESET_RELOAD:2}},37765:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SceneMath:()=>h});var r=i(75050);const n=[new r.Vector3(1,0,0),new r.Vector3(0,1,0),new r.Vector3(0,0,1),new r.Vector3(-1,0,0),new r.Vector3(0,-1,0),new r.Vector3(0,0,-1)];let o=new r.Plane;new r.Vector3;function s(e,t,i,n){var o=e;o.z=-1;var s=new r.Vector3(o.x,o.y,1);o=o.unproject(t),(s=s.unproject(t)).sub(o).normalize();var a,l=s;if(Math.abs(l[i])<1e-6)return null;a=t.isPerspective?t.position:o;var h=((n?n.min[i]:0)-a[i])/l[i];return l.multiplyScalar(h),l.add(a),l}function a(e,t,i){var r=e.clone();return r.max(t),r.min(i),r.distanceToSquared(e)}function l(e,t){return a(e,t.min,t.max)}let h={box2CutPlanes:function(e,t){let i=[];for(let s=0;s<n.length;s++){o.normal.copy(n[s]);const a=s<3?e.max:e.min;o.constant=-o.normal.dot(a),t&&o.applyMatrix4(t),i.push(new r.Vector4(o.normal.x,o.normal.y,o.normal.z,o.constant))}return i},getPixelsPerUnit:function(e,t,i,n,o,a){if(!e.isPerspective)return n/e.orthoScale;let h,c=i.getCenter(new r.Vector3);if(t)if(a)h=Math.sqrt(l(e.position,a));else{const t="z",i=s(new r.Vector3(0,0,1),e,t);i&&(c=i),h=e.position.distanceTo(c)}else{if(o){const t=o,r=e.target.clone().sub(e.position).normalize(),n=r.dot(t);if(0!==n){const o=-(e.position.clone().dot(t)+t.w)/n;c=i.clampPoint(r.multiplyScalar(o).add(e.position),c)}}h=e.position.distanceTo(c)}return n/(2*h*Math.tan(r.Math.degToRad(.5*e.fov)))},intersectGroundViewport:s,getNormalizingMatrix:function(e,t){t=t||e.getData().bbox;var i=new r.Matrix4;i.makeTranslation(-t.min.x,-t.min.y,-t.min.z);var n=new r.Vector3(0,0,0).subVectors(t.max,t.min),o=new r.Matrix4;o.makeScale(1/n.x,1/n.y,1);var s=new r.Matrix4;return s.multiplyMatrices(o,i),s},pointToMinMaxBoxDistance2:a,pointToBoxDistance2:l}},75124:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SceneTraversal:()=>s});var r=i(58203),n=i(78484),o=i(56144);class s{#ze=new Map;#He="NoOp";#We=null;#Q=void 0;#pe=void 0;constructor(){this.addTraversalController("NoOp",new n.NoOpTraversalController)}addTraversalController(e,t){this.#ze.set(e,t),this.#je()}getTraversalController(){return this.#ze.get(this.#He)}#je(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||!this.#ze.has("BVH")?this.#ze.has("Linear")?this.#He="Linear":this.#ze.has("Custom")?this.#He="Custom":this.#He="NoOp":this.#He="BVH"}dtor(){this.#We&&(this.#We.dispose(),this.#We=null),this.#ze.forEach((e=>{e.dtor()})),this.#ze=null,this.#He=null}nextBatch(){const e=this.getTraversalController().nextBatch();if(!e)return null;if(this.#We&&e instanceof o.RenderBatch){const t=this.#We.consolidateNextBatch(e,this.#Q,this.#pe);return t||e}return e}updateView(e,t,i,r){this.#Q=t,this.#pe=i,this.#je(r),this.getTraversalController().reset(t,e),this.#We&&this.#We.reset()}getVisibleBounds(e,t,i){this.getTraversalController().getVisibleBounds(e,t,i)}getScenes(){const e=this.getTraversalController();return e.isModelIteratorTexQuad?[]:e.getGeomScenes()}getSceneCount(){return this.getTraversalController().getSceneCount()}getInnerAttributes(){return{currentIterator:this.getTraversalController(),linearIterator:this.#ze.get("Linear"),bvhIterator:this.#ze.get("BVH"),consolidationIterator:this.#We,bvhOn:this.#qe()}}setInnerAttributes(e){var t;(!this.#ze.has("Linear")&&e._linearIterator&&(this.#ze.set("Linear",e._linearIterator.clone()),e._linearIterator===e._iterator&&(this.#He="Linear")),!this.#ze.has("BVH")&&e._bvhIterator&&(this.#ze.set("BVH",e._bvhIterator.clone()),e._bvhIterator===e._iterator&&(this.#He="BVH")),!this.#We&&e._consolidationIterator&&(this.#We=e._consolidationIterator.clone()),"NoOp"==!this.#He)&&(this.#ze.set("Custom",null!==(t=e._iterator)&&void 0!==t&&t.clone?e._iterator.clone():e._iterator),this.#He="Custom")}#qe(){return"BVH"==this.#He}addFragment(e){"Linear"==this.#He&&this.getTraversalController().addFragment(e)}setVisibilityLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setVisibility(e)}needsRedrawLeaflet(e){return!!this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().update(e)}clearThemingColorsLeaflet(){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().clearThemingColor()}setThemingColorLeaflet(e){return!!this.getTraversalController().isModelIteratorTexQuad&&(this.getTraversalController().setThemingColor(e),!0)}getLeafletIterator(){return this.getTraversalController().isModelIteratorTexQuad?this.getTraversalController():null}setModelTransformLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setModelMatrix(e)}getModelTransformLeaflet(){if(this.getTraversalController().isModelIteratorTexQuad)return this.getTraversalController().getModelMatrix()}getInverseModelTransformLeaflet(){if(this.getTraversalController().isModelIteratorTexQuad)return this.getTraversalController().getInverseModelMatrix()}setViewportBoundsLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setViewBounds(e)}getViewportBoundsLeaflet(){if(this.getTraversalController().isModelIteratorTexQuad)return this.getTraversalController().getViewBounds()}setDoNotCutLeaflet(e){this.getTraversalController().isModelIteratorTexQuad&&this.getTraversalController().setDoNotCut(e)}updateModelTransformConsolidation(){this.#We&&this.#We.modelMatrixChanged()}enableConsolidation(e,t){this.#We=new r.ConsolidationIterator(e,t)}disableConsolidation(){this.#We.dispose(),this.#We=null}getConsolidation(){var e;return null===(e=this.#We)||void 0===e?void 0:e.getConsolidation()}isEnabledConsolidation(){return!!this.#We}updateRenderProxy(e,t){this.isEnabledConsolidation()&&this.#We.updateRenderProxy(e,t)}skipOpaqueShapes(){this.getTraversalController().skipOpaqueShapes&&this.getTraversalController().skipOpaqueShapes()}}},36263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SelectionMode:()=>r});let r={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2}},44225:(e,t,i)=>{"use strict";function r(e){var t=e||function(e,t){return e<t},i=[],r=[];function n(e,o,s){if(o||(o=0),s||(s=r.length),o>=s)return s;if(s===o+1){var a=i[r[o]];return t(a,e)?s:o}var l=parseInt(o+(s-o)/2),h=i[r[l-1]];return t(e,h)?n(e,o,l):t(h,e)?n(e,l,s):l-1}this.add=function(e){var t=n(e);if(t==r.length)return i.push(e),void r.push(i.length-1);i.push(e),r.splice(t,0,i.length-1)},this.size=function(){return r.length},this.get=function(e){return i[r[e]]},this.removeAt=function(e){var t=r[e];i[t]=void 0,r.splice(e,1)},this.toString=function(){for(var e="",t=0,i=this.size();t<i;++t)e+=this.get(t),t<i-1&&(e+=", ");return e}}i.r(t),i.d(t,{SortedList:()=>r})},60945:(e,t,i)=>{"use strict";i.r(t),i.d(t,{VBIntersector:()=>m});var r,n,o,s,a=i(97559),l=i(75050);function h(){r||(r=new l.Matrix4,n=new l.Ray,new l.Vector3,new l.Vector3,new l.Vector3,o=new l.Vector3,s=new l.Vector3)}function c(e,t,i){h();var c=e.geometry;if(c){var u=e.material,d=u?u.side:l.FrontSide;r.copy(e.matrixWorld).invert(),n.copy(t.ray).applyMatrix4(r);var p,f,m=t.precision||1e-4;(0,a.enumMeshTriangles)(c,(function(r,a,h,c,u,g,v,y,b,x){null!==(p=d===l.BackSide?n.intersectTriangle(h,a,r,!0,o):n.intersectTriangle(r,a,h,d!==l.DoubleSide,o))&&(p.applyMatrix4(e.matrixWorld),(f=t.ray.origin.distanceTo(p))<m||f<t.near||f>t.far||(l.Triangle.getNormal(r,a,h,s),i.push({distance:f,point:p.clone(),face:new l.Face3(c,u,g,s.clone()),faceIndex:x,fragId:e.fragId,dbId:e.dbId,object:e,modelId:e.modelId})))}))}}function u(e,t,i,o){h();var s=e.geometry;if(s){var c=t.params.Line.threshold;e.isWideLine&&(e.material.linewidth?c=e.material.linewidth:e.geometry.lineWidth&&(c=e.geometry.lineWidth));var u=c*c;r.copy(e.matrixWorld).invert(),n.copy(t.ray).applyMatrix4(r);var d=new l.Vector3,p=new l.Vector3;s instanceof l.BufferGeometry&&(0,a.enumMeshLines)(s,(function(r,s,a,l,h){var c,f;if(n.distanceSqToSegment(r,s,p,d),d.applyMatrix4(e.matrixWorld),p.applyMatrix4(e.matrixWorld),(f=d.distanceToSquared(p))>u)return;if((c=t.ray.origin.distanceTo(d))<t.near||c>t.far)return;let m={distance:c,point:d.clone(),face:{a,b:l},faceIndex:h,fragId:e.fragId,dbId:e.dbId,object:e,distanceToRay:Math.sqrt(f)};o&&o.filter&&!o.filter(m)||i.push(m)}))}}function d(e,t,i,o){e.isLine||e.isWideLine?null!=o&&o.skipLines||u(e,t,i,o):e.isPoint?null!=o&&o.skipPoints||function(e,t,i){h();var o=e.geometry;if(o){r.copy(e.matrixWorld).invert(),n.copy(t.ray).applyMatrix4(r);var s=t.precision||1e-4,c=t.params.PointCloud.threshold;c||(c=1),c*=Math.max(3,o.pointSize),c/=4,o instanceof l.BufferGeometry&&(0,a.enumMeshVertices)(o,(function(r,o,a,l){if(!(n.distanceToPoint(r)>c)){var h=n.closestPointToPoint(r);if(null!==h){h.applyMatrix4(e.matrixWorld);var u=t.ray.origin.distanceTo(h);u<s||u<t.near||u>t.far||i.push({distance:u,point:r,face:{a:l},faceIndex:l,fragId:e.fragId,dbId:e.dbId,object:e})}}}))}}(e,t,i):null!=o&&o.skipMeshes||c(e,t,i)}function p(e,t,i,r){if(e instanceof l.Mesh?d(e,t,i):e.raycast(t,i),!0===r)for(var n=e.children,o=0,s=n.length;o<s;o++)p(n[o],t,i,!0)}var f=function(e,t){return e.distance-t.distance};let m={meshRayCast:c,lineRayCast:u,rayCast:d,intersectObject:function(e,t,i,r){p(e,t,i,r),i.sort(f)}}},90245:(e,t,i)=>{"use strict";i.r(t),i.d(t,{VertexBufferReader:()=>n});var r=2*Math.PI;function n(e){var t;this.vb=e.vb.buffer,this.stride=e.vbstride,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vbs=new Uint16Array(this.vb),this.ib=e.ib,this.vcount=this.vbf.length/this.stride,this.useInstancing=e.numInstances>0,this.useCompactBuffers=e.unpackXform,this.texData=this.useCompactBuffers&&(null===(t=e.tIdColor)||void 0===t||null===(t=t.image)||void 0===t?void 0:t.data)&&new Uint32Array(e.tIdColor.image.data.buffer),this.isInterleavedVb=(()=>{const t=e.attributes;if(!t)return!1;const i=t.layerVp4b,r=t.flags4b;if(this.useCompactBuffers){return t.uvIdColor&&i&&r}{const e=t.color4b,n=t.dbId4b;return e&&n&&i&&r}})()}n.prototype.getDbIdAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+7]]:this.vbi[e*this.stride+7]},n.prototype.getColorAt=function(e){return this.texData?this.texData[this.vbs[e*this.stride*2+6]]:this.vbi[e*this.stride+6]},n.prototype.getVertexFlagsAt=function(e){return this.texData?this.vbi[e*this.stride+4]:this.vbi[e*this.stride+8]},n.prototype.getLayerIndexAt=function(e){return this.texData?65535&this.vbi[e*this.stride+5]:65535&this.vbi[e*this.stride+9]},n.prototype.getViewportIndexAt=function(e){return this.texData?this.vbi[e*this.stride+5]>>16&65535:this.vbi[e*this.stride+9]>>16&65535},n.prototype.decodeLineAt=function(e,t,i,n){if(n.onLineSegment){if(this.useCompactBuffers)var o=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w,l=this.vbs[o+2]/65535*r-Math.PI,h=this.vbs[o+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),c=this.vbs[o+4]/32767*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y)*2;else{var u=this.stride*e;s=this.vbf[u],a=this.vbf[u+1],l=this.vbf[u+2]*r-Math.PI,h=this.vbf[u+3],c=2*this.vbf[u+4]}var d=s+h*Math.cos(l),p=a+h*Math.sin(l);n.onLineSegment(s,a,d,p,i,c)}},n.prototype.decodeCircularArcAt=function(e,t,i,n){if(n.onCircularArc){if(this.useCompactBuffers)var o=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w,l=this.vbs[o+2]/65535*r,h=this.vbs[o+3]/65535*r,c=this.vbs[o+5]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var u=this.stride*e;s=this.vbf[u],a=this.vbf[u+1],l=this.vbf[u+2]*r,h=this.vbf[u+3]*r,c=this.vbf[u+5]}n.onCircularArc(s,a,l,h,c,i)}},n.prototype.decodeEllipticalArcAt=function(e,t,i,n){if(n.onEllipticalArc){var o=this.stride*e,s=this.vbf[o],a=this.vbf[o+1],l=this.vbf[o+2]*r,h=this.vbf[o+3]*r,c=this.vbf[o+5],u=this.vbf[o+10],d=this.vbf[o+11];n.onEllipticalArc(s,a,l,h,c,u,d,i)}},n.prototype.decodeTexQuadAt=function(e,t,i,n){if(n.onTexQuad){if(this.useCompactBuffers)var o=this.stride*e*2,s=this.useCompactBuffers.x*this.vbs[o]/65535+this.useCompactBuffers.z,a=this.useCompactBuffers.y*this.vbs[o+1]/65535+this.useCompactBuffers.w,l=this.vbs[o+2]/65535*r,h=this.vbs[o+3]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y),c=this.vbs[o+4]/65535*Math.max(this.useCompactBuffers.x,this.useCompactBuffers.y);else{var u=this.stride*e;s=this.vbf[u],a=this.vbf[u+1],l=this.vbf[u+2]*r,h=this.vbf[u+3],c=this.vbf[u+4]}n.onTexQuad(s,a,h,c,l,i)}},n.prototype.decodeOneTriangleAt=function(e,t,i,r){if(r.onOneTriangle){if(this.useCompactBuffers)var n=this.stride*e*2,o=this.useCompactBuffers.x*this.vbs[n]/65535+this.useCompactBuffers.z,s=this.useCompactBuffers.y*this.vbs[n+1]/65535+this.useCompactBuffers.w,a=this.useCompactBuffers.x*this.vbs[n+2]/65535+this.useCompactBuffers.z,l=this.useCompactBuffers.y*this.vbs[n+3]/65535+this.useCompactBuffers.w,h=this.useCompactBuffers.x*this.vbs[n+4]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[n+5]/65535+this.useCompactBuffers.w;else{var u=this.stride*e;o=this.vbf[u],s=this.vbf[u+1],a=this.vbf[u+2],l=this.vbf[u+3],h=this.vbf[u+4],c=this.vbf[u+5]}r.onOneTriangle(o,s,a,l,h,c,i)}},n.prototype.decodeTriangleIndexed=function(e,t,i,r,n,o){if(o.onOneTriangle){if(this.useCompactBuffers){var s=this.stride*e*2,a=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,l=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w;s=this.stride*t*2;var h=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,c=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w;s=this.stride*i*2;var u=this.useCompactBuffers.x*this.vbs[s]/65535+this.useCompactBuffers.z,d=this.useCompactBuffers.y*this.vbs[s+1]/65535+this.useCompactBuffers.w}else{var p=this.stride*e;a=this.vbf[p],l=this.vbf[p+1];p=this.stride*t;h=this.vbf[p],c=this.vbf[p+1];p=this.stride*i;u=this.vbf[p],d=this.vbf[p+1]}o.onOneTriangle(a,l,h,c,u,d,n)}},n.prototype.decodeByType=function(e,t,i,r,n){switch(e){case 11:case 8:case 9:case 10:case 1:this.decodeLineAt(t,i,r,n);break;case 2:this.decodeCircularArcAt(t,i,r,n);break;case 3:this.decodeEllipticalArcAt(t,i,r,n);break;case 4:this.decodeTexQuadAt(t,i,r,n);break;case 5:this.decodeOneTriangleAt(t,i,r,n)}},n.prototype.enumGeomsForObject=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var r=this.getVertexFlagsAt(i)>>8&255,n=this.getLayerIndexAt(i),o=this.getViewportIndexAt(i);(a=this.getDbIdAt(i)===e)&&this.decodeByType(r,i,n,o,t),i+=1}else for(i=0;i<this.ib.length;){var s=this.ib[i],a=(r=this.getVertexFlagsAt(s)>>8&255,n=this.getLayerIndexAt(s),o=this.getViewportIndexAt(s),this.getDbIdAt(s)===e);0===r?(a&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],n,o,t),i+=3):(a&&this.decodeByType(r,s,n,o,t),i+=6)}},n.prototype.enumGeomsForVisibleLayer=function(e,t){this.enumGeoms((function(t,i,r){return!e||0!==i&&-1!==e.indexOf(i)}),t)},n.prototype.enumGeoms=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var r=this.getVertexFlagsAt(i)>>8&255,n=this.getLayerIndexAt(i),o=this.getViewportIndexAt(i),s=this.getDbIdAt(i);(l=!e||e(s,n,o))&&this.decodeByType(r,i,n,o,t),i+=1}else for(i=0;i<this.ib.length;){var a=this.ib[i],l=(r=this.getVertexFlagsAt(a)>>8&255,n=this.getLayerIndexAt(a),o=this.getViewportIndexAt(a),s=this.getDbIdAt(a),!e||e(s,n,o));0===r?(l&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],n,o,t),i+=3):(l&&this.decodeByType(r,a,n,o,t),i+=6)}}},97559:(e,t,i)=>{"use strict";i.r(t),i.d(t,{VertexEnumerator:()=>w,enumMeshEdges:()=>S,enumMeshIndices:()=>_,enumMeshLines:()=>A,enumMeshTriangles:()=>E,enumMeshVertices:()=>x,getIndicesCount:()=>g,getVertexCount:()=>m});var r,n,o,s,a,l,h,c,u,d,p,f=i(96164);function m(e){return e.vb?e.vb.length/e.vbstride:e.attributes.position?e.attributes.position.array.length/3:0}function g(e){const t=b(e);if(t){var i=e.groups;if(!i||0===i.length)return t.length;let o=0;for(var r=0,n=i.length;r<n;++r)o+=i[r].count;return o}return m(e)}function v(e){const t=e.attributes;let i,r,n;if(e.vblayout){if(!e.vblayout.position)return{positions:void 0,poffset:void 0};n=e.vblayout.position.offset}else{if(!t.position)return{positions:void 0,poffset:void 0};n=t.position.offset||0}return i=e.vb||t.position.array,r=e.vb?e.vbstride:3,{positions:i,stride:r,poffset:n}}function y(e){const t=e.attributes;let i=0,r=e.vb||t.normal&&t.normal.array,n=e.vblayout?e.vblayout.normal:t.normal||null;return n?(i=n.offset||0,i*=1):r=null,!n||n.array||3===n.itemSize&&4===n.bytesPerItem||(r=null),{normals:r,noffset:i}}function b(e){return e.ib||e.indices||(e.index?e.index.array:null)}function x(e,t,i){e.attributes;r||(r=new f.LmvVector3,n=new f.LmvVector3,new f.LmvVector3),i&&(o||(o=new THREE.Matrix3),o.getNormalMatrix(i));const{positions:s,stride:a,poffset:l}=v(e),{normals:h,noffset:c}=y(e);if(s)for(var u=m(e),d=l,p=c,g=0;g<u;g++,d+=a,p+=a)r.set(s[d],s[d+1],s[d+2]),i&&r.applyMatrix4(i),h&&(n.set(h[p],h[p+1],h[p+2]),i&&n.applyMatrix3(o)),t(r,h?n:null,null,g)}function _(e,t){const i=b(e);if(i){let r=e.groups;r&&0!==r.length||(r=[{start:0,count:i.length,index:0}]);for(let e=0,n=r.length;e<n;++e){let n=r[e].start,o=r[e].count,s=r[e].index;for(let e=n,r=n+o;e<r;e+=3){t(s+i[e],s+i[e+1],s+i[e+2])}}}else{let i=m(e);for(let e=0;e<i;e++){t(3*e,3*e+1,3*e+2)}}}function E(e,t){var i,r,n;s||(s=new f.LmvVector3,a=new f.LmvVector3,l=new f.LmvVector3,h=new f.LmvVector3,c=new f.LmvVector3,u=new f.LmvVector3);const{positions:o,stride:d,poffset:p}=v(e),{normals:g,noffset:x}=y(e),_=b(e);if(o)if(_){var E=e.groups;E&&0!==E.length||(E=[{start:0,count:_.length,index:0}]);for(var A=0,S=E.length;A<S;++A)for(var w=E[A].start,M=E[A].count,T=E[A].index,C=w,P=w+M;C<P;C+=3){var D=(i=T+_[C])*d+p,L=(r=T+_[C+1])*d+p,I=(n=T+_[C+2])*d+p;if(s.x=o[D],s.y=o[D+1],s.z=o[D+2],a.x=o[L],a.y=o[L+1],a.z=o[L+2],l.x=o[I],l.y=o[I+1],l.z=o[I+2],g){var R=i*d+x,O=r*d+x,N=n*d+x;h.x=g[R],h.y=g[R+1],h.z=g[R+2],c.x=g[O],c.y=g[O+1],c.z=g[O+2],u.x=g[N],u.y=g[N+1],u.z=g[N+2],t(s,a,l,i,r,n,h,c,u,C/3)}else t(s,a,l,i,r,n,null,null,null,C/3)}}else{var F=m(e);for(C=0;C<F;C+=3){D=(i=C)*d+p,L=(r=C+1)*d+p,I=(n=C+2)*d+p;if(s.x=o[D],s.y=o[D+1],s.z=o[D+2],a.x=o[L],a.y=o[L+1],a.z=o[L+2],l.x=o[I],l.y=o[I+1],l.z=o[I+2],g){R=i*d+x,O=r*d+x,N=n*d+x;h.x=g[R],h.y=g[R+1],h.z=g[R+2],c.x=g[O],c.y=g[O+1],c.z=g[O+2],u.x=g[N],u.y=g[N+1],u.z=g[N+2],t(s,a,l,i,r,n,h,c,u,C/3)}else t(s,a,l,i,r,n,null,null,null,C/3)}}}function A(e,t){var i,r,n=e.attributes;d||(d=new f.LmvVector3,p=new f.LmvVector3);var o=2;e.lineWidth&&(o=6);const s=b(e);if(s){let f,b;f=e.vb?e.vb:n.position.array,b=e.vb?e.vbstride:3;var a=e.groups;a&&0!==a.length||(a=[{start:0,count:s.length,index:0}]);for(var l=0,h=a.length;l<h;++l)for(var c=a[l].start,u=a[l].count,m=a[l].index,g=c,v=c+u,y=c/o;g<v;g+=o,y++)i=m+s[g],r=m+s[g+1],d.x=f[i*b],d.y=f[i*b+1],d.z=f[i*b+2],p.x=f[r*b],p.y=f[r*b+1],p.z=f[r*b+2],t(d,p,i,r,y)}else{const s=e.vb?e.vb:n.position.array,a=e.vb?e.vbstride:3;for(g=0,v=s.length/a,y=0;g<v;g+=o,y++)i=g,r=g+1,d.x=s[i*a],d.y=s[i*a+1],d.z=s[i*a+2],p.x=s[r*a],p.y=s[r*a+1],p.z=s[r*a+2],t(d,p,i,r,y)}}function S(e,t){var i,r;d||(d=new f.LmvVector3,p=new f.LmvVector3);const n=e.iblines;if(!n)return;const o=e.vb?e.vb:attributes.position.array,s=e.vb?e.vbstride:3;var a=e.groups;a&&0!==a.length||(a=[{start:0,count:n.length,index:0}]);for(var l=0,h=a.length;l<h;++l)for(var c=a[l].start,u=a[l].count,m=a[l].index,g=c,v=c+u;g<v;g+=2)i=m+n[g],r=m+n[g+1],d.x=o[i*s],d.y=o[i*s+1],d.z=o[i*s+2],p.x=o[r*s],p.y=o[r*s+1],p.z=o[r*s+2],t(d,p,i,r)}let w={getVertexCount:m,enumMeshVertices:x,enumMeshIndices:_,enumMeshTriangles:E,enumMeshLines:A,enumMeshEdges:S}},11056:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Consolidation:()=>k,ConsolidationBuilder:()=>V,canBeMerged:()=>F,copyPrimitiveProps:()=>O,copyVertexFormat:()=>R,isVisible:()=>D,mergeGeometries:()=>N});var r=i(75050),n=i(97559),o=i(86945),s=i(12529),a=i(96199),l=i(66799),h=i(194),c=i(96164);function u(e,t,i,r){var o=function(e){for(var t=new Uint16Array(e.length+1),i=0,r=0;r<e.length;r++)t[r]=i,i+=(0,n.getVertexCount)(e[r]);return t[r]=i,t}(e),s=new a.GeomMergeTask;return s.vb=t.vb,s.vbstride=t.vbstride,s.posOffset=t.attributes.position.offset,s.normalOffset=t.attributes.normal?t.attributes.normal.offset:-1,s.matrices=i,s.ranges=o,s.dbIds=r,s}function d(e,t){t.vb=e.vb,t.attributes.id.array=e.vertexIds,t.needsUpdate=!0}function p(e){var t=0,i={},r=[],n=e,o=new Array(2);function s(e){for(var r=e.data,s=0;s<r.length;s++){var a=r[s],l=a.taskId;d(a,i[l]),delete i[l]}if(0===--t)for(n.inProgress=!1,s=0;s<o.length;s++)o[s].terminate(),o[s]=null}this.addMergeTask=function(e,t,n,o){var s=u(e,t,n,o);r.push(s),i[s.id]=t},this.runTasks=function(){for(var e=0;e<2;e++)o[e]=p.createWorker(),o[e].addEventListener("message",s);for(var i=r.length,a=Math.floor(i/2),l=0;l<2;l++){var h=l*a,c=1===l?i:h+a,u=[],d=new Array(4*(c-h)),f=0;for(e=h;e<c;e++){var m=r[e];d[f++]=m.vb.buffer,d[f++]=m.matrices.buffer,d[f++]=m.ranges.buffer,d[f++]=m.dbIds.buffer,u.push(m)}var g={operation:"MERGE_GEOMETRY",tasks:u};o[l].doOperation(g,d),t++}n.inProgress=!0}}p.createWorker=l.createWorker;var f=i(60489),m=i(19462),g=i(33736),v=i(70179),y={UNKNOWN:0,TRIANGLES:1,LINES:2,WIDE_LINES:3,POINTS:4};function b(e){return e.isLines?y.LINES:e.isPoints?y.POINTS:e.isWideLines?y.WIDE_LINES:y.TRIANGLES}function x(e,t){switch(!0===e.isLines&&(e.isLines=void 0),!0===e.isWideLines&&(e.isWideLines=void 0),!0===e.isPoints&&(e.isPoints=void 0),t){case y.LINES:e.isLines=!0;break;case y.WIDE_LINES:e.isWideLines=!0;break;case y.POINTS:e.isPoints=!0}}var _=g.MeshFlags.MESH_HIGHLIGHTED,E=g.MeshFlags.MESH_VISIBLE|g.MeshFlags.MESH_HIDE|_,A=g.MeshFlags.MESH_VISIBLE,S=g.MeshFlags.MESH_VISIBLE|g.MeshFlags.MESH_HIDE,w=0,M=g.MeshFlags.MESH_HIGHLIGHTED|g.MeshFlags.MESH_HIDE,T=g.MeshFlags.MESH_HIGHLIGHTED,C=v.RenderFlags.RENDER_HIDDEN,P=v.RenderFlags.RENDER_HIGHLIGHTED;function D(e,t){switch(t){case C:return(e&S)===w;case P:return(e&M)===T}return(e&E)==A}const L=new r.Matrix4;function I(e){this.geoms=[],this.matrices=[],this.vertexCount=0,this.material=e,this.fragIds=[],this.worldBox=new r.Box3}function R(e,t){for(var i in e.vb||f.logger.warn("copyVertexFormat() supports only interleaved buffers"),t.vbstride=e.vbstride,e.attributes)t.attributes[i]=e.attributes[i];t.attributesKeys=e.attributesKeys.slice(0)}function O(e,t){x(t,b(e)),t.lineWidth=e.lineWidth,t.pointSize=e.pointSize}function N(e,t,i,s,a){var l=function(e){let t=e[0].vbstride;var i=0,s=0;let a,l=0;for(let t=0;t<e.length;t++){const r=e[t];s+=(0,n.getVertexCount)(r),i+=r.ib.length,a=r.iblines,a&&(l+=a.length)}var h=(0,o.createBufferGeometry)();h.byteSize=0,h.vb=new Float32Array(s*t),h.ib=new Uint16Array(i),l>0&&(a=new Uint16Array(l),h.byteSize+=a.byteLength,h.iblines=a),h.byteSize+=h.vb.byteLength+h.ib.byteLength,O(e[0],h),R(e[0],h);var c=new r.BufferAttribute(new Float32Array,3);c.normalized=!0,c.bytesPerItem=1,h.setAttribute("id",c);var u=e[0];return x(h,b(u)),u.isPoints&&(h.pointSize=u.pointSize),u.isWideLines&&(h.lineWidth=u.lineWidth),h}(e);return l.boundingBox=s.clone(),function(e,t){for(var i=0,r=0,o=0,s=0,a=0;a<e.length;a++){var l=e[a],h=(0,n.getVertexCount)(l);const c=l.vb,u=l.ib,d=u.length,p=t.vb,f=t.ib,m=l.iblines,g=(null==m?void 0:m.length)??0,v=t.iblines;for(let e=0;e<d;e++)f[o+e]=u[e]+r;for(let e=0;e<g;e++)v[s+e]=m[e]+r;s+=g,p.set(c,i),i+=c.length,r+=h,o+=d}}(e,l),a?a.addMergeTask(e,l,t,i):function(e,t,i,r){var n=u(e,t,i,r),o=new c.LmvVector3,s=new h.LmvMatrix4;d(n.run(s,o),t)}(e,l,t,i),l}function F(e,t){if(e.vbstride!=t.vbstride)return!1;if(b(e)!==b(t))return!1;if(e.isPoints&&e.pointSize!==t.pointSize)return!1;if(e.isWideLines&&e.lineWidth!==t.lineWidth)return!1;if(e.attributesKeys.length!=t.attributesKeys.length)return!1;for(var i=0,r=e.attributesKeys.length;i<r;i++){var n=e.attributesKeys[i],o=e.attributes[n],s=t.attributes[n];if(!s)return!1;if(o===s)continue;const r=o.bytesPerItem!==s.bytesPerItem;if(o.offset!==s.offset||o.normalized!==s.normalized||o.itemSize!==s.itemSize||r||o.isPattern!==s.isPattern)return!1}return!0}function k(e){this.meshes=[],this.fragId2MeshIndex=new Int32Array(e);for(var t=0;t<this.fragId2MeshIndex.length;t++)this.fragId2MeshIndex[t]=-1;this.byteSize=0,this.consolidationMap=null}function V(){this.buckets={},this.bucketCount=0,this.costs=0}function U(e,t){this.fragOrder=new Uint32Array(e),this.ranges=new Uint32Array(t),this.boxes=new Array(t),this.numConsolidated=-1,this.tmpGeoms=[],this.tmpMatrix=new r.Matrix4}I.prototype={constructor:I,addGeom:function(e,t,i){this.geoms.push(e),this.fragIds.push(i),this.worldBox.union(t),this.vertexCount+=(0,n.getVertexCount)(e);var r=this.geoms.length;return 1==r?0:(void 0===e.byteSize&&f.logger.warn("Error in consolidation: Geometry must contain byteSize."),e.byteSize+(2==r?this.geoms[0].byteSize:0))}},k.prototype={constructor:k,addContainerMesh:function(e,t,i,n,o){var s=new r.Mesh(e,t);this.meshes.push(s),this.byteSize+=e.byteSize;var a=n||0,l=a+(o||i.length);s.frustumCulled=!1;for(var h=this.meshes.length-1,c=a;c<l;c++){var u=i[c];this.fragId2MeshIndex[u]=h}},addSingleMesh:function(e,t,i,n,o){var s=new r.Mesh(e,t);s.matrix.copy(n),s.matrixAutoUpdate=!1,s.dbId=o,s.fragId=i,this.meshes.push(s),s.frustumCulled=!1,this.fragId2MeshIndex[i]=this.meshes.length-1},addSingleFragment:function(e,t){const i=e.getGeometry(t),r=e.getMaterial(t),n=e.getDbIds(t);e.getOriginalWorldMatrix(t,L),this.addSingleMesh(i,r,t,L,n)},applyAttributes:function(e,t,i,r){var n=this.meshes[e],o=n.geometry,s=this.consolidationMap,a=t.vizflags;o.attributes||(n.geometry=s._buildConsolidationGeometry(e,t),n.geometry.streamingDraw=o.streamingDraw,n.geometry.streamingIndex=o.streamingIndex,n.geometry.discardAfterUpload=o.discardAfterUpload,o=n.geometry);var l,h,c,u=s.fragOrder,d=o.numInstances,p=t.db2ThemingColor.length>0||void 0;if(d?h=(l=n.rangeStart)+n.geometry.numInstances:o.attributes.id?(l=s.ranges[e],h=e+1>=s.ranges.length?s.numConsolidated:s.ranges[e+1]):c=n.fragId,!r||void 0!==c)return o.groups&&void 0===c&&(o.groups=void 0),n.visible=D(a[void 0===c?u[l]:c],i),n.themingColor=p&&t.getThemingColor(c),n;var f,m,g=0,v=0,y=0,b=0,x=0;function _(){if(f){o.groups=o.groups||[];var e=o.groups[x]||{index:0};o.groups[x++]=e,d?(e.start=0,e.count=o.ib?o.ib.length:o.ibLength,(o.iblines||o.iblinesLength)&&(e.edgeStart=0,e.edgeCount=o.iblines?o.iblines.length:o.iblinesLength),e.instanceStart=g,e.numInstances=v-g):(e.start=g,e.count=v-g,(o.iblines||o.iblinesLength)&&(e.edgeStart=y,e.edgeCount=b-y)),e.themingColor=m}}for(var E=l;E<h;++E){var A=D(a[c=u[E]],i),S=p&&t.getThemingColor(c);if((A!==f||A&&S!==m)&&(v>g&&_(),g=v,y=b,f=A,m=S),d)v+=1;else{var w=t.getGeometry(c);v+=w.ib?w.ib.length:w.ibLength,(w.iblines||w.iblinesLength)&&(b+=w.iblines?w.iblines.length:w.iblinesLength)}}return 0===g?(n.themingColor=m,n.visible=f,n.material=Array.isArray(n.material)?n.material[0]:n.material):(n.visible=!0,_()),o.groups&&(o.groups.length=x),n},dispose:function(){for(var e={type:"dispose"},t={type:"removed"},i=0;i<this.meshes.length;i++){var r=this.meshes[i],n=r.geometry;n&&(r.dispatchEvent(t),n.dispatchEvent(e),n.needsUpdate=!0)}}},V.prototype={addGeom:function(e,t,i,r){var o=null,s=this.buckets[t.id];if(s)for(var a=0;a<s.length;a++){var l=s[a];if(F(l.geoms[0],e))if(!((0,n.getVertexCount)(e)+l.vertexCount>65535)){o=l;break}}o||(o=new I(t),this.bucketCount++,this.buckets[t.id]?this.buckets[t.id].push(o):this.buckets[t.id]=[o]),this.costs+=o.addGeom(e,i,r)},createConsolidationMap:function(e,t){var i=new U(e.length,this.bucketCount),r=0,n=0;for(var o in this.buckets)for(var s=this.buckets[o],a=0;a<s.length;a++){var l=s[a];i.ranges[n]=r,i.boxes[n]=l.worldBox,i.fragOrder.set(l.fragIds,r),r+=l.fragIds.length,n++}i.numConsolidated=t;for(var h=t;h<e.length;h++)i.fragOrder[h]=e[h];return i}},U.prototype={buildConsolidation:function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var n=e.getCount(),o=this.ranges.length,s=new k(n),a=null;r||p.createWorker&&(a=new p(s));for(var l=0;l<o;l++)this._buildConsolidationMesh(l,e,t,i,r,a,s);return a&&a.runTasks(),s.consolidationMap=this,s},_buildConsolidationMesh:function(e,t,i,r,n,o,s){var a=this.fragOrder,l=this.ranges.length,h=this.ranges[e],c=(e===l-1?this.numConsolidated:this.ranges[e+1])-h;if(1===c){const e=a[h];return void s.addSingleFragment(t,e,s)}let u=null;u=n?this._buildConsolidationPlaceholder(h,c,a,t):this._buildConsolidationGeometryImpl(e,h,c,a,t,o);var d=a[h],p=t.getMaterial(d),f=i.getMaterialVariant(p,m.MATERIAL_VARIANT.VERTEX_IDS,r);s.addContainerMesh(u,f,a,h,c)},_buildConsolidationGeometry:function(e,t,i){var r=this.fragOrder,n=this.ranges.length,o=this.ranges[e],s=(e===n-1?this.numConsolidated:this.ranges[e+1])-o;if(1!==s)return this._buildConsolidationGeometryImpl(e,o,s,r,t,i)},_buildConsolidationGeometryImpl:function(e,t,i,r,n,o){this.tmpGeoms.length=i;var s=new Float32Array(16*i),a=new Uint32Array(i);let l;for(var h=0;h<i;h++)l=r[t+h],this.tmpGeoms[h]=n.getGeometry(l),n.getOriginalWorldMatrix(l,this.tmpMatrix),s.set(this.tmpMatrix.elements,16*h),a[h]=n.getDbIds(l);var c=this.boxes[e];return N(this.tmpGeoms,s,a,c,o)},_buildConsolidationPlaceholder:function(e,t,i,r){let n=0;for(let o=0;o<t;o++){const t=i[e+o],a=r.getGeometry(t);n+=(0,s.getByteSize)(a)}return{byteSize:n,dispatchEvent:function(){}}}},k.applyBVHDefaults=function(e){e.frags_per_leaf_node=512,e.max_polys_per_node=1e5},k.getDefaultBVHOptions=function(){var e={};return k.applyBVHDefaults(e),e}},58203:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ConsolidationIterator:()=>u});var r=i(11056),n=i(63026),o=i(75050),s=i(86437),a=i(33736),l=i(70179),h=i(60489),c=i(93549);function u(e,t){var i=e,d=t,p=[],f=!1,m=[],g=[],v=new o.Matrix4,y=new o.Box3;function b(e){const t=i.matrix;t?(e.matrixWorld.copy(t),e.matrixAutoUpdate=!1):e.matrixWorld.identity()}function x(){const e=d.meshes;for(let t=0;t<e.length;t++)e[t].matrixWorldNeedsUpdate=!0}x(),this.modelMatrixChanged=function(){for(let e=0;e<m.length;e++){const t=m[e];t&&b(t)}x()},this.getConsolidation=function(){return d},this.reset=function(){p.length=null,g.length=0;var t=i.getCount(),r=a.MeshFlags.MESH_MOVED,n=a.MeshFlags.MESH_VISIBLE,o=n|a.MeshFlags.MESH_HIDE|a.MeshFlags.MESH_HIGHLIGHTED,s=i.vizflags,l=d.fragId2MeshIndex;f=!1;for(var h=i.db2ThemingColor.length>0,c=0;c<t;c++){var u=s[c];if(u&r){f=!0;break}if(u&o^n||h&&e.getThemingColor(c)){var m=l[c];g[m]=!0}}},this.dispose=function(){d.dispose()},this.consolidateNextBatch=function(e,t,r){var n=e.nodeIndex;if(f||void 0===n)return e;if(d.inProgress)return e;const a=r===l.RenderFlags.RENDER_HIDDEN?e.getBoundingBoxHidden():e.getBoundingBox(),u=t.intersectsBox(a);if(u===s.FrustumIntersector.OUTSIDE)return null;if(c.ENABLE_PIXEL_CULLING&&t.estimateProjectedDiameter(a)<t.areaCullThreshold)return null;const v=u!==s.FrustumIntersector.CONTAINS;for(var x=function(e){m[e]||(m[e]=new o.Scene,b(m[e]));var t=m[e];return t.children.length=0,t}(n),_=e.start;_<e.lastItem;_++){var E,A=e.indices?e.indices[_]:_,S=d.fragId2MeshIndex[A];if(-1===S){if(!i.hasGeometry(A))continue;return h.logger.warn("Warning: Missing fragment in consolidation. Consolidation disabled."),e}if(!p[S]&&(i.getWorldBounds(A,y),(!v||t.intersectsBox(y))&&!(c.ENABLE_PIXEL_CULLING&&t.estimateProjectedDiameter(y)<t.areaCullThreshold)&&(p[S]=!0,(E=d.applyAttributes(S,i,r,g[S])).visible))){var w=E&&E.geometry,M=w&&(w.isLines||w.isWideLines),T=w&&w.isPoints;i.linesHidden&&M||i.pointsHidden&&T||x.add(E)}}return x.boundingBox||(x.boundingBox=new o.Box3),e.getBoundingBox(x.boundingBox),x.renderImportance=e.renderImportance,x.sortObjects=e.sortObjects,e.lights&&x.children.push(e.lights),x};var _={Merged:1,Instanced:2,Original:3};function E(e){if(e){if(e.numInstances)return _.Instanced;if(e.attributes.id)return _.Merged}return _.Original}this.updateRenderProxy=function(e,t){if(e.geometry&&e.geometry.attributes){var o=function(e){if(f)return _.Original;var t=d.fragId2MeshIndex[e],i=d.meshes[t];return E(null==i?void 0:i.geometry)}(t),s=E(e.geometry);if(e.needsUpdate||s!=o){var a=i.getGeometry(t),l=d.fragId2MeshIndex[t],h=d.meshes[l];if(o===_.Original)e.geometry=a,e.material=i.getMaterial(t),i.getWorldMatrix(t,e.matrix);else if(o===_.Instanced){i.getWorldMatrix(t,v);var c=i.fragments.fragId2dbId[t],u=new n.InstanceBufferBuilder(a,1);u.addInstance(v,c),e.geometry=u.finish(),e.material=Array.isArray(h.material)?h.material[0]:h.material,e.matrix.identity()}else i.getWorldMatrix(t,v),i.getWorldBounds(t,y),c=i.fragments.fragId2dbId[t],e.geometry=(0,r.mergeGeometries)([a],v.elements,[c],y),e.material=Array.isArray(h.material)?h.material[0]:h.material,e.matrix.identity();e.needsUpdate=!1,e.dispatchEvent({type:"removed"})}}},this.clone=function(){return new u(i,d)}}},16650:(e,t,i)=>{"use strict";i.r(t),i.d(t,{consolidateFragmentList:()=>c});var r=i(11056),n=i(63026),o=i(19462),s=i(75050),a=i(93549);var l,h=(l=null,function(e,t,i,r,a,h){var c=e.getFragmentList();l||(l=new s.Matrix4);var u=i[r],d=c.getGeometry(u),p=c.getMaterial(u),f=a-r;if(1!=f){for(var m=a-1,g=new n.InstanceBufferBuilder(d,f),v=r;v<=m;v++){var y=i[v];c.getOriginalWorldMatrix(y,l);var b=c.fragments.fragId2dbId[y];if(!g.addInstance(l,b)){var x=i[m];i[m]=y,i[v]=x,--v,--m}}var _=g.finish();if(_){var E=t.getMaterialVariant(p,o.MATERIAL_VARIANT.INSTANCED,e);h.addContainerMesh(_,E,i,r,f),h.meshes[h.meshes.length-1].rangeStart=r}for(v=m+1;v<a;v++)y=i[v],h.addSingleFragment(c,y)}else h.addSingleFragment(c,u)});function c(e,t,i,n,o,l){const c=e.getFragmentList(),u=e.getGeometryList();if(i=i||a.CONSOLIDATION_MEMORY_LIMIT,!l){var d=function(e,t){for(var i=0,r=e.getCount(),n=new Int32Array(r),o=0;o<r;o++)e.hasGeometry(o)&&(n[i]=o,i++);return i<r&&(n=new Int32Array(n.buffer,n.byteOffset,i)),n.sort((function(i,r){var n=e.getGeometry(i),o=e.getGeometry(r),s=e.getGeometryId(i),a=e.getGeometryId(r),l=t.getInstanceCount(s),h=t.getInstanceCount(a),c=l*n.byteSize,u=h*o.byteSize;return c!=u?c-u:n.id!=o.id?n.id-o.id:e.getMaterialId(i)-e.getMaterialId(r)})),n}(c,u);l=function(e,t,i,n){for(var o=new s.Box3,a=new r.ConsolidationBuilder,l=0;l<i.length&&!(a.costs>=n);l++){var h=i[l];e.getWorldBounds(h,o);var c=e.getGeometry(h),u=e.getMaterial(h);a.addGeom(c,u,o,h)}return a.createConsolidationMap(i,l)}(c,0,d,i)}var p=l.buildConsolidation(c,t,e,n);!function(e,t,i,r,n){var o=e.getFragmentList();if(!(r>=i.length)){for(var s=r,a=-1,l=-1,c=r;c<i.length;c++){var u=i[c],d=o.getGeometryId(u),p=o.getMaterialId(u);d==a&&p==l||(c!=r&&h(e,t,i,s,c,n),s=c,a=d,l=p)}h(e,t,i,s,i.length,n)}}(e,t,l.fragOrder,l.numConsolidated,p);for(var f=e.getModelId(),m=0;m<p.meshes.length;m++){p.meshes[m].modelId=f}return p}},96199:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GeomMergeTask:()=>n,writeIdToBuffer:()=>s});var r=1;function n(){this.vb=null,this.vbstride=0,this.posOffset=0,this.normalOffset=0,this.matrices=null,this.ranges=null,this.dbIds=null,this.id=r++}function o(e){e.x=.5*(1+Math.atan2(e.y,e.x)/Math.PI),e.y=.5*(1+e.z),e.z=0}function s(e,t,i){t[i++]=255&e,t[i++]=e>>8&255,t[i++]=e>>16&255,t[i]=0}var a=function(e,t,i,r,n,s,a){for(var l,h,c,u,d,p,f,m=e.posOffset,g=r;g<n;g++){var v=g*e.vbstride+m;a.set(e.vb[v],e.vb[v+1],e.vb[v+2]),a.applyMatrix4(i),e.vb[v]=a.x,e.vb[v+1]=a.y,e.vb[v+2]=a.z}if(-1!==e.normalOffset){var y=2*e.vbstride,b=2*e.normalOffset,x=function(e,t){return t.copy(e),t[12]=0,t[13]=0,t[14]=0,t.invert().transpose()}(i,s);for(g=r;g<n;g++){var _=g*y+b;a.set(t[_],t[_+1],0),a.divideScalar(65535),h=void 0,c=void 0,u=void 0,d=void 0,p=void 0,f=void 0,h=2*(l=a).x-1,c=2*l.y-1,u=Math.sin(h*Math.PI),d=Math.cos(h*Math.PI),p=Math.sqrt(1-c*c),f=c,l.x=d*p,l.y=u*p,l.z=f,a.applyMatrix4(x),a.normalize(),o(a),a.multiplyScalar(65535),t[_]=a.x,t[_+1]=a.y}}};function l(e,t,i){for(var r=16*e,n=0;n<16;n++)i.elements[n]=t[n+r]}n.prototype.run=function(e,t){for(var i=this.vb,r=i.length/this.vbstride,n=e.clone(),o=new Uint8Array(3*r),h=-1!==this.normalOffset?new Uint16Array(i.buffer,i.byteOffset,2*i.length):null,c=this.ranges,u=this.matrices,d=c.length-1,p=0;p<d;p++){var f=c[p],m=c[p+1];l(p,u,e),a(this,h,e,f,m,n,t);for(var g=3*f,v=m-f,y=this.dbIds[p],b=0;b<v;b++)s(y,o,g),g+=3}return{taskId:this.id,vb:this.vb,vertexIds:o}}},63026:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InstanceBufferBuilder:()=>l});var r=i(11056),n=i(96199),o=i(86945),s=i(60489),a=i(75050);function l(e,t){const i=(0,o.createBufferGeometry)(!0);i.ib=e.ib,i.vb=e.vb,i.iblines=e.iblines,(0,r.copyVertexFormat)(e,i),(0,r.copyPrimitiveProps)(e,i);this.offsets=new Float32Array(3*t),this.rotations=new Float32Array(4*t),this.scalings=new Float32Array(3*t),this.ids=new Uint8Array(3*t);var l=new a.Vector3,h=new a.Quaternion,c=new a.Vector3,u=new a.Matrix4,d=0,p=t;this.addInstance=function(e,t){return d>=p?(s.logger.warn("Instance buffer is already full."),!1):(e.decompose(l,h,c),!!function(e,t,i,r){u.compose(t,i,r);for(var n=e.elements,o=u.elements,s=0;s<16;s++){var a=n[s],l=o[s];if(Math.abs(l-a)>1e-4*Math.max(1,Math.min(Math.abs(a),Math.abs(l))))return!1}return!0}(e,l,h,c)&&(this.offsets[3*d]=l.x,this.offsets[3*d+1]=l.y,this.offsets[3*d+2]=l.z,this.rotations[4*d]=h.x,this.rotations[4*d+1]=h.y,this.rotations[4*d+2]=h.z,this.rotations[4*d+3]=h.w,this.scalings[3*d]=c.x,this.scalings[3*d+1]=c.y,this.scalings[3*d+2]=c.z,(0,n.writeIdToBuffer)(t,this.ids,3*d),d++,!0))},this.finish=function(){if(0==d)return null;let e,t,r,n;return d<p&&(this.offsets=new Float32Array(this.offsets.buffer,0,3*d),this.rotations=new Float32Array(this.rotations.buffer,0,4*d),this.scalings=new Float32Array(this.scalings.buffer,0,3*d),this.ids=new Uint8Array(this.ids.buffer,0,3*d)),e=new a.BufferAttribute(this.offsets,3),t=new a.BufferAttribute(this.rotations,4),r=new a.BufferAttribute(this.scalings,3),n=new a.BufferAttribute(this.ids,3),n.normalized=!0,n.bytesPerItem=1,e.divisor=1,t.divisor=1,r.divisor=1,n.divisor=1,i.setAttribute("instOffset",e),i.setAttribute("instRotation",t),i.setAttribute("instScaling",r),i.setAttribute("id",n),i.numInstances=d,i.byteSize=i.vb.byteLength+i.ib.byteLength+this.offsets.byteLength+this.rotations.byteLength+this.scalings.byteLength,i}}},44434:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ModelIteratorTexQuad:()=>w,TexQuadConfig:()=>S});var r=i(7247),n=i(40841),o=i(44225),s=i(194),a=i(75050);function l(){this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1}function h(){var e=[],t=0;const i=new l;function r(e,t){var r=t||i;const n=[r.offsetX,r.offsetY,r.offsetX+r.scaleX,r.offsetY,r.offsetX+r.scaleX,r.offsetY+r.scaleY,r.offsetX,r.offsetY+r.scaleY],o=e.getAttribute("uv");if(o){for(let e=0;e<n.length;e+=2){const t=e/2;o.setXY(t,n[e],n[e+1])}o.needsUpdate=!0}else e.setAttribute("uv",new a.BufferAttribute(new Float32Array(n),2))}this.acquireQuadGeom=function(i){var n=e[t];return n?r(n,i):(n=this.createQuadGeom(i),e[t]=n),t++,n},this.createQuadGeom=function(e){var t=new a.BufferGeometry;return t.setAttribute("position",new a.BufferAttribute(new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0]),3)),t.setIndex([0,1,2,0,2,3]),t.computeVertexNormals(),r(t,e),t},this.reset=function(){t=0},this.dispose=function(){for(var t=0;t<e.length;t++){var i=e[t];i&&(i.dispose(),i.needsUpdate=!0)}e=[]}}l.prototype.toVec4=function(){return new a.Vector4(this.offsetX,this.offsetY,this.scaleX,this.scaleY)},l.prototype.copyTo=function(e){e.offsetX=this.offsetX,e.offsetY=this.offsetY,e.scaleX=this.scaleX,e.scaleY=this.scaleY};var c=i(60489),u=i(37765),d=i(92217),p=i(34722),f=i.n(p),m=i(13518),g=i.n(m),v=i(77221);let y={uniforms:a.UniformsUtils.merge([a.UniformsLib.common,v.ShaderChunks.CutPlanesUniforms,v.ShaderChunks.IdUniforms,v.ShaderChunks.ThemingUniform,{selectionColor:{type:"v4",value:new a.Vector4(0,0,1,0)},viewportBounds:{type:"v4",value:new a.Vector4(0,0,1,1)},modelLocalMatrix:{type:"m4",value:new a.Matrix4}}]),vertexShader:f(),fragmentShader:g()};var b=0,x=1,_=2;const E=(0,r.getGlobal)().document;var A=function(e,t){this.timeStamps=e,this.mesh=t,this.state=b};function S(){this.urlPattern=null,this.tileSize=null,this.maxLevel=null,this.skippedLevels=[],this.textureLoader=null,this.texWidth=0,this.texHeight=0,this.maxActiveTiles=(0,r.isMobileDevice)()?0:400,this.cacheSize=(0,r.isMobileDevice)()?0:150,this.onRootLoaded=null,this.levelOffset=0,this.getRootTileSize=function(){return 1*(this.tileSize<<this.maxLevel)},this.getQuadWidth=function(){return this.scale*this.texWidth/this.getRootTileSize()},this.getQuadHeight=function(){return this.scale*this.texHeight/this.getRootTileSize()},this.getPageToModelTransform=function(e,t){var i=e/this.getQuadWidth(),r=t/this.getQuadHeight();return new s.LmvMatrix4(!0).set(i,0,0,0,0,r,0,0,0,0,1,0,0,0,0,1)},this.getBBox=function(){var e=this.getQuadWidth(),t=this.getQuadHeight();if(this.fitPaperSize)return new a.Box3(new a.Vector3,new a.Vector3(e,t,0));var i=1-t;return new a.Box3(new a.Vector3(0,i,0),new a.Vector3(e,1,0))},this.valid=function(){return"string"==typeof this.urlPattern&&this.urlPattern.length>0&&"number"==typeof this.tileSize&&this.tileSize>0&&"number"==typeof this.maxLevel&&this.maxLevel>0&&"number"==typeof this.texWidth&&this.texWidth>0&&"number"==typeof this.texHeight&&this.texHeight>0},this.initForSimpleImage=function(e){this.urlPattern=decodeURIComponent(e),this.maxLevel=0,this.levelOffset=0,this.scale=1,this.tileSize=-1,this.texWidth=-1,this.texHeight=-1,this.isSimpleImage=!0},this.isLevelPresent=function(e){return!this.skippedLevels[e]},this.initFromLoadOptions=function(e,t,i,r){if(this.urlPattern=decodeURIComponent(e),this.textureLoader=i,this.options=r,t){this.tileSize=t.tileSize,this.maxLevel=(n=t.texWidth,o=t.texHeight,s=t.tileSize,a=Math.ceil(Math.log2(n)),l=Math.ceil(Math.log2(o)),Math.max(a,l)-Math.log2(s)),this.texWidth=t.texWidth,this.texHeight=t.texHeight,this.levelOffset=t.levelOffset,this.zips=t.zips;const e=!(!t.paperWidth||!t.paperHeight);this.fitPaperSize=t.fitPaperSize&&e,this.paperHeight=t.paperHeight,this.scale=this.fitPaperSize?t.paperWidth*this.getRootTileSize()/this.texWidth:1,this.skippedLevels=function(e){var t=[];if(e.zips){i=(i=(i=(i=e.urlPattern.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/\\{x\\}/,"[0-9]+")).replace(/\\{y\\}/,"[0-9]+")).replace(/\\{z\\}/,"([0-9]+)");var i=new RegExp("^"+i+"$");t.length=e.maxLevel+1,t.fill(!0);var r=0;e.zips.forEach((function(n){Object.keys(n.fileTable).forEach((function(n){var o=i.exec(n);if(o&&o[1]){var s=parseInt(o[1])-e.levelOffset;s>=0&&s<=e.maxLevel&&(t[s]=!1,++r)}}))})),0===r&&(t.length=0,c.logger.info("No leaflet levels found - assume all are present"))}return t}(this),"number"==typeof t.maxLevel&&function(e,t,i){for(;i>0&&e.skippedLevels[i];)--i;var r=t-i;r>0&&(e.texWidth>>=r,e.texHeight>>=r,e.maxLevel=i)}(this,this.maxLevel,t.maxLevel),this.maxActiveTiles=t.maxActiveTiles||this.maxActiveTiles,this.cacheSize=t.cacheSize||this.cacheSize}else this.options&&(this.options.loadOptions={});var n,o,s,a,l}}function w(e,t){this.isModelIteratorTexQuad=!0;var i=e,r=1,s=e.getBBox(),c=[];let p=null,f=null;const m=new a.Matrix4,g=new a.Matrix4,v=new a.Matrix4,S=new a.Vector3,w=new a.Quaternion,M=new a.Vector3,T=new Autodesk.Viewing.Private.FrustumIntersector;let C,P=1,D=1;const L=new a.Vector4(0,0,0,0),I=(new a.Vector4).copy(L);let R=0;var O=t,N=null,F=!1,k=!1,V=!1,U=new a.Color,B=[],G=[],z=[];this.registerView=function(){var e=c.indexOf(void 0);-1===e&&(e=c.length);var t=new a.Scene;return t.ignoreFadeMaterial=!0,i.placementTransform&&t.matrix.copy(i.placementTransform),t.matrixAutoUpdate=!1,c[e]=t,z[e]=0,B[e]=!0,e},this.registerView();var H=0,W=0,j=!1,q=[],X=null,Y=!1,K=new h;function Q(e){var t=i.maxLevel-e;return i.texWidth>>t}function Z(e){var t=i.maxLevel-e;return i.texHeight>>t}function J(e){var t=Q(e.level),r=Z(e.level),n=e.x*i.tileSize,o=e.y*i.tileSize;return n>=t||o>=r}function $(e){var t=Q(e.level),r=Z(e.level),n=e.x*i.tileSize,o=e.y*i.tileSize,s=Math.max(0,Math.min(i.tileSize,t-n)),l=Math.max(0,Math.min(i.tileSize,r-o)),h=1*i.tileSize;return new a.Vector2(s/h,l/h)}function ee(e){return i.scale/(1<<e)}function te(e){return ee(e.level)*e.x*r}function ie(e){var t=ee(e.level);return(i.fitPaperSize?i.paperHeight:1)-(e.y+1)*t*r}function re(e){return G[(0,n.tile2Index)(e)]}function ne(e){var t=re(e);return t instanceof A&&t.state===_}function oe(e,t,i){var n;if(t)X||(X=K.createQuadGeom()),n=X;else{var o=function(e,t){for(var i=e.getParent();i;){var r=re(i),n=r&&r.state===_;if(n&&t&&r.mesh.material.map.needsUpdate&&i.level>0&&(n=!1),n)break;i=i.getParent()}return i}(e);t=he(o).material;var s=function(e,t){var i=1<<e.level-t.level,r=1/i,n=r,o=$(t);r/=o.x,n/=o.y;var s=t.x*i,a=t.y*i,h=e.x-s,c=e.y-a,u=$(e);h*=r,c=1-(c*=n)-n*u.y;var d=new l;return d.offsetX=h,d.offsetY=c,d.scaleX=r*u.x,d.scaleY=n*u.y,d}(e,o);n=K.acquireQuadGeom(s)}var h=new a.Mesh(n,t);h.tile=e,h.modelId=R,h.themingColor=I;var c=ee(e.level),u=$(e),d=(1-u.y)*c*r,p=te(e),f=ie(e);return h.position.set(p,f+d,0),h.scale.set(c*u.x*r,c*u.y*r,1),t.uniforms.offsetRepeat.value.set(t.map.offset.x,t.map.offset.y,t.map.repeat.x,t.map.repeat.y),h}this.setAggressivePrefetching=function(e){Y=e},this.getScene=function(e){return c[e=e||0]},this.getModelMatrix=function(){return p},this.getInverseModelMatrix=function(){return p?(f||(f=p.clone().invert()),f):null},this.setModelMatrix=function(e){e?(p=p||new a.Matrix4,p.copy(e)):p=null,f=null},this.nextBatch=function(e){return B[e=e||0]?null:(B[e]=!0,c[0].renderImportance=k?-1:void 0,c[0])},this.getSceneCount=function(){return 1},this.done=function(e){return B[e||0]},this.rayCast=function(e,t){return null},this.getVisibleBounds=function(e,t){let r=s;N&&(r=r.clone().intersect(N)),e&&(e.copy(r),i.placementTransform&&e.applyMatrix4(i.placementTransform),p&&e.applyMatrix4(p)),t&&(t.copy(r),i.placementTransform&&t.applyMatrix4(i.placementTransform),p&&t.applyMatrix4(p))},this.setViewBounds=function(e){N=e,O.setViewportBoundsForModel(R,N)},this.getViewBounds=function(){return N},this.setDoNotCut=function(e){return F=e},this.getDoNotCut=function(){return F};var se=function(e){for(var t=e.image,i=1;(i*=2)<t.width;);for(var r=1;(r*=2)<t.height;);if(i!==t.width||r!==t.height){var n=E.createElement("canvas");n.width=i,n.height=r;var o=n.getContext("2d");o.drawImage(t,0,0);var s,a,l=o.getImageData(0,0,i,r),h=new Uint32Array(l.data.buffer,0,i*r);if(t.height<r){var c=t.height*i;for(s=t.height;s<r;++s,c+=i)for(a=0;a<t.width;++a)h[c+a]=h[c+a-i]}if(t.width<i){var u=0;for(s=0;s<r;++s,u+=i)for(a=t.width;a<i;++a)h[u+a]=h[u+a-1]}o.putImageData(l,0,0),e.image=n,e.flipY&&e.offset.set(0,1-t.height/r),e.repeat.set(t.width/i,t.height/r)}},ae=this;function le(t){var r=(0,n.tile2Index)(t),o=G[r];if(!o||o.state===b){o||(o=new A(z.slice()),G[r]=o),o.state=x;var l=function(e){var t=i.levelOffset?i.levelOffset:0;return i.urlPattern.replace("{x}",e.x).replace("{y}",e.y).replace("{z}",e.level+t)}(t);W++,i.textureLoader(l,(function(r,n){!function(r){if(!ae||!r)return;0===i.maxLevel&&(-1===i.texWidth&&(i.texWidth=r.image.width),-1===i.texHeight&&(i.texHeight=r.image.height),-1===i.tileSize&&(i.tileSize=Math.max(r.image.width,r.image.height)),i.options&&(i.options.loadOptions.texWidth=i.texWidth,i.options.loadOptions.texHeight=i.texHeight),s=e.getBBox()),se(r),r.minFilter=a.LinearMipMapLinearFilter,r.magFilter=a.LinearFilter,r.anisotropy=Math.min(4,Math.max(i.maxAnisotropy,1));const n=(0,d.createShaderMaterial)(y);n.supportsMrtNormals=!0,n.supportsViewportBounds=!0,n.map=n.uniforms.map.value=r,n.side=a.DoubleSide,n.doNotCut=ae.getDoNotCut(),n.tile=t,n.disableEnvMap=!0,-1!==l.toLowerCase().indexOf(".png")&&(n.transparent=!0,n.alphaTest=.01);var h=oe(t,n);o.mesh=h,o.state=_,W--,j=!0;var c=r&&r.image?r.image.src:null;c&&a.Cache&&a.Cache.get(c)&&a.Cache.remove(c),0===t.level&&i.onRootLoaded&&(R=i.onRootLoaded()),h.themingColor=I,h.modelId=R,n.name=`model:${R}|${l}`,O.addMaterial(n.name,n,!0),O.setMaterialViewportBounds(n,N),ae._updateMaterialVisibility(n),ae._updateMaterialSelection(n)}(r)}),(function(e){i.onDone(e,null),console.error(e)}))}}function he(e){var t=(0,n.tile2Index)(e),i=G[t];return i&&i.state===_?i.mesh:null}function ce(e,t){var i=te(e)*P,r=ie(e)*D;t.set(i,r,0)}function ue(e,t){var i=ee(e.level),r=(te(e)+i)*P,n=(ie(e)+i)*D;t.set(r,n,0)}this.requestRootTile=function(){le(new n.TileCoords(0,0,0))};var de,pe,fe,me=(de=new a.Vector3,pe=new a.Vector3,fe=new a.Box3,function(e,t){return ce(e,de),ue(e,pe),fe.set(de,pe),t.intersectsBox(fe)>0}),ge=function(){var e=new a.Vector3,t=new a.Vector3;return function(i,r,n){var o=ee(i.level);ce(i,e),ue(i,t);var s=u.SceneMath.pointToMinMaxBoxDistance2(n,e,t);return(me(i,r)?100:1)*(o*o)/(s=Math.max(s,1e-4))}}(),ve=function(){const e=new a.Vector3,t=new a.Vector3;return function(r,n,o){ce(r,e),ue(r,t);const s=Math.abs(function(e,t,i,r){var n=e.clone();return n.max(i),n.min(r),n.sub(e).dot(t)}(n.position,o,e,t)),a=i.getPixelRatio(),l=n.pixelsPerUnitAtDistance(s)*a;return(t.y-e.y)*l}}();function ye(e,t){this.tile=e,this.prio=t}function be(e,t){return e.prio>t.prio}function xe(e,t){var i=G[(0,n.tile2Index)(e)];i&&i.timeStamps[t]!==z[t]&&(i.timeStamps[t]=z[t],H++)}function _e(e,t,i){e.sort((function(e,r){var n=ge(e,t,i);return ge(r,t,i)-n}));for(var r=0,n=0;n<e.length;n++){var o=re(e[n]);if(!o||o.state!==x){if(W>=5)break;le(e[n]),r++}}return r}function Ee(e){if(e&&e.mesh&&e.mesh.material){var t=e.mesh.material;O.removeMaterial(t.name),t.map.dispose(),t.map.needsUpdate=!0;t.dispatchEvent({type:"dispose"}),t.needsUpdate=!0}}function Ae(e){for(var t=0;t<z.length;t++){if(!!c[t]&&e.timeStamps[t]===z[t])return!0}return!1}this.dispose=function(){var e;for(e in G)Ee(G[e]);X&&(X.dispose(),X.needsUpdate=!0),K.dispose()},this.dtor=function(){this.dispose(),ae=null,O=null},this.reset=function(e,t,r){const s=(r=r||0)>0,l=c[r];var h,u;for(({camera:t,frustum:e}=function(e,t,i){const r=e.matrixWorld;if(p?r.multiplyMatrices(p,e.matrix):r.copy(e.matrix),r.equals(v))P=1,D=1;else{r.decompose(S,w,M),m.makeRotationFromQuaternion(w),m.setPosition(S),P=M.x,D=M.y,C=i.clone(C),g.copy(m).invert(),C.transformCurrentView(g),C.updateCameraMatrices();const e=t.cutPlanes,n=t.areaCullThreshold;(t=T).areaCullThreshold=n,t.reset(C,e),i=C}return{camera:i,frustum:t}}(l,e,t)),h=0;h<l.children.length;h++){l.children[h].dispatchEvent({type:"removed"})}if(l.children.length=0,z[r]++,H=0,K.reset(),!ne(new n.TileCoords(0,0,0)))return B[r]=!0,!1;var d=new o.SortedList(be),f=new n.TileCoords(0,0,0),y=ge(f,e,t.position);d.add(new ye(f,y));for(var b=t.getWorldDirection(new a.Vector3),x=[],E=[],A=[];d.size()>0;){if(u=d.get(0).tile,d.removeAt(0),J(u))continue;var L=!0;u.level===i.maxLevel&&(L=!1);ve(u,t,b)<i.tileSize&&i.isLevelPresent(u.level)&&(L=!1);var I=me(u,e);if(I&&(!ne(u)&&i.isLevelPresent(u.level)&&A.push(u),xe(u,r)),!I&&x.length+E.length>i.maxActiveTiles&&(L=!1),L)for(let i=0;i<4;i++){const r=u.getChild(i);y=ge(r,e,t.position),d.add(new ye(r,y))}else I?x.push(u):E.push(u)}var R=0;j=!1;var O=!0;for(h=0;h<x.length;++h){var N=he(u=x[h]);N&&N.material.map.needsUpdate&&!Y&&(R<5||s?R++:(N=oe(u,null),j=!0,O=!1)),N||(N=oe(u,null),O=!1),l.add(N)}B[r]=!1;var F=_e(A,e,t.position);H+=W;var k=[];for(h=0;h<E.length&&!(H>=i.maxActiveTiles);h++)if(ne(u=E[h]))for(let e=0;e<=u.level;e++){if(xe(u.getParentAtLevel(e),r),H>i.maxActiveTiles)break}else k.push(u),H++;if(F+=_e(k,e,t.position),Y){for(k=[],h=0;h<x.length;++h)if((u=x[h]).level!==i.maxLevel&&i.isLevelPresent(u.level+1))for(let t=0;t<4;t++){const i=u.getChild(t);!J(i)&&me(i,e)&&(ne(i)||(k.push(i),H++))}F+=_e(k,e,t.position)}if(s||function(e,t,r){var o=Object.keys(G),s=o.length,a=e-(i.cacheSize-s);if(!(a<=0)){o.sort((function(e,i){var o=G[e].timeStamps[0],s=G[i].timeStamps[0];if(o!==s)return o-s;var a=(0,n.index2Tile)(e),l=(0,n.index2Tile)(i);return ge(a,t,r)-ge(l,t,r)}));for(var l=Math.min(a,o.length),h=0;h<l;h++){var c=o[h];if(0!==(0,n.index2Tile)(c).level){var u=G[c];if(u.state===_){if(Ae(u))break;Ee(u),delete G[c]}}}}}(F,e,t.position),O&&q.length>0){var V=q.splice(0,q.length);setTimeout((function(){for(var e=0;e<V.length;e++)V[e](r)}),1)}return O},this.callWhenRefined=function(e){q.push(e)},this.update=function(){return j},this.setDpiScale=function(e){r=e},this.getDpiScale=function(){return r},this.setThemingColor=function(e){I.copy(e)},this.clearThemingColor=function(){I.copy(L)},this.unregisterView=function(e){c[e]=void 0,z[e]=void 0,B[e]=void 0;for(var t=c.length;t>0&&!c[t-1];)t--;c.length=t,z.length=t,B.length=t},this._updateMaterialVisibility=function(e){!e.defines.GHOSTED^!k&&(k?e.defines.GHOSTED=1:delete e.defines.GHOSTED,e.needsUpdate=!0)},this.setVisibility=function(e){k=!e,O.forEachInModel(R,!1,(e=>{this._updateMaterialVisibility(e)}))},this._updateMaterialSelection=function(e){e.uniforms.selectionColor.value.set(U.r,U.g,U.b,V?.6:0)},this.highlightSelection=function(e){V=e,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U,O.forEachInModel(R,!1,(e=>{this._updateMaterialSelection(e)}))}}},40841:(e,t,i)=>{"use strict";function r(e,t,i){this.level=e,this.x=t,this.y=i}function n(e){var t=((1<<2*e.level)-1)/3,i=1<<e.level;return t+e.y*i+e.x}function o(e){for(var t=new r(0,0,0);n(t)<=e;)t.level++;t.level--;var i=e-n(t),o=1<<t.level;return t.y=Math.floor(i/o),t.x=i%o,t}i.r(t),i.d(t,{TileCoords:()=>r,index2Tile:()=>o,tile2Index:()=>n}),r.prototype={constructor:r,copy:function(){return new r(this.level,this.x,this.y)},isValid:function(){return Number.isInteger(this.level)&&this.level>=0&&Number.isInteger(this.x)&&Number.isInteger(this.y)},getChild:function(e){var t=1&e?1:0,i=2&e?1:0;return new r(this.level+1,2*this.x+t,2*this.y+i)},getParent:function(){return 0===this.level?null:new r(this.level-1,Math.floor(this.x/2),Math.floor(this.y/2))},getParentAtLevel:function(e){if(e<0||e>this.level)return null;var t=this.level-e;return new r(e,Math.floor(this.x>>t),Math.floor(this.y>>t))},toString:function(){return"("+this.level+", "+this.x+", "+this.y+")"},equals:function(e,t,i){return e instanceof r?this.equals(e.level,e.x,e.y):this.level===e&&this.x===t&&this.y===i}}},79058:(e,t,i)=>{var r;
/*! Hammer.JS - v2.0.8 - 2016-04-23
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */!function(n,o,s,a){"use strict";var l=["","webkit","Moz","MS","ms","o"],h=o.createElement("div"),c="function",u=Math.round,d=Math.abs,p=Date.now;function f(e,t,i){return setTimeout(E(e,i),t)}function m(e,t,i){return!!Array.isArray(e)&&(g(e,i[t],i),!0)}function g(e,t,i){var r;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==a)for(r=0;r<e.length;)t.call(i,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(i,e[r],r,e)}function v(e,t,i){var r="DEPRECATED METHOD: "+t+"\n"+i+" AT \n";return function(){var t=new Error("get-stack-trace"),i=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=n.console&&(n.console.warn||n.console.log);return o&&o.call(n.console,r,i),e.apply(this,arguments)}}var y=function(e){if(e===a||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==a&&null!==r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=Array.isArray(r[n])?r[n].slice(0):r[n])}return t},b=v((function(e,t,i){for(var r=Object.keys(t),n=0;n<r.length;)(!i||i&&e[r[n]]===a)&&(e[r[n]]=t[r[n]]),n++;return e}),"extend","Use `assign`."),x=v((function(e,t){return b(e,t,!0)}),"merge","Use `assign`.");function _(e,t,i){var r,n=t.prototype;(r=e.prototype=Object.create(n)).constructor=e,r._super=n,i&&y(r,i)}function E(e,t){return function(){return e.apply(t,arguments)}}function A(e,t){return typeof e==c?e.apply(t&&t[0]||a,t):e}function S(e,t){return e===a?t:e}function w(e,t,i){g(P(t),(function(t){e.addEventListener(t,i,!1)}))}function M(e,t,i){g(P(t),(function(t){e.removeEventListener(t,i,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function C(e,t){return e.indexOf(t)>-1}function P(e){return e.trim().split(/\s+/g)}function D(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var r=0;r<e.length;){if(i&&e[r][i]==t||!i&&e[r]===t)return r;r++}return-1}function L(e){return Array.prototype.slice.call(e,0)}function I(e,t,i){for(var r=[],n=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];D(n,s)<0&&r.push(e[o]),n[o]=s,o++}return i&&(r=t?r.sort((function(e,i){return e[t]>i[t]})):r.sort()),r}function R(e,t){for(var i,r,n=t[0].toUpperCase()+t.slice(1),o=0;o<l.length;){if((r=(i=l[o])?i+n:t)in e)return r;o++}return a}var O=1;function N(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||n}var F="ontouchstart"in n,k=R(n,"PointerEvent")!==a,V=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),U="touch",B="mouse",G=25,z=1,H=4,W=8,j=1,q=2,X=4,Y=8,K=16,Q=q|X,Z=Y|K,J=Q|Z,$=["x","y"],ee=["clientX","clientY"];function te(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){A(e.options.enable,[e])&&i.handler(t)},this.init()}function ie(e,t,i){var r=i.pointers.length,n=i.changedPointers.length,o=t&z&&r-n==0,s=t&(H|W)&&r-n==0;i.isFirst=!!o,i.isFinal=!!s,o&&(e.session={}),i.eventType=t,function(e,t){var i=e.session,r=t.pointers,n=r.length;i.firstInput||(i.firstInput=re(t));n>1&&!i.firstMultiple?i.firstMultiple=re(t):1===n&&(i.firstMultiple=!1);var o=i.firstInput,s=i.firstMultiple,l=s?s.center:o.center,h=t.center=ne(r);t.timeStamp=p(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=le(l,h),t.distance=ae(l,h),function(e,t){var i=t.center,r=e.offsetDelta||{},n=e.prevDelta||{},o=e.prevInput||{};t.eventType!==z&&o.eventType!==H||(n=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:i.x,y:i.y});t.deltaX=n.x+(i.x-r.x),t.deltaY=n.y+(i.y-r.y)}(i,t),t.offsetDirection=se(t.deltaX,t.deltaY);var c=oe(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=d(c.x)>d(c.y)?c.x:c.y,t.scale=s?(u=s.pointers,f=r,ae(f[0],f[1],ee)/ae(u[0],u[1],ee)):1,t.rotation=s?function(e,t){return le(t[1],t[0],ee)-le(e[1],e[0],ee)}(s.pointers,r):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length,function(e,t){var i,r,n,o,s=e.lastInterval||t,l=t.timeStamp-s.timeStamp;if(t.eventType!=W&&(l>G||s.velocity===a)){var h=t.deltaX-s.deltaX,c=t.deltaY-s.deltaY,u=oe(l,h,c);r=u.x,n=u.y,i=d(u.x)>d(u.y)?u.x:u.y,o=se(h,c),e.lastInterval=t}else i=s.velocity,r=s.velocityX,n=s.velocityY,o=s.direction;t.velocity=i,t.velocityX=r,t.velocityY=n,t.direction=o}(i,t);var u,f;var m=e.element;T(t.srcEvent.target,m)&&(m=t.srcEvent.target);t.target=m}(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function re(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:u(e.pointers[i].clientX),clientY:u(e.pointers[i].clientY)},i++;return{timeStamp:p(),pointers:t,center:ne(t),deltaX:e.deltaX,deltaY:e.deltaY}}function ne(e){var t=e.length;if(1===t)return{x:u(e[0].clientX),y:u(e[0].clientY)};for(var i=0,r=0,n=0;n<t;)i+=e[n].clientX,r+=e[n].clientY,n++;return{x:u(i/t),y:u(r/t)}}function oe(e,t,i){return{x:t/e||0,y:i/e||0}}function se(e,t){return e===t?j:d(e)>=d(t)?e<0?q:X:t<0?Y:K}function ae(e,t,i){i||(i=$);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return Math.sqrt(r*r+n*n)}function le(e,t,i){i||(i=$);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return 180*Math.atan2(n,r)/Math.PI}te.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(N(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(N(this.element),this.evWin,this.domHandler)}};var he={mousedown:z,mousemove:2,mouseup:H},ce="mousedown",ue="mousemove mouseup";function de(){this.evEl=ce,this.evWin=ue,this.pressed=!1,te.apply(this,arguments)}_(de,te,{handler:function(e){var t=he[e.type];t&z&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=H),this.pressed&&(t&H&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:B,srcEvent:e}))}});var pe={pointerdown:z,pointermove:2,pointerup:H,pointercancel:W,pointerout:W},fe={2:U,3:"pen",4:B,5:"kinect"},me="pointerdown",ge="pointermove pointerup pointercancel";function ve(){this.evEl=me,this.evWin=ge,te.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}n.MSPointerEvent&&!n.PointerEvent&&(me="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel"),_(ve,te,{handler:function(e){var t=this.store,i=!1,r=e.type.toLowerCase().replace("ms",""),n=pe[r],o=fe[e.pointerType]||e.pointerType,s=o===U,a=o===B,l=D(t,e.pointerId,"pointerId");n&z&&(0===e.button||s)?l<0&&(t.push(e),l=t.length-1):n&(H|W)&&(i=!0),l<0||(t[l]=e,a&&!this.manager.options.handlePointerEventMouse||this.callback(this.manager,n,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),i&&t.splice(l,1))}});var ye={touchstart:z,touchmove:2,touchend:H,touchcancel:W};function be(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,te.apply(this,arguments)}function xe(e,t){var i=L(e.touches),r=L(e.changedTouches);return t&(H|W)&&(i=I(i.concat(r),"identifier",!0)),[i,r]}_(be,te,{handler:function(e){var t=ye[e.type];if(t===z&&(this.started=!0),this.started){var i=xe.call(this,e,t);t&(H|W)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:U,srcEvent:e})}}});var _e={touchstart:z,touchmove:2,touchend:H,touchcancel:W},Ee="touchstart touchmove touchend touchcancel";function Ae(){this.evTarget=Ee,this.targetIds={},te.apply(this,arguments)}function Se(e,t){var i=L(e.touches),r=this.targetIds;if(t&(2|z)&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,o,s=L(e.changedTouches),a=[],l=this.target;if(o=i.filter((function(e){return T(e.target,l)})),t===z)for(n=0;n<o.length;)r[o[n].identifier]=!0,n++;for(n=0;n<s.length;)r[s[n].identifier]&&a.push(s[n]),t&(H|W)&&delete r[s[n].identifier],n++;return a.length?[I(o.concat(a),"identifier",!0),a]:void 0}_(Ae,te,{handler:function(e){var t=_e[e.type],i=Se.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:U,srcEvent:e})}});var we=2500;function Me(){te.apply(this,arguments);var e=E(this.handler,this);this.touch=new Ae(this.manager,e),this.mouse=new de(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Te(e,t){e&z?(this.primaryTouch=t.changedPointers[0].identifier,Ce.call(this,t)):e&(H|W)&&Ce.call(this,t)}function Ce(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var i={x:t.clientX,y:t.clientY};this.lastTouches.push(i);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(i);e>-1&&r.splice(e,1)}),we)}}function Pe(e){for(var t=e.srcEvent.clientX,i=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var n=this.lastTouches[r],o=Math.abs(t-n.x),s=Math.abs(i-n.y);if(o<=25&&s<=25)return!0}return!1}_(Me,te,{handler:function(e,t,i){var r=i.pointerType==U,n=i.pointerType==B;if(!(n&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(r)Te.call(this,t,i);else if(n&&Pe.call(this,i))return;this.callback(e,t,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var De=R(h.style,"touchAction"),Le=De!==a,Ie="compute",Re="auto",Oe="manipulation",Ne="none",Fe="pan-x",ke="pan-y",Ve=function(){if(!Le)return!1;var e={},t=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(i){e[i]=!t||n.CSS.supports("touch-action",i)})),e}();function Ue(e,t){this.manager=e,this.set(t)}Ue.prototype={set:function(e){e==Ie&&(e=this.compute()),Le&&this.manager.element.style&&Ve[e]&&(this.manager.element.style[De]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){A(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(C(e,Ne))return Ne;var t=C(e,Fe),i=C(e,ke);if(t&&i)return Ne;if(t||i)return t?Fe:ke;if(C(e,Oe))return Oe;return Re}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,n=C(r,Ne)&&!Ve[Ne],o=C(r,ke)&&!Ve[ke],s=C(r,Fe)&&!Ve[Fe];if(n){var a=1===e.pointers.length,l=e.distance<2,h=e.deltaTime<250;if(a&&l&&h)return}if(!s||!o)return n||o&&i&Q||s&&i&Z?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var Be=1,Ge=32;function ze(e){this.options=y({},this.defaults,e||{}),this.id=O++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=Be,this.simultaneous={},this.requireFail=[]}function He(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function We(e){return e==K?"down":e==Y?"up":e==q?"left":e==X?"right":""}function je(e,t){var i=t.manager;return i?i.get(e):e}function qe(){ze.apply(this,arguments)}function Xe(){qe.apply(this,arguments),this.pX=null,this.pY=null}function Ye(){qe.apply(this,arguments)}function Ke(){ze.apply(this,arguments),this._timer=null,this._input=null}function Qe(){qe.apply(this,arguments)}function Ze(){qe.apply(this,arguments)}function Je(){ze.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function $e(e,t){return(t=t||{}).recognizers=S(t.recognizers,$e.defaults.preset),new et(e,t)}ze.prototype={defaults:{},set:function(e){return y(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=je(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=je(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===D(t,e=je(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=je(e,this);var t=D(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,i=this.state;function r(i){t.manager.emit(i,e)}i<8&&r(t.options.event+He(i)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),i>=8&&r(t.options.event+He(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ge},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ge|Be)))return!1;e++}return!0},recognize:function(e){var t=y({},e);if(!A(this.options.enable,[this,t]))return this.reset(),void(this.state=Ge);56&this.state&&(this.state=Be),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},_(qe,ze,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,r=6&t,n=this.attrTest(e);return r&&(i&W||!n)?16|t:r||n?i&H?8|t:2&t?4|t:2:Ge}}),_(Xe,qe,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var e=this.options.direction,t=[];return e&Q&&t.push(ke),e&Z&&t.push(Fe),t},directionTest:function(e){var t=this.options,i=!0,r=e.distance,n=e.direction,o=e.deltaX,s=e.deltaY;return n&t.direction||(t.direction&Q?(n=0===o?j:o<0?q:X,i=o!=this.pX,r=Math.abs(e.deltaX)):(n=0===s?j:s<0?Y:K,i=s!=this.pY,r=Math.abs(e.deltaY))),e.direction=n,i&&r>t.threshold&&n&t.direction},attrTest:function(e){return qe.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=We(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),_(Ye,qe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ne]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),_(Ke,ze,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Re]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime>t.time;if(this._input=e,!r||!i||e.eventType&(H|W)&&!n)this.reset();else if(e.eventType&z)this.reset(),this._timer=f((function(){this.state=8,this.tryEmit()}),t.time,this);else if(e.eventType&H)return 8;return Ge},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&e.eventType&H?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),_(Qe,qe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ne]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),_(Ze,qe,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Q|Z,pointers:1},getTouchAction:function(){return Xe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(Q|Z)?t=e.overallVelocity:i&Q?t=e.overallVelocityX:i&Z&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&i&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&d(t)>this.options.velocity&&e.eventType&H},emit:function(e){var t=We(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),_(Je,ze,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Oe]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),e.eventType&z&&0===this.count)return this.failTimeout();if(r&&n&&i){if(e.eventType!=H)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||ae(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=f((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ge},failTimeout:function(){return this._timer=f((function(){this.state=Ge}),this.options.interval,this),Ge},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),$e.VERSION="2.0.8",$e.defaults={domEvents:!1,touchAction:Ie,enable:!0,handlePointerEventMouse:!0,inputTarget:null,inputClass:null,preset:[[Qe,{enable:!1}],[Ye,{enable:!1},["rotate"]],[Ze,{direction:Q}],[Xe,{direction:Q},["swipe"]],[Je],[Je,{event:"doubletap",taps:2},["tap"]],[Ke]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function et(e,t){var i;this.options=y({},$e.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((i=this).options.inputClass||(k?ve:V?Ae:F?Me:de))(i,ie),this.touchAction=new Ue(this,this.options.touchAction),tt(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function tt(e,t){var i,r=e.element;r.style&&(g(e.options.cssProps,(function(n,o){i=R(r.style,o),t?(e.oldCssProps[i]=r.style[i],r.style[i]=n):r.style[i]=e.oldCssProps[i]||""})),t||(e.oldCssProps={}))}et.prototype={set:function(e){return y(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var i;this.touchAction.preventDefaults(e);var r=this.recognizers,n=t.curRecognizer;(!n||n&&8&n.state)&&(n=t.curRecognizer=null);for(var o=0;o<r.length;)i=r[o],2===t.stopped||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(e),!n&&14&i.state&&(n=t.curRecognizer=i),o++}},get:function(e){if(e instanceof ze)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,i=D(t,e);-1!==i&&(t.splice(i,1),this.touchAction.update())}return this},on:function(e,t){if(e!==a&&t!==a){var i=this.handlers;return g(P(e),(function(e){i[e]=i[e]||[],i[e].push(t)})),this}},off:function(e,t){if(e!==a){var i=this.handlers;return g(P(e),(function(e){t?i[e]&&i[e].splice(D(i[e],t),1):delete i[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var i=o.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()},t.stopPropagation=function(){t.srcEvent.stopPropagation()};for(var r=0;r<i.length;)i[r](t),r++}},destroy:function(){this.element&&tt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},y($e,{INPUT_START:z,INPUT_MOVE:2,INPUT_END:H,INPUT_CANCEL:W,STATE_POSSIBLE:Be,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ge,DIRECTION_NONE:j,DIRECTION_LEFT:q,DIRECTION_RIGHT:X,DIRECTION_UP:Y,DIRECTION_DOWN:K,DIRECTION_HORIZONTAL:Q,DIRECTION_VERTICAL:Z,DIRECTION_ALL:J,Manager:et,Input:te,TouchAction:Ue,TouchInput:Ae,MouseInput:de,PointerEventInput:ve,TouchMouseInput:Me,SingleTouchInput:be,Recognizer:ze,AttrRecognizer:qe,Tap:Je,Pan:Xe,Swipe:Ze,Pinch:Ye,Rotate:Qe,Press:Ke,on:w,off:M,each:g,merge:x,extend:b,assign:y,inherit:_,bindFn:E,prefixed:R}),(void 0!==n?n:"undefined"!=typeof self?self:{}).Hammer=$e,(r=function(){return $e}.call(t,i,t,e))===a||(e.exports=r)}(window,document)},62688:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DDSLoader:()=>n});var r=i(75050),n=function(){this._parser=n.parse};n.prototype=Object.create(r.CompressedTextureLoader.prototype),n.prototype.constructor=n,n.parse=function(e,t){var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function o(e,t,i,r){for(var n=i*r*4,o=new Uint8Array(e,t,n),s=new Uint8Array(n),a=0,l=0,h=0;h<r;h++)for(var c=0;c<i;c++){var u=o[l],d=o[++l],p=o[++l],f=o[++l];l++,s[a]=p,s[++a]=d,s[++a]=u,s[++a]=f,a++}return s}var s=n("DXT1"),a=n("DXT3"),l=n("DXT5");if(e.byteLength<124)return console.error("THREE.DDSLoader.parse: File is empty or incomplete."),i;var h,c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),i;if(4&!c[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),i;var u,d=c[21],p=!1;switch(d){case s:h=8,i.format=r.RGB_S3TC_DXT1_Format;break;case a:h=16,i.format=r.RGBA_S3TC_DXT3_Format;break;case l:h=16,i.format=r.RGBA_S3TC_DXT5_Format;break;default:if(!(32==c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(u=d,String.fromCharCode(255&u,u>>8&255,u>>16&255,u>>24&255))),i;p=!0,h=64,i.format=r.RGBAFormat}i.mipmapCount=1,c[7]>0&&!1!==t&&(i.mipmapCount=Math.max(1,c[7])),i.isCubemap=!!(512&c[28]),i.width=c[4],i.height=c[3];for(var f=c[1]+4,m=i.width,g=i.height,v=i.isCubemap?6:1,y=0;y<v;y++){for(var b=0;b<i.mipmapCount;b++){if(p)var x=(_=o(e,f,m,g)).length;else{x=Math.max(4,m)/4*Math.max(4,g)/4*h;var _=new Uint8Array(e,f,x)}var E={data:_,width:m,height:g};i.mipmaps.push(E),f+=x,m=Math.max(.5*m,1),g=Math.max(.5*g,1)}m=i.width,g=i.height}return i}},51751:(e,t,i)=>{"use strict";
/*!
MIT License

Copyright (c) 2019 Fyrestar

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
function r(e,t){for(let i in t){const r=t[i];if("@"===i[0]){const t=i.substr(1);e=e.replace(t,r)}else if("?"===i[0]){const t=i.substr(1);e=e.replace(t,r+"\n"+t)}else e=e.replace(i,i+"\n"+r)}return e}function n(e,t){const i=(t.header||"")+"\n";let n=(t.vertexHeader||"")+"\n"+e.vertexShader,o=(t.fragmentHeader||"")+"\n"+e.fragmentShader;return t.vertexEnd&&(n=n.replace(/\}(?=[^\}]*$)/g,t.vertexEnd+"\n}")),t.fragmentEnd&&(o=o.replace(/\}(?=[^\}]*$)/g,t.fragmentEnd+"\n}")),void 0!==t.vertex&&(n=r(n,t.vertex)),void 0!==t.fragment&&(o=r(o,t.fragment)),e.vertexShader=i+n,e.fragmentShader=i+o,e}i.r(t),i.d(t,{patchShader:()=>n})},54538:(e,t,i)=>{"use strict";i.r(t),i.d(t,{polyfillTHREE:()=>d});const r=(e,t,i)=>{"object"!=typeof e&&"function"!=typeof e||Object.prototype.hasOwnProperty.call(e,t)||(e[t]=i)},n=(e,t,i)=>{"object"==typeof e&&Object.defineProperty(e,t,i)},o=e=>{r(e,"BoxBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:o,depthSegments:s};const a=this;n=Math.floor(n),o=Math.floor(o),s=Math.floor(s);const l=[],h=[],c=[],u=[];let d=0,p=0;function f(t,i,r,n,o,s,f,m,g,v,y){const b=s/g,x=f/v,_=s/2,E=f/2,A=m/2,S=g+1,w=v+1;let M=0,T=0;const C=new e.Vector3;for(let e=0;e<w;e++){const s=e*x-E;for(let a=0;a<S;a++){const l=a*b-_;C[t]=l*n,C[i]=s*o,C[r]=A,h.push(C.x,C.y,C.z),C[t]=0,C[i]=0,C[r]=m>0?1:-1,c.push(C.x,C.y,C.z),u.push(a/g),u.push(1-e/v),M+=1}}for(let e=0;e<v;e++)for(let t=0;t<g;t++){const i=d+t+S*e,r=d+t+S*(e+1),n=d+(t+1)+S*(e+1),o=d+(t+1)+S*e;l.push(i,r,o),l.push(r,n,o),T+=6}a.addGroup(p,T,0),p+=T,d+=M}f("z","y","x",-1,-1,r,i,t,s,o,0),f("z","y","x",1,-1,r,i,-t,s,o,1),f("x","z","y",1,1,t,r,i,n,s,2),f("x","z","y",1,-1,t,r,-i,n,s,3),f("x","y","z",1,-1,t,i,r,n,o,4),f("x","y","z",-1,-1,t,i,-r,n,o,5),this.setIndex(l),this.setAttribute("position",new e.Float32BufferAttribute(h,3)),this.setAttribute("normal",new e.Float32BufferAttribute(c,3)),this.setAttribute("uv",new e.Float32BufferAttribute(u,2))}})},s=e=>{r(e,"CircleBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const o=[],s=[],a=[],l=[],h=new e.Vector3,c=new e.Vector2;s.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let e=0,o=3;e<=i;e++,o+=3){const u=r+e/i*n;h.x=t*Math.cos(u),h.y=t*Math.sin(u),s.push(h.x,h.y,h.z),a.push(0,0,1),c.x=(s[o]/t+1)/2,c.y=(s[o+1]/t+1)/2,l.push(c.x,c.y)}for(let e=1;e<=i;e++)o.push(e,e+1,0);this.setIndex(o),this.setAttribute("position",new e.Float32BufferAttribute(s,3)),this.setAttribute("normal",new e.Float32BufferAttribute(a,3)),this.setAttribute("uv",new e.Float32BufferAttribute(l,2))}})},a=e=>{r(e,"CylinderBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l};const h=this;n=Math.floor(n),o=Math.floor(o);const c=[],u=[],d=[],p=[];let f=0;const m=[],g=r/2;let v=0;function y(r){const o=f,s=new e.Vector2,m=new e.Vector3;let y=0;const b=!0===r?t:i,x=!0===r?1:-1;for(let e=1;e<=n;e++)u.push(0,g*x,0),d.push(0,x,0),p.push(.5,.5),f++;const _=f;for(let e=0;e<=n;e++){const t=e/n*l+a,i=Math.cos(t),r=Math.sin(t);m.x=b*r,m.y=g*x,m.z=b*i,u.push(m.x,m.y,m.z),d.push(0,x,0),s.x=.5*i+.5,s.y=.5*r*x+.5,p.push(s.x,s.y),f++}for(let e=0;e<n;e++){const t=o+e,i=_+e;!0===r?c.push(i,i+1,t):c.push(i+1,i,t),y+=3}h.addGroup(v,y,0),v+=y}!function(){const s=new e.Vector3,y=new e.Vector3;let b=0;const x=(i-t)/r;for(let e=0;e<=o;e++){const h=[],c=e/o,v=c*(i-t)+t;for(let e=0;e<=n;e++){const t=e/n,i=t*l+a,o=Math.sin(i),m=Math.cos(i);y.x=v*o,y.y=-c*r+g,y.z=v*m,u.push(y.x,y.y,y.z),s.set(o,x,m).normalize(),d.push(s.x,s.y,s.z),p.push(t,1-c),h.push(f++)}m.push(h)}for(let e=0;e<n;e++)for(let t=0;t<o;t++){const i=m[t][e],r=m[t+1][e],n=m[t+1][e+1],o=m[t][e+1];c.push(i,r,o),c.push(r,n,o),b+=6}h.addGroup(v,b,0),v+=b}(),!1===s&&(t>0&&y(!0),i>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new e.Float32BufferAttribute(u,3)),this.setAttribute("normal",new e.Float32BufferAttribute(d,3)),this.setAttribute("uv",new e.Float32BufferAttribute(p,2))}})},l=e=>{r(e,"PolyhedronBufferGeometry",class extends e.BufferGeometry{constructor(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n};const o=[],s=[];function a(e,t,i,r){const n=r+1,o=[];for(let r=0;r<=n;r++){o[r]=[];const s=e.clone().lerp(i,r/n),a=t.clone().lerp(i,r/n),l=n-r;for(let e=0;e<=l;e++)o[r][e]=0===e&&r===n?s:s.clone().lerp(a,e/l)}for(let e=0;e<n;e++)for(let t=0;t<2*(n-e)-1;t++){const i=Math.floor(t/2);t%2==0?(l(o[e][i+1]),l(o[e+1][i]),l(o[e][i])):(l(o[e][i+1]),l(o[e+1][i+1]),l(o[e+1][i]))}}function l(e){o.push(e.x,e.y,e.z)}function h(e,i){const r=3*e;i.x=t[r+0],i.y=t[r+1],i.z=t[r+2]}function c(e,t,i,r){r<0&&1===e.x&&(s[t]=e.x-1),0===i.x&&0===i.z&&(s[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(t){const r=new e.Vector3,n=new e.Vector3,o=new e.Vector3;for(let e=0;e<i.length;e+=3)h(i[e+0],r),h(i[e+1],n),h(i[e+2],o),a(r,n,o,t)}(n),function(t){const i=new e.Vector3;for(let e=0;e<o.length;e+=3)i.x=o[e+0],i.y=o[e+1],i.z=o[e+2],i.normalize().multiplyScalar(t),o[e+0]=i.x,o[e+1]=i.y,o[e+2]=i.z}(r),function(){const t=new e.Vector3;for(let e=0;e<o.length;e+=3){t.x=o[e+0],t.y=o[e+1],t.z=o[e+2];const i=u(t)/2/Math.PI+.5,r=d(t)/Math.PI+.5;s.push(i,1-r)}(function(){const t=new e.Vector3,i=new e.Vector3,r=new e.Vector3,n=new e.Vector3,a=new e.Vector2,l=new e.Vector2,h=new e.Vector2;for(let e=0,d=0;e<o.length;e+=9,d+=6){t.set(o[e+0],o[e+1],o[e+2]),i.set(o[e+3],o[e+4],o[e+5]),r.set(o[e+6],o[e+7],o[e+8]),a.set(s[d+0],s[d+1]),l.set(s[d+2],s[d+3]),h.set(s[d+4],s[d+5]),n.copy(t).add(i).add(r).divideScalar(3);const p=u(n);c(a,d+0,t,p),c(l,d+2,i,p),c(h,d+4,r,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],i=s[e+2],r=s[e+4],n=Math.max(t,i,r),o=Math.min(t,i,r);n>.9&&o<.1&&(t<.2&&(s[e+0]+=1),i<.2&&(s[e+2]+=1),r<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new e.Float32BufferAttribute(o,3)),this.setAttribute("normal",new e.Float32BufferAttribute(o.slice(),3)),this.setAttribute("uv",new e.Float32BufferAttribute(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}})},h=e=>{r(e,"OctahedronBufferGeometry",class extends e.PolyhedronBufferGeometry{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}})},c=e=>{r(e,"SphereBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:o,thetaStart:s,thetaLength:a},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(s+a,Math.PI);let h=0;const c=[],u=new e.Vector3,d=new e.Vector3,p=[],f=[],m=[],g=[];for(let e=0;e<=r;e++){const p=[],v=e/r;let y=0;0==e&&0==s?y=.5/i:e==r&&l==Math.PI&&(y=-.5/i);for(let e=0;e<=i;e++){const r=e/i;u.x=-t*Math.cos(n+r*o)*Math.sin(s+v*a),u.y=t*Math.cos(s+v*a),u.z=t*Math.sin(n+r*o)*Math.sin(s+v*a),f.push(u.x,u.y,u.z),d.copy(u).normalize(),m.push(d.x,d.y,d.z),g.push(r+y,1-v),p.push(h++)}c.push(p)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const i=c[e][t+1],n=c[e][t],o=c[e+1][t],a=c[e+1][t+1];(0!==e||s>0)&&p.push(i,n,a),(e!==r-1||l<Math.PI)&&p.push(n,o,a)}this.setIndex(p),this.setAttribute("position",new e.Float32BufferAttribute(f,3)),this.setAttribute("normal",new e.Float32BufferAttribute(m,3)),this.setAttribute("uv",new e.Float32BufferAttribute(g,2))}})},u=e=>{r(e,"TorusBufferGeometry",class extends e.BufferGeometry{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:o},r=Math.floor(r),n=Math.floor(n);const s=[],a=[],l=[],h=[],c=new e.Vector3,u=new e.Vector3,d=new e.Vector3;for(let e=0;e<=r;e++)for(let s=0;s<=n;s++){const p=s/n*o,f=e/r*Math.PI*2;u.x=(t+i*Math.cos(f))*Math.cos(p),u.y=(t+i*Math.cos(f))*Math.sin(p),u.z=i*Math.sin(f),a.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),d.subVectors(u,c).normalize(),l.push(d.x,d.y,d.z),h.push(s/n),h.push(e/r)}for(let e=1;e<=r;e++)for(let t=1;t<=n;t++){const i=(n+1)*e+t-1,r=(n+1)*(e-1)+t-1,o=(n+1)*(e-1)+t,a=(n+1)*e+t;s.push(i,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new e.Float32BufferAttribute(a,3)),this.setAttribute("normal",new e.Float32BufferAttribute(l,3)),this.setAttribute("uv",new e.Float32BufferAttribute(h,2))}})},d=e=>{var t,i,d,p,f,m,g,v,y,b,x,_,E,A,S,w,M,T,C,P,D,L,I,R,O,N,F,k,V,U,B;const G=new e.Vector3;r(null==e||null===(t=e.Camera)||void 0===t?void 0:t.prototype,"updateMatrixWorld",(function(t){e.Object3D.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()})),r(null==e||null===(i=e.Box2)||void 0===i?void 0:i.prototype,"getSize",(function(e){return this.isEmpty()?e.set(0,0):this.size(e)})),r(null==e||null===(d=e.Box3)||void 0===d?void 0:d.prototype,"getSize",(function(e){return this.isEmpty()?e.set(0,0,0):this.size(e)})),r(null==e||null===(p=e.Box2)||void 0===p?void 0:p.prototype,"intersectsBox",(function(e){return this.isIntersectionBox(e)})),r(null==e||null===(f=e.Box3)||void 0===f?void 0:f.prototype,"intersectsBox",(function(e){return this.isIntersectionBox(e)})),r(null==e||null===(m=e.Ray)||void 0===m?void 0:m.prototype,"intersectsBox",(function(e){return this.isIntersectionBox(e)})),r(null==e||null===(g=e.BufferAttribute)||void 0===g?void 0:g.prototype,"applyMatrix4",(function(e){for(let t=0,i=this.count;t<i;t++)G.x=this.getX(t),G.y=this.getY(t),G.z=this.getZ(t),G.applyMatrix4(e),this.setXYZ(t,G.x,G.y,G.z);return this})),r(null==e||null===(v=e.BufferAttribute)||void 0===v?void 0:v.prototype,"getX",(function(e){return this.array[e*this.itemSize]})),r(null==e||null===(y=e.BufferAttribute)||void 0===y?void 0:y.prototype,"getY",(function(e){return this.array[e*this.itemSize+1]})),r(null==e||null===(b=e.BufferAttribute)||void 0===b?void 0:b.prototype,"getZ",(function(e){return this.array[e*this.itemSize+2]})),n(null==e||null===(x=e.BufferAttribute)||void 0===x?void 0:x.prototype,"itemOffset",{get:function(){return this.offset},set:function(e){this.offset=e}}),"function"==typeof(null==e?void 0:e.BufferAttribute)&&(r(e,"Float32BufferAttribute",class extends e.BufferAttribute{constructor(e,t,i){super(new Float32Array(e),t,i)}}),r(e,"Uint16BufferAttribute",class extends e.BufferAttribute{constructor(e,t,i){super(new Uint16Array(e),t,i)}}),r(e,"Uint32BufferAttribute",class extends e.BufferAttribute{constructor(e,t,i){super(new Uint32Array(e),t,i)}})),r(null==e||null===(_=e.BufferGeometry)||void 0===_?void 0:_.prototype,"applyMatrix4",(function(e){return this.applyMatrix(e),this})),n(null==e||null===(E=e.BufferGeometry)||void 0===E?void 0:E.prototype,"groups",{get:function(){return this.offsets},set:function(e){this.offsets=e,this.drawcalls=e}}),r(null==e||null===(A=e.BufferGeometry)||void 0===A?void 0:A.prototype,"addGroup",(function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return void 0!==i&&0!==i&&console.warn("THREE.BufferGeometry: .addGroup() with `materialIndex !== 0` is not supported in this Three.js version. Ignoring the `materialIndex` parameter."),this.addDrawCall(e,t)})),n(null==e||null===(S=e.BufferGeometry)||void 0===S?void 0:S.prototype,"index",{get:function(){return this.attributes.index},set:function(e){this.attributes.index=e}}),r(null==e||null===(w=e.BufferGeometry)||void 0===w?void 0:w.prototype,"setFromPoints",(function(t){const i=[];for(let e=0,r=t.length;e<r;e++){const r=t[e];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new e.Float32BufferAttribute(i,3)),this})),r(null==e||null===(M=e.BufferGeometry)||void 0===M?void 0:M.prototype,"setIndex",(function(t){return Array.isArray(t)?this.index=new((e=>{if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t})(t)>65535?e.Uint32BufferAttribute:e.Uint16BufferAttribute)(t,1):this.index=t,this})),"function"==typeof(null==e?void 0:e.BufferGeometry)&&(o(e),s(e),a(e),l(e),h(e),c(e),u(e)),r(null==e||null===(T=e.Frustum)||void 0===T?void 0:T.prototype,"setFromProjectionMatrix",(function(e){return this.setFromMatrix(e)})),r(null==e||null===(C=e.Geometry)||void 0===C?void 0:C.prototype,"applyMatrix4",(function(e){return this.applyMatrix(e),this})),"function"==typeof e.Line&&r(e,"LineSegments",class extends e.Line{constructor(t,i){super(t,i,e.LinePieces),this.isLineSegments=!0,this.type="LineSegments"}}),r(null==e||null===(P=e.Line)||void 0===P?void 0:P.prototype,"computeLineDistances",(function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,r=t.count;e<r;e++)_start.fromBufferAttribute(t,e-1),_end.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this})),r(null==e||null===(D=e.Matrix3)||void 0===D?void 0:D.prototype,"invert",(function(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],h=e[8],c=h*o-s*l,u=s*a-h*n,d=l*n-o*a,p=t*c+i*u+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(r*l-h*i)*f,e[2]=(s*i-r*o)*f,e[3]=u*f,e[4]=(h*t-r*a)*f,e[5]=(r*n-s*t)*f,e[6]=d*f,e[7]=(i*a-l*t)*f,e[8]=(o*t-i*n)*f,this})),r(null==e||null===(L=e.Matrix4)||void 0===L?void 0:L.prototype,"invert",(function(){const e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*u*l+f*a*d-s*m*d-c*a*g+s*u*g,y=p*u*l-h*m*l-p*a*d+o*m*d+h*a*g-o*u*g,b=h*f*l-p*c*l+p*s*d-o*f*d-h*s*g+o*c*g,x=p*c*a-h*f*a-p*s*u+o*f*u+h*s*m-o*c*m,_=t*v+i*y+r*b+n*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/_;return e[0]=v*E,e[1]=(f*u*n-c*m*n-f*r*d+i*m*d+c*r*g-i*u*g)*E,e[2]=(s*m*n-f*a*n+f*r*l-i*m*l-s*r*g+i*a*g)*E,e[3]=(c*a*n-s*u*n-c*r*l+i*u*l+s*r*d-i*a*d)*E,e[4]=y*E,e[5]=(h*m*n-p*u*n+p*r*d-t*m*d-h*r*g+t*u*g)*E,e[6]=(p*a*n-o*m*n-p*r*l+t*m*l+o*r*g-t*a*g)*E,e[7]=(o*u*n-h*a*n+h*r*l-t*u*l-o*r*d+t*a*d)*E,e[8]=b*E,e[9]=(p*c*n-h*f*n-p*i*d+t*f*d+h*i*g-t*c*g)*E,e[10]=(o*f*n-p*s*n+p*i*l-t*f*l-o*i*g+t*s*g)*E,e[11]=(h*s*n-o*c*n-h*i*l+t*c*l+o*i*d-t*s*d)*E,e[12]=x*E,e[13]=(h*f*r-p*c*r+p*i*u-t*f*u-h*i*m+t*c*m)*E,e[14]=(p*s*r-o*f*r-p*i*a+t*f*a+o*i*m-t*s*m)*E,e[15]=(o*c*r-h*s*r+h*i*a-t*c*a-o*i*u+t*s*u)*E,this})),n(null==e||null===(I=e.MeshPhongMaterial)||void 0===I?void 0:I.prototype,"flatShading",{get:function(){return this.shading===e.FlatShading},set:function(t){this.shading=!0===t?e.FlatShading:e.SmoothShading}}),r(null==e||null===(R=e.Object3D)||void 0===R?void 0:R.prototype,"applyMatrix4",(function(e){return this.applyMatrix(e)})),r(e,"PointsMaterial",e.PointCloudMaterial),r(null==e||null===(O=e.Quaternion)||void 0===O?void 0:O.prototype,"invert",(function(){return this.inverse()})),r(null==e||null===(N=e.Quaternion)||void 0===N?void 0:N.prototype,"slerpQuaternions",(function(e,t,i){return this.copy(e).slerp(t,i)})),r(null==e?void 0:e.Triangle,"getNormal",(function(e,t,i,r){return this.normal(e,t,i,r)})),r(null==e||null===(F=e.Vector2)||void 0===F?void 0:F.prototype,"fromBufferAttribute",(function(e,t,i){return this.fromAttribute(e,t,i)})),r(null==e||null===(k=e.Vector3)||void 0===k?void 0:k.prototype,"fromBufferAttribute",(function(e,t,i){return this.fromAttribute(e,t,i)})),r(null==e||null===(V=e.Vector4)||void 0===V?void 0:V.prototype,"fromBufferAttribute",(function(e,t,i){return this.fromAttribute(e,t,i)})),n(null==e||null===(U=e.WebGLRenderTarget)||void 0===U?void 0:U.prototype,"texture",{get:function(){return this}}),r(null==e||null===(B=e.Material)||void 0===B?void 0:B.prototype,"onBeforeCompile",(function(){}))}},75050:(e,t,i)=>{var r,n,o,s,a,l,h,c,u,d,p,f,m,g,v,y,b,x,_,E,A,S,w,M,T,C,P,D,L,I,R,O,N,F,k,V,U,B,G,z,H,W,j,q,X,Y,K=e.exports={REVISION:"71"};void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),K.log=function(){console.log.apply(console,arguments)},K.warn=function(){console.warn.apply(console,arguments)},K.error=function(){console.error.apply(console,arguments)},K.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},K.CullFaceNone=0,K.CullFaceBack=1,K.CullFaceFront=2,K.CullFaceFrontBack=3,K.FrontFaceDirectionCW=0,K.FrontFaceDirectionCCW=1,K.BasicShadowMap=0,K.PCFShadowMap=1,K.PCFSoftShadowMap=2,K.FrontSide=0,K.BackSide=1,K.DoubleSide=2,K.NoShading=0,K.FlatShading=1,K.SmoothShading=2,K.NoColors=0,K.FaceColors=1,K.VertexColors=2,K.NoBlending=0,K.NormalBlending=1,K.AdditiveBlending=2,K.SubtractiveBlending=3,K.MultiplyBlending=4,K.CustomBlending=5,K.AddEquation=100,K.SubtractEquation=101,K.ReverseSubtractEquation=102,K.MinEquation=103,K.MaxEquation=104,K.ZeroFactor=200,K.OneFactor=201,K.SrcColorFactor=202,K.OneMinusSrcColorFactor=203,K.SrcAlphaFactor=204,K.OneMinusSrcAlphaFactor=205,K.DstAlphaFactor=206,K.OneMinusDstAlphaFactor=207,K.DstColorFactor=208,K.OneMinusDstColorFactor=209,K.SrcAlphaSaturateFactor=210,K.MultiplyOperation=0,K.MixOperation=1,K.AddOperation=2,K.UVMapping=300,K.CubeReflectionMapping=301,K.CubeRefractionMapping=302,K.EquirectangularReflectionMapping=303,K.EquirectangularRefractionMapping=304,K.SphericalReflectionMapping=305,K.RepeatWrapping=1e3,K.ClampToEdgeWrapping=1001,K.MirroredRepeatWrapping=1002,K.NearestFilter=1003,K.NearestMipMapNearestFilter=1004,K.NearestMipMapLinearFilter=1005,K.LinearFilter=1006,K.LinearMipMapNearestFilter=1007,K.LinearMipMapLinearFilter=1008,K.UnsignedByteType=1009,K.ByteType=1010,K.ShortType=1011,K.UnsignedShortType=1012,K.IntType=1013,K.UnsignedIntType=1014,K.FloatType=1015,K.HalfFloatType=1025,K.UnsignedShort4444Type=1016,K.UnsignedShort5551Type=1017,K.UnsignedShort565Type=1018,K.AlphaFormat=1019,K.RGBFormat=1020,K.RGBAFormat=1021,K.LuminanceFormat=1022,K.LuminanceAlphaFormat=1023,K.RGBEFormat=K.RGBAFormat,K.RGB_S3TC_DXT1_Format=2001,K.RGBA_S3TC_DXT1_Format=2002,K.RGBA_S3TC_DXT3_Format=2003,K.RGBA_S3TC_DXT5_Format=2004,K.RGB_PVRTC_4BPPV1_Format=2100,K.RGB_PVRTC_2BPPV1_Format=2101,K.RGBA_PVRTC_4BPPV1_Format=2102,K.RGBA_PVRTC_2BPPV1_Format=2103,K.Projector=function(){K.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){K.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){K.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){K.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},K.CanvasRenderer=function(){K.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},K.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},K.Color.prototype={constructor:K.Color,r:1,g:1,b:1,set:function(e){return e instanceof K.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var r=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e},n=i<=.5?i*(1+t):i+t-i*t,o=2*i-n;this.r=r(o,n,e+1/3),this.g=r(o,n,e),this.b=r(o,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(K.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,r=e||{h:0,s:0,l:0},n=this.r,o=this.g,s=this.b,a=Math.max(n,o,s),l=Math.min(n,o,s),h=(l+a)/2;if(l===a)t=0,i=0;else{var c=a-l;switch(i=h<=.5?c/(a+l):c/(2-a-l),a){case n:t=(o-s)/c+(o<s?6:0);break;case o:t=(s-n)/c+2;break;case s:t=(n-o)/c+4}t/=6}return r.h=t,r.s=i,r.l=h,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},clone:function(){return(new K.Color).setRGB(this.r,this.g,this.b)}},K.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},K.Quaternion=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1},K.Quaternion.prototype={constructor:K.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof K.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=Math.cos(e._x/2),r=Math.cos(e._y/2),n=Math.cos(e._z/2),o=Math.sin(e._x/2),s=Math.sin(e._y/2),a=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*r*n+i*s*a,this._y=i*s*n-o*r*a,this._z=i*r*a+o*s*n,this._w=i*r*n-o*s*a):"YXZ"===e.order?(this._x=o*r*n+i*s*a,this._y=i*s*n-o*r*a,this._z=i*r*a-o*s*n,this._w=i*r*n+o*s*a):"ZXY"===e.order?(this._x=o*r*n-i*s*a,this._y=i*s*n+o*r*a,this._z=i*r*a+o*s*n,this._w=i*r*n-o*s*a):"ZYX"===e.order?(this._x=o*r*n-i*s*a,this._y=i*s*n+o*r*a,this._z=i*r*a-o*s*n,this._w=i*r*n+o*s*a):"YZX"===e.order?(this._x=o*r*n+i*s*a,this._y=i*s*n+o*r*a,this._z=i*r*a-o*s*n,this._w=i*r*n-o*s*a):"XZY"===e.order&&(this._x=o*r*n-i*s*a,this._y=i*s*n-o*r*a,this._z=i*r*a+o*s*n,this._w=i*r*n+o*s*a),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],h=i[2],c=i[6],u=i[10],d=r+a+u;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-h)*t,this._z=(s-n)*t):r>a&&r>u?(t=2*Math.sqrt(1+r-a-u),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+h)/t):a>u?(t=2*Math.sqrt(1+a-r-u),this._w=(o-h)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+u-r-a),this._w=(s-n)/t,this._x=(o+h)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(e,t){return void 0===r&&(r=new K.Vector3),(n=e.dot(t)+1)<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0):r.set(0,-e.z,e.y)):r.crossVectors(e,t),this._x=r.x,this._y=r.y,this._z=r.z,this._w=n,this.normalize(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(K.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,h=t._w;return this._x=i*h+o*s+r*l-n*a,this._y=r*h+o*a+n*s-i*l,this._z=n*h+o*l+i*a-r*s,this._w=o*h-i*s-r*a-n*l,this.onChangeCallback(),this},multiplyVector3:function(e){return K.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.acos(s),l=Math.sqrt(1-s*s);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var h=Math.sin((1-t)*a)/l,c=Math.sin(t*a)/l;return this._w=o*h+this._w*c,this._x=i*h+this._x*c,this._y=r*h+this._y*c,this._z=n*h+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new K.Quaternion(this._x,this._y,this._z,this._w)}},K.Quaternion.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)},K.Vector2=function(e,t){this.x=e||0,this.y=t||0},K.Vector2.prototype={constructor:K.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(K.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},sub:function(e,t){return void 0!==t?(K.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(e,t){return void 0===o&&(o=new K.Vector2,s=new K.Vector2),o.set(e,e),s.set(t,t),this.clamp(o,s)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this},clone:function(){return new K.Vector2(this.x,this.y)}},K.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},K.Vector3.prototype={constructor:K.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(K.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(K.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(K.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e instanceof K.Euler==0&&K.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===l&&(l=new K.Quaternion),this.applyQuaternion(l.setFromEuler(e)),this},applyAxisAngle:function(){var e;return function(t,i){return void 0===e&&(e=new K.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,i)),this}}(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,h=a*i+s*t-n*r,c=a*r+n*i-o*t,u=-n*t-o*i-s*r;return this.x=l*a+u*-n+h*-s-c*-o,this.y=h*a+u*-o+c*-n-l*-s,this.z=c*a+u*-s+l*-o-h*-n,this},project:function(e){return void 0===a&&(a=new K.Matrix4),a.multiplyMatrices(e.projectionMatrix,a.getInverse(e.matrixWorld)),this.applyProjection(a)},unproject:function(){var e;return function(t){return void 0===e&&(e=new K.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new K.Vector3,t=new K.Vector3),e.set(i,i,i),t.set(r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},cross:function(e,t){if(void 0!==t)return K.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this},projectOnVector:function(){var e,t;return function(i){return void 0===e&&(e=new K.Vector3),e.copy(i).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new K.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new K.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(K.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},setEulerFromRotationMatrix:function(e,t){K.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){K.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return K.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return K.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return K.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){var i=4*e,r=t.elements;return this.x=r[i],this.y=r[i+1],this.z=r[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this},clone:function(){return new K.Vector3(this.x,this.y,this.z)}},K.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},K.Vector4.prototype={constructor:K.Vector4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(K.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(K.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=.01,s=.1,a=e.elements,l=a[0],h=a[4],c=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(h-u)<o&&Math.abs(c-f)<o&&Math.abs(p-m)<o){if(Math.abs(h+u)<s&&Math.abs(c+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(d+1)/2,b=(g+1)/2,x=(h+u)/4,_=(c+f)/4,E=(p+m)/4;return v>y&&v>b?v<o?(i=0,r=.707106781,n=.707106781):(r=x/(i=Math.sqrt(v)),n=_/i):y>b?y<o?(i=.707106781,r=0,n=.707106781):(i=x/(r=Math.sqrt(y)),n=E/r):b<o?(i=.707106781,r=.707106781,n=0):(i=_/(n=Math.sqrt(b)),r=E/n),this.set(i,r,n,t),this}var A=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-h)*(u-h));return Math.abs(A)<.001&&(A=1),this.x=(m-p)/A,this.y=(c-f)/A,this.z=(u-h)/A,this.w=Math.acos((l+d+g-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new K.Vector4,t=new K.Vector4),e.set(i,i,i,i),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this},clone:function(){return new K.Vector4(this.x,this.y,this.z,this.w)}},K.Euler=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||K.Euler.DefaultOrder},K.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],K.Euler.DefaultOrder="XYZ",K.Euler.prototype={constructor:K.Euler,_x:0,_y:0,_z:0,_order:K.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=K.Math.clamp,n=e.elements,o=n[0],s=n[4],a=n[8],l=n[1],h=n[5],c=n[9],u=n[2],d=n[6],p=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===t?(this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,h),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-c,p),this._y=0)):K.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,i,r){return void 0===e&&(e=new K.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,r),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(h=new K.Quaternion,function(e){h.setFromEuler(this),this.setFromQuaternion(h,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new K.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new K.Euler(this._x,this._y,this._z,this._order)}},K.Line3=function(e,t){this.start=void 0!==e?e:new K.Vector3,this.end=void 0!==t?t:new K.Vector3},K.Line3.prototype={constructor:K.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new K.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new K.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new K.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(c=new K.Vector3,u=new K.Vector3,function(e,t){c.subVectors(e,this.start),u.subVectors(this.end,this.start);var i=u.dot(u),r=u.dot(c)/i;return t&&(r=K.Math.clamp(r,0,1)),r}),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t),n=i||new K.Vector3;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new K.Line3).copy(this)}},K.Box2=function(e,t){this.min=void 0!==e?e:new K.Vector2(1/0,1/0),this.max=void 0!==t?t:new K.Vector2(-1/0,-1/0)},K.Box2.prototype={constructor:K.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new K.Vector2;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return console.warn("Box2.empty has been deprecated. Use Box2.isEmpty instead"),this.isEmpty()},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return console.warn("Box2.center() is deprecated. Use Box2.getCenter() instead."),this.getCenter(e)},getCenter:function(e){return(e||new K.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new K.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new K.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new K.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new K.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new K.Box2).copy(this)}},K.Box3=function(e,t){this.min=void 0!==e?e:new K.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new K.Vector3(-1/0,-1/0,-1/0)},K.Box3.prototype={constructor:K.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new K.Vector3;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new K.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse((function(t){var r=t.geometry;if(void 0!==r)if(r instanceof K.Geometry)for(var n=r.vertices,o=0,s=n.length;o<s;o++)e.copy(n[o]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e);else if(r instanceof K.BufferGeometry&&void 0!==r.attributes.position){var a=r.attributes.position.array;for(o=0,s=a.length;o<s;o+=3)e.set(a[o],a[o+1],a[o+2]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}})),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return console.warn("Box3.empty has been deprecated. Use Box3.isEmpty instead"),this.isEmpty()},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return console.warn("Box3.center() is deprecated. Use Box3.getCenter() instead."),this.getCenter(e)},getCenter:function(e){return e=e||new K.Vector3,this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new K.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new K.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new K.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new K.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new K.Vector3;return function(t){var i=t||new K.Sphere;return i.center=this.getCenter(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(d=[new K.Vector3,new K.Vector3,new K.Vector3,new K.Vector3,new K.Vector3,new K.Vector3,new K.Vector3,new K.Vector3],function(e){return d[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),d[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),d[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),d[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),d[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),d[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),d[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),d[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(d),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new K.Box3).copy(this)}},K.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&K.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},K.Matrix3.prototype={constructor:K.Matrix3,set:function(e,t,i,r,n,o,s,a,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=r,h[4]=n,h[7]=o,h[2]=s,h[5]=a,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return K.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return K.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new K.Vector3;return function(t,i,r){void 0===i&&(i=0),void 0===r&&(r=t.length);for(var n=0,o=i;n<r;n+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix3(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],h=e[8];return t*o*h-t*s*l-i*n*h+i*s*a+r*n*l-r*o*a},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var n=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return K.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return(new K.Matrix3).fromArray(this.elements)}},K.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&K.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},K.Matrix4.prototype={constructor:K.Matrix4,set:function(e,t,i,r,n,o,s,a,l,h,c,u,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return K.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){var r=this.elements;return e.set(r[0],r[1],r[2]),t.set(r[4],r[5],r[6]),i.set(r[8],r[9],r[10]),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new K.Vector3;return function(t){var i=this.elements,r=t.elements,n=1/e.set(r[0],r[1],r[2]).length(),o=1/e.set(r[4],r[5],r[6]).length(),s=1/e.set(r[8],r[9],r[10]).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*o,i[5]=r[5]*o,i[6]=r[6]*o,i[8]=r[8]*s,i[9]=r[9]*s,i[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof K.Euler==!1&&K.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),l=Math.sin(r),h=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){var u=o*h,d=o*c,p=s*h,f=s*c;t[0]=a*h,t[4]=-a*c,t[8]=l,t[1]=d+p*l,t[5]=u-f*l,t[9]=-s*a,t[2]=f-u*l,t[6]=p+d*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*h,g=a*c,v=l*h,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*h,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*h,g=a*c,v=l*h,y=l*c;t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*h,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){u=o*h,d=o*c,p=s*h,f=s*c;t[0]=a*h,t[4]=p*l-d,t[8]=u*l+f,t[1]=a*c,t[5]=f*l+u,t[9]=d*l-p,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var b=o*a,x=o*l,_=s*a,E=s*l;t[0]=a*h,t[4]=E-b*c,t[8]=_*c+x,t[1]=c,t[5]=o*h,t[9]=-s*h,t[2]=-l*h,t[6]=x*c+_,t[10]=b-E*c}else if("XZY"===e.order){b=o*a,x=o*l,_=s*a,E=s*l;t[0]=a*h,t[4]=-c,t[8]=l*h,t[1]=b*c+E,t[5]=o*h,t[9]=x*c-_,t[2]=_*c-x,t[6]=s*h,t[10]=E*c+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return K.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,s=i+i,a=r+r,l=n+n,h=i*s,c=i*a,u=i*l,d=r*a,p=r*l,f=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+f),t[4]=c-v,t[8]=u+g,t[1]=c+v,t[5]=1-(h+f),t[9]=p-m,t[2]=u-g,t[6]=p+m,t[10]=1-(h+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new K.Vector3,t=new K.Vector3,i=new K.Vector3;return function(r,n,o){var s=this.elements;return i.subVectors(r,n).normalize(),0===i.length()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.length()&&(i.x+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(K.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],_=r[0],E=r[4],A=r[8],S=r[12],w=r[1],M=r[5],T=r[9],C=r[13],P=r[2],D=r[6],L=r[10],I=r[14],R=r[3],O=r[7],N=r[11],F=r[15];return n[0]=o*_+s*w+a*P+l*R,n[4]=o*E+s*M+a*D+l*O,n[8]=o*A+s*T+a*L+l*N,n[12]=o*S+s*C+a*I+l*F,n[1]=h*_+c*w+u*P+d*R,n[5]=h*E+c*M+u*D+d*O,n[9]=h*A+c*T+u*L+d*N,n[13]=h*S+c*C+u*I+d*F,n[2]=p*_+f*w+m*P+g*R,n[6]=p*E+f*M+m*D+g*O,n[10]=p*A+f*T+m*L+g*N,n[14]=p*S+f*C+m*I+g*F,n[3]=v*_+y*w+b*P+x*R,n[7]=v*E+y*M+b*D+x*O,n[11]=v*A+y*T+b*L+x*N,n[15]=v*S+y*C+b*I+x*F,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return K.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return K.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return K.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new K.Vector3;return function(t,i,r){void 0===i&&(i=0),void 0===r&&(r=t.length);for(var n=0,o=i;n<r;n+=3,o+=3)e.x=t[o],e.y=t[o+1],e.z=t[o+2],e.applyMatrix4(this),t[o]=e.x,t[o+1]=e.y,t[o+2]=e.z;return t}}(),rotateAxis:function(e){K.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return K.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14];return e[3]*(+n*a*c-r*l*c-n*s*u+i*l*u+r*s*d-i*a*d)+e[7]*(+t*a*d-t*l*u+n*o*u-r*o*d+r*l*h-n*a*h)+e[11]*(+t*l*c-t*s*d-n*o*c+i*o*d+n*s*h-i*l*h)+e[15]*(-r*s*h-t*a*c+t*s*u+r*o*c-i*o*u+i*a*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=new K.Vector3;return function(){K.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[4],s=r[8],a=r[12],l=r[1],h=r[5],c=r[9],u=r[13],d=r[2],p=r[6],f=r[10],m=r[14],g=r[3],v=r[7],y=r[11],b=r[15];i[0]=c*m*v-u*f*v+u*p*y-h*m*y-c*p*b+h*f*b,i[4]=a*f*v-s*m*v-a*p*y+o*m*y+s*p*b-o*f*b,i[8]=s*u*v-a*c*v+a*h*y-o*u*y-s*h*b+o*c*b,i[12]=a*c*p-s*u*p-a*h*f+o*u*f+s*h*m-o*c*m,i[1]=u*f*g-c*m*g-u*d*y+l*m*y+c*d*b-l*f*b,i[5]=s*m*g-a*f*g+a*d*y-n*m*y-s*d*b+n*f*b,i[9]=a*c*g-s*u*g-a*l*y+n*u*y+s*l*b-n*c*b,i[13]=s*u*d-a*c*d+a*l*f-n*u*f-s*l*m+n*c*m,i[2]=h*m*g-u*p*g+u*d*v-l*m*v-h*d*b+l*p*b,i[6]=a*p*g-o*m*g-a*d*v+n*m*v+o*d*b-n*p*b,i[10]=o*u*g-a*h*g+a*l*v-n*u*v-o*l*b+n*h*b,i[14]=a*h*d-o*u*d-a*l*p+n*u*p+o*l*m-n*h*m,i[3]=c*p*g-h*f*g-c*d*v+l*f*v+h*d*y-l*p*y,i[7]=o*f*g-s*p*g+s*d*v-n*f*v-o*d*y+n*p*y,i[11]=s*h*g-o*c*g-s*l*v+n*c*v+o*l*y-n*h*y,i[15]=o*c*d-s*h*d+s*l*p-n*c*p-o*l*f+n*h*f;var x=n*i[0]+l*i[4]+d*i[8]+g*i[12];if(0==x){var _="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(_);return K.warn(_),this.identity(),this}return this.multiplyScalar(1/x),this},translate:function(e){K.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){K.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){K.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){K.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){K.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,h=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,h*s+i,h*a-r*o,0,l*a-r*s,h*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new K.Vector3,t=new K.Matrix4;return function(i,r,n){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var h=1/s,c=1/a,u=1/l;return t.elements[0]*=h,t.elements[1]*=h,t.elements[2]*=h,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,r.setFromRotationMatrix(t),n.x=s,n.y=a,n.z=l,this}}(),makeFrustum:function(e,t,i,r,n,o){var s=this.elements,a=2*n/(t-e),l=2*n/(r-i),h=(t+e)/(t-e),c=(r+i)/(r-i),u=-(o+n)/(o-n),d=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,i,r){var n=i*Math.tan(K.Math.degToRad(.5*e)),o=-n,s=o*t,a=n*t;return this.makeFrustum(s,a,o,n,i,r)},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=t-e,l=i-r,h=o-n,c=(t+e)/a,u=(i+r)/l,d=(o+n)/h;return s[0]=2/a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2/l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2/h,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals(e){const t=this.elements,i=e.elements;for(var r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new K.Matrix4).fromArray(this.elements)}},K.Ray=function(e,t){this.origin=void 0!==e?e:new K.Vector3,this.direction=void 0!==t?t:new K.Vector3},K.Ray.prototype={constructor:K.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new K.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new K.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new K.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new K.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:(f=new K.Vector3,m=new K.Vector3,g=new K.Vector3,function(e,t,i,r){f.copy(e).add(t).multiplyScalar(.5),m.copy(t).sub(e).normalize(),g.copy(this.origin).sub(f);var n,o,s,a,l=.5*e.distanceTo(t),h=-this.direction.dot(m),c=g.dot(this.direction),u=-g.dot(m),d=g.lengthSq(),p=Math.abs(1-h*h);if(p>0)if(o=h*c-u,a=l*p,(n=h*u-c)>=0)if(o>=-a)if(o<=a){var v=1/p;s=(n*=v)*(n+h*(o*=v)+2*c)+o*(h*n+o+2*u)+d}else o=l,s=-(n=Math.max(0,-(h*o+c)))*n+o*(o+2*u)+d;else o=-l,s=-(n=Math.max(0,-(h*o+c)))*n+o*(o+2*u)+d;else o<=-a?s=-(n=Math.max(0,-(-h*l+c)))*n+(o=n>0?-l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d:o<=a?(n=0,s=(o=Math.min(Math.max(-l,-u),l))*(o+2*u)+d):s=-(n=Math.max(0,-(h*l+c)))*n+(o=n>0?l:Math.min(Math.max(-l,-u),l))*(o+2*u)+d;else o=h>0?-l:l,s=-(n=Math.max(0,-(h*o+c)))*n+o*(o+2*u)+d;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(m).multiplyScalar(o).add(f),s}),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new K.Vector3;return function(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),n=e.dot(e)-r*r,o=t.radius*t.radius;if(n>o)return null;var s=Math.sqrt(o-n),a=r-s,l=r+s;return a<0&&l<0?null:a<0?this.at(l,i):this.at(a,i)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},isIntersectionBox:(p=new K.Vector3,function(e){return null!==this.intersectBox(e,p)}),intersectBox:function(e,t){var i,r,n,o,s,a,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,r=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,r=(e.min.x-u.x)*l),h>=0?(n=(e.min.y-u.y)*h,o=(e.max.y-u.y)*h):(n=(e.max.y-u.y)*h,o=(e.min.y-u.y)*h),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),c>=0?(s=(e.min.z-u.z)*c,a=(e.max.z-u.z)*c):(s=(e.max.z-u.z)*c,a=(e.min.z-u.z)*c),i>a||s>r?null:((s>i||i!=i)&&(i=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(i>=0?i:r,t)))},intersectTriangle:function(){var e=new K.Vector3,t=new K.Vector3,i=new K.Vector3,r=new K.Vector3;return function(n,o,s,a,l){t.subVectors(o,n),i.subVectors(s,n),r.crossVectors(t,i);var h,c=this.direction.dot(r);if(c>0){if(a)return null;h=1}else{if(!(c<0))return null;h=-1,c=-c}e.subVectors(this.origin,n);var u=h*this.direction.dot(i.crossVectors(e,i));if(u<0)return null;var d=h*this.direction.dot(t.cross(e));if(d<0)return null;if(u+d>c)return null;var p=-h*e.dot(r);return p<0?null:this.at(p/c,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new K.Ray).copy(this)}},K.Sphere=function(e,t){this.center=void 0!==e?e:new K.Vector3,this.radius=void 0!==t?t:0},K.Sphere.prototype={constructor:K.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(v=new K.Box3,function(e,t){var i=this.center;void 0!==t?i.copy(t):v.setFromPoints(e).getCenter(i);for(var r=0,n=0,o=e.length;n<o;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new K.Vector3;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new K.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new K.Sphere).copy(this)}},K.Frustum=function(e,t,i,r,n,o){this.planes=[void 0!==e?e:new K.Plane,void 0!==t?t:new K.Plane,void 0!==i?i:new K.Plane,void 0!==r?r:new K.Plane,void 0!==n?n:new K.Plane,void 0!==o?o:new K.Plane]},K.Frustum.prototype={constructor:K.Frustum,set:function(e,t,i,r,n,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(r),s[4].copy(n),s[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(s-r,c-a,f-u,y-m).normalize(),t[1].setComponents(s+r,c+a,f+u,y+m).normalize(),t[2].setComponents(s+n,c+l,f+d,y+g).normalize(),t[3].setComponents(s-n,c-l,f-d,y-g).normalize(),t[4].setComponents(s-o,c-h,f-p,y-v).normalize(),t[5].setComponents(s+o,c+h,f+p,y+v).normalize(),this},intersectsObject:(x=new K.Sphere,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),x.copy(t.boundingSphere),x.applyMatrix4(e.matrixWorld),this.intersectsSphere(x)}),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:(y=new K.Vector3,b=new K.Vector3,function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];y.x=r.normal.x>0?e.min.x:e.max.x,b.x=r.normal.x>0?e.max.x:e.min.x,y.y=r.normal.y>0?e.min.y:e.max.y,b.y=r.normal.y>0?e.max.y:e.min.y,y.z=r.normal.z>0?e.min.z:e.max.z,b.z=r.normal.z>0?e.max.z:e.min.z;var n=r.distanceToPoint(y),o=r.distanceToPoint(b);if(n<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new K.Frustum).copy(this)}},K.Plane=function(e,t){this.normal=void 0!==e?e:new K.Vector3(1,0,0),this.constant=void 0!==t?t:0},K.Plane.prototype={constructor:K.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new K.Vector3,t=new K.Vector3;return function(i,r,n){var o=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new K.Vector3).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectLine:function(){var e=new K.Vector3;return function(t,i){var r=i||new K.Vector3,n=t.delta(e),o=this.normal.dot(n);if(0==o)return 0==this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return s<0||s>1?void 0:r.copy(n).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){return(e||new K.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new K.Vector3,t=new K.Vector3,i=new K.Matrix3;return function(r,n){var o=n||i.getNormalMatrix(r),s=e.copy(this.normal).applyMatrix3(o);s.normalize();var a=this.coplanarPoint(t);return a.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(s,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new K.Plane).copy(this)}},K.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8==n||13==n||18==n||23==n?i[n]="-":14==n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19==n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return e<t?t:e>i?i:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return Math.floor(this.randFloat(e,t))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:(E=Math.PI/180,function(e){return e*E}),radToDeg:(_=180/Math.PI,function(e){return e*_}),isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},K.Spline=function(e){this.points=e;var t,i,r,n,o,s,a,l,h,c=[],u={x:0,y:0,z:0};function d(e,t,i,r,n,o,s){var a=.5*(i-e),l=.5*(r-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*n+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,i=Math.floor(t),r=t-i,c[0]=0===i?i:i-1,c[1]=i,c[2]=i>this.points.length-2?this.points.length-1:i+1,c[3]=i>this.points.length-3?this.points.length-1:i+2,s=this.points[c[0]],a=this.points[c[1]],l=this.points[c[2]],h=this.points[c[3]],o=r*(n=r*r),u.x=d(s.x,a.x,l.x,h.x,r,n,o),u.y=d(s.y,a.y,l.y,h.y,r,n,o),u.z=d(s.z,a.z,l.z,h.z,r,n,o),u},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,n,o=0,s=0,a=0,l=new K.Vector3,h=new K.Vector3,c=[],u=0;for(c[0]=0,e||(e=100),r=this.points.length*e,l.copy(this.points[0]),t=1;t<r;t++)i=t/r,n=this.getPoint(i),h.copy(n),u+=h.distanceTo(l),l.copy(n),o=(this.points.length-1)*i,(s=Math.floor(o))!=a&&(c[s]=u,a=s);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(e){var t,i,r,n,o,s,a,l,h=[],c=new K.Vector3,u=this.getLength();for(h.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=u.chunks[t]-u.chunks[t-1],a=Math.ceil(e*s/u.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;i<a-1;i++)r=n+i*(1/a)*(o-n),l=this.getPoint(r),h.push(c.copy(l).clone());h.push(c.copy(this.points[t]).clone())}this.points=h}},K.Triangle=function(e,t,i){this.a=void 0!==e?e:new K.Vector3,this.b=void 0!==t?t:new K.Vector3,this.c=void 0!==i?i:new K.Vector3},K.Triangle.normal=(A=new K.Vector3,function(e,t,i,r){var n=r||new K.Vector3;n.subVectors(i,t),A.subVectors(e,t),n.cross(A);var o=n.lengthSq();return o>0?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)}),K.Triangle.barycoordFromPoint=function(){var e=new K.Vector3,t=new K.Vector3,i=new K.Vector3;return function(r,n,o,s,a){e.subVectors(s,n),t.subVectors(o,n),i.subVectors(r,n);var l=e.dot(e),h=e.dot(t),c=e.dot(i),u=t.dot(t),d=t.dot(i),p=l*u-h*h,f=a||new K.Vector3;if(0==p)return f.set(-2,-1,-1);var m=1/p,g=(u*c-h*d)*m,v=(l*d-h*c)*m;return f.set(1-g-v,v,g)}}(),K.Triangle.containsPoint=function(){var e=new K.Vector3;return function(t,i,r,n){var o=K.Triangle.barycoordFromPoint(t,i,r,n,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),K.Triangle.prototype={constructor:K.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new K.Vector3,t=new K.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new K.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return K.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new K.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return K.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return K.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new K.Triangle).copy(this)}},K.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},K.Clock.prototype={constructor:K.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},K.EventDispatcher=function(){},K.EventDispatcher.prototype={constructor:K.EventDispatcher,apply:function(e){e.addEventListener=K.EventDispatcher.prototype.addEventListener,e.hasEventListener=K.EventDispatcher.prototype.hasEventListener,e.removeEventListener=K.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=K.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=[],r=t.length,n=0;n<r;n++)i[n]=t[n];for(n=0;n<r;n++)i[n].call(this,e)}}}},function(e){e.Raycaster=function(t,i,r,n){this.ray=new e.Ray(t,i),this.near=r||0,this.far=n||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{threshold:1}}};var t=function(e,t){return e.distance-t.distance},i=function(e,t,r,n){if(e.raycast(t,r),!0===n)for(var o=e.children,s=0,a=o.length;s<a;s++)i(o[s],t,r,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,i){i instanceof e.PerspectiveCamera?(this.ray.origin.copy(i.position),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(i.position).normalize()):i instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld)):e.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,r){var n=[];return i(e,this,n,r),n.sort(t),n},intersectObjects:function(r,n){var o=[];if(r instanceof Array==!1)return e.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),o;for(var s=0,a=r.length;s<a;s++)i(r[s],this,o,n);return o.sort(t),o}},Object.defineProperty(e.Raycaster.prototype,"linePrecision",{get:function(){return console.warn("THREE.Raycaster: .linePrecision is now .params.Line.threshold."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision is now .params.Line.threshold."),this.params.Line.threshold=e}})}(K),K.Object3D=function(){Object.defineProperty(this,"id",{value:K.Object3DIdCount++}),this.uuid=K.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=K.Object3D.DefaultUp.clone();var e=new K.Vector3,t=new K.Euler,i=new K.Quaternion,r=new K.Vector3(1,1,1);t.onChange((function(){i.setFromEuler(t,!1)})),i.onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:r}}),this.rotationAutoUpdate=!0,this.matrix=new K.Matrix4,this.matrixWorld=new K.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},K.Object3D.DefaultUp=new K.Vector3(0,1,0),K.Object3D.prototype={constructor:K.Object3D,get eulerOrder(){return K.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){K.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){K.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){K.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(T=new K.Quaternion,function(e,t){return T.setFromAxisAngle(e,t),this.quaternion.multiply(T),this}),rotateX:function(){var e=new K.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new K.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new K.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new K.Vector3;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translate:function(e,t){return K.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new K.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new K.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new K.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(M=new K.Matrix4,function(e){return e.applyMatrix4(M.getInverse(this.matrixWorld))}),lookAt:function(){var e=new K.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(K.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof K.Object3D?(void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):K.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var i=this.children.indexOf(e);-1!==i&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getChildByName:function(e){return K.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){var t=e||new K.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(S=new K.Vector3,w=new K.Vector3,function(e){var t=e||new K.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(S,t,w),t}),getWorldRotation:function(){var e=new K.Quaternion;return function(t){var i=t||new K.Euler;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new K.Vector3,t=new K.Quaternion;return function(i){var r=i||new K.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new K.Quaternion;return function(t){var i=t||new K.Vector3;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=0,i=this.children.length;t<i;t++)this.children[t].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=0,i=this.children.length;t<i;t++)this.children[t].traverseVisible(e)}},traverseAncestors:function(e){this.parent&&(e(this.parent),this.parent.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},t={},i={},r=function(t){if(void 0===e.materials&&(e.materials=[]),void 0===i[t.uuid]){var r=t.toJSON();delete r.metadata,i[t.uuid]=r,e.materials.push(r)}return t.uuid},n=function(i){var o={};if(o.uuid=i.uuid,o.type=i.type,""!==i.name&&(o.name=i.name),"{}"!==JSON.stringify(i.userData)&&(o.userData=i.userData),!0!==i.visible&&(o.visible=i.visible),i instanceof K.PerspectiveCamera?(o.fov=i.fov,o.aspect=i.aspect,o.near=i.near,o.far=i.far):i instanceof K.OrthographicCamera?(o.left=i.left,o.right=i.right,o.top=i.top,o.bottom=i.bottom,o.near=i.near,o.far=i.far):i instanceof K.AmbientLight?o.color=i.color.getHex():i instanceof K.DirectionalLight?(o.color=i.color.getHex(),o.intensity=i.intensity):i instanceof K.PointLight?(o.color=i.color.getHex(),o.intensity=i.intensity,o.distance=i.distance,o.decay=i.decay):i instanceof K.SpotLight?(o.color=i.color.getHex(),o.intensity=i.intensity,o.distance=i.distance,o.angle=i.angle,o.exponent=i.exponent,o.decay=i.decay):i instanceof K.HemisphereLight?(o.color=i.color.getHex(),o.groundColor=i.groundColor.getHex()):i instanceof K.Mesh||i instanceof K.Line||i instanceof K.PointCloud?(o.geometry=function(i){if(void 0===e.geometries&&(e.geometries=[]),void 0===t[i.uuid]){var r=i.toJSON();delete r.metadata,t[i.uuid]=r,e.geometries.push(r)}return i.uuid}(i.geometry),o.material=r(i.material),i instanceof K.Line&&(o.mode=i.mode)):i instanceof K.Sprite&&(o.material=r(i.material)),o.matrix=i.matrix.toArray(),i.children.length>0){o.children=[];for(var s=0;s<i.children.length;s++)o.children.push(n(i.children[s]))}return o};return e.object=n(this),e},clone:function(e,t){if(void 0===e&&(e=new K.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),!0===t)for(var i=0;i<this.children.length;i++){var r=this.children[i];e.add(r.clone())}return e}},K.EventDispatcher.prototype.apply(K.Object3D.prototype),K.Object3DIdCount=0,K.Face3=function(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r instanceof K.Vector3?r:new K.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=n instanceof K.Color?n:new K.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},K.Face3.prototype={constructor:K.Face3,clone:function(){var e=new K.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var t=0,i=this.vertexNormals.length;t<i;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;t<i;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;t<i;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},K.Face4=function(e,t,i,r,n,o,s){return K.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new K.Face3(e,t,i,n,o,s)},K.BufferAttribute=function(e,t){this.array=e,this.itemSize=t,this.count=null!=e?e.length/t:0,this.needsUpdate=!1},K.BufferAttribute.prototype={constructor:K.BufferAttribute,get length(){return this.array.length},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},setX:function(e,t){return this.array[e*this.itemSize]=t,this},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},clone:function(){return new K.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},K.Int8Attribute=function(e,t){return K.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Uint8Attribute=function(e,t){return K.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Uint8ClampedAttribute=function(e,t){return K.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Int16Attribute=function(e,t){return K.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Uint16Attribute=function(e,t){return K.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Int32Attribute=function(e,t){return K.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Uint32Attribute=function(e,t){return K.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Float32Attribute=function(e,t){return K.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.Float64Attribute=function(e,t){return K.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new K.BufferAttribute(e,t)},K.DynamicBufferAttribute=function(e,t){K.BufferAttribute.call(this,e,t),this.updateRange={offset:0,count:-1}},K.DynamicBufferAttribute.prototype=Object.create(K.BufferAttribute.prototype),K.DynamicBufferAttribute.prototype.constructor=K.DynamicBufferAttribute,K.DynamicBufferAttribute.prototype.clone=function(){return new K.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)},K.BufferGeometry=function(){Object.defineProperty(this,"id",{value:K.GeometryIdCount++}),this.uuid=K.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},K.BufferGeometry.prototype={constructor:K.BufferGeometry,addAttribute:function(e,t){console.warn("BufferGeometry.addAttribute() is deprecated. Use BufferGeometry.setAttribute() instead."),this.setAttribute(e,t)},setAttribute:function(e,t){if(t instanceof K.BufferAttribute==!1)return K.warn("THREE.BufferGeometry: .setAttribute() now expects ( name, attribute )."),void(this.attributes[e]={array:arguments[1],itemSize:arguments[2]});this.attributes[e]=t,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,i){this.drawcalls.push({start:e,count:t,index:void 0!==i?i:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new K.Matrix3).getNormalMatrix(e).applyToVector3Array(i.array),i.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.applyMatrix((new K.Matrix4).setPosition(e)),e},fromGeometry:function(e,t){t=t||{vertexColors:K.NoColors};var i=e.vertices,r=e.faces,n=e.faceVertexUvs,o=t.vertexColors,s=n[0].length>0,a=3==r[0].vertexNormals.length,l=new Float32Array(3*r.length*3);this.setAttribute("position",new K.BufferAttribute(l,3));var h=new Float32Array(3*r.length*3);if(this.setAttribute("normal",new K.BufferAttribute(h,3)),o!==K.NoColors){var c=new Float32Array(3*r.length*3);this.setAttribute("color",new K.BufferAttribute(c,3))}if(!0===s){var u=new Float32Array(3*r.length*2);this.setAttribute("uv",new K.BufferAttribute(u,2))}for(var d=0,p=0,f=0;d<r.length;d++,p+=6,f+=9){var m=r[d],g=i[m.a],v=i[m.b],y=i[m.c];if(l[f]=g.x,l[f+1]=g.y,l[f+2]=g.z,l[f+3]=v.x,l[f+4]=v.y,l[f+5]=v.z,l[f+6]=y.x,l[f+7]=y.y,l[f+8]=y.z,!0===a){var b=m.vertexNormals[0],x=m.vertexNormals[1],_=m.vertexNormals[2];h[f]=b.x,h[f+1]=b.y,h[f+2]=b.z,h[f+3]=x.x,h[f+4]=x.y,h[f+5]=x.z,h[f+6]=_.x,h[f+7]=_.y,h[f+8]=_.z}else{var E=m.normal;h[f]=E.x,h[f+1]=E.y,h[f+2]=E.z,h[f+3]=E.x,h[f+4]=E.y,h[f+5]=E.z,h[f+6]=E.x,h[f+7]=E.y,h[f+8]=E.z}if(o===K.FaceColors){var A=m.color;c[f]=A.r,c[f+1]=A.g,c[f+2]=A.b,c[f+3]=A.r,c[f+4]=A.g,c[f+5]=A.b,c[f+6]=A.r,c[f+7]=A.g,c[f+8]=A.b}else if(o===K.VertexColors){var S=m.vertexColors[0],w=m.vertexColors[1],M=m.vertexColors[2];c[f]=S.r,c[f+1]=S.g,c[f+2]=S.b,c[f+3]=w.r,c[f+4]=w.g,c[f+5]=w.b,c[f+6]=M.r,c[f+7]=M.g,c[f+8]=M.b}if(!0===s){var T=n[0][d][0],C=n[0][d][1],P=n[0][d][2];u[p]=T.x,u[p+1]=T.y,u[p+2]=C.x,u[p+3]=C.y,u[p+4]=P.x,u[p+5]=P.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new K.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new K.Box3);var t=this.attributes.position.array;if(t){var i=this.boundingBox;i.makeEmpty();for(var r=0,n=t.length;r<n;r+=3)e.set(t[r],t[r+1],t[r+2]),i.expandByPoint(e)}void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&K.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new K.Box3,t=new K.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new K.Sphere);var i=this.attributes.position.array;if(i){e.makeEmpty();for(var r=this.boundingSphere.center,n=0,o=i.length;n<o;n+=3)t.set(i[n],i[n+1],i[n+2]),e.expandByPoint(t);e.getCenter(r);var s=0;for(n=0,o=i.length;n<o;n+=3)t.set(i[n],i[n+1],i[n+2]),s=Math.max(s,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&K.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var t=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new K.BufferAttribute(new Float32Array(t.length),3));else for(var i=0,r=(a=e.normal.array).length;i<r;i++)a[i]=0;var n,o,s,a=e.normal.array,l=new K.Vector3,h=new K.Vector3,c=new K.Vector3,u=new K.Vector3,d=new K.Vector3;if(e.index)for(var p=e.index.array,f=this.offsets.length>0?this.offsets:[{start:0,count:p.length,index:0}],m=0,g=f.length;m<g;++m){var v=f[m].start,y=f[m].count,b=f[m].index;for(i=v,r=v+y;i<r;i+=3)n=3*(b+p[i]),o=3*(b+p[i+1]),s=3*(b+p[i+2]),l.fromArray(t,n),h.fromArray(t,o),c.fromArray(t,s),u.subVectors(c,h),d.subVectors(l,h),u.cross(d),a[n]+=u.x,a[n+1]+=u.y,a[n+2]+=u.z,a[o]+=u.x,a[o+1]+=u.y,a[o+2]+=u.z,a[s]+=u.x,a[s+1]+=u.y,a[s+2]+=u.z}else for(i=0,r=t.length;i<r;i+=9)l.fromArray(t,i),h.fromArray(t,i+3),c.fromArray(t,i+6),u.subVectors(c,h),d.subVectors(l,h),u.cross(d),a[i]=u.x,a[i+1]=u.y,a[i+2]=u.z,a[i+3]=u.x,a[i+4]=u.y,a[i+5]=u.z,a[i+6]=u.x,a[i+7]=u.y,a[i+8]=u.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,i=this.attributes.normal.array,r=this.attributes.uv.array,n=t.length/3;void 0===this.attributes.tangent&&this.setAttribute("tangent",new K.BufferAttribute(new Float32Array(4*n),4));for(var o=this.attributes.tangent.array,s=[],a=[],l=0;l<n;l++)s[l]=new K.Vector3,a[l]=new K.Vector3;var h,c,u,d,p,f,m,g,v,y,b,x,_,E,A,S,w,M,T=new K.Vector3,C=new K.Vector3,P=new K.Vector3,D=new K.Vector2,L=new K.Vector2,I=new K.Vector2,R=new K.Vector3,O=new K.Vector3;0===this.drawcalls.length&&this.addDrawCall(0,e.length,0);var N,F,k,V=this.drawcalls;for(E=0,A=V.length;E<A;++E){var U=V[E].start,B=V[E].count,G=V[E].index;for(x=U,_=U+B;x<_;x+=3)S=G+e[x],w=G+e[x+1],M=G+e[x+2],N=S,F=w,k=M,T.fromArray(t,3*N),C.fromArray(t,3*F),P.fromArray(t,3*k),D.fromArray(r,2*N),L.fromArray(r,2*F),I.fromArray(r,2*k),h=C.x-T.x,c=P.x-T.x,u=C.y-T.y,d=P.y-T.y,p=C.z-T.z,f=P.z-T.z,m=L.x-D.x,g=I.x-D.x,v=L.y-D.y,y=I.y-D.y,b=1/(m*y-g*v),R.set((y*h-v*c)*b,(y*u-v*d)*b,(y*p-v*f)*b),O.set((m*c-g*h)*b,(m*d-g*u)*b,(m*f-g*p)*b),s[N].add(R),s[F].add(R),s[k].add(R),a[N].add(O),a[F].add(O),a[k].add(O)}var z,H,W,j=new K.Vector3,q=new K.Vector3,X=new K.Vector3,Y=new K.Vector3;for(E=0,A=V.length;E<A;++E){U=V[E].start,B=V[E].count,G=V[E].index;for(x=U,_=U+B;x<_;x+=3)S=G+e[x],w=G+e[x+1],M=G+e[x+2],Q(S),Q(w),Q(M)}}else K.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function Q(e){X.fromArray(i,3*e),Y.copy(X),H=s[e],j.copy(H),j.sub(X.multiplyScalar(X.dot(H))).normalize(),q.crossVectors(Y,H),W=q.dot(a[e]),z=W<0?-1:1,o[4*e]=j.x,o[4*e+1]=j.y,o[4*e+2]=j.z,o[4*e+3]=z}},computeOffsets:function(e){void 0===e&&(e=65535);for(var t=this.attributes.index.array,i=this.attributes.position.array,r=t.length/3,n=new Uint16Array(t.length),o=0,s=0,a=[{start:0,count:0,index:0}],l=a[0],h=0,c=new Int32Array(6),u=new Int32Array(i.length),d=new Int32Array(i.length),p=0;p<i.length;p++)u[p]=-1,d[p]=-1;for(var f=0;f<r;f++){h=0;for(var m=0;m<3;m++){-1==u[b=t[3*f+m]]?(c[2*m]=b,c[2*m+1]=-1,h++):u[b]<l.index?(c[2*m]=b,c[2*m+1]=-1):(c[2*m]=b,c[2*m+1]=u[b])}if(s+h>l.index+e){var g={start:o,count:0,index:s};a.push(g),l=g;for(var v=0;v<6;v+=2){(y=c[v+1])>-1&&y<l.index&&(c[v+1]=-1)}}for(v=0;v<6;v+=2){var y,b=c[v];-1===(y=c[v+1])&&(y=s++),u[b]=y,d[y]=b,n[o++]=y-l.index,l.count++}}return this.reorderBuffers(n,d,s),this.offsets=a,this.drawcalls=a,a},merge:function(e,t){if(e instanceof K.BufferGeometry!=!1){void 0===t&&(t=0);var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,o=e.attributes[r],s=o.array,a=0,l=o.itemSize*t;a<s.length;a++,l++)n[l]=s[a];return this}K.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e,t,i,r,n=this.attributes.normal.array,o=0,s=n.length;o<s;o+=3)e=n[o],t=n[o+1],i=n[o+2],r=1/Math.sqrt(e*e+t*t+i*i),n[o]*=r,n[o+1]*=r,n[o+2]*=r},reorderBuffers:function(e,t,i){var r={};for(var n in this.attributes)if("index"!=n){var o=this.attributes[n].array;r[n]=new o.constructor(this.attributes[n].itemSize*i)}for(var s=0;s<i;s++){var a=t[s];for(var n in this.attributes)if("index"!=n)for(var l=this.attributes[n].array,h=this.attributes[n].itemSize,c=r[n],u=0;u<h;u++)c[s*h+u]=l[a*h+u]}for(var n in this.attributes.index.array=e,this.attributes)"index"!=n&&(this.attributes[n].array=r[n],this.attributes[n].numItems=this.attributes[n].itemSize*i)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},t=this.attributes,i=this.offsets,r=this.boundingSphere;for(var n in t){var o=t[n],s=Array.prototype.slice.call(o.array);e.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:s}}return i.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(i))),null!==r&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e},clone:function(){var e=new K.BufferGeometry;for(var t in this.attributes){var i=this.attributes[t];e.setAttribute(t,i.clone())}for(var r=0,n=this.offsets.length;r<n;r++){var o=this.offsets[r];e.offsets.push({start:o.start,index:o.index,count:o.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},K.EventDispatcher.prototype.apply(K.BufferGeometry.prototype),K.Geometry=function(){Object.defineProperty(this,"id",{value:K.GeometryIdCount++}),this.uuid=K.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},K.Geometry.prototype={constructor:K.Geometry,applyMatrix:function(e){for(var t=(new K.Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,s=n.vertexNormals.length;o<s;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},fromBufferGeometry:function(e){for(var t=this,i=e.attributes,r=i.position.array,n=void 0!==i.index?i.index.array:void 0,o=void 0!==i.normal?i.normal.array:void 0,s=void 0!==i.color?i.color.array:void 0,a=void 0!==i.uv?i.uv.array:void 0,l=[],h=[],c=0,u=0;c<r.length;c+=3,u+=2)t.vertices.push(new K.Vector3(r[c],r[c+1],r[c+2])),void 0!==o&&l.push(new K.Vector3(o[c],o[c+1],o[c+2])),void 0!==s&&t.colors.push(new K.Color(s[c],s[c+1],s[c+2])),void 0!==a&&h.push(new K.Vector2(a[u],a[u+1]));var d=function(e,i,r){var n=void 0!==o?[l[e].clone(),l[i].clone(),l[r].clone()]:[],c=void 0!==s?[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()]:[];t.faces.push(new K.Face3(e,i,r,n,c)),void 0!==a&&t.faceVertexUvs[0].push([h[e].clone(),h[i].clone(),h[r].clone()])};if(void 0!==n){var p=e.drawcalls;if(p.length>0)for(c=0;c<p.length;c++)for(var f=p[c],m=f.start,g=f.count,v=f.index,y=(u=m,m+g);u<y;u+=3)d(v+n[u],v+n[u+1],v+n[u+2]);else for(c=0;c<n.length;c+=3)d(n[c],n[c+1],n[c+2])}else for(c=0;c<r.length/3;c+=3)d(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.applyMatrix((new K.Matrix4).setPosition(e)),e},computeFaceNormals:function(){for(var e=new K.Vector3,t=new K.Vector3,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],s=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,o,s;for(s=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)s[t]=new K.Vector3;if(e){var a,l,h,c=new K.Vector3,u=new K.Vector3;for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],a=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c],c.subVectors(h,l),u.subVectors(a,l),c.cross(u),s[o.a].add(c),s[o.b].add(c),s[o.c].add(c)}else for(r=0,n=this.faces.length;r<n;r++)s[(o=this.faces[r]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)s[t].normalize();for(r=0,n=this.faces.length;r<n;r++)(o=this.faces[r]).vertexNormals[0]=s[o.a].clone(),o.vertexNormals[1]=s[o.b].clone(),o.vertexNormals[2]=s[o.c].clone()},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new K.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)l=new K.Vector3,h={a:new K.Vector3,b:new K.Vector3,c:new K.Vector3},s.push(l),a.push(h)}var l,h,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)n=this.faces[i],l=c.faceNormals[i],h=c.vertexNormals[i],l.copy(n.normal),h.a.copy(n.vertexNormals[0]),h.b.copy(n.vertexNormals[1]),h.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){var e,t,i,r,n,o,s,a,l,h,c,u,d,p,f,m,g,v,y,b,x,_,E,A,S,w,M,T,C,P,D,L,I,R,O=[],N=[],F=new K.Vector3,k=new K.Vector3,V=new K.Vector3,U=new K.Vector3,B=new K.Vector3;for(i=0,r=this.vertices.length;i<r;i++)O[i]=new K.Vector3,N[i]=new K.Vector3;for(e=0,t=this.faces.length;e<t;e++)s=this.faces[e],a=this.faceVertexUvs[0][e],T=this,C=s.a,P=s.b,D=s.c,L=0,I=1,R=2,l=T.vertices[C],h=T.vertices[P],c=T.vertices[D],u=a[L],d=a[I],p=a[R],f=h.x-l.x,m=c.x-l.x,g=h.y-l.y,v=c.y-l.y,y=h.z-l.z,b=c.z-l.z,x=d.x-u.x,_=p.x-u.x,E=d.y-u.y,A=p.y-u.y,S=1/(x*A-_*E),F.set((A*f-E*m)*S,(A*g-E*v)*S,(A*y-E*b)*S),k.set((x*m-_*f)*S,(x*v-_*g)*S,(x*b-_*y)*S),O[C].add(F),O[P].add(F),O[D].add(F),N[C].add(k),N[P].add(k),N[D].add(k);var G=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(s=this.faces[e],n=0;n<Math.min(s.vertexNormals.length,3);n++)B.copy(s.vertexNormals[n]),o=s[G[n]],w=O[o],V.copy(w),V.sub(B.multiplyScalar(B.dot(w))).normalize(),U.crossVectors(s.vertexNormals[n],w),M=U.dot(N[o])<0?-1:1,s.vertexTangents[n]=new K.Vector4(V.x,V.y,V.z,M);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new K.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new K.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e instanceof K.Geometry!=!1){var r,n=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,h=this.faceVertexUvs[0],c=e.faceVertexUvs[0];void 0===i&&(i=0),void 0!==t&&(r=(new K.Matrix3).getNormalMatrix(t));for(var u=0,d=s.length;u<d;u++){var p=s[u].clone();void 0!==t&&p.applyMatrix4(t),o.push(p)}for(u=0,d=l.length;u<d;u++){var f,m,g,v=l[u],y=v.vertexNormals,b=v.vertexColors;(f=new K.Face3(v.a+n,v.b+n,v.c+n)).normal.copy(v.normal),void 0!==r&&f.normal.applyMatrix3(r).normalize();for(var x=0,_=y.length;x<_;x++)m=y[x].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),f.vertexNormals.push(m);f.color.copy(v.color);for(x=0,_=b.length;x<_;x++)g=b[x],f.vertexColors.push(g.clone());f.materialIndex=v.materialIndex+i,a.push(f)}for(u=0,d=c.length;u<d;u++){var E=c[u],A=[];if(void 0!==E){for(x=0,_=E.length;x<_;x++)A.push(E[x].clone());h.push(A)}}}else K.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e instanceof K.Mesh!=!1?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):K.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,r,n,o,s,a,l={},h=[],c=[],u=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===l[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(l[t]=i,h.push(this.vertices[i]),c[i]=h.length-1):c[i]=c[l[t]];var d=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=c[n.a],n.b=c[n.b],n.c=c[n.c],o=[n.a,n.b,n.c];for(var p=0;p<3;p++)if(o[p]==o[(p+1)%3]){p,d.push(i);break}}for(i=d.length-1;i>=0;i--){var f=d[i];for(this.faces.splice(f,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-h.length;return this.vertices=h,m},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];r.push(o.x,o.y,o.z)}var s=[],a=[],l={},h=[],c={},u=[],d={};for(n=0;n<this.faces.length;n++){var p=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=p.normal.length()>0,g=p.vertexNormals.length>0,v=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,b=0;if(b=A(b,0,0),b=A(b,1,!1),b=A(b,2,!1),b=A(b,3,f),b=A(b,4,m),b=A(b,5,g),b=A(b,6,v),b=A(b,7,y),s.push(b),s.push(p.a,p.b,p.c),f){var x=this.faceVertexUvs[0][n];s.push(M(x[0]),M(x[1]),M(x[2]))}if(m&&s.push(S(p.normal)),g){var _=p.vertexNormals;s.push(S(_[0]),S(_[1]),S(_[2]))}if(v&&s.push(w(p.color)),y){var E=p.vertexColors;s.push(w(E[0]),w(E[1]),w(E[2]))}}function A(e,t,i){return i?e|1<<t:e&~(1<<t)}function S(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=a.length/3,a.push(e.x,e.y,e.z)),l[t]}function w(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=h.length,h.push(e.getHex())),c[t]}function M(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=u.length/2,u.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=a,h.length>0&&(e.data.colors=h),u.length>0&&(e.data.uvs=[u]),e.data.faces=s,e},clone:function(){for(var e=new K.Geometry,t=this.vertices,i=0,r=t.length;i<r;i++)e.vertices.push(t[i].clone());var n=this.faces;for(i=0,r=n.length;i<r;i++)e.faces.push(n[i].clone());for(i=0,r=this.faceVertexUvs.length;i<r;i++){var o=this.faceVertexUvs[i];void 0===e.faceVertexUvs[i]&&(e.faceVertexUvs[i]=[]);for(var s=0,a=o.length;s<a;s++){for(var l=o[s],h=[],c=0,u=l.length;c<u;c++){var d=l[c];h.push(d.clone())}e.faceVertexUvs[i].push(h)}}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},K.EventDispatcher.prototype.apply(K.Geometry.prototype),K.GeometryIdCount=0,K.Camera=function(){K.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new K.Matrix4,this.projectionMatrix=new K.Matrix4},K.Camera.prototype=Object.create(K.Object3D.prototype),K.Camera.prototype.constructor=K.Camera,K.Camera.prototype.getWorldDirection=function(){var e=new K.Quaternion;return function(t){var i=t||new K.Vector3;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),K.Camera.prototype.lookAt=function(){var e=new K.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),K.Camera.prototype.clone=function(e){return void 0===e&&(e=new K.Camera),K.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},K.CubeCamera=function(e,t,i){K.Object3D.call(this),this.type="CubeCamera";var r=90,n=new K.PerspectiveCamera(r,1,e,t);n.up.set(0,-1,0),n.lookAt(new K.Vector3(1,0,0)),this.add(n);var o=new K.PerspectiveCamera(r,1,e,t);o.up.set(0,-1,0),o.lookAt(new K.Vector3(-1,0,0)),this.add(o);var s=new K.PerspectiveCamera(r,1,e,t);s.up.set(0,0,1),s.lookAt(new K.Vector3(0,1,0)),this.add(s);var a=new K.PerspectiveCamera(r,1,e,t);a.up.set(0,0,-1),a.lookAt(new K.Vector3(0,-1,0)),this.add(a);var l=new K.PerspectiveCamera(r,1,e,t);l.up.set(0,-1,0),l.lookAt(new K.Vector3(0,0,1)),this.add(l);var h=new K.PerspectiveCamera(r,1,e,t);h.up.set(0,-1,0),h.lookAt(new K.Vector3(0,0,-1)),this.add(h),this.renderTarget=new K.WebGLRenderTargetCube(i,i,{format:K.RGBFormat,magFilter:K.LinearFilter,minFilter:K.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,r=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,n,i),i.activeCubeFace=1,e.render(t,o,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,a,i),i.activeCubeFace=4,e.render(t,l,i),i.generateMipmaps=r,i.activeCubeFace=5,e.render(t,h,i)}},K.CubeCamera.prototype=Object.create(K.Object3D.prototype),K.CubeCamera.prototype.constructor=K.CubeCamera,K.OrthographicCamera=function(e,t,i,r,n,o){K.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},K.OrthographicCamera.prototype=Object.create(K.Camera.prototype),K.OrthographicCamera.prototype.constructor=K.OrthographicCamera,K.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(i-e,i+e,r+t,r-t,this.near,this.far)},K.OrthographicCamera.prototype.clone=function(){var e=new K.OrthographicCamera;return K.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},K.PerspectiveCamera=function(e,t,i,r){K.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},K.PerspectiveCamera.prototype=Object.create(K.Camera.prototype),K.PerspectiveCamera.prototype.constructor=K.PerspectiveCamera,K.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*K.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},K.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=r,this.width=n,this.height=o,this.updateProjectionMatrix()},K.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=K.Math.radToDeg(2*Math.atan(Math.tan(.5*K.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(K.Math.degToRad(.5*e))*this.near,r=-i,n=t*r,o=t*i,s=Math.abs(o-n),a=Math.abs(i-r);this.projectionMatrix.makeFrustum(n+this.x*s/this.fullWidth,n+(this.x+this.width)*s/this.fullWidth,i-(this.y+this.height)*a/this.fullHeight,i-this.y*a/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},K.PerspectiveCamera.prototype.clone=function(){var e=new K.PerspectiveCamera;return K.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},K.Light=function(e){K.Object3D.call(this),this.type="Light",this.color=new K.Color(e)},K.Light.prototype=Object.create(K.Object3D.prototype),K.Light.prototype.constructor=K.Light,K.Light.prototype.clone=function(e){return void 0===e&&(e=new K.Light),K.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},K.AmbientLight=function(e){K.Light.call(this,e),this.type="AmbientLight"},K.AmbientLight.prototype=Object.create(K.Light.prototype),K.AmbientLight.prototype.constructor=K.AmbientLight,K.AmbientLight.prototype.clone=function(){var e=new K.AmbientLight;return K.Light.prototype.clone.call(this,e),e},K.AreaLight=function(e,t){K.Light.call(this,e),this.type="AreaLight",this.normal=new K.Vector3(0,-1,0),this.right=new K.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},K.AreaLight.prototype=Object.create(K.Light.prototype),K.AreaLight.prototype.constructor=K.AreaLight,K.DirectionalLight=function(e,t){K.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new K.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new K.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},K.DirectionalLight.prototype=Object.create(K.Light.prototype),K.DirectionalLight.prototype.constructor=K.DirectionalLight,K.DirectionalLight.prototype.clone=function(){var e=new K.DirectionalLight;return K.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},K.HemisphereLight=function(e,t,i){K.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new K.Color(t),this.intensity=void 0!==i?i:1},K.HemisphereLight.prototype=Object.create(K.Light.prototype),K.HemisphereLight.prototype.constructor=K.HemisphereLight,K.HemisphereLight.prototype.clone=function(){var e=new K.HemisphereLight;return K.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},K.PointLight=function(e,t,i,r){K.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1},K.PointLight.prototype=Object.create(K.Light.prototype),K.PointLight.prototype.constructor=K.PointLight,K.PointLight.prototype.clone=function(){var e=new K.PointLight;return K.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decay=this.decay,e},K.SpotLight=function(e,t,i,r,n,o){K.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new K.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==n?n:10,this.decay=void 0!==o?o:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},K.SpotLight.prototype=Object.create(K.Light.prototype),K.SpotLight.prototype.constructor=K.SpotLight,K.SpotLight.prototype.clone=function(){var e=new K.SpotLight;return K.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decay=this.decay,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},K.Cache={files:{},add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},K.Loader=function(e){this.showStatus=e,this.statusDomElement=e?K.Loader.prototype.addStatusElement():null,this.imageLoader=new K.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},K.Loader.prototype={constructor:K.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var i=[],r=0;r<e.length;++r)i[r]=this.createMaterial(e[r],t);return i},needsTangents:function(e){for(var t=0,i=e.length;t<i;t++){if(e[t]instanceof K.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var i=this;function r(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function n(e,n,o,s,a,l,h){var c,u=t+o,d=K.Loader.Handlers.get(u);if(null!==d?c=d.load(u):(c=new K.Texture,(d=i.imageLoader).crossOrigin=i.crossOrigin,d.load(u,(function(e){if(!1===K.Math.isPowerOfTwo(e.width)||!1===K.Math.isPowerOfTwo(e.height)){var t=r(e.width),i=r(e.height),n=document.createElement("canvas");n.width=t,n.height=i,n.getContext("2d").drawImage(e,0,0,t,i),c.image=n}else c.image=e;c.needsUpdate=!0}))),c.sourceFile=o,s&&(c.repeat.set(s[0],s[1]),1!==s[0]&&(c.wrapS=K.RepeatWrapping),1!==s[1]&&(c.wrapT=K.RepeatWrapping)),a&&c.offset.set(a[0],a[1]),l){var p={repeat:K.RepeatWrapping,mirror:K.MirroredRepeatWrapping};void 0!==p[l[0]]&&(c.wrapS=p[l[0]]),void 0!==p[l[1]]&&(c.wrapT=p[l[1]])}h&&(c.anisotropy=h),e[n]=c}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?s="MeshPhongMaterial":"basic"===l&&(s="MeshBasicMaterial")}void 0!==e.blending&&void 0!==K[e.blending]&&(a.blending=K[e.blending]),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.opacity&&e.opacity<1&&(a.transparent=!0),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.flipSided&&(a.side=K.BackSide),void 0!==e.doubleSided&&(a.side=K.DoubleSide),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?a.vertexColors=K.FaceColors:e.vertexColors&&(a.vertexColors=K.VertexColors)),e.colorDiffuse?a.color=o(e.colorDiffuse):e.DbgColor&&(a.color=e.DbgColor),e.colorSpecular&&(a.specular=o(e.colorSpecular)),e.colorEmissive&&(a.emissive=o(e.colorEmissive)),void 0!==e.transparency&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),e.opacity=e.transparency),void 0!==e.opacity&&(a.opacity=e.opacity),e.specularCoef&&(a.shininess=e.specularCoef),e.mapDiffuse&&t&&n(a,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&n(a,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&n(a,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&n(a,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&n(a,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&t&&n(a,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(a.bumpScale=e.mapBumpScale),e.mapNormalFactor&&(a.normalScale=new K.Vector2(e.mapNormalFactor,e.mapNormalFactor));var h=new K[s](a);return void 0!==e.DbgName&&(h.name=e.DbgName),h}},K.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var r=this.handlers[t],n=this.handlers[t+1];if(r.test(e))return n}return null}},K.XHRLoader=function(e){this.manager=void 0!==e?e:K.DefaultLoadingManager},K.XHRLoader.prototype={constructor:K.XHRLoader,load:function(e,t,i,r){var n=this,o=K.Cache.get(e);if(void 0===o){var s=new XMLHttpRequest;s.open("GET",e,!0),s.addEventListener("load",(function(i){K.Cache.add(e,this.response),t&&t(this.response),n.manager.itemEnd(e)}),!1),void 0!==i&&s.addEventListener("progress",(function(e){i(e)}),!1),void 0!==r&&s.addEventListener("error",(function(e){r(e)}),!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(s.responseType=this.responseType),s.send(null),n.manager.itemStart(e)}else t&&t(o)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},K.ImageLoader=function(e){this.manager=void 0!==e?e:K.DefaultLoadingManager},K.ImageLoader.prototype={constructor:K.ImageLoader,load:function(e,t,i,r){var n=this,o=K.Cache.get(e);if(void 0===o){var s=document.createElement("img");return s.addEventListener("load",(function(i){K.Cache.add(e,this),t&&t(this),n.manager.itemEnd(e)}),!1),void 0!==i&&s.addEventListener("progress",(function(e){i(e)}),!1),void 0!==r&&s.addEventListener("error",(function(e){r(e)}),!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,n.manager.itemStart(e),s}t(o)},setCrossOrigin:function(e){this.crossOrigin=e}},K.JSONLoader=function(e){K.Loader.call(this,e),this.withCredentials=!1},K.JSONLoader.prototype=Object.create(K.Loader.prototype),K.JSONLoader.prototype.constructor=K.JSONLoader,K.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},K.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,r,n){var o=new XMLHttpRequest,s=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var a=JSON.parse(o.responseText),l=a.metadata;if(void 0!==l){if("object"===l.type)return void K.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===l.type)return void K.error("THREE.JSONLoader: "+t+" seems to be a Scene. Use THREE.SceneLoader instead.")}var h=e.parse(a,r);i(h.geometry,h.materials)}else K.error("THREE.JSONLoader: "+t+" seems to be unreachable or the file is empty.");e.onLoadComplete()}else K.error("THREE.JSONLoader: Couldn't load "+t+" ("+o.status+")");else o.readyState===o.LOADING?n&&(0===s&&(s=o.getResponseHeader("Content-Length")),n({total:s,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==n&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},K.JSONLoader.prototype.parse=function(e,t){var i=new K.Geometry,r=void 0!==e.scale?1/e.scale:1;if(function(t){function r(e,t){return e&1<<t}var n,o,s,a,l,h,c,u,d,p,f,m,g,v,y,b,x,_,E,A,S,w,M,T,C,P,D,L=e.faces,I=e.vertices,R=e.normals,O=e.colors,N=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&N++;for(n=0;n<N;n++)i.faceVertexUvs[n]=[]}a=0,l=I.length;for(;a<l;)(_=new K.Vector3).x=I[a++]*t,_.y=I[a++]*t,_.z=I[a++]*t,i.vertices.push(_);a=0,l=L.length;for(;a<l;)if(f=r(p=L[a++],0),m=r(p,1),g=r(p,3),v=r(p,4),y=r(p,5),b=r(p,6),x=r(p,7),f){if((A=new K.Face3).a=L[a],A.b=L[a+1],A.c=L[a+3],(S=new K.Face3).a=L[a+1],S.b=L[a+2],S.c=L[a+3],a+=4,m&&(d=L[a++],A.materialIndex=d,S.materialIndex=d),s=i.faces.length,g)for(n=0;n<N;n++)for(T=e.uvs[n],i.faceVertexUvs[n][s]=[],i.faceVertexUvs[n][s+1]=[],o=0;o<4;o++)P=T[2*(u=L[a++])],D=T[2*u+1],C=new K.Vector2(P,D),2!==o&&i.faceVertexUvs[n][s].push(C),0!==o&&i.faceVertexUvs[n][s+1].push(C);if(v&&(c=3*L[a++],A.normal.set(R[c++],R[c++],R[c]),S.normal.copy(A.normal)),y)for(n=0;n<4;n++)c=3*L[a++],M=new K.Vector3(R[c++],R[c++],R[c]),2!==n&&A.vertexNormals.push(M),0!==n&&S.vertexNormals.push(M);if(b&&(w=O[h=L[a++]],A.color.setHex(w),S.color.setHex(w)),x)for(n=0;n<4;n++)w=O[h=L[a++]],2!==n&&A.vertexColors.push(new K.Color(w)),0!==n&&S.vertexColors.push(new K.Color(w));i.faces.push(A),i.faces.push(S)}else{if((E=new K.Face3).a=L[a++],E.b=L[a++],E.c=L[a++],m&&(d=L[a++],E.materialIndex=d),s=i.faces.length,g)for(n=0;n<N;n++)for(T=e.uvs[n],i.faceVertexUvs[n][s]=[],o=0;o<3;o++)P=T[2*(u=L[a++])],D=T[2*u+1],C=new K.Vector2(P,D),i.faceVertexUvs[n][s].push(C);if(v&&(c=3*L[a++],E.normal.set(R[c++],R[c++],R[c])),y)for(n=0;n<3;n++)c=3*L[a++],M=new K.Vector3(R[c++],R[c++],R[c]),E.vertexNormals.push(M);if(b&&(h=L[a++],E.color.setHex(O[h])),x)for(n=0;n<3;n++)h=L[a++],E.vertexColors.push(new K.Color(O[h]));i.faces.push(E)}}(r),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;r<n;r+=t){var o=e.skinWeights[r],s=t>1?e.skinWeights[r+1]:0,a=t>2?e.skinWeights[r+2]:0,l=t>3?e.skinWeights[r+3]:0;i.skinWeights.push(new K.Vector4(o,s,a,l))}if(e.skinIndices)for(r=0,n=e.skinIndices.length;r<n;r+=t){var h=e.skinIndices[r],c=t>1?e.skinIndices[r+1]:0,u=t>2?e.skinIndices[r+2]:0,d=t>3?e.skinIndices[r+3]:0;i.skinIndices.push(new K.Vector4(h,c,u,d))}i.bones=e.bones,i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)&&K.warn("THREE.JSONLoader: When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match.");i.animation=e.animation,i.animations=e.animations}(),function(t){var r,n,o,s,a,l,h,c,u,d,p;if(void 0!==e.morphTargets)for(a=0,l=e.morphTargets.length;a<l;a++)for(i.morphTargets[a]={},i.morphTargets[a].name=e.morphTargets[a].name,i.morphTargets[a].vertices=[],o=i.morphTargets[a].vertices,r=0,n=(s=e.morphTargets[a].vertices).length;r<n;r+=3){var f=new K.Vector3;f.x=s[r]*t,f.y=s[r+1]*t,f.z=s[r+2]*t,o.push(f)}if(void 0!==e.morphColors)for(a=0,l=e.morphColors.length;a<l;a++)for(i.morphColors[a]={},i.morphColors[a].name=e.morphColors[a].name,i.morphColors[a].colors=[],u=i.morphColors[a].colors,h=0,c=(d=e.morphColors[a].colors).length;h<c;h+=3)(p=new K.Color(16755200)).setRGB(d[h],d[h+1],d[h+2]),u.push(p)}(r),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:i};var n=this.initMaterials(e.materials,t);return this.needsTangents(n)&&i.computeTangents(),{geometry:i,materials:n}},K.LoadingManager=function(e,t,i){var r=this,n=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++},this.itemEnd=function(e){n++,void 0!==r.onProgress&&r.onProgress(e,n,o),n===o&&void 0!==r.onLoad&&r.onLoad()}},K.DefaultLoadingManager=new K.LoadingManager,K.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:K.DefaultLoadingManager},K.BufferGeometryLoader.prototype={constructor:K.BufferGeometryLoader,load:function(e,t,i,r){var n=this,o=new K.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new K.BufferGeometry,i=e.data.attributes;for(var r in i){var n=i[r],o=new self[n.type](n.array);t.setAttribute(r,new K.BufferAttribute(o,n.itemSize))}var s=e.data.offsets;void 0!==s&&(t.offsets=JSON.parse(JSON.stringify(s)));var a=e.data.boundingSphere;if(void 0!==a){var l=new K.Vector3;void 0!==a.center&&l.fromArray(a.center),t.boundingSphere=new K.Sphere(l,a.radius)}return t}},K.MaterialLoader=function(e){this.manager=void 0!==e?e:K.DefaultLoadingManager},K.MaterialLoader.prototype={constructor:K.MaterialLoader,load:function(e,t,i,r){var n=this,o=new K.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new K[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.materials)for(var i=0,r=e.materials.length;i<r;i++)t.materials.push(this.parse(e.materials[i]));return t}},K.ObjectLoader=function(e){this.manager=void 0!==e?e:K.DefaultLoadingManager,this.texturePath=""},K.ObjectLoader.prototype={constructor:K.ObjectLoader,load:function(e,t,i,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this,o=new K.XHRLoader(n.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,(function(e){n.parse(JSON.parse(e),t)}),i,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries),r=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),n=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,n),s=this.parseObject(e.object,i,o);return void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new K.JSONLoader,r=new K.BufferGeometryLoader,n=0,o=e.length;n<o;n++){var s,a=e[n];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new K[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"CubeGeometry":s=new K.BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":s=new K.CircleGeometry(a.radius,a.segments);break;case"CylinderGeometry":s=new K.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":s=new K.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":s=new K.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":s=new K.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":s=new K.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"BufferGeometry":s=r.parse(a);break;case"Geometry":s=i.parse(a.data).geometry}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),t[a.uuid]=s}return t},parseMaterials:function(e,t){var i={};if(void 0!==e)for(var r=function(e){return void 0===t[e]&&K.warn("THREE.ObjectLoader: Undefined texture",e),t[e]},n=new K.MaterialLoader,o=0,s=e.length;o<s;o++){var a=e[o],l=n.parse(a);l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.map&&(l.map=r(a.map)),void 0!==a.bumpMap&&(l.bumpMap=r(a.bumpMap),a.bumpScale&&(l.bumpScale=new K.Vector2(a.bumpScale,a.bumpScale))),void 0!==a.alphaMap&&(l.alphaMap=r(a.alphaMap)),void 0!==a.envMap&&(l.envMap=r(a.envMap)),void 0!==a.normalMap&&(l.normalMap=r(a.normalMap),a.normalScale&&(l.normalScale=new K.Vector2(a.normalScale,a.normalScale))),void 0!==a.lightMap&&(l.lightMap=r(a.lightMap)),void 0!==a.specularMap&&(l.specularMap=r(a.specularMap)),i[a.uuid]=l}return i},parseImages:function(e,t){var i=this,r={};if(void 0!==e&&e.length>0){var n=new K.LoadingManager(t),o=new K.ImageLoader(n);o.setCrossOrigin(this.crossOrigin);for(var s=function(e){return i.manager.itemStart(e),o.load(e,(function(){i.manager.itemEnd(e)}))},a=0,l=e.length;a<l;a++){var h=e[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:i.texturePath+h.url;r[h.uuid]=s(c)}}return r},parseTextures:function(e,t){var i={};if(void 0!==e)for(var r=0,n=e.length;r<n;r++){var o=e[r];void 0===o.image&&K.warn('THREE.ObjectLoader: No "image" speficied for',o.uuid),void 0===t[o.image]&&K.warn("THREE.ObjectLoader: Undefined image",o.image);var s=new K.Texture(t[o.image]);s.needsUpdate=!0,s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.repeat&&(s.repeat=new K.Vector2(o.repeat[0],o.repeat[1])),void 0!==o.minFilter&&(s.minFilter=K[o.minFilter]),void 0!==o.magFilter&&(s.magFilter=K[o.magFilter]),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),o.wrap instanceof Array&&(s.wrapS=K[o.wrap[0]],s.wrapT=K[o.wrap[1]]),i[o.uuid]=s}return i},parseObject:function(){var e=new K.Matrix4;return function(t,i,r){var n,o=function(e){return void 0===i[e]&&K.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]},s=function(e){return void 0===r[e]&&K.warn("THREE.ObjectLoader: Undefined material",e),r[e]};switch(t.type){case"Scene":n=new K.Scene;break;case"PerspectiveCamera":n=new K.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":n=new K.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":n=new K.AmbientLight(t.color);break;case"DirectionalLight":n=new K.DirectionalLight(t.color,t.intensity);break;case"PointLight":n=new K.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":n=new K.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":n=new K.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":n=new K.Mesh(o(t.geometry),s(t.material));break;case"Line":n=new K.Line(o(t.geometry),s(t.material),t.mode);break;case"PointCloud":n=new K.PointCloud(o(t.geometry),s(t.material));break;case"Sprite":n=new K.Sprite(s(t.material));break;case"Group":n=new K.Group;break;default:n=new K.Object3D}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var a in t.children)n.add(this.parseObject(t.children[a],i,r));return n}}()},K.TextureLoader=function(e){this.manager=void 0!==e?e:K.DefaultLoadingManager},K.TextureLoader.prototype={constructor:K.TextureLoader,load:function(e,t,i,r){var n=new K.ImageLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,(function(e){var i=new K.Texture(e);i.needsUpdate=!0,void 0!==t&&t(i)}),i,r)},setCrossOrigin:function(e){this.crossOrigin=e}},K.DataTextureLoader=K.BinaryTextureLoader=function(){this._parser=null},K.BinaryTextureLoader.prototype={constructor:K.BinaryTextureLoader,load:function(e,t,i,r){var n=this,o=new K.DataTexture,s=new K.XHRLoader;return s.setResponseType("arraybuffer"),s.load(e,(function(e){var i=n._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:K.ClampToEdgeWrapping,o.wrapT=void 0!==i.wrapT?i.wrapT:K.ClampToEdgeWrapping,o.magFilter=void 0!==i.magFilter?i.magFilter:K.LinearFilter,o.minFilter=void 0!==i.minFilter?i.minFilter:K.LinearMipMapLinearFilter,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=K.LinearFilter),o.needsUpdate=!0,t&&t(o,i))}),i,r),o}},K.CompressedTextureLoader=function(){this._parser=null},K.CompressedTextureLoader.prototype={constructor:K.CompressedTextureLoader,load:function(e,t,i){var r=this,n=[],o=new K.CompressedTexture;o.image=n;var s=new K.XHRLoader;if(s.setResponseType("arraybuffer"),e instanceof Array)for(var a=0,l=function(i){s.load(e[i],(function(e){var s=r._parser(e,!0);n[i]={width:s.width,height:s.height,format:s.format,mipmaps:s.mipmaps},6===(a+=1)&&(1==s.mipmapCount&&(o.minFilter=K.LinearFilter),o.format=s.format,o.needsUpdate=!0,t&&t(o))}))},h=0,c=e.length;h<c;++h)l(h);else s.load(e,(function(e){var i=r._parser(e,!0);if(i.isCubemap)for(var s=i.mipmaps.length/i.mipmapCount,a=0;a<s;a++){n[a]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)n[a].mipmaps.push(i.mipmaps[a*i.mipmapCount+l]),n[a].format=i.format,n[a].width=i.width,n[a].height=i.height}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=K.LinearFilter),o.format=i.format,o.needsUpdate=!0,t&&t(o)}));return o}},K.Material=function(){Object.defineProperty(this,"id",{value:K.MaterialIdCount++}),this.uuid=K.Math.generateUUID(),this.name="",this.type="Material",this.side=K.FrontSide,this.opacity=1,this.transparent=!1,this.blending=K.NormalBlending,this.blendSrc=K.SrcAlphaFactor,this.blendDst=K.OneMinusSrcAlphaFactor,this.blendEquation=K.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},K.Material.prototype={constructor:K.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var r=this[t];r instanceof K.Color?r.set(i):r instanceof K.Vector3&&i instanceof K.Vector3?r.copy(i):this[t]="overdraw"==t?Number(i):i}}else K.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return""!==this.name&&(e.name=this.name),this instanceof K.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==K.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==K.NormalBlending&&(e.blending=this.blending),this.side!==K.FrontSide&&(e.side=this.side)):this instanceof K.MeshLambertMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==K.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==K.SmoothShading&&(e.shading=this.shading),this.blending!==K.NormalBlending&&(e.blending=this.blending),this.side!==K.FrontSide&&(e.side=this.side)):this instanceof K.MeshPhongMaterial?(e.color=this.color.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==K.NoColors&&(e.vertexColors=this.vertexColors),this.shading!==K.SmoothShading&&(e.shading=this.shading),this.blending!==K.NormalBlending&&(e.blending=this.blending),this.side!==K.FrontSide&&(e.side=this.side)):this instanceof K.MeshNormalMaterial||this instanceof K.MeshDepthMaterial?(this.blending!==K.NormalBlending&&(e.blending=this.blending),this.side!==K.FrontSide&&(e.side=this.side)):this instanceof K.PointCloudMaterial?(e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.color=this.color.getHex(),this.vertexColors!==K.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==K.NormalBlending&&(e.blending=this.blending)):this instanceof K.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof K.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),!1!==this.transparent&&(e.transparent=this.transparent),!1!==this.wireframe&&(e.wireframe=this.wireframe),e},clone:function(e){return void 0===e&&(e=new K.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.blendSrcAlpha=this.blendSrcAlpha,e.blendDstAlpha=this.blendDstAlpha,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},K.EventDispatcher.prototype.apply(K.Material.prototype),K.MaterialIdCount=0,K.LineBasicMaterial=function(e){K.Material.call(this),this.type="LineBasicMaterial",this.color=new K.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=K.NoColors,this.fog=!0,this.setValues(e)},K.LineBasicMaterial.prototype=Object.create(K.Material.prototype),K.LineBasicMaterial.prototype.constructor=K.LineBasicMaterial,K.LineBasicMaterial.prototype.clone=function(){var e=new K.LineBasicMaterial;return K.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},K.LineDashedMaterial=function(e){K.Material.call(this),this.type="LineDashedMaterial",this.color=new K.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},K.LineDashedMaterial.prototype=Object.create(K.Material.prototype),K.LineDashedMaterial.prototype.constructor=K.LineDashedMaterial,K.LineDashedMaterial.prototype.clone=function(){var e=new K.LineDashedMaterial;return K.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},K.MeshBasicMaterial=function(e){K.Material.call(this),this.type="MeshBasicMaterial",this.color=new K.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=K.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=K.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},K.MeshBasicMaterial.prototype=Object.create(K.Material.prototype),K.MeshBasicMaterial.prototype.constructor=K.MeshBasicMaterial,K.MeshBasicMaterial.prototype.clone=function(){var e=new K.MeshBasicMaterial;return K.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},K.MeshLambertMaterial=function(e){K.Material.call(this),this.type="MeshLambertMaterial",this.color=new K.Color(16777215),this.emissive=new K.Color(0),this.wrapAround=!1,this.wrapRGB=new K.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=K.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=K.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},K.MeshLambertMaterial.prototype=Object.create(K.Material.prototype),K.MeshLambertMaterial.prototype.constructor=K.MeshLambertMaterial,K.MeshLambertMaterial.prototype.clone=function(){var e=new K.MeshLambertMaterial;return K.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},K.MeshPhongMaterial=function(e){K.Material.call(this),this.type="MeshPhongMaterial",this.color=new K.Color(16777215),this.emissive=new K.Color(0),this.specular=new K.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new K.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new K.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=K.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=K.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},K.MeshPhongMaterial.prototype=Object.create(K.Material.prototype),K.MeshPhongMaterial.prototype.constructor=K.MeshPhongMaterial,K.MeshPhongMaterial.prototype.clone=function(){var e=new K.MeshPhongMaterial;return K.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},K.MeshDepthMaterial=function(e){K.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},K.MeshDepthMaterial.prototype=Object.create(K.Material.prototype),K.MeshDepthMaterial.prototype.constructor=K.MeshDepthMaterial,K.MeshDepthMaterial.prototype.clone=function(){var e=new K.MeshDepthMaterial;return K.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},K.MeshNormalMaterial=function(e){K.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},K.MeshNormalMaterial.prototype=Object.create(K.Material.prototype),K.MeshNormalMaterial.prototype.constructor=K.MeshNormalMaterial,K.MeshNormalMaterial.prototype.clone=function(){var e=new K.MeshNormalMaterial;return K.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},K.MeshFaceMaterial=function(e){this.uuid=K.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},K.MeshFaceMaterial.prototype={constructor:K.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,i=this.materials.length;t<i;t++)e.materials.push(this.materials[t].toJSON());return e},clone:function(){for(var e=new K.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e}},K.PointCloudMaterial=function(e){K.Material.call(this),this.type="PointCloudMaterial",this.color=new K.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=K.NoColors,this.fog=!0,this.setValues(e)},K.PointCloudMaterial.prototype=Object.create(K.Material.prototype),K.PointCloudMaterial.prototype.constructor=K.PointCloudMaterial,K.PointCloudMaterial.prototype.clone=function(){var e=new K.PointCloudMaterial;return K.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,this.defines&&(e.defines=Object.assign({},this.defines)),e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},K.ParticleBasicMaterial=function(e){return K.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new K.PointCloudMaterial(e)},K.ParticleSystemMaterial=function(e){return K.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new K.PointCloudMaterial(e)},K.ShaderMaterial=function(e){K.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=K.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=K.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},K.ShaderMaterial.prototype=Object.create(K.Material.prototype),K.ShaderMaterial.prototype.constructor=K.ShaderMaterial,K.ShaderMaterial.prototype.clone=function(){var e=new K.ShaderMaterial;return K.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=K.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},K.RawShaderMaterial=function(e){K.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},K.RawShaderMaterial.prototype=Object.create(K.ShaderMaterial.prototype),K.RawShaderMaterial.prototype.constructor=K.RawShaderMaterial,K.RawShaderMaterial.prototype.clone=function(){var e=new K.RawShaderMaterial;return K.ShaderMaterial.prototype.clone.call(this,e),e},K.SpriteMaterial=function(e){K.Material.call(this),this.type="SpriteMaterial",this.color=new K.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},K.SpriteMaterial.prototype=Object.create(K.Material.prototype),K.SpriteMaterial.prototype.constructor=K.SpriteMaterial,K.SpriteMaterial.prototype.clone=function(){var e=new K.SpriteMaterial;return K.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},K.Texture=function(e,t,i,r,n,o,s,a,l){Object.defineProperty(this,"id",{value:K.TextureIdCount++}),this.uuid=K.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:K.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:K.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:K.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:K.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:K.LinearFilter,this.minFilter=void 0!==o?o:K.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:K.RGBAFormat,this.type=void 0!==a?a:K.UnsignedByteType,this.offset=new K.Vector2(0,0),this.repeat=new K.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},K.Texture.DEFAULT_IMAGE=void 0,K.Texture.DEFAULT_MAPPING=K.UVMapping,K.Texture.prototype={constructor:K.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new K.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},K.EventDispatcher.prototype.apply(K.Texture.prototype),K.TextureIdCount=0,K.CubeTexture=function(e,t,i,r,n,o,s,a,l){t=void 0!==t?t:K.CubeReflectionMapping,K.Texture.call(this,e,t,i,r,n,o,s,a,l),this.images=e},K.CubeTexture.prototype=Object.create(K.Texture.prototype),K.CubeTexture.prototype.constructor=K.CubeTexture,K.CubeTexture.clone=function(e){return void 0===e&&(e=new K.CubeTexture),K.Texture.prototype.clone.call(this,e),e.images=this.images,e},K.CompressedTexture=function(e,t,i,r,n,o,s,a,l,h,c){K.Texture.call(this,null,o,s,a,l,h,r,n,c),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},K.CompressedTexture.prototype=Object.create(K.Texture.prototype),K.CompressedTexture.prototype.constructor=K.CompressedTexture,K.CompressedTexture.prototype.clone=function(){var e=new K.CompressedTexture;return K.Texture.prototype.clone.call(this,e),e},K.DataTexture=function(e,t,i,r,n,o,s,a,l,h,c){K.Texture.call(this,null,o,s,a,l,h,r,n,c),this.image={data:e,width:t,height:i}},K.DataTexture.prototype=Object.create(K.Texture.prototype),K.DataTexture.prototype.constructor=K.DataTexture,K.DataTexture.prototype.clone=function(){var e=new K.DataTexture;return K.Texture.prototype.clone.call(this,e),e},K.VideoTexture=function(e,t,i,r,n,o,s,a,l){K.Texture.call(this,e,t,i,r,n,o,s,a,l),this.generateMipmaps=!1;var h=this,c=function(){requestAnimationFrame(c),e.readyState===e.HAVE_ENOUGH_DATA&&(h.needsUpdate=!0)};c()},K.VideoTexture.prototype=Object.create(K.Texture.prototype),K.VideoTexture.prototype.constructor=K.VideoTexture,K.Group=function(){K.Object3D.call(this),this.type="Group"},K.Group.prototype=Object.create(K.Object3D.prototype),K.Group.prototype.constructor=K.Group,K.PointCloud=function(e,t){K.Object3D.call(this),this.type="PointCloud",this.geometry=void 0!==e?e:new K.Geometry,this.material=void 0!==t?t:new K.PointCloudMaterial({color:16777215*Math.random()})},K.PointCloud.prototype=Object.create(K.Object3D.prototype),K.PointCloud.prototype.constructor=K.PointCloud,K.PointCloud.prototype.raycast=(C=new K.Matrix4,P=new K.Ray,function(e,t){var i=this,r=i.geometry,n=e.params.PointCloud.threshold;if(C.getInverse(this.matrixWorld),P.copy(e.ray).applyMatrix4(C),null===r.boundingBox||!1!==P.isIntersectionBox(r.boundingBox)){var o=n/((this.scale.x+this.scale.y+this.scale.z)/3),s=new K.Vector3,a=function(r,n){var s=P.distanceToPoint(r);if(s<o){var a=P.closestPointToPoint(r);a.applyMatrix4(i.matrixWorld);var l=e.ray.origin.distanceTo(a);t.push({distance:l,distanceToRay:s,point:a.clone(),index:n,face:null,object:i})}};if(r instanceof K.BufferGeometry){var l=r.attributes,h=l.position.array;if(void 0!==l.index){var c=l.index.array,u=r.offsets;0===u.length&&(u=[{start:0,count:c.length,index:0}]);for(var d=0,p=u.length;d<p;++d)for(var f=u[d].start,m=u[d].count,g=u[d].index,v=f,y=f+m;v<y;v++){var b=g+c[v];s.fromArray(h,3*b),a(s,b)}}else{var x=h.length/3;for(v=0;v<x;v++)s.set(h[3*v],h[3*v+1],h[3*v+2]),a(s,v)}}else{var _=this.geometry.vertices;for(v=0;v<_.length;v++)a(_[v],v)}}}),K.PointCloud.prototype.clone=function(e){return void 0===e&&(e=new K.PointCloud(this.geometry,this.material)),K.Object3D.prototype.clone.call(this,e),e},K.ParticleSystem=function(e,t){return K.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new K.PointCloud(e,t)},K.Line=function(e,t,i){K.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new K.Geometry,this.material=void 0!==t?t:new K.LineBasicMaterial({color:16777215*Math.random()}),this.mode=void 0!==i?i:K.LineStrip},K.LineStrip=0,K.LinePieces=1,K.Line.prototype=Object.create(K.Object3D.prototype),K.Line.prototype.constructor=K.Line,K.Line.prototype.raycast=function(){var e=new K.Matrix4,t=new K.Ray,i=new K.Sphere;return function(r,n){var o=r.linePrecision,s=o*o,a=this.geometry;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==r.ray.isIntersectionSphere(i)){e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e);var l=new K.Vector3,h=new K.Vector3,c=new K.Vector3,u=new K.Vector3,d=this.mode===K.LineStrip?1:2;if(a instanceof K.BufferGeometry){var p=a.attributes;if(void 0!==p.index){var f=p.index.array,m=p.position.array,g=a.offsets;0===g.length&&(g=[{start:0,count:f.length,index:0}]);for(var v=0;v<g.length;v++)for(var y=g[v].start,b=g[v].count,x=g[v].index,_=y;_<y+b-1;_+=d){var E=x+f[_],A=x+f[_+1];if(l.fromArray(m,3*E),h.fromArray(m,3*A),!(t.distanceSqToSegment(l,h,u,c)>s))(M=t.origin.distanceTo(u))<r.near||M>r.far||n.push({distance:M,point:c.clone().applyMatrix4(this.matrixWorld),index:_,offsetIndex:v,face:null,faceIndex:null,object:this})}}else for(m=p.position.array,_=0;_<m.length/3-1;_+=d){if(l.fromArray(m,3*_),h.fromArray(m,3*_+3),!(t.distanceSqToSegment(l,h,u,c)>s))(M=t.origin.distanceTo(u))<r.near||M>r.far||n.push({distance:M,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else if(a instanceof K.Geometry){var S=a.vertices,w=S.length;for(_=0;_<w-1;_+=d){var M;if(!(t.distanceSqToSegment(S[_],S[_+1],u,c)>s))(M=t.origin.distanceTo(u))<r.near||M>r.far||n.push({distance:M,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),K.Line.prototype.clone=function(e){return void 0===e&&(e=new K.Line(this.geometry,this.material,this.mode)),K.Object3D.prototype.clone.call(this,e),e},K.Mesh=function(e,t){K.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new K.Geometry,this.material=void 0!==t?t:new K.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},K.Mesh.prototype=Object.create(K.Object3D.prototype),K.Mesh.prototype.constructor=K.Mesh,K.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},K.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(K.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},K.Mesh.prototype.raycast=function(){var e=new K.Matrix4,t=new K.Ray,i=new K.Sphere,r=new K.Vector3,n=new K.Vector3,o=new K.Vector3;return function(s,a){var l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==s.ray.isIntersectionSphere(i)&&(e.getInverse(this.matrixWorld),t.copy(s.ray).applyMatrix4(e),null===l.boundingBox||!1!==t.isIntersectionBox(l.boundingBox)))if(l instanceof K.BufferGeometry){if(void 0===(L=this.material))return;var h=l.attributes,c=s.precision;if(void 0!==h.index){var u=h.index.array,d=h.position.array,p=l.offsets;0===p.length&&(p=[{start:0,count:u.length,index:0}]);for(var f=0,m=p.length;f<m;++f)for(var g=p[f].start,v=p[f].count,y=p[f].index,b=g,x=g+v;b<x;b+=3){if(A=y+u[b],S=y+u[b+1],w=y+u[b+2],r.fromArray(d,3*A),n.fromArray(d,3*S),o.fromArray(d,3*w),L.side===K.BackSide)var _=t.intersectTriangle(o,n,r,!0);else _=t.intersectTriangle(r,n,o,L.side!==K.DoubleSide);if(null!==_)_.applyMatrix4(this.matrixWorld),(U=s.ray.origin.distanceTo(_))<c||U<s.near||U>s.far||a.push({distance:U,point:_,face:new K.Face3(A,S,w,K.Triangle.normal(r,n,o)),faceIndex:null,object:this})}}else{b=0;var E=0;for(x=(d=h.position.array).length;b<x;b+=3,E+=9){if(A=b,S=b+1,w=b+2,r.fromArray(d,E),n.fromArray(d,E+3),o.fromArray(d,E+6),L.side===K.BackSide)_=t.intersectTriangle(o,n,r,!0);else _=t.intersectTriangle(r,n,o,L.side!==K.DoubleSide);if(null!==_)_.applyMatrix4(this.matrixWorld),(U=s.ray.origin.distanceTo(_))<c||U<s.near||U>s.far||a.push({distance:U,point:_,face:new K.Face3(A,S,w,K.Triangle.normal(r,n,o)),faceIndex:null,object:this})}}}else if(l instanceof K.Geometry)for(var A,S,w,M=this.material instanceof K.MeshFaceMaterial,T=!0===M?this.material.materials:null,C=(c=s.precision,l.vertices),P=0,D=l.faces.length;P<D;P++){var L,I=l.faces[P];if(void 0!==(L=!0===M?T[I.materialIndex]:this.material)){if(A=C[I.a],S=C[I.b],w=C[I.c],!0===L.morphTargets){var R=l.morphTargets,O=this.morphTargetInfluences;r.set(0,0,0),n.set(0,0,0),o.set(0,0,0);for(var N=0,F=R.length;N<F;N++){var k=O[N];if(0!==k){var V=R[N].vertices;r.x+=(V[I.a].x-A.x)*k,r.y+=(V[I.a].y-A.y)*k,r.z+=(V[I.a].z-A.z)*k,n.x+=(V[I.b].x-S.x)*k,n.y+=(V[I.b].y-S.y)*k,n.z+=(V[I.b].z-S.z)*k,o.x+=(V[I.c].x-w.x)*k,o.y+=(V[I.c].y-w.y)*k,o.z+=(V[I.c].z-w.z)*k}}r.add(A),n.add(S),o.add(w),A=r,S=n,w=o}if(L.side===K.BackSide)_=t.intersectTriangle(w,S,A,!0);else _=t.intersectTriangle(A,S,w,L.side!==K.DoubleSide);var U;if(null!==_)_.applyMatrix4(this.matrixWorld),(U=s.ray.origin.distanceTo(_))<c||U<s.near||U>s.far||a.push({distance:U,point:_,face:I,faceIndex:P,object:this})}}}}(),K.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new K.Mesh(this.geometry,this.material)),K.Object3D.prototype.clone.call(this,e,t),e},K.Bone=function(e){K.Object3D.call(this),this.type="Bone",this.skin=e},K.Bone.prototype=Object.create(K.Object3D.prototype),K.Bone.prototype.constructor=K.Bone,K.Skeleton=function(e,t,i){var r;(this.useVertexTexture=void 0===i||i,this.identityMatrix=new K.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture)?(r=this.bones.length>256?64:this.bones.length>64?32:this.bones.length>16?16:8,this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new K.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,K.RGBAFormat,K.FloatType),this.boneTexture.minFilter=K.NearestFilter,this.boneTexture.magFilter=K.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{K.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var n=0,o=this.bones.length;n<o;n++)this.boneInverses.push(new K.Matrix4)}},K.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new K.Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},K.Skeleton.prototype.pose=function(){for(var e,t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},K.Skeleton.prototype.update=(D=new K.Matrix4,function(){for(var e=0,t=this.bones.length;e<t;e++){var i=this.bones[e]?this.bones[e].matrixWorld:this.identityMatrix;D.multiplyMatrices(i,this.boneInverses[e]),D.flattenToArrayOffset(this.boneMatrices,16*e)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),K.SkinnedMesh=function(e,t,i){K.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new K.Matrix4,this.bindMatrixInverse=new K.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,o,s,a,l,h=0,c=this.geometry.bones.length;h<c;++h)s=(o=this.geometry.bones[h]).pos,a=o.rotq,l=o.scl,n=new K.Bone(this),r.push(n),n.name=o.name,n.position.set(s[0],s[1],s[2]),n.quaternion.set(a[0],a[1],a[2],a[3]),void 0!==l?n.scale.set(l[0],l[1],l[2]):n.scale.set(1,1,1);for(h=0,c=this.geometry.bones.length;h<c;++h)-1!==(o=this.geometry.bones[h]).parent?r[o.parent].add(r[h]):this.add(r[h])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new K.Skeleton(r,void 0,i))},K.SkinnedMesh.prototype=Object.create(K.Mesh.prototype),K.SkinnedMesh.prototype.constructor=K.SkinnedMesh,K.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},K.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},K.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof K.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();i!==1/0?t.multiplyScalar(i):t.set(1)}},K.SkinnedMesh.prototype.updateMatrixWorld=function(e){K.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):K.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},K.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new K.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),K.Mesh.prototype.clone.call(this,e),e},K.MorphAnimMesh=function(e,t){K.Mesh.call(this,e,t),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},K.MorphAnimMesh.prototype=Object.create(K.Mesh.prototype),K.MorphAnimMesh.prototype.constructor=K.MorphAnimMesh,K.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},K.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},K.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},K.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,r=/([a-z]+)_?(\d+)/,n=0,o=e.morphTargets.length;n<o;n++){var s=e.morphTargets[n].name.match(r);if(s&&s.length>1){var a=s[1];i[a]||(i[a]={start:1/0,end:-1/0});var l=i[a];n<l.start&&(l.start=n),n>l.end&&(l.end=n),t||(t=a)}}e.firstAnimation=t},K.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},K.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=(i.end-i.start)/t*1e3,this.time=0):K.warn("THREE.MorphAnimMesh: animation["+e+"] undefined in .playAnimation()")},K.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var i=this.startKeyframe+K.Math.clamp(Math.floor(this.time/t),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var r=this.time%t/t;this.directionBackwards&&(r=1-r),this.morphTargetInfluences[this.currentKeyframe]=r,this.morphTargetInfluences[this.lastKeyframe]=1-r},K.MorphAnimMesh.prototype.interpolateTargets=function(e,t,i){for(var r=this.morphTargetInfluences,n=0,o=r.length;n<o;n++)r[n]=0;e>-1&&(r[e]=1-i),t>-1&&(r[t]=i)},K.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new K.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,K.Mesh.prototype.clone.call(this,e),e},K.LOD=function(){K.Object3D.call(this),this.objects=[]},K.LOD.prototype=Object.create(K.Object3D.prototype),K.LOD.prototype.constructor=K.LOD,K.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},K.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;t<i&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},K.LOD.prototype.raycast=(L=new K.Vector3,function(e,t){L.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(L);this.getObjectForDistance(i).raycast(e,t)}),K.LOD.prototype.update=function(){var e=new K.Vector3,t=new K.Vector3;return function(i){if(this.objects.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);this.objects[0].object.visible=!0;for(var n=1,o=this.objects.length;n<o&&r>=this.objects[n].distance;n++)this.objects[n-1].object.visible=!1,this.objects[n].object.visible=!0;for(;n<o;n++)this.objects[n].object.visible=!1}}}(),K.LOD.prototype.clone=function(e){void 0===e&&(e=new K.LOD),K.Object3D.prototype.clone.call(this,e);for(var t=0,i=this.objects.length;t<i;t++){var r=this.objects[t].object.clone();r.visible=0===t,e.addLevel(r,this.objects[t].distance)}return e},K.Sprite=(I=new Uint16Array([0,1,2,0,2,3]),R=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),O=new Float32Array([0,0,1,0,1,1,0,1]),(N=new K.BufferGeometry).setAttribute("index",new K.BufferAttribute(I,1)),N.setAttribute("position",new K.BufferAttribute(R,3)),N.setAttribute("uv",new K.BufferAttribute(O,2)),function(e){K.Object3D.call(this),this.type="Sprite",this.geometry=N,this.material=void 0!==e?e:new K.SpriteMaterial}),K.Sprite.prototype=Object.create(K.Object3D.prototype),K.Sprite.prototype.constructor=K.Sprite,K.Sprite.prototype.raycast=function(){var e=new K.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceToPoint(e);r>this.scale.x||i.push({distance:r,point:this.position,face:null,object:this})}}(),K.Sprite.prototype.clone=function(e){return void 0===e&&(e=new K.Sprite(this.material)),K.Object3D.prototype.clone.call(this,e),e},K.Particle=K.Sprite,K.LensFlare=function(e,t,i,r,n){K.Object3D.call(this),this.lensFlares=[],this.positionScreen=new K.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r,n)},K.LensFlare.prototype=Object.create(K.Object3D.prototype),K.LensFlare.prototype.constructor=K.LensFlare,K.LensFlare.prototype.add=function(e,t,i,r,n,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=new K.Color(16777215)),void 0===r&&(r=K.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:n,blending:r})},K.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},K.Scene=function(){K.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},K.Scene.prototype=Object.create(K.Object3D.prototype),K.Scene.prototype.constructor=K.Scene,K.Scene.prototype.clone=function(e){return void 0===e&&(e=new K.Scene),K.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},K.Fog=function(e,t,i){this.name="",this.color=new K.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},K.Fog.prototype.clone=function(){return new K.Fog(this.color.getHex(),this.near,this.far)},K.FogExp2=function(e,t){this.name="",this.color=new K.Color(e),this.density=void 0!==t?t:25e-5},K.FogExp2.prototype.clone=function(){return new K.FogExp2(this.color.getHex(),this.density)},K.ShaderChunk={},K.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n",K.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",K.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n",K.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",K.ShaderChunk.default_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",K.ShaderChunk.map_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",K.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n",K.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",K.ShaderChunk.lightmap_pars_vertex="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif",K.ShaderChunk.lights_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n",K.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",K.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif",K.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",K.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",K.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",K.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n",K.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif",K.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",K.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif",K.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif",K.ShaderChunk.lightmap_vertex="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif",K.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",K.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",K.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif",K.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",K.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",K.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",K.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",K.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n",K.ShaderChunk.map_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",K.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",K.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",K.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",K.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",K.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",K.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",K.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",K.ShaderChunk.defaultnormal_vertex="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",K.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",K.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",K.ShaderChunk.map_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",K.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif",K.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif",K.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",K.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif",K.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",K.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n",K.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n",K.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif",K.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",K.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif",K.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",K.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",K.UniformsUtils={merge:function(e){for(var t={},i=0;i<e.length;i++){var r=this.clone(e[i]);for(var n in r)t[n]=r[n]}return t},clone:function(e){var t={};for(var i in e)for(var r in t[i]={},e[i]){var n=e[i][r];n instanceof K.Color||n instanceof K.Vector2||n instanceof K.Vector3||n instanceof K.Vector4||n instanceof K.Matrix4||n instanceof K.Texture?t[i][r]=n.clone():t[i][r]=n instanceof Array?n.slice():n}return t}},K.UniformsLib={common:{diffuse:{type:"c",value:new K.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new K.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new K.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new K.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new K.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new K.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new K.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},K.ShaderLib={basic:{uniforms:K.UniformsUtils.merge([K.UniformsLib.common,K.UniformsLib.fog,K.UniformsLib.shadowmap]),vertexShader:[K.ShaderChunk.common,K.ShaderChunk.map_pars_vertex,K.ShaderChunk.lightmap_pars_vertex,K.ShaderChunk.envmap_pars_vertex,K.ShaderChunk.color_pars_vertex,K.ShaderChunk.morphtarget_pars_vertex,K.ShaderChunk.skinning_pars_vertex,K.ShaderChunk.shadowmap_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",K.ShaderChunk.map_vertex,K.ShaderChunk.lightmap_vertex,K.ShaderChunk.color_vertex,K.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",K.ShaderChunk.morphnormal_vertex,K.ShaderChunk.skinnormal_vertex,K.ShaderChunk.defaultnormal_vertex,"\t#endif",K.ShaderChunk.morphtarget_vertex,K.ShaderChunk.skinning_vertex,K.ShaderChunk.default_vertex,K.ShaderChunk.logdepthbuf_vertex,K.ShaderChunk.worldpos_vertex,K.ShaderChunk.envmap_vertex,K.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",K.ShaderChunk.common,K.ShaderChunk.color_pars_fragment,K.ShaderChunk.map_pars_fragment,K.ShaderChunk.alphamap_pars_fragment,K.ShaderChunk.lightmap_pars_fragment,K.ShaderChunk.envmap_pars_fragment,K.ShaderChunk.fog_pars_fragment,K.ShaderChunk.shadowmap_pars_fragment,K.ShaderChunk.specularmap_pars_fragment,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",K.ShaderChunk.logdepthbuf_fragment,K.ShaderChunk.map_fragment,K.ShaderChunk.color_fragment,K.ShaderChunk.alphamap_fragment,K.ShaderChunk.alphatest_fragment,K.ShaderChunk.specularmap_fragment,"\toutgoingLight = diffuseColor.rgb;",K.ShaderChunk.lightmap_fragment,K.ShaderChunk.envmap_fragment,K.ShaderChunk.shadowmap_fragment,K.ShaderChunk.linear_to_gamma_fragment,K.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:K.UniformsUtils.merge([K.UniformsLib.common,K.UniformsLib.fog,K.UniformsLib.lights,K.UniformsLib.shadowmap,{emissive:{type:"c",value:new K.Color(0)},wrapRGB:{type:"v3",value:new K.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",K.ShaderChunk.common,K.ShaderChunk.map_pars_vertex,K.ShaderChunk.lightmap_pars_vertex,K.ShaderChunk.envmap_pars_vertex,K.ShaderChunk.lights_lambert_pars_vertex,K.ShaderChunk.color_pars_vertex,K.ShaderChunk.morphtarget_pars_vertex,K.ShaderChunk.skinning_pars_vertex,K.ShaderChunk.shadowmap_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",K.ShaderChunk.map_vertex,K.ShaderChunk.lightmap_vertex,K.ShaderChunk.color_vertex,K.ShaderChunk.morphnormal_vertex,K.ShaderChunk.skinbase_vertex,K.ShaderChunk.skinnormal_vertex,K.ShaderChunk.defaultnormal_vertex,K.ShaderChunk.morphtarget_vertex,K.ShaderChunk.skinning_vertex,K.ShaderChunk.default_vertex,K.ShaderChunk.logdepthbuf_vertex,K.ShaderChunk.worldpos_vertex,K.ShaderChunk.envmap_vertex,K.ShaderChunk.lights_lambert_vertex,K.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",K.ShaderChunk.common,K.ShaderChunk.color_pars_fragment,K.ShaderChunk.map_pars_fragment,K.ShaderChunk.alphamap_pars_fragment,K.ShaderChunk.lightmap_pars_fragment,K.ShaderChunk.envmap_pars_fragment,K.ShaderChunk.fog_pars_fragment,K.ShaderChunk.shadowmap_pars_fragment,K.ShaderChunk.specularmap_pars_fragment,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",K.ShaderChunk.logdepthbuf_fragment,K.ShaderChunk.map_fragment,K.ShaderChunk.color_fragment,K.ShaderChunk.alphamap_fragment,K.ShaderChunk.alphatest_fragment,K.ShaderChunk.specularmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",K.ShaderChunk.lightmap_fragment,K.ShaderChunk.envmap_fragment,K.ShaderChunk.shadowmap_fragment,K.ShaderChunk.linear_to_gamma_fragment,K.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:K.UniformsUtils.merge([K.UniformsLib.common,K.UniformsLib.bump,K.UniformsLib.normalmap,K.UniformsLib.fog,K.UniformsLib.lights,K.UniformsLib.shadowmap,{emissive:{type:"c",value:new K.Color(0)},specular:{type:"c",value:new K.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new K.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",K.ShaderChunk.common,K.ShaderChunk.map_pars_vertex,K.ShaderChunk.lightmap_pars_vertex,K.ShaderChunk.envmap_pars_vertex,K.ShaderChunk.lights_phong_pars_vertex,K.ShaderChunk.color_pars_vertex,K.ShaderChunk.morphtarget_pars_vertex,K.ShaderChunk.skinning_pars_vertex,K.ShaderChunk.shadowmap_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",K.ShaderChunk.map_vertex,K.ShaderChunk.lightmap_vertex,K.ShaderChunk.color_vertex,K.ShaderChunk.morphnormal_vertex,K.ShaderChunk.skinbase_vertex,K.ShaderChunk.skinnormal_vertex,K.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",K.ShaderChunk.morphtarget_vertex,K.ShaderChunk.skinning_vertex,K.ShaderChunk.default_vertex,K.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = -mvPosition.xyz;",K.ShaderChunk.worldpos_vertex,K.ShaderChunk.envmap_vertex,K.ShaderChunk.lights_phong_vertex,K.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",K.ShaderChunk.common,K.ShaderChunk.color_pars_fragment,K.ShaderChunk.map_pars_fragment,K.ShaderChunk.alphamap_pars_fragment,K.ShaderChunk.lightmap_pars_fragment,K.ShaderChunk.envmap_pars_fragment,K.ShaderChunk.fog_pars_fragment,K.ShaderChunk.lights_phong_pars_fragment,K.ShaderChunk.shadowmap_pars_fragment,K.ShaderChunk.bumpmap_pars_fragment,K.ShaderChunk.normalmap_pars_fragment,K.ShaderChunk.specularmap_pars_fragment,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",K.ShaderChunk.logdepthbuf_fragment,K.ShaderChunk.map_fragment,K.ShaderChunk.color_fragment,K.ShaderChunk.alphamap_fragment,K.ShaderChunk.alphatest_fragment,K.ShaderChunk.specularmap_fragment,K.ShaderChunk.lights_phong_fragment,K.ShaderChunk.lightmap_fragment,K.ShaderChunk.envmap_fragment,K.ShaderChunk.shadowmap_fragment,K.ShaderChunk.linear_to_gamma_fragment,K.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:K.UniformsUtils.merge([K.UniformsLib.particle,K.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",K.ShaderChunk.common,K.ShaderChunk.color_pars_vertex,K.ShaderChunk.shadowmap_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",K.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",K.ShaderChunk.logdepthbuf_vertex,K.ShaderChunk.worldpos_vertex,K.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",K.ShaderChunk.common,K.ShaderChunk.color_pars_fragment,K.ShaderChunk.map_particle_pars_fragment,K.ShaderChunk.fog_pars_fragment,K.ShaderChunk.shadowmap_pars_fragment,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",K.ShaderChunk.logdepthbuf_fragment,K.ShaderChunk.map_particle_fragment,K.ShaderChunk.color_fragment,K.ShaderChunk.alphatest_fragment,"\toutgoingLight = diffuseColor.rgb;",K.ShaderChunk.shadowmap_fragment,K.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:K.UniformsUtils.merge([K.UniformsLib.common,K.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",K.ShaderChunk.common,K.ShaderChunk.color_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",K.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",K.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",K.ShaderChunk.common,K.ShaderChunk.color_pars_fragment,K.ShaderChunk.fog_pars_fragment,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",K.ShaderChunk.logdepthbuf_fragment,K.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",K.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[K.ShaderChunk.common,K.ShaderChunk.morphtarget_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",K.ShaderChunk.morphtarget_vertex,K.ShaderChunk.default_vertex,K.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",K.ShaderChunk.common,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",K.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",K.ShaderChunk.common,K.ShaderChunk.morphtarget_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",K.ShaderChunk.morphtarget_vertex,K.ShaderChunk.default_vertex,K.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",K.ShaderChunk.common,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",K.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",K.ShaderChunk.common,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",K.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",K.ShaderChunk.common,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",K.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",K.ShaderChunk.common,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",K.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",K.ShaderChunk.common,K.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",K.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[K.ShaderChunk.common,K.ShaderChunk.morphtarget_pars_vertex,K.ShaderChunk.skinning_pars_vertex,K.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",K.ShaderChunk.skinbase_vertex,K.ShaderChunk.morphtarget_vertex,K.ShaderChunk.skinning_vertex,K.ShaderChunk.default_vertex,K.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[K.ShaderChunk.common,K.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",K.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}},K.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",K.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),i=void 0!==e.context?e.context:null,r=1,n=void 0!==e.precision?e.precision:"highp",o=void 0!==e.alpha&&e.alpha,s=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,l=void 0!==e.antialias&&e.antialias,h=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.logarithmicDepthBuffer&&e.logarithmicDepthBuffer,d=new K.Color(0),p=0,f=[],m={},g=[],v=[],y=[],b=[],x=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=K.PCFShadowMap,this.shadowMapCullFace=K.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _,E=this,A=[],S=null,w=null,M=-1,T="",C=null,P=0,D=0,L=0,I=t.width,R=t.height,O=0,N=0,F=new K.Frustum,k=new K.Matrix4,V=new K.Vector3,U=new K.Vector3,B=!0,G={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var z={alpha:o,depth:s,stencil:a,antialias:l,premultipliedAlpha:h,preserveDrawingBuffer:c};if(null===(_=i||t.getContext("webgl",z)||t.getContext("experimental-webgl",z)))throw null!==t.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";t.addEventListener("webglcontextlost",(function(e){e.preventDefault(),X(),q(),m={}}),!1)}catch(e){K.error("THREE.WebGLRenderer: "+e)}var H=new K.WebGLState(_,st);void 0===_.getShaderPrecisionFormat&&(_.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var W=new K.WebGLExtensions(_);W.get("OES_texture_float"),W.get("OES_texture_float_linear"),W.get("OES_texture_half_float"),W.get("OES_texture_half_float_linear"),W.get("OES_standard_derivatives"),u&&W.get("EXT_frag_depth");var j=function(e,t,i,r){!0===h&&(e*=r,t*=r,i*=r),_.clearColor(e,t,i,r)},q=function(){_.clearColor(0,0,0,1),_.clearDepth(1),_.clearStencil(0),_.enable(_.DEPTH_TEST),_.depthFunc(_.LEQUAL),_.frontFace(_.CCW),_.cullFace(_.BACK),_.enable(_.CULL_FACE),_.enable(_.BLEND),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA),_.viewport(D,L,I,R),j(d.r,d.g,d.b,p)},X=function(){S=null,C=null,T="",M=-1,B=!0,H.reset()};q(),this.context=_,this.state=H;var Y,Q=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS),Z=_.getParameter(_.MAX_VERTEX_TEXTURE_IMAGE_UNITS),J=_.getParameter(_.MAX_TEXTURE_SIZE),$=_.getParameter(_.MAX_CUBE_MAP_TEXTURE_SIZE),ee=Z>0,te=ee&&W.get("OES_texture_float"),ie=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.HIGH_FLOAT),re=_.getShaderPrecisionFormat(_.VERTEX_SHADER,_.MEDIUM_FLOAT),ne=_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.HIGH_FLOAT),oe=_.getShaderPrecisionFormat(_.FRAGMENT_SHADER,_.MEDIUM_FLOAT),se=function(){if(void 0!==Y)return Y;if(Y=[],W.get("WEBGL_compressed_texture_pvrtc")||W.get("WEBGL_compressed_texture_s3tc"))for(var e=_.getParameter(_.COMPRESSED_TEXTURE_FORMATS),t=0;t<e.length;t++)Y.push(e[t]);return Y},ae=ie.precision>0&&ne.precision>0,le=re.precision>0&&oe.precision>0;"highp"!==n||ae||(le?(n="mediump",K.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(n="lowp",K.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),"mediump"!==n||le||(n="lowp",K.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var he,ce=new K.ShadowMapPlugin(this,f,m,g),ue=new K.SpritePlugin(this,b),de=new K.LensFlarePlugin(this,x);function pe(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglNormalBuffer=_.createBuffer(),e.__webglTangentBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),e.__webglUVBuffer=_.createBuffer(),e.__webglUV2Buffer=_.createBuffer(),e.__webglSkinIndicesBuffer=_.createBuffer(),e.__webglSkinWeightsBuffer=_.createBuffer(),e.__webglFaceBuffer=_.createBuffer(),e.__webglLineBuffer=_.createBuffer();var t=e.numMorphTargets;if(t){e.__webglMorphTargetsBuffers=[];for(var i=0,r=t;i<r;i++)e.__webglMorphTargetsBuffers.push(_.createBuffer())}var n=e.numMorphNormals;if(n){e.__webglMorphNormalsBuffers=[];for(i=0,r=n;i<r;i++)e.__webglMorphNormalsBuffers.push(_.createBuffer())}E.info.memory.geometries++}this.getContext=function(){return _},this.forceContextLoss=function(){W.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return ee},this.supportsFloatTextures=function(){return W.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return W.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return W.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return W.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return W.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return W.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){if(void 0!==he)return he;var e=W.get("EXT_texture_filter_anisotropic");return he=null!==e?_.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},this.getPrecision=function(){return n},this.getPixelRatio=function(){return r},this.setPixelRatio=function(e){r=e},this.setSize=function(e,i,n){t.width=e*r,t.height=i*r,!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i)},this.setViewport=function(e,t,i,n){D=e*r,L=t*r,I=i*r,R=n*r,_.viewport(D,L,I,R)},this.setScissor=function(e,t,i,n){_.scissor(e*r,t*r,i*r,n*r)},this.enableScissorTest=function(e){e?_.enable(_.SCISSOR_TEST):_.disable(_.SCISSOR_TEST)},this.getClearColor=function(){return d},this.setClearColor=function(e,t){d.set(e),p=void 0!==t?t:1,j(d.r,d.g,d.b,p)},this.getClearAlpha=function(){return p},this.setClearAlpha=function(e){p=e,j(d.r,d.g,d.b,p)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=_.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=_.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=_.STENCIL_BUFFER_BIT),_.clear(r)},this.clearColor=function(){_.clear(_.COLOR_BUFFER_BIT)},this.clearDepth=function(){_.clear(_.DEPTH_BUFFER_BIT)},this.clearStencil=function(){_.clear(_.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.resetGLState=X;var fe=function(e){e.target.traverse((function(e){e.removeEventListener("remove",fe),function(e){e instanceof K.Mesh||e instanceof K.PointCloud||e instanceof K.Line?delete m[e.id]:(e instanceof K.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}(g,e);delete e.__webglInit,delete e._modelViewMatrix,delete e._normalMatrix,delete e.__webglActive}(e)}))},me=function(e){var t=e.target;t.removeEventListener("dispose",me),xe(t)},ge=function(e){var t=e.target;t.removeEventListener("dispose",ge),_e(t),E.info.memory.textures--},ve=function(e){var t=e.target;t.removeEventListener("dispose",ve),Ee(t),E.info.memory.textures--},ye=function(e){var t=e.target;t.removeEventListener("dispose",ye),Ae(t)},be=function(e){for(var t=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],i=0,r=t.length;i<r;i++){void 0!==e[n=t[i]]&&(_.deleteBuffer(e[n]),delete e[n])}if(void 0!==e.__webglCustomAttributesList){for(var n in e.__webglCustomAttributesList)_.deleteBuffer(e.__webglCustomAttributesList[n].buffer);delete e.__webglCustomAttributesList}E.info.memory.geometries--},xe=function(e){if(delete e.__webglInit,e instanceof K.BufferGeometry){for(var t in e.attributes){var i=e.attributes[t];void 0!==i.buffer&&(_.deleteBuffer(i.buffer),delete i.buffer)}E.info.memory.geometries--}else{var r=ke[e.id];if(void 0!==r){for(var n=0,o=r.length;n<o;n++){var s=r[n];if(void 0!==s.numMorphTargets){for(var a=0,l=s.numMorphTargets;a<l;a++)_.deleteBuffer(s.__webglMorphTargetsBuffers[a]);delete s.__webglMorphTargetsBuffers}if(void 0!==s.numMorphNormals){for(a=0,l=s.numMorphNormals;a<l;a++)_.deleteBuffer(s.__webglMorphNormalsBuffers[a]);delete s.__webglMorphNormalsBuffers}be(s)}delete ke[e.id]}else be(e)}T=""},_e=function(e){if(e.image&&e.image.__webglTextureCube)_.deleteTexture(e.image.__webglTextureCube),delete e.image.__webglTextureCube;else{if(void 0===e.__webglInit)return;_.deleteTexture(e.__webglTexture),delete e.__webglTexture,delete e.__webglInit}},Ee=function(e){if(e&&void 0!==e.__webglTexture){if(_.deleteTexture(e.__webglTexture),delete e.__webglTexture,e instanceof K.WebGLRenderTargetCube)for(var t=0;t<6;t++)_.deleteFramebuffer(e.__webglFramebuffer[t]),_.deleteRenderbuffer(e.__webglRenderbuffer[t]);else _.deleteFramebuffer(e.__webglFramebuffer),_.deleteRenderbuffer(e.__webglRenderbuffer);delete e.__webglFramebuffer,delete e.__webglRenderbuffer}},Ae=function(e){var t=e.program.program;if(void 0!==t){var i,r,n;e.program=void 0;var o=!1;for(i=0,r=A.length;i<r;i++)if((n=A[i]).program===t){n.usedTimes--,0===n.usedTimes&&(o=!0);break}if(!0===o){var s=[];for(i=0,r=A.length;i<r;i++)(n=A[i]).program!==t&&s.push(n);A=s,_.deleteProgram(t),E.info.memory.programs--}}};function Se(e){var t=e.geometry,i=e.material,r=t.vertices.length;if(i.attributes)for(var n in void 0===t.__webglCustomAttributesList&&(t.__webglCustomAttributesList=[]),i.attributes){var o=i.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(r*s),o.buffer=_.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}t.__webglCustomAttributesList.push(o)}}function we(e,t){var i=t.geometry,r=e.faces3,n=3*r.length,o=1*r.length,s=3*r.length,a=Me(t,e);e.__vertexArray=new Float32Array(3*n),e.__normalArray=new Float32Array(3*n),e.__colorArray=new Float32Array(3*n),e.__uvArray=new Float32Array(2*n),i.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*n)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*n)),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*n),e.__skinWeightArray=new Float32Array(4*n));var l=null!==W.get("OES_element_index_uint")&&o>21845?Uint32Array:Uint16Array;e.__typeArray=l,e.__faceArray=new l(3*o),e.__lineArray=new l(2*s);var h=e.numMorphTargets;if(h){e.__morphTargetsArrays=[];for(var c=0,u=h;c<u;c++)e.__morphTargetsArrays.push(new Float32Array(3*n))}var d=e.numMorphNormals;if(d){e.__morphNormalsArrays=[];for(c=0,u=d;c<u;c++)e.__morphNormalsArrays.push(new Float32Array(3*n))}if(e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes)for(var p in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),a.attributes){var f=a.attributes[p],m={};for(var g in f)m[g]=f[g];if(!m.__webglInitialized||m.createUniqueBuffers){m.__webglInitialized=!0;var v=1;"v2"===m.type?v=2:"v3"===m.type?v=3:"v4"===m.type?v=4:"c"===m.type&&(v=3),m.size=v,m.array=new Float32Array(n*v),m.buffer=_.createBuffer(),m.buffer.belongsToAttribute=p,f.needsUpdate=!0,m.__original=f}e.__webglCustomAttributesList.push(m)}e.__inittedArrays=!0}function Me(e,t){return e.material instanceof K.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Te(e,t,i,r,n){if(e.__inittedArrays){var o,s,a,l,h,c,u,d,p,f,m,g,v,y,b,x,E,A,S,w,M,T,C,P,D,L,I,R,O,N,F,k,V,U,B,G,z,H,W,j,q,X=function(e){return e instanceof K.MeshPhongMaterial==0&&e.shading===K.FlatShading}(n),Y=0,Q=0,Z=0,J=0,$=0,ee=0,te=0,ie=0,re=0,ne=0,oe=0,se=0,ae=e.__vertexArray,le=e.__uvArray,he=e.__uv2Array,ce=e.__normalArray,ue=e.__tangentArray,de=e.__colorArray,pe=e.__skinIndexArray,fe=e.__skinWeightArray,me=e.__morphTargetsArrays,ge=e.__morphNormalsArrays,ve=e.__webglCustomAttributesList,ye=e.__faceArray,be=e.__lineArray,xe=t.geometry,_e=xe.verticesNeedUpdate,Ee=xe.elementsNeedUpdate,Ae=xe.uvsNeedUpdate,Se=xe.normalsNeedUpdate,we=xe.tangentsNeedUpdate,Me=xe.colorsNeedUpdate,Te=xe.morphTargetsNeedUpdate,Ce=xe.vertices,Pe=e.faces3,De=xe.faces,Le=xe.faceVertexUvs[0],Ie=xe.faceVertexUvs[1],Re=xe.skinIndices,Oe=xe.skinWeights,Ne=xe.morphTargets,Fe=xe.morphNormals;if(_e){for(o=0,s=Pe.length;o<s;o++)m=Ce[(a=De[Pe[o]]).a],g=Ce[a.b],v=Ce[a.c],ae[Q]=m.x,ae[Q+1]=m.y,ae[Q+2]=m.z,ae[Q+3]=g.x,ae[Q+4]=g.y,ae[Q+5]=g.z,ae[Q+6]=v.x,ae[Q+7]=v.y,ae[Q+8]=v.z,Q+=9;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,ae,i)}if(Te)for(U=0,B=Ne.length;U<B;U++){for(oe=0,o=0,s=Pe.length;o<s;o++)a=De[H=Pe[o]],m=Ne[U].vertices[a.a],g=Ne[U].vertices[a.b],v=Ne[U].vertices[a.c],(G=me[U])[oe]=m.x,G[oe+1]=m.y,G[oe+2]=m.z,G[oe+3]=g.x,G[oe+4]=g.y,G[oe+5]=g.z,G[oe+6]=v.x,G[oe+7]=v.y,G[oe+8]=v.z,n.morphNormals&&(X?(A=E=Fe[U].faceNormals[H],S=E):(E=(W=Fe[U].vertexNormals[H]).a,A=W.b,S=W.c),(z=ge[U])[oe]=E.x,z[oe+1]=E.y,z[oe+2]=E.z,z[oe+3]=A.x,z[oe+4]=A.y,z[oe+5]=A.z,z[oe+6]=S.x,z[oe+7]=S.y,z[oe+8]=S.z),oe+=9;_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[U]),_.bufferData(_.ARRAY_BUFFER,me[U],i),n.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[U]),_.bufferData(_.ARRAY_BUFFER,ge[U],i))}if(Oe.length){for(o=0,s=Pe.length;o<s;o++)C=Oe[(a=De[Pe[o]]).a],P=Oe[a.b],D=Oe[a.c],fe[ne]=C.x,fe[ne+1]=C.y,fe[ne+2]=C.z,fe[ne+3]=C.w,fe[ne+4]=P.x,fe[ne+5]=P.y,fe[ne+6]=P.z,fe[ne+7]=P.w,fe[ne+8]=D.x,fe[ne+9]=D.y,fe[ne+10]=D.z,fe[ne+11]=D.w,L=Re[a.a],I=Re[a.b],R=Re[a.c],pe[ne]=L.x,pe[ne+1]=L.y,pe[ne+2]=L.z,pe[ne+3]=L.w,pe[ne+4]=I.x,pe[ne+5]=I.y,pe[ne+6]=I.z,pe[ne+7]=I.w,pe[ne+8]=R.x,pe[ne+9]=R.y,pe[ne+10]=R.z,pe[ne+11]=R.w,ne+=12;ne>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),_.bufferData(_.ARRAY_BUFFER,pe,i),_.bindBuffer(_.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),_.bufferData(_.ARRAY_BUFFER,fe,i))}if(Me){for(o=0,s=Pe.length;o<s;o++)c=(a=De[Pe[o]]).vertexColors,u=a.color,3===c.length&&n.vertexColors===K.VertexColors?(w=c[0],M=c[1],T=c[2]):(w=u,M=u,T=u),de[re]=w.r,de[re+1]=w.g,de[re+2]=w.b,de[re+3]=M.r,de[re+4]=M.g,de[re+5]=M.b,de[re+6]=T.r,de[re+7]=T.g,de[re+8]=T.b,re+=9;re>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,de,i))}if(we&&xe.hasTangents){for(o=0,s=Pe.length;o<s;o++)y=(d=(a=De[Pe[o]]).vertexTangents)[0],b=d[1],x=d[2],ue[te]=y.x,ue[te+1]=y.y,ue[te+2]=y.z,ue[te+3]=y.w,ue[te+4]=b.x,ue[te+5]=b.y,ue[te+6]=b.z,ue[te+7]=b.w,ue[te+8]=x.x,ue[te+9]=x.y,ue[te+10]=x.z,ue[te+11]=x.w,te+=12;_.bindBuffer(_.ARRAY_BUFFER,e.__webglTangentBuffer),_.bufferData(_.ARRAY_BUFFER,ue,i)}if(Se){for(o=0,s=Pe.length;o<s;o++)if(l=(a=De[Pe[o]]).vertexNormals,h=a.normal,3===l.length&&!1===X)for(O=0;O<3;O++)F=l[O],ce[ee]=F.x,ce[ee+1]=F.y,ce[ee+2]=F.z,ee+=3;else for(O=0;O<3;O++)ce[ee]=h.x,ce[ee+1]=h.y,ce[ee+2]=h.z,ee+=3;_.bindBuffer(_.ARRAY_BUFFER,e.__webglNormalBuffer),_.bufferData(_.ARRAY_BUFFER,ce,i)}if(Ae&&Le){for(o=0,s=Pe.length;o<s;o++)if(void 0!==(p=Le[Pe[o]]))for(O=0;O<3;O++)k=p[O],le[Z]=k.x,le[Z+1]=k.y,Z+=2;Z>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUVBuffer),_.bufferData(_.ARRAY_BUFFER,le,i))}if(Ae&&Ie){for(o=0,s=Pe.length;o<s;o++)if(void 0!==(f=Ie[Pe[o]]))for(O=0;O<3;O++)V=f[O],he[J]=V.x,he[J+1]=V.y,J+=2;J>0&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUV2Buffer),_.bufferData(_.ARRAY_BUFFER,he,i))}if(Ee){for(o=0,s=Pe.length;o<s;o++)ye[$]=Y,ye[$+1]=Y+1,ye[$+2]=Y+2,$+=3,be[ie]=Y,be[ie+1]=Y+1,be[ie+2]=Y,be[ie+3]=Y+2,be[ie+4]=Y+1,be[ie+5]=Y+2,ie+=6,Y+=3;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,ye,i),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,be,i)}if(ve)for(O=0,N=ve.length;O<N;O++)if((q=ve[O]).__original.needsUpdate){if(se=0,1===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)a=De[Pe[o]],q.array[se]=q.value[a.a],q.array[se+1]=q.value[a.b],q.array[se+2]=q.value[a.c],se+=3;else if("faces"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)j=q.value[Pe[o]],q.array[se]=j,q.array[se+1]=j,q.array[se+2]=j,se+=3}else if(2===q.size){if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)a=De[Pe[o]],m=q.value[a.a],g=q.value[a.b],v=q.value[a.c],q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=g.x,q.array[se+3]=g.y,q.array[se+4]=v.x,q.array[se+5]=v.y,se+=6;else if("faces"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)m=j=q.value[Pe[o]],g=j,v=j,q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=g.x,q.array[se+3]=g.y,q.array[se+4]=v.x,q.array[se+5]=v.y,se+=6}else if(3===q.size){var ke;if(ke="c"===q.type?["r","g","b"]:["x","y","z"],void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)a=De[Pe[o]],m=q.value[a.a],g=q.value[a.b],v=q.value[a.c],q.array[se]=m[ke[0]],q.array[se+1]=m[ke[1]],q.array[se+2]=m[ke[2]],q.array[se+3]=g[ke[0]],q.array[se+4]=g[ke[1]],q.array[se+5]=g[ke[2]],q.array[se+6]=v[ke[0]],q.array[se+7]=v[ke[1]],q.array[se+8]=v[ke[2]],se+=9;else if("faces"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)m=j=q.value[Pe[o]],g=j,v=j,q.array[se]=m[ke[0]],q.array[se+1]=m[ke[1]],q.array[se+2]=m[ke[2]],q.array[se+3]=g[ke[0]],q.array[se+4]=g[ke[1]],q.array[se+5]=g[ke[2]],q.array[se+6]=v[ke[0]],q.array[se+7]=v[ke[1]],q.array[se+8]=v[ke[2]],se+=9;else if("faceVertices"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)m=(j=q.value[Pe[o]])[0],g=j[1],v=j[2],q.array[se]=m[ke[0]],q.array[se+1]=m[ke[1]],q.array[se+2]=m[ke[2]],q.array[se+3]=g[ke[0]],q.array[se+4]=g[ke[1]],q.array[se+5]=g[ke[2]],q.array[se+6]=v[ke[0]],q.array[se+7]=v[ke[1]],q.array[se+8]=v[ke[2]],se+=9}else if(4===q.size)if(void 0===q.boundTo||"vertices"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)a=De[Pe[o]],m=q.value[a.a],g=q.value[a.b],v=q.value[a.c],q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=m.z,q.array[se+3]=m.w,q.array[se+4]=g.x,q.array[se+5]=g.y,q.array[se+6]=g.z,q.array[se+7]=g.w,q.array[se+8]=v.x,q.array[se+9]=v.y,q.array[se+10]=v.z,q.array[se+11]=v.w,se+=12;else if("faces"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)m=j=q.value[Pe[o]],g=j,v=j,q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=m.z,q.array[se+3]=m.w,q.array[se+4]=g.x,q.array[se+5]=g.y,q.array[se+6]=g.z,q.array[se+7]=g.w,q.array[se+8]=v.x,q.array[se+9]=v.y,q.array[se+10]=v.z,q.array[se+11]=v.w,se+=12;else if("faceVertices"===q.boundTo)for(o=0,s=Pe.length;o<s;o++)m=(j=q.value[Pe[o]])[0],g=j[1],v=j[2],q.array[se]=m.x,q.array[se+1]=m.y,q.array[se+2]=m.z,q.array[se+3]=m.w,q.array[se+4]=g.x,q.array[se+5]=g.y,q.array[se+6]=g.z,q.array[se+7]=g.w,q.array[se+8]=v.x,q.array[se+9]=v.y,q.array[se+10]=v.z,q.array[se+11]=v.w,se+=12;_.bindBuffer(_.ARRAY_BUFFER,q.buffer),_.bufferData(_.ARRAY_BUFFER,q.array,i)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Ce(e,t,i,r){for(var n=i.attributes,o=t.attributes,s=t.attributesKeys,a=0,l=s.length;a<l;a++){var h=s[a],c=o[h];if(c>=0){var u=n[h];if(void 0!==u){var d=u.itemSize;_.bindBuffer(_.ARRAY_BUFFER,u.buffer),H.enableAttribute(c),_.vertexAttribPointer(c,d,_.FLOAT,!1,0,r*d*4)}else void 0!==e.defaultAttributeValues&&(2===e.defaultAttributeValues[h].length?_.vertexAttrib2fv(c,e.defaultAttributeValues[h]):3===e.defaultAttributeValues[h].length&&_.vertexAttrib3fv(c,e.defaultAttributeValues[h]))}}H.disableUnusedAttributes()}function Pe(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function De(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Le(e,t){return t[0]-e[0]}function Ie(e){if(!1!==e.visible){if(e instanceof K.Scene||e instanceof K.Group);else if(function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new K.Matrix4,e._normalMatrix=new K.Matrix3,e.addEventListener("removed",fe));var t=e.geometry;void 0===t||void 0===t.__webglInit&&(t.__webglInit=!0,t.addEventListener("dispose",me),t instanceof K.BufferGeometry?E.info.memory.geometries++:e instanceof K.Mesh?Ue(e,t):e instanceof K.Line?void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),e.__webglLineDistanceBuffer=_.createBuffer(),E.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,Se(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):e instanceof K.PointCloud&&void 0===t.__webglVertexBuffer&&(!function(e){e.__webglVertexBuffer=_.createBuffer(),e.__webglColorBuffer=_.createBuffer(),E.info.memory.geometries++}(t),function(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__webglParticleCount=i,Se(t)}(t,e),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0));if(void 0===e.__webglActive)if(e.__webglActive=!0,e instanceof K.Mesh){if(t instanceof K.BufferGeometry)Be(m,t,e);else if(t instanceof K.Geometry)for(var i=ke[t.id],r=0,n=i.length;r<n;r++)Be(m,i[r],e)}else e instanceof K.Line||e instanceof K.PointCloud?Be(m,t,e):(e instanceof K.ImmediateRenderObject||e.immediateRenderCallback)&&function(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}(g,e)}(e),e instanceof K.Light)f.push(e);else if(e instanceof K.Sprite)b.push(e);else if(e instanceof K.LensFlare)x.push(e);else{var t=m[e.id];if(t&&(!1===e.frustumCulled||!0===F.intersectsObject(e)))for(var i=0,r=t.length;i<r;i++){var n=t[i];Fe(n),n.render=!0,!0===E.sortObjects&&(V.setFromMatrixPosition(e.matrixWorld),V.applyProjection(k),n.z=V.z)}}for(i=0,r=e.children.length;i<r;i++)Ie(e.children[i])}}function Re(e,t,i,r,n){for(var o,s=0,a=e.length;s<a;s++){var l=e[s],h=l.object,c=l.buffer;if(Ze(h,t),n)o=n;else{if(!(o=l.material))continue;qe(o)}E.setMaterialFaces(o),c instanceof K.BufferGeometry?E.renderBufferDirect(t,i,r,o,c,h):E.renderBuffer(t,i,r,o,c,h)}}function Oe(e,t,i,r,n,o){for(var s,a=0,l=e.length;a<l;a++){var h=e[a],c=h.object;if(c.visible){if(o)s=o;else{if(!(s=h[t]))continue;qe(s)}E.renderImmediateObject(i,r,n,s,c)}}}function Ne(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function Fe(e){var t=e.object,i=e.buffer,r=t.geometry,n=t.material;if(n instanceof K.MeshFaceMaterial){var o=r instanceof K.BufferGeometry?0:i.materialIndex;n=n.materials[o],e.material=n,n.transparent?y.push(e):v.push(e)}else n&&(e.material=n,n.transparent?y.push(e):v.push(e))}this.renderBufferImmediate=function(e,t,i){if(H.initAttributes(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=_.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=_.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=_.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=_.createBuffer()),e.hasPositions&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,e.positionArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.position),_.vertexAttribPointer(t.attributes.position,3,_.FLOAT,!1,0,0)),e.hasNormals){if(_.bindBuffer(_.ARRAY_BUFFER,e.__webglNormalBuffer),i instanceof K.MeshPhongMaterial==!1&&i.shading===K.FlatShading){var r,n,o,s,a,l,h,c,u,d,p,f=3*e.count;for(p=0;p<f;p+=9)s=(d=e.normalArray)[p],l=d[p+1],c=d[p+2],a=d[p+3],h=d[p+4],u=d[p+5],r=(s+a+d[p+6])/3,n=(l+h+d[p+7])/3,o=(c+u+d[p+8])/3,d[p]=r,d[p+1]=n,d[p+2]=o,d[p+3]=r,d[p+4]=n,d[p+5]=o,d[p+6]=r,d[p+7]=n,d[p+8]=o}_.bufferData(_.ARRAY_BUFFER,e.normalArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.normal),_.vertexAttribPointer(t.attributes.normal,3,_.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglUvBuffer),_.bufferData(_.ARRAY_BUFFER,e.uvArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.uv),_.vertexAttribPointer(t.attributes.uv,2,_.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==K.NoColors&&(_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,e.colorArray,_.DYNAMIC_DRAW),H.enableAttribute(t.attributes.color),_.vertexAttribPointer(t.attributes.color,3,_.FLOAT,!1,0,0)),H.disableUnusedAttributes(),_.drawArrays(_.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,o,s){if(!1!==n.visible){Ge(s);var a=Xe(e,t,i,n,s),l=!1,h=n.wireframe?1:0,c="direct_"+o.id+"_"+a.id+"_"+h;if(c!==T&&(T=c,l=!0),l&&H.initAttributes(),s instanceof K.Mesh){var u=!0===n.wireframe?_.LINES:_.TRIANGLES;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&W.get("OES_element_index_uint")?(v=_.UNSIGNED_INT,y=4):(v=_.UNSIGNED_SHORT,y=2),0===(b=o.offsets).length)l&&(Ce(n,a,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(u,g.array.length,v,0),E.info.render.calls++,E.info.render.vertices+=g.array.length,E.info.render.faces+=g.array.length/3;else{l=!0;for(var d=0,p=b.length;d<p;d++){var f=b[d].index;l&&(Ce(n,a,o,f),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(u,b[d].count,v,b[d].start*y),E.info.render.calls++,E.info.render.vertices+=b[d].count,E.info.render.faces+=b[d].count/3}}}else{l&&Ce(n,a,o,0);var m=o.attributes.position;_.drawArrays(u,0,m.array.length/m.itemSize),E.info.render.calls++,E.info.render.vertices+=m.array.length/m.itemSize,E.info.render.faces+=m.array.length/(3*m.itemSize)}}else if(s instanceof K.PointCloud){u=_.POINTS;if(g=o.attributes.index){if(g.array instanceof Uint32Array&&W.get("OES_element_index_uint")?(v=_.UNSIGNED_INT,y=4):(v=_.UNSIGNED_SHORT,y=2),0===(b=o.offsets).length)l&&(Ce(n,a,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(u,g.array.length,v,0),E.info.render.calls++,E.info.render.points+=g.array.length;else{b.length>1&&(l=!0);for(d=0,p=b.length;d<p;d++){f=b[d].index;l&&(Ce(n,a,o,f),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(u,b[d].count,v,b[d].start*y),E.info.render.calls++,E.info.render.points+=b[d].count}}}else{l&&Ce(n,a,o,0);m=o.attributes.position;if(0===(b=o.offsets).length)_.drawArrays(u,0,m.array.length/3),E.info.render.calls++,E.info.render.points+=m.array.length/3;else for(d=0,p=b.length;d<p;d++)_.drawArrays(u,b[d].index,b[d].count),E.info.render.calls++,E.info.render.points+=b[d].count}}else if(s instanceof K.Line){var g;u=s.mode===K.LineStrip?_.LINE_STRIP:_.LINES;if(H.setLineWidth(n.linewidth*r),g=o.attributes.index){var v,y;if(g.array instanceof Uint32Array?(v=_.UNSIGNED_INT,y=4):(v=_.UNSIGNED_SHORT,y=2),0===(b=o.offsets).length)l&&(Ce(n,a,o,0),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(u,g.array.length,v,0),E.info.render.calls++,E.info.render.vertices+=g.array.length;else{b.length>1&&(l=!0);for(d=0,p=b.length;d<p;d++){f=b[d].index;l&&(Ce(n,a,o,f),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,g.buffer)),_.drawElements(u,b[d].count,v,b[d].start*y),E.info.render.calls++,E.info.render.vertices+=b[d].count}}}else{l&&Ce(n,a,o,0);var b;m=o.attributes.position;if(0===(b=o.offsets).length)_.drawArrays(u,0,m.array.length/3),E.info.render.calls++,E.info.render.vertices+=m.array.length/3;else for(d=0,p=b.length;d<p;d++)_.drawArrays(u,b[d].index,b[d].count),E.info.render.calls++,E.info.render.vertices+=b[d].count}}}},this.renderBuffer=function(e,t,i,n,o,s){if(!1!==n.visible){Ge(s);var a=Xe(e,t,i,n,s),l=a.attributes,h=!1,c=n.wireframe?1:0,u=o.id+"_"+a.id+"_"+c;if(u!==T&&(T=u,h=!0),h&&H.initAttributes(),!n.morphTargets&&l.position>=0?h&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglVertexBuffer),H.enableAttribute(l.position),_.vertexAttribPointer(l.position,3,_.FLOAT,!1,0,0)):s.morphTargetBase&&function(e,t,i){var r=e.program.attributes;-1!==i.morphTargetBase&&r.position>=0?(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),H.enableAttribute(r.position),_.vertexAttribPointer(r.position,3,_.FLOAT,!1,0,0)):r.position>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglVertexBuffer),H.enableAttribute(r.position),_.vertexAttribPointer(r.position,3,_.FLOAT,!1,0,0));if(i.morphTargetForcedOrder.length)for(var n=0,o=i.morphTargetForcedOrder,s=i.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)(a=r["morphTarget"+n])>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[n]]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),(a=r["morphNormal"+n])>=0&&e.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[n]]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[n]=s[o[n]],n++;else{var a,l=[],h=(s=i.morphTargetInfluences,i.geometry.morphTargets);s.length>h.length&&(console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array."),s.length=h.length);for(var c=0,u=s.length;c<u;c++){var d=s[c];l.push([d,c])}l.length>e.numSupportedMorphTargets?(l.sort(Le),l.length=e.numSupportedMorphTargets):l.length>e.numSupportedMorphNormals?l.sort(Le):0===l.length&&l.push([0,0]);n=0;for(var p=e.numSupportedMorphTargets;n<p;n++)if(l[n]){var f=l[n][1];(a=r["morphTarget"+n])>=0&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[f]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),(a=r["morphNormal"+n])>=0&&e.morphNormals&&(_.bindBuffer(_.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[f]),H.enableAttribute(a),_.vertexAttribPointer(a,3,_.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[n]=s[f]}else i.__webglMorphTargetInfluences[n]=0}null!==e.program.uniforms.morphTargetInfluences&&_.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}(n,o,s),h){if(o.__webglCustomAttributesList)for(var d=0,p=o.__webglCustomAttributesList.length;d<p;d++){var f=o.__webglCustomAttributesList[d];l[f.buffer.belongsToAttribute]>=0&&(_.bindBuffer(_.ARRAY_BUFFER,f.buffer),H.enableAttribute(l[f.buffer.belongsToAttribute]),_.vertexAttribPointer(l[f.buffer.belongsToAttribute],f.size,_.FLOAT,!1,0,0))}l.color>=0&&(s.geometry.colors.length>0||s.geometry.faces.length>0?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglColorBuffer),H.enableAttribute(l.color),_.vertexAttribPointer(l.color,3,_.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&_.vertexAttrib3fv(l.color,n.defaultAttributeValues.color)),l.normal>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglNormalBuffer),H.enableAttribute(l.normal),_.vertexAttribPointer(l.normal,3,_.FLOAT,!1,0,0)),l.tangent>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglTangentBuffer),H.enableAttribute(l.tangent),_.vertexAttribPointer(l.tangent,4,_.FLOAT,!1,0,0)),l.uv>=0&&(s.geometry.faceVertexUvs[0]?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglUVBuffer),H.enableAttribute(l.uv),_.vertexAttribPointer(l.uv,2,_.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&_.vertexAttrib2fv(l.uv,n.defaultAttributeValues.uv)),l.uv2>=0&&(s.geometry.faceVertexUvs[1]?(_.bindBuffer(_.ARRAY_BUFFER,o.__webglUV2Buffer),H.enableAttribute(l.uv2),_.vertexAttribPointer(l.uv2,2,_.FLOAT,!1,0,0)):void 0!==n.defaultAttributeValues&&_.vertexAttrib2fv(l.uv2,n.defaultAttributeValues.uv2)),n.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),H.enableAttribute(l.skinIndex),_.vertexAttribPointer(l.skinIndex,4,_.FLOAT,!1,0,0),_.bindBuffer(_.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),H.enableAttribute(l.skinWeight),_.vertexAttribPointer(l.skinWeight,4,_.FLOAT,!1,0,0)),l.lineDistance>=0&&(_.bindBuffer(_.ARRAY_BUFFER,o.__webglLineDistanceBuffer),H.enableAttribute(l.lineDistance),_.vertexAttribPointer(l.lineDistance,1,_.FLOAT,!1,0,0))}if(H.disableUnusedAttributes(),s instanceof K.Mesh){var m=o.__typeArray===Uint32Array?_.UNSIGNED_INT:_.UNSIGNED_SHORT;n.wireframe?(H.setLineWidth(n.wireframeLinewidth*r),h&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),_.drawElements(_.LINES,o.__webglLineCount,m,0)):(h&&_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),_.drawElements(_.TRIANGLES,o.__webglFaceCount,m,0)),E.info.render.calls++,E.info.render.vertices+=o.__webglFaceCount,E.info.render.faces+=o.__webglFaceCount/3}else if(s instanceof K.Line){var g=s.mode===K.LineStrip?_.LINE_STRIP:_.LINES;H.setLineWidth(n.linewidth*r),_.drawArrays(g,0,o.__webglLineCount),E.info.render.calls++}else s instanceof K.PointCloud&&(_.drawArrays(_.POINTS,0,o.__webglParticleCount),E.info.render.calls++,E.info.render.points+=o.__webglParticleCount)}},this.render=function(e,t,i,r){if(t instanceof K.Camera!=!1){var n=e.fog;T="",M=-1,C=null,B=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),e.traverse((function(e){e instanceof K.SkinnedMesh&&e.skeleton.update()})),t.matrixWorldInverse.getInverse(t.matrixWorld),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),F.setFromMatrix(k),f.length=0,v.length=0,y.length=0,b.length=0,x.length=0,Ie(e),!0===E.sortObjects&&(v.sort(Pe),y.sort(De)),ce.render(e,t),E.info.render.calls=0,E.info.render.vertices=0,E.info.render.faces=0,E.info.render.points=0,this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var o=0,s=g.length;o<s;o++){var a=g[o],l=a.object;l.visible&&(Ze(l,t),Ne(a))}if(e.overrideMaterial){var h=e.overrideMaterial;qe(h),Re(v,t,f,n,h),Re(y,t,f,n,h),Oe(g,"",t,f,n,h)}else H.setBlending(K.NoBlending),Re(v,t,f,n,null),Oe(g,"opaque",t,f,n,null),Re(y,t,f,n,null),Oe(g,"transparent",t,f,n,null);ue.render(e,t),de.render(e,t,O,N),i&&i.generateMipmaps&&i.minFilter!==K.NearestFilter&&i.minFilter!==K.LinearFilter&&function(e){e instanceof K.WebGLRenderTargetCube?(_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture),_.generateMipmap(_.TEXTURE_CUBE_MAP),_.bindTexture(_.TEXTURE_CUBE_MAP,null)):(_.bindTexture(_.TEXTURE_2D,e.__webglTexture),_.generateMipmap(_.TEXTURE_2D),_.bindTexture(_.TEXTURE_2D,null))}(i),H.setDepthTest(!0),H.setDepthWrite(!0),H.setColorWrite(!0)}else K.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,i,r,n){var o=Xe(e,t,i,r,n);T="",E.setMaterialFaces(r),n.immediateRenderCallback?n.immediateRenderCallback(o,_,F):n.render((function(e){E.renderBufferImmediate(e,o,r)}))};var ke={},Ve=0;function Ue(e,t){var i=e.material,r=!1;void 0!==ke[t.id]&&!0!==t.groupsNeedUpdate||(delete m[e.id],ke[t.id]=function(e,t){for(var i,r,n=W.get("OES_element_index_uint")?4294967296:65535,o={},s=e.morphTargets.length,a=e.morphNormals.length,l={},h=[],c=0,u=e.faces.length;c<u;c++){var d=e.faces[c],p=t?d.materialIndex:0;p in o||(o[p]={hash:p,counter:0}),(i=o[p].hash+"_"+o[p].counter)in l||(r={id:Ve++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:s,numMorphNormals:a},l[i]=r,h.push(r)),l[i].vertices+3>n&&(o[p].counter+=1,(i=o[p].hash+"_"+o[p].counter)in l||(r={id:Ve++,faces3:[],materialIndex:p,vertices:0,numMorphTargets:s,numMorphNormals:a},l[i]=r,h.push(r))),l[i].faces3.push(c),l[i].vertices+=3}return h}(t,i instanceof K.MeshFaceMaterial),t.groupsNeedUpdate=!1);for(var n=ke[t.id],o=0,s=n.length;o<s;o++){var a=n[o];void 0===a.__webglVertexBuffer?(pe(a),we(a,e),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0,r=!0):r=!1,(r||void 0===e.__webglActive)&&Be(m,a,e)}e.__webglActive=!0}function Be(e,t,i){var r=i.id;e[r]=e[r]||[],e[r].push({id:r,buffer:t,object:i,material:null,z:0})}function Ge(e){var t=e.geometry;if(t instanceof K.BufferGeometry)for(var i=t.attributes,r=t.attributesKeys,n=0,o=r.length;n<o;n++){var s=r[n],a=i[s],l="index"===s?_.ELEMENT_ARRAY_BUFFER:_.ARRAY_BUFFER;void 0===a.buffer?(a.buffer=_.createBuffer(),_.bindBuffer(l,a.buffer),_.bufferData(l,a.array,a instanceof K.DynamicBufferAttribute?_.DYNAMIC_DRAW:_.STATIC_DRAW),a.needsUpdate=!1):!0===a.needsUpdate&&(_.bindBuffer(l,a.buffer),void 0===a.updateRange||-1===a.updateRange.count?_.bufferSubData(l,0,a.array):0===a.updateRange.count?console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually."):(_.bufferSubData(l,a.updateRange.offset*a.array.BYTES_PER_ELEMENT,a.array.subarray(a.updateRange.offset,a.updateRange.offset+a.updateRange.count)),a.updateRange.count=0),a.needsUpdate=!1)}else if(e instanceof K.Mesh){!0===t.groupsNeedUpdate&&Ue(e,t);for(var h=ke[t.id],c=(n=0,h.length);n<c;n++){var u=h[n],d=(p=Me(e,u)).attributes&&ze(p);(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||d)&&Te(u,e,_.DYNAMIC_DRAW,!t.dynamic,p)}t.verticesNeedUpdate=!1,t.morphTargetsNeedUpdate=!1,t.elementsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.tangentsNeedUpdate=!1,p.attributes&&He(p)}else if(e instanceof K.Line){d=(p=Me(e,t)).attributes&&ze(p);(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||d)&&function(e,t){var i,r,n,o,s,a,l,h,c,u,d,p,f=e.vertices,m=e.colors,g=e.lineDistances,v=f.length,y=m.length,b=g.length,x=e.__vertexArray,E=e.__colorArray,A=e.__lineDistanceArray,S=e.verticesNeedUpdate,w=e.colorsNeedUpdate,M=e.lineDistancesNeedUpdate,T=e.__webglCustomAttributesList;if(S){for(i=0;i<v;i++)o=f[i],x[s=3*i]=o.x,x[s+1]=o.y,x[s+2]=o.z;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,x,t)}if(w){for(r=0;r<y;r++)a=m[r],E[s=3*r]=a.r,E[s+1]=a.g,E[s+2]=a.b;_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,E,t)}if(M){for(n=0;n<b;n++)A[n]=g[n];_.bindBuffer(_.ARRAY_BUFFER,e.__webglLineDistanceBuffer),_.bufferData(_.ARRAY_BUFFER,A,t)}if(T)for(l=0,h=T.length;l<h;l++)if((p=T[l]).needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(s=0,u=p.value.length,1===p.size)for(c=0;c<u;c++)p.array[c]=p.value[c];else if(2===p.size)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,s+=2;else if(3===p.size)if("c"===p.type)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.r,p.array[s+1]=d.g,p.array[s+2]=d.b,s+=3;else for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,s+=3;else if(4===p.size)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,p.array[s+3]=d.w,s+=4;_.bindBuffer(_.ARRAY_BUFFER,p.buffer),_.bufferData(_.ARRAY_BUFFER,p.array,t),p.needsUpdate=!1}}(t,_.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,t.lineDistancesNeedUpdate=!1,p.attributes&&He(p)}else if(e instanceof K.PointCloud){var p;d=(p=Me(e,t)).attributes&&ze(p);(t.verticesNeedUpdate||t.colorsNeedUpdate||d)&&function(e,t,i){var r,n,o,s,a,l,h,c,u,d,p,f=e.vertices,m=f.length,g=e.colors,v=g.length,y=e.__vertexArray,b=e.__colorArray,x=e.verticesNeedUpdate,E=e.colorsNeedUpdate,A=e.__webglCustomAttributesList;if(x){for(r=0;r<m;r++)o=f[r],y[s=3*r]=o.x,y[s+1]=o.y,y[s+2]=o.z;_.bindBuffer(_.ARRAY_BUFFER,e.__webglVertexBuffer),_.bufferData(_.ARRAY_BUFFER,y,t)}if(E){for(n=0;n<v;n++)a=g[n],b[s=3*n]=a.r,b[s+1]=a.g,b[s+2]=a.b;_.bindBuffer(_.ARRAY_BUFFER,e.__webglColorBuffer),_.bufferData(_.ARRAY_BUFFER,b,t)}if(A)for(l=0,h=A.length;l<h;l++){if((p=A[l]).needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo))if(u=p.value.length,s=0,1===p.size)for(c=0;c<u;c++)p.array[c]=p.value[c];else if(2===p.size)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,s+=2;else if(3===p.size)if("c"===p.type)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.r,p.array[s+1]=d.g,p.array[s+2]=d.b,s+=3;else for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,s+=3;else if(4===p.size)for(c=0;c<u;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,p.array[s+3]=d.w,s+=4;_.bindBuffer(_.ARRAY_BUFFER,p.buffer),_.bufferData(_.ARRAY_BUFFER,p.array,t),p.needsUpdate=!1}}(t,_.DYNAMIC_DRAW),t.verticesNeedUpdate=!1,t.colorsNeedUpdate=!1,p.attributes&&He(p)}}function ze(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function He(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}var We={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function je(e,t,i,r){e.addEventListener("dispose",ye);var o=We[e.type];if(o){var s=K.ShaderLib[o];e.__webglShader={uniforms:K.UniformsUtils.clone(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}}else e.__webglShader={uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};var a=function(e){for(var t=0,i=0,r=0,n=0,o=0,s=e.length;o<s;o++){var a=e[o];a.onlyShadow||!1===a.visible||(a instanceof K.DirectionalLight&&t++,a instanceof K.PointLight&&i++,a instanceof K.SpotLight&&r++,a instanceof K.HemisphereLight&&n++)}return{directional:t,point:i,spot:r,hemi:n}}(t),l=function(e){for(var t=0,i=0,r=e.length;i<r;i++){var n=e[i];n.castShadow&&(n instanceof K.SpotLight&&t++,n instanceof K.DirectionalLight&&!n.shadowCascade&&t++)}return t}(t),h=function(e){if(te&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var t=_.getParameter(_.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4);return void 0!==e&&e instanceof K.SkinnedMesh&&(i=Math.min(e.skeleton.bones.length,i))<e.skeleton.bones.length&&K.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)"),i}(r),c={precision:n,supportsVertexTextures:ee,map:!!e.map,envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,combine:e.combine,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof K.FogExp2,flatShading:e.shading===K.FlatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:u,skinning:e.skinning,maxBones:h,useVertexTexture:te&&r&&r.skeleton&&r.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:E.maxMorphTargets,maxMorphNormals:E.maxMorphNormals,maxDirLights:a.directional,maxPointLights:a.point,maxSpotLights:a.spot,maxHemiLights:a.hemi,maxShadows:l,shadowMapEnabled:E.shadowMapEnabled&&r.receiveShadow&&l>0,shadowMapType:E.shadowMapType,shadowMapDebug:E.shadowMapDebug,shadowMapCascade:E.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===K.DoubleSide,flipSided:e.side===K.BackSide},d=[];if(o?d.push(o):(d.push(e.fragmentShader),d.push(e.vertexShader)),void 0!==e.defines)for(var p in e.defines)d.push(p),d.push(e.defines[p]);for(var p in c)d.push(p),d.push(c[p]);for(var f,m=d.join(),g=0,v=A.length;g<v;g++){var y=A[g];if(y.code===m){(f=y).usedTimes++;break}}void 0===f&&(f=new K.WebGLProgram(E,m,e,c),A.push(f),E.info.memory.programs=A.length),e.program=f;var b=f.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;for(var x="morphTarget",S=0;S<E.maxMorphTargets;S++)b[x+S]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;x="morphNormal";for(S=0;S<E.maxMorphNormals;S++)b[x+S]>=0&&e.numSupportedMorphNormals++}for(var w in e.uniformsList=[],e.__webglShader.uniforms){var M=e.program.uniforms[w];M&&e.uniformsList.push([e.__webglShader.uniforms[w],M])}}function qe(e){!0===e.transparent?H.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):H.setBlending(K.NoBlending),H.setDepthTest(e.depthTest),H.setDepthWrite(e.depthWrite),H.setColorWrite(e.colorWrite),H.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function Xe(e,i,r,n,o){P=0,n.needsUpdate&&(n.program&&Ae(n),je(n,i,r,o),n.needsUpdate=!1),n.morphTargets&&(o.__webglMorphTargetInfluences||(o.__webglMorphTargetInfluences=new Float32Array(E.maxMorphTargets)));var s=!1,a=!1,l=!1,h=n.program,c=h.uniforms,d=n.__webglShader.uniforms;if(h.id!==S&&(_.useProgram(h.program),S=h.id,s=!0,a=!0,l=!0),n.id!==M&&(-1===M&&(l=!0),M=n.id,a=!0),(s||e!==C)&&(_.uniformMatrix4fv(c.projectionMatrix,!1,e.projectionMatrix.elements),u&&_.uniform1f(c.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==C&&(C=e),(n instanceof K.ShaderMaterial||n instanceof K.MeshPhongMaterial||n.envMap)&&null!==c.cameraPosition&&(V.setFromMatrixPosition(e.matrixWorld),_.uniform3f(c.cameraPosition,V.x,V.y,V.z)),(n instanceof K.MeshPhongMaterial||n instanceof K.MeshLambertMaterial||n instanceof K.MeshBasicMaterial||n instanceof K.ShaderMaterial||n.skinning)&&null!==c.viewMatrix&&_.uniformMatrix4fv(c.viewMatrix,!1,e.matrixWorldInverse.elements)),n.skinning)if(o.bindMatrix&&null!==c.bindMatrix&&_.uniformMatrix4fv(c.bindMatrix,!1,o.bindMatrix.elements),o.bindMatrixInverse&&null!==c.bindMatrixInverse&&_.uniformMatrix4fv(c.bindMatrixInverse,!1,o.bindMatrixInverse.elements),te&&o.skeleton&&o.skeleton.useVertexTexture){if(null!==c.boneTexture){var p=Qe();_.uniform1i(c.boneTexture,p),E.setTexture(o.skeleton.boneTexture,p)}null!==c.boneTextureWidth&&_.uniform1i(c.boneTextureWidth,o.skeleton.boneTextureWidth),null!==c.boneTextureHeight&&_.uniform1i(c.boneTextureHeight,o.skeleton.boneTextureHeight)}else o.skeleton&&o.skeleton.boneMatrices&&null!==c.boneGlobalMatrices&&_.uniformMatrix4fv(c.boneGlobalMatrices,!1,o.skeleton.boneMatrices);return a&&(r&&n.fog&&function(e,t){e.fogColor.value=t.color,t instanceof K.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof K.FogExp2&&(e.fogDensity.value=t.density)}(d,r),(n instanceof K.MeshPhongMaterial||n instanceof K.MeshLambertMaterial||n.lights)&&(B&&(l=!0,function(e){var t,i,r,n,o,s,a,l,h=0,c=0,u=0,d=G,p=d.directional.colors,f=d.directional.positions,m=d.point.colors,g=d.point.positions,v=d.point.distances,y=d.point.decays,b=d.spot.colors,x=d.spot.positions,_=d.spot.distances,E=d.spot.directions,A=d.spot.anglesCos,S=d.spot.exponents,w=d.spot.decays,M=d.hemi.skyColors,T=d.hemi.groundColors,C=d.hemi.positions,P=0,D=0,L=0,I=0,R=0,O=0,N=0,F=0,k=0,B=0,z=0,H=0;for(t=0,i=e.length;t<i;t++)if(!(r=e[t]).onlyShadow)if(n=r.color,a=r.intensity,l=r.distance,r instanceof K.AmbientLight){if(!r.visible)continue;h+=n.r,c+=n.g,u+=n.b}else if(r instanceof K.DirectionalLight){if(R+=1,!r.visible)continue;U.setFromMatrixPosition(r.matrixWorld),V.setFromMatrixPosition(r.target.matrixWorld),U.sub(V),U.normalize(),f[k=3*P]=U.x,f[k+1]=U.y,f[k+2]=U.z,Je(p,k,n,a),P+=1}else if(r instanceof K.PointLight){if(O+=1,!r.visible)continue;Je(m,B=3*D,n,a),V.setFromMatrixPosition(r.matrixWorld),g[B]=V.x,g[B+1]=V.y,g[B+2]=V.z,v[D]=l,y[D]=0===r.distance?0:r.decay,D+=1}else if(r instanceof K.SpotLight){if(N+=1,!r.visible)continue;Je(b,z=3*L,n,a),U.setFromMatrixPosition(r.matrixWorld),x[z]=U.x,x[z+1]=U.y,x[z+2]=U.z,_[L]=l,V.setFromMatrixPosition(r.target.matrixWorld),U.sub(V),U.normalize(),E[z]=U.x,E[z+1]=U.y,E[z+2]=U.z,A[L]=Math.cos(r.angle),S[L]=r.exponent,w[L]=0===r.distance?0:r.decay,L+=1}else if(r instanceof K.HemisphereLight){if(F+=1,!r.visible)continue;U.setFromMatrixPosition(r.matrixWorld),U.normalize(),C[H=3*I]=U.x,C[H+1]=U.y,C[H+2]=U.z,o=r.color,s=r.groundColor,Je(M,H,o,a),Je(T,H,s,a),I+=1}for(t=3*P,i=Math.max(p.length,3*R);t<i;t++)p[t]=0;for(t=3*D,i=Math.max(m.length,3*O);t<i;t++)m[t]=0;for(t=3*L,i=Math.max(b.length,3*N);t<i;t++)b[t]=0;for(t=3*I,i=Math.max(M.length,3*F);t<i;t++)M[t]=0;for(t=3*I,i=Math.max(T.length,3*F);t<i;t++)T[t]=0;d.directional.length=P,d.point.length=D,d.spot.length=L,d.hemi.length=I,d.ambient[0]=h,d.ambient[1]=c,d.ambient[2]=u}(i),B=!1),l?(!function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}(d,G),Ke(d,!0)):Ke(d,!1)),(n instanceof K.MeshBasicMaterial||n instanceof K.MeshLambertMaterial||n instanceof K.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.alphaMap&&(i=t.alphaMap);if(void 0!==i){var r=i.offset,n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof K.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}(d,n),n instanceof K.LineBasicMaterial?Ye(d,n):n instanceof K.LineDashedMaterial?(Ye(d,n),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(d,n)):n instanceof K.PointCloudMaterial?function(e,i){if(e.psColor.value=i.color,e.opacity.value=i.opacity,e.size.value=i.size,e.scale.value=t.height/2,e.map.value=i.map,null!==i.map){var r=i.map.offset,n=i.map.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}}(d,n):n instanceof K.MeshPhongMaterial?function(e,t){e.shininess.value=t.shininess,e.emissive.value=t.emissive,e.specular.value=t.specular,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,n):n instanceof K.MeshLambertMaterial?function(e,t){e.emissive.value=t.emissive,t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,n):n instanceof K.MeshDepthMaterial?(d.mNear.value=e.near,d.mFar.value=e.far,d.opacity.value=n.opacity):n instanceof K.MeshNormalMaterial&&(d.opacity.value=n.opacity),o.receiveShadow&&!n._shadowPass&&function(e,t){if(e.shadowMatrix)for(var i=0,r=0,n=t.length;r<n;r++){var o=t[r];o.castShadow&&((o instanceof K.SpotLight||o instanceof K.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[i]=o.shadowMap,e.shadowMapSize.value[i]=o.shadowMapSize,e.shadowMatrix.value[i]=o.shadowMatrix,e.shadowDarkness.value[i]=o.shadowDarkness,e.shadowBias.value[i]=o.shadowBias,i++))}}(d,i),function(e){for(var t,i,r,n=0,o=e.length;n<o;n++){var s=e[n][0];if(!1!==s.needsUpdate){var a=s.type,l=s.value,h=e[n][1];switch(a){case"1i":case"i":_.uniform1i(h,l);break;case"1f":case"f":_.uniform1f(h,l);break;case"2f":_.uniform2f(h,l[0],l[1]);break;case"3f":_.uniform3f(h,l[0],l[1],l[2]);break;case"4f":_.uniform4f(h,l[0],l[1],l[2],l[3]);break;case"1iv":case"iv1":_.uniform1iv(h,l);break;case"3iv":case"iv":_.uniform3iv(h,l);break;case"1fv":case"fv1":_.uniform1fv(h,l);break;case"2fv":_.uniform2fv(h,l);break;case"3fv":case"fv":_.uniform3fv(h,l);break;case"4fv":_.uniform4fv(h,l);break;case"Matrix3fv":_.uniformMatrix3fv(h,!1,l);break;case"Matrix4fv":_.uniformMatrix4fv(h,!1,l);break;case"v2":_.uniform2f(h,l.x,l.y);break;case"v3":_.uniform3f(h,l.x,l.y,l.z);break;case"v4":_.uniform4f(h,l.x,l.y,l.z,l.w);break;case"c":_.uniform3f(h,l.r,l.g,l.b);break;case"v2v":void 0===s._array&&(s._array=new Float32Array(2*l.length));for(var c=0,u=l.length;c<u;c++)r=2*c,s._array[r]=l[c].x,s._array[r+1]=l[c].y;_.uniform2fv(h,s._array);break;case"v3v":void 0===s._array&&(s._array=new Float32Array(3*l.length));for(c=0,u=l.length;c<u;c++)r=3*c,s._array[r]=l[c].x,s._array[r+1]=l[c].y,s._array[r+2]=l[c].z;_.uniform3fv(h,s._array);break;case"v4v":void 0===s._array&&(s._array=new Float32Array(4*l.length));for(c=0,u=l.length;c<u;c++)r=4*c,s._array[r]=l[c].x,s._array[r+1]=l[c].y,s._array[r+2]=l[c].z,s._array[r+3]=l[c].w;_.uniform4fv(h,s._array);break;case"m3":_.uniformMatrix3fv(h,!1,l.elements);break;case"m3v":void 0===s._array&&(s._array=new Float32Array(9*l.length));for(c=0,u=l.length;c<u;c++)l[c].flattenToArrayOffset(s._array,9*c);_.uniformMatrix3fv(h,!1,s._array);break;case"m4":_.uniformMatrix4fv(h,!1,l.elements);break;case"m4v":void 0===s._array&&(s._array=new Float32Array(16*l.length));for(c=0,u=l.length;c<u;c++)l[c].flattenToArrayOffset(s._array,16*c);_.uniformMatrix4fv(h,!1,s._array);break;case"t":if(t=l,i=Qe(),_.uniform1i(h,i),!t)continue;t instanceof K.CubeTexture||t.image instanceof Array&&6===t.image.length?tt(t,i):t instanceof K.WebGLRenderTargetCube?it(t,i):E.setTexture(t,i);break;case"tv":void 0===s._array&&(s._array=[]);for(c=0,u=s.value.length;c<u;c++)s._array[c]=Qe();_.uniform1iv(h,s._array);for(c=0,u=s.value.length;c<u;c++)t=s.value[c],i=s._array[c],t&&E.setTexture(t,i);break;default:K.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}}(n.uniformsList)),function(e,t){_.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&_.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}(c,o),null!==c.modelMatrix&&_.uniformMatrix4fv(c.modelMatrix,!1,o.matrixWorld.elements),h}function Ye(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Ke(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Qe(){var e=P;return e>=Q&&K.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Q),P+=1,e}function Ze(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Je(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function $e(e,t,i){var r;i?(_.texParameteri(e,_.TEXTURE_WRAP_S,st(t.wrapS)),_.texParameteri(e,_.TEXTURE_WRAP_T,st(t.wrapT)),_.texParameteri(e,_.TEXTURE_MAG_FILTER,st(t.magFilter)),_.texParameteri(e,_.TEXTURE_MIN_FILTER,st(t.minFilter))):(_.texParameteri(e,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(e,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),t.wrapS===K.ClampToEdgeWrapping&&t.wrapT===K.ClampToEdgeWrapping||K.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),_.texParameteri(e,_.TEXTURE_MAG_FILTER,ot(t.magFilter)),_.texParameteri(e,_.TEXTURE_MIN_FILTER,ot(t.minFilter)),t.minFilter!==K.NearestFilter&&t.minFilter!==K.LinearFilter&&K.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),(r=W.get("EXT_texture_filter_anisotropic"))&&t.type!==K.FloatType&&t.type!==K.HalfFloatType&&(t.anisotropy>1||t.__currentAnisotropy)&&(_.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,E.getMaxAnisotropy())),t.__currentAnisotropy=t.anisotropy)}function et(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),r=document.createElement("canvas");return r.width=Math.floor(e.width*i),r.height=Math.floor(e.height*i),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),K.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function tt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",ge),e.image.__webglTextureCube=_.createTexture(),E.info.memory.textures++),_.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof K.CompressedTexture,r=e.image[0]instanceof K.DataTexture,n=[],o=0;o<6;o++)!E.autoScaleCubemaps||i||r?n[o]=r?e.image[o].image:e.image[o]:n[o]=et(e.image[o],$);var s=n[0],a=K.Math.isPowerOfTwo(s.width)&&K.Math.isPowerOfTwo(s.height),l=st(e.format),h=st(e.type);$e(_.TEXTURE_CUBE_MAP,e,a);for(o=0;o<6;o++)if(i)for(var c,u=n[o].mipmaps,d=0,p=u.length;d<p;d++)c=u[d],e.format!==K.RGBAFormat&&e.format!==K.RGBFormat?se().indexOf(l)>-1?_.compressedTexImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,c.width,c.height,0,c.data):K.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,d,l,c.width,c.height,0,l,h,c.data);else r?_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,n[o].width,n[o].height,0,l,h,n[o].data):_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,l,l,h,n[o]);e.generateMipmaps&&a&&_.generateMipmap(_.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else _.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function it(e,t){_.activeTexture(_.TEXTURE0+t),_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture)}function rt(e,t,i){_.bindFramebuffer(_.FRAMEBUFFER,e),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function nt(e,t){_.bindRenderbuffer(_.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_COMPONENT16,t.width,t.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(_.renderbufferStorage(_.RENDERBUFFER,_.DEPTH_STENCIL,t.width,t.height),_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,e)):_.renderbufferStorage(_.RENDERBUFFER,_.RGBA4,t.width,t.height)}function ot(e){return e===K.NearestFilter||e===K.NearestMipMapNearestFilter||e===K.NearestMipMapLinearFilter?_.NEAREST:_.LINEAR}function st(e){var t;if(e===K.RepeatWrapping)return _.REPEAT;if(e===K.ClampToEdgeWrapping)return _.CLAMP_TO_EDGE;if(e===K.MirroredRepeatWrapping)return _.MIRRORED_REPEAT;if(e===K.NearestFilter)return _.NEAREST;if(e===K.NearestMipMapNearestFilter)return _.NEAREST_MIPMAP_NEAREST;if(e===K.NearestMipMapLinearFilter)return _.NEAREST_MIPMAP_LINEAR;if(e===K.LinearFilter)return _.LINEAR;if(e===K.LinearMipMapNearestFilter)return _.LINEAR_MIPMAP_NEAREST;if(e===K.LinearMipMapLinearFilter)return _.LINEAR_MIPMAP_LINEAR;if(e===K.UnsignedByteType)return _.UNSIGNED_BYTE;if(e===K.UnsignedShort4444Type)return _.UNSIGNED_SHORT_4_4_4_4;if(e===K.UnsignedShort5551Type)return _.UNSIGNED_SHORT_5_5_5_1;if(e===K.UnsignedShort565Type)return _.UNSIGNED_SHORT_5_6_5;if(e===K.ByteType)return _.BYTE;if(e===K.ShortType)return _.SHORT;if(e===K.UnsignedShortType)return _.UNSIGNED_SHORT;if(e===K.IntType)return _.INT;if(e===K.UnsignedIntType)return _.UNSIGNED_INT;if(e===K.FloatType)return _.FLOAT;if(null!==(t=W.get("OES_texture_half_float"))&&e===K.HalfFloatType)return t.HALF_FLOAT_OES;if(e===K.AlphaFormat)return _.ALPHA;if(e===K.RGBFormat)return _.RGB;if(e===K.RGBAFormat)return _.RGBA;if(e===K.LuminanceFormat)return _.LUMINANCE;if(e===K.LuminanceAlphaFormat)return _.LUMINANCE_ALPHA;if(e===K.AddEquation)return _.FUNC_ADD;if(e===K.SubtractEquation)return _.FUNC_SUBTRACT;if(e===K.ReverseSubtractEquation)return _.FUNC_REVERSE_SUBTRACT;if(e===K.ZeroFactor)return _.ZERO;if(e===K.OneFactor)return _.ONE;if(e===K.SrcColorFactor)return _.SRC_COLOR;if(e===K.OneMinusSrcColorFactor)return _.ONE_MINUS_SRC_COLOR;if(e===K.SrcAlphaFactor)return _.SRC_ALPHA;if(e===K.OneMinusSrcAlphaFactor)return _.ONE_MINUS_SRC_ALPHA;if(e===K.DstAlphaFactor)return _.DST_ALPHA;if(e===K.OneMinusDstAlphaFactor)return _.ONE_MINUS_DST_ALPHA;if(e===K.DstColorFactor)return _.DST_COLOR;if(e===K.OneMinusDstColorFactor)return _.ONE_MINUS_DST_COLOR;if(e===K.SrcAlphaSaturateFactor)return _.SRC_ALPHA_SATURATE;if(null!==(t=W.get("WEBGL_compressed_texture_s3tc"))){if(e===K.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===K.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===K.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===K.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=W.get("WEBGL_compressed_texture_pvrtc"))){if(e===K.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===K.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===K.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===K.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=W.get("EXT_blend_minmax"))){if(e===K.MinEquation)return t.MIN_EXT;if(e===K.MaxEquation)return t.MAX_EXT}return 0}this.setFaceCulling=function(e,t){e===K.CullFaceNone?_.disable(_.CULL_FACE):(t===K.FrontFaceDirectionCW?_.frontFace(_.CW):_.frontFace(_.CCW),e===K.CullFaceBack?_.cullFace(_.BACK):e===K.CullFaceFront?_.cullFace(_.FRONT):_.cullFace(_.FRONT_AND_BACK),_.enable(_.CULL_FACE))},this.setMaterialFaces=function(e){H.setDoubleSided(e.side===K.DoubleSide),H.setFlipSided(e.side===K.BackSide)},this.uploadTexture=function(e){void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",ge),e.__webglTexture=_.createTexture(),E.info.memory.textures++),_.bindTexture(_.TEXTURE_2D,e.__webglTexture),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,e.flipY),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),_.pixelStorei(_.UNPACK_ALIGNMENT,e.unpackAlignment),e.image=et(e.image,J);var t=e.image,i=K.Math.isPowerOfTwo(t.width)&&K.Math.isPowerOfTwo(t.height),r=st(e.format),n=st(e.type);$e(_.TEXTURE_2D,e,i);var o,s=e.mipmaps;if(e instanceof K.DataTexture)if(s.length>0&&i){for(var a=0,l=s.length;a<l;a++)o=s[a],_.texImage2D(_.TEXTURE_2D,a,r,o.width,o.height,0,r,n,o.data);e.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,r,t.width,t.height,0,r,n,t.data);else if(e instanceof K.CompressedTexture)for(a=0,l=s.length;a<l;a++)o=s[a],e.format!==K.RGBAFormat&&e.format!==K.RGBFormat?se().indexOf(r)>-1?_.compressedTexImage2D(_.TEXTURE_2D,a,r,o.width,o.height,0,o.data):K.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_.texImage2D(_.TEXTURE_2D,a,r,o.width,o.height,0,r,n,o.data);else if(s.length>0&&i){for(a=0,l=s.length;a<l;a++)o=s[a],_.texImage2D(_.TEXTURE_2D,a,r,r,n,o);e.generateMipmaps=!1}else _.texImage2D(_.TEXTURE_2D,0,r,r,n,e.image);e.generateMipmaps&&i&&_.generateMipmap(_.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()},this.setTexture=function(e,t){_.activeTexture(_.TEXTURE0+t),e.needsUpdate?E.uploadTexture(e):_.bindTexture(_.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,i,r,n,o,s=e instanceof K.WebGLRenderTargetCube;if(e&&void 0===e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",ve),e.__webglTexture=_.createTexture(),E.info.memory.textures++;var a=K.Math.isPowerOfTwo(e.width)&&K.Math.isPowerOfTwo(e.height),l=st(e.format),h=st(e.type);if(s){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],_.bindTexture(_.TEXTURE_CUBE_MAP,e.__webglTexture),$e(_.TEXTURE_CUBE_MAP,e,a);for(var c=0;c<6;c++)e.__webglFramebuffer[c]=_.createFramebuffer(),e.__webglRenderbuffer[c]=_.createRenderbuffer(),_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,l,e.width,e.height,0,l,h,null),rt(e.__webglFramebuffer[c],e,_.TEXTURE_CUBE_MAP_POSITIVE_X+c),nt(e.__webglRenderbuffer[c],e);a&&_.generateMipmap(_.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=_.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=_.createRenderbuffer(),_.bindTexture(_.TEXTURE_2D,e.__webglTexture),$e(_.TEXTURE_2D,e,a),_.texImage2D(_.TEXTURE_2D,0,l,e.width,e.height,0,l,h,null),rt(e.__webglFramebuffer,e,_.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_ATTACHMENT,_.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&_.framebufferRenderbuffer(_.FRAMEBUFFER,_.DEPTH_STENCIL_ATTACHMENT,_.RENDERBUFFER,e.__webglRenderbuffer):nt(e.__webglRenderbuffer,e),a&&_.generateMipmap(_.TEXTURE_2D);s?_.bindTexture(_.TEXTURE_CUBE_MAP,null):_.bindTexture(_.TEXTURE_2D,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null)}e?(t=s?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,r=e.height,n=0,o=0):(t=null,i=I,r=R,n=D,o=L),t!==w&&(_.bindFramebuffer(_.FRAMEBUFFER,t),_.viewport(n,o,i,r),w=t),O=i,N=r},this.readRenderTargetPixels=function(e,t,i,r,n,o){if(e instanceof K.WebGLRenderTarget){if(e.__webglFramebuffer){if(e.format!==K.RGBAFormat)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");var s=!1;e.__webglFramebuffer!==w&&(_.bindFramebuffer(_.FRAMEBUFFER,e.__webglFramebuffer),s=!0),_.checkFramebufferStatus(_.FRAMEBUFFER)===_.FRAMEBUFFER_COMPLETE?_.readPixels(t,i,r,n,_.RGBA,_.UNSIGNED_BYTE,o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),s&&_.bindFramebuffer(_.FRAMEBUFFER,w)}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.initMaterial=function(){K.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){K.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){K.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){K.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},K.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:K.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:K.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:K.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:K.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new K.Vector2(0,0),this.repeat=new K.Vector2(1,1),this.format=void 0!==i.format?i.format:K.RGBAFormat,this.type=void 0!==i.type?i.type:K.UnsignedByteType,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=void 0!==i.shareDepthFrom?i.shareDepthFrom:null},K.WebGLRenderTarget.prototype={constructor:K.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new K.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},K.EventDispatcher.prototype.apply(K.WebGLRenderTarget.prototype),K.WebGLRenderTargetCube=function(e,t,i){K.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},K.WebGLRenderTargetCube.prototype=Object.create(K.WebGLRenderTarget.prototype),K.WebGLRenderTargetCube.prototype.constructor=K.WebGLRenderTargetCube,K.WebGLExtensions=function(e){var t={};this.get=function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return null===r&&K.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=r,r}},K.WebGLProgram=(F=0,function(e,t,i,r){var n=e,o=n.context,s=i.defines,a=i.__webglShader.uniforms,l=i.attributes,h=i.__webglShader.vertexShader,c=i.__webglShader.fragmentShader,u=i.index0AttributeName;void 0===u&&!0===r.morphTargets&&(u="position");var d="SHADOWMAP_TYPE_BASIC";r.shadowMapType===K.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":r.shadowMapType===K.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(i.envMap.mapping){case K.CubeReflectionMapping:case K.CubeRefractionMapping:p="ENVMAP_TYPE_CUBE";break;case K.EquirectangularReflectionMapping:case K.EquirectangularRefractionMapping:p="ENVMAP_TYPE_EQUIREC";break;case K.SphericalReflectionMapping:p="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case K.CubeRefractionMapping:case K.EquirectangularRefractionMapping:f="ENVMAP_MODE_REFRACTION"}switch(i.combine){case K.MultiplyOperation:m="ENVMAP_BLENDING_MULTIPLY";break;case K.MixOperation:m="ENVMAP_BLENDING_MIX";break;case K.AddOperation:m="ENVMAP_BLENDING_ADD"}}var g,v,y=e.gammaFactor>0?e.gammaFactor:1,b=function(e){var t,i,r=[];for(var n in e)!1!==(t=e[n])&&(i="#define "+n+" "+t,r.push(i));return r.join("\n")}(s),x=o.createProgram();i instanceof K.RawShaderMaterial?(g="",v=""):(g=["precision "+r.precision+" float;","precision "+r.precision+" int;",b,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.gammaInput?"#define GAMMA_INPUT":"",n.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+f:"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+d:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n"),v=["precision "+r.precision+" float;","precision "+r.precision+" int;",r.bumpMap||r.normalMap||r.flatShading?"#extension GL_OES_standard_derivatives : enable":"",b,"#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"",n.gammaInput?"#define GAMMA_INPUT":"",n.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+p:"",r.envMap?"#define "+f:"",r.envMap?"#define "+m:"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.metal?"#define METAL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+d:"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"));var _=new K.WebGLShader(o,o.VERTEX_SHADER,g+h),E=new K.WebGLShader(o,o.FRAGMENT_SHADER,v+c);o.attachShader(x,_),o.attachShader(x,E),void 0!==u&&o.bindAttribLocation(x,0,u),o.linkProgram(x);var A=o.getProgramInfoLog(x);!1===o.getProgramParameter(x,o.LINK_STATUS)&&K.error("THREE.WebGLProgram: shader error: "+o.getError(),"gl.VALIDATE_STATUS",o.getProgramParameter(x,o.VALIDATE_STATUS),"gl.getPRogramInfoLog",A),""!==A&&K.warn("THREE.WebGLProgram: gl.getProgramInfoLog()"+A),o.deleteShader(_),o.deleteShader(E);var S=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];for(var w in r.useVertexTexture?(S.push("boneTexture"),S.push("boneTextureWidth"),S.push("boneTextureHeight")):S.push("boneGlobalMatrices"),r.logarithmicDepthBuffer&&S.push("logDepthBufFC"),a)S.push(w);this.uniforms=function(e,t,i){for(var r={},n=0,o=i.length;n<o;n++){var s=i[n];r[s]=e.getUniformLocation(t,s)}return r}(o,x,S),S=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var M=0;M<r.maxMorphTargets;M++)S.push("morphTarget"+M);for(M=0;M<r.maxMorphNormals;M++)S.push("morphNormal"+M);for(var T in l)S.push(T);return this.attributes=function(e,t,i){for(var r={},n=0,o=i.length;n<o;n++){var s=i[n];r[s]=e.getAttribLocation(t,s)}return r}(o,x,S),this.attributesKeys=Object.keys(this.attributes),this.id=F++,this.code=t,this.usedTimes=1,this.program=x,this.vertexShader=_,this.fragmentShader=E,this}),K.WebGLShader=function(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&K.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&K.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e.getShaderInfoLog(r),function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(i)),r},K.WebGLState=function(e,t){var i=new Uint8Array(16),r=new Uint8Array(16),n=null,o=null,s=null,a=null,l=null,h=null,c=null,u=null,d=null,p=null,f=null,m=null,g=null,v=null,y=null,b=null;this.initAttributes=function(){for(var e=0,t=i.length;e<t;e++)i[e]=0},this.enableAttribute=function(t){i[t]=1,0===r[t]&&(e.enableVertexAttribArray(t),r[t]=1)},this.disableUnusedAttributes=function(){for(var t=0,n=r.length;t<n;t++)r[t]!==i[t]&&(e.disableVertexAttribArray(t),r[t]=0)},this.setBlending=function(i,r,u,d,p,f,m){i!==n&&(i===K.NoBlending?e.disable(e.BLEND):i===K.AdditiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):i===K.SubtractiveBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):i===K.MultiplyBlending?(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):i===K.CustomBlending?e.enable(e.BLEND):(e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),n=i),i===K.CustomBlending?(p=p||r,f=f||u,m=m||d,r===o&&p===l||(e.blendEquationSeparate(t(r),t(p)),o=r,l=p),u===s&&d===a&&f===h&&m===c||(e.blendFuncSeparate(t(u),t(d),t(f),t(m)),s=u,a=d,h=f,c=m)):(o=null,s=null,a=null,l=null,h=null,c=null)},this.setDepthTest=function(t){u!==t&&(t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),u=t)},this.setDepthWrite=function(t){d!==t&&(e.depthMask(t),d=t)},this.setColorWrite=function(t){p!==t&&(e.colorMask(t,t,t,t),p=t)},this.setDoubleSided=function(t){f!==t&&(t?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),f=t)},this.setFlipSided=function(t){m!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),m=t)},this.setLineWidth=function(t){t!==g&&(e.lineWidth(t),g=t)},this.setPolygonOffset=function(t,i,r){v!==t&&(t?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),v=t),!t||y===i&&b===r||(e.polygonOffset(i,r),y=i,b=r)},this.reset=function(){for(var e=0;e<r.length;e++)r[e]=0;n=null,u=null,d=null,p=null,f=null,m=null}},K.LensFlarePlugin=function(e,t){var i,r,n,o,s,a,l,h,c=e.context,u=function(){var t,u=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),d=new Uint16Array([0,1,2,0,2,3]);i=c.createBuffer(),r=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,i),c.bufferData(c.ARRAY_BUFFER,u,c.STATIC_DRAW),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),c.bufferData(c.ELEMENT_ARRAY_BUFFER,d,c.STATIC_DRAW),l=c.createTexture(),h=c.createTexture(),c.bindTexture(c.TEXTURE_2D,l),c.texImage2D(c.TEXTURE_2D,0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.bindTexture(c.TEXTURE_2D,h),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),t=(a=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0)?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},n=function(t){var i=c.createProgram(),r=c.createShader(c.FRAGMENT_SHADER),n=c.createShader(c.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return c.shaderSource(r,o+t.fragmentShader),c.shaderSource(n,o+t.vertexShader),c.compileShader(r),c.compileShader(n),c.attachShader(i,r),c.attachShader(i,n),c.linkProgram(i),i}(t),o={vertex:c.getAttribLocation(n,"position"),uv:c.getAttribLocation(n,"uv")},s={renderType:c.getUniformLocation(n,"renderType"),map:c.getUniformLocation(n,"map"),occlusionMap:c.getUniformLocation(n,"occlusionMap"),opacity:c.getUniformLocation(n,"opacity"),color:c.getUniformLocation(n,"color"),scale:c.getUniformLocation(n,"scale"),rotation:c.getUniformLocation(n,"rotation"),screenPosition:c.getUniformLocation(n,"screenPosition")}};this.render=function(d,p,f,m){if(0!==t.length){var g=new K.Vector3,v=m/f,y=.5*f,b=.5*m,x=16/m,_=new K.Vector2(x*v,x),E=new K.Vector3(1,1,0),A=new K.Vector2(1,1);void 0===n&&u(),c.useProgram(n),c.enableVertexAttribArray(o.vertex),c.enableVertexAttribArray(o.uv),c.uniform1i(s.occlusionMap,0),c.uniform1i(s.map,1),c.bindBuffer(c.ARRAY_BUFFER,i),c.vertexAttribPointer(o.vertex,2,c.FLOAT,!1,16,0),c.vertexAttribPointer(o.uv,2,c.FLOAT,!1,16,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),c.disable(c.CULL_FACE),c.depthMask(!1);for(var S=0,w=t.length;S<w;S++){x=16/m,_.set(x*v,x);var M=t[S];if(g.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),g.applyMatrix4(p.matrixWorldInverse),g.applyProjection(p.projectionMatrix),E.copy(g),A.x=E.x*y+y,A.y=E.y*b+b,a||A.x>0&&A.x<f&&A.y>0&&A.y<m){c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,l),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,A.x-8,A.y-8,16,16,0),c.uniform1i(s.renderType,0),c.uniform2f(s.scale,_.x,_.y),c.uniform3f(s.screenPosition,E.x,E.y,E.z),c.disable(c.BLEND),c.enable(c.DEPTH_TEST),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,A.x-8,A.y-8,16,16,0),c.uniform1i(s.renderType,1),c.disable(c.DEPTH_TEST),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,l),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0),M.positionScreen.copy(E),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),c.uniform1i(s.renderType,2),c.enable(c.BLEND);for(var T=0,C=M.lensFlares.length;T<C;T++){var P=M.lensFlares[T];P.opacity>.001&&P.scale>.001&&(E.x=P.x,E.y=P.y,E.z=P.z,x=P.size*P.scale/m,_.x=x*v,_.y=x,c.uniform3f(s.screenPosition,E.x,E.y,E.z),c.uniform2f(s.scale,_.x,_.y),c.uniform1f(s.rotation,P.rotation),c.uniform1f(s.opacity,P.opacity),c.uniform3f(s.color,P.color.r,P.color.g,P.color.b),e.state.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),e.setTexture(P.texture,1),c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0))}}}c.enable(c.CULL_FACE),c.enable(c.DEPTH_TEST),c.depthMask(!0),e.resetGLState()}}},K.ShadowMapPlugin=function(e,t,i,r){var n,o,s,a,l=e.context,h=new K.Frustum,c=new K.Matrix4,u=new K.Vector3,d=new K.Vector3,p=new K.Vector3,f=[],m=K.ShaderLib.depthRGBA,g=K.UniformsUtils.clone(m.uniforms);function v(e,t,r){if(t.visible){var n=i[t.id];if(n&&t.castShadow&&(!1===t.frustumCulled||!0===h.intersectsObject(t)))for(var o=0,s=n.length;o<s;o++){var a=n[o];t._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),f.push(a)}for(o=0,s=t.children.length;o<s;o++)v(e,t.children[o],r)}}function y(e,t){var i=new K.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,n=i.pointsFrustum,o=0;o<8;o++)r[o]=new K.Vector3,n[o]=new K.Vector3;var s=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t];return n[0].set(-1,-1,s),n[1].set(1,-1,s),n[2].set(-1,1,s),n[3].set(1,1,s),n[4].set(-1,-1,a),n[5].set(1,-1,a),n[6].set(-1,1,a),n[7].set(1,1,a),i}function b(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],o=i.pointsFrustum;o[0].z=r,o[1].z=r,o[2].z=r,o[3].z=r,o[4].z=n,o[5].z=n,o[6].z=n,o[7].z=n}function x(e,t){var i=t.shadowCamera,r=t.pointsFrustum,n=t.pointsWorld;u.set(1/0,1/0,1/0),d.set(-1/0,-1/0,-1/0);for(var o=0;o<8;o++){var s=n[o];s.copy(r[o]),s.unproject(e),s.applyMatrix4(i.matrixWorldInverse),s.x<u.x&&(u.x=s.x),s.x>d.x&&(d.x=s.x),s.y<u.y&&(u.y=s.y),s.y>d.y&&(d.y=s.y),s.z<u.z&&(u.z=s.z),s.z>d.z&&(d.z=s.z)}i.left=u.x,i.right=d.x,i.top=d.y,i.bottom=u.y,i.updateProjectionMatrix()}function _(e){return e.material instanceof K.MeshFaceMaterial?e.material.materials[0]:e.material}n=new K.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader}),o=new K.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0}),s=new K.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,skinning:!0}),a=new K.ShaderMaterial({uniforms:g,vertexShader:m.vertexShader,fragmentShader:m.fragmentShader,morphTargets:!0,skinning:!0}),n._shadowPass=!0,o._shadowPass=!0,s._shadowPass=!0,a._shadowPass=!0,this.render=function(i,u){if(!1!==e.shadowMapEnabled){var d,m,g,E,A,S,w,M,T,C,P,D,L,I=[],R=0,O=null;for(l.clearColor(1,1,1,1),l.disable(l.BLEND),l.enable(l.CULL_FACE),l.frontFace(l.CCW),e.shadowMapCullFace===K.CullFaceFront?l.cullFace(l.FRONT):l.cullFace(l.BACK),e.state.setDepthTest(!0),d=0,m=t.length;d<m;d++)if((L=t[d]).castShadow)if(L instanceof K.DirectionalLight&&L.shadowCascade)for(A=0;A<L.shadowCascadeCount;A++){var N;if(L.shadowCascadeArray[A])N=L.shadowCascadeArray[A];else{(N=y(L,A)).originalCamera=u;var F=new K.Gyroscope;F.position.copy(L.shadowCascadeOffset),F.add(N),F.add(N.target),u.add(F),L.shadowCascadeArray[A]=N}b(L,A),I[R]=N,R++}else I[R]=L,R++;for(d=0,m=I.length;d<m;d++){if(!(L=I[d]).shadowMap){var k=K.LinearFilter;e.shadowMapType===K.PCFSoftShadowMap&&(k=K.NearestFilter);var V={minFilter:k,magFilter:k,format:K.RGBAFormat};L.shadowMap=new K.WebGLRenderTarget(L.shadowMapWidth,L.shadowMapHeight,V),L.shadowMapSize=new K.Vector2(L.shadowMapWidth,L.shadowMapHeight),L.shadowMatrix=new K.Matrix4}if(!L.shadowCamera){if(L instanceof K.SpotLight)L.shadowCamera=new K.PerspectiveCamera(L.shadowCameraFov,L.shadowMapWidth/L.shadowMapHeight,L.shadowCameraNear,L.shadowCameraFar);else{if(!(L instanceof K.DirectionalLight)){K.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",L);continue}L.shadowCamera=new K.OrthographicCamera(L.shadowCameraLeft,L.shadowCameraRight,L.shadowCameraTop,L.shadowCameraBottom,L.shadowCameraNear,L.shadowCameraFar)}i.add(L.shadowCamera),!0===i.autoUpdate&&i.updateMatrixWorld()}var U,B,G;for(L.shadowCameraVisible&&!L.cameraHelper&&(L.cameraHelper=new K.CameraHelper(L.shadowCamera),i.add(L.cameraHelper)),L.isVirtual&&N.originalCamera==u&&x(u,L),S=L.shadowMap,w=L.shadowMatrix,(M=L.shadowCamera).position.setFromMatrixPosition(L.matrixWorld),p.setFromMatrixPosition(L.target.matrixWorld),M.lookAt(p),M.updateMatrixWorld(),M.matrixWorldInverse.getInverse(M.matrixWorld),L.cameraHelper&&(L.cameraHelper.visible=L.shadowCameraVisible),L.shadowCameraVisible&&L.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(M.projectionMatrix),w.multiply(M.matrixWorldInverse),c.multiplyMatrices(M.projectionMatrix,M.matrixWorldInverse),h.setFromMatrix(c),e.setRenderTarget(S),e.clear(),f.length=0,v(i,i,M),g=0,E=f.length;g<E;g++)D=(P=f[g]).object,T=P.buffer,U=_(D),B=void 0!==D.geometry.morphTargets&&D.geometry.morphTargets.length>0&&U.morphTargets,G=D instanceof K.SkinnedMesh&&U.skinning,C=D.customDepthMaterial?D.customDepthMaterial:G?B?a:s:B?o:n,e.setMaterialFaces(U),T instanceof K.BufferGeometry?e.renderBufferDirect(M,t,O,C,T,D):e.renderBuffer(M,t,O,C,T,D);for(g=0,E=r.length;g<E;g++)(D=(P=r[g]).object).visible&&D.castShadow&&(D._modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,D.matrixWorld),e.renderImmediateObject(M,t,O,n,D))}var z=e.getClearColor(),H=e.getClearAlpha();l.clearColor(z.r,z.g,z.b,H),l.enable(l.BLEND),e.shadowMapCullFace===K.CullFaceFront&&l.cullFace(l.BACK),e.resetGLState()}}},K.SpritePlugin=function(e,t){var i,r,n,o,s,a,l=e.context,h=new K.Vector3,c=new K.Quaternion,u=new K.Vector3,d=function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),h=new Uint16Array([0,1,2,0,2,3]);i=l.createBuffer(),r=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,i),l.bufferData(l.ARRAY_BUFFER,t,l.STATIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),l.bufferData(l.ELEMENT_ARRAY_BUFFER,h,l.STATIC_DRAW),n=function(){var t=l.createProgram(),i=l.createShader(l.VERTEX_SHADER),r=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),l.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),l.compileShader(i),l.compileShader(r),l.attachShader(t,i),l.attachShader(t,r),l.linkProgram(t),t}(),o={position:l.getAttribLocation(n,"position"),uv:l.getAttribLocation(n,"uv")},s={uvOffset:l.getUniformLocation(n,"uvOffset"),uvScale:l.getUniformLocation(n,"uvScale"),rotation:l.getUniformLocation(n,"rotation"),scale:l.getUniformLocation(n,"scale"),color:l.getUniformLocation(n,"color"),map:l.getUniformLocation(n,"map"),opacity:l.getUniformLocation(n,"opacity"),modelViewMatrix:l.getUniformLocation(n,"modelViewMatrix"),projectionMatrix:l.getUniformLocation(n,"projectionMatrix"),fogType:l.getUniformLocation(n,"fogType"),fogDensity:l.getUniformLocation(n,"fogDensity"),fogNear:l.getUniformLocation(n,"fogNear"),fogFar:l.getUniformLocation(n,"fogFar"),fogColor:l.getUniformLocation(n,"fogColor"),alphaTest:l.getUniformLocation(n,"alphaTest")};var c=document.createElement("canvas");c.width=8,c.height=8;var u=c.getContext("2d");u.fillStyle="white",u.fillRect(0,0,8,8),(a=new K.Texture(c)).needsUpdate=!0};function p(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(f,m){if(0!==t.length){void 0===n&&d(),l.useProgram(n),l.enableVertexAttribArray(o.position),l.enableVertexAttribArray(o.uv),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.bindBuffer(l.ARRAY_BUFFER,i),l.vertexAttribPointer(o.position,2,l.FLOAT,!1,16,0),l.vertexAttribPointer(o.uv,2,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),l.uniformMatrix4fv(s.projectionMatrix,!1,m.projectionMatrix.elements),l.activeTexture(l.TEXTURE0),l.uniform1i(s.map,0);var g=0,v=0,y=f.fog;y?(l.uniform3f(s.fogColor,y.color.r,y.color.g,y.color.b),y instanceof K.Fog?(l.uniform1f(s.fogNear,y.near),l.uniform1f(s.fogFar,y.far),l.uniform1i(s.fogType,1),g=1,v=1):y instanceof K.FogExp2&&(l.uniform1f(s.fogDensity,y.density),l.uniform1i(s.fogType,2),g=2,v=2)):(l.uniform1i(s.fogType,0),g=0,v=0);for(var b=0,x=t.length;b<x;b++){(E=t[b])._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,E.matrixWorld),E.z=-E._modelViewMatrix.elements[14]}t.sort(p);var _=[];for(b=0,x=t.length;b<x;b++){var E,A=(E=t[b]).material;l.uniform1f(s.alphaTest,A.alphaTest),l.uniformMatrix4fv(s.modelViewMatrix,!1,E._modelViewMatrix.elements),E.matrixWorld.decompose(h,c,u),_[0]=u.x,_[1]=u.y;var S=0;f.fog&&A.fog&&(S=v),g!==S&&(l.uniform1i(s.fogType,S),g=S),null!==A.map?(l.uniform2f(s.uvOffset,A.map.offset.x,A.map.offset.y),l.uniform2f(s.uvScale,A.map.repeat.x,A.map.repeat.y)):(l.uniform2f(s.uvOffset,0,0),l.uniform2f(s.uvScale,1,1)),l.uniform1f(s.opacity,A.opacity),l.uniform3f(s.color,A.color.r,A.color.g,A.color.b),l.uniform1f(s.rotation,A.rotation),l.uniform2fv(s.scale,_),e.state.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst),e.state.setDepthTest(A.depthTest),e.state.setDepthWrite(A.depthWrite),A.map&&A.map.image&&A.map.image.width?e.setTexture(A.map,0):e.setTexture(a,0),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0)}l.enable(l.CULL_FACE),e.resetGLState()}}},K.GeometryUtils={merge:function(e,t,i){var r;K.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof K.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return K.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},K.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,i,r){var n=new K.ImageLoader;n.crossOrigin=this.crossOrigin;var o=new K.Texture(void 0,t);return n.load(e,(function(e){o.image=e,o.needsUpdate=!0,i&&i(o)}),void 0,(function(e){r&&r(e)})),o.sourceFile=e,o},loadTextureCube:function(e,t,i,r){var n=new K.ImageLoader;n.crossOrigin=this.crossOrigin;var o=new K.CubeTexture([],t);o.flipY=!1;for(var s=0,a=function(t){n.load(e[t],(function(e){o.images[t]=e,6===(s+=1)&&(o.needsUpdate=!0,i&&i(o))}),void 0,r)},l=0,h=e.length;l<h;++l)a(l);return o},loadCompressedTexture:function(){K.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){K.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},r=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var n=e.width,o=e.height,s=document.createElement("canvas");s.width=n,s.height=o;var a=s.getContext("2d");a.drawImage(e,0,0);for(var l,h,c=a.getImageData(0,0,n,o).data,u=a.createImageData(n,o),d=u.data,p=0;p<n;p++)for(var f=0;f<o;f++){var m=f-1<0?0:f-1,g=f+1>o-1?o-1:f+1,v=p-1<0?0:p-1,y=p+1>n-1?n-1:p+1,b=[],x=[0,0,c[4*(f*n+p)]/255*t];b.push([-1,0,c[4*(f*n+v)]/255*t]),b.push([-1,-1,c[4*(m*n+v)]/255*t]),b.push([0,-1,c[4*(m*n+p)]/255*t]),b.push([1,-1,c[4*(m*n+y)]/255*t]),b.push([1,0,c[4*(f*n+y)]/255*t]),b.push([1,1,c[4*(g*n+y)]/255*t]),b.push([0,1,c[4*(g*n+p)]/255*t]),b.push([-1,1,c[4*(g*n+v)]/255*t]);for(var _=[],E=b.length,A=0;A<E;A++){var S=b[A],w=b[(A+1)%E];S=i(S,x),w=i(w,x),_.push(r((h=w,[(l=S)[1]*h[2]-l[2]*h[1],l[2]*h[0]-l[0]*h[2],l[0]*h[1]-l[1]*h[0]])))}var M=[0,0,0];for(A=0;A<_.length;A++)M[0]+=_[A][0],M[1]+=_[A][1],M[2]+=_[A][2];M[0]/=_.length,M[1]/=_.length,M[2]/=_.length;var T=4*(f*n+p);d[T]=(M[0]+1)/2*255|0,d[T+1]=(M[1]+1)/2*255|0,d[T+2]=255*M[2]|0,d[T+3]=255}return a.putImageData(u,0,0),s},generateDataTexture:function(e,t,i){for(var r=e*t,n=new Uint8Array(3*r),o=Math.floor(255*i.r),s=Math.floor(255*i.g),a=Math.floor(255*i.b),l=0;l<r;l++)n[3*l]=o,n[3*l+1]=s,n[3*l+2]=a;var h=new K.DataTexture(n,e,t,K.RGBFormat);return h.needsUpdate=!0,h}},K.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new K.Object3D,r=0,n=t.length;r<n;r++)i.add(new K.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new K.Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}},K.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;return i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,n=0,o=String(e).split(""),s=o.length,a=[];for(t=0;t<s;t++){var l=new K.Path,h=this.extractGlyphPoints(o[t],i,r,n,l);n+=h.offset,a.push(h.path)}return{paths:a,offset:n/2}},extractGlyphPoints:function(e,t,i,r,n){var o,s,a,l,h,c,u,d,p,f,m,g,v,y,b,x,_,E,A=[],S=t.glyphs[e]||t.glyphs["?"];if(S){if(S.o)for(h=(l=S._cachedOutline||(S._cachedOutline=S.o.split(" "))).length,c=i,u=i,o=0;o<h;)switch(l[o++]){case"m":d=l[o++]*c+r,p=l[o++]*u,n.moveTo(d,p);break;case"l":d=l[o++]*c+r,p=l[o++]*u,n.lineTo(d,p);break;case"q":if(f=l[o++]*c+r,m=l[o++]*u,y=l[o++]*c+r,b=l[o++]*u,n.quadraticCurveTo(y,b,f,m),E=A[A.length-1])for(g=E.x,v=E.y,s=1,a=this.divisions;s<=a;s++){var w=s/a;K.Shape.Utils.b2(w,g,y,f),K.Shape.Utils.b2(w,v,b,m)}break;case"b":if(f=l[o++]*c+r,m=l[o++]*u,y=l[o++]*c+r,b=l[o++]*u,x=l[o++]*c+r,_=l[o++]*u,n.bezierCurveTo(y,b,x,_,f,m),E=A[A.length-1])for(g=E.x,v=E.y,s=1,a=this.divisions;s<=a;s++){w=s/a;K.Shape.Utils.b3(w,g,y,x,f),K.Shape.Utils.b3(w,v,b,_,m)}}return{offset:S.ha*i,path:n}}}},K.FontUtils.generateShapes=function(e,t){var i=void 0!==(t=t||{}).size?t.size:100,r=void 0!==t.curveSegments?t.curveSegments:4,n=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";K.FontUtils.size=i,K.FontUtils.divisions=r,K.FontUtils.face=n,K.FontUtils.weight=o,K.FontUtils.style=s;for(var a=K.FontUtils.drawText(e).paths,l=[],h=0,c=a.length;h<c;h++)Array.prototype.push.apply(l,a[h].toShapes());return l},k=K.FontUtils,V=1e-10,U=function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},B=function(e,t,i,r,n,o){var s,a,l,h,c,u,d,p,f,m,g,v,y,b,x;if(a=e[o[t]].x,l=e[o[t]].y,h=e[o[i]].x,c=e[o[i]].y,u=e[o[r]].x,d=e[o[r]].y,V>(h-a)*(d-l)-(c-l)*(u-a))return!1;for(m=u-h,g=d-c,v=a-u,y=l-d,b=h-a,x=c-l,s=0;s<n;s++)if(p=e[o[s]].x,f=e[o[s]].y,!(p===a&&f===l||p===h&&f===c||p===u&&f===d)&&m*(f-c)-g*(p-h)>=-1e-10&&v*(f-d)-y*(p-u)>=-1e-10&&b*(f-l)-x*(p-a)>=-1e-10)return!1;return!0},k.Triangulate=function(e,t){var i=e.length;if(i<3)return null;var r,n,o,s=[],a=[],l=[];if(U(e)>0)for(n=0;n<i;n++)a[n]=n;else for(n=0;n<i;n++)a[n]=i-1-n;var h=i,c=2*h;for(n=h-1;h>2;){if(c--<=0)return K.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?l:s;if(h<=(r=n)&&(r=0),h<=(n=r+1)&&(n=0),h<=(o=n+1)&&(o=0),B(e,r,n,o,h,a)){var u,d,p,f,m;for(u=a[r],d=a[n],p=a[o],s.push([e[u],e[d],e[p]]),l.push([a[r],a[n],a[o]]),f=n,m=n+1;m<h;f++,m++)a[f]=a[m];c=2*--h}}return t?l:s},k.Triangulate.area=U,K.Audio=function(e){K.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.isPlaying=!1},K.Audio.prototype=Object.create(K.Object3D.prototype),K.Audio.prototype.constructor=K.Audio,K.Audio.prototype.load=function(e){var t=this,i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(e){t.context.decodeAudioData(this.response,(function(e){t.source.buffer=e,t.autoplay&&t.play()}))},i.send(),this},K.Audio.prototype.play=function(){if(!0!==this.isPlaying){var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.connect(this.panner),e.start(0,this.startTime),this.isPlaying=!0,this.source=e}else K.warn("THREE.Audio: Audio is already playing.")},K.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},K.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},K.Audio.prototype.onEnded=function(){this.isPlaying=!1},K.Audio.prototype.setLoop=function(e){this.source.loop=e},K.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},K.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},K.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},K.Audio.prototype.updateMatrixWorld=function(){var e=new K.Vector3;return function(t){K.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),K.AudioListener=function(){K.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},K.AudioListener.prototype=Object.create(K.Object3D.prototype),K.AudioListener.prototype.constructor=K.AudioListener,K.AudioListener.prototype.updateMatrixWorld=function(){var e=new K.Vector3,t=new K.Quaternion,i=new K.Vector3,r=new K.Vector3,n=new K.Vector3,o=new K.Vector3;return function(s){K.Object3D.prototype.updateMatrixWorld.call(this,s);var a=this.context.listener,l=this.up;this.matrixWorld.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),n.subVectors(e,o),a.setPosition(e.x,e.y,e.z),a.setOrientation(r.x,r.y,r.z,l.x,l.y,l.z),a.setVelocity(n.x,n.y,n.z),o.copy(e)}}(),K.Curve=function(){},K.Curve.prototype.getPoint=function(e){return K.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},K.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},K.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},K.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},K.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},K.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},K.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},K.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var s,a=0,l=o-1;a<=l;)if((s=r[n=Math.floor(a+(l-a)/2)]-i)<0)a=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(r[n=l]==i)return n/(o-1);var h=r[n];return(n+(i-h)/(r[n+1]-h))/(o-1)},K.Curve.prototype.getTangent=function(e){var t=1e-4,i=e-t,r=e+t;i<0&&(i=0),r>1&&(r=1);var n=this.getPoint(i);return this.getPoint(r).clone().sub(n).normalize()},K.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},K.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e,t,i,r,n){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,n){var o=.5*(i-e),s=.5*(r-t),a=n*n;return(2*t-2*i+o+s)*(n*a)+(-3*t+3*i-2*o-s)*a+o*n+t}},K.Curve.create=function(e,t){return e.prototype=Object.create(K.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},K.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},K.CurvePath.prototype=Object.create(K.Curve.prototype),K.CurvePath.prototype.constructor=K.CurvePath,K.CurvePath.prototype.add=function(e){this.curves.push(e)},K.CurvePath.prototype.checkConnection=function(){},K.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new K.LineCurve(t,e))},K.CurvePath.prototype.getPoint=function(e){for(var t,i=e*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=i){var o=1-(r[n]-i)/(t=this.curves[n]).getLength();return t.getPointAt(o)}n++}return null},K.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},K.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,r=this.curves.length;for(e=0;e<r;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},K.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,n,o,s,a,l,h,c=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=n=Number.POSITIVE_INFINITY;var u=c[0]instanceof K.Vector3;for(h=u?new K.Vector3:new K.Vector2,a=0,l=c.length;a<l;a++)(s=c[a]).x>e?e=s.x:s.x<r&&(r=s.x),s.y>t?t=s.y:s.y<n&&(n=s.y),u&&(s.z>i?i=s.z:s.z<o&&(o=s.z)),h.add(s);var d={minX:r,minY:n,maxX:e,maxY:t};return u&&(d.maxZ=i,d.minZ=o),d},K.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},K.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},K.CurvePath.prototype.createGeometry=function(e){for(var t=new K.Geometry,i=0;i<e.length;i++)t.vertices.push(new K.Vector3(e[i].x,e[i].y,e[i].z||0));return t},K.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},K.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,n=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)n=this.getWrapPoints(n,t[i]);return n},K.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,n=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)n=this.getWrapPoints(n,t[i]);return n},K.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,n,o,s,a,l=this.getBoundingBox();for(i=0,r=e.length;i<r;i++){o=(n=e[i]).x,s=n.y,a=o/l.maxX,a=t.getUtoTmapping(a,o);var h=t.getPoint(a),c=t.getTangent(a);c.set(-c.y,c.x).multiplyScalar(s),n.x=h.x+c.x,n.y=h.y+c.y}return e},K.Gyroscope=function(){K.Object3D.call(this)},K.Gyroscope.prototype=Object.create(K.Object3D.prototype),K.Gyroscope.prototype.constructor=K.Gyroscope,K.Gyroscope.prototype.updateMatrixWorld=(G=new K.Vector3,z=new K.Quaternion,H=new K.Vector3,W=new K.Vector3,j=new K.Quaternion,q=new K.Vector3,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(W,j,q),this.matrix.decompose(G,z,H),this.matrixWorld.compose(W,z,q)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)}),K.Path=function(e){K.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},K.Path.prototype=Object.create(K.CurvePath.prototype),K.Path.prototype.constructor=K.Path,K.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},K.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},K.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:K.PathActions.MOVE_TO,args:i})},K.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,n=r[r.length-2],o=r[r.length-1],s=new K.LineCurve(new K.Vector2(n,o),new K.Vector2(e,t));this.curves.push(s),this.actions.push({action:K.PathActions.LINE_TO,args:i})},K.Path.prototype.quadraticCurveTo=function(e,t,i,r){var n=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,s=o[o.length-2],a=o[o.length-1],l=new K.QuadraticBezierCurve(new K.Vector2(s,a),new K.Vector2(e,t),new K.Vector2(i,r));this.curves.push(l),this.actions.push({action:K.PathActions.QUADRATIC_CURVE_TO,args:n})},K.Path.prototype.bezierCurveTo=function(e,t,i,r,n,o){var s=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,l=a[a.length-2],h=a[a.length-1],c=new K.CubicBezierCurve(new K.Vector2(l,h),new K.Vector2(e,t),new K.Vector2(i,r),new K.Vector2(n,o));this.curves.push(c),this.actions.push({action:K.PathActions.BEZIER_CURVE_TO,args:s})},K.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],n=i[i.length-1],o=[new K.Vector2(r,n)];Array.prototype.push.apply(o,e);var s=new K.SplineCurve(o);this.curves.push(s),this.actions.push({action:K.PathActions.CSPLINE_THRU,args:t})},K.Path.prototype.arc=function(e,t,i,r,n,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1];this.absarc(e+a,t+l,i,r,n,o)},K.Path.prototype.absarc=function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},K.Path.prototype.ellipse=function(e,t,i,r,n,o,s){var a=this.actions[this.actions.length-1].args,l=a[a.length-2],h=a[a.length-1];this.absellipse(e+l,t+h,i,r,n,o,s)},K.Path.prototype.absellipse=function(e,t,i,r,n,o,s){var a=Array.prototype.slice.call(arguments),l=new K.EllipseCurve(e,t,i,r,n,o,s);this.curves.push(l);var h=l.getPoint(1);a.push(h.x),a.push(h.y),this.actions.push({action:K.PathActions.ELLIPSE,args:a})},K.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],r=0;r<e;r++)i.push(this.getPoint(r/e));return i},K.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,n,o,s,a,l,h,c,u,d,p,f,m,g,v,y,b,x=[];for(i=0,r=this.actions.length;i<r;i++)switch(o=(n=this.actions[i]).action,s=n.args,o){case K.PathActions.MOVE_TO:case K.PathActions.LINE_TO:x.push(new K.Vector2(s[0],s[1]));break;case K.PathActions.QUADRATIC_CURVE_TO:for(a=s[2],l=s[3],u=s[0],d=s[1],x.length>0?(p=(m=x[x.length-1]).x,f=m.y):(p=(m=this.actions[i-1].args)[m.length-2],f=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=K.Shape.Utils.b2(v,p,u,a),b=K.Shape.Utils.b2(v,f,d,l),x.push(new K.Vector2(y,b));break;case K.PathActions.BEZIER_CURVE_TO:for(a=s[4],l=s[5],u=s[0],d=s[1],h=s[2],c=s[3],x.length>0?(p=(m=x[x.length-1]).x,f=m.y):(p=(m=this.actions[i-1].args)[m.length-2],f=m[m.length-1]),g=1;g<=e;g++)v=g/e,y=K.Shape.Utils.b3(v,p,u,h,a),b=K.Shape.Utils.b3(v,f,d,c,l),x.push(new K.Vector2(y,b));break;case K.PathActions.CSPLINE_THRU:m=this.actions[i-1].args;var _=[new K.Vector2(m[m.length-2],m[m.length-1])],E=e*s[0].length;_=_.concat(s[0]);var A=new K.SplineCurve(_);for(g=1;g<=E;g++)x.push(A.getPointAt(g/E));break;case K.PathActions.ARC:var S=s[0],w=s[1],M=s[2],T=s[3],C=s[4],P=!!s[5],D=C-T,L=2*e;for(g=1;g<=L;g++)v=g/L,P||(v=1-v),I=T+v*D,y=S+M*Math.cos(I),b=w+M*Math.sin(I),x.push(new K.Vector2(y,b));break;case K.PathActions.ELLIPSE:S=s[0],w=s[1];var I,R=s[2],O=s[3];T=s[4],C=s[5],P=!!s[6],D=C-T,L=2*e;for(g=1;g<=L;g++)v=g/L,P||(v=1-v),I=T+v*D,y=S+R*Math.cos(I),b=w+O*Math.sin(I),x.push(new K.Vector2(y,b))}var N=x[x.length-1];return Math.abs(N.x-x[0].x)<1e-10&&Math.abs(N.y-x[0].y)<1e-10&&x.splice(x.length-1,1),t&&x.push(x[0]),x},K.Path.prototype.toShapes=function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new K.Shape;o.actions=n.actions,o.curves=n.curves,t.push(o)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var s=t[n],a=t[o],l=a.x-s.x,h=a.y-s.y;if(Math.abs(h)>1e-10){if(h<0&&(s=t[o],l=-l,a=t[n],h=-h),e.y<s.y||e.y>a.y)continue;if(e.y==s.y){if(e.x==s.x)return!0}else{var c=h*(e.x-s.x)-l*(e.y-s.y);if(0==c)return!0;if(c<0)continue;r=!r}}else{if(e.y!=s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return r}var n=function(e){var t,i,r,n,o,s=[],a=new K.Path;for(t=0,i=e.length;t<i;t++)o=(r=e[t]).args,(n=r.action)==K.PathActions.MOVE_TO&&0!=a.actions.length&&(s.push(a),a=new K.Path),a[n].apply(a,o);return 0!=a.actions.length&&s.push(a),s}(this.actions);if(0==n.length)return[];if(!0===t)return i(n);var o,s,a,l=[];if(1==n.length)return s=n[0],(a=new K.Shape).actions=s.actions,a.curves=s.curves,l.push(a),l;var h=!K.Shape.Utils.isClockWise(n[0].getPoints());h=e?!h:h;var c,u,d,p,f,m,g=[],v=[],y=[],b=0;for(v[b]=void 0,y[b]=[],u=0,d=n.length;u<d;u++)c=(s=n[u]).getPoints(),o=K.Shape.Utils.isClockWise(c),(o=e?!o:o)?(!h&&v[b]&&b++,v[b]={s:new K.Shape,p:c},v[b].s.actions=s.actions,v[b].s.curves=s.curves,h&&b++,y[b]=[]):y[b].push({h:s,p:c[0]});if(!v[0])return i(n);if(v.length>1){for(var x=!1,_=[],E=0,A=v.length;E<A;E++)g[E]=[];for(E=0,A=v.length;E<A;E++)for(var S=y[E],w=0;w<S.length;w++){for(var M=S[w],T=!0,C=0;C<v.length;C++)r(M.p,v[C].p)&&(E!=C&&_.push({froms:E,tos:C,hole:w}),T?(T=!1,g[C].push(M)):x=!0);T&&g[E].push(M)}_.length>0&&(x||(y=g))}for(u=0,d=v.length;u<d;u++)for(a=v[u].s,l.push(a),f=0,m=(p=y[u]).length;f<m;f++)a.holes.push(p[f].h);return l},K.Shape=function(){K.Path.apply(this,arguments),this.holes=[]},K.Shape.prototype=Object.create(K.Path.prototype),K.Shape.prototype.constructor=K.Shape,K.Shape.prototype.extrude=function(e){return new K.ExtrudeGeometry(this,e)},K.Shape.prototype.makeGeometry=function(e){return new K.ShapeGeometry(this,e)},K.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},K.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},K.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},K.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},K.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},K.Shape.Utils={triangulateShape:function(e,t){function i(e,t,i){return e.x!=t.x?e.x<t.x?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:e.y<t.y?e.y<=i.y&&i.y<=t.y:t.y<=i.y&&i.y<=e.y}function r(e,t,r,n,o){var s=t.x-e.x,a=t.y-e.y,l=n.x-r.x,h=n.y-r.y,c=e.x-r.x,u=e.y-r.y,d=a*l-s*h,p=a*c-s*u;if(Math.abs(d)>1e-10){var f;if(d>0){if(p<0||p>d)return[];if((f=h*c-l*u)<0||f>d)return[]}else{if(p>0||p<d)return[];if((f=h*c-l*u)>0||f<d)return[]}if(0==f)return!o||0!=p&&p!=d?[e]:[];if(f==d)return!o||0!=p&&p!=d?[t]:[];if(0==p)return[r];if(p==d)return[n];var m=f/d;return[{x:e.x+m*s,y:e.y+m*a}]}if(0!=p||h*c!=l*u)return[];var g,v,y,b,x,_,E,A,S=0==s&&0==a,w=0==l&&0==h;return S&&w?e.x!=r.x||e.y!=r.y?[]:[e]:S?i(r,n,e)?[e]:[]:w?i(e,t,r)?[r]:[]:(0!=s?(e.x<t.x?(g=e,y=e.x,v=t,b=t.x):(g=t,y=t.x,v=e,b=e.x),r.x<n.x?(x=r,E=r.x,_=n,A=n.x):(x=n,E=n.x,_=r,A=r.x)):(e.y<t.y?(g=e,y=e.y,v=t,b=t.y):(g=t,y=t.y,v=e,b=e.y),r.y<n.y?(x=r,E=r.y,_=n,A=n.y):(x=n,E=n.y,_=r,A=r.y)),y<=E?b<E?[]:b==E?o?[]:[x]:b<=A?[x,v]:[x,_]:y>A?[]:y==A?o?[]:[g]:b<=A?[g,v]:[g,_])}function n(e,t,i,r){var n=t.x-e.x,o=t.y-e.y,s=i.x-e.x,a=i.y-e.y,l=r.x-e.x,h=r.y-e.y,c=n*a-o*s,u=n*h-o*l;if(Math.abs(c)>1e-10){var d=l*a-h*s;return c>0?u>=0&&d>=0:u>=0||d>=0}return u>0}for(var o,s,a,l,h,c,u={},d=e.concat(),p=0,f=t.length;p<f;p++)Array.prototype.push.apply(d,t[p]);for(o=0,s=d.length;o<s;o++)void 0!==u[h=d[o].x+":"+d[o].y]&&K.warn("THREE.Shape: Duplicate point",h),u[h]=o;var m=function(e,t){var i,o=e.concat();function s(e,t){var r=o.length-1,s=e-1;s<0&&(s=r);var a=e+1;a>r&&(a=0);var l=n(o[e],o[s],o[a],i[t]);if(!l)return!1;var h=i.length-1,c=t-1;c<0&&(c=h);var u=t+1;return u>h&&(u=0),!!(l=n(i[t],i[c],i[u],o[e]))}function a(e,t){var i,n;for(i=0;i<o.length;i++)if(n=i+1,n%=o.length,r(e,t,o[i],o[n],!0).length>0)return!0;return!1}var l=[];function h(e,i){var n,o,s,a;for(n=0;n<l.length;n++)for(o=t[l[n]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,r(e,i,o[s],o[a],!0).length>0)return!0;return!1}for(var c,u,d,p,f,m,g,v,y,b,x=[],_=0,E=t.length;_<E;_++)l.push(_);for(var A=0,S=2*l.length;l.length>0;){if(--S<0){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(u=A;u<o.length;u++){d=o[u],c=-1;for(_=0;_<l.length;_++)if(f=l[_],void 0===x[m=d.x+":"+d.y+":"+f]){i=t[f];for(var w=0;w<i.length;w++)if(p=i[w],s(u,w)&&!a(d,p)&&!h(d,p)){c=w,l.splice(_,1),g=o.slice(0,u+1),v=o.slice(u),y=i.slice(c),b=i.slice(0,c+1),o=g.concat(y).concat(b).concat(v),A=u;break}if(c>=0)break;x[m]=!0}if(c>=0)break}}return o}(e,t),g=K.FontUtils.Triangulate(m,!1);for(o=0,s=g.length;o<s;o++)for(l=g[o],a=0;a<3;a++)void 0!==(c=u[h=l[a].x+":"+l[a].y])&&(l[a]=c);return g.concat()},isClockWise:function(e){return K.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,n){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,n)}},K.LineCurve=function(e,t){this.v1=e,this.v2=t},K.LineCurve.prototype=Object.create(K.Curve.prototype),K.LineCurve.prototype.constructor=K.LineCurve,K.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},K.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},K.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},K.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},K.QuadraticBezierCurve.prototype=Object.create(K.Curve.prototype),K.QuadraticBezierCurve.prototype.constructor=K.QuadraticBezierCurve,K.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new K.Vector2;return t.x=K.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=K.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},K.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new K.Vector2;return t.x=K.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=K.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},K.CubicBezierCurve=function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},K.CubicBezierCurve.prototype=Object.create(K.Curve.prototype),K.CubicBezierCurve.prototype.constructor=K.CubicBezierCurve,K.CubicBezierCurve.prototype.getPoint=function(e){var t,i;return t=K.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=K.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new K.Vector2(t,i)},K.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=K.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=K.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new K.Vector2(t,i);return r.normalize(),r},K.SplineCurve=function(e){this.points=null==e?[]:e},K.SplineCurve.prototype=Object.create(K.Curve.prototype),K.SplineCurve.prototype.constructor=K.SplineCurve,K.SplineCurve.prototype.getPoint=function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),n=i-r,o=t[0==r?r:r-1],s=t[r],a=t[r>t.length-2?t.length-1:r+1],l=t[r>t.length-3?t.length-1:r+2],h=new K.Vector2;return h.x=K.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,n),h.y=K.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,n),h},K.EllipseCurve=function(e,t,i,r,n,o,s){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=s},K.EllipseCurve.prototype=Object.create(K.Curve.prototype),K.EllipseCurve.prototype.constructor=K.EllipseCurve,K.EllipseCurve.prototype.getPoint=function(e){var t,i=this.aEndAngle-this.aStartAngle;i<0&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-i):this.aStartAngle+e*i;var r=new K.Vector2;return r.x=this.aX+this.xRadius*Math.cos(t),r.y=this.aY+this.yRadius*Math.sin(t),r},K.ArcCurve=function(e,t,i,r,n,o){K.EllipseCurve.call(this,e,t,i,i,r,n,o)},K.ArcCurve.prototype=Object.create(K.EllipseCurve.prototype),K.ArcCurve.prototype.constructor=K.ArcCurve,K.LineCurve3=K.Curve.create((function(e,t){this.v1=e,this.v2=t}),(function(e){var t=new K.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t})),K.QuadraticBezierCurve3=K.Curve.create((function(e,t,i){this.v0=e,this.v1=t,this.v2=i}),(function(e){var t=new K.Vector3;return t.x=K.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=K.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=K.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t})),K.CubicBezierCurve3=K.Curve.create((function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r}),(function(e){var t=new K.Vector3;return t.x=K.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=K.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=K.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t})),K.SplineCurve3=K.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),n=i-r,o=t[0==r?r:r-1],s=t[r],a=t[r>t.length-2?t.length-1:r+1],l=t[r>t.length-3?t.length-1:r+2],h=new K.Vector3;return h.x=K.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,n),h.y=K.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,n),h.z=K.Curve.Utils.interpolate(o.z,s.z,a.z,l.z,n),h})),K.ClosedSplineCurve3=K.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t=this.points,i=(t.length-0)*e,r=Math.floor(i),n=i-r,o=t[((r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length)-1)%t.length],s=t[r%t.length],a=t[(r+1)%t.length],l=t[(r+2)%t.length],h=new K.Vector3;return h.x=K.Curve.Utils.interpolate(o.x,s.x,a.x,l.x,n),h.y=K.Curve.Utils.interpolate(o.y,s.y,a.y,l.y,n),h.z=K.Curve.Utils.interpolate(o.z,s.z,a.z,l.z,n),h})),K.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){K.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){K.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){K.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof K.Quaternion)){var r=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=(new K.Quaternion).fromArray(r)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var n={};for(i=0;i<e.hierarchy[t].keys.length;i++)for(var o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++){n[a=e.hierarchy[t].keys[i].morphTargets[o]]=-1}e.hierarchy[t].usedMorphTargets=n;for(i=0;i<e.hierarchy[t].keys.length;i++){var s={};for(var a in n){for(o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++)if(e.hierarchy[t].keys[i].morphTargets[o]===a){s[a]=e.hierarchy[t].keys[i].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[i].morphTargets.length&&(s[a]=0)}e.hierarchy[t].keys[i].morphTargetsInfluences=s}}for(i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}return e.initialized=!0,e},parse:function(e){var t=function(e,i){i.push(e);for(var r=0;r<e.children.length;r++)t(e.children[r],i)},i=[];if(e instanceof K.SkinnedMesh)for(var r=0;r<e.skeleton.bones.length;r++)i.push(e.skeleton.bones[r]);else t(e,i);return i},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(t=0;t<this.animations.length;t++)this.animations[t].update(e)}},K.Animation=function(e,t){this.root=e,this.data=K.AnimationHandler.init(t),this.hierarchy=K.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=K.AnimationHandler.LINEAR},K.Animation.prototype={constructor:K.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),K.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,K.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];void 0===i.animationCache&&(i.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var r=this.data.name,n=i.animationCache.animations,o=n[r];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:i.matrix},n[r]=o);for(var s=0;s<3;s++){for(var a=this.keyTypes[s],l=this.data.hierarchy[e].keys[0],h=this.getNextKeyWith(a,e,1);h.time<this.currentTime&&h.index>l.index;)l=h,h=this.getNextKeyWith(a,e,h.index+1);o.prevKey[a]=l,o.nextKey[a]=h}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e].animationCache;if(void 0!==i){var r=i.blending;r.positionWeight=0,r.quaternionWeight=0,r.scaleWeight=0}}},update:function(){var e=[],t=new K.Vector3,i=new K.Vector3,r=new K.Quaternion,n=function(e,t){var i,r,n,s,a,l,h,c,u,d=[],p=[];return n=(i=(e.length-1)*t)-(r=Math.floor(i)),d[0]=0===r?r:r-1,d[1]=r,d[2]=r>e.length-2?r:r+1,d[3]=r>e.length-3?r:r+2,l=e[d[0]],h=e[d[1]],c=e[d[2]],u=e[d[3]],a=n*(s=n*n),p[0]=o(l[0],h[0],c[0],u[0],n,s,a),p[1]=o(l[1],h[1],c[1],u[1],n,s,a),p[2]=o(l[2],h[2],c[2],u[2],n,s,a),p},o=function(e,t,i,r,n,o,s){var a=.5*(i-e),l=.5*(r-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*n+t};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var s=this.data.length;(this.currentTime>s||this.currentTime<0)&&(this.loop?(this.currentTime%=s,this.currentTime<0&&(this.currentTime+=s),this.reset()):this.stop());for(var a=0,l=this.hierarchy.length;a<l;a++)for(var h=this.hierarchy[a],c=h.animationCache.animations[this.data.name],u=h.animationCache.blending,d=0;d<3;d++){var p=this.keyTypes[d],f=c.prevKey[p],m=c.nextKey[p];if(this.timeScale>0&&m.time<=this.currentTime||this.timeScale<0&&f.time>=this.currentTime){for(f=this.data.hierarchy[a].keys[0],m=this.getNextKeyWith(p,a,1);m.time<this.currentTime&&m.index>f.index;)f=m,m=this.getNextKeyWith(p,a,m.index+1);c.prevKey[p]=f,c.nextKey[p]=m}var g=(this.currentTime-f.time)/(m.time-f.time),v=f[p],y=m[p];if(g<0&&(g=0),g>1&&(g=1),"pos"===p){if(this.interpolationType===K.AnimationHandler.LINEAR){i.x=v[0]+(y[0]-v[0])*g,i.y=v[1]+(y[1]-v[1])*g,i.z=v[2]+(y[2]-v[2])*g;var b=this.weight/(this.weight+u.positionWeight);h.position.lerp(i,b),u.positionWeight+=this.weight}else if(this.interpolationType===K.AnimationHandler.CATMULLROM||this.interpolationType===K.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",a,f.index-1).pos,e[1]=v,e[2]=y,e[3]=this.getNextKeyWith("pos",a,m.index+1).pos;var x=n(e,g=.33*g+.33);b=this.weight/(this.weight+u.positionWeight);u.positionWeight+=this.weight;var _=h.position;if(_.x=_.x+(x[0]-_.x)*b,_.y=_.y+(x[1]-_.y)*b,_.z=_.z+(x[2]-_.z)*b,this.interpolationType===K.AnimationHandler.CATMULLROM_FORWARD){var E=n(e,1.01*g);t.set(E[0],E[1],E[2]),t.sub(_),t.y=0,t.normalize();var A=Math.atan2(t.x,t.z);h.rotation.set(0,A,0)}}}else if("rot"===p)if(K.Quaternion.slerp(v,y,r,g),0===u.quaternionWeight)h.quaternion.copy(r),u.quaternionWeight=this.weight;else{b=this.weight/(this.weight+u.quaternionWeight);K.Quaternion.slerp(h.quaternion,r,h.quaternion,b),u.quaternionWeight+=this.weight}else if("scl"===p){i.x=v[0]+(y[0]-v[0])*g,i.y=v[1]+(y[1]-v[1])*g,i.z=v[2]+(y[2]-v[2])*g;b=this.weight/(this.weight+u.scaleWeight);h.scale.lerp(i,b),u.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;for(this.interpolationType===K.AnimationHandler.CATMULLROM||this.interpolationType===K.AnimationHandler.CATMULLROM_FORWARD?i=i<r.length-1?i:r.length-1:i%=r.length;i<r.length;i++)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=this.interpolationType===K.AnimationHandler.CATMULLROM||this.interpolationType===K.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+r.length;i>=0;i--)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[r.length-1]}},K.KeyFrameAnimation=function(e){this.root=e.node,this.data=K.AnimationHandler.init(e),this.hierarchy=K.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,i=this.hierarchy.length;t<i;t++){var r=this.data.hierarchy[t].keys,n=this.data.hierarchy[t].sids,o=this.hierarchy[t];if(r.length&&n){for(var s=0;s<n.length;s++){var a=n[s],l=this.getNextKeyWith(a,t,0);l&&l.apply(a)}o.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},K.KeyFrameAnimation.prototype={constructor:K.KeyFrameAnimation,play:function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,i,r,n=this.hierarchy.length;for(t=0;t<n;t++){i=this.hierarchy[t],void 0===(r=this.data.hierarchy[t]).animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=i.matrix);var o=this.data.hierarchy[t].keys;o.length&&(r.animationCache.prevKey=o[0],r.animationCache.nextKey=o[1],this.startTime=Math.min(o[0].time,this.startTime),this.endTime=Math.max(o[o.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,K.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,K.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var r=i.animationCache.originalMatrix;r.copy(t.matrix),t.matrix=r,delete i.animationCache}}},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var i=0,r=this.hierarchy.length;i<r;i++){var n=this.hierarchy[i],o=this.data.hierarchy[i],s=o.keys,a=o.animationCache;if(s.length){var l=a.prevKey,h=a.nextKey;if(h.time<=this.currentTime){for(;h.time<this.currentTime&&h.index>l.index;)h=s[(l=h).index+1];a.prevKey=l,a.nextKey=h}h.time>=this.currentTime?l.interpolate(h,this.currentTime):l.interpolate(h,h.time),this.data.hierarchy[i].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;for(i%=r.length;i<r.length;i++)if(r[i].hasTarget(e))return r[i];return r[0]},getPrevKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=i>=0?i:i+r.length;i>=0;i--)if(r[i].hasTarget(e))return r[i];return r[r.length-1]}},K.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.lastFrame=0,this.currentFrame=0,this.isPlaying=!1},K.MorphAnimation.prototype={constructor:K.MorphAnimation,play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,i=Math.floor(this.currentTime/t),r=this.mesh.morphTargetInfluences;i!=this.currentFrame&&(r[this.lastFrame]=0,r[this.currentFrame]=1,r[i]=0,this.lastFrame=this.currentFrame,this.currentFrame=i),r[i]=this.currentTime%t/t,r[this.lastFrame]=1-r[i]}}},K.BoxGeometry=function(e,t,i,r,n,o){K.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o},this.widthSegments=r||1,this.heightSegments=n||1,this.depthSegments=o||1;var s=this,a=e/2,l=t/2,h=i/2;function c(e,t,i,r,n,o,a,l){var h,c,u,d=s.widthSegments,p=s.heightSegments,f=n/2,m=o/2,g=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",p=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",d=s.depthSegments);var v=d+1,y=p+1,b=n/d,x=o/p,_=new K.Vector3;for(_[h]=a>0?1:-1,u=0;u<y;u++)for(c=0;c<v;c++){var E=new K.Vector3;E[e]=(c*b-f)*i,E[t]=(u*x-m)*r,E[h]=a,s.vertices.push(E)}for(u=0;u<p;u++)for(c=0;c<d;c++){var A=c+v*u,S=c+v*(u+1),w=c+1+v*(u+1),M=c+1+v*u,T=new K.Vector2(c/d,1-u/p),C=new K.Vector2(c/d,1-(u+1)/p),P=new K.Vector2((c+1)/d,1-(u+1)/p),D=new K.Vector2((c+1)/d,1-u/p),L=new K.Face3(A+g,S+g,M+g);L.normal.copy(_),L.vertexNormals.push(_.clone(),_.clone(),_.clone()),L.materialIndex=l,s.faces.push(L),s.faceVertexUvs[0].push([T,C,D]),(L=new K.Face3(S+g,w+g,M+g)).normal.copy(_),L.vertexNormals.push(_.clone(),_.clone(),_.clone()),L.materialIndex=l,s.faces.push(L),s.faceVertexUvs[0].push([C.clone(),P,D.clone()])}}c("z","y",-1,-1,i,t,a,0),c("z","y",1,-1,i,t,-a,1),c("x","z",1,1,e,i,l,2),c("x","z",1,-1,e,i,-l,3),c("x","y",1,-1,e,t,h,4),c("x","y",-1,-1,e,t,-h,5),this.mergeVertices()},K.BoxGeometry.prototype=Object.create(K.Geometry.prototype),K.BoxGeometry.prototype.constructor=K.BoxGeometry,K.CircleGeometry=function(e,t,i,r){K.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||50,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var n,o=[],s=new K.Vector3,a=new K.Vector2(.5,.5);for(this.vertices.push(s),o.push(a),n=0;n<=t;n++){var l=new K.Vector3,h=i+n/t*r;l.x=e*Math.cos(h),l.y=e*Math.sin(h),this.vertices.push(l),o.push(new K.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var c=new K.Vector3(0,0,1);for(n=1;n<=t;n++)this.faces.push(new K.Face3(n,n+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([o[n].clone(),o[n+1].clone(),a.clone()]);this.computeFaceNormals(),this.boundingSphere=new K.Sphere(new K.Vector3,e)},K.CircleGeometry.prototype=Object.create(K.Geometry.prototype),K.CircleGeometry.prototype.constructor=K.CircleGeometry,K.CubeGeometry=function(e,t,i,r,n,o){return K.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new K.BoxGeometry(e,t,i,r,n,o)},K.CylinderGeometry=function(e,t,i,r,n,o,s,a){K.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:s,thetaLength:a},e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100,r=r||8,n=n||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var l,h,c=i/2,u=[],d=[];for(h=0;h<=n;h++){var p=[],f=[],m=h/n,g=m*(t-e)+e;for(l=0;l<=r;l++){var v=l/r,y=new K.Vector3;y.x=g*Math.sin(v*a+s),y.y=-m*i+c,y.z=g*Math.cos(v*a+s),this.vertices.push(y),p.push(this.vertices.length-1),f.push(new K.Vector2(v,1-m))}u.push(p),d.push(f)}var b,x,_=(t-e)/i;for(l=0;l<r;l++)for(0!==e?(b=this.vertices[u[0][l]].clone(),x=this.vertices[u[0][l+1]].clone()):(b=this.vertices[u[1][l]].clone(),x=this.vertices[u[1][l+1]].clone()),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*_).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*_).normalize(),h=0;h<n;h++){var E=u[h][l],A=u[h+1][l],S=u[h+1][l+1],w=u[h][l+1],M=b.clone(),T=b.clone(),C=x.clone(),P=x.clone(),D=d[h][l].clone(),L=d[h+1][l].clone(),I=d[h+1][l+1].clone(),R=d[h][l+1].clone();this.faces.push(new K.Face3(E,A,w,[M,T,P])),this.faceVertexUvs[0].push([D,L,R]),this.faces.push(new K.Face3(A,S,w,[T.clone(),C,P.clone()])),this.faceVertexUvs[0].push([L.clone(),I,R.clone()])}if(!1===o&&e>0)for(this.vertices.push(new K.Vector3(0,c,0)),l=0;l<r;l++){E=u[0][l],A=u[0][l+1],S=this.vertices.length-1,M=new K.Vector3(0,1,0),T=new K.Vector3(0,1,0),C=new K.Vector3(0,1,0),D=d[0][l].clone(),L=d[0][l+1].clone(),I=new K.Vector2(L.x,0);this.faces.push(new K.Face3(E,A,S,[M,T,C])),this.faceVertexUvs[0].push([D,L,I])}if(!1===o&&t>0)for(this.vertices.push(new K.Vector3(0,-c,0)),l=0;l<r;l++){E=u[n][l+1],A=u[n][l],S=this.vertices.length-1,M=new K.Vector3(0,-1,0),T=new K.Vector3(0,-1,0),C=new K.Vector3(0,-1,0),D=d[n][l+1].clone(),L=d[n][l].clone(),I=new K.Vector2(L.x,1);this.faces.push(new K.Face3(E,A,S,[M,T,C])),this.faceVertexUvs[0].push([D,L,I])}this.computeFaceNormals()},K.CylinderGeometry.prototype=Object.create(K.Geometry.prototype),K.CylinderGeometry.prototype.constructor=K.CylinderGeometry,K.ExtrudeGeometry=function(e,t){void 0!==e?(K.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,t),this.computeFaceNormals()):e=[]},K.ExtrudeGeometry.prototype=Object.create(K.Geometry.prototype),K.ExtrudeGeometry.prototype.constructor=K.ExtrudeGeometry,K.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;r<i;r++){var n=e[r];this.addShape(n,t)}},K.ExtrudeGeometry.prototype.addShape=function(e,t){var i,r,n,o,s,a,l,h,c=void 0!==t.amount?t.amount:100,u=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:u-2,p=void 0!==t.bevelSegments?t.bevelSegments:3,f=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=t.extrudePath,y=!1,b=t.material,x=t.extrudeMaterial,_=void 0!==t.UVGenerator?t.UVGenerator:K.ExtrudeGeometry.WorldUVGenerator;v&&(i=v.getSpacedPoints(g),y=!0,f=!1,r=void 0!==t.frames?t.frames:new K.TubeGeometry.FrenetFrames(v,g,!1),n=new K.Vector3,o=new K.Vector3,s=new K.Vector3),f||(p=0,u=0,d=0);var E=this,A=this.vertices.length,S=e.extractPoints(m),w=S.shape,M=S.holes,T=!K.Shape.Utils.isClockWise(w);if(T){for(w=w.reverse(),l=0,h=M.length;l<h;l++)a=M[l],K.Shape.Utils.isClockWise(a)&&(M[l]=a.reverse());T=!1}var C=K.Shape.Utils.triangulateShape(w,M),P=w;for(l=0,h=M.length;l<h;l++)a=M[l],w=w.concat(a);function D(e,t,i){return t||K.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var L,I,R,O,N,F,k=w.length,V=C.length;function U(e,t,i){var r,n,o=1e-10,s=1,a=e.x-t.x,l=e.y-t.y,h=i.x-e.x,c=i.y-e.y,u=a*a+l*l,d=a*c-l*h;if(Math.abs(d)>o){var p=Math.sqrt(u),f=Math.sqrt(h*h+c*c),m=t.x-l/p,g=t.y+a/p,v=((i.x-c/f-m)*c-(i.y+h/f-g)*h)/(a*c-l*h),y=(r=m+a*v-e.x)*r+(n=g+l*v-e.y)*n;if(y<=2)return new K.Vector2(r,n);s=Math.sqrt(y/2)}else{var b=!1;a>o?h>o&&(b=!0):a<-1e-10?h<-1e-10&&(b=!0):Math.sign(l)==Math.sign(c)&&(b=!0),b?(r=-l,n=a,s=Math.sqrt(u)):(r=a,n=l,s=Math.sqrt(u/2))}return new K.Vector2(r/s,n/s)}for(var B=[],G=0,z=P.length,H=z-1,W=G+1;G<z;G++,H++,W++)H===z&&(H=0),W===z&&(W=0),B[G]=U(P[G],P[H],P[W]);var j,q,X=[],Y=B.concat();for(l=0,h=M.length;l<h;l++){for(a=M[l],j=[],G=0,H=(z=a.length)-1,W=G+1;G<z;G++,H++,W++)H===z&&(H=0),W===z&&(W=0),j[G]=U(a[G],a[H],a[W]);X.push(j),Y=Y.concat(j)}for(L=0;L<p;L++){for(O=u*(1-(R=L/p)),I=d*Math.sin(R*Math.PI/2),G=0,z=P.length;G<z;G++)Z((N=D(P[G],B[G],I)).x,N.y,-O);for(l=0,h=M.length;l<h;l++)for(a=M[l],j=X[l],G=0,z=a.length;G<z;G++)Z((N=D(a[G],j[G],I)).x,N.y,-O)}for(I=d,G=0;G<k;G++)N=f?D(w[G],Y[G],I):w[G],y?(o.copy(r.normals[0]).multiplyScalar(N.x),n.copy(r.binormals[0]).multiplyScalar(N.y),s.copy(i[0]).add(o).add(n),Z(s.x,s.y,s.z)):Z(N.x,N.y,0);for(q=1;q<=g;q++)for(G=0;G<k;G++)N=f?D(w[G],Y[G],I):w[G],y?(o.copy(r.normals[q]).multiplyScalar(N.x),n.copy(r.binormals[q]).multiplyScalar(N.y),s.copy(i[q]).add(o).add(n),Z(s.x,s.y,s.z)):Z(N.x,N.y,c/g*q);for(L=p-1;L>=0;L--){for(O=u*(1-(R=L/p)),I=d*Math.sin(R*Math.PI/2),G=0,z=P.length;G<z;G++)Z((N=D(P[G],B[G],I)).x,N.y,c+O);for(l=0,h=M.length;l<h;l++)for(a=M[l],j=X[l],G=0,z=a.length;G<z;G++)N=D(a[G],j[G],I),y?Z(N.x,N.y+i[g-1].y,i[g-1].x+O):Z(N.x,N.y,c+O)}function Q(e,t){var i,r;for(G=e.length;--G>=0;){i=G,(r=G-1)<0&&(r=e.length-1);var n=0,o=g+2*p;for(n=0;n<o;n++){var s=k*n,a=k*(n+1);$(t+i+s,t+r+s,t+r+a,t+i+a,e,n,o,i,r)}}}function Z(e,t,i){E.vertices.push(new K.Vector3(e,t,i))}function J(e,t,i){e+=A,t+=A,i+=A,E.faces.push(new K.Face3(e,t,i,null,null,b));var r=_.generateTopUV(E,e,t,i);E.faceVertexUvs[0].push(r)}function $(e,t,i,r,n,o,s,a,l){e+=A,t+=A,i+=A,r+=A,E.faces.push(new K.Face3(e,t,r,null,null,x)),E.faces.push(new K.Face3(t,i,r,null,null,x));var h=_.generateSideWallUV(E,e,t,i,r);E.faceVertexUvs[0].push([h[0],h[1],h[3]]),E.faceVertexUvs[0].push([h[1],h[2],h[3]])}!function(){if(f){var e=0,t=k*e;for(G=0;G<V;G++)J((F=C[G])[2]+t,F[1]+t,F[0]+t);for(t=k*(e=g+2*p),G=0;G<V;G++)J((F=C[G])[0]+t,F[1]+t,F[2]+t)}else{for(G=0;G<V;G++)J((F=C[G])[2],F[1],F[0]);for(G=0;G<V;G++)J((F=C[G])[0]+k*g,F[1]+k*g,F[2]+k*g)}}(),function(){var e=0;for(Q(P,e),e+=P.length,l=0,h=M.length;l<h;l++)Q(a=M[l],e),e+=a.length}()},K.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r){var n=e.vertices,o=n[t],s=n[i],a=n[r];return[new K.Vector2(o.x,o.y),new K.Vector2(s.x,s.y),new K.Vector2(a.x,a.y)]},generateSideWallUV:function(e,t,i,r,n){var o=e.vertices,s=o[t],a=o[i],l=o[r],h=o[n];return Math.abs(s.y-a.y)<.01?[new K.Vector2(s.x,1-s.z),new K.Vector2(a.x,1-a.z),new K.Vector2(l.x,1-l.z),new K.Vector2(h.x,1-h.z)]:[new K.Vector2(s.y,1-s.z),new K.Vector2(a.y,1-a.z),new K.Vector2(l.y,1-l.z),new K.Vector2(h.y,1-h.z)]}},K.ShapeGeometry=function(e,t){K.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},K.ShapeGeometry.prototype=Object.create(K.Geometry.prototype),K.ShapeGeometry.prototype.constructor=K.ShapeGeometry,K.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;i<r;i++)this.addShape(e[i],t);return this},K.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,r,n,o=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,a=void 0===t.UVGenerator?K.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length,h=e.extractPoints(o),c=h.shape,u=h.holes,d=!K.Shape.Utils.isClockWise(c);if(d){for(c=c.reverse(),i=0,r=u.length;i<r;i++)n=u[i],K.Shape.Utils.isClockWise(n)&&(u[i]=n.reverse());d=!1}var p=K.Shape.Utils.triangulateShape(c,u);for(i=0,r=u.length;i<r;i++)n=u[i],c=c.concat(n);var f,m,g=c.length,v=p.length;for(i=0;i<g;i++)f=c[i],this.vertices.push(new K.Vector3(f.x,f.y,0));for(i=0;i<v;i++){var y=(m=p[i])[0]+l,b=m[1]+l,x=m[2]+l;this.faces.push(new K.Face3(y,b,x,null,null,s)),this.faceVertexUvs[0].push(a.generateTopUV(this,y,b,x))}},K.LatheGeometry=function(e,t,i,r){K.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=t||12,i=i||0,r=r||2*Math.PI;for(var n=1/(e.length-1),o=1/t,s=0,a=t;s<=a;s++)for(var l=i+s*o*r,h=Math.cos(l),c=Math.sin(l),u=0,d=e.length;u<d;u++){var p=e[u],f=new K.Vector3;f.x=h*p.x-c*p.y,f.y=c*p.x+h*p.y,f.z=p.z,this.vertices.push(f)}var m=e.length;for(s=0,a=t;s<a;s++)for(u=0,d=e.length-1;u<d;u++){var g=u+m*s,v=g,y=g+m,b=(h=g+1+m,g+1),x=s*o,_=u*n,E=x+o,A=_+n;this.faces.push(new K.Face3(v,y,b)),this.faceVertexUvs[0].push([new K.Vector2(x,_),new K.Vector2(E,_),new K.Vector2(x,A)]),this.faces.push(new K.Face3(y,h,b)),this.faceVertexUvs[0].push([new K.Vector2(E,_),new K.Vector2(E,A),new K.Vector2(x,A)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},K.LatheGeometry.prototype=Object.create(K.Geometry.prototype),K.LatheGeometry.prototype.constructor=K.LatheGeometry,K.PlaneGeometry=function(e,t,i,r){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),K.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new K.PlaneBufferGeometry(e,t,i,r))},K.PlaneGeometry.prototype=Object.create(K.Geometry.prototype),K.PlaneGeometry.prototype.constructor=K.PlaneGeometry,K.PlaneBufferGeometry=function(e,t,i,r){K.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};for(var n=e/2,o=t/2,s=i||1,a=r||1,l=s+1,h=a+1,c=e/s,u=t/a,d=new Float32Array(l*h*3),p=new Float32Array(l*h*3),f=new Float32Array(l*h*2),m=0,g=0,v=0;v<h;v++)for(var y=v*u-o,b=0;b<l;b++){var x=b*c-n;d[m]=x,d[m+1]=-y,p[m+2]=1,f[g]=b/s,f[g+1]=1-v/a,m+=3,g+=2}m=0;var _=new(d.length/3>65535?Uint32Array:Uint16Array)(s*a*6);for(v=0;v<a;v++)for(b=0;b<s;b++){var E=b+l*v,A=b+l*(v+1),S=b+1+l*(v+1),w=b+1+l*v;_[m]=E,_[m+1]=A,_[m+2]=w,_[m+3]=A,_[m+4]=S,_[m+5]=w,m+=6}this.setAttribute("index",new K.BufferAttribute(_,1)),this.setAttribute("position",new K.BufferAttribute(d,3)),this.setAttribute("normal",new K.BufferAttribute(p,3)),this.setAttribute("uv",new K.BufferAttribute(f,2))},K.PlaneBufferGeometry.prototype=Object.create(K.BufferGeometry.prototype),K.PlaneBufferGeometry.prototype.constructor=K.PlaneBufferGeometry,K.RingGeometry=function(e,t,i,r,n,o){K.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},e=e||0,t=t||50,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var s,a,l=[],h=e,c=(t-e)/(r=void 0!==r?Math.max(1,r):8);for(s=0;s<r+1;s++){for(a=0;a<i+1;a++){var u=new K.Vector3,d=n+a/i*o;u.x=h*Math.cos(d),u.y=h*Math.sin(d),this.vertices.push(u),l.push(new K.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}h+=c}var p=new K.Vector3(0,0,1);for(s=0;s<r;s++){var f=s*(i+1);for(a=0;a<i;a++){var m=d=a+f,g=d+i+1,v=d+i+2;this.faces.push(new K.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),m=d,g=d+i+2,v=d+1,this.faces.push(new K.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new K.Sphere(new K.Vector3,h)},K.RingGeometry.prototype=Object.create(K.Geometry.prototype),K.RingGeometry.prototype.constructor=K.RingGeometry,K.SphereGeometry=function(e,t,i,r,n,o,s){K.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:s},e=e||50,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;var a,l,h=[],c=[];for(l=0;l<=i;l++){var u=[],d=[];for(a=0;a<=t;a++){var p=a/t,f=l/i,m=new K.Vector3;m.x=-e*Math.cos(r+p*n)*Math.sin(o+f*s),m.y=e*Math.cos(o+f*s),m.z=e*Math.sin(r+p*n)*Math.sin(o+f*s),this.vertices.push(m),u.push(this.vertices.length-1),d.push(new K.Vector2(p,1-f))}h.push(u),c.push(d)}for(l=0;l<i;l++)for(a=0;a<t;a++){var g=h[l][a+1],v=h[l][a],y=h[l+1][a],b=h[l+1][a+1],x=this.vertices[g].clone().normalize(),_=this.vertices[v].clone().normalize(),E=this.vertices[y].clone().normalize(),A=this.vertices[b].clone().normalize(),S=c[l][a+1].clone(),w=c[l][a].clone(),M=c[l+1][a].clone(),T=c[l+1][a+1].clone();Math.abs(this.vertices[g].y)===e?(S.x=(S.x+w.x)/2,this.faces.push(new K.Face3(g,y,b,[x,E,A])),this.faceVertexUvs[0].push([S,M,T])):Math.abs(this.vertices[y].y)===e?(M.x=(M.x+T.x)/2,this.faces.push(new K.Face3(g,v,y,[x,_,E])),this.faceVertexUvs[0].push([S,w,M])):(this.faces.push(new K.Face3(g,v,b,[x,_,A])),this.faceVertexUvs[0].push([S,w,T]),this.faces.push(new K.Face3(v,y,b,[_.clone(),E,A.clone()])),this.faceVertexUvs[0].push([w.clone(),M,T.clone()]))}this.computeFaceNormals(),this.boundingSphere=new K.Sphere(new K.Vector3,e)},K.SphereGeometry.prototype=Object.create(K.Geometry.prototype),K.SphereGeometry.prototype.constructor=K.SphereGeometry,K.TextGeometry=function(e,t){t=t||{};var i=K.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),K.ExtrudeGeometry.call(this,i,t),this.type="TextGeometry"},K.TextGeometry.prototype=Object.create(K.ExtrudeGeometry.prototype),K.TextGeometry.prototype.constructor=K.TextGeometry,K.TorusGeometry=function(e,t,i,r,n){K.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||100,t=t||40,i=i||8,r=r||6,n=n||2*Math.PI;for(var o=new K.Vector3,s=[],a=[],l=0;l<=i;l++)for(var h=0;h<=r;h++){var c=h/r*n,u=l/i*Math.PI*2;o.x=e*Math.cos(c),o.y=e*Math.sin(c);var d=new K.Vector3;d.x=(e+t*Math.cos(u))*Math.cos(c),d.y=(e+t*Math.cos(u))*Math.sin(c),d.z=t*Math.sin(u),this.vertices.push(d),s.push(new K.Vector2(h/r,l/i)),a.push(d.clone().sub(o).normalize())}for(l=1;l<=i;l++)for(h=1;h<=r;h++){var p=(r+1)*l+h-1,f=(r+1)*(l-1)+h-1,m=(r+1)*(l-1)+h,g=(r+1)*l+h,v=new K.Face3(p,f,g,[a[p].clone(),a[f].clone(),a[g].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([s[p].clone(),s[f].clone(),s[g].clone()]),v=new K.Face3(f,m,g,[a[f].clone(),a[m].clone(),a[g].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([s[f].clone(),s[m].clone(),s[g].clone()])}this.computeFaceNormals()},K.TorusGeometry.prototype=Object.create(K.Geometry.prototype),K.TorusGeometry.prototype.constructor=K.TorusGeometry,K.TorusKnotGeometry=function(e,t,i,r,n,o,s){K.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,p:n,q:o,heightScale:s},e=e||100,t=t||40,i=i||64,r=r||8,n=n||2,o=o||3,s=s||1;for(var a=new Array(i),l=new K.Vector3,h=new K.Vector3,c=new K.Vector3,u=0;u<i;++u){a[u]=new Array(r);var d=u/i*2*n*Math.PI,p=D(d,o,n,e,s),f=D(d+.01,o,n,e,s);l.subVectors(f,p),h.addVectors(f,p),c.crossVectors(l,h),h.crossVectors(c,l),c.normalize(),h.normalize();for(var m=0;m<r;++m){var g=m/r*2*Math.PI,v=-t*Math.cos(g),y=t*Math.sin(g),b=new K.Vector3;b.x=p.x+v*h.x+y*c.x,b.y=p.y+v*h.y+y*c.y,b.z=p.z+v*h.z+y*c.z,a[u][m]=this.vertices.push(b)-1}}for(u=0;u<i;++u)for(m=0;m<r;++m){var x=(u+1)%i,_=(m+1)%r,E=a[u][m],A=a[x][m],S=a[x][_],w=a[u][_],M=new K.Vector2(u/i,m/r),T=new K.Vector2((u+1)/i,m/r),C=new K.Vector2((u+1)/i,(m+1)/r),P=new K.Vector2(u/i,(m+1)/r);this.faces.push(new K.Face3(E,A,w)),this.faceVertexUvs[0].push([M,T,P]),this.faces.push(new K.Face3(A,S,w)),this.faceVertexUvs[0].push([T.clone(),C,P.clone()])}function D(e,t,i,r,n){var o=Math.cos(e),s=Math.sin(e),a=t/i*e,l=Math.cos(a),h=r*(2+l)*.5*o,c=r*(2+l)*s*.5,u=n*r*Math.sin(a)*.5;return new K.Vector3(h,c,u)}this.computeFaceNormals(),this.computeVertexNormals()},K.TorusKnotGeometry.prototype=Object.create(K.Geometry.prototype),K.TorusKnotGeometry.prototype.constructor=K.TorusKnotGeometry,K.TubeGeometry=function(e,t,i,r,n,o){K.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:i,radialSegments:r,closed:n},t=t||64,i=i||1,r=r||8,n=n||!1,o=o||K.TubeGeometry.NoTaper;var s,a,l,h,c,u,d,p,f,m,g,v,y,b,x,_,E,A,S,w,M=[],T=this,C=t+1,P=new K.Vector3,D=new K.TubeGeometry.FrenetFrames(e,t,n),L=D.tangents,I=D.normals,R=D.binormals;function O(e,t,i){return T.vertices.push(new K.Vector3(e,t,i))-1}for(this.tangents=L,this.normals=I,this.binormals=R,f=0;f<C;f++)for(M[f]=[],l=f/(C-1),p=e.getPointAt(l),L[f],s=I[f],a=R[f],c=i*o(l),m=0;m<r;m++)h=m/r*2*Math.PI,u=-c*Math.cos(h),d=c*Math.sin(h),P.copy(p),P.x+=u*s.x+d*a.x,P.y+=u*s.y+d*a.y,P.z+=u*s.z+d*a.z,M[f][m]=O(P.x,P.y,P.z);for(f=0;f<t;f++)for(m=0;m<r;m++)g=n?(f+1)%t:f+1,v=(m+1)%r,y=M[f][m],b=M[g][m],x=M[g][v],_=M[f][v],E=new K.Vector2(f/t,m/r),A=new K.Vector2((f+1)/t,m/r),S=new K.Vector2((f+1)/t,(m+1)/r),w=new K.Vector2(f/t,(m+1)/r),this.faces.push(new K.Face3(y,b,_)),this.faceVertexUvs[0].push([E,A,w]),this.faces.push(new K.Face3(b,x,_)),this.faceVertexUvs[0].push([A.clone(),S,w.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},K.TubeGeometry.prototype=Object.create(K.Geometry.prototype),K.TubeGeometry.prototype.constructor=K.TubeGeometry,K.TubeGeometry.NoTaper=function(e){return 1},K.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},K.TubeGeometry.FrenetFrames=function(e,t,i){var r,n,o,s,a,l,h,c=new K.Vector3,u=[],d=[],p=[],f=new K.Vector3,m=new K.Matrix4,g=t+1;for(this.tangents=u,this.normals=d,this.binormals=p,l=0;l<g;l++)h=l/(g-1),u[l]=e.getTangentAt(h),u[l].normalize();for(function(){d[0]=new K.Vector3,p[0]=new K.Vector3,n=Number.MAX_VALUE,o=Math.abs(u[0].x),s=Math.abs(u[0].y),a=Math.abs(u[0].z),o<=n&&(n=o,c.set(1,0,0));s<=n&&(n=s,c.set(0,1,0));a<=n&&c.set(0,0,1);f.crossVectors(u[0],c).normalize(),d[0].crossVectors(u[0],f),p[0].crossVectors(u[0],d[0])}(),l=1;l<g;l++)d[l]=d[l-1].clone(),p[l]=p[l-1].clone(),f.crossVectors(u[l-1],u[l]),f.length()>1e-4&&(f.normalize(),r=Math.acos(K.Math.clamp(u[l-1].dot(u[l]),-1,1)),d[l].applyMatrix4(m.makeRotationAxis(f,r))),p[l].crossVectors(u[l],d[l]);if(i)for(r=Math.acos(K.Math.clamp(d[0].dot(d[g-1]),-1,1)),r/=g-1,u[0].dot(f.crossVectors(d[0],d[g-1]))>0&&(r=-r),l=1;l<g;l++)d[l].applyMatrix4(m.makeRotationAxis(u[l],r*l)),p[l].crossVectors(u[l],d[l])},K.PolyhedronGeometry=function(e,t,i,r){K.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1,r=r||0;for(var n=this,o=0,s=e.length;o<s;o+=3)x(new K.Vector3(e[o],e[o+1],e[o+2]));var a=this.vertices,l=[],h=(o=0,0);for(s=t.length;o<s;o+=3,h++){var c=a[t[o]],u=a[t[o+1]],d=a[t[o+2]];l[h]=new K.Face3(c.index,u.index,d.index,[c.clone(),u.clone(),d.clone()])}var p=new K.Vector3;for(o=0,s=l.length;o<s;o++)E(l[o],r);for(o=0,s=this.faceVertexUvs[0].length;o<s;o++){var f=this.faceVertexUvs[0][o],m=f[0].x,g=f[1].x,v=f[2].x,y=Math.max(m,Math.max(g,v)),b=Math.min(m,Math.min(g,v));y>.9&&b<.1&&(m<.2&&(f[0].x+=1),g<.2&&(f[1].x+=1),v<.2&&(f[2].x+=1))}for(o=0,s=this.vertices.length;o<s;o++)this.vertices[o].multiplyScalar(i);function x(e){var t=e.normalize().clone();t.index=n.vertices.push(t)-1;var i=A(e)/2/Math.PI+.5,r=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new K.Vector2(i,1-r),t}function _(e,t,i){var r=new K.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);n.faces.push(r),p.copy(e).add(t).add(i).divideScalar(3);var o=A(p);n.faceVertexUvs[0].push([S(e.uv,e,o),S(t.uv,t,o),S(i.uv,i,o)])}function E(e,t){for(var i=Math.pow(2,t),r=x(n.vertices[e.a]),o=x(n.vertices[e.b]),s=x(n.vertices[e.c]),a=[],l=0;l<=i;l++){a[l]=[];for(var h=x(r.clone().lerp(s,l/i)),c=x(o.clone().lerp(s,l/i)),u=i-l,d=0;d<=u;d++)a[l][d]=0==d&&l==i?h:x(h.clone().lerp(c,d/u))}for(l=0;l<i;l++)for(d=0;d<2*(i-l)-1;d++){var p=Math.floor(d/2);d%2==0?_(a[l][p+1],a[l+1][p],a[l][p]):_(a[l][p+1],a[l+1][p+1],a[l+1][p])}}function A(e){return Math.atan2(e.z,-e.x)}function S(e,t,i){return i<0&&1===e.x&&(e=new K.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new K.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new K.Sphere(new K.Vector3,i)},K.PolyhedronGeometry.prototype=Object.create(K.Geometry.prototype),K.PolyhedronGeometry.prototype.constructor=K.PolyhedronGeometry,K.DodecahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];K.PolyhedronGeometry.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t)},K.DodecahedronGeometry.prototype=Object.create(K.Geometry.prototype),K.DodecahedronGeometry.prototype.constructor=K.DodecahedronGeometry,K.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];K.PolyhedronGeometry.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},K.IcosahedronGeometry.prototype=Object.create(K.Geometry.prototype),K.IcosahedronGeometry.prototype.constructor=K.IcosahedronGeometry,K.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};K.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},K.OctahedronGeometry.prototype=Object.create(K.Geometry.prototype),K.OctahedronGeometry.prototype.constructor=K.OctahedronGeometry,K.TetrahedronGeometry=function(e,t){K.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},K.TetrahedronGeometry.prototype=Object.create(K.Geometry.prototype),K.TetrahedronGeometry.prototype.constructor=K.TetrahedronGeometry,K.ParametricGeometry=function(e,t,i){K.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,o,s,a,l,h,c,u,d,p,f,m=this.vertices,g=this.faces,v=this.faceVertexUvs[0],y=t+1;for(r=0;r<=i;r++)for(s=r/i,n=0;n<=t;n++)o=e(n/t,s),m.push(o);for(r=0;r<i;r++)for(n=0;n<t;n++)a=r*y+n,l=r*y+n+1,h=(r+1)*y+n+1,c=(r+1)*y+n,u=new K.Vector2(n/t,r/i),d=new K.Vector2((n+1)/t,r/i),p=new K.Vector2((n+1)/t,(r+1)/i),f=new K.Vector2(n/t,(r+1)/i),g.push(new K.Face3(a,l,c)),v.push([u,d,f]),g.push(new K.Face3(l,h,c)),v.push([d.clone(),p,f.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},K.ParametricGeometry.prototype=Object.create(K.Geometry.prototype),K.ParametricGeometry.prototype.constructor=K.ParametricGeometry,K.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),r=new K.BufferGeometry;r.setAttribute("position",new K.BufferAttribute(t,3)),r.setAttribute("color",new K.BufferAttribute(i,3));var n=new K.LineBasicMaterial({vertexColors:K.VertexColors});K.Line.call(this,r,n,K.LinePieces)},K.AxisHelper.prototype=Object.create(K.Line.prototype),K.AxisHelper.prototype.constructor=K.AxisHelper,K.ArrowHelper=function(){var e=new K.Geometry;e.vertices.push(new K.Vector3(0,0,0),new K.Vector3(0,1,0));var t=new K.CylinderGeometry(0,.5,1,5,1);return t.applyMatrix((new K.Matrix4).makeTranslation(0,-.5,0)),function(i,r,n,o,s,a){K.Object3D.call(this),void 0===o&&(o=16776960),void 0===n&&(n=1),void 0===s&&(s=.2*n),void 0===a&&(a=.2*s),this.position.copy(r),this.line=new K.Line(e,new K.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new K.Mesh(t,new K.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(n,s,a)}}(),K.ArrowHelper.prototype=Object.create(K.Object3D.prototype),K.ArrowHelper.prototype.constructor=K.ArrowHelper,K.ArrowHelper.prototype.setDirection=(Y=new K.Vector3,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Y.set(e.z,0,-e.x).normalize(),X=Math.acos(e.y),this.quaternion.setFromAxisAngle(Y,X))}),K.ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,e-t,1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},K.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},K.BoxHelper=function(e){var t=new K.BufferGeometry;t.setAttribute("position",new K.BufferAttribute(new Float32Array(72),3)),K.Line.call(this,t,new K.LineBasicMaterial({color:16776960}),K.LinePieces),void 0!==e&&this.update(e)},K.BoxHelper.prototype=Object.create(K.Line.prototype),K.BoxHelper.prototype.constructor=K.BoxHelper,K.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,r=t.boundingBox.max,n=this.geometry.attributes.position.array;n[0]=r.x,n[1]=r.y,n[2]=r.z,n[3]=i.x,n[4]=r.y,n[5]=r.z,n[6]=i.x,n[7]=r.y,n[8]=r.z,n[9]=i.x,n[10]=i.y,n[11]=r.z,n[12]=i.x,n[13]=i.y,n[14]=r.z,n[15]=r.x,n[16]=i.y,n[17]=r.z,n[18]=r.x,n[19]=i.y,n[20]=r.z,n[21]=r.x,n[22]=r.y,n[23]=r.z,n[24]=r.x,n[25]=r.y,n[26]=i.z,n[27]=i.x,n[28]=r.y,n[29]=i.z,n[30]=i.x,n[31]=r.y,n[32]=i.z,n[33]=i.x,n[34]=i.y,n[35]=i.z,n[36]=i.x,n[37]=i.y,n[38]=i.z,n[39]=r.x,n[40]=i.y,n[41]=i.z,n[42]=r.x,n[43]=i.y,n[44]=i.z,n[45]=r.x,n[46]=r.y,n[47]=i.z,n[48]=r.x,n[49]=r.y,n[50]=r.z,n[51]=r.x,n[52]=r.y,n[53]=i.z,n[54]=i.x,n[55]=r.y,n[56]=r.z,n[57]=i.x,n[58]=r.y,n[59]=i.z,n[60]=i.x,n[61]=i.y,n[62]=r.z,n[63]=i.x,n[64]=i.y,n[65]=i.z,n[66]=r.x,n[67]=i.y,n[68]=r.z,n[69]=r.x,n[70]=i.y,n[71]=i.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},K.BoundingBoxHelper=function(e,t){var i=void 0!==t?t:8947848;this.object=e,this.box=new K.Box3,K.Mesh.call(this,new K.BoxGeometry(1,1,1),new K.MeshBasicMaterial({color:i,wireframe:!0}))},K.BoundingBoxHelper.prototype=Object.create(K.Mesh.prototype),K.BoundingBoxHelper.prototype.constructor=K.BoundingBoxHelper,K.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.getCenter(this.position)},K.CameraHelper=function(e){var t=new K.Geometry,i=new K.LineBasicMaterial({color:16777215,vertexColors:K.FaceColors}),r={},n=16755200,o=16711680,s=43775,a=3355443;function l(e,t,i){h(e,i),h(t,i)}function h(e,i){t.vertices.push(new K.Vector3),t.colors.push(new K.Color(i)),void 0===r[e]&&(r[e]=[]),r[e].push(t.vertices.length-1)}l("n1","n2",n),l("n2","n4",n),l("n4","n3",n),l("n3","n1",n),l("f1","f2",n),l("f2","f4",n),l("f4","f3",n),l("f3","f1",n),l("n1","f1",n),l("n2","f2",n),l("n3","f3",n),l("n4","f4",n),l("p","n1",o),l("p","n2",o),l("p","n3",o),l("p","n4",o),l("u1","u2",s),l("u2","u3",s),l("u3","u1",s),l("c","t",16777215),l("p","c",a),l("cn1","cn2",a),l("cn3","cn4",a),l("cf1","cf2",a),l("cf3","cf4",a),K.Line.call(this,t,i,K.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()},K.CameraHelper.prototype=Object.create(K.Line.prototype),K.CameraHelper.prototype.constructor=K.CameraHelper,K.CameraHelper.prototype.update=function(){var e,t,i=new K.Vector3,r=new K.Camera,n=function(n,o,s,a){i.set(o,s,a).unproject(r);var l=t[n];if(void 0!==l)for(var h=0,c=l.length;h<c;h++)e.vertices[l[h]].copy(i)};return function(){e=this.geometry,t=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),e.verticesNeedUpdate=!0}}(),K.DirectionalLightHelper=function(e,t){K.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var i=new K.Geometry;i.vertices.push(new K.Vector3(-t,t,0),new K.Vector3(t,t,0),new K.Vector3(t,-t,0),new K.Vector3(-t,-t,0),new K.Vector3(-t,t,0));var r=new K.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new K.Line(i,r),this.add(this.lightPlane),(i=new K.Geometry).vertices.push(new K.Vector3,new K.Vector3),(r=new K.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new K.Line(i,r),this.add(this.targetLine),this.update()},K.DirectionalLightHelper.prototype=Object.create(K.Object3D.prototype),K.DirectionalLightHelper.prototype.constructor=K.DirectionalLightHelper,K.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},K.DirectionalLightHelper.prototype.update=function(){var e=new K.Vector3,t=new K.Vector3,i=new K.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(i),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),K.EdgesHelper=function(e,t,i){var r=void 0!==t?t:16777215;i=void 0!==i?i:1;var n,o=Math.cos(K.Math.degToRad(i)),s=[0,0],a={},l=function(e,t){return e-t},h=["a","b","c"],c=new K.BufferGeometry;e.geometry instanceof K.BufferGeometry?(n=new K.Geometry).fromBufferGeometry(e.geometry):n=e.geometry.clone(),n.mergeVertices(),n.computeFaceNormals();for(var u=n.vertices,d=n.faces,p=0,f=0,m=d.length;f<m;f++)for(var g=d[f],v=0;v<3;v++){s[0]=g[h[v]],s[1]=g[h[(v+1)%3]],s.sort(l),void 0===a[x=s.toString()]?(a[x]={vert1:s[0],vert2:s[1],face1:f,face2:void 0},p++):a[x].face2=f}var y=new Float32Array(2*p*3),b=0;for(var x in a){var _=a[x];if(void 0===_.face2||d[_.face1].normal.dot(d[_.face2].normal)<=o){var E=u[_.vert1];y[b++]=E.x,y[b++]=E.y,y[b++]=E.z,E=u[_.vert2],y[b++]=E.x,y[b++]=E.y,y[b++]=E.z}}c.setAttribute("position",new K.BufferAttribute(y,3)),K.Line.call(this,c,new K.LineBasicMaterial({color:r}),K.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},K.EdgesHelper.prototype=Object.create(K.Line.prototype),K.EdgesHelper.prototype.constructor=K.EdgesHelper,K.FaceNormalsHelper=function(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;for(var n=void 0!==i?i:16776960,o=void 0!==r?r:1,s=new K.Geometry,a=0,l=this.object.geometry.faces.length;a<l;a++)s.vertices.push(new K.Vector3,new K.Vector3);K.Line.call(this,s,new K.LineBasicMaterial({color:n,linewidth:o}),K.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new K.Matrix3,this.update()},K.FaceNormalsHelper.prototype=Object.create(K.Line.prototype),K.FaceNormalsHelper.prototype.constructor=K.FaceNormalsHelper,K.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,i=t.geometry.vertices,r=t.geometry.faces,n=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(n);for(var o=0,s=0,a=r.length;o<a;o++,s+=2){var l=r[o];e[s].copy(i[l.a]).add(i[l.b]).add(i[l.c]).divideScalar(3).applyMatrix4(n),e[s+1].copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[s])}return this.geometry.verticesNeedUpdate=!0,this},K.GridHelper=function(e,t){var i=new K.Geometry,r=new K.LineBasicMaterial({vertexColors:K.VertexColors});this.color1=new K.Color(4473924),this.color2=new K.Color(8947848);for(var n=-e;n<=e;n+=t){i.vertices.push(new K.Vector3(-e,0,n),new K.Vector3(e,0,n),new K.Vector3(n,0,-e),new K.Vector3(n,0,e));var o=0===n?this.color1:this.color2;i.colors.push(o,o,o,o)}K.Line.call(this,i,r,K.LinePieces)},K.GridHelper.prototype=Object.create(K.Line.prototype),K.GridHelper.prototype.constructor=K.GridHelper,K.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},K.HemisphereLightHelper=function(e,t){K.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new K.Color,new K.Color];var i=new K.SphereGeometry(t,4,2);i.applyMatrix((new K.Matrix4).makeRotationX(-Math.PI/2));for(var r=0;r<8;r++)i.faces[r].color=this.colors[r<4?0:1];var n=new K.MeshBasicMaterial({vertexColors:K.FaceColors,wireframe:!0});this.lightSphere=new K.Mesh(i,n),this.add(this.lightSphere),this.update()},K.HemisphereLightHelper.prototype=Object.create(K.Object3D.prototype),K.HemisphereLightHelper.prototype.constructor=K.HemisphereLightHelper,K.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},K.HemisphereLightHelper.prototype.update=function(){var e=new K.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),K.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new K.SphereGeometry(t,4,2),r=new K.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),K.Mesh.call(this,i,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},K.PointLightHelper.prototype=Object.create(K.Mesh.prototype),K.PointLightHelper.prototype.constructor=K.PointLightHelper,K.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},K.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},K.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new K.Geometry,i=0;i<this.bones.length;i++){this.bones[i].parent instanceof K.Bone&&(t.vertices.push(new K.Vector3),t.vertices.push(new K.Vector3),t.colors.push(new K.Color(0,0,1)),t.colors.push(new K.Color(0,1,0)))}var r=new K.LineBasicMaterial({vertexColors:K.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});K.Line.call(this,t,r,K.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},K.SkeletonHelper.prototype=Object.create(K.Line.prototype),K.SkeletonHelper.prototype.constructor=K.SkeletonHelper,K.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof K.Bone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},K.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new K.Matrix4).getInverse(this.root.matrixWorld),i=new K.Matrix4,r=0,n=0;n<this.bones.length;n++){var o=this.bones[n];o.parent instanceof K.Bone&&(i.multiplyMatrices(t,o.matrixWorld),e.vertices[r].setFromMatrixPosition(i),i.multiplyMatrices(t,o.parent.matrixWorld),e.vertices[r+1].setFromMatrixPosition(i),r+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},K.SpotLightHelper=function(e){K.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new K.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new K.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new K.Matrix4).makeRotationX(-Math.PI/2));var i=new K.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new K.Mesh(t,i),this.add(this.cone),this.update()},K.SpotLightHelper.prototype=Object.create(K.Object3D.prototype),K.SpotLightHelper.prototype.constructor=K.SpotLightHelper,K.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},K.SpotLightHelper.prototype.update=function(){var e=new K.Vector3,t=new K.Vector3;return function(){var i=this.light.distance?this.light.distance:1e4,r=i*Math.tan(this.light.angle);this.cone.scale.set(r,r,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),K.VertexNormalsHelper=function(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;for(var n=void 0!==i?i:16711680,o=void 0!==r?r:1,s=new K.Geometry,a=e.geometry.faces,l=0,h=a.length;l<h;l++)for(var c=0,u=a[l].vertexNormals.length;c<u;c++)s.vertices.push(new K.Vector3,new K.Vector3);K.Line.call(this,s,new K.LineBasicMaterial({color:n,linewidth:o}),K.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new K.Matrix3,this.update()},K.VertexNormalsHelper.prototype=Object.create(K.Line.prototype),K.VertexNormalsHelper.prototype.constructor=K.VertexNormalsHelper,K.VertexNormalsHelper.prototype.update=function(e){var t=new K.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,n=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,h=o.length;l<h;l++)for(var c=o[l],u=0,d=c.vertexNormals.length;u<d;u++){var p=n[c[i[u]]],f=c.vertexNormals[u];r[a].copy(p).applyMatrix4(s),t.copy(f).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(r[a]),r[a+=1].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),K.VertexTangentsHelper=function(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;for(var n=void 0!==i?i:255,o=void 0!==r?r:1,s=new K.Geometry,a=e.geometry.faces,l=0,h=a.length;l<h;l++)for(var c=0,u=a[l].vertexTangents.length;c<u;c++)s.vertices.push(new K.Vector3),s.vertices.push(new K.Vector3);K.Line.call(this,s,new K.LineBasicMaterial({color:n,linewidth:o}),K.LinePieces),this.matrixAutoUpdate=!1,this.update()},K.VertexTangentsHelper.prototype=Object.create(K.Line.prototype),K.VertexTangentsHelper.prototype.constructor=K.VertexTangentsHelper,K.VertexTangentsHelper.prototype.update=function(e){var t=new K.Vector3;return function(e){var i=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var r=this.geometry.vertices,n=this.object.geometry.vertices,o=this.object.geometry.faces,s=this.object.matrixWorld,a=0,l=0,h=o.length;l<h;l++)for(var c=o[l],u=0,d=c.vertexTangents.length;u<d;u++){var p=n[c[i[u]]],f=c.vertexTangents[u];r[a].copy(p).applyMatrix4(s),t.copy(f).transformDirection(s).multiplyScalar(this.size),t.add(r[a]),r[a+=1].copy(t),a+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),K.WireframeHelper=function(e,t){var i=void 0!==t?t:16777215,r=[0,0],n={},o=function(e,t){return e-t},s=["a","b","c"],a=new K.BufferGeometry;if(e.geometry instanceof K.Geometry){for(var l=e.geometry.vertices,h=e.geometry.faces,c=0,u=new Uint32Array(6*h.length),d=0,p=h.length;d<p;d++)for(var f=h[d],m=0;m<3;m++){r[0]=f[s[m]],r[1]=f[s[(m+1)%3]],r.sort(o),void 0===n[M=r.toString()]&&(u[2*c]=r[0],u[2*c+1]=r[1],n[M]=!0,c++)}var g=new Float32Array(2*c*3);for(d=0,p=c;d<p;d++)for(m=0;m<2;m++){var v=l[u[2*d+m]];g[(S=6*d+3*m)+0]=v.x,g[S+1]=v.y,g[S+2]=v.z}a.setAttribute("position",new K.BufferAttribute(g,3))}else if(e.geometry instanceof K.BufferGeometry)if(void 0!==e.geometry.attributes.index){l=e.geometry.attributes.position.array;var y=e.geometry.attributes.index.array,b=e.geometry.drawcalls;c=0;0===b.length&&(b=[{count:y.length,index:0,start:0}]);u=new Uint32Array(2*y.length);for(var x=0,_=b.length;x<_;++x)for(var E=b[x].start,A=b[x].count,S=b[x].index,w=(d=E,E+A);d<w;d+=3)for(m=0;m<3;m++){var M;r[0]=S+y[d+m],r[1]=S+y[d+(m+1)%3],r.sort(o),void 0===n[M=r.toString()]&&(u[2*c]=r[0],u[2*c+1]=r[1],n[M]=!0,c++)}for(g=new Float32Array(2*c*3),d=0,p=c;d<p;d++)for(m=0;m<2;m++){S=6*d+3*m;var T=3*u[2*d+m];g[S+0]=l[T],g[S+1]=l[T+1],g[S+2]=l[T+2]}a.setAttribute("position",new K.BufferAttribute(g,3))}else{var C=(c=(l=e.geometry.attributes.position.array).length/3)/3;for(g=new Float32Array(2*c*3),d=0,p=C;d<p;d++)for(m=0;m<3;m++){var P=9*d+3*m;g[(S=18*d+6*m)+0]=l[P],g[S+1]=l[P+1],g[S+2]=l[P+2];T=9*d+(m+1)%3*3;g[S+3]=l[T],g[S+4]=l[T+1],g[S+5]=l[T+2]}a.setAttribute("position",new K.BufferAttribute(g,3))}K.Line.call(this,a,new K.LineBasicMaterial({color:i}),K.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},K.WireframeHelper.prototype=Object.create(K.Line.prototype),K.WireframeHelper.prototype.constructor=K.WireframeHelper,K.ImmediateRenderObject=function(){K.Object3D.call(this),this.render=function(e){}},K.ImmediateRenderObject.prototype=Object.create(K.Object3D.prototype),K.ImmediateRenderObject.prototype.constructor=K.ImmediateRenderObject,K.MorphBlendMesh=function(e,t){K.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,r="__default",n=i-1,o=i/1;this.createAnimation(r,0,n,o),this.setAnimationWeight(r,1)},K.MorphBlendMesh.prototype=Object.create(K.Mesh.prototype),K.MorphBlendMesh.prototype.constructor=K.MorphBlendMesh,K.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var n={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},K.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)_?(\d+)/,r={},n=this.geometry,o=0,s=n.morphTargets.length;o<s;o++){var a=n.morphTargets[o].name.match(i);if(a&&a.length>1)r[l=a[1]]||(r[l]={start:1/0,end:-1/0}),o<(h=r[l]).start&&(h.start=o),o>h.end&&(h.end=o),t||(t=l)}for(var l in r){var h=r[l];this.createAnimation(l,h.start,h.end,e)}this.firstAnimation=t},K.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},K.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},K.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},K.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},K.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},K.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},K.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},K.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},K.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):K.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},K.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},K.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(r.active){var n=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var o=r.startFrame+K.Math.clamp(Math.floor(r.time/n),0,r.length-1),s=r.weight;o!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[o]=0,r.lastFrame=r.currentFrame,r.currentFrame=o);var a=r.time%n/n;r.directionBackwards&&(a=1-a),this.morphTargetInfluences[r.currentFrame]=a*s,this.morphTargetInfluences[r.lastFrame]=(1-a)*s}}};const{polyfillTHREE:Q}=i(54538);Q(K)},79742:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),i=t[0],r=t[1];return 3*(i+r)/4-r},t.toByteArray=function(e){var t,i,o=a(e),s=o[0],l=o[1],h=new n(function(e,t,i){return 3*(t+i)/4-i}(0,s,l)),c=0,u=l>0?s-4:s;for(i=0;i<u;i+=4)t=r[e.charCodeAt(i)]<<18|r[e.charCodeAt(i+1)]<<12|r[e.charCodeAt(i+2)]<<6|r[e.charCodeAt(i+3)],h[c++]=t>>16&255,h[c++]=t>>8&255,h[c++]=255&t;2===l&&(t=r[e.charCodeAt(i)]<<2|r[e.charCodeAt(i+1)]>>4,h[c++]=255&t);1===l&&(t=r[e.charCodeAt(i)]<<10|r[e.charCodeAt(i+1)]<<4|r[e.charCodeAt(i+2)]>>2,h[c++]=t>>8&255,h[c++]=255&t);return h},t.fromByteArray=function(e){for(var t,r=e.length,n=r%3,o=[],s=16383,a=0,h=r-n;a<h;a+=s)o.push(l(e,a,a+s>h?h:a+s));1===n?(t=e[r-1],o.push(i[t>>2]+i[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],o.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return o.join("")};for(var i=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)i[s]=o[s],r[o.charCodeAt(s)]=s;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function l(e,t,r){for(var n,o,s=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(i[(o=n)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},52072:e=>{e.exports=function(){"use strict";var e=function(){for(var e=3,t=document.createElement("b"),i=t.all||[];t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i><![endif]--\x3e",i[0];);return e>4?e:document.documentMode}(),t=navigator.platform.toLowerCase().indexOf("mac")+1,i=function(e){if(!(this instanceof i))return new i(e);var s=this,a={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};s.options={};for(var l,h=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],c=0;l=h[c];c++)s.options[l]=void 0!==e[l]&&null!=e[l]?e[l]:a[l];var u,d=["scroll","content"];for(c=0;u=d[c];c++)if(s[u+"_elem"]=e[u+"Id"]?document.getElementById(e[u+"Id"]):e[u+"Elem"],!s[u+"_elem"])throw new Error("Error! Could not find "+u+" element");s.content_elem.hasAttribute("tabindex")||s.content_elem.setAttribute("tabindex",0);var p=o(e.rows)?e.rows:s.fetchMarkup(),f={},m=s.scroll_elem.scrollTop;s.insertToDOM(p,f),s.scroll_elem.scrollTop=m;var g=!1,v=0,y=!1,b=function(){t&&(y||(s.content_elem.style.pointerEvents="none"),y=!0,clearTimeout(v),v=setTimeout((function(){s.content_elem.style.pointerEvents="auto",y=!1}),50)),g!=(g=s.getClusterNum())&&s.insertToDOM(p,f),s.options.callbacks.scrollingProgress&&s.options.callbacks.scrollingProgress(s.getScrollProgress())},x=0,_=function(){clearTimeout(x),x=setTimeout(s.refresh,100)};r("scroll",s.scroll_elem,b),r("resize",window,_),s.destroy=function(e){n("scroll",s.scroll_elem,b),n("resize",window,_),s.html((e?s.generateEmptyRow():p).join(""))},s.refresh=function(e){(s.getRowsHeight(p)||e)&&s.update(p)},s.update=function(e){p=o(e)?e:[];var t=s.scroll_elem.scrollTop;p.length*s.options.item_height<t&&(s.scroll_elem.scrollTop=0,g=0),s.insertToDOM(p,f),s.scroll_elem.scrollTop=t},s.clear=function(){s.update([])},s.getRowsAmount=function(){return p.length},s.getScrollProgress=function(){return this.options.scroll_top/(p.length*this.options.item_height)*100||0};var E=function(e,t){var i=o(t)?t:[];i.length&&(p="append"==e?p.concat(i):i.concat(p),s.insertToDOM(p,f))};s.append=function(e){E("append",e)},s.prepend=function(e){E("prepend",e)}};function r(e,t,i){return t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function n(e,t,i){return t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent("on"+e,i)}function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function s(e,t){return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle[e]}return i.prototype={constructor:i,fetchMarkup:function(){for(var e=[],t=this.getChildNodes(this.content_elem);t.length;)e.push(t.shift().outerHTML);return e},exploreEnvironment:function(t,i){var r=this.options;r.content_tag=this.content_elem.tagName.toLowerCase(),t.length&&(e&&e<=9&&!r.tag&&(r.tag=t[0].match(/<([^>\s/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(i.data=this.html(t[0]+t[0]+t[0])),r.tag||(r.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(t))},getRowsHeight:function(e){var t=this.options,i=t.item_height;if(t.cluster_height=0,e.length){var r=this.content_elem.children;if(r.length){var n=r[Math.floor(r.length/2)];if(t.item_height=n.offsetHeight,"tr"==t.tag&&"collapse"!=s("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(s("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){var o=parseInt(s("marginTop",n),10)||0,a=parseInt(s("marginBottom",n),10)||0;t.item_height+=Math.max(o,a)}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,i!=t.item_height}}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var e=this.options;if(!e.tag||!e.show_no_data_row)return[];var t,i=document.createElement(e.tag),r=document.createTextNode(e.no_data_text);return i.className=e.no_data_class,"tr"==e.tag&&((t=document.createElement("td")).colSpan=100,t.appendChild(r)),i.appendChild(t||r),[i.outerHTML]},generate:function(e,t){var i=this.options,r=e.length;if(r<i.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:r?e:this.generateEmptyRow()};var n=Math.max((i.rows_in_cluster-i.rows_in_block)*t,0),o=n+i.rows_in_cluster,s=Math.max(n*i.item_height,0),a=Math.max((r-o)*i.item_height,0),l=[],h=n;s<1&&h++;for(var c=n;c<o;c++)e[c]&&l.push(e[c]);return{top_offset:s,bottom_offset:a,rows_above:h,rows:l}},renderExtraTag:function(e,t){var i=document.createElement(this.options.tag),r="clusterize-";return i.className=[r+"extra-row",r+e].join(" "),t&&(i.style.height=t+"px"),i.outerHTML},insertToDOM:function(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);var i=this.generate(e,this.getClusterNum()),r=i.rows.join(""),n=this.checkChanges("data",r,t),o=this.checkChanges("top",i.top_offset,t),s=this.checkChanges("bottom",i.bottom_offset,t),a=this.options.callbacks,l=[];n||o?(i.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",i.top_offset))),l.push(r),i.bottom_offset&&l.push(this.renderExtraTag("bottom-space",i.bottom_offset)),a.clusterWillChange&&a.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",i.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(i.rows_above-1),a.clusterChanged&&a.clusterChanged()):s&&(this.content_elem.lastChild.style.height=i.bottom_offset+"px")},html:function(t){var i=this.content_elem;if(e&&e<=9&&"tr"==this.options.tag){var r,n=document.createElement("div");for(n.innerHTML="<table><tbody>"+t+"</tbody></table>";r=i.lastChild;)i.removeChild(r);for(var o=this.getChildNodes(n.firstChild.firstChild);o.length;)i.appendChild(o.shift())}else i.innerHTML=t},getChildNodes:function(e){for(var t=e.children,i=[],r=0,n=t.length;r<n;r++)i.push(t[r]);return i},checkChanges:function(e,t,i){var r=t!=i[e];return i[e]=t,r}},i}()},19662:(e,t,i)=>{"use strict";var r=i(60614),n=i(66330),o=TypeError;e.exports=function(e){if(r(e))return e;throw o(n(e)+" is not a function")}},39483:(e,t,i)=>{"use strict";var r=i(4411),n=i(66330),o=TypeError;e.exports=function(e){if(r(e))return e;throw o(n(e)+" is not a constructor")}},40027:(e,t,i)=>{"use strict";var r=i(75706).has;e.exports=function(e){return r(e),e}},96077:(e,t,i)=>{"use strict";var r=i(60614),n=String,o=TypeError;e.exports=function(e){if("object"==typeof e||r(e))return e;throw o("Can't set "+n(e)+" as a prototype")}},88999:(e,t,i)=>{"use strict";var r=i(79405).has;e.exports=function(e){return r(e),e}},29257:(e,t,i)=>{"use strict";var r=i(60953).has;e.exports=function(e){return r(e),e}},72682:(e,t,i)=>{"use strict";var r=i(78818).has;e.exports=function(e){return r(e),e}},51223:(e,t,i)=>{"use strict";var r=i(5112),n=i(70030),o=i(3070).f,s=r("unscopables"),a=Array.prototype;void 0===a[s]&&o(a,s,{configurable:!0,value:n(null)}),e.exports=function(e){a[s][e]=!0}},25787:(e,t,i)=>{"use strict";var r=i(47976),n=TypeError;e.exports=function(e,t){if(r(t,e))return e;throw n("Incorrect invocation")}},19670:(e,t,i)=>{"use strict";var r=i(70111),n=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw o(n(e)+" is not an object")}},23013:e=>{"use strict";e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7556:(e,t,i)=>{"use strict";var r=i(47293);e.exports=r((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},90260:(e,t,i)=>{"use strict";var r,n,o,s=i(23013),a=i(19781),l=i(17854),h=i(60614),c=i(70111),u=i(92597),d=i(70648),p=i(66330),f=i(68880),m=i(98052),g=i(47045),v=i(47976),y=i(79518),b=i(27674),x=i(5112),_=i(69711),E=i(29909),A=E.enforce,S=E.get,w=l.Int8Array,M=w&&w.prototype,T=l.Uint8ClampedArray,C=T&&T.prototype,P=w&&y(w),D=M&&y(M),L=Object.prototype,I=l.TypeError,R=x("toStringTag"),O=_("TYPED_ARRAY_TAG"),N="TypedArrayConstructor",F=s&&!!b&&"Opera"!==d(l.opera),k=!1,V={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},U={BigInt64Array:8,BigUint64Array:8},B=function(e){var t=y(e);if(c(t)){var i=S(t);return i&&u(i,N)?i[N]:B(t)}},G=function(e){if(!c(e))return!1;var t=d(e);return u(V,t)||u(U,t)};for(r in V)(o=(n=l[r])&&n.prototype)?A(o)[N]=n:F=!1;for(r in U)(o=(n=l[r])&&n.prototype)&&(A(o)[N]=n);if((!F||!h(P)||P===Function.prototype)&&(P=function(){throw I("Incorrect invocation")},F))for(r in V)l[r]&&b(l[r],P);if((!F||!D||D===L)&&(D=P.prototype,F))for(r in V)l[r]&&b(l[r].prototype,D);if(F&&y(C)!==D&&b(C,D),a&&!u(D,R))for(r in k=!0,g(D,R,{configurable:!0,get:function(){return c(this)?this[O]:void 0}}),V)l[r]&&f(l[r],O,r);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:F,TYPED_ARRAY_TAG:k&&O,aTypedArray:function(e){if(G(e))return e;throw I("Target is not a typed array")},aTypedArrayConstructor:function(e){if(h(e)&&(!b||v(P,e)))return e;throw I(p(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,i,r){if(a){if(i)for(var n in V){var o=l[n];if(o&&u(o.prototype,e))try{delete o.prototype[e]}catch(i){try{o.prototype[e]=t}catch(e){}}}D[e]&&!i||m(D,e,i?t:F&&M[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,i){var r,n;if(a){if(b){if(i)for(r in V)if((n=l[r])&&u(n,e))try{delete n[e]}catch(e){}if(P[e]&&!i)return;try{return m(P,e,i?t:F&&P[e]||t)}catch(e){}}for(r in V)!(n=l[r])||n[e]&&!i||m(n,e,t)}},getTypedArrayConstructor:B,isView:function(e){if(!c(e))return!1;var t=d(e);return"DataView"===t||u(V,t)||u(U,t)},isTypedArray:G,TypedArray:P,TypedArrayPrototype:D}},41318:(e,t,i)=>{"use strict";var r=i(45656),n=i(51400),o=i(26244),s=function(e){return function(t,i,s){var a,l=r(t),h=o(l),c=n(s,h);if(e&&i!=i){for(;h>c;)if((a=l[c++])!=a)return!0}else for(;h>c;c++)if((e||c in l)&&l[c]===i)return e||c||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},42092:(e,t,i)=>{"use strict";var r=i(49974),n=i(1702),o=i(68361),s=i(47908),a=i(26244),l=i(65417),h=n([].push),c=function(e){var t=1===e,i=2===e,n=3===e,c=4===e,u=6===e,d=7===e,p=5===e||u;return function(f,m,g,v){for(var y,b,x=s(f),_=o(x),E=r(m,g),A=a(_),S=0,w=v||l,M=t?w(f,A):i||d?w(f,0):void 0;A>S;S++)if((p||S in _)&&(b=E(y=_[S],S,x),e))if(t)M[S]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return S;case 2:h(M,y)}else switch(e){case 4:return!1;case 7:h(M,y)}return u?-1:n||c?c:M}};e.exports={forEach:c(0),map:c(1),filter:c(2),some:c(3),every:c(4),find:c(5),findIndex:c(6),filterReject:c(7)}},41589:(e,t,i)=>{"use strict";var r=i(51400),n=i(26244),o=i(86135),s=Array,a=Math.max;e.exports=function(e,t,i){for(var l=n(e),h=r(t,l),c=r(void 0===i?l:i,l),u=s(a(c-h,0)),d=0;h<c;h++,d++)o(u,d,e[h]);return u.length=d,u}},50206:(e,t,i)=>{"use strict";var r=i(1702);e.exports=r([].slice)},77475:(e,t,i)=>{"use strict";var r=i(43157),n=i(4411),o=i(70111),s=i(5112)("species"),a=Array;e.exports=function(e){var t;return r(e)&&(t=e.constructor,(n(t)&&(t===a||r(t.prototype))||o(t)&&null===(t=t[s]))&&(t=void 0)),void 0===t?a:t}},65417:(e,t,i)=>{"use strict";var r=i(77475);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},60956:(e,t,i)=>{"use strict";var r=i(1702),n=i(19662),o=i(68554),s=i(26244),a=i(47908),l=i(75706),h=i(14995),c=l.Map,u=l.has,d=l.set,p=r([].push);e.exports=function(e){var t,i,r,l=a(this),f=s(l),m=[],g=new c,v=o(e)?function(e){return e}:n(e);for(t=0;t<f;t++)r=v(i=l[t]),u(g,r)||d(g,r,i);return h(g,(function(e){p(m,e)})),m}},17072:(e,t,i)=>{"use strict";var r=i(5112)("iterator"),n=!1;try{var o=0,s={next:function(){return{done:!!o++}},return:function(){n=!0}};s[r]=function(){return this},Array.from(s,(function(){throw 2}))}catch(e){}e.exports=function(e,t){try{if(!t&&!n)return!1}catch(e){return!1}var i=!1;try{var o={};o[r]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch(e){}return i}},84326:(e,t,i)=>{"use strict";var r=i(1702),n=r({}.toString),o=r("".slice);e.exports=function(e){return o(n(e),8,-1)}},70648:(e,t,i)=>{"use strict";var r=i(51694),n=i(60614),o=i(84326),s=i(5112)("toStringTag"),a=Object,l="Arguments"===o(function(){return arguments}());e.exports=r?o:function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=a(e),s))?i:l?o(t):"Object"===(r=o(t))&&n(t.callee)?"Arguments":r}},27296:(e,t,i)=>{"use strict";var r=i(49974),n=i(46916),o=i(19662),s=i(39483),a=i(68554),l=i(20408),h=[].push;e.exports=function(e){var t,i,c,u,d=arguments.length,p=d>1?arguments[1]:void 0;return s(this),(t=void 0!==p)&&o(p),a(e)?new this:(i=[],t?(c=0,u=r(p,d>2?arguments[2]:void 0),l(e,(function(e){n(h,i,u(e,c++))}))):l(e,h,{that:i}),new this(i))}},82044:(e,t,i)=>{"use strict";var r=i(50206);e.exports=function(){return new this(r(arguments))}},95631:(e,t,i)=>{"use strict";var r=i(70030),n=i(47045),o=i(89190),s=i(49974),a=i(25787),l=i(68554),h=i(20408),c=i(51656),u=i(76178),d=i(96340),p=i(19781),f=i(62423).fastKey,m=i(29909),g=m.set,v=m.getterFor;e.exports={getConstructor:function(e,t,i,c){var u=e((function(e,n){a(e,d),g(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),p||(e.size=0),l(n)||h(n,e[c],{that:e,AS_ENTRIES:i})})),d=u.prototype,m=v(t),y=function(e,t,i){var r,n,o=m(e),s=b(e,t);return s?s.value=i:(o.last=s={index:n=f(t,!0),key:t,value:i,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=s),r&&(r.next=s),p?o.size++:e.size++,"F"!==n&&(o.index[n]=s)),e},b=function(e,t){var i,r=m(e),n=f(t);if("F"!==n)return r.index[n];for(i=r.first;i;i=i.next)if(i.key===t)return i};return o(d,{clear:function(){for(var e=m(this),t=e.index,i=e.first;i;)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete t[i.index],i=i.next;e.first=e.last=void 0,p?e.size=0:this.size=0},delete:function(e){var t=this,i=m(t),r=b(t,e);if(r){var n=r.next,o=r.previous;delete i.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),i.first===r&&(i.first=n),i.last===r&&(i.last=o),p?i.size--:t.size--}return!!r},forEach:function(e){for(var t,i=m(this),r=s(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:i.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!b(this,e)}}),o(d,i?{get:function(e){var t=b(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),p&&n(d,"size",{configurable:!0,get:function(){return m(this).size}}),u},setStrong:function(e,t,i){var r=t+" Iterator",n=v(t),o=v(r);c(e,t,(function(e,t){g(this,{type:r,target:e,state:n(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,i=e.last;i&&i.removed;)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?u("keys"===t?i.key:"values"===t?i.value:[i.key,i.value],!1):(e.target=void 0,u(void 0,!0))}),i?"entries":"values",!i,!0),d(t)}}},29320:(e,t,i)=>{"use strict";var r=i(1702),n=i(89190),o=i(62423).getWeakData,s=i(25787),a=i(19670),l=i(68554),h=i(70111),c=i(20408),u=i(42092),d=i(92597),p=i(29909),f=p.set,m=p.getterFor,g=u.find,v=u.findIndex,y=r([].splice),b=0,x=function(e){return e.frozen||(e.frozen=new _)},_=function(){this.entries=[]},E=function(e,t){return g(e.entries,(function(e){return e[0]===t}))};_.prototype={get:function(e){var t=E(this,e);if(t)return t[1]},has:function(e){return!!E(this,e)},set:function(e,t){var i=E(this,e);i?i[1]=t:this.entries.push([e,t])},delete:function(e){var t=v(this.entries,(function(t){return t[0]===e}));return~t&&y(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,i,r){var u=e((function(e,n){s(e,p),f(e,{type:t,id:b++,frozen:void 0}),l(n)||c(n,e[r],{that:e,AS_ENTRIES:i})})),p=u.prototype,g=m(t),v=function(e,t,i){var r=g(e),n=o(a(t),!0);return!0===n?x(r).set(t,i):n[r.id]=i,e};return n(p,{delete:function(e){var t=g(this);if(!h(e))return!1;var i=o(e);return!0===i?x(t).delete(e):i&&d(i,t.id)&&delete i[t.id]},has:function(e){var t=g(this);if(!h(e))return!1;var i=o(e);return!0===i?x(t).has(e):i&&d(i,t.id)}}),n(p,i?{get:function(e){var t=g(this);if(h(e)){var i=o(e);return!0===i?x(t).get(e):i?i[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),u}}},77710:(e,t,i)=>{"use strict";var r=i(82109),n=i(17854),o=i(1702),s=i(54705),a=i(98052),l=i(62423),h=i(20408),c=i(25787),u=i(60614),d=i(68554),p=i(70111),f=i(47293),m=i(17072),g=i(58003),v=i(79587);e.exports=function(e,t,i){var y=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),x=y?"set":"add",_=n[e],E=_&&_.prototype,A=_,S={},w=function(e){var t=o(E[e]);a(E,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(b&&!p(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return b&&!p(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(b&&!p(e))&&t(this,0===e?0:e)}:function(e,i){return t(this,0===e?0:e,i),this})};if(s(e,!u(_)||!(b||E.forEach&&!f((function(){(new _).entries().next()})))))A=i.getConstructor(t,e,y,x),l.enable();else if(s(e,!0)){var M=new A,T=M[x](b?{}:-0,1)!==M,C=f((function(){M.has(1)})),P=m((function(e){new _(e)})),D=!b&&f((function(){for(var e=new _,t=5;t--;)e[x](t,t);return!e.has(-0)}));P||((A=t((function(e,t){c(e,E);var i=v(new _,e,A);return d(t)||h(t,i[x],{that:i,AS_ENTRIES:y}),i}))).prototype=E,E.constructor=A),(C||D)&&(w("delete"),w("has"),y&&w("get")),(D||T)&&w(x),b&&E.clear&&delete E.clear}return S[e]=A,r({global:!0,constructor:!0,forced:A!==_},S),g(A,e),b||i.setStrong(A,e,y),A}},10313:(e,t,i)=>{"use strict";i(51532),i(4129);var r=i(35005),n=i(70030),o=i(70111),s=Object,a=TypeError,l=r("Map"),h=r("WeakMap"),c=function(){this.object=null,this.symbol=null,this.primitives=null,this.objectsByIndex=n(null)};c.prototype.get=function(e,t){return this[e]||(this[e]=t())},c.prototype.next=function(e,t,i){var r=i?this.objectsByIndex[e]||(this.objectsByIndex[e]=new h):this.primitives||(this.primitives=new l),n=r.get(t);return n||r.set(t,n=new c),n};var u=new c;e.exports=function(){var e,t,i=u,r=arguments.length;for(e=0;e<r;e++)o(t=arguments[e])&&(i=i.next(e,t,!0));if(this===s&&i===u)throw a("Composite keys must contain a non-primitive component");for(e=0;e<r;e++)o(t=arguments[e])||(i=i.next(e,t,!1));return i}},99920:(e,t,i)=>{"use strict";var r=i(92597),n=i(53887),o=i(31236),s=i(3070);e.exports=function(e,t,i){for(var a=n(t),l=s.f,h=o.f,c=0;c<a.length;c++){var u=a[c];r(e,u)||i&&r(i,u)||l(e,u,h(t,u))}}},49920:(e,t,i)=>{"use strict";var r=i(47293);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},76178:e=>{"use strict";e.exports=function(e,t){return{value:e,done:t}}},68880:(e,t,i)=>{"use strict";var r=i(19781),n=i(3070),o=i(79114);e.exports=r?function(e,t,i){return n.f(e,t,o(1,i))}:function(e,t,i){return e[t]=i,e}},79114:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},86135:(e,t,i)=>{"use strict";var r=i(34948),n=i(3070),o=i(79114);e.exports=function(e,t,i){var s=r(t);s in e?n.f(e,s,o(0,i)):e[s]=i}},47045:(e,t,i)=>{"use strict";var r=i(56339),n=i(3070);e.exports=function(e,t,i){return i.get&&r(i.get,t,{getter:!0}),i.set&&r(i.set,t,{setter:!0}),n.f(e,t,i)}},98052:(e,t,i)=>{"use strict";var r=i(60614),n=i(3070),o=i(56339),s=i(13072);e.exports=function(e,t,i,a){a||(a={});var l=a.enumerable,h=void 0!==a.name?a.name:t;if(r(i)&&o(i,h,a),a.global)l?e[t]=i:s(t,i);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=i:n.f(e,t,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},89190:(e,t,i)=>{"use strict";var r=i(98052);e.exports=function(e,t,i){for(var n in t)r(e,n,t[n],i);return e}},13072:(e,t,i)=>{"use strict";var r=i(17854),n=Object.defineProperty;e.exports=function(e,t){try{n(r,e,{value:t,configurable:!0,writable:!0})}catch(i){r[e]=t}return t}},19781:(e,t,i)=>{"use strict";var r=i(47293);e.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4154:e=>{"use strict";var t="object"==typeof document&&document.all,i=void 0===t&&void 0!==t;e.exports={all:t,IS_HTMLDDA:i}},80317:(e,t,i)=>{"use strict";var r=i(17854),n=i(70111),o=r.document,s=n(o)&&n(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},89363:e=>{"use strict";e.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version},6833:(e,t,i)=>{"use strict";var r=i(88113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},35268:(e,t,i)=>{"use strict";var r=i(17854),n=i(84326);e.exports="process"===n(r.process)},88113:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7392:(e,t,i)=>{"use strict";var r,n,o=i(17854),s=i(88113),a=o.process,l=o.Deno,h=a&&a.versions||l&&l.version,c=h&&h.v8;c&&(n=(r=c.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!n&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(n=+r[1]),e.exports=n},80748:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},82109:(e,t,i)=>{"use strict";var r=i(17854),n=i(31236).f,o=i(68880),s=i(98052),a=i(13072),l=i(99920),h=i(54705);e.exports=function(e,t){var i,c,u,d,p,f=e.target,m=e.global,g=e.stat;if(i=m?r:g?r[f]||a(f,{}):(r[f]||{}).prototype)for(c in t){if(d=t[c],u=e.dontCallGetSet?(p=n(i,c))&&p.value:i[c],!h(m?c:f+(g?".":"#")+c,e.forced)&&void 0!==u){if(typeof d==typeof u)continue;l(d,u)}(e.sham||u&&u.sham)&&o(d,"sham",!0),s(i,c,d,e)}}},47293:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},76677:(e,t,i)=>{"use strict";var r=i(47293);e.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},22104:(e,t,i)=>{"use strict";var r=i(34374),n=Function.prototype,o=n.apply,s=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},49974:(e,t,i)=>{"use strict";var r=i(21470),n=i(19662),o=i(34374),s=r(r.bind);e.exports=function(e,t){return n(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},34374:(e,t,i)=>{"use strict";var r=i(47293);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},46916:(e,t,i)=>{"use strict";var r=i(34374),n=Function.prototype.call;e.exports=r?n.bind(n):function(){return n.apply(n,arguments)}},76530:(e,t,i)=>{"use strict";var r=i(19781),n=i(92597),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=n(o,"name"),l=a&&"something"===function(){}.name,h=a&&(!r||r&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:h}},75668:(e,t,i)=>{"use strict";var r=i(1702),n=i(19662);e.exports=function(e,t,i){try{return r(n(Object.getOwnPropertyDescriptor(e,t)[i]))}catch(e){}}},21470:(e,t,i)=>{"use strict";var r=i(84326),n=i(1702);e.exports=function(e){if("Function"===r(e))return n(e)}},1702:(e,t,i)=>{"use strict";var r=i(34374),n=Function.prototype,o=n.call,s=r&&n.bind.bind(o,o);e.exports=r?s:function(e){return function(){return o.apply(e,arguments)}}},35005:(e,t,i)=>{"use strict";var r=i(17854),n=i(60614);e.exports=function(e,t){return arguments.length<2?(i=r[e],n(i)?i:void 0):r[e]&&r[e][t];var i}},24942:e=>{"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},71246:(e,t,i)=>{"use strict";var r=i(70648),n=i(58173),o=i(68554),s=i(97497),a=i(5112)("iterator");e.exports=function(e){if(!o(e))return n(e,a)||n(e,"@@iterator")||s[r(e)]}},18554:(e,t,i)=>{"use strict";var r=i(46916),n=i(19662),o=i(19670),s=i(66330),a=i(71246),l=TypeError;e.exports=function(e,t){var i=arguments.length<2?a(e):t;if(n(i))return o(r(i,e));throw l(s(e)+" is not iterable")}},58173:(e,t,i)=>{"use strict";var r=i(19662),n=i(68554);e.exports=function(e,t){var i=e[t];return n(i)?void 0:r(i)}},738:(e,t,i)=>{"use strict";var r=i(19662),n=i(19670),o=i(46916),s=i(19303),a=i(24942),l="Invalid size",h=RangeError,c=TypeError,u=Math.max,d=function(e,t,i,r){this.set=e,this.size=t,this.has=i,this.keys=r};d.prototype={getIterator:function(){return a(n(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){n(e);var t=+e.size;if(t!=t)throw c(l);var i=s(t);if(i<0)throw h(l);return new d(e,u(i,0),r(e.has),r(e.keys))}},17854:function(e,t,i){"use strict";var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof i.g&&i.g)||function(){return this}()||this||Function("return this")()},92597:(e,t,i)=>{"use strict";var r=i(1702),n=i(47908),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(n(e),t)}},3501:e=>{"use strict";e.exports={}},842:e=>{"use strict";e.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}},60490:(e,t,i)=>{"use strict";var r=i(35005);e.exports=r("document","documentElement")},64664:(e,t,i)=>{"use strict";var r=i(19781),n=i(47293),o=i(80317);e.exports=!r&&!n((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},68361:(e,t,i)=>{"use strict";var r=i(1702),n=i(47293),o=i(84326),s=Object,a=r("".split);e.exports=n((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===o(e)?a(e,""):s(e)}:s},79587:(e,t,i)=>{"use strict";var r=i(60614),n=i(70111),o=i(27674);e.exports=function(e,t,i){var s,a;return o&&r(s=t.constructor)&&s!==i&&n(a=s.prototype)&&a!==i.prototype&&o(e,a),e}},42788:(e,t,i)=>{"use strict";var r=i(1702),n=i(60614),o=i(5465),s=r(Function.toString);n(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},62423:(e,t,i)=>{"use strict";var r=i(82109),n=i(1702),o=i(3501),s=i(70111),a=i(92597),l=i(3070).f,h=i(8006),c=i(1156),u=i(52050),d=i(69711),p=i(76677),f=!1,m=d("meta"),g=0,v=function(e){l(e,m,{value:{objectID:"O"+g++,weakData:{}}})},y=e.exports={enable:function(){y.enable=function(){},f=!0;var e=h.f,t=n([].splice),i={};i[m]=1,e(i).length&&(h.f=function(i){for(var r=e(i),n=0,o=r.length;n<o;n++)if(r[n]===m){t(r,n,1);break}return r},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:c.f}))},fastKey:function(e,t){if(!s(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,m)){if(!u(e))return"F";if(!t)return"E";v(e)}return e[m].objectID},getWeakData:function(e,t){if(!a(e,m)){if(!u(e))return!0;if(!t)return!1;v(e)}return e[m].weakData},onFreeze:function(e){return p&&f&&u(e)&&!a(e,m)&&v(e),e}};o[m]=!0},29909:(e,t,i)=>{"use strict";var r,n,o,s=i(94811),a=i(17854),l=i(70111),h=i(68880),c=i(92597),u=i(5465),d=i(6200),p=i(3501),f="Object already initialized",m=a.TypeError,g=a.WeakMap;if(s||u.state){var v=u.state||(u.state=new g);v.get=v.get,v.has=v.has,v.set=v.set,r=function(e,t){if(v.has(e))throw m(f);return t.facade=e,v.set(e,t),t},n=function(e){return v.get(e)||{}},o=function(e){return v.has(e)}}else{var y=d("state");p[y]=!0,r=function(e,t){if(c(e,y))throw m(f);return t.facade=e,h(e,y,t),t},n=function(e){return c(e,y)?e[y]:{}},o=function(e){return c(e,y)}}e.exports={set:r,get:n,has:o,enforce:function(e){return o(e)?n(e):r(e,{})},getterFor:function(e){return function(t){var i;if(!l(t)||(i=n(t)).type!==e)throw m("Incompatible receiver, "+e+" required");return i}}}},97659:(e,t,i)=>{"use strict";var r=i(5112),n=i(97497),o=r("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||s[o]===e)}},43157:(e,t,i)=>{"use strict";var r=i(84326);e.exports=Array.isArray||function(e){return"Array"===r(e)}},60614:(e,t,i)=>{"use strict";var r=i(4154),n=r.all;e.exports=r.IS_HTMLDDA?function(e){return"function"==typeof e||e===n}:function(e){return"function"==typeof e}},4411:(e,t,i)=>{"use strict";var r=i(1702),n=i(47293),o=i(60614),s=i(70648),a=i(35005),l=i(42788),h=function(){},c=[],u=a("Reflect","construct"),d=/^\s*(?:class|function)\b/,p=r(d.exec),f=!d.exec(h),m=function(e){if(!o(e))return!1;try{return u(h,c,e),!0}catch(e){return!1}},g=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return f||!!p(d,l(e))}catch(e){return!0}};g.sham=!0,e.exports=!u||n((function(){var e;return m(m.call)||!m(Object)||!m((function(){e=!0}))||e}))?g:m},54705:(e,t,i)=>{"use strict";var r=i(47293),n=i(60614),o=/#|\.prototype\./,s=function(e,t){var i=l[a(e)];return i===c||i!==h&&(n(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=s.data={},h=s.NATIVE="N",c=s.POLYFILL="P";e.exports=s},25615:(e,t,i)=>{"use strict";var r=i(70648),n=i(92597),o=i(68554),s=i(5112),a=i(97497),l=s("iterator"),h=Object;e.exports=function(e){if(o(e))return!1;var t=h(e);return void 0!==t[l]||"@@iterator"in t||n(a,r(t))}},68554:e=>{"use strict";e.exports=function(e){return null==e}},70111:(e,t,i)=>{"use strict";var r=i(60614),n=i(4154),o=n.all;e.exports=n.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:r(e)||e===o}:function(e){return"object"==typeof e?null!==e:r(e)}},31913:e=>{"use strict";e.exports=!1},52190:(e,t,i)=>{"use strict";var r=i(35005),n=i(60614),o=i(47976),s=i(43307),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return n(t)&&o(t.prototype,a(e))}},6333:(e,t,i)=>{"use strict";var r=i(46916);e.exports=function(e,t,i){for(var n,o,s=i?e:e.iterator,a=e.next;!(n=r(a,s)).done;)if(void 0!==(o=t(n.value)))return o}},20408:(e,t,i)=>{"use strict";var r=i(49974),n=i(46916),o=i(19670),s=i(66330),a=i(97659),l=i(26244),h=i(47976),c=i(18554),u=i(71246),d=i(99212),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},m=f.prototype;e.exports=function(e,t,i){var g,v,y,b,x,_,E,A=i&&i.that,S=!(!i||!i.AS_ENTRIES),w=!(!i||!i.IS_RECORD),M=!(!i||!i.IS_ITERATOR),T=!(!i||!i.INTERRUPTED),C=r(t,A),P=function(e){return g&&d(g,"normal",e),new f(!0,e)},D=function(e){return S?(o(e),T?C(e[0],e[1],P):C(e[0],e[1])):T?C(e,P):C(e)};if(w)g=e.iterator;else if(M)g=e;else{if(!(v=u(e)))throw p(s(e)+" is not iterable");if(a(v)){for(y=0,b=l(e);b>y;y++)if((x=D(e[y]))&&h(m,x))return x;return new f(!1)}g=c(e,v)}for(_=w?e.next:g.next;!(E=n(_,g)).done;){try{x=D(E.value)}catch(e){d(g,"throw",e)}if("object"==typeof x&&x&&h(m,x))return x}return new f(!1)}},99212:(e,t,i)=>{"use strict";var r=i(46916),n=i(19670),o=i(58173);e.exports=function(e,t,i){var s,a;n(e);try{if(!(s=o(e,"return"))){if("throw"===t)throw i;return i}s=r(s,e)}catch(e){a=!0,s=e}if("throw"===t)throw i;if(a)throw s;return n(s),i}},63061:(e,t,i)=>{"use strict";var r=i(13383).IteratorPrototype,n=i(70030),o=i(79114),s=i(58003),a=i(97497),l=function(){return this};e.exports=function(e,t,i,h){var c=t+" Iterator";return e.prototype=n(r,{next:o(+!h,i)}),s(e,c,!1,!0),a[c]=l,e}},51656:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(31913),s=i(76530),a=i(60614),l=i(63061),h=i(79518),c=i(27674),u=i(58003),d=i(68880),p=i(98052),f=i(5112),m=i(97497),g=i(13383),v=s.PROPER,y=s.CONFIGURABLE,b=g.IteratorPrototype,x=g.BUGGY_SAFARI_ITERATORS,_=f("iterator"),E="keys",A="values",S="entries",w=function(){return this};e.exports=function(e,t,i,s,f,g,M){l(i,t,s);var T,C,P,D=function(e){if(e===f&&N)return N;if(!x&&e&&e in R)return R[e];switch(e){case E:case A:case S:return function(){return new i(this,e)}}return function(){return new i(this)}},L=t+" Iterator",I=!1,R=e.prototype,O=R[_]||R["@@iterator"]||f&&R[f],N=!x&&O||D(f),F="Array"===t&&R.entries||O;if(F&&(T=h(F.call(new e)))!==Object.prototype&&T.next&&(o||h(T)===b||(c?c(T,b):a(T[_])||p(T,_,w)),u(T,L,!0,!0),o&&(m[L]=w)),v&&f===A&&O&&O.name!==A&&(!o&&y?d(R,"name",A):(I=!0,N=function(){return n(O,this)})),f)if(C={values:D(A),keys:g?N:D(E),entries:D(S)},M)for(P in C)(x||I||!(P in R))&&p(R,P,C[P]);else r({target:t,proto:!0,forced:x||I},C);return o&&!M||R[_]===N||p(R,_,N,{name:f}),m[t]=N,C}},13383:(e,t,i)=>{"use strict";var r,n,o,s=i(47293),a=i(60614),l=i(70111),h=i(70030),c=i(79518),u=i(98052),d=i(5112),p=i(31913),f=d("iterator"),m=!1;[].keys&&("next"in(o=[].keys())?(n=c(c(o)))!==Object.prototype&&(r=n):m=!0),!l(r)||s((function(){var e={};return r[f].call(e)!==e}))?r={}:p&&(r=h(r)),a(r[f])||u(r,f,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:m}},97497:e=>{"use strict";e.exports={}},26244:(e,t,i)=>{"use strict";var r=i(17466);e.exports=function(e){return r(e.length)}},56339:(e,t,i)=>{"use strict";var r=i(1702),n=i(47293),o=i(60614),s=i(92597),a=i(19781),l=i(76530).CONFIGURABLE,h=i(42788),c=i(29909),u=c.enforce,d=c.get,p=String,f=Object.defineProperty,m=r("".slice),g=r("".replace),v=r([].join),y=a&&!n((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),x=e.exports=function(e,t,i){"Symbol("===m(p(t),0,7)&&(t="["+g(p(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(t="get "+t),i&&i.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),y&&i&&s(i,"arity")&&e.length!==i.arity&&f(e,"length",{value:i.arity});try{i&&s(i,"constructor")&&i.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=u(e);return s(r,"source")||(r.source=v(b,"string"==typeof t?t:"")),e};Function.prototype.toString=x((function(){return o(this)&&d(this).source||h(this)}),"toString")},75706:(e,t,i)=>{"use strict";var r=i(1702),n=Map.prototype;e.exports={Map,set:r(n.set),get:r(n.get),has:r(n.has),remove:r(n.delete),proto:n}},14995:(e,t,i)=>{"use strict";var r=i(1702),n=i(6333),o=i(75706),s=o.Map,a=o.proto,l=r(a.forEach),h=r(a.entries),c=h(new s).next;e.exports=function(e,t,i){return i?n({iterator:h(e),next:c},(function(e){return t(e[1],e[0])})):l(e,t)}},26130:(e,t,i)=>{"use strict";var r=i(64310),n=Math.abs,o=Math.pow,s=o(2,-52),a=o(2,-23),l=o(2,127)*(2-a),h=o(2,-126);e.exports=Math.fround||function(e){var t,i,o=+e,c=n(o),u=r(o);return c<h?u*function(e){return e+1/s-1/s}(c/h/a)*h*a:(i=(t=(1+a/s)*c)-(t-c))>l||i!=i?u*(1/0):u*i}},47103:e=>{"use strict";e.exports=Math.scale||function(e,t,i,r,n){var o=+e,s=+t,a=+i,l=+r,h=+n;return o!=o||s!=s||a!=a||l!=l||h!=h?NaN:o===1/0||o===-1/0?o:(o-s)*(h-l)/(a-s)+l}},64310:e=>{"use strict";e.exports=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1}},74758:e=>{"use strict";var t=Math.ceil,i=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?i:t)(r)}},78523:(e,t,i)=>{"use strict";var r=i(19662),n=TypeError,o=function(e){var t,i;this.promise=new e((function(e,r){if(void 0!==t||void 0!==i)throw n("Bad Promise constructor");t=e,i=r})),this.resolve=r(t),this.reject=r(i)};e.exports.f=function(e){return new o(e)}},77023:(e,t,i)=>{"use strict";var r=i(17854).isFinite;e.exports=Number.isFinite||function(e){return"number"==typeof e&&r(e)}},83009:(e,t,i)=>{"use strict";var r=i(17854),n=i(47293),o=i(1702),s=i(41340),a=i(53111).trim,l=i(81361),h=r.parseInt,c=r.Symbol,u=c&&c.iterator,d=/^[+-]?0x/i,p=o(d.exec),f=8!==h(l+"08")||22!==h(l+"0x16")||u&&!n((function(){h(Object(u))}));e.exports=f?function(e,t){var i=a(s(e));return h(i,t>>>0||(p(d,i)?16:10))}:h},70030:(e,t,i)=>{"use strict";var r,n=i(19670),o=i(36048),s=i(80748),a=i(3501),l=i(60490),h=i(80317),c=i(6200),u="prototype",d="script",p=c("IE_PROTO"),f=function(){},m=function(e){return"<"+d+">"+e+"</"+d+">"},g=function(e){e.write(m("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}var e,t,i;v="undefined"!=typeof document?document.domain&&r?g(r):(t=h("iframe"),i="java"+d+":",t.style.display="none",l.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(m("document.F=Object")),e.close(),e.F):g(r);for(var n=s.length;n--;)delete v[u][s[n]];return v()};a[p]=!0,e.exports=Object.create||function(e,t){var i;return null!==e?(f[u]=n(e),i=new f,f[u]=null,i[p]=e):i=v(),void 0===t?i:o.f(i,t)}},36048:(e,t,i)=>{"use strict";var r=i(19781),n=i(3353),o=i(3070),s=i(19670),a=i(45656),l=i(81956);t.f=r&&!n?Object.defineProperties:function(e,t){s(e);for(var i,r=a(t),n=l(t),h=n.length,c=0;h>c;)o.f(e,i=n[c++],r[i]);return e}},3070:(e,t,i)=>{"use strict";var r=i(19781),n=i(64664),o=i(3353),s=i(19670),a=i(34948),l=TypeError,h=Object.defineProperty,c=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",p="writable";t.f=r?o?function(e,t,i){if(s(e),t=a(t),s(i),"function"==typeof e&&"prototype"===t&&"value"in i&&p in i&&!i[p]){var r=c(e,t);r&&r[p]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return h(e,t,i)}:h:function(e,t,i){if(s(e),t=a(t),s(i),n)try{return h(e,t,i)}catch(e){}if("get"in i||"set"in i)throw l("Accessors not supported");return"value"in i&&(e[t]=i.value),e}},31236:(e,t,i)=>{"use strict";var r=i(19781),n=i(46916),o=i(55296),s=i(79114),a=i(45656),l=i(34948),h=i(92597),c=i(64664),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=a(e),t=l(t),c)try{return u(e,t)}catch(e){}if(h(e,t))return s(!n(o.f,e,t),e[t])}},1156:(e,t,i)=>{"use strict";var r=i(84326),n=i(45656),o=i(8006).f,s=i(41589),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"===r(e)?function(e){try{return o(e)}catch(e){return s(a)}}(e):o(n(e))}},8006:(e,t,i)=>{"use strict";var r=i(16324),n=i(80748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,n)}},25181:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},79518:(e,t,i)=>{"use strict";var r=i(92597),n=i(60614),o=i(47908),s=i(6200),a=i(49920),l=s("IE_PROTO"),h=Object,c=h.prototype;e.exports=a?h.getPrototypeOf:function(e){var t=o(e);if(r(t,l))return t[l];var i=t.constructor;return n(i)&&t instanceof i?i.prototype:t instanceof h?c:null}},52050:(e,t,i)=>{"use strict";var r=i(47293),n=i(70111),o=i(84326),s=i(7556),a=Object.isExtensible,l=r((function(){a(1)}));e.exports=l||s?function(e){return!!n(e)&&((!s||"ArrayBuffer"!==o(e))&&(!a||a(e)))}:a},47976:(e,t,i)=>{"use strict";var r=i(1702);e.exports=r({}.isPrototypeOf)},16324:(e,t,i)=>{"use strict";var r=i(1702),n=i(92597),o=i(45656),s=i(41318).indexOf,a=i(3501),l=r([].push);e.exports=function(e,t){var i,r=o(e),h=0,c=[];for(i in r)!n(a,i)&&n(r,i)&&l(c,i);for(;t.length>h;)n(r,i=t[h++])&&(~s(c,i)||l(c,i));return c}},81956:(e,t,i)=>{"use strict";var r=i(16324),n=i(80748);e.exports=Object.keys||function(e){return r(e,n)}},55296:(e,t)=>{"use strict";var i={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,n=r&&!i.call({1:2},1);t.f=n?function(e){var t=r(this,e);return!!t&&t.enumerable}:i},27674:(e,t,i)=>{"use strict";var r=i(75668),n=i(19670),o=i(96077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=r(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch(e){}return function(i,r){return n(i),o(r),t?e(i,r):i.__proto__=r,i}}():void 0)},90515:(e,t,i)=>{"use strict";var r=i(17854),n=i(60614),o=i(5112)("observable"),s=r.Observable,a=s&&s.prototype;e.exports=!(n(s)&&n(s.from)&&n(s.of)&&n(a.subscribe)&&n(a[o]))},92140:(e,t,i)=>{"use strict";var r=i(46916),n=i(60614),o=i(70111),s=TypeError;e.exports=function(e,t){var i,a;if("string"===t&&n(i=e.toString)&&!o(a=r(i,e)))return a;if(n(i=e.valueOf)&&!o(a=r(i,e)))return a;if("string"!==t&&n(i=e.toString)&&!o(a=r(i,e)))return a;throw s("Can't convert object to primitive value")}},53887:(e,t,i)=>{"use strict";var r=i(35005),n=i(1702),o=i(8006),s=i(25181),a=i(19670),l=n([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(a(e)),i=s.f;return i?l(t,i(e)):t}},40857:(e,t,i)=>{"use strict";var r=i(17854);e.exports=r},12534:e=>{"use strict";e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},38845:(e,t,i)=>{"use strict";i(51532),i(4129);var r=i(35005),n=i(1702),o=i(72309),s=r("Map"),a=r("WeakMap"),l=n([].push),h=o("metadata"),c=h.store||(h.store=new a),u=function(e,t,i){var r=c.get(e);if(!r){if(!i)return;c.set(e,r=new s)}var n=r.get(t);if(!n){if(!i)return;r.set(t,n=new s)}return n};e.exports={store:c,getMap:u,has:function(e,t,i){var r=u(t,i,!1);return void 0!==r&&r.has(e)},get:function(e,t,i){var r=u(t,i,!1);return void 0===r?void 0:r.get(e)},set:function(e,t,i,r){u(i,r,!0).set(e,t)},keys:function(e,t){var i=u(e,t,!1),r=[];return i&&i.forEach((function(e,t){l(r,t)})),r},toKey:function(e){return void 0===e||"symbol"==typeof e?e:String(e)}}},67066:(e,t,i)=>{"use strict";var r=i(19670);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},84488:(e,t,i)=>{"use strict";var r=i(68554),n=TypeError;e.exports=function(e){if(r(e))throw n("Can't call method on "+e);return e}},46465:e=>{"use strict";e.exports=function(e,t){return e===t||e!=e&&t!=t}},17152:(e,t,i)=>{"use strict";var r,n=i(17854),o=i(22104),s=i(60614),a=i(89363),l=i(88113),h=i(50206),c=i(48053),u=n.Function,d=/MSIE .\./.test(l)||a&&((r=n.Bun.version.split(".")).length<3||"0"===r[0]&&(r[1]<3||"3"===r[1]&&"0"===r[2]));e.exports=function(e,t){var i=t?2:1;return d?function(r,n){var a=c(arguments.length,1)>i,l=s(r)?r:u(r),d=a?h(arguments,i):[],p=a?function(){o(l,this,d)}:l;return t?e(p,n):e(p)}:e}},26283:(e,t,i)=>{"use strict";var r=i(79405),n=i(87758),o=r.Set,s=r.add;e.exports=function(e){var t=new o;return n(e,(function(e){s(t,e)})),t}},37075:(e,t,i)=>{"use strict";var r=i(88999),n=i(79405),o=i(26283),s=i(1043),a=i(738),l=i(87758),h=i(6333),c=n.has,u=n.remove;e.exports=function(e){var t=r(this),i=a(e),n=o(t);return s(t)<=i.size?l(t,(function(e){i.includes(e)&&u(n,e)})):h(i.getIterator(),(function(e){c(t,e)&&u(n,e)})),n}},79405:(e,t,i)=>{"use strict";var r=i(1702),n=Set.prototype;e.exports={Set,add:r(n.add),has:r(n.has),remove:r(n.delete),proto:n}},81920:(e,t,i)=>{"use strict";var r=i(88999),n=i(79405),o=i(1043),s=i(738),a=i(87758),l=i(6333),h=n.Set,c=n.add,u=n.has;e.exports=function(e){var t=r(this),i=s(e),n=new h;return o(t)>i.size?l(i.getIterator(),(function(e){u(t,e)&&c(n,e)})):a(t,(function(e){i.includes(e)&&c(n,e)})),n}},78239:(e,t,i)=>{"use strict";var r=i(88999),n=i(79405).has,o=i(1043),s=i(738),a=i(87758),l=i(6333),h=i(99212);e.exports=function(e){var t=r(this),i=s(e);if(o(t)<=i.size)return!1!==a(t,(function(e){if(i.includes(e))return!1}),!0);var c=i.getIterator();return!1!==l(c,(function(e){if(n(t,e))return h(c,"normal",!1)}))}},49180:(e,t,i)=>{"use strict";var r=i(88999),n=i(1043),o=i(87758),s=i(738);e.exports=function(e){var t=r(this),i=s(e);return!(n(t)>i.size)&&!1!==o(t,(function(e){if(!i.includes(e))return!1}),!0)}},10107:(e,t,i)=>{"use strict";var r=i(88999),n=i(79405).has,o=i(1043),s=i(738),a=i(6333),l=i(99212);e.exports=function(e){var t=r(this),i=s(e);if(o(t)<i.size)return!1;var h=i.getIterator();return!1!==a(h,(function(e){if(!n(t,e))return l(h,"normal",!1)}))}},87758:(e,t,i)=>{"use strict";var r=i(1702),n=i(6333),o=i(79405),s=o.Set,a=o.proto,l=r(a.forEach),h=r(a.keys),c=h(new s).next;e.exports=function(e,t,i){return i?n({iterator:h(e),next:c},t):l(e,t)}},1043:(e,t,i)=>{"use strict";var r=i(75668),n=i(79405);e.exports=r(n.proto,"size","get")||function(e){return e.size}},96340:(e,t,i)=>{"use strict";var r=i(35005),n=i(47045),o=i(5112),s=i(19781),a=o("species");e.exports=function(e){var t=r(e);s&&t&&!t[a]&&n(t,a,{configurable:!0,get:function(){return this}})}},98506:(e,t,i)=>{"use strict";var r=i(88999),n=i(79405),o=i(26283),s=i(738),a=i(6333),l=n.add,h=n.has,c=n.remove;e.exports=function(e){var t=r(this),i=s(e).getIterator(),n=o(t);return a(i,(function(e){h(t,e)?c(n,e):l(n,e)})),n}},58003:(e,t,i)=>{"use strict";var r=i(3070).f,n=i(92597),o=i(5112)("toStringTag");e.exports=function(e,t,i){e&&!i&&(e=e.prototype),e&&!n(e,o)&&r(e,o,{configurable:!0,value:t})}},39391:(e,t,i)=>{"use strict";var r=i(88999),n=i(79405).add,o=i(26283),s=i(738),a=i(6333);e.exports=function(e){var t=r(this),i=s(e).getIterator(),l=o(t);return a(i,(function(e){n(l,e)})),l}},6200:(e,t,i)=>{"use strict";var r=i(72309),n=i(69711),o=r("keys");e.exports=function(e){return o[e]||(o[e]=n(e))}},5465:(e,t,i)=>{"use strict";var r=i(17854),n=i(13072),o="__core-js_shared__",s=r[o]||n(o,{});e.exports=s},72309:(e,t,i)=>{"use strict";var r=i(31913),n=i(5465);(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.32.2",mode:r?"pure":"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.2/LICENSE",source:"https://github.com/zloirock/core-js"})},28710:(e,t,i)=>{"use strict";var r=i(1702),n=i(19303),o=i(41340),s=i(84488),a=r("".charAt),l=r("".charCodeAt),h=r("".slice),c=function(e){return function(t,i){var r,c,u=o(s(t)),d=n(i),p=u.length;return d<0||d>=p?e?"":void 0:(r=l(u,d))<55296||r>56319||d+1===p||(c=l(u,d+1))<56320||c>57343?e?a(u,d):r:e?h(u,d,d+2):c-56320+(r-55296<<10)+65536}};e.exports={codeAt:c(!1),charAt:c(!0)}},53111:(e,t,i)=>{"use strict";var r=i(1702),n=i(84488),o=i(41340),s=i(81361),a=r("".replace),l=RegExp("^["+s+"]+"),h=RegExp("(^|[^"+s+"])["+s+"]+$"),c=function(e){return function(t){var i=o(n(t));return 1&e&&(i=a(i,l,"")),2&e&&(i=a(i,h,"$1")),i}};e.exports={start:c(1),end:c(2),trim:c(3)}},36293:(e,t,i)=>{"use strict";var r=i(7392),n=i(47293),o=i(17854).String;e.exports=!!Object.getOwnPropertySymbols&&!n((function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},20261:(e,t,i)=>{"use strict";var r,n,o,s,a=i(17854),l=i(22104),h=i(49974),c=i(60614),u=i(92597),d=i(47293),p=i(60490),f=i(50206),m=i(80317),g=i(48053),v=i(6833),y=i(35268),b=a.setImmediate,x=a.clearImmediate,_=a.process,E=a.Dispatch,A=a.Function,S=a.MessageChannel,w=a.String,M=0,T={},C="onreadystatechange";d((function(){r=a.location}));var P=function(e){if(u(T,e)){var t=T[e];delete T[e],t()}},D=function(e){return function(){P(e)}},L=function(e){P(e.data)},I=function(e){a.postMessage(w(e),r.protocol+"//"+r.host)};b&&x||(b=function(e){g(arguments.length,1);var t=c(e)?e:A(e),i=f(arguments,1);return T[++M]=function(){l(t,void 0,i)},n(M),M},x=function(e){delete T[e]},y?n=function(e){_.nextTick(D(e))}:E&&E.now?n=function(e){E.now(D(e))}:S&&!v?(s=(o=new S).port2,o.port1.onmessage=L,n=h(s.postMessage,s)):a.addEventListener&&c(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!d(I)?(n=I,a.addEventListener("message",L,!1)):n=C in m("script")?function(e){p.appendChild(m("script"))[C]=function(){p.removeChild(this),P(e)}}:function(e){setTimeout(D(e),0)}),e.exports={set:b,clear:x}},51400:(e,t,i)=>{"use strict";var r=i(19303),n=Math.max,o=Math.min;e.exports=function(e,t){var i=r(e);return i<0?n(i+t,0):o(i,t)}},45656:(e,t,i)=>{"use strict";var r=i(68361),n=i(84488);e.exports=function(e){return r(n(e))}},19303:(e,t,i)=>{"use strict";var r=i(74758);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},17466:(e,t,i)=>{"use strict";var r=i(19303),n=Math.min;e.exports=function(e){return e>0?n(r(e),9007199254740991):0}},47908:(e,t,i)=>{"use strict";var r=i(84488),n=Object;e.exports=function(e){return n(r(e))}},84590:(e,t,i)=>{"use strict";var r=i(73002),n=RangeError;e.exports=function(e,t){var i=r(e);if(i%t)throw n("Wrong offset");return i}},73002:(e,t,i)=>{"use strict";var r=i(19303),n=RangeError;e.exports=function(e){var t=r(e);if(t<0)throw n("The argument can't be less than 0");return t}},57593:(e,t,i)=>{"use strict";var r=i(46916),n=i(70111),o=i(52190),s=i(58173),a=i(92140),l=i(5112),h=TypeError,c=l("toPrimitive");e.exports=function(e,t){if(!n(e)||o(e))return e;var i,l=s(e,c);if(l){if(void 0===t&&(t="default"),i=r(l,e,t),!n(i)||o(i))return i;throw h("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},34948:(e,t,i)=>{"use strict";var r=i(57593),n=i(52190);e.exports=function(e){var t=r(e,"string");return n(t)?t:t+""}},45965:(e,t,i)=>{"use strict";var r=i(35005),n=i(60614),o=i(25615),s=i(70111),a=r("Set");e.exports=function(e){return function(e){return s(e)&&"number"==typeof e.size&&n(e.has)&&n(e.keys)}(e)?e:o(e)?new a(e):e}},51694:(e,t,i)=>{"use strict";var r={};r[i(5112)("toStringTag")]="z",e.exports="[object z]"===String(r)},41340:(e,t,i)=>{"use strict";var r=i(70648),n=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return n(e)}},66330:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},69711:(e,t,i)=>{"use strict";var r=i(1702),n=0,o=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++n+o,36)}},43307:(e,t,i)=>{"use strict";var r=i(36293);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:(e,t,i)=>{"use strict";var r=i(19781),n=i(47293);e.exports=r&&n((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},48053:e=>{"use strict";var t=TypeError;e.exports=function(e,i){if(e<i)throw t("Not enough arguments");return e}},94811:(e,t,i)=>{"use strict";var r=i(17854),n=i(60614),o=r.WeakMap;e.exports=n(o)&&/native code/.test(String(o))},60953:(e,t,i)=>{"use strict";var r=i(1702),n=WeakMap.prototype;e.exports={WeakMap,set:r(n.set),get:r(n.get),has:r(n.has),remove:r(n.delete)}},78818:(e,t,i)=>{"use strict";var r=i(1702),n=WeakSet.prototype;e.exports={WeakSet,add:r(n.add),has:r(n.has),remove:r(n.delete)}},26800:(e,t,i)=>{"use strict";var r=i(40857),n=i(92597),o=i(6061),s=i(3070).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});n(t,e)||s(t,e,{value:o.f(e)})}},6061:(e,t,i)=>{"use strict";var r=i(5112);t.f=r},5112:(e,t,i)=>{"use strict";var r=i(17854),n=i(72309),o=i(92597),s=i(69711),a=i(36293),l=i(43307),h=r.Symbol,c=n("wks"),u=l?h.for||h:h&&h.withoutSetter||s;e.exports=function(e){return o(c,e)||(c[e]=a&&o(h,e)?h[e]:u("Symbol."+e)),c[e]}},81361:e=>{"use strict";e.exports="\t\n\v\f\r \u2028\u2029\ufeff"},26699:(e,t,i)=>{"use strict";var r=i(82109),n=i(41318).includes,o=i(47293),s=i(51223);r({target:"Array",proto:!0,forced:o((function(){return!Array(1).includes()}))},{includes:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),s("includes")},69098:(e,t,i)=>{"use strict";i(77710)("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),i(95631))},51532:(e,t,i)=>{"use strict";i(69098)},92087:(e,t,i)=>{"use strict";var r=i(17854),n=i(19781),o=i(47045),s=i(67066),a=i(47293),l=r.RegExp,h=l.prototype;n&&a((function(){var e=!0;try{l(".","d")}catch(t){e=!1}var t={},i="",r=e?"dgimsy":"gimsy",n=function(e,r){Object.defineProperty(t,e,{get:function(){return i+=r,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var s in e&&(o.hasIndices="d"),o)n(s,o[s]);return Object.getOwnPropertyDescriptor(h,"flags").get.call(t)!==r||i!==r}))&&o(h,"flags",{configurable:!0,get:s})},3462:(e,t,i)=>{"use strict";var r=i(17854),n=i(46916),o=i(90260),s=i(26244),a=i(84590),l=i(47908),h=i(47293),c=r.RangeError,u=r.Int8Array,d=u&&u.prototype,p=d&&d.set,f=o.aTypedArray,m=o.exportTypedArrayMethod,g=!h((function(){var e=new Uint8ClampedArray(2);return n(p,e,{length:1,0:3},1),3!==e[1]})),v=g&&o.NATIVE_ARRAY_BUFFER_VIEWS&&h((function(){var e=new u(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));m("set",(function(e){f(this);var t=a(arguments.length>1?arguments[1]:void 0,1),i=l(e);if(g)return n(p,this,i,t);var r=this.length,o=s(i),h=0;if(o+t>r)throw c("Wrong length");for(;h<o;)this[t+h]=i[h++]}),!g||v)},41202:(e,t,i)=>{"use strict";var r,n=i(76677),o=i(17854),s=i(1702),a=i(89190),l=i(62423),h=i(77710),c=i(29320),u=i(70111),d=i(29909).enforce,p=i(47293),f=i(94811),m=Object,g=Array.isArray,v=m.isExtensible,y=m.isFrozen,b=m.isSealed,x=m.freeze,_=m.seal,E={},A={},S=!o.ActiveXObject&&"ActiveXObject"in o,w=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},M=h("WeakMap",w,c),T=M.prototype,C=s(T.set);if(f)if(S){r=c.getConstructor(w,"WeakMap",!0),l.enable();var P=s(T.delete),D=s(T.has),L=s(T.get);a(T,{delete:function(e){if(u(e)&&!v(e)){var t=d(this);return t.frozen||(t.frozen=new r),P(this,e)||t.frozen.delete(e)}return P(this,e)},has:function(e){if(u(e)&&!v(e)){var t=d(this);return t.frozen||(t.frozen=new r),D(this,e)||t.frozen.has(e)}return D(this,e)},get:function(e){if(u(e)&&!v(e)){var t=d(this);return t.frozen||(t.frozen=new r),D(this,e)?L(this,e):t.frozen.get(e)}return L(this,e)},set:function(e,t){if(u(e)&&!v(e)){var i=d(this);i.frozen||(i.frozen=new r),D(this,e)?C(this,e,t):i.frozen.set(e,t)}else C(this,e,t);return this}})}else n&&p((function(){var e=x([]);return C(new M,e,1),!y(e)}))&&a(T,{set:function(e,t){var i;return g(e)&&(y(e)?i=E:b(e)&&(i=A)),C(this,e,t),i===E&&x(e),i===A&&_(e),this}})},4129:(e,t,i)=>{"use strict";i(41202)},83475:(e,t,i)=>{"use strict";var r=i(19781),n=i(51223),o=i(47908),s=i(26244),a=i(47045);r&&(a(Array.prototype,"lastIndex",{configurable:!0,get:function(){var e=o(this),t=s(e);return 0===t?0:t-1}}),n("lastIndex"))},46273:(e,t,i)=>{"use strict";var r=i(19781),n=i(51223),o=i(47908),s=i(26244),a=i(47045);r&&(a(Array.prototype,"lastItem",{configurable:!0,get:function(){var e=o(this),t=s(e);return 0===t?void 0:e[t-1]},set:function(e){var t=o(this),i=s(t);return t[0===i?0:i-1]=e}}),n("lastItem"))},51568:(e,t,i)=>{"use strict";var r=i(82109),n=i(22104),o=i(10313),s=i(35005),a=i(70030),l=Object,h=function(){var e=s("Object","freeze");return e?e(a(null)):a(null)};r({global:!0,forced:!0},{compositeKey:function(){return n(o,l,arguments).get("object",h)}})},26349:(e,t,i)=>{"use strict";var r=i(82109),n=i(10313),o=i(35005),s=i(22104);r({global:!0,forced:!0},{compositeSymbol:function(){return 1===arguments.length&&"string"==typeof arguments[0]?o("Symbol").for(arguments[0]):s(n,null,arguments).get("symbol",o("Symbol"))}})},10072:(e,t,i)=>{"use strict";var r=i(82109),n=i(40027),o=i(75706).remove;r({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=n(this),i=!0,r=0,s=arguments.length;r<s;r++)e=o(t,arguments[r]),i=i&&e;return!!i}})},99137:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(40027),s=i(14995);r({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0);return!1!==s(t,(function(e,r){if(!i(e,r,t))return!1}),!0)}})},71957:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(40027),s=i(75706),a=i(14995),l=s.Map,h=s.set;r({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=new l;return a(t,(function(e,n){i(e,n,t)&&h(r,n,e)})),r}})},103:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(40027),s=i(14995);r({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=s(t,(function(e,r){if(i(e,r,t))return{key:r}}),!0);return r&&r.key}})},96306:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(40027),s=i(14995);r({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=s(t,(function(e,r){if(i(e,r,t))return{value:e}}),!0);return r&&r.value}})},8582:(e,t,i)=>{"use strict";i(82109)({target:"Map",stat:!0,forced:!0},{from:i(27296)})},90618:(e,t,i)=>{"use strict";var r=i(82109),n=i(1702),o=i(19662),s=i(84488),a=i(20408),l=i(75706),h=i(31913),c=l.Map,u=l.has,d=l.get,p=l.set,f=n([].push);r({target:"Map",stat:!0,forced:h},{groupBy:function(e,t){s(e),o(t);var i=new c,r=0;return a(e,(function(e){var n=t(e,r++);u(i,n)?f(d(i,n),e):p(i,n,[e])})),i}})},74592:(e,t,i)=>{"use strict";var r=i(82109),n=i(46465),o=i(40027),s=i(14995);r({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return!0===s(o(this),(function(t){if(n(t,e))return!0}),!0)}})},88440:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(20408),s=i(60614),a=i(19662),l=i(75706).Map;r({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var i=new(s(this)?this:l);a(t);var r=a(i.set);return o(e,(function(e){n(r,i,t(e),e)})),i}})},58276:(e,t,i)=>{"use strict";var r=i(82109),n=i(40027),o=i(14995);r({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){var t=o(n(this),(function(t,i){if(t===e)return{key:i}}),!0);return t&&t.key}})},35082:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(40027),s=i(75706),a=i(14995),l=s.Map,h=s.set;r({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=new l;return a(t,(function(e,n){h(r,i(e,n,t),e)})),r}})},12813:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(40027),s=i(75706),a=i(14995),l=s.Map,h=s.set;r({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=new l;return a(t,(function(e,n){h(r,n,i(e,n,t))})),r}})},18222:(e,t,i)=>{"use strict";var r=i(82109),n=i(40027),o=i(20408),s=i(75706).set;r({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=n(this),i=arguments.length,r=0;r<i;)o(arguments[r++],(function(e,i){s(t,e,i)}),{AS_ENTRIES:!0});return t}})},24838:(e,t,i)=>{"use strict";i(82109)({target:"Map",stat:!0,forced:!0},{of:i(82044)})},38563:(e,t,i)=>{"use strict";var r=i(82109),n=i(19662),o=i(40027),s=i(14995),a=TypeError;r({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=o(this),i=arguments.length<2,r=i?void 0:arguments[1];if(n(e),s(t,(function(n,o){i?(i=!1,r=n):r=e(r,n,o,t)})),i)throw a("Reduce of empty map with no initial value");return r}})},50336:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(40027),s=i(14995);r({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0);return!0===s(t,(function(e,r){if(i(e,r,t))return!0}),!0)}})},7512:(e,t,i)=>{"use strict";var r=i(82109),n=i(19662),o=i(40027),s=i(75706),a=TypeError,l=s.get,h=s.has,c=s.set;r({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var i=o(this),r=arguments.length;n(t);var s=h(i,e);if(!s&&r<3)throw a("Updating absent value");var u=s?l(i,e):n(r>2?arguments[2]:void 0)(e,i);return c(i,e,t(u,e,i)),i}})},46603:(e,t,i)=>{"use strict";var r=i(82109),n=Math.min,o=Math.max;r({target:"Math",stat:!0,forced:!0},{clamp:function(e,t,i){return n(i,o(t,e))}})},70100:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,nonConfigurable:!0,nonWritable:!0},{DEG_PER_RAD:Math.PI/180})},10490:(e,t,i)=>{"use strict";var r=i(82109),n=180/Math.PI;r({target:"Math",stat:!0,forced:!0},{degrees:function(e){return e*n}})},13187:(e,t,i)=>{"use strict";var r=i(82109),n=i(47103),o=i(26130);r({target:"Math",stat:!0,forced:!0},{fscale:function(e,t,i,r,s){return o(n(e,t,i,r,s))}})},60092:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,forced:!0},{iaddh:function(e,t,i,r){var n=e>>>0,o=i>>>0;return(t>>>0)+(r>>>0)+((n&o|(n|o)&~(n+o>>>0))>>>31)|0}})},19041:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,forced:!0},{imulh:function(e,t){var i=65535,r=+e,n=+t,o=r&i,s=n&i,a=r>>16,l=n>>16,h=(a*s>>>0)+(o*s>>>16);return a*l+(h>>16)+((o*l>>>0)+(h&i)>>16)}})},30666:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,forced:!0},{isubh:function(e,t,i,r){var n=e>>>0,o=i>>>0;return(t>>>0)-(r>>>0)-((~n&o|~(n^o)&n-o>>>0)>>>31)|0}})},51638:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,nonConfigurable:!0,nonWritable:!0},{RAD_PER_DEG:180/Math.PI})},62975:(e,t,i)=>{"use strict";var r=i(82109),n=Math.PI/180;r({target:"Math",stat:!0,forced:!0},{radians:function(e){return e*n}})},15728:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,forced:!0},{scale:i(47103)})},46056:(e,t,i)=>{"use strict";var r=i(82109),n=i(19670),o=i(77023),s=i(63061),a=i(76178),l=i(29909),h="Seeded Random",c=h+" Generator",u=l.set,d=l.getterFor(c),p=TypeError,f=s((function(e){u(this,{type:c,seed:e%2147483647})}),h,(function(){var e=d(this),t=e.seed=(1103515245*e.seed+12345)%2147483647;return a((1073741823&t)/1073741823,!1)}));r({target:"Math",stat:!0,forced:!0},{seededPRNG:function(e){var t=n(e).seed;if(!o(t))throw p('Math.seededPRNG() argument should have a "seed" field with a finite value.');return new f(t)}})},44299:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,forced:!0},{signbit:function(e){var t=+e;return t==t&&0===t?1/t==-1/0:t<0}})},5162:(e,t,i)=>{"use strict";i(82109)({target:"Math",stat:!0,forced:!0},{umulh:function(e,t){var i=65535,r=+e,n=+t,o=r&i,s=n&i,a=r>>>16,l=n>>>16,h=(a*s>>>0)+(o*s>>>16);return a*l+(h>>>16)+((o*l>>>0)+(h&i)>>>16)}})},50292:(e,t,i)=>{"use strict";var r=i(82109),n=i(1702),o=i(19303),s=i(83009),a="Invalid number representation",l=RangeError,h=SyntaxError,c=TypeError,u=/^[\da-z]+$/,d=n("".charAt),p=n(u.exec),f=n(1..toString),m=n("".slice);r({target:"Number",stat:!0,forced:!0},{fromString:function(e,t){var i,r,n=1;if("string"!=typeof e)throw c(a);if(!e.length)throw h(a);if("-"===d(e,0)&&(n=-1,!(e=m(e,1)).length))throw h(a);if((i=void 0===t?10:o(t))<2||i>36)throw l("Invalid radix");if(!p(u,e)||f(r=s(e,i),i)!==e)throw h(a);return n*r}})},39769:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(19781),s=i(96340),a=i(19662),l=i(19670),h=i(25787),c=i(60614),u=i(68554),d=i(70111),p=i(58173),f=i(98052),m=i(89190),g=i(47045),v=i(842),y=i(5112),b=i(29909),x=i(90515),_=y("observable"),E="Observable",A="Subscription",S="SubscriptionObserver",w=b.getterFor,M=b.set,T=w(E),C=w(A),P=w(S),D=function(e){this.observer=l(e),this.cleanup=void 0,this.subscriptionObserver=void 0};D.prototype={type:A,clean:function(){var e=this.cleanup;if(e){this.cleanup=void 0;try{e()}catch(e){v(e)}}},close:function(){if(!o){var e=this.facade,t=this.subscriptionObserver;e.closed=!0,t&&(t.closed=!0)}this.observer=void 0},isClosed:function(){return void 0===this.observer}};var L=function(e,t){var i,r=M(this,new D(e));o||(this.closed=!1);try{(i=p(e,"start"))&&n(i,e,this)}catch(e){v(e)}if(!r.isClosed()){var s=r.subscriptionObserver=new I(r);try{var l=t(s),h=l;u(l)||(r.cleanup=c(l.unsubscribe)?function(){h.unsubscribe()}:a(l))}catch(e){return void s.error(e)}r.isClosed()&&r.clean()}};L.prototype=m({},{unsubscribe:function(){var e=C(this);e.isClosed()||(e.close(),e.clean())}}),o&&g(L.prototype,"closed",{configurable:!0,get:function(){return C(this).isClosed()}});var I=function(e){M(this,{type:S,subscriptionState:e}),o||(this.closed=!1)};I.prototype=m({},{next:function(e){var t=P(this).subscriptionState;if(!t.isClosed()){var i=t.observer;try{var r=p(i,"next");r&&n(r,i,e)}catch(e){v(e)}}},error:function(e){var t=P(this).subscriptionState;if(!t.isClosed()){var i=t.observer;t.close();try{var r=p(i,"error");r?n(r,i,e):v(e)}catch(e){v(e)}t.clean()}},complete:function(){var e=P(this).subscriptionState;if(!e.isClosed()){var t=e.observer;e.close();try{var i=p(t,"complete");i&&n(i,t)}catch(e){v(e)}e.clean()}}}),o&&g(I.prototype,"closed",{configurable:!0,get:function(){return P(this).subscriptionState.isClosed()}});var R=function(e){h(this,O),M(this,{type:E,subscriber:a(e)})},O=R.prototype;m(O,{subscribe:function(e){var t=arguments.length;return new L(c(e)?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:d(e)?e:{},T(this).subscriber)}}),f(O,_,(function(){return this})),r({global:!0,constructor:!0,forced:x},{Observable:R}),s(E)},93532:(e,t,i)=>{"use strict";var r=i(82109),n=i(35005),o=i(46916),s=i(19670),a=i(4411),l=i(18554),h=i(58173),c=i(20408),u=i(5112),d=i(90515),p=u("observable");r({target:"Observable",stat:!0,forced:d},{from:function(e){var t=a(this)?this:n("Observable"),i=h(s(e),p);if(i){var r=s(o(i,e));return r.constructor===t?r:new t((function(e){return r.subscribe(e)}))}var u=l(e);return new t((function(e){c(u,(function(t,i){if(e.next(t),e.closed)return i()}),{IS_ITERATOR:!0,INTERRUPTED:!0}),e.complete()}))}})},1025:(e,t,i)=>{"use strict";i(39769),i(93532),i(88170)},88170:(e,t,i)=>{"use strict";var r=i(82109),n=i(35005),o=i(4411),s=i(90515),a=n("Array");r({target:"Observable",stat:!0,forced:s},{of:function(){for(var e=o(this)?this:n("Observable"),t=arguments.length,i=a(t),r=0;r<t;)i[r]=arguments[r++];return new e((function(e){for(var r=0;r<t;r++)if(e.next(i[r]),e.closed)return;e.complete()}))}})},77479:(e,t,i)=>{"use strict";var r=i(82109),n=i(78523),o=i(12534);r({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=n.f(this),i=o(e);return(i.error?t.reject:t.resolve)(i.value),t.promise}})},34582:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=n.toKey,a=n.set;r({target:"Reflect",stat:!0},{defineMetadata:function(e,t,i){var r=arguments.length<4?void 0:s(arguments[3]);a(e,t,o(i),r)}})},47896:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=n.toKey,a=n.getMap,l=n.store;r({target:"Reflect",stat:!0},{deleteMetadata:function(e,t){var i=arguments.length<3?void 0:s(arguments[2]),r=a(o(t),i,!1);if(void 0===r||!r.delete(e))return!1;if(r.size)return!0;var n=l.get(t);return n.delete(i),!!n.size||l.delete(t)}})},98558:(e,t,i)=>{"use strict";var r=i(82109),n=i(1702),o=i(38845),s=i(19670),a=i(79518),l=n(i(60956)),h=n([].concat),c=o.keys,u=o.toKey,d=function(e,t){var i=c(e,t),r=a(e);if(null===r)return i;var n=d(r,t);return n.length?i.length?l(h(i,n)):n:i};r({target:"Reflect",stat:!0},{getMetadataKeys:function(e){var t=arguments.length<2?void 0:u(arguments[1]);return d(s(e),t)}})},12647:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=i(79518),a=n.has,l=n.get,h=n.toKey,c=function(e,t,i){if(a(e,t,i))return l(e,t,i);var r=s(t);return null!==r?c(e,r,i):void 0};r({target:"Reflect",stat:!0},{getMetadata:function(e,t){var i=arguments.length<3?void 0:h(arguments[2]);return c(e,o(t),i)}})},97507:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=n.keys,a=n.toKey;r({target:"Reflect",stat:!0},{getOwnMetadataKeys:function(e){var t=arguments.length<2?void 0:a(arguments[1]);return s(o(e),t)}})},84018:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=n.get,a=n.toKey;r({target:"Reflect",stat:!0},{getOwnMetadata:function(e,t){var i=arguments.length<3?void 0:a(arguments[2]);return s(e,o(t),i)}})},61605:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=i(79518),a=n.has,l=n.toKey,h=function(e,t,i){if(a(e,t,i))return!0;var r=s(t);return null!==r&&h(e,r,i)};r({target:"Reflect",stat:!0},{hasMetadata:function(e,t){var i=arguments.length<3?void 0:l(arguments[2]);return h(e,o(t),i)}})},49076:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=n.has,a=n.toKey;r({target:"Reflect",stat:!0},{hasOwnMetadata:function(e,t){var i=arguments.length<3?void 0:a(arguments[2]);return s(e,o(t),i)}})},34999:(e,t,i)=>{"use strict";var r=i(82109),n=i(38845),o=i(19670),s=n.toKey,a=n.set;r({target:"Reflect",stat:!0},{metadata:function(e,t){return function(i,r){a(e,t,o(i),s(r))}}})},88921:(e,t,i)=>{"use strict";var r=i(82109),n=i(88999),o=i(79405).add;r({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=n(this),t=0,i=arguments.length;t<i;t++)o(e,arguments[t]);return e}})},96248:(e,t,i)=>{"use strict";var r=i(82109),n=i(88999),o=i(79405).remove;r({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=n(this),i=!0,r=0,s=arguments.length;r<s;r++)e=o(t,arguments[r]),i=i&&e;return!!i}})},13599:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(45965),s=i(37075);r({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){return n(s,this,o(e))}})},11477:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(88999),s=i(87758);r({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0);return!1!==s(t,(function(e){if(!i(e,e,t))return!1}),!0)}})},64362:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(88999),s=i(79405),a=i(87758),l=s.Set,h=s.add;r({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=new l;return a(t,(function(e){i(e,e,t)&&h(r,e)})),r}})},15389:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(88999),s=i(87758);r({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=s(t,(function(e){if(i(e,e,t))return{value:e}}),!0);return r&&r.value}})},46006:(e,t,i)=>{"use strict";i(82109)({target:"Set",stat:!0,forced:!0},{from:i(27296)})},90401:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(45965),s=i(81920);r({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){return n(s,this,o(e))}})},45164:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(45965),s=i(78239);r({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){return n(s,this,o(e))}})},91238:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(45965),s=i(49180);r({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){return n(s,this,o(e))}})},54837:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(45965),s=i(10107);r({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){return n(s,this,o(e))}})},87485:(e,t,i)=>{"use strict";var r=i(82109),n=i(1702),o=i(88999),s=i(87758),a=i(41340),l=n([].join),h=n([].push);r({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=o(this),i=void 0===e?",":a(e),r=[];return s(t,(function(e){h(r,e)})),l(r,i)}})},56767:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(88999),s=i(79405),a=i(87758),l=s.Set,h=s.add;r({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0),r=new l;return a(t,(function(e){h(r,i(e,e,t))})),r}})},69916:(e,t,i)=>{"use strict";i(82109)({target:"Set",stat:!0,forced:!0},{of:i(82044)})},76651:(e,t,i)=>{"use strict";var r=i(82109),n=i(19662),o=i(88999),s=i(87758),a=TypeError;r({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=o(this),i=arguments.length<2,r=i?void 0:arguments[1];if(n(e),s(t,(function(n){i?(i=!1,r=n):r=e(r,n,n,t)})),i)throw a("Reduce of empty set with no initial value");return r}})},61437:(e,t,i)=>{"use strict";var r=i(82109),n=i(49974),o=i(88999),s=i(87758);r({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=o(this),i=n(e,arguments.length>1?arguments[1]:void 0);return!0===s(t,(function(e){if(i(e,e,t))return!0}),!0)}})},35285:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(45965),s=i(98506);r({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){return n(s,this,o(e))}})},39865:(e,t,i)=>{"use strict";var r=i(82109),n=i(46916),o=i(45965),s=i(39391);r({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){return n(s,this,o(e))}})},86035:(e,t,i)=>{"use strict";var r=i(82109),n=i(28710).charAt,o=i(84488),s=i(19303),a=i(41340);r({target:"String",proto:!0,forced:!0},{at:function(e){var t=a(o(this)),i=t.length,r=s(e),l=r>=0?r:i+r;return l<0||l>=i?void 0:n(t,l)}})},67501:(e,t,i)=>{"use strict";var r=i(82109),n=i(63061),o=i(76178),s=i(84488),a=i(41340),l=i(29909),h=i(28710),c=h.codeAt,u=h.charAt,d="String Iterator",p=l.set,f=l.getterFor(d),m=n((function(e){p(this,{type:d,string:e,index:0})}),"String",(function(){var e,t=f(this),i=t.string,r=t.index;return r>=i.length?o(void 0,!0):(e=u(i,r),t.index+=e.length,o({codePoint:c(e,0),position:r},!1))}));r({target:"String",proto:!0,forced:!0},{codePoints:function(){return new m(a(s(this)))}})},21568:(e,t,i)=>{"use strict";var r=i(17854),n=i(26800),o=i(3070).f,s=i(31236).f,a=r.Symbol;if(n("dispose"),a){var l=s(a,"dispose");l.enumerable&&l.configurable&&l.writable&&o(a,"dispose",{value:l.value,enumerable:!1,configurable:!1,writable:!1})}},48824:(e,t,i)=>{"use strict";i(26800)("observable")},44130:(e,t,i)=>{"use strict";i(26800)("patternMatch")},78206:(e,t,i)=>{"use strict";var r=i(82109),n=i(29257),o=i(60953).remove;r({target:"WeakMap",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=n(this),i=!0,r=0,s=arguments.length;r<s;r++)e=o(t,arguments[r]),i=i&&e;return!!i}})},76478:(e,t,i)=>{"use strict";i(82109)({target:"WeakMap",stat:!0,forced:!0},{from:i(27296)})},79715:(e,t,i)=>{"use strict";i(82109)({target:"WeakMap",stat:!0,forced:!0},{of:i(82044)})},43561:(e,t,i)=>{"use strict";var r=i(82109),n=i(72682),o=i(78818).add;r({target:"WeakSet",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=n(this),t=0,i=arguments.length;t<i;t++)o(e,arguments[t]);return e}})},32049:(e,t,i)=>{"use strict";var r=i(82109),n=i(72682),o=i(78818).remove;r({target:"WeakSet",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=n(this),i=!0,r=0,s=arguments.length;r<s;r++)e=o(t,arguments[r]),i=i&&e;return!!i}})},86020:(e,t,i)=>{"use strict";i(82109)({target:"WeakSet",stat:!0,forced:!0},{from:i(27296)})},56585:(e,t,i)=>{"use strict";i(82109)({target:"WeakSet",stat:!0,forced:!0},{of:i(82044)})},11091:(e,t,i)=>{"use strict";var r=i(82109),n=i(17854),o=i(20261).clear;r({global:!0,bind:!0,enumerable:!0,forced:n.clearImmediate!==o},{clearImmediate:o})},84633:(e,t,i)=>{"use strict";i(11091),i(12986)},12986:(e,t,i)=>{"use strict";var r=i(82109),n=i(17854),o=i(20261).set,s=i(17152),a=n.setImmediate?s(o,!1):o;r({global:!0,bind:!0,enumerable:!0,forced:n.setImmediate!==a},{setImmediate:a})},53032:(e,t,i)=>{"use strict";var r=i(79742),n=i(80645),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */t.lW=l,t.h2=50;var s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,i){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return h(e,t,i)}function h(e,t,i){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var i=0|m(e,t),r=a(i),n=r.write(e,t);n!==i&&(r=r.slice(0,n));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return p(e,t,i);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return p(e,t,i);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,i);var n=function(e){if(l.isBuffer(e)){var t=0|f(e.length),i=a(t);return 0===i.length||e.copy(i,0,0,t),i}if(void 0!==e.length)return"number"!=typeof e.length||z(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),a(e<0?0:0|f(e))}function d(e){for(var t=e.length<0?0:0|f(e.length),i=a(t),r=0;r<t;r+=1)i[r]=255&e[r];return i}function p(e,t,i){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i),Object.setPrototypeOf(r,l.prototype),r}function f(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function m(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return U(e).length;default:if(n)return r?-1:V(e).length;t=(""+t).toLowerCase(),n=!0}}function g(e,t,i){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,i);case"utf8":case"utf-8":return M(this,t,i);case"ascii":return C(this,t,i);case"latin1":case"binary":return P(this,t,i);case"base64":return w(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function y(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),z(i=+i)&&(i=n?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:b(e,t,i,r,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):b(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function b(e,t,i,r,n){var o,s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,i/=2}function h(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(n){var c=-1;for(o=i;o<a;o++)if(h(e,o)===h(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(i+l>a&&(i=a-l),o=i;o>=0;o--){for(var u=!0,d=0;d<l;d++)if(h(e,o+d)!==h(t,d)){u=!1;break}if(u)return o}return-1}function x(e,t,i,r){i=Number(i)||0;var n=e.length-i;r?(r=Number(r))>n&&(r=n):r=n;var o=t.length;r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(z(a))return s;e[i+s]=a}return s}function _(e,t,i,r){return B(V(t,e.length-i),e,i,r)}function E(e,t,i,r){return B(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function A(e,t,i,r){return B(U(t),e,i,r)}function S(e,t,i,r){return B(function(e,t){for(var i,r,n,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(i=e.charCodeAt(s))>>8,n=i%256,o.push(n),o.push(r);return o}(t,e.length-i),e,i,r)}function w(e,t,i){return 0===t&&i===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,i))}function M(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var o,s,a,l,h=e[n],c=null,u=h>239?4:h>223?3:h>191?2:1;if(n+u<=i)switch(u){case 1:h<128&&(c=h);break;case 2:128==(192&(o=e[n+1]))&&(l=(31&h)<<6|63&o)>127&&(c=l);break;case 3:o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&(l=(15&h)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&h)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(c=l)}null===c?(c=65533,u=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=u}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var i="",r=0;for(;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=T));return i}(r)}l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,i){return h(e,t,i)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,i){return function(e,t,i){return c(e),e<=0?a(e):void 0!==t?"string"==typeof i?a(e).fill(t,i):a(e).fill(t):a(e)}(e,t,i)},l.allocUnsafe=function(e){return u(e)},l.allocUnsafeSlow=function(e){return u(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var i=e.length,r=t.length,n=0,o=Math.min(i,r);n<o;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var r=l.allocUnsafe(t),n=0;for(i=0;i<e.length;++i){var o=e[i];if(G(o,Uint8Array))n+o.length>r.length?l.from(o).copy(r,n):Uint8Array.prototype.set.call(r,o,n);else{if(!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n)}n+=o.length}return r},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?M(this,0,e):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",i=t.h2;return e=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,i,r,n){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),t<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&t>=i)return 0;if(r>=n)return-1;if(t>=i)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(r>>>=0),s=(i>>>=0)-(t>>>=0),a=Math.min(o,s),h=this.slice(r,n),c=e.slice(t,i),u=0;u<a;++u)if(h[u]!==c[u]){o=h[u],s=c[u];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},l.prototype.indexOf=function(e,t,i){return y(this,e,t,i,!0)},l.prototype.lastIndexOf=function(e,t,i){return y(this,e,t,i,!1)},l.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||i>n)&&(i=n),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return x(this,e,t,i);case"utf8":case"utf-8":return _(this,e,t,i);case"ascii":case"latin1":case"binary":return E(this,e,t,i);case"base64":return A(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function C(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(127&e[n]);return r}function P(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(e[n]);return r}function D(e,t,i){var r=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>r)&&(i=r);for(var n="",o=t;o<i;++o)n+=H[e[o]];return n}function L(e,t,i){for(var r=e.slice(t,i),n="",o=0;o<r.length-1;o+=2)n+=String.fromCharCode(r[o]+256*r[o+1]);return n}function I(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,i,r,n,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function O(e,t,i,r,n,o){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function N(e,t,i,r,o){return t=+t,i>>>=0,o||O(e,0,i,4),n.write(e,t,i,r,23,4),i+4}function F(e,t,i,r,o){return t=+t,i>>>=0,o||O(e,0,i,8),n.write(e,t,i,r,52,8),i+8}l.prototype.slice=function(e,t){var i=this.length;(e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||I(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||I(e,t,this.length);for(var r=this[e+--t],n=1;t>0&&(n*=256);)r+=this[e+--t]*n;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||I(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||I(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||I(e,t,this.length);for(var r=t,n=1,o=this[e+--r];r>0&&(n*=256);)o+=this[e+--r]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||I(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(e,t){e>>>=0,t||I(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||I(e,4,this.length),n.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||I(e,4,this.length),n.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||I(e,8,this.length),n.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||I(e,8,this.length),n.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,i,r){(e=+e,t>>>=0,i>>>=0,r)||R(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[t]=255&e;++o<i&&(n*=256);)this[t+o]=e/n&255;return t+i},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,i,r){(e=+e,t>>>=0,i>>>=0,r)||R(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+i},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t>>>=0,!r){var n=Math.pow(2,8*i-1);R(this,e,t,i,n-1,-n)}var o=0,s=1,a=0;for(this[t]=255&e;++o<i&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},l.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t>>>=0,!r){var n=Math.pow(2,8*i-1);R(this,e,t,i,n-1,-n)}var o=i-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},l.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,i){return N(this,e,t,!0,i)},l.prototype.writeFloatBE=function(e,t,i){return N(this,e,t,!1,i)},l.prototype.writeDoubleLE=function(e,t,i){return F(this,e,t,!0,i)},l.prototype.writeDoubleBE=function(e,t,i){return F(this,e,t,!1,i)},l.prototype.copy=function(e,t,i,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var n=r-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,r):Uint8Array.prototype.set.call(e,this.subarray(i,r),t),n},l.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var n=e.charCodeAt(0);("utf8"===r&&n<128||"latin1"===r)&&(e=n)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var o;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(o=t;o<i;++o)this[o]=e;else{var s=l.isBuffer(e)?e:l.from(e,r),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<i-t;++o)this[o+t]=s[o%a]}return this};var k=/[^+/0-9A-Za-z-_]/g;function V(e,t){var i;t=t||1/0;for(var r=e.length,n=null,o=[],s=0;s<r;++s){if((i=e.charCodeAt(s))>55295&&i<57344){if(!n){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}n=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function U(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function z(e){return e!=e}var H=function(){for(var e="0123456789abcdef",t=new Array(256),i=0;i<16;++i)for(var r=16*i,n=0;n<16;++n)t[r+n]=e[i]+e[n];return t}()},24414:function(e,t,i){"use strict";var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(33242),s=i(5076);t.backOff=function(e,t){return void 0===t&&(t={}),r(this,void 0,void 0,(function(){var i;return n(this,(function(r){switch(r.label){case 0:return i=o.getSanitizedOptions(t),[4,new a(e,i).execute()];case 1:return[2,r.sent()]}}))}))};var a=function(){function e(e,t){this.request=e,this.options=t,this.attemptNumber=0}return e.prototype.execute=function(){return r(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:if(this.attemptLimitReached)return[3,7];t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.applyDelay()];case 2:return t.sent(),[4,this.request()];case 3:return[2,t.sent()];case 4:return e=t.sent(),this.attemptNumber++,[4,this.options.retry(e,this.attemptNumber)];case 5:if(!t.sent()||this.attemptLimitReached)throw e;return[3,6];case 6:return[3,0];case 7:throw new Error("Something went wrong.")}}))}))},Object.defineProperty(e.prototype,"attemptLimitReached",{get:function(){return this.attemptNumber>=this.options.numOfAttempts},enumerable:!0,configurable:!0}),e.prototype.applyDelay=function(){return r(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,s.DelayFactory(this.options,this.attemptNumber).apply()];case 1:return e.sent(),[2]}}))}))},e}()},79966:function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i(21617).Delay);t.AlwaysDelay=o},21617:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(16755),n=function(){function e(e){this.options=e,this.attempt=0}return e.prototype.apply=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.jitteredDelay)}))},e.prototype.setAttemptNumber=function(e){this.attempt=e},Object.defineProperty(e.prototype,"jitteredDelay",{get:function(){return r.JitterFactory(this.options)(this.delay)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"delay",{get:function(){var e=this.options.startingDelay,t=this.options.timeMultiple,i=this.numOfDelayedAttempts,r=e*Math.pow(t,i);return Math.min(r,this.options.maxDelay)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numOfDelayedAttempts",{get:function(){return this.attempt},enumerable:!0,configurable:!0}),e}();t.Delay=n},5076:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(21954),n=i(79966);t.DelayFactory=function(e,t){var i=function(e){if(!e.delayFirstAttempt)return new r.SkipFirstDelay(e);return new n.AlwaysDelay(e)}(e);return i.setAttemptNumber(t),i}},21954:function(e,t,i){"use strict";var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),o=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.apply=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,!!this.isFirstAttempt||e.prototype.apply.call(this)]}))}))},Object.defineProperty(t.prototype,"isFirstAttempt",{get:function(){return 0===this.attempt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numOfDelayedAttempts",{get:function(){return this.attempt-1},enumerable:!0,configurable:!0}),t}(i(21617).Delay);t.SkipFirstDelay=a},59813:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fullJitter=function(e){var t=Math.random()*e;return Math.round(t)}},16755:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(59813),n=i(20478);t.JitterFactory=function(e){return"full"===e.jitter?r.fullJitter:n.noJitter}},20478:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noJitter=function(e){return e}},33242:function(e,t){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r={delayFirstAttempt:!1,jitter:"none",maxDelay:1/0,numOfAttempts:10,retry:function(){return!0},startingDelay:100,timeMultiple:2};t.getSanitizedOptions=function(e){var t=i(i({},r),e);return t.numOfAttempts<1&&(t.numOfAttempts=1),t}},68203:function(e,t){var i="undefined"!=typeof self?self:this,r=function(){function e(){this.fetch=!1,this.DOMException=i.DOMException}return e.prototype=i,new e}();!function(e){!function(t){var i="URLSearchParams"in e,r="Symbol"in e&&"iterator"in Symbol,n="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in e,s="ArrayBuffer"in e;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function f(e){return new Promise((function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}}))}function m(e){var t=new FileReader,i=f(t);return t.readAsArrayBuffer(e),i}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:n&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&n&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var e,t,i,r=p(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,i=f(t),t.readAsText(e),i;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),i=new Array(t.length),r=0;r<t.length;r++)i[r]=String.fromCharCode(t[r]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=h(e),t=c(t);var i=this.map[e];this.map[e]=i?i+", "+t:t},d.prototype.delete=function(e){delete this.map[h(e)]},d.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},d.prototype.set=function(e,t){this.map[h(e)]=c(t)},d.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,i){e.push(i)})),u(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,i){e.push([i,t])})),u(e)},r&&(d.prototype[Symbol.iterator]=d.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e,t){var i,r,n=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(i=t.method||this.method||"GET",r=i.toUpperCase(),y.indexOf(r)>-1?r:i),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function x(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var i=e.split("="),r=i.shift().replace(/\+/g," "),n=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(n))}})),t}function _(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},v.call(b.prototype),v.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},_.error=function(){var e=new _(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];_.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new _(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function A(e,i){return new Promise((function(r,o){var s=new b(e,i);if(s.signal&&s.signal.aborted)return o(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function l(){a.abort()}a.onload=function(){var e,t,i={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var i=e.split(":"),r=i.shift().trim();if(r){var n=i.join(":").trim();t.append(r,n)}})),t)};i.url="responseURL"in a?a.responseURL:i.headers.get("X-Request-URL");var n="response"in a?a.response:a.responseText;r(new _(n,i))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.onabort=function(){o(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&n&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",l),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",l)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}A.polyfill=!0,e.fetch||(e.fetch=A,e.Headers=d,e.Request=b,e.Response=_),t.Headers=d,t.Request=b,t.Response=_,t.fetch=A,Object.defineProperty(t,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var n=r;(t=n.fetch).default=n.fetch,t.fetch=n.fetch,t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response,e.exports=t},91493:(e,t,i)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}function o(e,t,i){return(t=n(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),r.forEach((function(t){o(e,t,i[t])}))}return e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function h(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}i.d(t,{Z:()=>H});var m={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},g=new(function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,e),this.init(t,i)}return h(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||m,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,i,r){return r&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(i).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,s({},{prefix:"".concat(this.prefix,":").concat(t,":")},this.options))}}]),e}()),v=function(){function e(){a(this,e),this.observers={}}return h(e,[{key:"on",value:function(e,t){var i=this;return e.split(" ").forEach((function(e){i.observers[e]=i.observers[e]||[],i.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,i)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(i))}))}}]),e}();function y(){var e,t,i=new Promise((function(i,r){e=i,t=r}));return i.resolve=e,i.reject=t,i}function b(e){return null==e?"":""+e}function x(e,t,i){function r(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function n(){return!e||"string"==typeof e}for(var o="string"!=typeof t?[].concat(t):t.split(".");o.length>1;){if(n())return{};var s=r(o.shift());!e[s]&&i&&(e[s]=new i),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return n()?{}:{obj:e,k:r(o.shift())}}function _(e,t,i){var r=x(e,t,Object);r.obj[r.k]=i}function E(e,t){var i=x(e,t),r=i.obj,n=i.k;if(r)return r[n]}function A(e,t,i){var r=E(e,i);return void 0!==r?r:E(t,i)}function S(e,t,i){for(var r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?"string"==typeof e[r]||e[r]instanceof String||"string"==typeof t[r]||t[r]instanceof String?i&&(e[r]=t[r]):S(e[r],t[r],i):e[r]=t[r]);return e}function w(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function T(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return M[e]})):e}var C="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1;function P(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var r=t.split(i),n=e,o=0;o<r.length;++o){if(!n)return;if("string"==typeof n[r[o]]&&o+1<r.length)return;if(void 0===n[r[o]]){for(var s=2,a=r.slice(o,o+s).join(i),l=n[a];void 0===l&&r.length>o+s;)s++,l=n[a=r.slice(o,o+s).join(i)];if(void 0===l)return;if("string"==typeof l)return l;if(a&&"string"==typeof l[a])return l[a];var h=r.slice(o+s).join(i);return h?P(l,h,i):void 0}n=n[r[o]]}return n}}var D=function(e){function t(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return a(this,t),i=u(this,d(t).call(this)),C&&v.call(c(i)),i.data=e||{},i.options=r,void 0===i.options.keySeparator&&(i.options.keySeparator="."),void 0===i.options.ignoreJSONStructure&&(i.options.ignoreJSONStructure=!0),i}return f(t,e),h(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,o=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure,s=[e,t];i&&"string"!=typeof i&&(s=s.concat(i)),i&&"string"==typeof i&&(s=s.concat(n?i.split(n):i)),e.indexOf(".")>-1&&(s=e.split("."));var a=E(this.data,s);return a||!o||"string"!=typeof i?a:P(this.data&&this.data[e]&&this.data[e][t],i,n)}},{key:"addResource",value:function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=this.options.keySeparator;void 0===o&&(o=".");var s=[e,t];i&&(s=s.concat(o?i.split(o):i)),e.indexOf(".")>-1&&(r=t,t=(s=e.split("."))[1]),this.addNamespaces(t),_(this.data,s,r),n.silent||this.emit("added",e,t,i,r)}},{key:"addResources",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var n in i)"string"!=typeof i[n]&&"[object Array]"!==Object.prototype.toString.apply(i[n])||this.addResource(e,t,n,i[n],{silent:!0});r.silent||this.emit("added",e,t,i)}},{key:"addResourceBundle",value:function(e,t,i,r,n){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},a=[e,t];e.indexOf(".")>-1&&(r=i,i=t,t=(a=e.split("."))[1]),this.addNamespaces(t);var l=E(this.data,a)||{};r?S(l,i,n):l=s({},l,i),_(this.data,a,l),o.silent||this.emit("added",e,t,i)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?s({},{},this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"toJSON",value:function(){return this.data}}]),t}(v),L={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,i,r,n){var o=this;return e.forEach((function(e){o.processors[e]&&(t=o.processors[e].process(t,i,r,n))})),t}},I={},R=function(e){function t(e){var i,r,n,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a(this,t),i=u(this,d(t).call(this)),C&&v.call(c(i)),r=["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],n=e,o=c(i),r.forEach((function(e){n[e]&&(o[e]=n[e])})),i.options=s,void 0===i.options.keySeparator&&(i.options.keySeparator="."),i.logger=g.create("translator"),i}return f(t,e),h(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var i=this.resolve(e,t);return i&&void 0!==i.res}},{key:"extractFromKey",value:function(e,t){var i=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===i&&(i=":");var r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,n=t.ns||this.options.defaultNS;if(i&&e.indexOf(i)>-1){var o=e.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:e,namespaces:n};var s=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(s[0])>-1)&&(n=s.shift()),e=s.join(r)}return"string"==typeof n&&(n=[n]),{key:e,namespaces:n}}},{key:"translate",value:function(e,i,n){var o=this;if("object"!==r(i)&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),i||(i={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var a=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,l=this.extractFromKey(e[e.length-1],i),h=l.key,c=l.namespaces,u=c[c.length-1],d=i.lng||this.language,p=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d&&"cimode"===d.toLowerCase()){if(p){var f=i.nsSeparator||this.options.nsSeparator;return u+f+h}return h}var m=this.resolve(e,i),g=m&&m.res,v=m&&m.usedKey||h,y=m&&m.exactUsedKey||h,b=Object.prototype.toString.apply(g),x=void 0!==i.joinArrays?i.joinArrays:this.options.joinArrays,_=!this.i18nFormat||this.i18nFormat.handleAsObject;if(_&&g&&("string"!=typeof g&&"boolean"!=typeof g&&"number"!=typeof g)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(b)<0&&("string"!=typeof x||"[object Array]"!==b)){if(!i.returnObjects&&!this.options.returnObjects)return this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(v,g,s({},i,{ns:c})):"key '".concat(h," (").concat(this.language,")' returned an object instead of string.");if(a){var E="[object Array]"===b,A=E?[]:{},S=E?y:v;for(var w in g)if(Object.prototype.hasOwnProperty.call(g,w)){var M="".concat(S).concat(a).concat(w);A[w]=this.translate(M,s({},i,{joinArrays:!1,ns:c})),A[w]===M&&(A[w]=g[w])}g=A}}else if(_&&"string"==typeof x&&"[object Array]"===b)(g=g.join(x))&&(g=this.extendTranslation(g,e,i,n));else{var T=!1,C=!1,P=void 0!==i.count&&"string"!=typeof i.count,D=t.hasDefaultValue(i),L=P?this.pluralResolver.getSuffix(d,i.count):"",I=i["defaultValue".concat(L)]||i.defaultValue;!this.isValidLookup(g)&&D&&(T=!0,g=I),this.isValidLookup(g)||(C=!0,g=h);var R=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&C?void 0:g,O=D&&I!==g&&this.options.updateMissing;if(C||T||O){if(this.logger.log(O?"updateKey":"missingKey",d,u,h,O?I:g),a){var N=this.resolve(h,s({},i,{keySeparator:!1}));N&&N.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var F=[],k=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if("fallback"===this.options.saveMissingTo&&k&&k[0])for(var V=0;V<k.length;V++)F.push(k[V]);else"all"===this.options.saveMissingTo?F=this.languageUtils.toResolveHierarchy(i.lng||this.language):F.push(i.lng||this.language);var U=function(e,t,r){o.options.missingKeyHandler?o.options.missingKeyHandler(e,u,t,O?r:R,O,i):o.backendConnector&&o.backendConnector.saveMissing&&o.backendConnector.saveMissing(e,u,t,O?r:R,O,i),o.emit("missingKey",e,u,t,g)};this.options.saveMissing&&(this.options.saveMissingPlurals&&P?F.forEach((function(e){o.pluralResolver.getSuffixes(e).forEach((function(t){U([e],h+t,i["defaultValue".concat(t)]||I)}))})):U(F,h,I))}g=this.extendTranslation(g,e,i,m,n),C&&g===h&&this.options.appendNamespaceToMissingKey&&(g="".concat(u,":").concat(h)),(C||T)&&this.options.parseMissingKeyHandler&&(g=this.options.parseMissingKeyHandler(g))}return g}},{key:"extendTranslation",value:function(e,t,i,r,n){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,i,r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init(s({},i,{interpolation:s({},this.options.interpolation,i.interpolation)}));var a,l=i.interpolation&&i.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;if(l){var h=e.match(this.interpolator.nestingRegexp);a=h&&h.length}var c=i.replace&&"string"!=typeof i.replace?i.replace:i;if(this.options.interpolation.defaultVariables&&(c=s({},this.options.interpolation.defaultVariables,c)),e=this.interpolator.interpolate(e,c,i.lng||this.language,i),l){var u=e.match(this.interpolator.nestingRegexp);a<(u&&u.length)&&(i.nest=!1)}!1!==i.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return n&&n[0]===r[0]&&!i.context?(o.logger.warn("It seems you are nesting recursively key: ".concat(r[0]," in key: ").concat(t[0])),null):o.translate.apply(o,r.concat([t]))}),i)),i.interpolation&&this.interpolator.reset()}var d=i.postProcess||this.options.postProcess,p="string"==typeof d?[d]:d;return null!=e&&p&&p.length&&!1!==i.applyPostProcessor&&(e=L.handle(p,e,t,this.options&&this.options.postProcessPassResolved?s({i18nResolved:r},i):i,this)),e}},{key:"resolve",value:function(e){var t,i,r,n,o,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var l=s.extractFromKey(e,a),h=l.key;i=h;var c=l.namespaces;s.options.fallbackNS&&(c=c.concat(s.options.fallbackNS));var u=void 0!==a.count&&"string"!=typeof a.count,d=void 0!==a.context&&("string"==typeof a.context||"number"==typeof a.context)&&""!==a.context,p=a.lngs?a.lngs:s.languageUtils.toResolveHierarchy(a.lng||s.language,a.fallbackLng);c.forEach((function(e){s.isValidLookup(t)||(o=e,!I["".concat(p[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(o)&&(I["".concat(p[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(i,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(o,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((function(i){if(!s.isValidLookup(t)){n=i;var o,l,c=h,p=[c];if(s.i18nFormat&&s.i18nFormat.addLookupKeys)s.i18nFormat.addLookupKeys(p,h,i,e,a);else u&&(o=s.pluralResolver.getSuffix(i,a.count)),u&&d&&p.push(c+o),d&&p.push(c+="".concat(s.options.contextSeparator).concat(a.context)),u&&p.push(c+=o);for(;l=p.pop();)s.isValidLookup(t)||(r=l,t=s.getResource(i,e,l,a))}})))}))}})),{res:t,usedKey:i,exactUsedKey:r,usedLng:n,usedNS:o}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,12)&&void 0!==e[i])return!0;return!1}}]),t}(v);function O(e){return e.charAt(0).toUpperCase()+e.slice(1)}var N=function(){function e(t){a(this,e),this.options=t,this.whitelist=this.options.supportedLngs||!1,this.supportedLngs=this.options.supportedLngs||!1,this.logger=g.create("languageUtils")}return h(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],i=e.split("-");return this.options.lowerCaseLng?i=i.map((function(e){return e.toLowerCase()})):2===i.length?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=O(i[1].toLowerCase()))):3===i.length&&(i[0]=i[0].toLowerCase(),2===i[1].length&&(i[1]=i[1].toUpperCase()),"sgn"!==i[0]&&2===i[2].length&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=O(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=O(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isWhitelisted",value:function(e){return this.logger.deprecate("languageUtils.isWhitelisted",'function "isWhitelisted" will be renamed to "isSupportedCode" in the next major - please make sure to rename it\'s usage asap.'),this.isSupportedCode(e)}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,i=this;return e?(e.forEach((function(e){if(!t){var r=i.formatLanguageCode(e);i.options.supportedLngs&&!i.isSupportedCode(r)||(t=r)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var r=i.getLanguagePartFromCode(e);if(i.isSupportedCode(r))return t=r;t=i.options.supportedLngs.find((function(e){if(0===e.indexOf(r))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}},{key:"toResolveHierarchy",value:function(e,t){var i=this,r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),n=[],o=function(e){e&&(i.isSupportedCode(e)?n.push(e):i.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&o(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&o(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&o(this.getLanguagePartFromCode(e))):"string"==typeof e&&o(this.formatLanguageCode(e)),r.forEach((function(e){n.indexOf(e)<0&&o(i.formatLanguageCode(e))})),n}}]),e}(),F=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],k={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};var V=function(){function e(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,e),this.languageUtils=t,this.options=r,this.logger=g.create("pluralResolver"),this.rules=(i={},F.forEach((function(e){e.lngs.forEach((function(t){i[t]={numbers:e.nr,plurals:k[e.fc]}}))})),i)}return h(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=this.getRule(e);return t&&t.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){return this.getSuffixes(e).map((function(e){return t+e}))}},{key:"getSuffixes",value:function(e){var t=this,i=this.getRule(e);return i?i.numbers.map((function(i){return t.getSuffix(e,i)})):[]}},{key:"getSuffix",value:function(e,t){var i=this,r=this.getRule(e);if(r){var n=r.noAbs?r.plurals(t):r.plurals(Math.abs(t)),o=r.numbers[n];this.options.simplifyPluralSuffix&&2===r.numbers.length&&1===r.numbers[0]&&(2===o?o="plural":1===o&&(o=""));var s=function(){return i.options.prepend&&o.toString()?i.options.prepend+o.toString():o.toString()};return"v1"===this.options.compatibilityJSON?1===o?"":"number"==typeof o?"_plural_".concat(o.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===r.numbers.length&&1===r.numbers[0]?s():this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString()}return this.logger.warn("no plural rule found for: ".concat(e)),""}}]),e}(),U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.logger=g.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return h(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:T,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?w(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?w(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?w(t.nestingPrefix):t.nestingPrefixEscaped||w("$t("),this.nestingSuffix=t.nestingSuffix?w(t.nestingSuffix):t.nestingSuffixEscaped||w(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var i="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(i,"g")}},{key:"interpolate",value:function(e,t,i,r){var n,o,a,l=this,h=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function c(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(l.formatSeparator)<0){var n=A(t,h,e);return l.alwaysFormat?l.format(n,void 0,i,s({},r,t,{interpolationkey:e})):n}var o=e.split(l.formatSeparator),a=o.shift().trim(),c=o.join(l.formatSeparator).trim();return l.format(A(t,h,a),c,i,s({},r,t,{interpolationkey:a}))};this.resetRegExp();var d=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,p=r&&r.interpolation&&r.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return c(e)}},{regex:this.regexp,safeValue:function(e){return l.escapeValue?c(l.escape(e)):c(e)}}].forEach((function(t){for(a=0;n=t.regex.exec(e);){if(void 0===(o=u(n[1].trim())))if("function"==typeof d){var i=d(e,n,r);o="string"==typeof i?i:""}else{if(p){o=n[0];continue}l.logger.warn("missed to pass in variable ".concat(n[1]," for interpolating ").concat(e)),o=""}else"string"==typeof o||l.useRawValueToEscape||(o=b(o));var s=t.safeValue(o);if(e=e.replace(n[0],s),p?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=n[0].length):t.regex.lastIndex=0,++a>=l.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var i,r,n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s({},o);function l(e,t){var i=this.nestingOptionsSeparator;if(e.indexOf(i)<0)return e;var r=e.split(new RegExp("".concat(i,"[ ]*{"))),n="{".concat(r[1]);e=r[0],n=(n=this.interpolate(n,a)).replace(/'/g,'"');try{a=JSON.parse(n),t&&(a=s({},t,a))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(i).concat(n)}return delete a.defaultValue,e}for(a.applyPostProcessor=!1,delete a.defaultValue;i=this.nestingRegexp.exec(e);){var h=[],c=!1;if(-1!==i[0].indexOf(this.formatSeparator)&&!/{.*}/.test(i[1])){var u=i[1].split(this.formatSeparator).map((function(e){return e.trim()}));i[1]=u.shift(),h=u,c=!0}if((r=t(l.call(this,i[1].trim(),a),a))&&i[0]===e&&"string"!=typeof r)return r;"string"!=typeof r&&(r=b(r)),r||(this.logger.warn("missed to resolve ".concat(i[1]," for nesting ").concat(e)),r=""),c&&(r=h.reduce((function(e,t){return n.format(e,t,o.lng,s({},o,{interpolationkey:i[1].trim()}))}),r.trim())),e=e.replace(i[0],r),this.regexp.lastIndex=0}return e}}]),e}();var B=function(e){function t(e,i,r){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return a(this,t),n=u(this,d(t).call(this)),C&&v.call(c(n)),n.backend=e,n.store=i,n.services=r,n.languageUtils=r.languageUtils,n.options=o,n.logger=g.create("backendConnector"),n.state={},n.queue=[],n.backend&&n.backend.init&&n.backend.init(r,o.backend,o),n}return f(t,e),h(t,[{key:"queueLoad",value:function(e,t,i,r){var n=this,o=[],s=[],a=[],l=[];return e.forEach((function(e){var r=!0;t.forEach((function(t){var a="".concat(e,"|").concat(t);!i.reload&&n.store.hasResourceBundle(e,t)?n.state[a]=2:n.state[a]<0||(1===n.state[a]?s.indexOf(a)<0&&s.push(a):(n.state[a]=1,r=!1,s.indexOf(a)<0&&s.push(a),o.indexOf(a)<0&&o.push(a),l.indexOf(t)<0&&l.push(t)))})),r||a.push(e)})),(o.length||s.length)&&this.queue.push({pending:s,loaded:{},errors:[],callback:r}),{toLoad:o,pending:s,toLoadLanguages:a,toLoadNamespaces:l}}},{key:"loaded",value:function(e,t,i){var r=e.split("|"),n=r[0],o=r[1];t&&this.emit("failedLoading",n,o,t),i&&this.store.addResourceBundle(n,o,i),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(i){var r,a,l,h,c,u;r=i.loaded,a=o,h=x(r,[n],Object),c=h.obj,u=h.k,c[u]=c[u]||[],l&&(c[u]=c[u].concat(a)),l||c[u].push(a),function(e,t){for(var i=e.indexOf(t);-1!==i;)e.splice(i,1),i=e.indexOf(t)}(i.pending,e),t&&i.errors.push(t),0!==i.pending.length||i.done||(Object.keys(i.loaded).forEach((function(e){s[e]||(s[e]=[]),i.loaded[e].length&&i.loaded[e].forEach((function(t){s[e].indexOf(t)<0&&s[e].push(t)}))})),i.done=!0,i.errors.length?i.callback(i.errors):i.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,i){var r=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,s=arguments.length>5?arguments[5]:void 0;return e.length?this.backend[i](e,t,(function(a,l){a&&l&&n<5?setTimeout((function(){r.read.call(r,e,t,i,n+1,2*o,s)}),o):s(a,l)})):s(null,{})}},{key:"prepareLoading",value:function(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var o=this.queueLoad(e,t,r,n);if(!o.toLoad.length)return o.pending.length||n(),null;o.toLoad.forEach((function(e){i.loadOne(e)}))}},{key:"load",value:function(e,t,i){this.prepareLoading(e,t,{},i)}},{key:"reload",value:function(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}},{key:"loadOne",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.split("|"),n=r[0],o=r[1];this.read(n,o,"read",void 0,void 0,(function(r,s){r&&t.logger.warn("".concat(i,"loading namespace ").concat(o," for language ").concat(n," failed"),r),!r&&s&&t.logger.log("".concat(i,"loaded namespace ").concat(o," for language ").concat(n),s),t.loaded(e,r,s)}))}},{key:"saveMissing",value:function(e,t,i,r,n){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(i,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=i&&""!==i&&(this.backend&&this.backend.create&&this.backend.create(e,t,i,r,null,s({},o,{isUpdate:n})),e&&e[0]&&this.store.addResource(e[0],t,i,r))}}]),t}(v);function G(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&(e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e.supportedLngs=e.whitelist),e.nonExplicitWhitelist&&(e.nonExplicitSupportedLngs=e.nonExplicitWhitelist),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function z(){}const H=new(function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;if(a(this,t),e=u(this,d(t).call(this)),C&&v.call(c(e)),e.options=G(i),e.services={},e.logger=g,e.modules={external:[]},r&&!e.isInitialized&&!i.isClone){if(!e.options.initImmediate)return e.init(i,r),u(e,c(e));setTimeout((function(){e.init(i,r)}),0)}return e}return f(t,e),h(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;function n(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof t&&(i=t,t={}),t.whitelist&&!t.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),t.nonExplicitWhitelist&&!t.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options=s({},{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===r(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===r(e[2])||"object"===r(e[3])){var i=e[3]||e[2];Object.keys(i).forEach((function(e){t[e]=i[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,i,r){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!1}},this.options,G(t)),this.format=this.options.interpolation.format,i||(i=z),!this.options.isClone){this.modules.logger?g.init(n(this.modules.logger),this.options):g.init(null,this.options);var o=new N(this.options);this.store=new D(this.options.resources,this.options);var a=this.services;a.logger=g,a.resourceStore=this.store,a.languageUtils=o,a.pluralResolver=new V(o,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),a.interpolator=new U(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new B(n(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",(function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e.emit.apply(e,[t].concat(r))})),this.modules.languageDetector&&(a.languageDetector=n(this.modules.languageDetector),a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=n(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new R(this.services,this.options),this.translator.on("*",(function(t){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e.emit.apply(e,[t].concat(r))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var i;return(i=e.store)[t].apply(i,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var i;return(i=e.store)[t].apply(i,arguments),e}}));var h=y(),c=function(){var t=function(t,r){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),h.resolve(r),i(t,r)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?c():setTimeout(c,0),h}},{key:"loadResources",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z,r="string"==typeof e?e:this.language;if("function"==typeof e&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return i();var n=[],o=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){n.indexOf(e)<0&&n.push(e)}))};if(r)o(r);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return o(e)}));this.options.preload&&this.options.preload.forEach((function(e){return o(e)})),this.services.backendConnector.load(n,this.options.ns,i)}else i(null)}},{key:"reloadResources",value:function(e,t,i){var r=y();return e||(e=this.languages),t||(t=this.options.ns),i||(i=z),this.services.backendConnector.reload(e,t,(function(e){r.resolve(),i(e)})),r}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&L.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"changeLanguage",value:function(e,t){var i=this;this.isLanguageChangingTo=e;var r=y();this.emit("languageChanging",e);var n=function(n){e||n||!i.services.languageDetector||(n=[]);var o="string"==typeof n?n:i.services.languageUtils.getBestMatchFromCodes(n);o&&(i.language||(i.language=o,i.languages=i.services.languageUtils.toResolveHierarchy(o)),i.translator.language||i.translator.changeLanguage(o),i.services.languageDetector&&i.services.languageDetector.cacheUserLanguage(o)),i.loadResources(o,(function(e){!function(e,n){n?(i.language=n,i.languages=i.services.languageUtils.toResolveHierarchy(n),i.translator.changeLanguage(n),i.isLanguageChangingTo=void 0,i.emit("languageChanged",n),i.logger.log("languageChanged",n)):i.isLanguageChangingTo=void 0,r.resolve((function(){return i.t.apply(i,arguments)})),t&&t(e,(function(){return i.t.apply(i,arguments)}))}(e,o)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(n):n(e):n(this.services.languageDetector.detect()),r}},{key:"getFixedT",value:function(e,t,i){var n=this,o=function e(t,o){var a;if("object"!==r(o)){for(var l=arguments.length,h=new Array(l>2?l-2:0),c=2;c<l;c++)h[c-2]=arguments[c];a=n.options.overloadTranslationOptionHandler([t,o].concat(h))}else a=s({},o);a.lng=a.lng||e.lng,a.lngs=a.lngs||e.lngs,a.ns=a.ns||e.ns;var u=n.options.keySeparator||".",d=i?"".concat(i).concat(u).concat(t):t;return n.t(d,a)};return"string"==typeof e?o.lng=e:o.lngs=e,o.ns=t,o.keyPrefix=i,o}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var r=this.languages[0],n=!!this.options&&this.options.fallbackLng,o=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;var s=function(e,i){var r=t.services.backendConnector.state["".concat(e,"|").concat(i)];return-1===r||2===r};if(i.precheck){var a=i.precheck(this,s);if(void 0!==a)return a}return!!this.hasResourceBundle(r,e)||(!this.services.backendConnector.backend||!(!s(r,e)||n&&!s(o,e)))}},{key:"loadNamespaces",value:function(e,t){var i=this,r=y();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){i.options.ns.indexOf(e)<0&&i.options.ns.push(e)})),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var i=y();"string"==typeof e&&(e=[e]);var r=this.options.preload||[],n=e.filter((function(e){return r.indexOf(e)<0}));return n.length?(this.options.preload=r.concat(n),this.loadResources((function(e){i.resolve(),t&&t(e)})),i):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr"}},{key:"createInstance",value:function(){return new t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}},{key:"cloneInstance",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z,n=s({},this.options,i,{isClone:!0}),o=new t(n);return["store","services","language"].forEach((function(t){o[t]=e[t]})),o.services=s({},this.services),o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o.translator=new R(o.services,o.options),o.translator.on("*",(function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];o.emit.apply(o,[e].concat(i))})),o.init(n,r),o.translator.options=o.options,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages}}}]),t}(v))},80645:(e,t)=>{t.read=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,h=l>>1,c=-7,u=i?n-1:0,d=i?-1:1,p=e[t+u];for(u+=d,o=p&(1<<-c)-1,p>>=-c,c+=a;c>0;o=256*o+e[t+u],u+=d,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;c>0;s=256*s+e[t+u],u+=d,c-=8);if(0===o)o=1-h;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=h}return(p?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,i,r,n,o){var s,a,l,h=8*o-n-1,c=(1<<h)-1,u=c>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=c?(a=0,s=c):s+u>=1?(a=(t*l-1)*Math.pow(2,n),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,n),s=0));n>=8;e[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;e[i+p]=255&s,p+=f,s/=256,h-=8);e[i+p-f]|=128*m}},62705:(e,t,i)=>{var r=i(55639).Symbol;e.exports=r},44239:(e,t,i)=>{var r=i(62705),n=i(89607),o=i(2333),s=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?n(e):o(e)}},27561:(e,t,i)=>{var r=i(67990),n=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(n,""):e}},31957:(e,t,i)=>{var r="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;e.exports=r},89607:(e,t,i)=>{var r=i(62705),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),i=e[a];try{e[a]=void 0;var r=!0}catch(e){}var n=s.call(e);return r&&(t?e[a]=i:delete e[a]),n}},2333:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},55639:(e,t,i)=>{var r=i(31957),n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")();e.exports=o},67990:e=>{var t=/\s/;e.exports=function(e){for(var i=e.length;i--&&t.test(e.charAt(i)););return i}},23279:(e,t,i)=>{var r=i(13218),n=i(7771),o=i(14841),s=Math.max,a=Math.min;e.exports=function(e,t,i){var l,h,c,u,d,p,f=0,m=!1,g=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var i=l,r=h;return l=h=void 0,f=t,u=e.apply(r,i)}function b(e){var i=e-p;return void 0===p||i>=t||i<0||g&&e-f>=c}function x(){var e=n();if(b(e))return _(e);d=setTimeout(x,function(e){var i=t-(e-p);return g?a(i,c-(e-f)):i}(e))}function _(e){return d=void 0,v&&l?y(e):(l=h=void 0,u)}function E(){var e=n(),i=b(e);if(l=arguments,h=this,p=e,i){if(void 0===d)return function(e){return f=e,d=setTimeout(x,t),m?y(e):u}(p);if(g)return clearTimeout(d),d=setTimeout(x,t),y(p)}return void 0===d&&(d=setTimeout(x,t)),u}return t=o(t)||0,r(i)&&(m=!!i.leading,c=(g="maxWait"in i)?s(o(i.maxWait)||0,t):c,v="trailing"in i?!!i.trailing:v),E.cancel=function(){void 0!==d&&clearTimeout(d),f=0,l=p=h=d=void 0},E.flush=function(){return void 0===d?u:_(n())},E}},13218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},37005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},33448:(e,t,i)=>{var r=i(44239),n=i(37005);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==r(e)}},7771:(e,t,i)=>{var r=i(55639);e.exports=function(){return r.Date.now()}},14841:(e,t,i)=>{var r=i(27561),n=i(13218),o=i(33448),s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,l=/^0o[0-7]+$/i,h=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var i=a.test(e);return i||l.test(e)?h(e.slice(2),i?2:8):s.test(e)?NaN:+e}},79916:e=>{function t(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}function i(e){e.pending+=1;var t=!1;return function(n){if(t)throw new Error("callback called twice");if(t=!0,e.error=e.error||n,e.pending-=1,e.waiting.length>0&&e.pending<e.max)r(e,e.waiting.shift());else if(0===e.pending){var o=e.listeners;e.listeners=[],o.forEach(i)}};function i(t){t(e.error)}}function r(e,t){t(i(e))}e.exports=t,t.prototype.go=function(e){this.pending<this.max?r(this,e):this.waiting.push(e)},t.prototype.wait=function(e){0===this.pending?e(this.error):this.listeners.push(e)},t.prototype.hold=function(){return i(this)}},62587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,i,r,n){i=i||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(i);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var h=0;h<l;++h){var c,u,d,p,f=e[h].replace(s,"%20"),m=f.indexOf(r);m>=0?(c=f.substr(0,m),u=f.substr(m+1)):(c=f,u=""),d=decodeURIComponent(c),p=decodeURIComponent(u),t(o,d)?Array.isArray(o[d])?o[d].push(p):o[d]=[o[d],p]:o[d]=p}return o}},12361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,r,n){return i=i||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(n){var o=encodeURIComponent(t(n))+r;return Array.isArray(e[n])?e[n].map((function(e){return o+encodeURIComponent(t(e))})).join(i):o+encodeURIComponent(t(e[n]))})).join(i):n?encodeURIComponent(t(n))+r+encodeURIComponent(t(e)):""}},17673:(e,t,i)=>{"use strict";t.decode=t.parse=i(62587),t.encode=t.stringify=i(12361)},52511:function(e,t,i){var r;/*! https://mths.be/punycode v1.3.2 by @mathias */e=i.nmd(e),function(n){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof i.g&&i.g;o.global!==o&&o.window!==o&&o.self;var s,a=2147483647,l=36,h=1,c=26,u=38,d=700,p=72,f=128,m="-",g=/^xn--/,v=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=l-h,_=Math.floor,E=String.fromCharCode;function A(e){throw RangeError(b[e])}function S(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}function w(e,t){var i=e.split("@"),r="";return i.length>1&&(r=i[0]+"@",e=i[1]),r+S((e=e.replace(y,".")).split("."),t).join(".")}function M(e){for(var t,i,r=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--):r.push(t);return r}function T(e){return S(e,(function(e){var t="";return e>65535&&(t+=E((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=E(e)})).join("")}function C(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function P(e,t,i){var r=0;for(e=i?_(e/d):e>>1,e+=_(e/t);e>x*c>>1;r+=l)e=_(e/x);return _(r+(x+1)*e/(e+u))}function D(e){var t,i,r,n,o,s,u,d,g,v,y,b=[],x=e.length,E=0,S=f,w=p;for((i=e.lastIndexOf(m))<0&&(i=0),r=0;r<i;++r)e.charCodeAt(r)>=128&&A("not-basic"),b.push(e.charCodeAt(r));for(n=i>0?i+1:0;n<x;){for(o=E,s=1,u=l;n>=x&&A("invalid-input"),((d=(y=e.charCodeAt(n++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:l)>=l||d>_((a-E)/s))&&A("overflow"),E+=d*s,!(d<(g=u<=w?h:u>=w+c?c:u-w));u+=l)s>_(a/(v=l-g))&&A("overflow"),s*=v;w=P(E-o,t=b.length+1,0==o),_(E/t)>a-S&&A("overflow"),S+=_(E/t),E%=t,b.splice(E++,0,S)}return T(b)}function L(e){var t,i,r,n,o,s,u,d,g,v,y,b,x,S,w,T=[];for(b=(e=M(e)).length,t=f,i=0,o=p,s=0;s<b;++s)(y=e[s])<128&&T.push(E(y));for(r=n=T.length,n&&T.push(m);r<b;){for(u=a,s=0;s<b;++s)(y=e[s])>=t&&y<u&&(u=y);for(u-t>_((a-i)/(x=r+1))&&A("overflow"),i+=(u-t)*x,t=u,s=0;s<b;++s)if((y=e[s])<t&&++i>a&&A("overflow"),y==t){for(d=i,g=l;!(d<(v=g<=o?h:g>=o+c?c:g-o));g+=l)w=d-v,S=l-v,T.push(E(C(v+w%S,0))),d=_(w/S);T.push(E(C(d,0))),o=P(i,x,r==n),i=0,++r}++i,++t}return T.join("")}s={version:"1.3.2",ucs2:{decode:M,encode:T},decode:D,encode:L,toASCII:function(e){return w(e,(function(e){return v.test(e)?"xn--"+L(e):e}))},toUnicode:function(e){return w(e,(function(e){return g.test(e)?D(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return s}.call(t,i,t,e))||(e.exports=r)}()},8575:(e,t,i)=>{var r=i(52511);function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=v,t.resolve=function(e,t){return v(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?v(e,!1,!0).resolveObject(t):t},t.format=function(e){y(e)&&(e=v(e));return e instanceof n?e.format():n.prototype.format.call(e)},t.Url=n;var o=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,a=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(a),h=["%","/","?",";","#"].concat(l),c=["/","?","#"],u=/^[a-z0-9A-Z_-]{0,63}$/,d=/^([a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=i(17673);function v(e,t,i){if(e&&b(e)&&e instanceof n)return e;var r=new n;return r.parse(e,t,i),r}function y(e){return"string"==typeof e}function b(e){return"object"==typeof e&&null!==e}function x(e){return null===e}n.prototype.parse=function(e,t,i){if(!y(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e;n=n.trim();var s=o.exec(n);if(s){var a=(s=s[0]).toLowerCase();this.protocol=a,n=n.substr(s.length)}if(i||s||n.match(/^\/\/[^@\/]+@[^@\/]+/)){var v="//"===n.substr(0,2);!v||s&&f[s]||(n=n.substr(2),this.slashes=!0)}if(!f[s]&&(v||s&&!m[s])){for(var b,x,_=-1,E=0;E<c.length;E++){-1!==(A=n.indexOf(c[E]))&&(-1===_||A<_)&&(_=A)}-1!==(x=-1===_?n.lastIndexOf("@"):n.lastIndexOf("@",_))&&(b=n.slice(0,x),n=n.slice(x+1),this.auth=decodeURIComponent(b)),_=-1;for(E=0;E<h.length;E++){var A;-1!==(A=n.indexOf(h[E]))&&(-1===_||A<_)&&(_=A)}-1===_&&(_=n.length),this.host=n.slice(0,_),n=n.slice(_),this.parseHost(),this.hostname=this.hostname||"";var S="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!S)for(var w=this.hostname.split(/\./),M=(E=0,w.length);E<M;E++){var T=w[E];if(T&&!T.match(u)){for(var C="",P=0,D=T.length;P<D;P++)T.charCodeAt(P)>127?C+="x":C+=T[P];if(!C.match(u)){var L=w.slice(0,E),I=w.slice(E+1),R=T.match(d);R&&(L.push(R[1]),I.unshift(R[2])),I.length&&(n="/"+I.join(".")+n),this.hostname=L.join(".");break}}}if(this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),!S){var O=this.hostname.split("."),N=[];for(E=0;E<O.length;++E){var F=O[E];N.push(F.match(/[^A-Za-z0-9_-]/)?"xn--"+r.encode(F):F)}this.hostname=N.join(".")}var k=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+k,this.href+=this.host,S&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==n[0]&&(n="/"+n))}if(!p[a])for(E=0,M=l.length;E<M;E++){var U=l[E],B=encodeURIComponent(U);B===U&&(B=escape(U)),n=n.split(U).join(B)}var G=n.indexOf("#");-1!==G&&(this.hash=n.substr(G),n=n.slice(0,G));var z=n.indexOf("?");if(-1!==z?(this.search=n.substr(z),this.query=n.substr(z+1),t&&(this.query=g.parse(this.query)),n=n.slice(0,z)):t&&(this.search="",this.query={}),n&&(this.pathname=n),m[a]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){k=this.pathname||"",F=this.search||"";this.path=k+F}return this.href=this.format(),this},n.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=e+this.host:this.hostname&&(n=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&b(this.query)&&Object.keys(this.query).length&&(o=g.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||m[t])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+n+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+r},n.prototype.resolve=function(e){return this.resolveObject(v(e,!1,!0)).format()},n.prototype.resolveObject=function(e){if(y(e)){var t=new n;t.parse(e,!1,!0),e=t}var i=new n;if(Object.keys(this).forEach((function(e){i[e]=this[e]}),this),i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol)return Object.keys(e).forEach((function(t){"protocol"!==t&&(i[t]=e[t])})),m[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i;if(e.protocol&&e.protocol!==i.protocol){if(!m[e.protocol])return Object.keys(e).forEach((function(t){i[t]=e[t]})),i.href=i.format(),i;if(i.protocol=e.protocol,e.host||f[e.protocol])i.pathname=e.pathname;else{for(var r=(e.pathname||"").split("/");r.length&&!(e.host=r.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),i.pathname=r.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var o=i.pathname||"",s=i.search||"";i.path=o+s}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var a=i.pathname&&"/"===i.pathname.charAt(0),l=e.host||e.pathname&&"/"===e.pathname.charAt(0),h=l||a||i.host&&e.pathname,c=h,u=i.pathname&&i.pathname.split("/")||[],d=(r=e.pathname&&e.pathname.split("/")||[],i.protocol&&!m[i.protocol]);if(d&&(i.hostname="",i.port=null,i.host&&(""===u[0]?u[0]=i.host:u.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===r[0]?r[0]=e.host:r.unshift(e.host)),e.host=null),h=h&&(""===r[0]||""===u[0])),l)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,u=r;else if(r.length)u||(u=[]),u.pop(),u=u.concat(r),i.search=e.search,i.query=e.query;else if(null!=e.search){if(d)i.hostname=i.host=u.shift(),(_=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=_.shift(),i.host=i.hostname=_.shift());return i.search=e.search,i.query=e.query,x(i.pathname)&&x(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!u.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var p=u.slice(-1)[0],g=(i.host||e.host)&&("."===p||".."===p)||""===p,v=0,b=u.length;b>=0;b--)"."==(p=u[b])?u.splice(b,1):".."===p?(u.splice(b,1),v++):v&&(u.splice(b,1),v--);if(!h&&!c)for(;v--;v)u.unshift("..");!h||""===u[0]||u[0]&&"/"===u[0].charAt(0)||u.unshift(""),g&&"/"!==u.join("/").substr(-1)&&u.push("");var _,E=""===u[0]||u[0]&&"/"===u[0].charAt(0);d&&(i.hostname=i.host=E?"":u.length?u.shift():"",(_=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=_.shift(),i.host=i.hostname=_.shift()));return(h=h||i.host&&u.length)&&!E&&u.unshift(""),u.length?i.pathname=u.join("/"):(i.pathname=null,i.path=null),x(i.pathname)&&x(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},n.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},15523:e=>{"use strict";e.exports="DELETED_WORKERNODE"},74617:()=>{},75725:()=>{},80959:()=>{},78322:()=>{},83154:(e,t,i)=>{var r;if("function"==typeof fetch&&(r=void 0!==i.g&&i.g.fetch?i.g.fetch:"undefined"!=typeof window&&window.fetch?window.fetch:fetch),"undefined"==typeof window||void 0===window.document){var n=r||i(68203);n.default&&(n=n.default),t.default=n,e.exports=t.default}},30325:e=>{"use strict";e.exports=JSON.parse('{"globals":{"dimension":{},"factor":{"factor":1},"factor.derived":{"parentFactors":{}},"quantity":{"units":[]},"symbol":{"doc":"http://docs.adskunits.apiary.io/#introduction/definitions/unit-symbols","unit":{"typeid":"unit","description":"Measurement unit this symbol applies to."}},"symbol.placement":{"Prefix":{"value":0},"Suffix":1},"symbol.prefixOrSuffix":{"text":{"typeid":"String","description":"Text to annotate the value."},"placement":{"typeid":"symbol.placement","description":"Placement of the annotation text."},"space":{"typeid":"Bool","description":"Specifies whether the annotation should be separated from the value by a space."}},"system":{"Metric":{"value":0,"description":"Metric system of measurement units."},"Imperial":1},"unit":{"doc":"http://docs.adskunits.apiary.io/#introduction/definitions/measurement-units","unitSystem":{"typeid":"system"}},"unit.absolute":{"parentUnit":{"typeid":"unit.relative","description":"Relative unit from which this absolute unit is derived."},"offset":{"typeid":"Float64","value":0,"description":"An offset used to position an absolute scale of measurement on the number line."}},"unit.derived":{"parentFactors":{},"parentUnits":{}},"unit.primitive":{},"unit.primitive.dimensional":{"dimension":{"typeid":"dimension"}},"unit.relative":{}},"factor":{"nineFifths":{"factor":1.8},"pi":{"factor":3.14159265358979},"atto":{"parentFactors":{"ten":-18}},"centi":{"parentFactors":{"ten":-2}},"deci":{"parentFactors":{"ten":-1}},"deka":{"parentFactors":{"ten":1}},"exa":{"parentFactors":{"ten":18}},"femto":{"parentFactors":{"ten":-15}},"giga":{"parentFactors":{"ten":9}},"hecto":{"parentFactors":{"ten":2}},"kilo":{"parentFactors":{"ten":3}},"mega":{"parentFactors":{"ten":6}},"micro":{"parentFactors":{"ten":-6}},"milli":{"parentFactors":{"ten":-3}},"nano":{"parentFactors":{"ten":-9}},"peta":{"parentFactors":{"ten":15}},"pico":{"parentFactors":{"ten":-12}},"tera":{"parentFactors":{"ten":12}},"yocto":{"parentFactors":{"ten":-24}},"yotta":{"parentFactors":{"ten":24}},"zepto":{"parentFactors":{"ten":-21}},"zetta":{"parentFactors":{"ten":21}},"ten":{"factor":10},"threeHundredSixty":{"factor":360},"threeThousandNineHundredThirtySeven":{"factor":3937},"twelve":{"factor":12}},"dimension":{"currency":{},"electricCurrent":{},"length":{},"luminousIntensity":{},"mass":{},"temperature":{},"time":{}},"unit":{"1ToRatio":{"unitSystem":"Metric","parentUnits":{"ratioTo1":-1},"symbols":{"1Colon":{"text":"1:","placement":"Prefix","space":false}}},"acres":{"unitSystem":"Imperial","factor":4840,"parentUnits":{"squareYards":1},"symbols":{"acres":{"text":"acres","placement":"Suffix","space":true}}},"ampereHours":{"unitSystem":"Metric","parentUnits":{"amperes":1,"hours":1},"symbols":{"aDashH":{"text":"A-h","placement":"Suffix","space":true}}},"ampereSeconds":{"unitSystem":"Metric","parentUnits":{"amperes":1,"seconds":1},"symbols":{"aDashS":{"text":"A-s","placement":"Suffix","space":true}}},"amperes":{"unitSystem":"Metric","dimension":"electricCurrent","symbols":{"ampere":{"text":"A","placement":"Suffix","space":true}}},"atmospheres":{"unitSystem":"Imperial","factor":101325,"parentUnits":{"pascals":1},"symbols":{"atm":{"text":"atm","placement":"Suffix","space":true}}},"bars":{"unitSystem":"Metric","factor":100,"parentUnits":{"kilopascals":1},"symbols":{"bar":{"text":"bar","placement":"Suffix","space":true}}},"britishThermalUnits":{"unitSystem":"Imperial","factor":1055.05585262,"parentUnits":{"joules":1},"symbols":{"btu":{"text":"Btu","placement":"Suffix","space":true}}},"britishThermalUnitsPerDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"fahrenheitInterval":-1},"symbols":{"btuPerDegreeF":{"text":"BTU/F","placement":"Suffix","space":true}}},"britishThermalUnitsPerHour":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"hours":-1},"symbols":{"btuPerH":{"text":"Btu/h","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourCubicFoot":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHour":1,"cubicFeet":-1},"symbols":{"btuPerHFtSup3":{"text":"Btu/(hft)","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourFootDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHour":1,"feet":-1,"fahrenheitInterval":-1},"symbols":{"btuPerHFtDegreeF":{"text":"BTU/(hftF)","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourSquareFoot":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHour":1,"squareFeet":-1},"symbols":{"btuPerHFtSup2":{"text":"Btu/(hft)","placement":"Suffix","space":true}}},"britishThermalUnitsPerHourSquareFootDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerHourSquareFoot":1,"fahrenheitInterval":-1},"symbols":{"btuPerHFtSup2DegreeF":{"text":"BTU/(hftF)","placement":"Suffix","space":true}}},"britishThermalUnitsPerPound":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"poundsMass":-1},"symbols":{"btuPerLb":{"text":"BTU/lb","placement":"Suffix","space":true}}},"britishThermalUnitsPerPoundDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnitsPerPound":1,"fahrenheitInterval":-1},"symbols":{"btuPerLbDegreeF":{"text":"BTU/(lbF)","placement":"Suffix","space":true}}},"britishThermalUnitsPerSecond":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"seconds":-1},"symbols":{"btuPerS":{"text":"Btu/s","placement":"Suffix","space":true}}},"britishThermalUnitsPerSquareFootDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"britishThermalUnits":1,"squareFeet":-1,"fahrenheitInterval":-1},"symbols":{"btuPerFtSup2DegreeF":{"text":"BTU/(ftF)","placement":"Suffix","space":true}}},"calories":{"unitSystem":"Metric","factor":4.1868,"parentUnits":{"joules":1},"symbols":{"cal":{"text":"cal","placement":"Suffix","space":true}}},"caloriesPerSecond":{"unitSystem":"Metric","parentUnits":{"calories":1,"seconds":-1},"symbols":{"calPerS":{"text":"cal/s","placement":"Suffix","space":true}}},"candelas":{"unitSystem":"Metric","dimension":"luminousIntensity","symbols":{"cd":{"text":"cd","placement":"Suffix","space":true}}},"candelasPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"candelas":1,"squareFeet":-1},"symbols":{"cdPerFtSup2":{"text":"cd/ft","placement":"Suffix","space":true}}},"candelasPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"candelas":1,"squareMeters":-1},"symbols":{"cdPerMSup2":{"text":"cd/m","placement":"Suffix","space":true}}},"celsius":{"unitSystem":"Metric","parentUnit":"celsiusInterval","offset":273.15,"symbols":{"degreeC":{"text":"C","placement":"Suffix","space":true}}},"celsiusInterval":{"unitSystem":"Metric","parentUnits":{"kelvinInterval":1},"symbols":{"degreeCInterval":{"text":"C","placement":"Suffix","space":true},"deltaDegreeC":{"text":"deltaC","placement":"Suffix","space":true}}},"centimeters":{"unitSystem":"Metric","parentFactors":{"centi":1},"parentUnits":{"meters":1},"symbols":{"cm":{"text":"cm","placement":"Suffix","space":true}}},"centimetersPerMinute":{"unitSystem":"Metric","parentUnits":{"centimeters":1,"minutes":-1},"symbols":{"cmPerMin":{"text":"cm/min","placement":"Suffix","space":true}}},"centimetersToTheFourthPower":{"unitSystem":"Metric","parentUnits":{"centimeters":4},"symbols":{"cmSup4":{"text":"cm","placement":"Suffix","space":true}}},"centimetersToTheSixthPower":{"unitSystem":"Metric","parentUnits":{"centimeters":6},"symbols":{"cmSup6":{"text":"cm","placement":"Suffix","space":true}}},"centipoises":{"unitSystem":"Metric","parentFactors":{"centi":1},"parentUnits":{"poises":1},"symbols":{"cP":{"text":"cP","placement":"Suffix","space":true}}},"circularMils":{"unitSystem":"Imperial","factor":0.25,"parentFactors":{"pi":1},"parentUnits":{"squareMils":1},"symbols":{"cMil":{"text":"cmil","placement":"Suffix","space":true}}},"coulombs":{"unitSystem":"Metric","parentUnits":{"ampereSeconds":1},"symbols":{"coulomb":{"text":"C","placement":"Suffix","space":true}}},"cubicCentimeters":{"defaultSymbol":"cmSup3","unitSystem":"Metric","parentUnits":{"centimeters":3},"symbols":{"cmCaret3":{"text":"cm^3","placement":"Suffix","space":true},"cmSup3":{"text":"cm","placement":"Suffix","space":true}}},"cubicFeet":{"defaultSymbol":"ftSup3","unitSystem":"Imperial","parentUnits":{"feet":3},"symbols":{"cf":{"text":"CF","placement":"Suffix","space":true},"ftCaret3":{"text":"ft^3","placement":"Suffix","space":true},"ftSup3":{"text":"ft","placement":"Suffix","space":true}}},"cubicFeetPerHour":{"defaultSymbol":"ftSup3PerHour","unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"hours":-1},"symbols":{"cfh":{"text":"CFH","placement":"Suffix","space":true},"ftSup3PerH":{"text":"ft/h","placement":"Suffix","space":true}}},"cubicFeetPerKip":{"unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"kips":-1},"symbols":{"ftSup3PerKip":{"text":"ft/kip","placement":"Suffix","space":true}}},"cubicFeetPerMinute":{"defaultSymbol":"ftSup3PerMin","unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"minutes":-1},"symbols":{"cfm":{"text":"CFM","placement":"Suffix","space":true},"ftSup3PerMin":{"text":"ft/min","placement":"Suffix","space":true}}},"cubicFeetPerMinuteCubicFoot":{"defaultSymbol":"cfmPerFtSup3","unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"cubicFeet":-1},"symbols":{"cfmPerCf":{"text":"CFM/CF","placement":"Suffix","space":true},"cfmPerFtSup3":{"text":"CFM/ft","placement":"Suffix","space":true}}},"cubicFeetPerMinutePerBritishThermalUnitPerHour":{"unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"britishThermalUnitsPerHour":-1},"symbols":{"ftSup3HPerMinBtu":{"text":"fth/(minBtu)","placement":"Suffix","space":true}}},"cubicFeetPerMinuteSquareFoot":{"defaultSymbol":"cfmPerFtSup2","unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"squareFeet":-1},"symbols":{"cfmPerFtSup2":{"text":"CFM/ft","placement":"Suffix","space":true},"cfmPerSf":{"text":"CFM/SF","placement":"Suffix","space":true}}},"cubicFeetPerMinuteSquareMeter":{"unitSystem":"Metric","parentUnits":{"cubicFeetPerMinute":1,"squareMeters":-1}},"cubicFeetPerMinuteTonOfRefrigeration":{"unitSystem":"Imperial","parentUnits":{"cubicFeetPerMinute":1,"tonsOfRefrigeration":-1},"symbols":{"cfmPerTon":{"text":"CFM/ton","placement":"Suffix","space":true}}},"cubicFeetPerPoundMass":{"unitSystem":"Imperial","parentUnits":{"cubicFeet":1,"poundsMass":-1},"symbols":{"ftSup3PerLbMass":{"text":"ft/lb","placement":"Suffix","space":true}}},"cubicInches":{"defaultSymbol":"inSup3","unitSystem":"Imperial","parentUnits":{"inches":3},"symbols":{"inCaret3":{"text":"in^3","placement":"Suffix","space":true},"inSup3":{"text":"in","placement":"Suffix","space":true}}},"cubicMeters":{"defaultSymbol":"mSup3","unitSystem":"Metric","parentUnits":{"meters":3},"symbols":{"mCaret3":{"text":"m^3","placement":"Suffix","space":true},"mSup3":{"text":"m","placement":"Suffix","space":true}}},"cubicMetersPerHour":{"defaultSymbol":"mSup3PerH","unitSystem":"Metric","parentUnits":{"cubicMeters":1,"hours":-1},"symbols":{"cmh":{"text":"CMH","placement":"Suffix","space":true},"mSup3PerH":{"text":"m/h","placement":"Suffix","space":true}}},"cubicMetersPerHourCubicMeter":{"unitSystem":"Metric","parentUnits":{"cubicMetersPerHour":1,"cubicMeters":-1},"symbols":{"mSup3PerHMSup3":{"text":"m/(hm)","placement":"Suffix","space":true}}},"cubicMetersPerHourSquareMeter":{"unitSystem":"Metric","parentUnits":{"cubicMetersPerHour":1,"squareMeters":-1},"symbols":{"mSup3PerHMSup2":{"text":"m/(hm)","placement":"Suffix","space":true}}},"cubicMetersPerKilogram":{"unitSystem":"Metric","parentUnits":{"cubicMeters":1,"kilograms":-1},"symbols":{"mSup3PerKg":{"text":"m/kg","placement":"Suffix","space":true}}},"cubicMetersPerKilonewton":{"unitSystem":"Metric","parentUnits":{"cubicMeters":1,"kilonewtons":-1},"symbols":{"mSup3PerKN":{"text":"m/kN","placement":"Suffix","space":true}}},"cubicMetersPerSecond":{"defaultSymbol":"mSup3PerS","unitSystem":"Metric","parentUnits":{"cubicMeters":1,"seconds":-1},"symbols":{"cms":{"text":"CMS","placement":"Suffix","space":true},"mSup3PerS":{"text":"m/s","placement":"Suffix","space":true}}},"cubicMetersPerWattSecond":{"unitSystem":"Metric","parentUnits":{"cubicMeters":1,"watts":-1,"seconds":-1},"symbols":{"mSup3PerWS":{"text":"m/(Ws)","placement":"Suffix","space":true}}},"cubicMillimeters":{"defaultSymbol":"mmSup3","unitSystem":"Metric","parentUnits":{"millimeters":3},"symbols":{"mmCaret3":{"text":"mm^3","placement":"Suffix","space":true},"mmSup3":{"text":"mm","placement":"Suffix","space":true}}},"cubicYards":{"unitSystem":"Imperial","parentUnits":{"yards":3},"symbols":{"cy":{"text":"CY","placement":"Suffix","space":true}}},"currency":{"defaultSymbol":"usDollar","unitSystem":"Imperial","dimension":"currency","symbols":{"baht":{"description":"Baht is the official currency of Thailand.","text":"","placement":"Prefix","space":false},"chineseHongKongDollar":{"description":"Hong Kong Dollar is the official currency of Hong Kong..","text":"HK$","placement":"Prefix","space":false},"dong":{"description":"Dong is the official currency of Vietnam.","text":"","placement":"Suffix","space":false},"euroPrefix":{"text":"","placement":"Prefix","space":false},"euroSuffix":{"text":"","placement":"Suffix","space":false},"krone":{"description":"Krone is the official currency of Denmark, Greenland, and the Faroe Islands.","text":"kr","placement":"Suffix","space":true},"shekel":{"description":"Shekel is the official currency of Israel.","text":"","placement":"Prefix","space":false},"ukPound":{"text":"","placement":"Prefix","space":false},"usDollar":{"text":"$","placement":"Prefix","space":false},"won":{"description":"Won is the official currency of South Korea.","text":"","placement":"Prefix","space":false},"yen":{"text":"","placement":"Prefix","space":false}}},"currencyPerBritishThermalUnit":{"unitSystem":"Imperial","parentUnits":{"currency":1,"britishThermalUnits":-1},"symbols":{"dollarPerBtu":{"text":"$/Btu","placement":"Suffix","space":true}}},"currencyPerBritishThermalUnitPerHour":{"unitSystem":"Imperial","parentUnits":{"currency":1,"britishThermalUnitsPerHour":-1},"symbols":{"dollarHPerBtu":{"text":"$h/Btu","placement":"Suffix","space":true}}},"currencyPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"currency":1,"squareFeet":-1},"symbols":{"dollarPerFtSup2":{"text":"$/ft","placement":"Suffix","space":true}}},"currencyPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"currency":1,"squareMeters":-1},"symbols":{"dollarPerMSup2":{"text":"$/m","placement":"Suffix","space":true}}},"currencyPerWatt":{"unitSystem":"Metric","parentUnits":{"currency":1,"watts":-1},"symbols":{"dollarPerW":{"text":"$/W","placement":"Suffix","space":true}}},"currencyPerWattHour":{"unitSystem":"Metric","parentUnits":{"currency":1,"watts":-1,"hours":-1},"symbols":{"dollarPerWH":{"text":"$/(Wh)","placement":"Suffix","space":true}}},"cyclesPerSecond":{"unitSystem":"Metric","parentUnits":{"seconds":-1},"symbols":{"cps":{"text":"cps","placement":"Suffix","space":true}}},"decimeters":{"unitSystem":"Metric","parentFactors":{"deci":1},"parentUnits":{"meters":1},"symbols":{"dm":{"text":"dm","placement":"Suffix","space":true}}},"degrees":{"defaultSymbol":"degree","unitSystem":"Metric","parentFactors":{"threeHundredSixty":-1},"parentUnits":{"turns":1},"symbols":{"degree":{"text":"","placement":"Suffix","space":false},"degreesMinutesSeconds":{"inherits":"symbol"}}},"dekanewtonMeters":{"unitSystem":"Metric","parentUnits":{"dekanewtons":1,"meters":1},"symbols":{"daNDashM":{"text":"daN-m","placement":"Suffix","space":true}}},"dekanewtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"dekanewtonMeters":1,"meters":-1},"symbols":{"daNDashMPerM":{"text":"daN-m/m","placement":"Suffix","space":true}}},"dekanewtons":{"unitSystem":"Metric","parentFactors":{"deka":1},"parentUnits":{"newtons":1},"symbols":{"daN":{"text":"daN","placement":"Suffix","space":true}}},"dekanewtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"dekanewtons":1,"meters":-1},"symbols":{"daNPerM":{"text":"daN/m","placement":"Suffix","space":true}}},"dekanewtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"dekanewtons":1,"squareMeters":-1},"symbols":{"daNPerMSup2":{"text":"daN/m","placement":"Suffix","space":true}}},"dynes":{"unitSystem":"Metric","factor":10,"parentFactors":{"micro":1},"parentUnits":{"newtons":1},"symbols":{"dyn":{"text":"dyn","placement":"Suffix","space":true}}},"ergs":{"unitSystem":"Metric","parentFactors":{"ten":-7},"parentUnits":{"joules":1},"symbols":{"erg":{"text":"erg","placement":"Suffix","space":true}}},"fahrenheit":{"unitSystem":"Imperial","parentUnit":"fahrenheitInterval","offset":459.67,"symbols":{"degreeF":{"text":"F","placement":"Suffix","space":true}}},"fahrenheitInterval":{"defaultSymbol":"degreeFInterval","unitSystem":"Imperial","parentUnits":{"rankineInterval":1},"symbols":{"degreeFInterval":{"text":"F","placement":"Suffix","space":true},"deltaDegreeF":{"text":"deltaF","placement":"Suffix","space":true}}},"farads":{"unitSystem":"Metric","parentUnits":{"coulombs":1,"volts":-1},"symbols":{"farad":{"text":"F","placement":"Suffix","space":true}}},"feet":{"defaultSymbol":"feetAndInches","unitSystem":"Imperial","factor":12,"parentUnits":{"inches":1},"symbols":{"feetAndInches":{"inherits":"symbol"},"footSingleQuote":{"text":"\'","placement":"Suffix","space":false},"ft":{"text":"ft","placement":"Suffix","space":true},"lf":{"text":"LF","placement":"Suffix","space":true}}},"feetOfWater39.2DegreesFahrenheit":{"defaultSymbol":"feetOfWater","unitSystem":"Imperial","factor":2988.98,"parentUnits":{"pascals":1},"symbols":{"feetOfWater":{"text":"Feet","placement":"Suffix","space":true},"ftH2O":{"text":"ftH2O","placement":"Suffix","space":true},"ftOfWater":{"text":"FT","placement":"Suffix","space":true}}},"feetOfWater39.2DegreesFahrenheitPer100Feet":{"defaultSymbol":"feetOfWaterPer100ft","unitSystem":"Imperial","factor":0.01,"parentUnits":{"feetOfWater39.2DegreesFahrenheit":1,"feet":-1},"symbols":{"feetOfWaterPer100ft":{"text":"Feet/100ft","placement":"Suffix","space":true},"ftH2OPer100ft":{"text":"ftH2O/100ft","placement":"Suffix","space":true},"ftOfWaterPer100ft":{"text":"FT/100ft","placement":"Suffix","space":true}}},"feetPerKip":{"unitSystem":"Imperial","parentUnits":{"feet":1,"kips":-1},"symbols":{"ftPerKip":{"text":"ft/kip","placement":"Suffix","space":true}}},"feetPerKipFoot":{"unitSystem":"Imperial","parentUnits":{"feet":1,"kipFeet":-1},"symbols":{"ftPerKipDashFt":{"text":"ft/kip-ft","placement":"Suffix","space":true}}},"feetPerMinute":{"defaultSymbol":"fpm","unitSystem":"Imperial","parentUnits":{"feet":1,"minutes":-1},"symbols":{"fpm":{"text":"FPM","placement":"Suffix","space":true},"ftPerMin":{"text":"ft/min","placement":"Suffix","space":true}}},"feetPerSecond":{"defaultSymbol":"fps","unitSystem":"Imperial","parentUnits":{"feet":1,"seconds":-1},"symbols":{"fps":{"text":"FPS","placement":"Suffix","space":true},"ftPerS":{"text":"ft/s","placement":"Suffix","space":true}}},"feetPerSecondSquared":{"unitSystem":"Imperial","parentUnits":{"feetPerSecond":1,"seconds":-1},"symbols":{"ftPerSSup2":{"text":"ft/s","placement":"Suffix","space":true}}},"feetToTheFourthPower":{"unitSystem":"Imperial","parentUnits":{"feet":4},"symbols":{"ftSup4":{"text":"ft","placement":"Suffix","space":true}}},"feetToTheSixthPower":{"unitSystem":"Imperial","parentUnits":{"feet":6},"symbols":{"ftSup6":{"text":"ft","placement":"Suffix","space":true}}},"fixed":{"unitSystem":"Metric","parentUnits":{"ratioTo1":1}},"footcandles":{"defaultSymbol":"fc","unitSystem":"Imperial","parentUnits":{"lumens":1,"squareFeet":-1},"symbols":{"fc":{"text":"fc","placement":"Suffix","space":true},"ftc":{"text":"Ftc","placement":"Suffix","space":true}}},"footlamberts":{"defaultSymbol":"fL","unitSystem":"Imperial","parentFactors":{"pi":-1},"parentUnits":{"candelas":1,"squareFeet":-1},"symbols":{"fL":{"text":"fL","placement":"Suffix","space":true},"flLowercase":{"text":"fl","placement":"Suffix","space":true},"ftL":{"text":"ftL","placement":"Suffix","space":true}}},"gammas":{"unitSystem":"Metric","parentFactors":{"nano":1},"parentUnits":{"teslas":1},"symbols":{"gamma":{"text":"gamma","placement":"Suffix","space":true}}},"gauss":{"unitSystem":"Metric","parentFactors":{"ten":-4},"parentUnits":{"teslas":1},"symbols":{"gs":{"text":"Gs","placement":"Suffix","space":true}}},"general":{"unitSystem":"Metric","parentUnits":{"ratioTo1":1}},"gigajoules":{"unitSystem":"Metric","parentFactors":{"giga":1},"parentUnits":{"joules":1}},"gradians":{"unitSystem":"Metric","factor":0.9,"parentUnits":{"degrees":1},"symbols":{"grad":{"text":"grad","placement":"Suffix","space":true}}},"grains":{"unitSystem":"Imperial","factor":64.79891,"parentUnits":{"milligrams":1},"symbols":{"gr":{"text":"gr","placement":"Suffix","space":true}}},"grainsPerHourSquareFootInchMercury":{"unitSystem":"Imperial","parentUnits":{"grains":1,"hours":-1,"squareFeet":-1,"inchesOfMercury32DegreesFahrenheit":-1},"symbols":{"grPerHFtSup2InHg":{"text":"gr/(hftinHg)","placement":"Suffix","space":true}}},"grams":{"unitSystem":"Metric","factor":0.001,"parentUnits":{"kilograms":1},"symbols":{"gram":{"text":"g","placement":"Suffix","space":true}}},"hectares":{"unitSystem":"Metric","parentUnits":{"squareHectometers":1},"symbols":{"hectare":{"text":"hectare","placement":"Suffix","space":true}}},"hectometers":{"unitSystem":"Metric","parentFactors":{"hecto":1},"parentUnits":{"meters":1},"symbols":{"hm":{"text":"hm","placement":"Suffix","space":true}}},"henries":{"unitSystem":"Metric","parentUnits":{"ohms":1,"seconds":1},"symbols":{"henry":{"text":"H","placement":"Suffix","space":true}}},"hertz":{"unitSystem":"Metric","parentUnits":{"cyclesPerSecond":1},"symbols":{"hz":{"text":"Hz","placement":"Suffix","space":true}}},"horsepower":{"unitSystem":"Imperial","factor":33000,"parentUnits":{"poundForceFeet":1,"minutes":-1},"symbols":{"hp":{"text":"hp","placement":"Suffix","space":true}}},"hourSquareFootDegreesFahrenheitPerBritishThermalUnit":{"unitSystem":"Imperial","parentUnits":{"hours":1,"squareFeet":1,"fahrenheitInterval":1,"britishThermalUnits":-1},"symbols":{"hFtSup2DegreeFPerBtu":{"text":"(hftF)/BTU","placement":"Suffix","space":true}}},"hours":{"unitSystem":"Metric","factor":60,"parentUnits":{"minutes":1},"symbols":{"hour":{"text":"h","placement":"Suffix","space":true}}},"inches":{"defaultSymbol":"in","unitSystem":"Imperial","factor":2.54,"parentUnits":{"centimeters":1},"symbols":{"in":{"text":"in","placement":"Suffix","space":true},"inchDoubleQuote":{"text":"\\"","placement":"Suffix","space":false}}},"inchesOfMercury32DegreesFahrenheit":{"unitSystem":"Imperial","factor":3386.389,"parentUnits":{"pascals":1},"symbols":{"inHg":{"text":"inHg","placement":"Suffix","space":true}}},"inchesOfWater60DegreesFahrenheit":{"unitSystem":"Imperial","factor":248.84,"parentUnits":{"pascals":1},"symbols":{"inDashWg":{"text":"in-wg","placement":"Suffix","space":true}}},"inchesOfWater60DegreesFahrenheitPer100Feet":{"unitSystem":"Imperial","factor":0.01,"parentUnits":{"inchesOfWater60DegreesFahrenheit":1,"feet":-1},"symbols":{"inDashWgPer100ft":{"text":"in-wg/100ft","placement":"Suffix","space":true}}},"inchesPerSecond":{"unitSystem":"Imperial","parentUnits":{"inches":1,"seconds":-1},"symbols":{"inPerS":{"text":"in/s","placement":"Suffix","space":true}}},"inchesPerSecondSquared":{"unitSystem":"Imperial","parentUnits":{"inchesPerSecond":1,"seconds":-1},"symbols":{"inPerSSup2":{"text":"in/s","placement":"Suffix","space":true}}},"inchesToTheFourthPower":{"unitSystem":"Imperial","parentUnits":{"inches":4},"symbols":{"inSup4":{"text":"in","placement":"Suffix","space":true}}},"inchesToTheSixthPower":{"unitSystem":"Imperial","parentUnits":{"inches":6},"symbols":{"inSup6":{"text":"in","placement":"Suffix","space":true}}},"inverseDegreesCelsius":{"unitSystem":"Metric","parentUnits":{"celsiusInterval":-1},"symbols":{"invDegreeC":{"text":"1/C","placement":"Suffix","space":true}}},"inverseDegreesFahrenheit":{"unitSystem":"Imperial","parentUnits":{"fahrenheitInterval":-1},"symbols":{"invDegreeF":{"text":"1/F","placement":"Suffix","space":true}}},"inverseKilonewtons":{"unitSystem":"Metric","parentUnits":{"kilonewtons":-1},"symbols":{"invKN":{"text":"1/kN","placement":"Suffix","space":true}}},"inverseKips":{"unitSystem":"Imperial","parentUnits":{"kips":-1},"symbols":{"invKip":{"text":"1/kip","placement":"Suffix","space":true}}},"joules":{"unitSystem":"Metric","parentUnits":{"newtonMeters":1},"symbols":{"joule":{"text":"J","placement":"Suffix","space":true}}},"joulesPerGram":{"unitSystem":"Metric","parentUnits":{"joules":1,"grams":-1},"symbols":{"jPerG":{"text":"J/g","placement":"Suffix","space":true}}},"joulesPerGramDegreeCelsius":{"unitSystem":"Metric","parentUnits":{"joulesPerGram":1,"celsiusInterval":-1},"symbols":{"jPerGDegreeC":{"text":"J/(gC)","placement":"Suffix","space":true}}},"joulesPerKelvin":{"unitSystem":"Metric","parentUnits":{"joules":1,"kelvinInterval":-1},"symbols":{"jPerK":{"text":"J/K","placement":"Suffix","space":true}}},"joulesPerKilogram":{"unitSystem":"Metric","parentUnits":{"joules":1,"kilograms":-1},"symbols":{"jPerKg":{"text":"J/kg","placement":"Suffix","space":true}}},"joulesPerKilogramDegreeCelsius":{"unitSystem":"Metric","parentUnits":{"joulesPerKilogram":1,"celsiusInterval":-1},"symbols":{"jPerKgDegreeC":{"text":"J/(kgC)","placement":"Suffix","space":true}}},"joulesPerSquareMeterKelvin":{"unitSystem":"Metric","parentUnits":{"joules":1,"squareMeters":-1,"kelvinInterval":-1},"symbols":{"jPerMSup2K":{"text":"J/(mK)","placement":"Suffix","space":true}}},"kelvin":{"unitSystem":"Metric","parentUnit":"kelvinInterval","symbols":{"kelvin":{"text":"K","placement":"Suffix","space":true}}},"kelvinInterval":{"defaultSymbol":"deltaK","unitSystem":"Metric","dimension":"temperature","symbols":{"deltaK":{"text":"deltaK","placement":"Suffix","space":true},"kelvinInterval":{"text":"K","placement":"Suffix","space":true}}},"kiloamperes":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"amperes":1},"symbols":{"kA":{"text":"kA","placement":"Suffix","space":true}}},"kilocalories":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"calories":1},"symbols":{"kcal":{"text":"kcal","placement":"Suffix","space":true}}},"kilocaloriesPerSecond":{"unitSystem":"Metric","parentUnits":{"kilocalories":1,"seconds":-1},"symbols":{"kcalPerS":{"text":"kcal/s","placement":"Suffix","space":true}}},"kilogramForceMeters":{"unitSystem":"Metric","parentUnits":{"kilogramsForce":1,"meters":1},"symbols":{"kgfDashM":{"text":"kgf-m","placement":"Suffix","space":true}}},"kilogramForceMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"kilogramForceMeters":1,"meters":-1},"symbols":{"kgfDashMPerM":{"text":"kgf-m/m","placement":"Suffix","space":true}}},"kilogramKelvins":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"kelvinInterval":1},"symbols":{"kgK":{"text":"kgK","placement":"Suffix","space":true}}},"kilograms":{"unitSystem":"Metric","dimension":"mass","symbols":{"kg":{"text":"kg","placement":"Suffix","space":true}}},"kilogramsForce":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"standardGravity":1},"symbols":{"kgf":{"text":"kgf","placement":"Suffix","space":true}}},"kilogramsForcePerMeter":{"unitSystem":"Metric","parentUnits":{"kilogramsForce":1,"meters":-1},"symbols":{"kgfPerM":{"text":"kgf/m","placement":"Suffix","space":true}}},"kilogramsForcePerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilogramsForce":1,"squareMeters":-1},"symbols":{"kgfPerMSup2":{"text":"kgf/m","placement":"Suffix","space":true}}},"kilogramsPerCubicCentimeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"cubicCentimeters":-1}},"kilogramsPerCubicMeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"cubicMeters":-1},"symbols":{"kgPerMSup3":{"text":"kg/m","placement":"Suffix","space":true}}},"kilogramsPerHour":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"hours":-1},"symbols":{"kgPerH":{"text":"kg/h","placement":"Suffix","space":true}}},"kilogramsPerKilogramKelvin":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"kilogramKelvins":-1},"symbols":{"kgPerKgK":{"text":"kg/(kgK)","placement":"Suffix","space":true}}},"kilogramsPerMeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"meters":-1},"symbols":{"kgPerM":{"text":"kg/m","placement":"Suffix","space":true}}},"kilogramsPerMeterHour":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"meters":-1,"hours":-1},"symbols":{"kgPerMH":{"text":"kg/(mh)","placement":"Suffix","space":true}}},"kilogramsPerMeterSecond":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"meters":-1,"seconds":-1},"symbols":{"kgPerMS":{"text":"kg/(ms)","placement":"Suffix","space":true}}},"kilogramsPerMinute":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"minutes":-1},"symbols":{"kgPerMin":{"text":"kg/min","placement":"Suffix","space":true}}},"kilogramsPerSecond":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"seconds":-1},"symbols":{"kgPerS":{"text":"kg/s","placement":"Suffix","space":true}}},"kilogramsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"squareMeters":-1},"symbols":{"kgPerMSup2":{"text":"kg/m","placement":"Suffix","space":true}}},"kilojoules":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"joules":1},"symbols":{"kJ":{"text":"kJ","placement":"Suffix","space":true}}},"kilojoulesPerKelvin":{"unitSystem":"Metric","parentUnits":{"kilojoules":1,"kelvinInterval":-1},"symbols":{"kJPerK":{"text":"kJ/K","placement":"Suffix","space":true}}},"kilojoulesPerSquareMeterKelvin":{"unitSystem":"Metric","parentUnits":{"kilojoules":1,"squareMeters":-1,"kelvinInterval":-1},"symbols":{"kJPerMSup2K":{"text":"kJ/(mK)","placement":"Suffix","space":true}}},"kilometers":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"meters":1},"symbols":{"km":{"text":"km","placement":"Suffix","space":true}}},"kilometersPerHour":{"unitSystem":"Metric","parentUnits":{"kilometers":1,"hours":-1},"symbols":{"kmPerH":{"text":"km/h","placement":"Suffix","space":true}}},"kilometersPerSecond":{"unitSystem":"Metric","parentUnits":{"kilometers":1,"seconds":-1},"symbols":{"kmPerS":{"text":"km/s","placement":"Suffix","space":true}}},"kilometersPerSecondSquared":{"unitSystem":"Metric","parentUnits":{"kilometersPerSecond":1,"seconds":-1},"symbols":{"kmPerSSup2":{"text":"km/s","placement":"Suffix","space":true}}},"kilonewtonMeters":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"meters":1},"symbols":{"kNDashM":{"text":"kN-m","placement":"Suffix","space":true}}},"kilonewtonMetersPerDegree":{"unitSystem":"Metric","parentUnits":{"kilonewtonMeters":1,"degrees":-1},"symbols":{"kNDashMPerDegree":{"text":"kN-m/","placement":"Suffix","space":true}}},"kilonewtonMetersPerDegreePerMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtonMetersPerDegree":1,"meters":-1},"symbols":{"kNDashMPerDegreePerM":{"text":"kN-m//m","placement":"Suffix","space":true}}},"kilonewtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtonMeters":1,"meters":-1},"symbols":{"kNDashMPerM":{"text":"kN-m/m","placement":"Suffix","space":true}}},"kilonewtons":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"newtons":1},"symbols":{"kN":{"text":"kN","placement":"Suffix","space":true}}},"kilonewtonsPerCubicMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"cubicMeters":-1},"symbols":{"kNPerMSup3":{"text":"kN/m","placement":"Suffix","space":true}}},"kilonewtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"meters":-1},"symbols":{"kNPerM":{"text":"kN/m","placement":"Suffix","space":true}}},"kilonewtonsPerSquareCentimeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"squareCentimeters":-1},"symbols":{"kNPerCmSup2":{"text":"kN/cm","placement":"Suffix","space":true}}},"kilonewtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"squareMeters":-1},"symbols":{"kNPerMSup2":{"text":"kN/m","placement":"Suffix","space":true}}},"kilonewtonsPerSquareMillimeter":{"unitSystem":"Metric","parentUnits":{"kilonewtons":1,"squareMillimeters":-1},"symbols":{"kNPerMmSup2":{"text":"kN/mm","placement":"Suffix","space":true}}},"kilopascals":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"pascals":1},"symbols":{"kPa":{"text":"kPa","placement":"Suffix","space":true}}},"kilovoltAmperes":{"unitSystem":"Metric","parentUnits":{"kilovolts":1,"amperes":1},"symbols":{"kVA":{"text":"kVA","placement":"Suffix","space":true}}},"kilovolts":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"volts":1},"symbols":{"kV":{"text":"kV","placement":"Suffix","space":true}}},"kilowattHours":{"unitSystem":"Metric","parentUnits":{"kilowatts":1,"hours":1},"symbols":{"kWh":{"text":"kWh","placement":"Suffix","space":true}}},"kilowattHoursPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"kilowattHours":1,"squareMeters":-1},"symbols":{"kWhPerMSup2":{"text":"kWh/m","placement":"Suffix","space":true}}},"kilowatts":{"unitSystem":"Metric","parentFactors":{"kilo":1},"parentUnits":{"watts":1},"symbols":{"kW":{"text":"kW","placement":"Suffix","space":true}}},"kipFeet":{"unitSystem":"Imperial","parentUnits":{"kips":1,"feet":1},"symbols":{"kipDashFt":{"text":"kip-ft","placement":"Suffix","space":true}}},"kipFeetPerDegree":{"unitSystem":"Imperial","parentUnits":{"kipFeet":1,"degrees":-1},"symbols":{"kipDashFtPerDegree":{"text":"kip-ft/","placement":"Suffix","space":true}}},"kipFeetPerDegreePerFoot":{"unitSystem":"Imperial","parentUnits":{"kipFeetPerDegree":1,"feet":-1},"symbols":{"kipDashFtPerDegreePerFt":{"text":"kip-ft//ft","placement":"Suffix","space":true}}},"kipFeetPerFoot":{"unitSystem":"Imperial","parentUnits":{"kipFeet":1,"feet":-1},"symbols":{"kipDashFtPerFt":{"text":"kip-ft/ft","placement":"Suffix","space":true}}},"kips":{"unitSystem":"Imperial","parentFactors":{"kilo":1},"parentUnits":{"poundsForce":1},"symbols":{"kip":{"text":"kip","placement":"Suffix","space":true}}},"kipsPerCubicFoot":{"unitSystem":"Imperial","parentUnits":{"kips":1,"cubicFeet":-1},"symbols":{"kipPerFtSup3":{"text":"kip/ft","placement":"Suffix","space":true}}},"kipsPerCubicInch":{"unitSystem":"Imperial","parentUnits":{"kips":1,"cubicInches":-1},"symbols":{"kipPerInSup3":{"text":"kip/in","placement":"Suffix","space":true}}},"kipsPerFoot":{"unitSystem":"Imperial","parentUnits":{"kips":1,"feet":-1},"symbols":{"kipPerFt":{"text":"kip/ft","placement":"Suffix","space":true}}},"kipsPerInch":{"unitSystem":"Imperial","parentUnits":{"kips":1,"inches":-1},"symbols":{"kipPerIn":{"text":"kip/in","placement":"Suffix","space":true}}},"kipsPerSquareFoot":{"defaultSymbol":"kipPerFtSup2","unitSystem":"Imperial","parentUnits":{"kips":1,"squareFeet":-1},"symbols":{"kipPerFtSup2":{"text":"kip/ft","placement":"Suffix","space":true},"ksf":{"text":"ksf","placement":"Suffix","space":true}}},"kipsPerSquareInch":{"defaultSymbol":"kipPerInSup2","unitSystem":"Imperial","parentUnits":{"kips":1,"squareInches":-1},"symbols":{"kipPerInSup2":{"text":"kip/in","placement":"Suffix","space":true},"ksi":{"text":"ksi","placement":"Suffix","space":true}}},"liters":{"unitSystem":"Metric","parentUnits":{"decimeters":3},"symbols":{"liter":{"text":"L","placement":"Suffix","space":true}}},"litersPerHour":{"unitSystem":"Metric","parentUnits":{"liters":1,"hours":-1},"symbols":{"lPerH":{"text":"L/h","placement":"Suffix","space":true}}},"litersPerMinute":{"defaultSymbol":"lPerMin","unitSystem":"Metric","parentUnits":{"liters":1,"minutes":-1},"symbols":{"lPerMin":{"text":"L/min","placement":"Suffix","space":true},"lpm":{"text":"LPM","placement":"Suffix","space":true}}},"litersPerSecond":{"defaultSymbol":"lPerS","unitSystem":"Metric","parentUnits":{"liters":1,"seconds":-1},"symbols":{"lPerS":{"text":"L/s","placement":"Suffix","space":true},"lps":{"text":"LPS","placement":"Suffix","space":true}}},"litersPerSecondCubicMeter":{"unitSystem":"Metric","parentUnits":{"litersPerSecond":1,"cubicMeters":-1},"symbols":{"lPerSMSup3":{"text":"L/(sm)","placement":"Suffix","space":true}}},"litersPerSecondKilowatt":{"unitSystem":"Metric","parentUnits":{"litersPerSecond":1,"kilowatts":-1},"symbols":{"lPerSKw":{"text":"L/(skW)","placement":"Suffix","space":true}}},"litersPerSecondSquareMeter":{"defaultSymbol":"lPerSMSup2","unitSystem":"Metric","parentUnits":{"litersPerSecond":1,"squareMeters":-1},"symbols":{"lPerSMSup2":{"text":"L/(sm)","placement":"Suffix","space":true},"lpsPerMSup2":{"text":"LPS/m","placement":"Suffix","space":true}}},"lumens":{"unitSystem":"Metric","parentUnits":{"candelas":1,"steradians":1},"symbols":{"lm":{"text":"lm","placement":"Suffix","space":true}}},"lumensPerWatt":{"unitSystem":"Metric","parentUnits":{"lumens":1,"watts":-1},"symbols":{"lmPerW":{"text":"lm/W","placement":"Suffix","space":true}}},"lux":{"unitSystem":"Metric","parentUnits":{"lumens":1,"squareMeters":-1},"symbols":{"lx":{"text":"lx","placement":"Suffix","space":true}}},"maxwells":{"unitSystem":"Metric","parentFactors":{"ten":-8},"parentUnits":{"webers":1},"symbols":{"mx":{"text":"Mx","placement":"Suffix","space":true}}},"megajoules":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"joules":1}},"megajoulesPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"megajoules":1,"squareMeters":-1}},"meganewtonMeters":{"unitSystem":"Metric","parentUnits":{"meganewtons":1,"meters":1},"symbols":{"mNDashM":{"text":"MN-m","placement":"Suffix","space":true}}},"meganewtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"meganewtonMeters":1,"meters":-1},"symbols":{"mNDashMPerM":{"text":"MN-m/m","placement":"Suffix","space":true}}},"meganewtons":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"newtons":1},"symbols":{"mN":{"text":"MN","placement":"Suffix","space":true}}},"meganewtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"meganewtons":1,"meters":-1},"symbols":{"mNPerM":{"text":"MN/m","placement":"Suffix","space":true}}},"meganewtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"meganewtons":1,"squareMeters":-1},"symbols":{"mNPerMSup2":{"text":"MN/m","placement":"Suffix","space":true}}},"megapascals":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"pascals":1},"symbols":{"mPa":{"text":"MPa","placement":"Suffix","space":true}}},"megawattHours":{"unitSystem":"Metric","parentUnits":{"megawatts":1,"hours":1},"symbols":{"mWh":{"text":"mWh","placement":"Suffix","space":true}}},"megawatts":{"unitSystem":"Metric","parentFactors":{"mega":1},"parentUnits":{"watts":1}},"meters":{"defaultSymbol":"meter","unitSystem":"Metric","dimension":"length","symbols":{"meter":{"text":"m","placement":"Suffix","space":true},"metersAndCentimeters":{"inherits":"symbol"}}},"metersOfWaterColumn":{"unitSystem":"Metric","parentUnits":{"meters":1,"standardGravity":1,"waterDensity4DegreesCelsius":1},"symbols":{"mH2O":{"text":"mH2O","placement":"Suffix","space":true}}},"metersOfWaterColumnPerMeter":{"unitSystem":"Metric","parentUnits":{"metersOfWaterColumn":1,"meters":-1},"symbols":{"mH2OPerM":{"text":"mH2O/m","placement":"Suffix","space":true}}},"metersPerKilonewton":{"unitSystem":"Metric","parentUnits":{"meters":1,"kilonewtons":-1},"symbols":{"mPerKN":{"text":"m/kN","placement":"Suffix","space":true}}},"metersPerKilonewtonMeter":{"unitSystem":"Metric","parentUnits":{"meters":1,"kilonewtonMeters":-1},"symbols":{"mPerKNDashM":{"text":"m/kN-m","placement":"Suffix","space":true}}},"metersPerSecond":{"unitSystem":"Metric","parentUnits":{"meters":1,"seconds":-1},"symbols":{"mPerS":{"text":"m/s","placement":"Suffix","space":true}}},"metersPerSecondSquared":{"unitSystem":"Metric","parentUnits":{"metersPerSecond":1,"seconds":-1},"symbols":{"mPerSSup2":{"text":"m/s","placement":"Suffix","space":true}}},"metersToTheFourthPower":{"unitSystem":"Metric","parentUnits":{"meters":4},"symbols":{"mSup4":{"text":"m","placement":"Suffix","space":true}}},"metersToTheSixthPower":{"unitSystem":"Metric","parentUnits":{"meters":6},"symbols":{"mSup6":{"text":"m","placement":"Suffix","space":true}}},"mhos":{"unitSystem":"Metric","parentUnits":{"ohms":-1},"symbols":{"mho":{"text":"mho","placement":"Suffix","space":true}}},"microinches":{"unitSystem":"Imperial","parentFactors":{"micro":1},"parentUnits":{"inches":1},"symbols":{"uin":{"text":"in","placement":"Suffix","space":true}}},"microinchesPerInchDegreeFahrenheit":{"unitSystem":"Imperial","parentFactors":{"micro":1},"parentUnits":{"inverseDegreesFahrenheit":1},"symbols":{"uinPerInDegreeF":{"text":"in/(inF)","placement":"Suffix","space":true}}},"micrometersPerMeterDegreeCelsius":{"unitSystem":"Metric","parentFactors":{"micro":1},"parentUnits":{"inverseDegreesCelsius":1},"symbols":{"umPerMDegreeC":{"text":"m/(mC)","placement":"Suffix","space":true}}},"microns":{"unitSystem":"Metric","parentFactors":{"micro":1},"parentUnits":{"meters":1},"symbols":{"micron":{"text":"micron","placement":"Suffix","space":true}}},"miles":{"unitSystem":"Imperial","factor":1760,"parentUnits":{"yards":1},"symbols":{"mi":{"text":"mi","placement":"Suffix","space":true}}},"milesPerHour":{"unitSystem":"Imperial","parentUnits":{"miles":1,"hours":-1},"symbols":{"mph":{"text":"mph","placement":"Suffix","space":true}}},"milesPerSecond":{"unitSystem":"Imperial","parentUnits":{"miles":1,"seconds":-1},"symbols":{"miPerS":{"text":"mi/s","placement":"Suffix","space":true}}},"milesPerSecondSquared":{"unitSystem":"Imperial","parentUnits":{"milesPerSecond":1,"seconds":-1},"symbols":{"miPerSSup2":{"text":"mi/s","placement":"Suffix","space":true}}},"milliamperes":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"amperes":1},"symbols":{"mA":{"text":"mA","placement":"Suffix","space":true}}},"milligrams":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"grams":1},"symbols":{"mg":{"text":"mg","placement":"Suffix","space":true}}},"millimeters":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"meters":1},"symbols":{"mm":{"text":"mm","placement":"Suffix","space":true}}},"millimetersOfMercury":{"unitSystem":"Metric","factor":133.3224,"parentUnits":{"pascals":1},"symbols":{"mmHg":{"text":"mmHg","placement":"Suffix","space":true}}},"millimetersOfWaterColumn":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"metersOfWaterColumn":1},"symbols":{"mmH2O":{"text":"mmH2O","placement":"Suffix","space":true}}},"millimetersOfWaterColumnPerMeter":{"unitSystem":"Metric","parentUnits":{"millimetersOfWaterColumn":1,"meters":-1},"symbols":{"mmH2OPerM":{"text":"mmH2O/m","placement":"Suffix","space":true}}},"millimetersToTheFourthPower":{"unitSystem":"Metric","parentUnits":{"millimeters":4},"symbols":{"mmSup4":{"text":"mm","placement":"Suffix","space":true}}},"millimetersToTheSixthPower":{"unitSystem":"Metric","parentUnits":{"millimeters":6},"symbols":{"mmSup6":{"text":"mm","placement":"Suffix","space":true}}},"milliseconds":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"seconds":1},"symbols":{"ms":{"text":"ms","placement":"Suffix","space":true}}},"millivolts":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"volts":1},"symbols":{"mV":{"text":"mV","placement":"Suffix","space":true}}},"mils":{"unitSystem":"Imperial","parentFactors":{"milli":1},"parentUnits":{"inches":1},"symbols":{"mil":{"text":"mil","placement":"Suffix","space":true}}},"minutes":{"unitSystem":"Metric","factor":60,"parentUnits":{"seconds":1},"symbols":{"min":{"text":"min","placement":"Suffix","space":true}}},"nanograms":{"unitSystem":"Metric","parentFactors":{"nano":1},"parentUnits":{"grams":1},"symbols":{"ng":{"text":"ng","placement":"Suffix","space":true}}},"nanogramsPerPascalSecondSquareMeter":{"unitSystem":"Metric","parentUnits":{"nanograms":1,"seconds":-1,"squareMeters":-1,"pascals":-1},"symbols":{"ngPerPaSMSup2":{"text":"ng/(Pasm)","placement":"Suffix","space":true}}},"nanometers":{"unitSystem":"Metric","parentFactors":{"nano":1},"parentUnits":{"meters":1},"symbols":{"nm":{"text":"nm","placement":"Suffix","space":true}}},"nauticalMiles":{"unitSystem":"Imperial","factor":1852,"parentUnits":{"meters":1},"symbols":{"nauticalMile":{"text":"M","placement":"Suffix","space":true}}},"newtonMeters":{"unitSystem":"Metric","parentUnits":{"newtons":1,"meters":1},"symbols":{"nDashM":{"text":"N-m","placement":"Suffix","space":true}}},"newtonMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"newtonMeters":1,"meters":-1},"symbols":{"nDashMPerM":{"text":"N-m/m","placement":"Suffix","space":true}}},"newtonSecondsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"seconds":1,"squareMeters":-1},"symbols":{"nSPerMSup2":{"text":"Ns/m","placement":"Suffix","space":true}}},"newtons":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"metersPerSecondSquared":1},"symbols":{"newton":{"text":"N","placement":"Suffix","space":true}}},"newtonsPerMeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"meters":-1},"symbols":{"nPerM":{"text":"N/m","placement":"Suffix","space":true}}},"newtonsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"squareMeters":-1},"symbols":{"nPerMSup2":{"text":"N/m","placement":"Suffix","space":true}}},"newtonsPerSquareMillimeter":{"unitSystem":"Metric","parentUnits":{"newtons":1,"squareMillimeters":-1},"symbols":{"nPerMmSup2":{"text":"N/mm","placement":"Suffix","space":true}}},"oersteds":{"unitSystem":"Metric","factor":250,"parentFactors":{"pi":-1},"parentUnits":{"amperes":1,"meters":-1},"symbols":{"oe":{"text":"Oe","placement":"Suffix","space":true}}},"ohmMeters":{"unitSystem":"Metric","parentUnits":{"ohms":1,"meters":1},"symbols":{"ohmM":{"text":"ohmm","placement":"Suffix","space":true}}},"ohms":{"defaultSymbol":"omega","unitSystem":"Metric","parentUnits":{"volts":1,"amperes":-1},"symbols":{"ohm":{"text":"ohm","placement":"Suffix","space":true},"omega":{"text":"","placement":"Suffix","space":true}}},"ouncesForce":{"unitSystem":"Imperial","factor":0.0625,"parentUnits":{"poundsForce":1},"symbols":{"ozf":{"text":"ozf","placement":"Suffix","space":true}}},"ouncesMass":{"unitSystem":"Imperial","factor":0.0625,"parentUnits":{"poundsMass":1},"symbols":{"oz":{"text":"oz","placement":"Suffix","space":true}}},"pascalSeconds":{"unitSystem":"Metric","parentUnits":{"pascals":1,"seconds":1},"symbols":{"paDashS":{"text":"Pa-s","placement":"Suffix","space":true}}},"pascals":{"unitSystem":"Metric","parentUnits":{"newtonsPerSquareMeter":1},"symbols":{"pa":{"text":"Pa","placement":"Suffix","space":true}}},"pascalsPerMeter":{"unitSystem":"Metric","parentUnits":{"pascals":1,"meters":-1},"symbols":{"paPerM":{"text":"Pa/m","placement":"Suffix","space":true}}},"perMille":{"unitSystem":"Metric","parentFactors":{"milli":1},"parentUnits":{"ratioTo1":1},"symbols":{"perMille":{"text":"","placement":"Suffix","space":false}}},"percentage":{"unitSystem":"Metric","parentFactors":{"centi":1},"parentUnits":{"ratioTo1":1},"symbols":{"percent":{"text":"%","placement":"Suffix","space":false}}},"pi":{"unitSystem":"Imperial","parentFactors":{"pi":1},"parentUnits":{"radians":1},"symbols":{"pi":{"text":"","placement":"Suffix","space":true}}},"poises":{"unitSystem":"Metric","parentUnits":{"grams":1,"centimeters":-1,"seconds":-1},"symbols":{"poise":{"text":"P","placement":"Suffix","space":true}}},"poundForceFeet":{"defaultSymbol":"lbForceDashFt","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"feet":1},"symbols":{"lbForceDashFt":{"text":"lb-ft","placement":"Suffix","space":true},"lbfDashFt":{"text":"lbf-ft","placement":"Suffix","space":true}}},"poundForceFeetPerFoot":{"defaultSymbol":"lbForceDashFtPerFt","unitSystem":"Imperial","parentUnits":{"poundForceFeet":1,"feet":-1},"symbols":{"lbForceDashFtPerFt":{"text":"lb-ft/ft","placement":"Suffix","space":true},"lbfDashFtPerFt":{"text":"lbf-ft/ft","placement":"Suffix","space":true}}},"poundForceSecondsPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"poundsForce":1,"seconds":1,"squareFeet":-1},"symbols":{"lbForceSPerFtSup2":{"text":"lbs/ft","placement":"Suffix","space":true}}},"poundMassDegreesFahrenheit":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"fahrenheitInterval":1},"symbols":{"lbMassDegreeF":{"text":"lbF","placement":"Suffix","space":true}}},"poundsForce":{"defaultSymbol":"lbForce","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"standardGravity":1},"symbols":{"lbForce":{"text":"lb","placement":"Suffix","space":true},"lbf":{"text":"lbf","placement":"Suffix","space":true}}},"poundsForcePerCubicFoot":{"defaultSymbol":"lbForcePerFtSup3","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"cubicFeet":-1},"symbols":{"lbForcePerFtSup3":{"text":"lb/ft","placement":"Suffix","space":true},"lbfPerFtSup3":{"text":"lbf/ft","placement":"Suffix","space":true}}},"poundsForcePerFoot":{"defaultSymbol":"lbForcePerFt","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"feet":-1},"symbols":{"lbForcePerFt":{"text":"lb/ft","placement":"Suffix","space":true},"lbfPerFt":{"text":"lbf/ft","placement":"Suffix","space":true}}},"poundsForcePerSquareFoot":{"defaultSymbol":"lbForcePerFtSup2","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"squareFeet":-1},"symbols":{"lbForcePerFtSup2":{"text":"lb/ft","placement":"Suffix","space":true},"lbfPerFtSup2":{"text":"lbf/ft","placement":"Suffix","space":true},"psf":{"text":"psf","placement":"Suffix","space":true}}},"poundsForcePerSquareInch":{"defaultSymbol":"lbForcePerInSup2","unitSystem":"Imperial","parentUnits":{"poundsForce":1,"squareInches":-1},"symbols":{"lbForcePerInSup2":{"text":"lb/in","placement":"Suffix","space":true},"lbfPerInSup2":{"text":"lbf/in","placement":"Suffix","space":true},"psi":{"text":"psi","placement":"Suffix","space":true},"psia":{"text":"psia","placement":"Suffix","space":true},"psig":{"text":"psig","placement":"Suffix","space":true}}},"poundsMass":{"defaultSymbol":"lbMass","unitSystem":"Imperial","factor":0.45359237,"parentUnits":{"kilograms":1},"symbols":{"lbMass":{"text":"lb","placement":"Suffix","space":true},"lbm":{"text":"lbm","placement":"Suffix","space":true}}},"poundsMassPerCubicFoot":{"defaultSymbol":"lbMassPerFtSup3","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"cubicFeet":-1},"symbols":{"lbMassPerFtSup3":{"text":"lb/ft","placement":"Suffix","space":true},"lbmPerFtSup3":{"text":"lbm/ft","placement":"Suffix","space":true}}},"poundsMassPerCubicInch":{"defaultSymbol":"lbMassPerInSup3","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"cubicInches":-1},"symbols":{"lbMassPerInSup3":{"text":"lb/in","placement":"Suffix","space":true},"lbmPerInSup3":{"text":"lbm/in","placement":"Suffix","space":true}}},"poundsMassPerFoot":{"defaultSymbol":"lbMassPerFt","unitSystem":"Imperial","parentUnits":{"poundsMass":1,"feet":-1},"symbols":{"lbMassPerFt":{"text":"lb/ft","placement":"Suffix","space":true},"lbmPerFt":{"text":"lbm/ft","placement":"Suffix","space":true}}},"poundsMassPerFootHour":{"defaultSymbol":"lbMassPerFtDashH","unitSystem":"Imperial","parentUnits":{"poundsMassPerFoot":1,"hours":-1},"symbols":{"lbMassPerFtDashH":{"text":"lb/ft-h","placement":"Suffix","space":true},"lbmPerFtDashH":{"text":"lbm/ft-h","placement":"Suffix","space":true}}},"poundsMassPerFootSecond":{"defaultSymbol":"lbMassPerFtDashS","unitSystem":"Imperial","parentUnits":{"poundsMassPerFoot":1,"seconds":-1},"symbols":{"lbMassPerFtDashS":{"text":"lb/ft-s","placement":"Suffix","space":true},"lbmPerFtDashS":{"text":"lbm/ft-s","placement":"Suffix","space":true}}},"poundsMassPerHour":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"hours":-1},"symbols":{"lbMassPerH":{"text":"lb/h","placement":"Suffix","space":true}}},"poundsMassPerMinute":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"minutes":-1},"symbols":{"lbMassPerMin":{"text":"lb/min","placement":"Suffix","space":true}}},"poundsMassPerPoundDegreeFahrenheit":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"poundMassDegreesFahrenheit":-1},"symbols":{"lbMassPerLbDegreeF":{"text":"lb/(lbF)","placement":"Suffix","space":true}}},"poundsMassPerSecond":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"seconds":-1},"symbols":{"lbMassPerS":{"text":"lb/s","placement":"Suffix","space":true}}},"poundsMassPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"poundsMass":1,"squareFeet":-1},"symbols":{"lbMassPerFtSup2":{"text":"lb/ft","placement":"Suffix","space":true}}},"radians":{"unitSystem":"Metric","symbols":{"rad":{"text":"rad","placement":"Suffix","space":true}}},"radiansPerSecond":{"unitSystem":"Metric","parentUnits":{"radians":1,"seconds":-1},"symbols":{"radPerS":{"text":"rad/s","placement":"Suffix","space":true}}},"rankine":{"unitSystem":"Imperial","parentUnit":"rankineInterval","symbols":{"degreeR":{"text":"R","placement":"Suffix","space":true}}},"rankineInterval":{"defaultSymbol":"degreeRInterval","unitSystem":"Imperial","parentFactors":{"nineFifths":-1},"parentUnits":{"kelvinInterval":1},"symbols":{"degreeRInterval":{"text":"R","placement":"Suffix","space":true},"deltaDegreeR":{"text":"deltaR","placement":"Suffix","space":true}}},"ratioTo1":{"unitSystem":"Metric","symbols":{"colon1":{"text":":1","placement":"Suffix","space":false}}},"ratioTo10":{"unitSystem":"Metric","parentFactors":{"ten":-1},"parentUnits":{"ratioTo1":1},"symbols":{"colon10":{"text":":10","placement":"Suffix","space":false}}},"ratioTo12":{"unitSystem":"Imperial","parentFactors":{"twelve":-1},"parentUnits":{"ratioTo1":1},"symbols":{"colon12":{"text":":12","placement":"Suffix","space":false}}},"revolutionsPerMinute":{"unitSystem":"Imperial","parentUnits":{"turns":1,"minutes":-1},"symbols":{"rpm":{"text":"RPM","placement":"Suffix","space":true}}},"revolutionsPerSecond":{"unitSystem":"Metric","parentUnits":{"turns":1,"seconds":-1},"symbols":{"rps":{"text":"RPS","placement":"Suffix","space":true}}},"riseDividedBy1000Millimeters":{"unitSystem":"Metric","parentUnits":{"perMille":1}},"riseDividedBy10Feet":{"unitSystem":"Imperial","parentUnits":{"ratioTo10":1}},"riseDividedBy120Inches":{"unitSystem":"Imperial","parentFactors":{"ten":-1},"parentUnits":{"riseDividedBy12Inches":1}},"riseDividedBy12Inches":{"unitSystem":"Imperial","parentUnits":{"ratioTo12":1}},"riseDividedBy1Foot":{"unitSystem":"Imperial","parentUnits":{"ratioTo1":1}},"seconds":{"unitSystem":"Metric","dimension":"time","symbols":{"second":{"text":"s","placement":"Suffix","space":true}}},"siemens":{"unitSystem":"Metric","parentUnits":{"mhos":1},"symbols":{"siemens":{"text":"S","placement":"Suffix","space":true}}},"slugs":{"unitSystem":"Imperial","parentUnits":{"poundsForce":1,"seconds":2,"feet":-1},"symbols":{"slug":{"text":"slug","placement":"Suffix","space":true}}},"squareCentimeters":{"defaultSymbol":"cmSup2","unitSystem":"Metric","parentUnits":{"centimeters":2},"symbols":{"cmCaret2":{"text":"cm^2","placement":"Suffix","space":true},"cmSup2":{"text":"cm","placement":"Suffix","space":true}}},"squareCentimetersPerMeter":{"unitSystem":"Metric","parentUnits":{"squareCentimeters":1,"meters":-1},"symbols":{"cmSup2PerM":{"text":"cm/m","placement":"Suffix","space":true}}},"squareFeet":{"defaultSymbol":"ftSup2","unitSystem":"Imperial","parentUnits":{"feet":2},"symbols":{"ftCaret2":{"text":"ft^2","placement":"Suffix","space":true},"ftSup2":{"text":"ft","placement":"Suffix","space":true},"sf":{"text":"SF","placement":"Suffix","space":true}}},"squareFeetPer1000BritishThermalUnitsPerHour":{"defaultSymbol":"ftSup2HPerKbtu","unitSystem":"Imperial","factor":0.001,"parentUnits":{"squareFeet":1,"britishThermalUnitsPerHour":-1},"symbols":{"ftSup2HPerKbtu":{"text":"fth/kBtu","placement":"Suffix","space":true},"ftSup2PerMbh":{"text":"ft/MBh","placement":"Suffix","space":true},"sfHPerKbtu":{"text":"SFh/kBtu","placement":"Suffix","space":true},"sfPerMbh":{"text":"SF/MBh","placement":"Suffix","space":true}}},"squareFeetPerFoot":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"feet":-1},"symbols":{"ftSup2PerFt":{"text":"ft/ft","placement":"Suffix","space":true}}},"squareFeetPerKip":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"kips":-1},"symbols":{"ftSup2PerKip":{"text":"ft/kip","placement":"Suffix","space":true}}},"squareFeetPerKipFoot":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"kipFeet":-1},"symbols":{"ftSup2PerKipDashFt":{"text":"ft/kip-ft","placement":"Suffix","space":true}}},"squareFeetPerSecond":{"unitSystem":"Imperial","parentUnits":{"squareFeet":1,"seconds":-1},"symbols":{"ftSup2PerS":{"text":"ft/s","placement":"Suffix","space":true}}},"squareFeetPerTonOfRefrigeration":{"defaultSymbol":"ftSup2PerTon","unitSystem":"Imperial","parentUnits":{"squareFeet":1,"tonsOfRefrigeration":-1},"symbols":{"ftSup2PerTon":{"text":"ft/ton","placement":"Suffix","space":true},"sfPerTon":{"text":"SF/ton","placement":"Suffix","space":true}}},"squareHectometers":{"unitSystem":"Metric","parentUnits":{"hectometers":2},"symbols":{"hmSup2":{"text":"hm","placement":"Suffix","space":true}}},"squareInches":{"defaultSymbol":"inSup2","unitSystem":"Imperial","parentUnits":{"inches":2},"symbols":{"inCaret2":{"text":"in^2","placement":"Suffix","space":true},"inSup2":{"text":"in","placement":"Suffix","space":true}}},"squareInchesPerFoot":{"unitSystem":"Imperial","parentUnits":{"squareInches":1,"feet":-1},"symbols":{"inSup2PerFt":{"text":"in/ft","placement":"Suffix","space":true}}},"squareMeterKelvinsPerWatt":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kelvinInterval":1,"watts":-1},"symbols":{"mSup2KPerW":{"text":"(mK)/W","placement":"Suffix","space":true}}},"squareMeters":{"defaultSymbol":"mSup2","unitSystem":"Metric","parentUnits":{"meters":2},"symbols":{"mCaret2":{"text":"m^2","placement":"Suffix","space":true},"mSup2":{"text":"m","placement":"Suffix","space":true}}},"squareMetersPerKilonewton":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kilonewtons":-1},"symbols":{"mSup2PerKN":{"text":"m/kN","placement":"Suffix","space":true}}},"squareMetersPerKilonewtonMeter":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kilonewtonMeters":-1},"symbols":{"mSup2PerKNDashM":{"text":"m/kN-m","placement":"Suffix","space":true}}},"squareMetersPerKilowatt":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"kilowatts":-1},"symbols":{"mSup2PerKw":{"text":"m/kW","placement":"Suffix","space":true}}},"squareMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"meters":-1},"symbols":{"mSup2PerM":{"text":"m/m","placement":"Suffix","space":true}}},"squareMetersPerSecond":{"unitSystem":"Metric","parentUnits":{"squareMeters":1,"seconds":-1},"symbols":{"mSup2PerS":{"text":"m/s","placement":"Suffix","space":true}}},"squareMillimeters":{"defaultSymbol":"mmSup2","unitSystem":"Metric","parentUnits":{"millimeters":2},"symbols":{"mmCaret2":{"text":"mm^2","placement":"Suffix","space":true},"mmSup2":{"text":"mm","placement":"Suffix","space":true}}},"squareMillimetersPerMeter":{"unitSystem":"Metric","parentUnits":{"squareMillimeters":1,"meters":-1},"symbols":{"mmSup2PerM":{"text":"mm/m","placement":"Suffix","space":true}}},"squareMils":{"defaultSymbol":"milSup2","unitSystem":"Imperial","parentUnits":{"mils":2},"symbols":{"milCaret2":{"text":"mil^2","placement":"Suffix","space":true},"milSup2":{"text":"mil","placement":"Suffix","space":true}}},"squareYards":{"unitSystem":"Imperial","parentUnits":{"yards":2},"symbols":{"ydSup2":{"text":"yd","placement":"Suffix","space":true}}},"standardGravity":{"unitSystem":"Metric","factor":9.80665,"parentUnits":{"metersPerSecondSquared":1},"symbols":{"gravity":{"text":"","placement":"Suffix","space":true}}},"steradians":{"unitSystem":"Metric","symbols":{"sr":{"text":"sr","placement":"Suffix","space":true}}},"teslas":{"unitSystem":"Metric","parentUnits":{"webers":1,"meters":-2},"symbols":{"tesla":{"text":"T","placement":"Suffix","space":true}}},"therms":{"unitSystem":"Imperial","factor":100000,"parentUnits":{"britishThermalUnits":1},"symbols":{"therm":{"text":"therm","placement":"Suffix","space":true}}},"thousandBritishThermalUnits":{"unitSystem":"Imperial","parentFactors":{"kilo":1},"parentUnits":{"britishThermalUnits":1},"symbols":{"kBtu":{"text":"kBtu","placement":"Suffix","space":true}}},"thousandBritishThermalUnitsPerHour":{"unitSystem":"Imperial","factor":1000,"parentUnits":{"britishThermalUnitsPerHour":1},"symbols":{"mbh":{"text":"MBH","placement":"Suffix","space":true}}},"thousandBritishThermalUnitsPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"thousandBritishThermalUnits":1,"squareFeet":-1},"symbols":{"kBtuPerFtSup2":{"text":"kBtu/ft","placement":"Suffix","space":true}}},"tonneForceMeters":{"unitSystem":"Metric","parentUnits":{"tonnesForce":1,"meters":1},"symbols":{"tfDashM":{"text":"Tf-m","placement":"Suffix","space":true}}},"tonneForceMetersPerMeter":{"unitSystem":"Metric","parentUnits":{"tonneForceMeters":1,"meters":-1},"symbols":{"tfDashMPerM":{"text":"Tf-m/m","placement":"Suffix","space":true}}},"tonnes":{"unitSystem":"Metric","factor":1000,"parentUnits":{"kilograms":1},"symbols":{"tonne":{"text":"t","placement":"Suffix","space":true}}},"tonnesForce":{"unitSystem":"Metric","parentUnits":{"tonnes":1,"standardGravity":1},"symbols":{"tf":{"text":"Tf","placement":"Suffix","space":true}}},"tonnesForcePerMeter":{"unitSystem":"Metric","parentUnits":{"tonnesForce":1,"meters":-1},"symbols":{"tfPerM":{"text":"Tf/m","placement":"Suffix","space":true}}},"tonnesForcePerSquareMeter":{"unitSystem":"Metric","parentUnits":{"tonnesForce":1,"squareMeters":-1},"symbols":{"tfPerMSup2":{"text":"Tf/m","placement":"Suffix","space":true}}},"tonsOfRefrigeration":{"defaultSymbol":"ton","unitSystem":"Imperial","factor":12000,"parentUnits":{"britishThermalUnitsPerHour":1},"symbols":{"ton":{"text":"ton","placement":"Suffix","space":true},"tonOfRefrigeration":{"text":"ton of refrigeration","placement":"Suffix","space":true}}},"turns":{"unitSystem":"Metric","factor":2,"parentFactors":{"pi":1},"parentUnits":{"radians":1},"symbols":{"tr":{"text":"tr","placement":"Suffix","space":true}}},"usGallons":{"unitSystem":"Imperial","factor":231,"parentUnits":{"cubicInches":1},"symbols":{"gal":{"text":"gal","placement":"Suffix","space":true}}},"usGallonsPerHour":{"defaultSymbol":"galPerH","unitSystem":"Imperial","parentUnits":{"usGallons":1,"hours":-1},"symbols":{"galPerH":{"text":"gal/h","placement":"Suffix","space":true},"gph":{"text":"GPH","placement":"Suffix","space":true},"usgph":{"text":"usgph","placement":"Suffix","space":true}}},"usGallonsPerMinute":{"defaultSymbol":"galPerMin","unitSystem":"Imperial","parentUnits":{"usGallons":1,"minutes":-1},"symbols":{"galPerMin":{"text":"gal/min","placement":"Suffix","space":true},"gpm":{"text":"GPM","placement":"Suffix","space":true},"usgpm":{"text":"usgpm","placement":"Suffix","space":true}}},"usSurveyFeet":{"unitSystem":"Imperial","factor":1200,"parentFactors":{"threeThousandNineHundredThirtySeven":-1},"parentUnits":{"meters":1},"symbols":{"usft":{"text":"USft","placement":"Suffix","space":true}}},"usTonnesForce":{"defaultSymbol":"stf","unitSystem":"Imperial","parentUnits":{"usTonnesMass":1,"standardGravity":1},"symbols":{"stf":{"text":"STf","placement":"Suffix","space":true},"tonsf":{"text":"Tonsf","placement":"Suffix","space":true},"usTonnesForceSt":{"text":"ST","placement":"Suffix","space":true},"usTonnesForceT":{"text":"T","placement":"Suffix","space":true},"usTonnesForceTons":{"text":"Tons","placement":"Suffix","space":true}}},"usTonnesMass":{"defaultSymbol":"usTonnesMassSt","unitSystem":"Imperial","factor":2000,"parentUnits":{"poundsMass":1},"symbols":{"usTonnesMassSt":{"text":"ST","placement":"Suffix","space":true},"usTonnesMassT":{"text":"T","placement":"Suffix","space":true},"usTonnesMassTons":{"text":"Tons","placement":"Suffix","space":true}}},"voltAmperes":{"unitSystem":"Metric","parentUnits":{"volts":1,"amperes":1},"symbols":{"vA":{"text":"VA","placement":"Suffix","space":true}}},"voltAmperesPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"voltAmperes":1,"squareFeet":-1},"symbols":{"vAPerFtSup2":{"text":"VA/ft","placement":"Suffix","space":true}}},"voltAmperesPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"voltAmperes":1,"squareMeters":-1},"symbols":{"vAPerMSup2":{"text":"VA/m","placement":"Suffix","space":true}}},"volts":{"unitSystem":"Metric","parentUnits":{"watts":1,"amperes":-1},"symbols":{"volt":{"text":"V","placement":"Suffix","space":true}}},"waterDensity4DegreesCelsius":{"unitSystem":"Metric","parentUnits":{"kilograms":1,"liters":-1}},"watts":{"unitSystem":"Metric","parentUnits":{"joules":1,"seconds":-1},"symbols":{"watt":{"text":"W","placement":"Suffix","space":true}}},"wattsPerCubicFoot":{"unitSystem":"Imperial","parentUnits":{"watts":1,"cubicFeet":-1},"symbols":{"wPerFtSup3":{"text":"W/ft","placement":"Suffix","space":true}}},"wattsPerCubicFootPerMinute":{"unitSystem":"Imperial","parentUnits":{"watts":1,"cubicFeetPerMinute":-1},"symbols":{"wMinPerFtSup3":{"text":"Wmin/ft","placement":"Suffix","space":true}}},"wattsPerCubicMeter":{"unitSystem":"Metric","parentUnits":{"watts":1,"cubicMeters":-1},"symbols":{"wPerMSup3":{"text":"W/m","placement":"Suffix","space":true}}},"wattsPerCubicMeterPerSecond":{"unitSystem":"Metric","parentUnits":{"watts":1,"cubicMetersPerSecond":-1},"symbols":{"wSPerMSup3":{"text":"Ws/m","placement":"Suffix","space":true}}},"wattsPerFoot":{"unitSystem":"Imperial","parentUnits":{"watts":1,"feet":-1},"symbols":{"wPerFt":{"text":"W/ft","placement":"Suffix","space":true}}},"wattsPerMeter":{"unitSystem":"Metric","parentUnits":{"watts":1,"meters":-1},"symbols":{"wPerM":{"text":"W/m","placement":"Suffix","space":true}}},"wattsPerMeterKelvin":{"unitSystem":"Metric","parentUnits":{"watts":1,"meters":-1,"kelvinInterval":-1},"symbols":{"wPerMK":{"text":"W/(mK)","placement":"Suffix","space":true}}},"wattsPerSquareFoot":{"unitSystem":"Imperial","parentUnits":{"watts":1,"squareFeet":-1},"symbols":{"wPerFtSup2":{"text":"W/ft","placement":"Suffix","space":true}}},"wattsPerSquareMeter":{"unitSystem":"Metric","parentUnits":{"watts":1,"squareMeters":-1},"symbols":{"wPerMSup2":{"text":"W/m","placement":"Suffix","space":true}}},"wattsPerSquareMeterKelvin":{"unitSystem":"Metric","parentUnits":{"wattsPerSquareMeter":1,"kelvinInterval":-1},"symbols":{"wPerMSup2K":{"text":"W/(mK)","placement":"Suffix","space":true}}},"webers":{"unitSystem":"Metric","parentUnits":{"volts":1,"seconds":1},"symbols":{"wb":{"text":"Wb","placement":"Suffix","space":true}}},"yards":{"unitSystem":"Imperial","factor":3,"parentUnits":{"feet":1},"symbols":{"yd":{"text":"yd","placement":"Suffix","space":true}}},"feetFractionalInches":{"defaultSymbol":"feetAndInches","unitSystem":"Imperial","factor":12,"parentUnits":{"inches":1},"symbols":{"feetAndInches":{"inherits":"symbol"},"footSingleQuote":{"text":"\'","placement":"Suffix","space":false},"ft":{"text":"ft","placement":"Suffix","space":true},"lf":{"text":"LF","placement":"Suffix","space":true}}},"fractionalInches":{"defaultSymbol":"in","unitSystem":"Imperial","factor":2.54,"parentUnits":{"centimeters":1},"symbols":{"in":{"text":"in","placement":"Suffix","space":true},"inchDoubleQuote":{"text":"\\"","placement":"Suffix","space":false}}},"metersCentimeters":{"defaultSymbol":"meter","unitSystem":"Metric","dimension":"length","symbols":{"meter":{"text":"m","placement":"Suffix","space":true},"metersAndCentimeters":{"inherits":"symbol"}}},"degreesMinutes":{"defaultSymbol":"degree","unitSystem":"Metric","parentFactors":{"threeHundredSixty":-1},"parentUnits":{"turns":1},"symbols":{"degree":{"text":"","placement":"Suffix","space":false},"degreesMinutesSeconds":{"inherits":"symbol"}}},"slopeDegrees":{"defaultSymbol":"slopeDegree","unitSystem":"Metric","parentFactors":{"threeHundredSixty":-1},"parentUnits":{"turns":1},"symbols":{"slopeDegree":{"text":"","placement":"Suffix","space":false}}},"stationingFeet":{"defaultSymbol":"feetAndInches","unitSystem":"Imperial","factor":12,"parentUnits":{"inches":1},"symbols":{"feetAndInches":{"inherits":"symbol"},"footSingleQuote":{"text":"\'","placement":"Suffix","space":false},"ft":{"text":"ft","placement":"Suffix","space":true},"lf":{"text":"LF","placement":"Suffix","space":true}}},"stationingMeters":{"defaultSymbol":"meter","unitSystem":"Metric","dimension":"length","symbols":{"meter":{"text":"m","placement":"Suffix","space":true},"metersAndCentimeters":{"inherits":"symbol"}}},"stationingSurveyFeet":{"unitSystem":"Imperial","factor":1200,"parentFactors":{"threeThousandNineHundredThirtySeven":-1},"parentUnits":{"meters":1},"symbols":{"usft":{"text":"USft","placement":"Suffix","space":true}}},"dateTime":{"symbols":{"date":{"text":"Date"},"dateTime":{"text":"ISODate","description":"default"},"dateAndTime":{"text":"Date, Time"}}}},"quantity":{"acceleration":{"units":["metersPerSecondSquared","kilometersPerSecondSquared","inchesPerSecondSquared","feetPerSecondSquared","milesPerSecondSquared","standardGravity"]},"angle":{"units":["degrees","radians","gradians","turns"]},"angularLineSpringCoefficient":{"units":["kipFeetPerDegreePerFoot","kilonewtonMetersPerDegreePerMeter"]},"angularPointSpringCoefficient":{"units":["kipFeetPerDegree","kilonewtonMetersPerDegree"]},"angularSpeed":{"units":["radiansPerSecond","revolutionsPerMinute"]},"area":{"units":["squareFeet","squareInches","squareMeters","squareCentimeters","squareHectometers","squareMillimeters","acres","hectares","squareYards","circularMils","squareMils"]},"areaPerLength":{"units":["squareFeetPerFoot","squareCentimetersPerMeter","squareMillimetersPerMeter","squareInchesPerFoot","squareMetersPerMeter"]},"areaPerPower":{"units":["squareFeetPerTonOfRefrigeration","squareMetersPerKilowatt","squareFeetPer1000BritishThermalUnitsPerHour"]},"areaPerTorque":{"units":["squareFeetPerKipFoot","squareMetersPerKilonewtonMeter"]},"colorTemperature":{"units":["kelvin"]},"costPerArea":{"units":["currencyPerSquareFoot","currencyPerSquareMeter"]},"currency":{"units":["currency"]},"density":{"units":["kilogramsPerCubicMeter","poundsMassPerCubicInch","poundsMassPerCubicFoot"]},"diffusivity":{"units":["squareFeetPerSecond","squareMetersPerSecond"]},"dynamicViscosity":{"units":["centipoises","kilogramsPerMeterHour","kilogramsPerMeterSecond","newtonSecondsPerSquareMeter","pascalSeconds","poises","poundForceSecondsPerSquareFoot","poundsMassPerFootHour","poundsMassPerFootSecond"]},"electricCapacitance":{"units":["farads"]},"electricCharge":{"units":["coulombs","ampereHours","ampereSeconds"]},"electricConductance":{"units":["mhos","siemens"]},"electricCurrent":{"units":["amperes","kiloamperes","milliamperes"]},"electricInductance":{"units":["henries"]},"electricPotential":{"units":["volts","kilovolts","millivolts"]},"electricResistance":{"units":["ohms"]},"electricResistivity":{"units":["ohmMeters"]},"energy":{"units":["joules","newtonMeters","kilogramForceMeters","poundForceFeet","kilojoules","britishThermalUnits","calories","kilocalories","kilowattHours","therms","ergs"]},"flow":{"units":["cubicFeetPerMinute","cubicFeetPerHour","cubicMetersPerSecond","cubicMetersPerHour","litersPerHour","litersPerMinute","litersPerSecond","usGallonsPerMinute","usGallonsPerHour"]},"flowPerArea":{"units":["cubicFeetPerMinuteSquareFoot","litersPerSecondSquareMeter"]},"flowPerPower":{"units":["cubicFeetPerMinutePerBritishThermalUnitPerHour","cubicFeetPerMinuteTonOfRefrigeration","cubicMetersPerWattSecond","litersPerSecondKilowatt","squareFeetPerKip","squareMetersPerKilonewton"]},"flowPerVolume":{"units":["cubicFeetPerMinuteCubicFoot","litersPerSecondCubicMeter"]},"force":{"units":["newtons","dekanewtons","kilonewtons","meganewtons","kips","kilogramsForce","tonnesForce","usTonnesForce","poundsForce","dynes","ouncesForce"]},"forceDensity":{"units":["kilonewtonsPerCubicMeter","poundsForcePerCubicFoot","kipsPerCubicInch","kipsPerCubicFoot"]},"forcePerLength":{"units":["newtonsPerMeter","dekanewtonsPerMeter","kilonewtonsPerMeter","meganewtonsPerMeter","kipsPerFoot","kilogramsForcePerMeter","tonnesForcePerMeter","poundsForcePerFoot","kipsPerInch"]},"frequency":{"units":["hertz","cyclesPerSecond"]},"friction":{"units":["pascalsPerMeter","feetOfWater39.2DegreesFahrenheitPer100Feet","inchesOfWater60DegreesFahrenheitPer100Feet"]},"heatCapacity":{"units":["britishThermalUnitsPerDegreeFahrenheit","joulesPerKelvin","kilojoulesPerKelvin"]},"heatTransferCoefficient":{"units":["wattsPerSquareMeterKelvin","britishThermalUnitsPerHourSquareFootDegreeFahrenheit"]},"illuminance":{"units":["lux","footcandles"]},"length":{"units":["centimeters","decimeters","feet","hectometers","inches","kilometers","meters","microinches","microns","miles","millimeters","mils","nanometers","nauticalMiles","usSurveyFeet","yards"]},"lengthPerTorque":{"units":["metersPerKilonewtonMeter","feetPerKipFoot"]},"lightingEfficacy":{"units":["lumensPerWatt"]},"luminance":{"units":["footlamberts","candelasPerSquareFoot","candelasPerSquareMeter"]},"luminousFlux":{"units":["lumens"]},"luminousIntensity":{"units":["candelas"]},"magneticFieldStrength":{"units":["oersteds"]},"magneticFlux":{"units":["webers","maxwells"]},"magneticFluxDensity":{"units":["teslas","gauss","gammas"]},"mass":{"units":["kilograms","tonnes","poundsMass","grams","milligrams","nanograms","grains","usTonnesMass","slugs","ouncesMass"]},"massPerArea":{"units":["kilogramsPerSquareMeter","poundsMassPerSquareFoot"]},"massPerLength":{"units":["kilogramsPerMeter","poundsMassPerFoot"]},"massPerTime":{"units":["poundsMassPerHour","poundsMassPerMinute","poundsMassPerSecond","kilogramsPerHour","kilogramsPerMinute","kilogramsPerSecond"]},"number":{"units":["general","fixed","percentage"]},"permeability":{"units":["nanogramsPerPascalSecondSquareMeter","grainsPerHourSquareFootInchMercury"]},"power":{"units":["watts","kilowatts","britishThermalUnitsPerSecond","britishThermalUnitsPerHour","caloriesPerSecond","kilocaloriesPerSecond","voltAmperes","kilovoltAmperes","horsepower","thousandBritishThermalUnitsPerHour","tonsOfRefrigeration"]},"powerDensity":{"units":["wattsPerCubicFoot","wattsPerCubicMeter","britishThermalUnitsPerHourCubicFoot"]},"powerPerArea":{"units":["wattsPerSquareFoot","wattsPerSquareMeter","britishThermalUnitsPerHourSquareFoot"]},"powerPerFlow":{"units":["wattsPerCubicFootPerMinute","wattsPerCubicMeterPerSecond"]},"powerPerLength":{"units":["wattsPerFoot","wattsPerMeter"]},"pressure":{"units":["pascals","kilopascals","megapascals","poundsForcePerSquareInch","inchesOfMercury32DegreesFahrenheit","millimetersOfMercury","atmospheres","bars","feetOfWater39.2DegreesFahrenheit","inchesOfWater60DegreesFahrenheit"]},"ratio":{"units":["fixed","percentage","perMille","ratioTo1","ratioTo10","ratioTo12","1ToRatio"]},"secondMomentOfArea":{"units":["feetToTheFourthPower","inchesToTheFourthPower","millimetersToTheFourthPower","centimetersToTheFourthPower","metersToTheFourthPower"]},"slope":{"units":["percentage","ratioTo1","ratioTo10","ratioTo12","riseDividedBy12Inches","riseDividedBy1Foot","riseDividedBy1000Millimeters","riseDividedBy120Inches","1ToRatio","riseDividedBy10Feet","perMille"]},"solidAngle":{"units":["steradians"]},"specificEnergy":{"units":["joulesPerGram","joulesPerKilogram","britishThermalUnitsPerPound"]},"specificHeatCapacity":{"units":["joulesPerGramDegreeCelsius","britishThermalUnitsPerPoundDegreeFahrenheit","joulesPerKilogramDegreeCelsius"]},"stress":{"units":["pascals","kilopascals","megapascals","poundsForcePerSquareInch","bars","newtonsPerSquareMeter","dekanewtonsPerSquareMeter","kilonewtonsPerSquareMeter","meganewtonsPerSquareMeter","kipsPerSquareFoot","kilogramsForcePerSquareMeter","tonnesForcePerSquareMeter","poundsForcePerSquareFoot","kipsPerSquareInch","kilonewtonsPerSquareCentimeter","newtonsPerSquareMillimeter","kilonewtonsPerSquareMillimeter"]},"temperature":{"units":["fahrenheit","celsius","kelvin","rankine"]},"temperatureInterval":{"units":["fahrenheitInterval","celsiusInterval","kelvinInterval","rankineInterval"]},"thermalConductivity":{"units":["wattsPerMeterKelvin","britishThermalUnitsPerHourFootDegreeFahrenheit"]},"thermalExpansionCoefficient":{"units":["inverseDegreesFahrenheit","inverseDegreesCelsius","micrometersPerMeterDegreeCelsius","microinchesPerInchDegreeFahrenheit"]},"thermalInsulance":{"units":["hourSquareFootDegreesFahrenheitPerBritishThermalUnit","squareMeterKelvinsPerWatt"]},"time":{"units":["milliseconds","seconds","minutes","hours"]},"torque":{"units":["newtonMeters","dekanewtonMeters","kilonewtonMeters","meganewtonMeters","kipFeet","kilogramForceMeters","tonneForceMeters","poundForceFeet"]},"torquePerLength":{"units":["newtonMetersPerMeter","dekanewtonMetersPerMeter","kilonewtonMetersPerMeter","meganewtonMetersPerMeter","kipFeetPerFoot","kilogramForceMetersPerMeter","tonneForceMetersPerMeter","poundForceFeetPerFoot"]},"velocity":{"units":["feetPerMinute","centimetersPerMinute","inchesPerSecond","metersPerSecond","feetPerSecond","kilometersPerSecond","milesPerSecond","kilometersPerHour","milesPerHour"]},"volume":{"units":["cubicYards","cubicFeet","cubicInches","cubicMeters","cubicCentimeters","cubicMillimeters","liters","usGallons"]},"volumePerForce":{"units":["cubicFeetPerKip","cubicMetersPerKilonewton"]},"warpingCoefficient":{"units":["feetToTheSixthPower","inchesToTheSixthPower","millimetersToTheSixthPower","centimetersToTheSixthPower","metersToTheSixthPower"]}}}')}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={id:e,loaded:!1,exports:{}};return i[e].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"==typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"==typeof i.then)return i}var o=Object.create(null);n.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>i[e]));return s.default=()=>i,n.d(o,s),o},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var o=n(14966);LMV=o})();
//# sourceMappingURL=viewer3D.min.js.map